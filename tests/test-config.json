{
  "description": "Test configuration for autonomous test execution. AI agents can modify this file without triggering PowerShell confirmation dialogs.",
  "version": "1.1.0",
  "lastModified": "2026-01-02",
  
  "testSuites": {
    "unit": {
      "description": "Fast unit tests only (no network, no E2E)",
      "testPathIgnorePatterns": ["e2e", "online", "puppeteer", "http.test.js", ".dev.test.js", ".manual.test.js", "/broken/", "/deprecated-ui/"],
      "timeout": 5000,
      "maxWorkers": 4,
      "forceExit": false
    },
    
    "integration": {
      "description": "HTTP server integration tests",
      "testPathPattern": "http.test.js",
      "testPathIgnorePatterns": ["/deprecated-ui/"],
      "timeout": 15000,
      "forceExit": true,
      "maxWorkers": 2
    },
    
    "e2e": {
      "description": "Standard E2E tests (excludes dev/manual tests)",
      "testPathPattern": "e2e",
      "testPathIgnorePatterns": [
        ".dev.test.js",
        ".manual.test.js",
        "guardian-1000-page-crawl.e2e.test.js",
        "guardian-1000-page-crawl-persists-to-db.e2e.test.js",
        "/broken/",
        "/deprecated-ui/"
      ],
      "timeout": 60000,
      "forceExit": true,
      "maxWorkers": 1,
      "detectOpenHandles": false,
      "note": "E2E tests always use forceExit to prevent hanging from unclosed handles"
    },
    
    "e2e-quick": {
      "description": "Quick E2E tests only (fast smoke tests)",
      "testPathPattern": "e2e-features",
      "testPathIgnorePatterns": [
        "guardian-1000-page-crawl.e2e.test.js",
        "guardian-1000-page-crawl-persists-to-db.e2e.test.js",
        "/deprecated-ui/"
      ],
      "timeout": 30000,
      "forceExit": true,
      "maxWorkers": 1
    },
    
    "puppeteer": {
      "description": "Puppeteer-based browser tests",
      "testPathPattern": "puppeteer",
      "testPathIgnorePatterns": [".dev.test.js", ".manual.test.js", "/broken/", "/deprecated-ui/"],
      "timeout": 45000,
      "forceExit": true,
      "maxWorkers": 1,
      "note": "Browser tests always use forceExit - chromium handles may linger"
    },
    
    "all": {
      "description": "All regular tests (excludes dev/manual tests)",
      "testPathIgnorePatterns": [
        ".dev.test.js",
        ".manual.test.js",
        "guardian-1000-page-crawl.e2e.test.js",
        "guardian-1000-page-crawl-persists-to-db.e2e.test.js",
        "geography-crawl.e2e.test.js",
        "geography.full.e2e.test.js",
        "/broken/",
        "/deprecated-ui/"
      ],
      "timeout": 15000,
      "forceExit": true,
      "maxWorkers": 4
    },

    "crawler-soak": {
      "description": "MANUAL ONLY - Long-running crawler soak tests (1000-page fixture + DB persistence)",
      "testPathPattern": "guardian-1000-page-crawl",
      "timeout": 360000,
      "forceExit": true,
      "maxWorkers": 1,
      "detectOpenHandles": true,
      "note": "This suite is intentionally excluded from normal runs. Run explicitly when validating end-to-end crawler persistence at scale."
    },

    "crawler-live": {
      "description": "MANUAL ONLY - Live internet crawl smoke test (requires LIVE_CRAWL_ENABLE=1 + LIVE_CRAWL_START_URL)",
      "testPathPattern": "live-crawl-persists-to-db.manual.test.js",
      "timeout": 1800000,
      "forceExit": true,
      "maxWorkers": 1,
      "detectOpenHandles": true,
      "note": "This suite is never for CI. Defaults to crawling The Guardian front page when LIVE_CRAWL_ENABLE=1. Proves real network downloads by asserting http_responses.bytes_downloaded in a fresh SQLite DB. Override start URL with LIVE_CRAWL_START_URL if needed."
    },
    
    "dev-geography": {
      "description": "DEVELOPMENT ONLY - Full geography crawl with live APIs (5-15 min runtime)",
      "testPathPattern": "geography.full.e2e.dev.test.js",
      "timeout": 900000,
      "forceExit": true,
      "maxWorkers": 1,
      "environment": {
        "JEST_DISABLE_TRUNCATE": "1",
        "JEST_MAX_CONSOLE_LINES": "999999"
      },
      "note": "This is a development/debugging tool, not a regular test. Run explicitly when debugging geography crawl."
    },
    
    "dev-geography-monitor": {
      "description": "DEVELOPMENT ONLY - Geography crawl with full telemetry monitoring (10 min timeout)",
      "testPathPattern": "geography-crawl.e2e.dev.test.js",
      "timeout": 600000,
      "forceExit": true,
      "maxWorkers": 1,
      "environment": {
        "JEST_DISABLE_TRUNCATE": "1",
        "JEST_MAX_CONSOLE_LINES": "999999"
      },
      "note": "This is a development/debugging tool for monitoring live telemetry. Very long-running."
    },
    
    "migration": {
      "description": "Database migration orchestrator tests",
      "testPathPattern": "orchestrator.test.js",
      "timeout": 30000,
      "forceExit": true,
      "maxWorkers": 1
    },
    
    "deprecated-ui": {
      "description": "DEPRECATED: UI tests (kept for reference, rarely run)",
      "testPathPattern": "/deprecated-ui/",
      "timeout": 60000,
      "forceExit": true,
      "maxWorkers": 1,
      "note": "These tests are for the deprecated UI and should rarely be run. Use only for reference."
    }
  },
  
  "defaults": {
    "forceExitForE2E": true,
    "maxTimeoutMs": 300000,
    "serverStartTimeoutMs": 8000,
    "serverStopTimeoutMs": 2000,
    "browserCloseTimeoutMs": 5000
  },
  
  "notes": {
    "autonomous-operation": "AI agents can modify this file to adjust test configurations without triggering confirmation dialogs.",
    "test-runners": "Use npm run test:suite <suite-name> to run a configured test suite",
    "dev-tests": "Tests with '.dev.test.js' or '.manual.test.js' suffix are excluded from regular runs",
    "naming-convention": "Use .dev.test.js for development/debugging tests, .manual.test.js for manual-only tests",
    "environment-vars": "Avoid using environment variables in test commands - they trigger confirmation dialogs",
    "hanging-prevention": "See docs/guides/TEST_HANGING_PREVENTION_GUIDE.md for patterns to avoid test hangs"
  }
}
