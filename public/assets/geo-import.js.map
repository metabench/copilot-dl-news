{
  "version": 3,
  "sources": ["../../node_modules/lang-mini/lang-mini.js", "../../node_modules/lang-mini/lib-lang-mini.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/collective.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/Data_Model.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/tools.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/b-plus-tree/stiffarray.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/b-plus-tree/b-plus-tree.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/old/Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/Mini_Context.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/old/Data_Object.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/sorted-kvs.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/old/Collection.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/Data_Object.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Immutable_Data_Model.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Validation_Result.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Validation_Success.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/setup_base_data_value_value_property.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Base_Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Value_Set_Attempt.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Immutable_Base_Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Immutable_Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/setup_data_value_data_type_set.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/new/Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/Data_Value.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/doubly-linked-list.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/ordered-kvs.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/ordered-string-list.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/Data_Model/Collection.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/util.js", "../../node_modules/jsgui3-html/node_modules/lang-tools/lang.js", "../../node_modules/jsgui3-html/html-core/text-node.js", "../../node_modules/fnl/fn-io-transform.js", "../../node_modules/fnl/monitor-item.js", "../../node_modules/fnl/default-arg-transformations.js", "../../node_modules/fnl/fnl.js", "../../node_modules/obext/node_modules/lang-mini/lang-mini.js", "../../node_modules/obext/node_modules/lang-mini/lib-lang-mini.js", "../../node_modules/obext/oext.js", "../../node_modules/jsgui3-html/html-core/control-core.js", "../../node_modules/jsgui3-gfx-core/core/shapes/Shape.js", "../../node_modules/jsgui3-gfx-core/node_modules/lang-mini/lang-mini.js", "../../node_modules/jsgui3-gfx-core/node_modules/lang-mini/lib-lang-mini.js", "../../node_modules/jsgui3-gfx-core/core/shapes/Rectangle.js", "../../node_modules/jsgui3-gfx-core/core/pixel-pos-list.js", "../../node_modules/jsgui3-gfx-core/core/Typed_Array_Binary_Read_Write.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/copy.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/info.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/read.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/transform.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/write.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/bitwise.js", "../../node_modules/jsgui3-gfx-core/core/ta-math/draw.js", "../../node_modules/jsgui3-gfx-core/core/ta-math.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-painter.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-0-core-inner-structures.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-1-core-get-set-pixel.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-1.1-core-draw-line.js", "../../node_modules/jsgui3-gfx-core/core/shapes/is_debug.js", "../../node_modules/jsgui3-gfx-core/core/shapes/TA_Table_8_Columns.js", "../../node_modules/jsgui3-gfx-core/core/shapes/Polygon_Edges.js", "../../node_modules/jsgui3-gfx-core/core/shapes/Polygon_Scanline_Edges.js", "../../node_modules/jsgui3-gfx-core/core/shapes/Polygon.js", "../../node_modules/jsgui3-gfx-core/core/shapes/ScanlineProcessor.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-1.2-core-draw-polygon.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-1.5-core-mask.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-2-core-reference-implementations.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-3-core.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-4-advanced-typedarray-properties.js", "../../node_modules/jsgui3-gfx-core/core/convolution-kernels/kernels.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-5-idiomatic-enh.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-6-perf-focus-enh.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-7-specialised-enh.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer-8-enh.js", "../../node_modules/jsgui3-gfx-core/core/pixel-buffer.js", "../../node_modules/jsgui3-gfx-core/core/gfx-core.js", "../../node_modules/jsgui3-html/html-core/Data.js", "../../node_modules/jsgui3-html/html-core/Control_Data.js", "../../node_modules/jsgui3-html/html-core/Control_View_UI_Low_Level_Data.js", "../../node_modules/jsgui3-html/html-core/Control_View_UI_Low_Level.js", "../../node_modules/jsgui3-html/html-core/Control_View_UI.js", "../../node_modules/jsgui3-html/html-core/Control_View_Data.js", "../../node_modules/jsgui3-html/html-core/Control_View_Low_Level_Data.js", "../../node_modules/jsgui3-html/html-core/Control_View_Low_Level.js", "../../node_modules/jsgui3-html/html-core/Control_View.js", "../../node_modules/jsgui3-html/html-core/Control_Validation_Data.js", "../../node_modules/jsgui3-html/html-core/Validation_State.js", "../../node_modules/jsgui3-html/html-core/Control_Validation_Target.js", "../../node_modules/jsgui3-html/html-core/Control_Validation_Validator.js", "../../node_modules/jsgui3-html/html-core/Control_Validation.js", "../../node_modules/jsgui3-html/html-core/control_model_factory.js", "../../node_modules/jsgui3-html/control_mixins/model_data_view_compositional_representation.js", "../../node_modules/jsgui3-html/html-core/control-enh.js", "../../node_modules/jsgui3-html/html-core/ModelBinder.js", "../../node_modules/jsgui3-html/html-core/Transformations.js", "../../node_modules/jsgui3-html/html-core/Data_Model_View_Model_Control.js", "../../node_modules/jsgui3-html/html-core/control.js", "../../node_modules/jsgui3-html/html-core/selection-scope.js", "../../node_modules/jsgui3-html/html-core/page-context.js", "../../node_modules/htmlparser/lib/htmlparser.js", "../../node_modules/jsgui3-html/html-core/parse-mount.js", "../../node_modules/jsgui3-html/html-core/html-core.js", "../../node_modules/requires-port/index.js", "../../node_modules/querystringify/index.js", "../../node_modules/url-parse/index.js", "../../node_modules/jsgui3-html/router/routing-tree.js", "../../node_modules/jsgui3-html/router/router.js", "../../node_modules/jsgui3-html/resource/pool.js", "../../node_modules/jsgui3-html/resource/resource.js", "../../node_modules/jsgui3-html/resource/data-kv-resource.js", "../../node_modules/jsgui3-html/resource/data-transform-resource.js", "../../node_modules/jsgui3-html/resource/compilation-resource.js", "../../node_modules/jsgui3-html/resource/compiler-resource.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/Active_HTML_Document.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/button.js", "../../node_modules/jsgui3-html/controls/organised/0-core/1-advanced/vector/arrow-button.js", "../../node_modules/jsgui3-html/control_mixins/dragable.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/horizontal-slider.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/audio-volume.js", "../../node_modules/jsgui3-html/control_mixins/selectable.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Cell.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/menu-node.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/context-menu.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/grid.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/color-grid.js", "../../node_modules/jsgui3-html/html-core/arr_colors.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/color-palette.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/checkbox.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/combo-box.js", "../../node_modules/jsgui3-html/control_mixins/coverable.js", "../../node_modules/jsgui3-html/control_mixins/typed_data/date.js", "../../node_modules/jsgui3-html/control_mixins/display.js", "../../node_modules/jsgui3-html/control_mixins/display-modes.js", "../../node_modules/jsgui3-html/control_mixins/fast-touch-click.js", "../../node_modules/jsgui3-html/control_mixins/popup.js", "../../node_modules/jsgui3-html/control_mixins/drag_like_events.js", "../../node_modules/jsgui3-html/control_mixins/resizable.js", "../../node_modules/jsgui3-html/control_mixins/deletable.js", "../../node_modules/jsgui3-html/control_mixins/selected-deletable.js", "../../node_modules/jsgui3-html/control_mixins/selected-resizable.js", "../../node_modules/jsgui3-html/control_mixins/selection-box-host.js", "../../node_modules/jsgui3-html/control_mixins/press-events.js", "../../node_modules/jsgui3-html/control_mixins/press-outside.js", "../../node_modules/jsgui3-html/control_mixins/pressed-state.js", "../../node_modules/jsgui3-html/control_mixins/mx.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Dropdown_Menu.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/Text_Input.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/text-item.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Indicator.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Status_Indicator.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Validation_Status_Indicator.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/Text_Field.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/file-upload.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/1-editor/form_field.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/horizontal-menu.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/4-data/data-item.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/4-data/data-row.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/date-picker.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/dropdown-list.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/panel.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/title-bar.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/toggle-button.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/plus-minus-toggle-button.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/vertical-expander.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/tree-node.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/tree.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/file-tree.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/file-tree-node.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/icon.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/item.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/list.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/item-selector.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/2-misc/left-right-arrows-selector.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/line-chart.js", "../../node_modules/jsgui3-html/controls/organised/0-core/1-advanced/login.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/modal.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/tile-slide.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/month-view.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/radio-button.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/radio-button-group.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/tabbed-panel.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/app/multi-layout-mode.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/1-editor/property_editor.js", "../../node_modules/jsgui3-html/controls/organised/0-core/1-advanced/popup-menu-button.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/1-editor/Rich_Text_Editor.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/scrollbar.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/scroll-view.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/search-bar.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/0-native-compositional/Select_Options.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/single-line.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/3-page/standard-web-page.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/start-stop-toggle-button.js", "../../node_modules/jsgui3-html/controls/organised/0-core/1-advanced/string-span.js", "../../node_modules/jsgui3-html/controls/organised/0-core/0-basic/1-compositional/timespan-selector.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/titled-panel.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/Toolbar.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/5-ui/toolbox.js", "../../node_modules/jsgui3-html/controls/organised/1-standard/6-layout/window.js", "../../node_modules/jsgui3-html/controls/controls.js", "../../node_modules/jsgui3-html/html.js", "../../node_modules/jsgui3-client/client-resource-pool.js", "../../node_modules/jsgui3-client/page-context.js", "../../node_modules/jsgui3-client/resource.js", "../../node_modules/jsgui3-client/client.js", "../../src/ui/controls/controlRegistry.js", "../../src/ui/controls/layouts/TwoColumnLayoutFactory.js", "../../src/ui/controls/helpers/controlFactory.js", "../../src/ui/controls/GeoImportDashboard.js", "../../src/ui/client/geoImport/index.js"],
  "sourcesContent": ["// Late 2023 - Should include field from obext as well?\r\n\r\n// Bring more data functionality to a lower level...?\r\n//   Have more of a platform to support Data_Model, Data_Value and Data_Object with.\r\n\r\n// data.schema?\r\n// data.model.schema???\r\n\r\n// Would be worth integrating various parts together here and with Data_Model, Data_Object, Data_Value\r\n\r\n\r\nconst running_in_browser = typeof window !== 'undefined';\r\nconst running_in_node = !running_in_browser;\r\nlet Readable_Stream, Writable_Stream, Transform_Stream;\r\nconst get_stream = () => {\r\n\tif (running_in_node) {\r\n\t\treturn (() => {\r\n\t\t\tconst str_libname = ('str') + ('eam');\r\n\t\t\tconst stream = require(str_libname);\r\n\t\t\tReadable_Stream = stream.Readable;\r\n\t\t\tWritable_Stream = stream.Writable;\r\n\t\t\tTransform_Stream = stream.Transform;\r\n\t\t\treturn stream;\r\n\t\t})();\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n}\r\nconst stream = get_stream();\r\nconst each = (collection, fn, context) => {\r\n\tif (collection) {\r\n\t\tif (collection.__type == 'collection') {\r\n\t\t\treturn collection.each(fn, context);\r\n\t\t}\r\n\t\tlet ctu = true;\r\n\t\tlet stop = function () {\r\n\t\t\tctu = false;\r\n\t\t};\r\n\t\tif (is_array(collection)) {\r\n\t\t\tlet res = [],\r\n\t\t\t\tres_item;\r\n\t\t\tfor (let c = 0, l = collection.length; c < l; c++) {\r\n\t\t\t\tres_item;\r\n\t\t\t\tif (ctu == false) break;\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tres_item = fn.call(context, collection[c], c, stop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres_item = fn(collection[c], c, stop);\r\n\t\t\t\t}\r\n\t\t\t\tif (ctu == false) break; // If stop() was called, do not push current item\r\n\t\t\t\tres.push(res_item);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\tlet name, res = {};\r\n\t\t\tfor (name in collection) {\r\n\t\t\t\tif (ctu === false) break;\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tres[name] = fn.call(context, collection[name], name, stop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres[name] = fn(collection[name], name, stop);\r\n\t\t\t\t}\r\n\t\t\t\tif (ctu === false) break; // If stop() was called, do not set current property\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n};\r\nconst is_array = Array.isArray;\r\nconst is_dom_node = function isDomNode(obj) {\r\n\treturn (!!obj && typeof obj.nodeType !== 'undefined' && typeof obj.childNodes !== 'undefined');\r\n};\r\nconst get_truth_map_from_arr = function (arr) {\r\n\tlet res = {};\r\n\teach(arr, function (v, i) {\r\n\t\tres[v] = true;\r\n\t});\r\n\treturn res;\r\n};\r\nconst get_arr_from_truth_map = function (truth_map) {\r\n\tlet res = [];\r\n\teach(truth_map, function (v, i) {\r\n\t\tres.push(i);\r\n\t});\r\n\treturn res;\r\n};\r\nconst get_map_from_arr = function (arr) {\r\n\tlet res = {};\r\n\tfor (let c = 0, l = arr.length; c < l; c++) {\r\n\t\tres[arr[c]] = c;\r\n\t}\r\n\treturn res;\r\n}\r\nconst arr_like_to_arr = function (arr_like) {\r\n\tlet res = new Array(arr_like.length);\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tres[c] = arr_like[c];\r\n\t};\r\n\treturn res;\r\n};\r\nconst is_ctrl = function (obj) {\r\n\treturn (typeof obj !== 'undefined' && obj !== null && is_defined(obj.__type_name) && is_defined(obj.content) && is_defined(obj.dom));\r\n};\r\nconst map_loaded_type_fn_checks = {},\r\n\tmap_loaded_type_abbreviations = {\r\n\t\t'object': 'o',\r\n\t\t'number': 'n',\r\n\t\t'string': 's',\r\n\t\t'function': 'f',\r\n\t\t'boolean': 'b',\r\n\t\t'undefined': 'u',\r\n\t\t'null': 'N',\r\n\t\t'array': 'a',\r\n\t\t'arguments': 'A',\r\n\t\t'date': 'd',\r\n\t\t'regex': 'r',\r\n\t\t'error': 'e',\r\n\t\t'buffer': 'B',\r\n\t\t'promise': 'p',\r\n\t\t'observable': 'O',\r\n\t\t'readable_stream': 'R',\r\n\t\t'writable_stream': 'W',\r\n\t\t'data_value': 'V'\r\n\t};\r\nlet using_type_plugins = false;\r\nconst invert = (obj) => {\r\n\tif (!is_array(obj)) {\r\n\t\tlet res = {};\r\n\t\teach(obj, (v, k) => {\r\n\t\t\tres[v] = k;\r\n\t\t})\r\n\t\treturn res;\r\n\t} else {\r\n\t\tconsole.trace();\r\n\t\tthrow 'invert(obj) not supported on arrays'\r\n\t}\r\n}\r\nconst map_loaded_type_names = invert(map_loaded_type_abbreviations);\r\nconst load_type = (name, abbreviation, fn_detect_instance) => {\r\n\tmap_loaded_type_fn_checks[name] = fn_detect_instance;\r\n\tmap_loaded_type_names[abbreviation] = name;\r\n\tmap_loaded_type_abbreviations[name] = abbreviation;\r\n\tusing_type_plugins = true;\r\n}\r\nconst tof = (obj, t1) => {\r\n\tlet res = t1 || typeof obj;\r\n\tif (using_type_plugins) {\r\n\t\tlet res;\r\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\r\n\t\t\tif (fn_check(obj)) {\r\n\t\t\t\tres = name;\r\n\t\t\t\tstop();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (res) {\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean') {\r\n\t\treturn res;\r\n\t}\r\n\tif (res === 'object') {\r\n\t\tif (typeof obj !== 'undefined') {\r\n\t\t\tif (obj === null) {\r\n\t\t\t\treturn 'null';\r\n\t\t\t}\r\n\t\t\tif (obj.__type) {\r\n\t\t\t\treturn obj.__type;\r\n\t\t\t} else if (obj.__type_name) {\r\n\t\t\t\treturn obj.__type_name;\r\n\t\t\t} else {\r\n\t\t\t\tif (obj instanceof Promise) {\r\n\t\t\t\t\treturn 'promise';\r\n\t\t\t\t}\r\n\t\t\t\tif (is_ctrl(obj)) {\r\n\t\t\t\t\treturn 'control';\r\n\t\t\t\t}\r\n\t\t\t\tif (obj instanceof Date) {\r\n\t\t\t\t\treturn 'date';\r\n\t\t\t\t}\r\n\t\t\t\tif (is_array(obj)) {\r\n\t\t\t\t\treturn 'array';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (obj instanceof Error) {\r\n\t\t\t\t\t\tres = 'error';\r\n\t\t\t\t\t} else if (obj instanceof RegExp) res = 'regex';\r\n\t\t\t\t\tif (typeof window === 'undefined') {\r\n\t\t\t\t\t\tif (obj && obj.readInt8) res = 'buffer';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn 'undefined';\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\nconst tf = (obj) => {\r\n\tlet res = typeof obj;\r\n\tif (using_type_plugins) {\r\n\t\tlet res;\r\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\r\n\t\t\tif (fn_check(obj)) {\r\n\t\t\t\tres = map_loaded_type_abbreviations[name];\r\n\t\t\t\tstop();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (res) {\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean' || res === 'undefined') {\r\n\t\treturn res[0];\r\n\t} else {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'N';\r\n\t\t} else {\r\n\t\t\tif (running_in_node) {\r\n\t\t\t\tif (obj instanceof Readable_Stream) {\r\n\t\t\t\t\treturn 'R';\r\n\t\t\t\t} else if (obj instanceof Writable_Stream) {\r\n\t\t\t\t\treturn 'W';\r\n\t\t\t\t} else if (obj instanceof Transform_Stream) {\r\n\t\t\t\t\treturn 'T';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof Buffer !== 'undefined' && obj instanceof Buffer) {\r\n\t\t\t\treturn 'B';\r\n\t\t\t} else if (obj instanceof Promise) {\r\n\t\t\t\treturn 'p';\r\n\t\t\t} else if (obj instanceof Date) {\r\n\t\t\t\treturn 'd';\r\n\t\t\t} else if (is_array(obj)) {\r\n\t\t\t\treturn 'a';\r\n\t\t\t} else {\r\n\t\t\t\tif (obj._is_observable === true) {\r\n\t\t\t\t\treturn 'O';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (typeof obj.callee === 'function') {\r\n\t\t\t\t\t\treturn 'A';\r\n\t\t\t\t\t} else if (obj instanceof Error) {\r\n\t\t\t\t\t\treturn 'e';\r\n\t\t\t\t\t} else if (obj instanceof RegExp) return 'r';\r\n\t\t\t\t\treturn 'o';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tconsole.trace();\r\n\tconsole.log('item', item);\r\n\tthrow 'type not found';\r\n\treturn res;\r\n};\r\nconst atof = (arr) => {\r\n\tlet res = new Array(arr.length);\r\n\tfor (let c = 0, l = arr.length; c < l; c++) {\r\n\t\tres[c] = tof(arr[c]);\r\n\t}\r\n\treturn res;\r\n};\r\nconst is_defined = (value) => {\r\n\t\treturn typeof (value) != 'undefined';\r\n\t},\r\n\tisdef = is_defined;\r\nconst stringify = JSON.stringify;\r\n\r\n// Older version???\r\n\r\nlet _get_item_sig = (i, arr_depth) => {\r\n\tlet res;\r\n\tlet t1 = typeof i;\r\n\tif (t1 === 'string') {\r\n\t\tres = 's';\r\n\t} else if (t1 === 'number') {\r\n\t\tres = 'n';\r\n\t} else if (t1 === 'boolean') {\r\n\t\tres = 'b';\r\n\t} else if (t1 === 'function') {\r\n\t\tres = 'f';\r\n\t} else {\r\n\t\tlet t = tof(i, t1);\r\n\t\tif (t === 'array') {\r\n\t\t\tif (arr_depth) {\r\n\t\t\t\tres = '['\r\n\t\t\t\tfor (let c = 0, l = i.length; c < l; c++) {\r\n\t\t\t\t\tif (c > 0) res = res + ',';\r\n\t\t\t\t\tres = res + get_item_sig(i[c], arr_depth - 1);\r\n\t\t\t\t}\r\n\t\t\t\tres = res + ']';\r\n\t\t\t} else {\r\n\t\t\t\tres = 'a';\r\n\t\t\t}\r\n\t\t} else if (t === 'control') {\r\n\t\t\tres = 'c';\r\n\t\t} else if (t === 'date') {\r\n\t\t\tres = 'd';\r\n\t\t} else if (t === 'observable') {\r\n\t\t\tres = 'O';\r\n\t\t} else if (t === 'regex') {\r\n\t\t\tres = 'r';\r\n\t\t} else if (t === 'buffer') {\r\n\t\t\tres = 'B';\r\n\t\t} else if (t === 'readable_stream') {\r\n\t\t\tres = 'R';\r\n\t\t} else if (t === 'writable_stream') {\r\n\t\t\tres = 'W';\r\n\t\t} else if (t === 'object') {\r\n\t\t\tres = 'o';\r\n\t\t} else if (t === 'undefined') {\r\n\t\t\tres = 'u';\r\n\t\t} else {\r\n\t\t\tif (t === 'collection_index') {\r\n\t\t\t\treturn 'X';\r\n\t\t\t} else if (t === 'data_object') {\r\n\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\tres = '~D';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres = 'D';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (t === 'data_value') {\r\n\t\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\t\tres = '~V';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres = 'V';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (t === 'null') {\r\n\t\t\t\t\tres = '!';\r\n\t\t\t\t} else if (t === 'collection') {\r\n\t\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\t\tres = '~C';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres = 'C';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres = '?';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\nconst get_item_sig = (item, arr_depth) => {\r\n\tif (arr_depth) {\r\n\t\treturn _get_item_sig(item, arr_depth);\r\n\t}\r\n\tconst t = tof(item);\r\n\r\n\tif (map_loaded_type_abbreviations[t]) {\r\n\t\treturn map_loaded_type_abbreviations[t];\r\n\t} else {\r\n\t\tlet bt = typeof item;\r\n\t\tif (bt === 'object') {\r\n\t\t\tif (is_array(item)) {\r\n\t\t\t\treturn 'a';\r\n\t\t\t} else {\r\n\t\t\t\treturn 'o';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log('map_loaded_type_abbreviations type name not found', t);\r\n\t\t\tconsole.log('bt', bt);\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'stop';\r\n\t\t}\r\n\t}\r\n}\r\nconst get_a_sig = (a) => {\r\n\tlet c = 0,\r\n\t\tl = a.length;\r\n\r\n\t//console.log('is_array(a)', is_array(a));\r\n\t//console.log('a', a);\r\n\t//console.log('get_a_sig l', l);\r\n\tlet res = '[';\r\n\tlet first = true;\r\n\tfor (c = 0; c < l; c++) {\r\n\t\tif (!first) {\r\n\t\t\tres = res + ',';\r\n\t\t}\r\n\t\tfirst = false;\r\n\t\tres = res + get_item_sig(a[c]);\r\n\t}\r\n\tres = res + ']';\r\n\treturn res;\r\n}\r\nconst deep_sig = (item, max_depth = -1, depth = 0) => {\r\n\tconst t = tf(item);\r\n\tlet res = '';\r\n\tif (t === 'a') {\r\n\t\tconst l = item.length;\r\n\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\tres = res + '[';\r\n\t\t\tlet first = true;\r\n\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\tif (!first) res = res + ',';\r\n\t\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tres = res + ']';\r\n\t\t} else {\r\n\t\t\treturn 'a';\r\n\t\t}\r\n\t} else if (t === 'A') {\r\n\t\tconst l = item.length;\r\n\t\tlet first = true;\r\n\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\tif (!first) res = res + ',';\r\n\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t} else if (t === 'o') {\r\n\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\tlet res = '{';\r\n\t\t\tlet first = true;\r\n\t\t\teach(item, (v, k) => {\r\n\t\t\t\tif (!first) res = res + ',';\r\n\t\t\t\tres = res + '\"' + k + '\":' + deep_sig(v, max_depth, depth + 1);\r\n\t\t\t\tfirst = false;\r\n\t\t\t});\r\n\t\t\tres = res + '}';\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\treturn 'o';\r\n\t\t}\r\n\t} else {\r\n\t\tres = res + t;\r\n\t}\r\n\treturn res;\r\n}\r\nconst trim_sig_brackets = function (sig) {\r\n\tif (tof(sig) === 'string') {\r\n\t\tif (sig.charAt(0) == '[' && sig.charAt(sig.length - 1) == ']') {\r\n\t\t\treturn sig.substring(1, sig.length - 1);\r\n\t\t} else {\r\n\t\t\treturn sig;\r\n\t\t}\r\n\t}\r\n};\r\nconst arr_trim_undefined = function (arr_like) {\r\n\tlet res = [];\r\n\tlet last_defined = -1;\r\n\tlet t, v;\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tv = arr_like[c];\r\n\t\tt = tof(v);\r\n\t\tif (t == 'undefined') {} else {\r\n\t\t\tlast_defined = c;\r\n\t\t}\r\n\t}\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tif (c <= last_defined) {\r\n\t\t\tres.push(arr_like[c]);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\n\r\n// Could see about simply integrating data types into fp....?\r\n//   That could mean habing get_item_sig return sigs for those data types.\r\n//     Would need to define signature abbreviations for them.\r\n\r\n\r\n\r\n\r\n\r\nconst functional_polymorphism = function (options, fn) {\r\n\tlet a0 = arguments;\r\n\tif (a0.length === 1) {\r\n\t\tfn = a0[0];\r\n\t\toptions = null;\r\n\t}\r\n\tlet arr_slice = Array.prototype.slice;\r\n\tlet arr, sig, a2, l, a;\r\n\treturn function () {\r\n\t\ta = arguments;\r\n\t\tl = a.length;\r\n\t\tif (l === 1) {\r\n\t\t\tsig = get_item_sig([a[0]], 1);\r\n\t\t\ta2 = [a[0]];\r\n\t\t\ta2.l = 1;\r\n\t\t\treturn fn.call(this, a2, sig);\r\n\t\t} else if (l > 1) {\r\n\t\t\tarr = arr_trim_undefined(arr_slice.call(a, 0));\r\n\t\t\tsig = get_item_sig(arr, 1);\r\n\t\t\tarr.l = arr.length;\r\n\t\t\treturn fn.call(this, arr, sig);\r\n\t\t} else if (a.length === 0) {\r\n\t\t\tarr = new Array(0);\r\n\t\t\tarr.l = 0;\r\n\t\t\treturn fn.call(this, arr, '[]');\r\n\t\t}\r\n\t}\r\n};\r\nconst fp = functional_polymorphism;\r\nconst parse_sig = (str_sig, opts = {}) => {\r\n\tconst sig2 = str_sig.split(', ').join(',');\r\n\tconst sig_items = sig2.split(',');\r\n\tconst res = [];\r\n\teach(sig_items, sig_item => {\r\n\t\tif (sig_item.length === 1) {\r\n\t\t\tlet type_name = map_loaded_type_names[sig_item];\r\n\t\t\tres.push({\r\n\t\t\t\tabbreviation: sig_item,\r\n\t\t\t\ttype_name: type_name\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tlet suffix_modifiers;\r\n\t\t\tlet zero_or_more = false;\r\n\t\t\tlet one_or_more = false;\r\n\t\t\tlet type_name = sig_item;\r\n\t\t\tconst obj_res = {\r\n\t\t\t\ttype_name: type_name\r\n\t\t\t}\r\n\t\t\tconst distil_suffix_modifiers = () => {\r\n\t\t\t\tlet last_char = type_name.substr(type_name.length - 1);\r\n\t\t\t\tif (last_char === '*') {\r\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\r\n\t\t\t\t\tzero_or_more = true;\r\n\t\t\t\t\tobj_res.zero_or_more = true;\r\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\r\n\t\t\t\t\tobj_res.modifiers.push('*');\r\n\t\t\t\t\tdistil_suffix_modifiers();\r\n\t\t\t\t} else if (last_char === '+') {\r\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\r\n\t\t\t\t\tone_or_more = true;\r\n\t\t\t\t\tobj_res.one_or_more = true;\r\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\r\n\t\t\t\t\tobj_res.modifiers.push('+');\r\n\t\t\t\t\tdistil_suffix_modifiers();\r\n\t\t\t\t} else {}\r\n\t\t\t}\r\n\t\t\tdistil_suffix_modifiers();\r\n\t\t\tobj_res.type_name = type_name;\r\n\t\t\tres.push(obj_res);\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n}\r\nconst mfp_not_sigs = get_truth_map_from_arr(['pre', 'default', 'post']);\r\nconst mfp_unparse_sig = arr_sig => {\r\n\tlet res = '[';\r\n\tlet first = true;\r\n\teach(arr_sig, sig_item => {\r\n\t\tif (!first) {\r\n\t\t\tres = res + ',';\r\n\t\t}\r\n\t\tres = res + sig_item.abbreviation;\r\n\t\tfirst = false;\r\n\t})\r\n\tres = res + ']';\r\n\treturn res;\r\n}\r\nconst map_grammar_def_abbreviations = {\r\n\t'string': 's',\r\n\t'number': 'n',\r\n\t'boolean': 'b',\r\n\t's': 's',\r\n\t'n': 'n',\r\n\t'b': 'b'\r\n}\r\nconst log = () => {};\r\nconst combinations = (arr, arr_idxs_to_ignore) => {\r\n\tconst map_ignore_idxs = {};\r\n\tif (arr_idxs_to_ignore) {\r\n\t\teach(arr_idxs_to_ignore, idx_to_ignore => {\r\n\t\t\tmap_ignore_idxs[idx_to_ignore] = true;\r\n\t\t});\r\n\t}\r\n\r\n\t// Check for empty arrays in the input\r\n\tif (arr.some(subArray => subArray.length === 0)) {\r\n\t\treturn []; // Return an empty result if any sub-array is empty\r\n\t}\r\n\r\n\tconst res = [];\r\n\tconst l = arr.length;\r\n\tconst arr_idxs_num_options = new Uint32Array(l);\r\n\teach(arr, (arr_item1, i1) => {\r\n\t\tarr_idxs_num_options[i1] = arr_item1.length;\r\n\t});\r\n\tconst arr_current_option_idxs = (new Uint32Array(l)).fill(0);\r\n\tconst result_from_indexes = (arr, arg_indexes) => {\r\n\t\tconst res = new Array(l);\r\n\t\tif (arg_indexes.length === l) {\r\n\t\t\tfor (var c = 0; c < l; c++) {\r\n\t\t\t\tres[c] = arr[c][arg_indexes[c]];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Arguments length mismatch';\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\tconst incr = () => {\r\n\t\tfor (c = l - 1; c >= 0; c--) {\r\n\t\t\tconst ival = arr_current_option_idxs[c];\r\n\t\t\tconst max = arr_idxs_num_options[c] - 1;\r\n\t\t\tif (ival < max) {\r\n\t\t\t\tarr_current_option_idxs[c]++;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tif (c === 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tarr_current_option_idxs.fill(0, c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\r\n\tres.push(vals);\r\n\twhile (incr()) {\r\n\t\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\r\n\t\tres.push(vals);\r\n\t}\r\n\treturn res;\r\n}\r\nconst map_native_types = {\r\n\t'string': true,\r\n\t'boolean': true,\r\n\t'number': true,\r\n\t'object': true\r\n}\r\nconst map_native_type_sigs = {\r\n\t's': true,\r\n\t'n': true,\r\n\t'o': true,\r\n\t'a': true,\r\n\t'd': true\r\n}\r\n\r\n\r\n// Late 2023 - mfp may be a good basis to proceed with more data-type aware idioms.\r\n//   Want to use it for mid-level precise and concise code where possible.\r\n//     May use it or its conventions in implementing some higher level (incl mid level) things.\r\n\r\n// Would be worth setting up and testing (maybe also benchmarking) Data_Value objects that specifically represent numbers between\r\n//  -180 and 180. Also integrating such Data_Value objects within a Data_Object or other Data_Model.\r\n// Maybe want some kind of _, $, or dm or _dm type shorthand for things that are very useful.\r\n//   Though it does make sense to abstractify things that get used a lot to make it mroe concise.\r\n//     Also worth designing and then using the concise idioms.\r\n\r\n// mfp seems like some code that could be redone / changed and parts used elsewhere to implement the mid and high level\r\n//   APIs as wanted.\r\n\r\n\r\n\r\n\r\n\r\nconst mfp = function () {\r\n\r\n\t// mfp looks complex. may need to look into what it's for and can do.\r\n\t//   Looks like an old work-in-progress.\r\n\t//     Should look into benchmarking its usage in different places.\r\n\r\n\tconst a1 = arguments;\r\n\tconst sig1 = get_a_sig(a1);\r\n\tlet options = {};\r\n\tlet fn_pre, provided_map_sig_fns, inner_map_sig_fns = {},\r\n\t\tinner_map_parsed_sigs = {},\r\n\t\tarr_sig_parsed_sig_fns = [],\r\n\t\tfn_post;\r\n\tlet tm_sig_fns;\r\n\tlet fn_default;\r\n\tlet single_fn;\r\n\tlet req_sig_single_fn;\r\n\tif (sig1 === '[o]') {\r\n\t\tprovided_map_sig_fns = a1[0];\r\n\t} else if (sig1 === '[o,o]') {\r\n\t\toptions = a1[0];\r\n\t\tprovided_map_sig_fns = a1[1];\r\n\t} else if (sig1 === '[o,f]') {\r\n\t\toptions = a1[0];\r\n\t\tsingle_fn = a1[1];\r\n\t} else if (sig1 === '[o,s,f]') {\r\n\t\toptions = a1[0];\r\n\t\treq_sig_single_fn = a1[1];\r\n\t\tsingle_fn = a1[2];\r\n\t\tprovided_map_sig_fns = {};\r\n\t\tprovided_map_sig_fns[req_sig_single_fn] = single_fn;\r\n\t} else if (sig1 === '[f,o]') {\r\n\t\tsingle_fn = a1[0];\r\n\t\toptions = a1[1];\r\n\t} else if (sig1 === '[f]') {\r\n\t\tsingle_fn = a1[0];\r\n\t} else {\r\n\t\tconsole.log('sig1', sig1);\r\n\t\tconsole.trace();\r\n\t\tthrow 'mfp NYI';\r\n\t}\r\n\tlet {\r\n\t\tsingle,\r\n\t\tname,\r\n\t\tgrammar,\r\n\t\tverb,\r\n\t\tnoun,\r\n\t\treturn_type,\r\n\t\treturn_subtype,\r\n\t\tpure,\r\n\t\tmain,\r\n\t\tskip\r\n\t} = options;\r\n\tlet parsed_grammar;\r\n\tlet identify, validate;\r\n\tlet dsig = deep_sig;\r\n\t(() => {\r\n\t\tif (provided_map_sig_fns) {\r\n\t\t\tif (provided_map_sig_fns.default) fn_default = provided_map_sig_fns.default;\r\n\t\t\teach(provided_map_sig_fns, (fn, sig) => {\r\n\t\t\t\tif (typeof fn === 'function') {\r\n\t\t\t\t\tif (!mfp_not_sigs[sig]) {\r\n\t\t\t\t\t\tconst parsed_sig = parse_sig(sig);\r\n\t\t\t\t\t\tconst arr_args_with_modifiers = [];\r\n\t\t\t\t\t\tconst arr_args_all_modification_versions = [];\r\n\t\t\t\t\t\teach(parsed_sig, (arg, i) => {\r\n\t\t\t\t\t\t\tarr_args_all_modification_versions[i] = [];\r\n\t\t\t\t\t\t\tif (arg.modifiers) {\r\n\t\t\t\t\t\t\t\tconst arg_num_modifiers = arg.modifiers.length;\r\n\t\t\t\t\t\t\t\tif (arg_num_modifiers > 1) {\r\n\t\t\t\t\t\t\t\t\tthrow 'Use of more than 1 modifier is currently unsupported.';\r\n\t\t\t\t\t\t\t\t} else if (arg_num_modifiers === 1) {\r\n\t\t\t\t\t\t\t\t\tarr_args_with_modifiers.push([i, arg]);\r\n\t\t\t\t\t\t\t\t\tconst single_modifier = arg.modifiers[0];\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '*') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '+') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '?') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconst combo_args = combinations(arr_args_all_modification_versions);\r\n\t\t\t\t\t\tconst combo_sigs = [];\r\n\t\t\t\t\t\tlet i_first_of_last_undefined = -1;\r\n\t\t\t\t\t\teach(combo_args, arg_set => {\r\n\t\t\t\t\t\t\tlet combo_sig = '';\r\n\t\t\t\t\t\t\teach(arg_set, (arg, i) => {\r\n\t\t\t\t\t\t\t\tlet lsigb4 = combo_sig.length;\r\n\t\t\t\t\t\t\t\tif (i > 0) {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + ',';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (arg === '') {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + 'u';\r\n\t\t\t\t\t\t\t\t\tif (i_first_of_last_undefined === -1) {\r\n\t\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = lsigb4;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + arg;\r\n\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = -1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tif (i_first_of_last_undefined > 0) {\r\n\t\t\t\t\t\t\t\tconst combo_sig_no_last_undefined = combo_sig.substr(0, i_first_of_last_undefined);\r\n\t\t\t\t\t\t\t\tcombo_sigs.push(combo_sig_no_last_undefined);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcombo_sigs.push(combo_sig);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (combo_sigs.length > 0) {\r\n\t\t\t\t\t\t\teach(combo_sigs, combo_sig => {\r\n\t\t\t\t\t\t\t\tinner_map_sig_fns[combo_sig] = fn;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tinner_map_sig_fns[sig] = fn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinner_map_parsed_sigs[sig] = parsed_sig;\r\n\t\t\t\t\t\tarr_sig_parsed_sig_fns.push([sig, parsed_sig, fn]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('ommiting, not parsing sig', sig);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('fn', fn);\r\n\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\tthrow 'Expected: function';\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\t\teach(inner_map_sig_fns, (fn, sig) => {\r\n\t\t\ttm_sig_fns = tm_sig_fns || {};\r\n\t\t\ttm_sig_fns[sig] = true;\r\n\t\t});\r\n\t})();\r\n\tconst res = function () {\r\n\t\tconst a2 = arguments;\r\n\t\tconst l2 = a2.length;\r\n\t\tconsole.log('');\r\n\t\tconsole.log('calling mfp function');\r\n\t\tconsole.log('--------------------');\r\n\t\tconsole.log('');\r\n\t\tlet mfp_fn_call_deep_sig;\r\n\t\tlet ltof = tof;\r\n\t\tconst lsig = dsig;\r\n\t\tlet ltf = tf;\r\n\t\tmfp_fn_call_deep_sig = lsig(a2);\r\n\t\tlet do_skip = false;\r\n\t\tif (skip) {\r\n\t\t\tif (skip(a2)) {\r\n\t\t\t\tdo_skip = true;\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\tif (!do_skip) {\r\n\t\t\tif (inner_map_sig_fns[mfp_fn_call_deep_sig]) {\r\n\t\t\t\treturn inner_map_sig_fns[mfp_fn_call_deep_sig].apply(this, a2);\r\n\t\t\t} else {\r\n\t\t\t\tlet idx_last_fn = -1;\r\n\t\t\t\tlet idx_last_obj = -1;\r\n\t\t\t\teach(a2, (arg, i_arg) => {\r\n\t\t\t\t\ti_arg = parseInt(i_arg, 10);\r\n\t\t\t\t\tconst targ = tf(arg);\r\n\t\t\t\t\tif (targ === 'o') {\r\n\t\t\t\t\t\tidx_last_obj = i_arg;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (targ === 'f') {\r\n\t\t\t\t\t\tidx_last_fn = i_arg;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tconst last_arg_is_fn = idx_last_fn > -1 && idx_last_fn === a2.length - 1;\r\n\t\t\t\tconst last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 1;\r\n\t\t\t\tconst second_last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 2;\r\n\t\t\t\tlet possible_options_obj;\r\n\t\t\t\tif (last_arg_is_obj) possible_options_obj = a2[idx_last_obj];\r\n\t\t\t\tconst new_args_arrangement = [];\r\n\t\t\t\tfor (let f = 0; f < idx_last_obj; f++) {\r\n\t\t\t\t\tnew_args_arrangement.push(a2[f]);\r\n\t\t\t\t}\r\n\t\t\t\teach(possible_options_obj, (value, key) => {\r\n\t\t\t\t\tnew_args_arrangement.push(value);\r\n\t\t\t\t});\r\n\t\t\t\tlet naa_sig = lsig(new_args_arrangement);\r\n\t\t\t\tnaa_sig = naa_sig.substring(1, naa_sig.length - 1);\r\n\t\t\t\tif (inner_map_sig_fns[naa_sig]) {\r\n\t\t\t\t\treturn inner_map_sig_fns[naa_sig].apply(this, new_args_arrangement);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (fn_default) {\r\n\t\t\t\t\t\treturn fn_default.call(this, a2, mfp_fn_call_deep_sig);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (single_fn) {\r\n\t\t\t\t\t\t\tconsole.log('pre apply single_fn');\r\n\t\t\t\t\t\t\treturn single_fn.apply(this, a2);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_parsed_sigs)', Object.keys(inner_map_parsed_sigs));\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tconsole.log('mfp_fn_call_deep_sig', mfp_fn_call_deep_sig);\r\n\t\t\t\t\t\t\tconsole.log('provided_map_sig_fns', provided_map_sig_fns);\r\n\t\t\t\t\t\t\tif (provided_map_sig_fns) log('Object.keys(provided_map_sig_fns)', Object.keys(provided_map_sig_fns));\r\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_sig_fns)', Object.keys(inner_map_sig_fns));\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tthrow 'no signature match found. consider using a default signature. mfp_fn_call_deep_sig: ' + mfp_fn_call_deep_sig;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst _ = {}\r\n\tif (name) _.name = name;\r\n\tif (single) _.single = single;\r\n\tif (skip) _.skip = skip;\r\n\tif (grammar) _.grammar = grammar;\r\n\tif (typeof options !== 'undefined' && options.async) _.async = options.async;\r\n\tif (main === true) _.main = true;\r\n\tif (return_type) _.return_type = return_type;\r\n\tif (return_subtype) _.return_subtype = return_subtype;\r\n\tif (pure) _.pure = pure;\r\n\tif (tm_sig_fns) _.map_sigs = tm_sig_fns;\r\n\tif (Object.keys(_).length > 0) {\r\n\t\tres._ = _;\r\n\t}\r\n\treturn res;\r\n}\r\nconst convert = (input, conversion_schema) => {}\r\nlet arrayify = fp(function (a, sig) {\r\n\tlet param_index, num_parallel = 1,\r\n\t\tdelay = 0,\r\n\t\tfn;\r\n\tlet res;\r\n\tlet process_as_fn = function () {\r\n\t\tres = function () {\r\n\t\t\tlet a = arr_like_to_arr(arguments),\r\n\t\t\t\tts = atof(a),\r\n\t\t\t\tt = this;\r\n\t\t\tlet last_arg = a[a.length - 1];\r\n\t\t\tif (tof(last_arg) == 'function') {\r\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tlet fns = [];\r\n\t\t\t\t\teach(a[param_index], function (v, i) {\r\n\t\t\t\t\t\tlet new_params = a.slice(0, a.length - 1);\r\n\t\t\t\t\t\tnew_params[param_index] = v;\r\n\t\t\t\t\t\tfns.push([t, fn, new_params]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcall_multiple_callback_functions(fns, num_parallel, delay, (err, res) => {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tthrow err;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet a = [];\r\n\t\t\t\t\t\t\ta = a.concat.apply(a, res);\r\n\t\t\t\t\t\t\tlet callback = last_arg;\r\n\t\t\t\t\t\t\tcallback(null, a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.apply(t, a);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tfor (let c = 0, l = a[param_index].length; c < l; c++) {\r\n\t\t\t\t\t\ta[param_index] = arguments[param_index][c];\r\n\t\t\t\t\t\tlet result = fn.apply(t, a);\r\n\t\t\t\t\t\tres.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.apply(t, a);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tif (sig == '[o]') {\r\n\t\tlet res = [];\r\n\t\teach(a[0], function (v, i) {\r\n\t\t\tres.push([v, i]);\r\n\t\t});\r\n\t} else if (sig == '[f]') {\r\n\t\tparam_index = 0, fn = a[0];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,f]') {\r\n\t\tparam_index = a[0], fn = a[1];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,n,f]') {\r\n\t\tparam_index = a[0], num_parallel = a[1], fn = a[2];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,n,n,f]') {\r\n\t\tparam_index = a[0], num_parallel = a[1], delay = a[2], fn = a[3];\r\n\t\tprocess_as_fn();\r\n\t}\r\n\treturn res;\r\n});\r\nlet mapify = (target) => {\r\n\tlet tt = tof(target);\r\n\tif (tt == 'function') {\r\n\t\tlet res = fp(function (a, sig) {\r\n\t\t\tlet that = this;\r\n\t\t\tif (sig == '[o]') {\r\n\t\t\t\tlet map = a[0];\r\n\t\t\t\teach(map, function (v, i) {\r\n\t\t\t\t\ttarget.call(that, v, i);\r\n\t\t\t\t});\r\n\t\t\t} else if (sig == '[o,f]') {\r\n\t\t\t\tlet map = a[0];\r\n\t\t\t\tlet callback = a[1];\r\n\t\t\t\tlet fns = [];\r\n\t\t\t\teach(map, function (v, i) {\r\n\t\t\t\t\tfns.push([target, [v, i]]);\r\n\t\t\t\t});\r\n\t\t\t\tcall_multi(fns, function (err_multi, res_multi) {\r\n\t\t\t\t\tif (err_multi) {\r\n\t\t\t\t\t\tcallback(err_multi);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(null, res_multi);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (a.length >= 2) {\r\n\t\t\t\ttarget.apply(this, a);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t} else if (tt == 'array') {\r\n\t\tlet res = {};\r\n\t\tif (arguments.length == 1) {\r\n\t\t\tif (is_arr_of_strs(target)) {\r\n\t\t\t\teach(target, function (v, i) {\r\n\t\t\t\t\tres[v] = true;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\teach(target, function (v, i) {\r\n\t\t\t\t\tres[v[0]] = v[1];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet by_property_name = arguments[1];\r\n\t\t\teach(target, function (v, i) {\r\n\t\t\t\tres[v[by_property_name]] = v;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n};\r\nlet clone = fp((a, sig) => {\r\n\tlet obj = a[0];\r\n\tif (a.l === 1) {\r\n\t\tif (obj && typeof obj.clone === 'function') {\r\n\t\t\treturn obj.clone();\r\n\t\t} else {\r\n\t\t\tlet t = tof(obj);\r\n\t\t\tif (t === 'array') {\r\n\t\t\t\tlet res = [];\r\n\t\t\t\teach(obj, v => {\r\n\t\t\t\t\tres.push(clone(v));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (t === 'undefined') {\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else if (t === 'string') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'number') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'function') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'boolean') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'null') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else {\r\n\t\t\t\treturn Object.assign({}, obj);\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (a.l === 2 && tof(a[1]) === 'number') {\r\n\t\tlet res = [];\r\n\t\tfor (let c = 0; c < a[1]; c++) {\r\n\t\t\tres.push(clone(obj));\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n});\r\nlet set_vals = function (obj, map) {\r\n\teach(map, function (v, i) {\r\n\t\tobj[i] = v;\r\n\t});\r\n};\r\nlet ll_set = (obj, prop_name, prop_value) => {\r\n\tlet arr = prop_name.split('.');\r\n\tlet c = 0,\r\n\t\tl = arr.length;\r\n\tlet i = obj._ || obj,\r\n\t\ts;\r\n\twhile (c < l) {\r\n\t\ts = arr[c];\r\n\t\tif (typeof i[s] == 'undefined') {\r\n\t\t\tif (c - l == -1) {\r\n\t\t\t\ti[s] = prop_value;\r\n\t\t\t} else {\r\n\t\t\t\ti[s] = {};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (c - l == -1) {\r\n\t\t\t\ti[s] = prop_value;\r\n\t\t\t}\r\n\t\t}\r\n\t\ti = i[s];\r\n\t\tc++;\r\n\t};\r\n\treturn prop_value;\r\n};\r\nlet ll_get = (a0, a1) => {\r\n\tif (a0 && a1) {\r\n\t\tlet i = a0._ || a0;\r\n\t\tif (a1 == '.') {\r\n\t\t\tif (typeof i['.'] == 'undefined') {\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else {\r\n\t\t\t\treturn i['.'];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet arr = a1.split('.');\r\n\t\t\tlet c = 0,\r\n\t\t\t\tl = arr.length,\r\n\t\t\t\ts;\r\n\t\t\twhile (c < l) {\r\n\t\t\t\ts = arr[c];\r\n\t\t\t\tif (typeof i[s] == 'undefined') {\r\n\t\t\t\t\tif (c - l == -1) {} else {\r\n\t\t\t\t\t\tthrow 'object ' + s + ' not found';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (c - l == -1) {\r\n\t\t\t\t\t\treturn i[s];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti = i[s];\r\n\t\t\t\tc++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nlet truth = function (value) {\r\n\treturn value === true;\r\n};\r\nlet iterate_ancestor_classes = (obj, callback) => {\r\n\tlet ctu = true;\r\n\tlet stop = () => {\r\n\t\tctu = false;\r\n\t}\r\n\tcallback(obj, stop);\r\n\tif (obj._superclass && ctu) {\r\n\t\titerate_ancestor_classes(obj._superclass, callback);\r\n\t}\r\n}\r\nlet is_arr_of_t = function (obj, type_name) {\r\n\tlet t = tof(obj),\r\n\t\ttv;\r\n\tif (t === 'array') {\r\n\t\tlet res = true;\r\n\t\teach(obj, function (v, i) {\r\n\t\t\ttv = tof(v);\r\n\t\t\tif (tv != type_name) res = false;\r\n\t\t});\r\n\t\treturn res;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nlet is_arr_of_arrs = function (obj) {\r\n\treturn is_arr_of_t(obj, 'array');\r\n}\r\nlet is_arr_of_strs = function (obj) {\r\n\treturn is_arr_of_t(obj, 'string');\r\n}\r\nlet input_processors = {};\r\nlet output_processors = {};\r\nlet call_multiple_callback_functions = fp(function (a, sig) {\r\n\tlet arr_functions_params_pairs, callback, return_params = false;\r\n\tlet delay;\r\n\tlet num_parallel = 1;\r\n\tif (a.l === 1) {\r\n\t} else if (a.l === 2) {\r\n\t\tarr_functions_params_pairs = a[0];\r\n\t\tcallback = a[1];\r\n\t} else if (a.l === 3) {\r\n\t\tif (sig === '[a,n,f]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tnum_parallel = a[1];\r\n\t\t\tcallback = a[2];\r\n\t\t} else if (sig === '[n,a,f]') {\r\n\t\t\tarr_functions_params_pairs = a[1];\r\n\t\t\tnum_parallel = a[0];\r\n\t\t\tcallback = a[2];\r\n\t\t} else if (sig === '[a,f,b]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tcallback = a[1];\r\n\t\t\treturn_params = a[2];\r\n\t\t}\r\n\t} else if (a.l === 4) {\r\n\t\tif (sig === '[a,n,n,f]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tnum_parallel = a[1];\r\n\t\t\tdelay = a[2];\r\n\t\t\tcallback = a[3];\r\n\t\t} else if (sig == '[n,n,a,f]') {\r\n\t\t\tarr_functions_params_pairs = a[2];\r\n\t\t\tnum_parallel = a[0];\r\n\t\t\tdelay = a[1];\r\n\t\t\tcallback = a[3];\r\n\t\t}\r\n\t}\r\n\tlet res = [];\r\n\tlet l = arr_functions_params_pairs.length;\r\n\tlet c = 0;\r\n\tlet count_unfinished = l;\r\n\tlet num_currently_executing = 0;\r\n\tlet process = delay => {\r\n\t\tnum_currently_executing++;\r\n\t\tlet main = () => {\r\n\t\t\tlet pair = arr_functions_params_pairs[c];\r\n\t\t\tlet context;\r\n\t\t\tlet fn, params, fn_callback;\r\n\t\t\tlet pair_sig = get_item_sig(pair);\r\n\t\t\tlet t_pair = tof(pair);\r\n\t\t\tif (t_pair == 'function') {\r\n\t\t\t\tfn = pair;\r\n\t\t\t\tparams = [];\r\n\t\t\t} else {\r\n\t\t\t\tif (pair) {\r\n\t\t\t\t\tif (pair.length == 1) {}\r\n\t\t\t\t\tif (pair.length == 2) {\r\n\t\t\t\t\t\tif (tof(pair[1]) == 'function') {\r\n\t\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\t\tparams = [];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfn = pair[0];\r\n\t\t\t\t\t\t\tparams = pair[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pair.length == 3) {\r\n\t\t\t\t\t\tif (tof(pair[0]) === 'function' && tof(pair[1]) === 'array' && tof(pair[2]) === 'function') {\r\n\t\t\t\t\t\t\tfn = pair[0];\r\n\t\t\t\t\t\t\tparams = pair[1];\r\n\t\t\t\t\t\t\tfn_callback = pair[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tof(pair[1]) === 'function' && tof(pair[2]) === 'array') {\r\n\t\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\t\tparams = pair[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pair.length == 4) {\r\n\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\tparams = pair[2];\r\n\t\t\t\t\t\tfn_callback = pair[3];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {}\r\n\t\t\t}\r\n\t\t\tlet i = c;\r\n\t\t\tc++;\r\n\t\t\tlet cb = (err, res2) => {\r\n\t\t\t\tnum_currently_executing--;\r\n\t\t\t\tcount_unfinished--;\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tlet stack = new Error().stack;\r\n\t\t\t\t\tcallback(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (return_params) {\r\n\t\t\t\t\t\tres[i] = [params, res2];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres[i] = res2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fn_callback) {\r\n\t\t\t\t\t\tfn_callback(null, res2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (c < l) {\r\n\t\t\t\t\t\tif (num_currently_executing < num_parallel) {\r\n\t\t\t\t\t\t\tprocess(delay);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (count_unfinished <= 0) {\r\n\t\t\t\t\t\t\tcallback(null, res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tlet arr_to_call = params || [];\r\n\t\t\tarr_to_call.push(cb);\r\n\t\t\tif (fn) {\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tfn.apply(context, arr_to_call);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfn.apply(this, arr_to_call);\r\n\t\t\t\t}\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\tif (arr_functions_params_pairs[c]) {\r\n\t\t\tif (delay) {\r\n\t\t\t\tsetTimeout(main, delay);\r\n\t\t\t} else {\r\n\t\t\t\tmain();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (arr_functions_params_pairs.length > 0) {\r\n\t\twhile ((c < l) && (num_currently_executing < num_parallel)) {\r\n\t\t\tif (delay) {\r\n\t\t\t\tprocess(delay * c);\r\n\t\t\t} else {\r\n\t\t\t\tprocess();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif (callback) {}\r\n\t}\r\n});\r\nlet multi = call_multiple_callback_functions;\r\nlet call_multi = call_multiple_callback_functions;\r\nlet Fns = function (arr) {\r\n\tlet fns = arr || [];\r\n\tfns.go = function (parallel, delay, callback) {\r\n\t\tlet a = arguments;\r\n\t\tlet al = a.length;\r\n\t\tif (al == 1) {\r\n\t\t\tcall_multi(fns, a[0]);\r\n\t\t}\r\n\t\tif (al == 2) {\r\n\t\t\tcall_multi(parallel, fns, delay);\r\n\t\t}\r\n\t\tif (al == 3) {\r\n\t\t\tcall_multi(parallel, delay, fns, callback);\r\n\t\t}\r\n\t}\r\n\treturn fns;\r\n}\r\nlet native_constructor_tof = function (value) {\r\n\tif (value === String) {\r\n\t\treturn 'String';\r\n\t}\r\n\tif (value === Number) {\r\n\t\treturn 'Number';\r\n\t}\r\n\tif (value === Boolean) {\r\n\t\treturn 'Boolean';\r\n\t}\r\n\tif (value === Array) {\r\n\t\treturn 'Array';\r\n\t}\r\n\tif (value === Object) {\r\n\t\treturn 'Object';\r\n\t}\r\n}\r\nlet sig_match = function (sig1, sig2) {\r\n\tlet sig1_inner = sig1.substr(1, sig1.length - 2);\r\n\tlet sig2_inner = sig2.substr(1, sig2.length - 2);\r\n\tif (sig1_inner.indexOf('[') > -1 || sig1_inner.indexOf(']') > -1 || sig2_inner.indexOf('[') > -1 || sig2_inner.indexOf(']') > -1) {\r\n\t\tthrow 'sig_match only supports flat signatures.';\r\n\t}\r\n\tlet sig1_parts = sig1_inner.split(',');\r\n\tlet sig2_parts = sig2_inner.split(',');\r\n\tlet res = true;\r\n\tif (sig1_parts.length == sig2_parts.length) {\r\n\t\tlet c = 0,\r\n\t\t\tl = sig1_parts.length,\r\n\t\t\ti1, i2;\r\n\t\twhile (res && c < l) {\r\n\t\t\ti1 = sig1_parts[c];\r\n\t\t\ti2 = sig2_parts[c];\r\n\t\t\tif (i1 === i2) {} else {\r\n\t\t\t\tif (i1 !== '?') {\r\n\t\t\t\t\tres = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tc++;\r\n\t\t}\r\n\t\treturn res;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nlet remove_sig_from_arr_shell = function (sig) {\r\n\tif (sig[0] == '[' && sig[sig.length - 1] == ']') {\r\n\t\treturn sig.substring(1, sig.length - 1);\r\n\t}\r\n\treturn sig;\r\n};\r\nlet str_arr_mapify = function (fn) {\r\n\tlet res = fp(function (a, sig) {\r\n\t\tif (a.l == 1) {\r\n\t\t\tif (sig == '[s]') {\r\n\t\t\t\tlet s_pn = a[0].split(' ');\r\n\t\t\t\tif (s_pn.length > 1) {\r\n\t\t\t\t\treturn res.call(this, s_pn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.call(this, a[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (tof(a[0]) == 'array') {\r\n\t\t\t\tlet res2 = {},\r\n\t\t\t\t\tthat = this;\r\n\t\t\t\teach(a[0], function (v, i) {\r\n\t\t\t\t\tres2[v] = fn.call(that, v);\r\n\t\t\t\t});\r\n\t\t\t\treturn res2;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n};\r\nlet to_arr_strip_keys = (obj) => {\r\n\tlet res = [];\r\n\teach(obj, v => {\r\n\t\tres.push(v);\r\n\t});\r\n\treturn res;\r\n}\r\nlet arr_objs_to_arr_keys_values_table = (arr_objs) => {\r\n\tlet keys = Object.keys(arr_objs[0]);\r\n\tlet arr_items = [],\r\n\t\tarr_values;\r\n\teach(arr_objs, (item) => {\r\n\t\tarr_items.push(to_arr_strip_keys(item));\r\n\t});\r\n\treturn [keys, arr_items];\r\n}\r\nlet set_arr_tree_value = (arr_tree, arr_path, value) => {\r\n\tlet item_current = arr_tree;\r\n\tlet last_item_current, last_path_item;\r\n\teach(arr_path, (path_item) => {\r\n\t\tlast_item_current = item_current;\r\n\t\titem_current = item_current[path_item];\r\n\t\tlast_path_item = path_item;\r\n\t});\r\n\tlast_item_current[last_path_item] = value;\r\n}\r\nlet get_arr_tree_value = (arr_tree, arr_path) => {\r\n\tlet item_current = arr_tree;\r\n\teach(arr_path, (path_item) => {\r\n\t\titem_current = item_current[path_item];\r\n\t});\r\n\treturn item_current;\r\n}\r\nlet deep_arr_iterate = (arr, path = [], callback) => {\r\n\tif (arguments.length === 2) {\r\n\t\tcallback = path;\r\n\t\tpath = [];\r\n\t}\r\n\teach(arr, (item, i) => {\r\n\t\tlet c_path = clone(path);\r\n\t\tc_path.push(i);\r\n\t\tlet t = tof(item);\r\n\t\tif (t === 'array') {\r\n\t\t\tdeep_arr_iterate(item, c_path, callback);\r\n\t\t} else {\r\n\t\t\tcallback(c_path, item);\r\n\t\t}\r\n\t})\r\n}\r\nlet prom = (fn) => {\r\n\tlet fn_res = function () {\r\n\t\tconst a = arguments;\r\n\t\tconst t_a_last = typeof a[a.length - 1];\r\n\t\tif (t_a_last === 'function') {\r\n\t\t\tfn.apply(this, a);\r\n\t\t} else {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t[].push.call(a, (err, res) => {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tfn.apply(this, a);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\treturn fn_res;\r\n}\r\nconst vectorify = n_fn => {\r\n\tlet fn_res = fp(function (a, sig) {\r\n\t\tif (a.l > 2) {\r\n\t\t\tthrow 'stop - need to check.'\r\n\t\t\tlet res = a[0];\r\n\t\t\tfor (let c = 1, l = a.l; c < l; c++) {\r\n\t\t\t\tres = fn_res(res, a[c]);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\tif (sig === '[n,n]') {\r\n\t\t\t\treturn n_fn(a[0], a[1]);\r\n\t\t\t} else {\r\n\t\t\t\tconst ats = atof(a);\r\n\t\t\t\tif (ats[0] === 'array') {\r\n\t\t\t\t\tif (ats[1] === 'number') {\r\n\t\t\t\t\t\tconst res = [],\r\n\t\t\t\t\t\t\tn = a[1],\r\n\t\t\t\t\t\t\tl = a[0].length\r\n\t\t\t\t\t\tlet c;\r\n\t\t\t\t\t\tfor (c = 0; c < l; c++) {\r\n\t\t\t\t\t\t\tres.push(fn_res(a[0][c], n));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t} else if (ats[1] === 'array') {\r\n\t\t\t\t\t\tif (ats[0].length !== ats[1].length) {\r\n\t\t\t\t\t\t\tthrow 'vector array lengths mismatch';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst l = a[0].length, res = new Array(l),\r\n\t\t\t\t\t\t\t\tarr2 = a[1];\r\n\t\t\t\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\t\t\t\tres[c] = fn_res(a[0][c], arr2[c]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\treturn fn_res;\r\n};\r\nconst n_add = (n1, n2) => n1 + n2,\r\n\tn_subtract = (n1, n2) => n1 - n2,\r\n\tn_multiply = (n1, n2) => n1 * n2,\r\n\tn_divide = (n1, n2) => n1 / n2;\r\nconst v_add = vectorify(n_add),\r\n\tv_subtract = vectorify(n_subtract),\r\n\tv_multiply = vectorify(n_multiply),\r\n\tv_divide = vectorify(n_divide);\r\nconst vector_magnitude = function (vector) {\r\n\t// may calculate magnitudes of larger dimension vectors too.\r\n\t// alert(tof(vector[0]));\r\n\t// alert(vector[0] ^ 2);\r\n\tvar res = Math.sqrt((Math.pow(vector[0], 2)) + (Math.pow(vector[1], 2)));\r\n\treturn res;\r\n};\r\nconst distance_between_points = function (points) {\r\n\tvar offset = v_subtract(points[1], points[0]);\r\n\t//console.log('offset ' + stringify(offset));\r\n\treturn vector_magnitude(offset);\r\n}\r\n// ui8c?\r\n//  ui8x???  for both?\r\n//  \r\n// Getting into some lower level types here.\r\n//   Consider specifying endianness for numbers.\r\n// Specify things from the basics.\r\n//   Have the descriptions make sense in English and programatically.\r\n//   Have it understand the descriptions of data types including signifiers and representations.\r\n// srtype.add_representation(...)\r\n//   .representations.add\r\n// or 'rep' function.\r\n//  rep(str_tsig_name, definition of representaion / instructions)\r\nconst map_tas_by_type = {\r\n\t'c': Uint8ClampedArray,\r\n\t'ui8': Uint8Array,\r\n\t'i16': Int16Array,\r\n\t'i32': Int32Array,\r\n\t'ui16': Uint16Array,\r\n\t'ui32': Uint32Array,\r\n\t'f32': Float32Array,\r\n\t'f64': Float64Array\r\n}\r\nconst get_typed_array = function () {\r\n\tconst a = arguments;\r\n\tlet length, input_array;\r\n\tconst type = a[0];\r\n\tif (is_array(a[1])) {\r\n\t\tinput_array = a[1];\r\n\t} else {\r\n\t\tlength = a[1];\r\n\t}\r\n\tconst ctr = map_tas_by_type[type];\r\n\tif (ctr) {\r\n\t\tif (input_array) {\r\n\t\t\treturn new ctr(input_array);\r\n\t\t} else if (length) {\r\n\t\t\treturn new ctr(length);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Grammar class may be a bit tricky / complex.\r\n//   Maybe it will help because it can be used to define objects easily???\r\n//   Maybe need to get into much more detail??? Maybe a quick and efficient piece of grammar code could work here.\r\n\r\nclass Grammar {\r\n\tconstructor(spec) {\r\n\t\tconst eg_spec = {\r\n\t\t\tname: 'User Auth Grammar'\r\n\t\t}\r\n\t\tconst {\r\n\t\t\tname\r\n\t\t} = spec;\r\n\t\tthis.name = name;\r\n\t\tconst eg_indexing = () => {\r\n\t\t\tlet map_sing_plur = {};\r\n\t\t\tlet map_plur_sing = {};\r\n\t\t\tlet map_sing_def = {};\r\n\t\t\tlet map_sig_sing = {};\r\n\t\t\tlet map_sig0_sing = {};\r\n\t\t\tlet map_sig1_sing = {};\r\n\t\t\tlet map_sig2_sing = {};\r\n\t\t}\r\n\t\tthis.maps = {\r\n\t\t\tsing_plur: {},\r\n\t\t\tplur_sing: {},\r\n\t\t\tsing_def: {},\r\n\t\t\tdeep_sig_sing: {},\r\n\t\t\tobj_sig_sing: {},\r\n\t\t\tsig_levels_sing: {}\r\n\t\t}\r\n\t\tthis.load_grammar(spec.def);\r\n\t}\r\n\tload_grammar(grammar_def) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst resolve_def = (def) => {\r\n\t\t\tconst td = tf(def);\r\n\t\t\tif (td === 'a') {\r\n\t\t\t\tconst res = [];\r\n\t\t\t\teach(def, def_item => {\r\n\t\t\t\t\tres.push(resolve_def(def_item));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (td === 's') {\r\n\t\t\t\tif (def === 'string') {\r\n\t\t\t\t\treturn 'string';\r\n\t\t\t\t} else if (def === 'number') {\r\n\t\t\t\t\treturn 'number';\r\n\t\t\t\t} else if (def === 'boolean') {\r\n\t\t\t\t\treturn 'boolean';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst found_sing_def = sing_def[def];\r\n\t\t\t\t\treturn found_sing_def;\r\n\t\t\t\t}\r\n\t\t\t} else if (td === 'n') {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t} else if (td === 'b') {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst resolved_def_to_sig = (resolved_def, level = 0) => {\r\n\t\t\tconst trd = tf(resolved_def);\r\n\t\t\tif (trd === 's') {\r\n\t\t\t\tif (resolved_def === 'string') {\r\n\t\t\t\t\treturn 's'\r\n\t\t\t\t} else if (resolved_def === 'number') {\r\n\t\t\t\t\treturn 'n'\r\n\t\t\t\t} else if (resolved_def === 'boolean') {\r\n\t\t\t\t\treturn 'b'\r\n\t\t\t\t}\r\n\t\t\t} else if (trd === 'a') {\r\n\t\t\t\tlet res = '';\r\n\t\t\t\tif (level === 0) {} else {\r\n\t\t\t\t\tres = res + '[';\r\n\t\t\t\t}\r\n\t\t\t\teach(resolved_def, (item, c) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tres = res + resolved_def_to_sig(item, level + 1);\r\n\t\t\t\t});\r\n\t\t\t\tif (level === 0) {} else {\r\n\t\t\t\t\tres = res + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\teach(grammar_def, (def1, sing_word) => {\r\n\t\t\tconst {\r\n\t\t\t\tdef,\r\n\t\t\t\tplural\r\n\t\t\t} = def1;\r\n\t\t\tsing_def[sing_word] = def;\r\n\t\t\tsing_plur[sing_word] = plural;\r\n\t\t\tplur_sing[plural] = sing_word;\r\n\t\t\tconst tdef = tf(def);\r\n\t\t\tconst resolved_def = resolve_def(def);\r\n\t\t\tconst resolved_def_sig = resolved_def_to_sig(resolved_def);\r\n\t\t\tdeep_sig_sing[resolved_def_sig] = deep_sig_sing[resolved_def_sig] || [];\r\n\t\t\tdeep_sig_sing[resolved_def_sig].push(sing_word);\r\n\t\t\tlet def_is_all_custom_types = true;\r\n\t\t\teach(def, (def_item, c, stop) => {\r\n\t\t\t\tconst tdi = tf(def_item);\r\n\t\t\t\tif (tdi === 's') {\r\n\t\t\t\t\tif (sing_def[def_item]) {} else {\r\n\t\t\t\t\t\tdef_is_all_custom_types = false;\r\n\t\t\t\t\t\tstop();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdef_is_all_custom_types = false;\r\n\t\t\t\t\tstop();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tlet obj_sig;\r\n\t\t\tif (def_is_all_custom_types) {\r\n\t\t\t\tobj_sig = '{';\r\n\t\t\t\teach(def, (def_item, c, stop) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tobj_sig = obj_sig + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst resolved = resolve_def(def_item);\r\n\t\t\t\t\tconst abr_resolved = resolved_def_to_sig(resolved);\r\n\t\t\t\t\tobj_sig = obj_sig + '\"' + def_item + '\":'\r\n\t\t\t\t\tobj_sig = obj_sig + abr_resolved;\r\n\t\t\t\t});\r\n\t\t\t\tobj_sig = obj_sig + '}';\r\n\t\t\t}\r\n\t\t\tif (obj_sig) {\r\n\t\t\t\tobj_sig_sing[obj_sig] = obj_sig_sing[obj_sig] || [];\r\n\t\t\t\tobj_sig_sing[obj_sig].push(sing_word);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\ttof(item) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst titem = tf(item);\r\n\t\tconsole.log('titem', titem);\r\n\t\tif (titem === 'a') {\r\n\t\t\tlet all_arr_items_type;\r\n\t\t\teach(item, (subitem, c, stop) => {\r\n\t\t\t\tconst subitem_type = this.tof(subitem);\r\n\t\t\t\tconsole.log('subitem_type', subitem_type);\r\n\t\t\t\tif (c === 0) {\r\n\t\t\t\t\tall_arr_items_type = subitem_type;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (all_arr_items_type === subitem_type) {} else {\r\n\t\t\t\t\t\tall_arr_items_type = null;\r\n\t\t\t\t\t\tstop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (all_arr_items_type) {\r\n\t\t\t\tconsole.log('has all_arr_items_type', all_arr_items_type);\r\n\t\t\t\tif (!map_native_types[all_arr_items_type]) {\r\n\t\t\t\t\tconst res = sing_plur[all_arr_items_type];\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('no all_arr_items_type');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn tof(item);\r\n\t\t}\r\n\t\tconst item_deep_sig = deep_sig(item);\r\n\t\tconsole.log('Grammar tof() item_deep_sig', item_deep_sig);\r\n\t\tlet arr_sing;\r\n\t\tif (titem === 'a') {\r\n\t\t\tconst unenclosed_sig = item_deep_sig.substring(1, item_deep_sig.length - 1);\r\n\t\t\tconsole.log('unenclosed_sig', unenclosed_sig);\r\n\t\t\tarr_sing = deep_sig_sing[unenclosed_sig];\r\n\t\t} else {\r\n\t\t\tarr_sing = deep_sig_sing[item_deep_sig];\r\n\t\t}\r\n\t\tif (arr_sing) {\r\n\t\t\tif (arr_sing.length === 1) {\r\n\t\t\t\treturn arr_sing[0];\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsig(item, max_depth = -1, depth = 0) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst extended_sig = item => {\r\n\t\t\tconst ti = tf(item);\r\n\t\t\tlet res = '';\r\n\t\t\tlet same_grammar_type;\r\n\t\t\tconst record_subitem_sigs = item => {\r\n\t\t\t\tsame_grammar_type = undefined;\r\n\t\t\t\tlet same_sig = undefined;\r\n\t\t\t\teach(item, (subitem, c) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst sig_subitem = this.sig(subitem, max_depth, depth + 1);\r\n\t\t\t\t\tif (same_sig === undefined) {\r\n\t\t\t\t\t\tsame_sig = sig_subitem;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (sig_subitem !== same_sig) {\r\n\t\t\t\t\t\t\tsame_sig = false;\r\n\t\t\t\t\t\t\tsame_grammar_type = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (same_sig) {\r\n\t\t\t\t\t\tif (sing_def[sig_subitem]) {\r\n\t\t\t\t\t\t\tif (same_grammar_type === undefined) {\r\n\t\t\t\t\t\t\t\tsame_grammar_type = sig_subitem;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (same_grammar_type === sig_subitem) {} else {\r\n\t\t\t\t\t\t\t\t\tsame_grammar_type = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tres = res + sig_subitem;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (ti === 'A') {\r\n\t\t\t\trecord_subitem_sigs(item);\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (ti === 'a') {\r\n\t\t\t\trecord_subitem_sigs(item);\r\n\t\t\t\tif (same_grammar_type) {\r\n\t\t\t\t\tconst plur_name = sing_plur[same_grammar_type];\r\n\t\t\t\t\treturn plur_name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst found_obj_type = obj_sig_sing[res];\r\n\t\t\t\t\tconst found_deep_sig_type = deep_sig_sing[res];\r\n\t\t\t\t\tlet found_type_sing;\r\n\t\t\t\t\tif (found_deep_sig_type) {\r\n\t\t\t\t\t\tif (found_deep_sig_type.length === 1) {\r\n\t\t\t\t\t\t\tfound_type_sing = found_deep_sig_type[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (found_type_sing) {\r\n\t\t\t\t\t\treturn found_type_sing;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst enclosed_res = '[' + res + ']';\r\n\t\t\t\t\t\treturn enclosed_res;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (ti === 'o') {\r\n\t\t\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\t\t\tres = res + '{';\r\n\t\t\t\t\tlet first = true;\r\n\t\t\t\t\teach(item, (value, key) => {\r\n\t\t\t\t\t\tconst vsig = this.sig(value, max_depth, depth + 1);\r\n\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfirst = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tres = res + '\"' + key + '\":' + vsig;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tres = res + '}';\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 'o';\r\n\t\t\t\t}\r\n\t\t\t} else if (ti === 's' || ti === 'n' || ti === 'b') {\r\n\t\t\t\treturn ti;\r\n\t\t\t} else {\r\n\t\t\t\treturn ti;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn extended_sig(item);\r\n\t}\r\n\tsingle_forms_sig(item) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tlet sig = this.sig(item);\r\n\t\tlet s_sig = sig.split(',');\r\n\t\tconst arr_res = [];\r\n\t\teach(s_sig, (sig_item, c) => {\r\n\t\t\tconst sing = plur_sing[sig_item] || sig_item;\r\n\t\t\tarr_res.push(sing);\r\n\t\t});\r\n\t\tconst res = arr_res.join(',');\r\n\t\treturn res;\r\n\t}\r\n}\r\nclass Evented_Class {\r\n\t'constructor'() {\r\n\t\tObject.defineProperty(this, '_bound_events', {\r\n\t\t\tvalue: {}\r\n\t\t});\r\n\t}\r\n\t'raise_event'() {\r\n\t\tlet a = Array.prototype.slice.call(arguments),\r\n\t\t\tsig = get_a_sig(a);\r\n\t\ta.l = a.length;\r\n\t\tlet target = this;\r\n\t\tlet c, l, res;\r\n\t\tif (sig === '[s]') {\r\n\t\t\tlet target = this;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) == 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,a]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,b]' || sig === '[s,s]' || sig === '[s,n]' || sig === '[s,B]' || sig === '[s,O]' || sig === '[s,e]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,o]' || sig === '[s,?]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (a.l > 2) {\r\n\t\t\t\tlet event_name = a[0];\r\n\t\t\t\tlet additional_args = [];\r\n\t\t\t\tlet bgh_args = [event_name];\r\n\t\t\t\tfor (c = 1, l = a.l; c < l; c++) {\r\n\t\t\t\t\tadditional_args.push(a[c]);\r\n\t\t\t\t\tbgh_args.push(a[c]);\r\n\t\t\t\t}\r\n\t\t\t\tlet be = this._bound_events;\r\n\t\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\t\tres = [];\r\n\t\t\t\tif (bgh) {\r\n\t\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bgh[c].apply(target, bgh_args));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (be) {\r\n\t\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\t\tif (tof(bei) == 'array') {\r\n\t\t\t\t\t\tif (bei.length > 0) {\r\n\t\t\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\t\t\tif (bei[c]) res.push(bei[c].apply(target, additional_args));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'add_event_listener'() {\r\n\t\tconst {\r\n\t\t\tevent_events\r\n\t\t} = this;\r\n\t\tlet a = Array.prototype.slice.call(arguments),\r\n\t\t\tsig = get_a_sig(a);\r\n\t\tif (sig === '[f]') {\r\n\t\t\tthis._bound_general_handler = this._bound_general_handler || [];\r\n\t\t\tif (is_array(this._bound_general_handler)) {\r\n\t\t\t\tthis._bound_general_handler.push(a[0]);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (sig === '[s,f]') {\r\n\t\t\tlet event_name = a[0],\r\n\t\t\t\tfn_listener = a[1];\r\n\t\t\tif (!this._bound_events[event_name]) this._bound_events[event_name] = [];\r\n\t\t\tlet bei = this._bound_events[event_name];\r\n\t\t\tif (is_array(bei)) {\r\n\t\t\t\tbei.push(fn_listener);\r\n\t\t\t\tif (event_events) {\r\n\t\t\t\t\tthis.raise('add-event-listener', {\r\n\t\t\t\t\t\t'name': event_name\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'Expected: array';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t'remove_event_listener'(event_name, fn_listener) {\r\n\t\tconst {\r\n\t\t\tevent_events\r\n\t\t} = this;\r\n\t\tif (this._bound_events) {\r\n\t\t\tlet bei = this._bound_events[event_name] || [];\r\n\t\t\tif (is_array(bei)) {\r\n\t\t\t\tlet c = 0,\r\n\t\t\t\t\tl = bei.length,\r\n\t\t\t\t\tfound = false;\r\n\t\t\t\twhile (!found && c < l) {\r\n\t\t\t\t\tif (bei[c] === fn_listener) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (found) {\r\n\t\t\t\t\tbei.splice(c, 1);\r\n\t\t\t\t\tif (event_events) {\r\n\t\t\t\t\t\tthis.raise('remove-event-listener', {\r\n\t\t\t\t\t\t\t'name': event_name\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'Expected: array';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tget bound_named_event_counts() {\r\n\t\tconst res = {};\r\n\t\tif (this._bound_events) {\r\n\t\t\tconst keys = Object.keys(this._bound_events);\r\n\t\t\teach(keys, key => {\r\n\t\t\t\tres[key] = this._bound_events[key].length;\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'one'(event_name, fn_handler) {\r\n\t\tlet inner_handler = function (e) {\r\n\t\t\tfn_handler.call(this, e);\r\n\t\t\tthis.off(event_name, inner_handler);\r\n\t\t};\r\n\t\tthis.on(event_name, inner_handler);\r\n\t}\r\n\t'changes'(obj_changes) {\r\n\t\tif (!this.map_changes) {\r\n\t\t\tthis.map_changes = {};\r\n\t\t}\r\n\t\teach(obj_changes, (handler, name) => {\r\n\t\t\tthis.map_changes[name] = this.map_changes[name] || [];\r\n\t\t\tthis.map_changes[name].push(handler);\r\n\t\t})\r\n\t\tif (!this._using_changes) {\r\n\t\t\tthis._using_changes = true;\r\n\t\t\tthis.on('change', e_change => {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tvalue\r\n\t\t\t\t} = e_change;\r\n\t\t\t\tif (this.map_changes[name]) {\r\n\t\t\t\t\teach(this.map_changes[name], h_change => {\r\n\t\t\t\t\t\th_change(value);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n};\r\nconst p = Evented_Class.prototype;\r\np.raise = p.raise_event;\r\np.trigger = p.raise_event;\r\np.subscribe = p.add_event_listener;\r\np.on = p.add_event_listener;\r\np.off = p.remove_event_listener;\r\nconst eventify = obj => {\r\n\tconst bound_events = {};\r\n\tconst add_event_listener = (name, handler) => {\r\n\t\tif (handler === undefined && typeof name === 'function') {\r\n\t\t\thandler = name;\r\n\t\t\tname = '';\r\n\t\t}\r\n\t\tif (!bound_events[name]) bound_events[name] = [];\r\n\t\tbound_events[name].push(handler);\r\n\t}\r\n\tconst remove_event_listener = (name, handler) => {\r\n\t\tif (bound_events[name]) {\r\n\t\t\tconst i = bound_events[name].indexOf(handler);\r\n\t\t\tif (i > -1) {\r\n\t\t\t\tbound_events[name].splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst raise_event = (name, optional_param) => {\r\n\t\tconst arr_named_events = bound_events[name];\r\n\t\tif (arr_named_events !== undefined) {\r\n\t\t\tif (optional_param !== undefined) {\r\n\t\t\t\tconst l = arr_named_events.length;\r\n\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\tarr_named_events[c].call(obj, optional_param);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst l = arr_named_events.length;\r\n\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\tarr_named_events[c].call(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tobj.on = obj.add_event_listener = add_event_listener;\r\n\tobj.off = obj.remove_event_listener = remove_event_listener;\r\n\tobj.raise = obj.raise_event = raise_event;\r\n\treturn obj;\r\n}\r\n\r\n// Assign_From_Spec_Class\r\n\r\n\r\n// Assign_From_Spec_Evented_Class\r\n\r\n\r\n\r\n\r\nclass Publisher extends Evented_Class {\r\n\tconstructor(spec = {}) {\r\n\t\tsuper({});\r\n\t\tthis.one('ready', () => {\r\n\t\t\tthis.is_ready = true;\r\n\t\t})\r\n\t}\r\n\tget when_ready () {\r\n\t\treturn new Promise((solve, jettison) => {\r\n\t\t\tif (this.is_ready === true) {\r\n\t\t\t\tsolve();\r\n\t\t\t} else {\r\n\t\t\t\tthis.one('ready', () => {\r\n\t\t\t\t\tsolve();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\nconst prop = (...a) => {\r\n\r\n\t// Using (predefined?) data types here?\r\n\r\n\t// ...args?\r\n\tlet s = get_a_sig(a);\r\n\tconst raise_change_events = true;\r\n\tconst ifn = item => typeof item === \"function\";\r\n\r\n\tif (s === \"[a]\") {\r\n\t\teach(a[0], item_params => {\r\n\t\t\tprop.apply(this, item_params);\r\n\t\t});\r\n\t} else {\r\n\t\tif (a.length === 2) {\r\n\t\t\tif (ia(a[1])) {\r\n\t\t\t\tconst target = a[0];\r\n\t\t\t\teach(a[1], item => {\r\n\t\t\t\t\tif (ia(item)) {\r\n\t\t\t\t\t\tthrow \"NYI 468732\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprop(target, item);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconst ta1 = tof(a[1]);\r\n\t\t\t\tif (ta1 === \"string\") {\r\n\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow \"NYI 468732b\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (a.length > 2) {\r\n\t\t\tif (is_array(a[0])) {\r\n\t\t\t\t// the rest of the properties applied to the array of items.\r\n\t\t\t\tthrow \"stop\";\r\n\t\t\t\tlet objs = a.shift();\r\n\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\tprop.apply(this, [obj].concat(item_params)); // bug\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tlet obj, prop_name, default_value, fn_onchange, fn_transform, fn_on_ready, options;\r\n\t\t\t\tconst load_options = options => {\r\n\t\t\t\t\tprop_name = prop_name || options.name || options.prop_name;\r\n\t\t\t\t\tfn_onchange =\r\n\t\t\t\t\t\toptions.fn_onchange || options.onchange || options.change;\r\n\t\t\t\t\tfn_transform =\r\n\t\t\t\t\t\toptions.fn_transform || options.ontransform || options.transform;\r\n\t\t\t\t\tfn_on_ready = options.ready || options.on_ready;\r\n\t\t\t\t\tdefault_value = default_value || options.default_value || options.default;\r\n\t\t\t\t};\r\n\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t[obj, options] = a;\r\n\t\t\t\t\tload_options(options);\r\n\t\t\t\t} else if (a.length === 3) {\r\n\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t[obj, prop_name, fn_onchange] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (a[2].change || a[2].ready) {\r\n\t\t\t\t\t\t\tload_options(a[2]);\r\n\r\n\t\t\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t} else if (a.length === 4) {\r\n\t\t\t\t\tif (ifn(a[2]) && ifn(a[3])) {\r\n\t\t\t\t\t\t[obj, prop_name, fn_transform, fn_onchange] = a;\r\n\t\t\t\t\t} else if (ifn(a[3])) {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_onchange] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, options] = a;\r\n\t\t\t\t\t\tload_options(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (a.length === 5) {\r\n\t\t\t\t\t[obj, prop_name, default_value, fn_transform, fn_onchange] = a;\r\n\t\t\t\t}\r\n\t\t\t\tlet _prop_value;\r\n\r\n\t\t\t\tif (typeof default_value !== 'undefined') _prop_value = default_value;\r\n\t\t\t\t// And a silent set function that does not raise the change event.\r\n\t\t\t\tconst _silent_set = value => {\r\n\t\t\t\t\tlet _value;\r\n\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t}\r\n\t\t\t\tconst _set = value => {\r\n\t\t\t\t\tlet _value;\r\n\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet old = _prop_value;\r\n\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t\tif (fn_onchange) {\r\n\t\t\t\t\t\tfn_onchange({\r\n\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (obj.raise && raise_change_events) {\r\n\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tif (is_defined(default_value)) {\r\n\t\t\t\t\t_prop_value = default_value;\r\n\t\t\t\t}\r\n\t\t\t\tconst t_prop_name = tf(prop_name);\r\n\t\t\t\tif (t_prop_name === 's') {\r\n\r\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t} else if (t_prop_name === 'a') {\r\n\t\t\t\t\tconst l = prop_name.length;\r\n\t\t\t\t\t//console.log('prop_name', prop_name);\r\n\t\t\t\t\tlet item_prop_name;\r\n\t\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\t\titem_prop_name = prop_name[c];\r\n\t\t\t\t\t\t//console.log('item_prop_name', item_prop_name);\r\n\t\t\t\t\t\tObject.defineProperty(obj, item_prop_name, {\r\n\t\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow 'Unexpected name type: ' + t_prop_name;\r\n\t\t\t\t}\r\n\t\t\t\tif (fn_on_ready) {\r\n\t\t\t\t\tfn_on_ready({\r\n\t\t\t\t\t\tsilent_set: _silent_set\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\r\nclass Data_Type {\r\n\r\n}\r\n\r\nclass Functional_Data_Type extends Data_Type {\r\n    constructor(spec) {\r\n\r\n\t\t/*\r\n\t\tnamed_property_access: true,\r\n\t\tproperty_names: ['latitude', 'longitude'],\r\n\t\t// And the property types as well being the same in this case?\r\n\t\tabbreviated_property_names: ['lat', 'long'],\r\n\t\tnumbered_property_access: true, // Maybe that's good enough to make it like an array when there are 2 properties.\r\n\r\n\t\t*/\r\n        \r\n        // fns for: validate as exact type...?\r\n        // convert from whatever it is to that exact type (if possible)\r\n        //   string and binary conversions.\r\n        //   eg a convert_load type operation.\r\n\r\n        // it's super / parent type.\r\n        super(spec);\r\n\r\n        if (spec.supertype) this.supertype = spec.supertype;\r\n        if (spec.name) this.name = spec.name;\r\n        if (spec.abbreviated_name) this.abbreviated_name = spec.abbreviated_name;\r\n\t\tif (spec.named_property_access) this.named_property_access = spec.named_property_access;\r\n\t\tif (spec.numbered_property_access) this.numbered_property_access = spec.numbered_property_access;\r\n\t\tif (spec.property_names) this.property_names = spec.property_names;\r\n\t\tif (spec.property_data_types) this.property_data_types = spec.property_data_types;\r\n\t\tif (spec.wrap_properties) this.wrap_properties = spec.wrap_properties;\r\n\t\tif (spec.wrap_value_inner_values) this.wrap_value_inner_values = spec.wrap_value_inner_values;\r\n\t\tif (spec.value_js_type) this.value_js_type = spec.value_js_type;\r\n\t\t// value_js_type\r\n\r\n\t\t// wrap_value as well????\r\n\t\t//   Though the value kind-of is itself.\r\n\t\t//    maybe .inner_js_value is much clearer here?\r\n\t\t// wrap_value_inner_values\r\n\r\n\r\n\r\n\t\tif (spec.abbreviated_property_names) this.abbreviated_property_names = spec.abbreviated_property_names;\r\n        if (spec.validate) this.validate = spec.validate;\r\n        if (spec.validate_explain) this.validate_explain = spec.validate_explain;\r\n\t\tif (spec.parse_string) this.parse_string = spec.parse_string;\r\n\t\tif (spec.parse) this.parse = spec.parse;\r\n\r\n\t\t// But also want it to be able to accept undefined value (usually???)\r\n\r\n\r\n\r\n\r\n        // and abbreviated name\r\n        // spec.validate (needs to be perfect...)\r\n\r\n        // spec.load_from(...?)\r\n        // spec.poly_load??\r\n\r\n        // spec.input transformers???\r\n        //   transform from other identified types...?\r\n\r\n        // For the moment, we don't want too many and too complex functions.\r\n\r\n    }\r\n}\r\n\r\n//lang.Data_Type = Data_Type;\r\n//lang.Functional_Data_Type = Functional_Data_Type;\r\n\r\n\r\n\r\n// And let's define some....\r\n\r\n// And a correct value...?\r\n//   Eg if a number is not valid because it has too many decimal points, it could be corrected.\r\n//     Or even an int that's too large, outside a range, corrected to fit in that range.\r\n\r\n// So making a Data_Value stick to using these Data_Types could be helpful.\r\n\r\n// For the moment this is really simple and should work fine for some things.\r\n\r\n// Allow undefined????\r\n//   Or better to have that on a different level.\r\n//     Maybe does make sense as an option here.\r\n\r\n//     Or consider it and do it later.\r\n\r\n\r\nFunctional_Data_Type.number = new Functional_Data_Type({\r\n    name: 'number',\r\n    abbreviated_name: 'n',\r\n    validate: x => {\r\n        return !isNaN(x);\r\n    },\r\n\tparse_string(str) {\r\n\t\tconst p = parseFloat(str);\r\n\t\t// then is it a number???\r\n\r\n\t\t// then is its string the same....?\r\n\t\tif (p + '' === str) {\r\n\t\t\tconst parsed_is_valid = this.validate(p);\r\n\t\t\tif (parsed_is_valid) {\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n});\r\n\r\nFunctional_Data_Type.integer = new Functional_Data_Type({\r\n    name: 'integer',\r\n    abbreviated_name: 'int',\r\n    validate: x => {\r\n        return Number.isInteger(x);\r\n    },\r\n    parse_string(str) {\r\n        const p = parseInt(str, 10);\r\n        if (!isNaN(p) && p.toString() === str) {\r\n            return p;\r\n        }\r\n        return undefined;\r\n    }\r\n});\r\n\r\n// Need fdts for things like a [lat, long] array.\r\n//   Maybe see about making it (easily) from composite data types.\r\n//     Pair(Lat, Long) or similar\r\n//     Maybe want it defined in a few lines of string grammar if it's easy.\r\n//       Would make for a simple API - but would require parsing a custom language.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Would be worth getting into creating conventions and idioms for higher level code.\r\n//   Though first getting data type systems working right would help.\r\n//     Making them easy to use.\r\n\r\nconst field = (...a) => {\r\n\r\n\t// Will also want to set data types of fields....\r\n\r\n\t// Uses obj._\r\n\t//   Seems quite simple, powerful, flexible.\r\n\t//     However, would like a different way of doing it too, could use a local variable defined within the 'field' function.\r\n\r\n\t// Want to incorporate data types, maybe grammar too.\r\n\r\n\t// Could use fp for this as well????\r\n\t//   See about really concise function definitions.\r\n\r\n\t//  Also want to see about some benchmarks too.\r\n\t//    Eg rendering a large page server side 10 times.\r\n\r\n\tconst raise_change_events = true;\r\n\r\n\tconst ifn = item => typeof item === \"function\";\r\n\r\n\tlet s = get_a_sig(a);\r\n\tif (s === \"[a]\") {\r\n\t\t// prop????\r\n\t\teach(a[0], item_params => {\r\n\t\t\tprop.apply(this, item_params);\r\n\t\t});\r\n\t} else {\r\n\t\tif (a.length > 1) {\r\n\t\t\tif (is_array(a[0])) {\r\n\r\n\t\t\t\tthrow 'stop - need to fix';\r\n\t\t\t\t// the rest of the properties applied to the array of items.\r\n\r\n\t\t\t\t// But field.apply here...???\r\n\t\t\t\tlet objs = a.shift();\r\n\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\tfield.apply(this, [obj].concat(item_params));\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Maybe will have a Data_Type....\r\n\r\n\t\t\t\tlet obj, prop_name, data_type, default_value, fn_transform;\r\n\t\t\t\t//let raise_change_events = opts.raise_change_events;\r\n\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t} else if (a.length === 3) {\r\n\r\n\t\t\t\t\t// And also check a[2] for being a Data_Type.\r\n\r\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\r\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, fn_transform] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t} else if (a.length === 4) {\r\n\r\n\t\t\t\t\t// field(this, 'value', this.data_type, spec.value);\r\n\r\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\r\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (obj !== undefined) {\r\n\r\n\t\t\t\t\t// Setting with a data_model or data_value ????\r\n\r\n\r\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\tif (is_defined(obj._)) {\r\n\t\t\t\t\t\t\t\treturn obj._[prop_name];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//return _prop_value;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t//console.log('setting prop: ' + prop_name);\r\n\r\n\t\t\t\t\t\t\t// Get an immutable copy of it???\r\n\r\n\t\t\t\t\t\t\tlet old = (obj._ = obj._ || {})[prop_name];\r\n\r\n\t\t\t\t\t\t\t// Want better tof that can deal with Data_Model, Data_Value\r\n\t\t\t\t\t\t\t// Maybe Data_String, Data_Array, Data_Object, Data_Number???\r\n\r\n\t\t\t\t\t\t\t// Could make some more specifically typed ones....\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t// value must be an array of length 2.\r\n\r\n\t\t\t\t\t\t\t// And what's the typeof value???\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t// Upgrade the field set procedure.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\tif (old !== value) {\r\n\r\n\t\t\t\t\t\t\t\tlet is_valid = true;\r\n\t\t\t\t\t\t\t\tif (data_type) {\r\n\r\n\t\t\t\t\t\t\t\t\tconst t_value = typeof value;\r\n\r\n\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(value);\r\n\r\n\t\t\t\t\t\t\t\t\t// if not valid directly, can we parse it from a string???\r\n\r\n\t\t\t\t\t\t\t\t\tif (t_value === 'string') {\r\n\t\t\t\t\t\t\t\t\t\tconst parsed_value = data_type.parse_string(value);\r\n\t\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(parsed_value);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (is_valid) value = parsed_value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log('t_value', t_value);\r\n\r\n\t\t\t\t\t\t\t\t\t// but also some type of stringifying the value....\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (is_valid) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet _value;\r\n\t\t\t\t\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t\t\t\t\t//try {\r\n\t\t\t\t\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t\t\t\t\t\t//} catch (err) {\r\n\t\t\t\t\t\t\t\t\t\t//    throw err;\r\n\t\t\t\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\r\n\t\r\n\t\r\n\t\t\t\t\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tobj._[prop_name] = _value;\r\n\t\t\t\t\t\t\t\t\tif (raise_change_events) {\r\n\t\t\t\t\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: _value\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t//console.log('old === value');\r\n\t\t\t\t\t\t\t\t//console.log('old', old);\r\n\t\t\t\t\t\t\t\t//console.log('value', value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (is_defined(default_value)) {\r\n\t\t\t\t\t\tlet is_valid = true;\r\n\t\t\t\t\t\tif (data_type) {\r\n\t\t\t\t\t\t\tis_valid = data_type.validate(default_value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (is_valid) {\r\n\t\t\t\t\t\t\t(obj._ = obj._ || {})[prop_name] = default_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow 'stop';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\r\n// Probably need an 'equals' function.\r\n//   Would make use of .equals and .hash functions / properties when available.\r\n\r\n// Though Data_Value.toString and toJSON may be most useful sooner...\r\n\r\n// lang-tools should have the equals function that supports Data_Value (maybe Data_Model in general).\r\n\r\nconst lang_mini_props = {\r\n\teach,\r\n\tis_array,\r\n\tis_dom_node,\r\n\tis_ctrl,\r\n\tclone,\r\n\tget_truth_map_from_arr,\r\n\ttm: get_truth_map_from_arr,\r\n\tget_arr_from_truth_map,\r\n\tarr_trim_undefined,\r\n\tget_map_from_arr,\r\n\tarr_like_to_arr,\r\n\ttof,\r\n\tatof,\r\n\ttf,\r\n\tload_type,\r\n\tis_defined,\r\n\tdef: is_defined,\r\n\tGrammar,\r\n\tstringify,\r\n\tfunctional_polymorphism,\r\n\tfp,\r\n\tmfp,\r\n\tarrayify,\r\n\tmapify,\r\n\tstr_arr_mapify,\r\n\tget_a_sig,\r\n\tdeep_sig,\r\n\tget_item_sig,\r\n\tset_vals,\r\n\ttruth,\r\n\ttrim_sig_brackets,\r\n\tll_set,\r\n\tll_get,\r\n\titerate_ancestor_classes,\r\n\tis_arr_of_t,\r\n\tis_arr_of_arrs,\r\n\tis_arr_of_strs,\r\n\tinput_processors,\r\n\toutput_processors,\r\n\tcall_multiple_callback_functions,\r\n\tcall_multi,\r\n\tmulti: call_multi,\r\n\tnative_constructor_tof,\r\n\tFns,\r\n\tsig_match,\r\n\tremove_sig_from_arr_shell,\r\n\tto_arr_strip_keys,\r\n\tarr_objs_to_arr_keys_values_table,\r\n\tset_arr_tree_value,\r\n\tget_arr_tree_value,\r\n\tdeep_arr_iterate,\r\n\tprom,\r\n\tcombinations,\r\n\tcombos: combinations,\r\n\tEvented_Class,\r\n\teventify,\r\n\tvectorify,\r\n\tv_add,\r\n\tv_subtract,\r\n\tv_multiply,\r\n\tv_divide,\r\n\tvector_magnitude,\r\n\tdistance_between_points,\r\n\tget_typed_array,\r\n\tgta: get_typed_array,\r\n\tPublisher,\r\n\tfield,\r\n\tprop,\r\n\tData_Type,\r\n\tFunctional_Data_Type\r\n};\r\n\r\nconst lang_mini = new Evented_Class();\r\nObject.assign(lang_mini, lang_mini_props);\r\nlang_mini.note = (str_name, str_state, obj_properties) => {\r\n\tobj_properties = obj_properties || {};\r\n\tobj_properties.name = str_name;\r\n\tobj_properties.state = str_state;\r\n\tlang_mini.raise('note', obj_properties)\r\n}\r\nmodule.exports = lang_mini;\r\n\r\n// Bring in grammar / compound types to this typedef type thing.\r\n//   Types in the fields. \r\n\r\n// Detecting invalid view model states.\r\n//   Validating according to the spec of the data basically.\r\n\r\n// Defining data types and models with a gui....\r\n\r\n\r\n\r\n\r\nif (require.main === module) {\r\n\r\n\r\n\r\n\t/*\r\n\tfunction test_evented_class(test_data) {\r\n\t\tconst create_empty_test_res = () => {\r\n\t\t  return {\r\n\t\t\tpassed: [],\r\n\t\t\tfailed: []\r\n\t\t  };\r\n\t\t};\r\n\t  \r\n\t\t// Initialize res object with empty arrays\r\n\t\tconst res = create_empty_test_res();\r\n\t  \r\n\t\t// Test each event in test_data\r\n\t\tfor (let i = 0; i < test_data.length; i++) {\r\n\t\t  const { event_name, event_data } = test_data[i];\r\n\t  \r\n\t\t  // Test adding the event\r\n\t\t  const evented_class = new Evented_Class();\r\n\t\t  evented_class.add_event_listener(event_name, (data) => {\r\n\t\t\tif (data === event_data) {\r\n\t\t\t  res.passed.push(event_name);\r\n\t\t\t} else {\r\n\t\t\t  res.failed.push(event_name);\r\n\t\t\t}\r\n\t\t  });\r\n\t  \r\n\t\t  // Test raising the event\r\n\t\t  evented_class.raise_event(event_name, event_data);\r\n\t\t}\r\n\t  \r\n\t\t// Return test results\r\n\t\treturn res;\r\n\t  }\r\n\t  */\r\n\r\n\t  const test_data = [\r\n\t\t{\r\n\t\t\tevent_name: 'foo',\r\n\t\t\tevent_data: 'hello'\r\n\t\t},\r\n\t\t{\r\n\t\t\tevent_name: 'bar',\r\n\t\t\tevent_data: 'world'\r\n\t\t},\r\n\t\t{\r\n\t\t\tevent_name: 'baz',\r\n\t\t\tevent_data: true\r\n\t\t}\r\n\t];\r\n\t\r\n\tconst create_empty_test_res = () => ({\r\n\t\tpassed: [],\r\n\t\tfailed: []\r\n\t});\r\n\r\n\t  \r\n\t  function test_evented_class(test_data) {\r\n\t\tconst res = create_empty_test_res();\r\n\t\r\n\t\t// Create a new instance of Evented_Class\r\n\t\tconst evented_class = new Evented_Class();\r\n\t\r\n\t\t// Test each event in the test data\r\n\t\ttest_data.forEach(test_event => {\r\n\t\t\tconst event_name = test_event.event_name;\r\n\t\t\tconst event_data = test_event.event_data;\r\n\t\r\n\t\t\t// Define a listener for the event\r\n\t\t\tconst listener = data => {\r\n\t\t\t\tif (data === event_data) {\r\n\t\t\t\t\t// The event was raised with the expected data\r\n\t\t\t\t\tres.passed.push(event_name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// The event was raised with the wrong data\r\n\t\t\t\t\tres.failed.push(event_name);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\t// Add the listener to the evented class\r\n\t\t\tevented_class.on(event_name, listener);\r\n\t\r\n\t\t\t// Raise the event\r\n\t\t\tevented_class.raise_event(event_name, event_data);\r\n\t\t});\r\n\t\r\n\t\treturn res;\r\n\t}\r\n\t\r\n\r\n\r\n\tconst result = test_evented_class(test_data);\r\n\r\n\t// Print the results of the test\r\n\tconsole.log('Passed:', result.passed);\r\n\tconsole.log('Failed:', result.failed);\r\n\r\n\r\n}", "const lang = require('./lang-mini');\r\n\r\nconst {each, tof} = lang;\r\n\r\n\r\n// and lang types...\r\n//  Will use a Type class.\r\n//   Number_Type etc. String_Type perhaps.\r\n//     and then restrictions. JSON_Type is a String_Type.\r\n\r\n\r\n\r\n// Could have first implementation of types here even....\r\n//   Maybe don't use classes for them?\r\n//     Or do because they are so integrated into the language now.\r\n\r\n// Representation_Type\r\n//   eg represents a color (in specific way?) How it represents it...?\r\n//     ?? represents a 24bit rgb color ??\r\n//       why not? should be possible.\r\n\r\n\r\n// Some / all of oext would be nice within lang-mini...?\r\n\r\n// oext seems to work with types though, or would benefit from types.\r\n//   No, oext does not have much for types, moving field and prop from oext here, need to get the data types working with Data_Object\r\n//   and Data_Value. \r\n\r\n\r\n\r\n\r\n\r\n// Maybe move to lang-tools?\r\n//   fp() may benefit from integration with this.\r\n\r\n\r\n\r\n// What the type represents.\r\n// What it signifies?\r\n\r\n// But then how it's represented?\r\n\r\n\r\n// Not really about storing the data in memory or transmitting it.\r\n//   But saying it's 24 bit color is kind of about its representation.\r\n//   Still that's what it's called.\r\n\r\n// Type_Signifier seems better. Now it's called that.\r\n\r\n// Wider signification than just JS.\r\n\r\n\r\n// Type_Signifier_Component ????\r\n\r\n// Type_Signifier perhaps. Signifier_Type???\r\n\r\nclass Type_Signifier {\r\n    // Name\r\n    constructor(spec = {}) {\r\n\r\n        const name = spec.name;\r\n\r\n        // And use fields / quicker way to define these?\r\n\r\n        Object.defineProperty(this, 'name', {\r\n            get() {\r\n                return name;\r\n            }\r\n        });\r\n\r\n        const parent = spec.parent;\r\n\r\n        Object.defineProperty(this, 'parent', {\r\n            get() {\r\n                return parent;\r\n            }\r\n        });\r\n\r\n        const map_reserved_property_names = {\r\n            name: true,\r\n            parent: true\r\n        }\r\n\r\n        const _ = {};\r\n\r\n        each(spec, (value, name) => {\r\n            if (map_reserved_property_names[name]) {\r\n\r\n            } else {\r\n                _[name] = value;\r\n            }\r\n        });\r\n\r\n\r\n\r\n        // And other fields too....\r\n\r\n\r\n    }\r\n    extend(o_extension) {\r\n\r\n        const o = {\r\n            parent: this\r\n        }\r\n        Object.assign(o, o_extension);\r\n        const res = new Type_Signifier(o_extension);\r\n        return res;\r\n\r\n\r\n    }\r\n    //  Other options?\r\n    //  Disambiguiation? Descriptive text?\r\n    //    Or is naming them the main thing there?\r\n\r\n    // Color representation\r\n    //   And that is simple, does not go into internal representation.\r\n\r\n}\r\n\r\n\r\n\r\n\r\n// A representation for what is signified.\r\n//   This way if the programmer gets stuck about 'the' representation to make, they can make a decent representation, make it default,\r\n//     and move on for the moment.\r\n\r\n\r\n// Can be multiple allowed representations for a type.\r\n//   Binary data, JSON\r\n//   Compressed, uncompressed, maybe encrypted too.\r\n\r\n\r\n// Probably don't need subclasses for string or binary representations.\r\n//  Make this able to deal with both.\r\n//  String (kind of) is binary but likely uses UTF-8.\r\n\r\nclass Type_Representation {\r\n    // Name\r\n    //  Other options?\r\n    //  Disambiguiation? Descriptive text?\r\n    //    Or is naming them the main thing there?\r\n\r\n    // Color representation\r\n    //   And that is simple, does not go into internal representation.\r\n\r\n    // This should be able to represent types and lang features not available to JS.\r\n    //   Names may be optional? May be autogenerated and quite long?\r\n\r\n\r\n\r\n    constructor(spec = {}) {\r\n\r\n        // May be used on a lower level where the most suitable representation is selected.\r\n\r\n        // Generally:\r\n        //  string incl json\r\n        //  binary\r\n\r\n        // bridge the gap between numeric and binary.\r\n        //   make this ta-friendly and aware.\r\n\r\n        // represent components within a typed array? closely packed data structure?\r\n        \r\n\r\n        const name = spec.name;\r\n        Object.defineProperty(this, 'name', {\r\n            get() {\r\n                return name;\r\n            }\r\n        });\r\n\r\n        const parent = spec.parent;\r\n        Object.defineProperty(this, 'parent', {\r\n            get() {\r\n                return parent;\r\n            }\r\n        });\r\n\r\n        // Then the other fields?\r\n        //  Could have named fields.\r\n        //  Could have ordered fields?\r\n\r\n        const _ = {};\r\n\r\n        const map_reserved_property_names = {\r\n            'name': true\r\n        };\r\n\r\n        //  Even the number of bits being in here...?\r\n\r\n        each(spec, (value, name) => {\r\n            if (map_reserved_property_names[name]) {\r\n\r\n            } else {\r\n                _[name] = value;\r\n\r\n                // Could define the property here.\r\n                //  Read only (for the moment)\r\n\r\n                Object.defineProperty(this, name, {\r\n                    get() {\r\n                        return _[name];\r\n                    },\r\n                    enumerable: true\r\n                });\r\n\r\n\r\n            }\r\n        });\r\n        // Then a proxy to get other properties?\r\n    }\r\n    extend(o_extension) {\r\n\r\n        const o = {\r\n            parent: this\r\n        }\r\n        Object.assign(o, o_extension);\r\n        const res = new Type_Representation(o_extension);\r\n        return res;\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n// Will spell out some things in a quite verbose vanilla-js way here.\r\n//   Some higher level code will use types and other lang functionality to be less verbose and closer to English / the direct concepts.\r\n\r\n// Joins together 1 signifier and multiple representations.\r\n//   Name of item will be the signifier's name.\r\n\r\nclass Signifier_Representations_Type {\r\n    constructor(spec = {}) {\r\n        // 2 params in constructor? (signifier, arr_reps)???\r\n        //  could check for that.\r\n\r\n        if (spec.signifier && spec.representations) {\r\n\r\n            let signifier, arr_representations;\r\n\r\n            //if (spec.signifier) {\r\n            if (spec.signifier instanceof Type_Signifier) {\r\n                signifier = spec.signifier;\r\n            } else {\r\n                throw 'expected spec.signifier to be a Type_Signifier instance';\r\n            }\r\n            //}\r\n\r\n            if (tof(spec.representations) === 'array') {\r\n                let pass = true;\r\n                each(spec.representations, (representation, idx, stop) => {\r\n                    if (!(representation instanceof Type_Representation)) {\r\n                        pass = false;\r\n                        stop();\r\n                    }\r\n                })\r\n                if (pass) {\r\n                    arr_representations = spec.representations;\r\n                } else {\r\n                    throw 'Expected spec.representations to be an array of Type_Representation instances.';\r\n                }\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n        } else {\r\n            throw 'Expected spec.signifier and spec.representations'\r\n        }\r\n\r\n        \r\n\r\n\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// And could be subclasses of signification types...???\r\n\r\n// ui8 type signification?\r\n//   OK to signify that type, could indeed be represented with different actual values.\r\n//    such as as a string of decimal or hex digits.\r\n\r\n\r\n// Will have some basic / core types within lang-mini.\r\n//   Will not have a large amount of code.\r\n\r\n\r\n// Thematic types perhaps....\r\n//   seems like there could be overlap as well, eg image and document, text and document\r\n//   color, date/time, image, video, text, document, font, number, integer, floating point, string\r\n//     Type signifier could have theme property instead of or as well as name?\r\n//       Then representation of one thing as another. Represent a color as a number.\r\n\r\n// One advantage of putting in its own module is possible smaller file size.\r\n//   Though could possibly use lang-mini functionality as a platform for signifier and representer types.\r\n//   Type_Representer perhaps, not Type_Representation???\r\n//     Representation is probably the more accurate / better reading word.\r\n\r\n\r\n\r\n\r\nconst st_color = new Type_Signifier({'name': 'color'});\r\n\r\n// Signify an image. Signify a JPEG image. Etc.\r\n\r\n// then make a new one that extends st_color\r\n//   as in, a subtype.\r\nconst st_24bit_color = st_color.extend({'bits': 24});\r\n// Other types of 3 component color?\r\n\r\n//const st_24bit_rgb_color = st_24bit_color.extend({'components': ['red', 'green', 'blue']});\r\nconst st_24bit_rgb_color = st_24bit_color.extend({'components': ['red byte', 'green byte', 'blue byte']});\r\n//  or it already knows that these are bytes, when its 3 components in 24 bits.\r\n\r\n// st_24bit_rgb_color is only a signifier of 24 bit rgb color.\r\n//  Then there can be an implementation of it.\r\n//  Or a type (or class etc) could indicate it can handle it.\r\n\r\n// Type representation index could help.\r\n//   Query by name could return multiple items....\r\n//     Could have a property for the default representation with the name being searched for.\r\n\r\n\r\n\r\n\r\n\r\n\r\n// And have info about the properties by which it is represented?\r\n\r\nconst tr_string = new Type_Representation({'name': 'string'});\r\nconst tr_binary = new Type_Representation({'name': 'binary'}); // And could include number....\r\n// Numbers maybe extend binary.\r\n\r\n// And tr_ui8 even perhaps....\r\n\r\n\r\n\r\n\r\n// represent it as a binary sequence.\r\n//   Then could use more application specific tools like a Buffer or Typed Array.\r\n\r\n// Or extend the string type representation?\r\n\r\n// = tr_binary.extend();\r\n// trep maybe. and tsig or tsign.\r\n\r\n// Will make / finish some lower level components that interact with some specifically typed data.\r\n//   May well be worth doing more under 'grammar', getting type signifiers and type representations into the system.\r\n//     So far, types have been type representations. Now, they can be a signifier along with multiple representations.\r\n// A 'tags' type system of properties could help. Make it easy to specify / set up types.\r\n\r\n// Representation = Implementation (kind of)\r\n//   Or an interface.\r\n\r\n// Could use a Representation as an interface, in some cases.\r\n//   Inner representations as well\r\n//   Eg single color channel has a representation\r\n//     Would have a color name.\r\n//       Could even have a wavelength measurement for the color.\r\n\r\n// color channel 8 bit\r\n//   could use some language interpretation even. Some language processing could have the system 'understand' simple phrases describing\r\n//   type representations.\r\n\r\n// Actually using struct syntax for C++ or rust would be really good.\r\n//   Rust structs don't require fixed length strings in definition.\r\n\r\n// A struct being a Type_Representation, or Representational_Type.\r\n//   Dates can and do operate on different calendars.\r\n//     Same thing being signified, but with a different representation.\r\n// Diffent ways of representing strings and text. Now emojis too, they are part of unicode, and they keep getting updated.\r\n\r\n// Text characters are images that represent a letter or something else.\r\n//   They are symbols.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst rt_bin_24bit_rgb_color = new Type_Representation({\r\n    // A binary type representation.\r\n    'signifier': st_24bit_rgb_color,\r\n    'bytes': [\r\n        [0, 'red', 'ui8'],\r\n        [1, 'green', 'ui8'],\r\n        [2, 'blue', 'ui8']\r\n    ]\r\n});\r\n\r\n// Maybe do some work on a concise format for defining these types.\r\n// Maybe worth using or allowing the exact same syntax as C++ and/or rust for these stucts.\r\n//  Possibly some kind of syntax import. An example of how the same type of information can have different representations.\r\n\r\n\r\n\r\n\r\n// And an editor control could use a representation in terms of how it represents the data being edited to the user.\r\n\r\n// Binary type representation\r\nconst rt_hex_24bit_rgb_color = new Type_Representation({\r\n    // Likely some kind of string template.\r\n    //  Or a function?\r\n    //  Best to keep this function free here.\r\n    //  Or maybe make a few quite standard ones.\r\n    'signifier': st_24bit_rgb_color,\r\n\r\n    // Or could just have the sequence / template literal even.\r\n\r\n    'bytes': [\r\n        [0, '#', 'char'],\r\n        [1, 'hex(red)', 'string(2)'],\r\n        [3, 'hex(green)', 'string(2)'],\r\n        [5, 'hex(blue)', 'string(2)']\r\n    ]\r\n});\r\n\r\n// Year could be negative.\r\nconst st_date = new Type_Signifier({'name': 'date', 'components': ['day uint', 'month uint', 'year int']});\r\n// And datetime signification.\r\n\r\n// Approximate date ie date +- x years.\r\n\r\n\r\n// Just the date.\r\n\r\n\r\n\r\n//  or don't have the component types here?\r\n\r\n// String representation type.\r\n//  String_Type_Representation\r\n\r\n// Lots of different ways to represent a type.\r\n\r\n// Or say that they are numeric strings as well....\r\n\r\n// But a string char possibly takes more than 1 byte! Maybe not as defined here.\r\n//  String of int?\r\n//  Go into more details about how dates are represented?\r\n\r\n// Could consider JPEG to be a representation of Image.\r\n//   May want / need to think in terms of segments or blocks...\r\n//    segment_name = 'block' even. So it at least knows the right technical term.\r\n//   JPEG can have different versions, or subrepresentations.\r\n//     Type representations can have a supertype. That can be used with JPEG and then their versions are subtypes.\r\n//       A bit like the super-JPEG is a type representation of its own - except its got the details of the syntax.\r\n//     Want to make the overall system flexible in terms of what it represesnts, a fairly simple base structure.\r\n\r\n\r\n// Maybe make sections that define the representations just after the signifiers.\r\n//   Could have a fair few basic things defined.\r\n\r\n// Type Signifiers and Type Representations\r\n//   Think it could become an interesting book / programming topic.\r\n//   Could have implementations in a few languages too. Maybe suggestions for future languages and versions of them.\r\n\r\n// Make it its own module even?\r\n//   Could work better at a lower level.\r\n\r\n// srtypes module perhaps, or just srtype.\r\n// Coding with the distinction between signified and represented types could be really useful.\r\n//   Be able to handle serialization and deserialization (or format changes in some cases) 'for free', that is once the definitions\r\n//     have been made, the system will be able to convert between them (maybe requires some conversion functions to be written)\r\n//   System will have decent default type conversions.\r\n\r\n// Probably worth having set of 'standard' type definitions.\r\n//   System needs to be flexible so that they can be amended.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst rt_string_date_uk_ddmmyy = new Type_Representation({\r\n    'signifier': st_date,\r\n    'bytes': [\r\n        [0, '#', 'char'],\r\n        [1, 'day', 'string(2)'],\r\n        [3, '/', 'char'],\r\n        [4, 'month', 'string(2)'],\r\n        [6, '/', 'char'],\r\n        [7, 'year', 'string(2)']\r\n    ]\r\n});\r\n\r\n// Extra rules or restrictions? Defaults eg year 38 is 2038 etc...\r\n\r\n\r\n// A types registry could help.\r\n//  Registry of signified types\r\n//  Registry of type representations.\r\n//   Meaning 1 'type' in this system can be represented in multiple different ways.\r\n\r\n// Then the infrastructure within control declaration...\r\n//   Though likely will use the .model and .view mixins for this.\r\n//   Views (or controls?) will be made so that the model is a specific representation of a signified type.\r\n//     Or one a a few supported representations.\r\n//     Eg a color palette working for monochrome (8bit color depth).\r\n//       Or a color palette could allow selection of multiple colors.\r\n\r\n// Color_Chooser perhaps being simpler?\r\n//   Color_Palette seems like it should be able to deal with a bunch of different ways in which the data could be represented\r\n//     either in the app as the user interacts with it, in app memory, in transmission, in storage.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// There could be quite a lot of these type representations.\r\n\r\n\r\n\r\n// Can have plenty of ways of representing a date. Fewer ways of signifying one.\r\n\r\n\r\n// To signify something is in some ways less than to represent it.\r\n//   Signification is only about saying that it is there.\r\n\r\n// Maybe have a nice UI app to set up the signifier / representer links.\r\n\r\n\r\n\r\n\r\n\r\n// A moderate amount of data type representation info would help get JSGUI controls working nicely on the specific types\r\n//   of data they are supposed to interact with.\r\n\r\n// Ways of getting the data in and out of typed arrays\r\n//   Typed array (or buffer?) access for these data types?\r\n\r\n// Could make some nice GUI components (controls) for selecing / editing dates and colors.\r\n//   Can do it in a way that avoids code repetition.\r\n//   Make it so that the controls are able to represent the type on the screen.\r\n\r\n\r\n\r\n\r\n\r\n \r\n// These types seem most useful for the types that the user interacts with and putting the type knowledge into the GUI.\r\n\r\n// Type registry makes sense too.\r\n//  jsgui.types perhaps / lang.types\r\n//   An index of types? Collection of them?\r\n\r\n// Also registry of controls that are set up for dealing with specific types?\r\n//   Being able to identify and use variety of representations.\r\n\r\n// May integrate this into image format work - or make this good so that image format work can use this as a platform.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// and then day, month, year components\r\n\r\n\r\n\r\n\r\n// day, month year\r\n\r\n\r\n\r\n// or 'hexdigit(2)' maybe.\r\n\r\n// And the Control could conveniently show and allow editing of values using different representations.\r\n//   Such as a hex representation, or hex representations for comonents.\r\n\r\n// A Control could be aware of, and use both representations of a Data_Type.\r\n//   Color Palette seems like the right place to use that more advanced and general purpose functionality.\r\n//     Will work well for some imaging tools as well too.\r\n\r\n\r\n// More functional composition of controls could be cool....\r\n//   But let's make / improve the color palette.\r\n//     Moving the data outside it could work too.\r\n//     Consts directory. Or basis. Basics.\r\n\r\n\r\n\r\n// Have a class / instance of one that tracks ie is a DB for the type representations and significations.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Then put that within an array? 32 bit number used as 24 bit?\r\n\r\n\r\n// Though it may be most/least significant in some cases.\r\n\r\n\r\n\r\n\r\n// Then create a representation of 24 bit rgb color where it's the 3 components as bytes.\r\n//   Could be deduced from what we have already. May be easy enough to get from the Type_Signifier to this.\r\n//     However, will then have representations of the individual components too....\r\n//     Perhaps represent the whole thing as a string. eg #RRGGBB color for HTML. Or as items in an array.\r\n//       Even representing them as items within a typed array.\r\n\r\n\r\n// Allowing multiple representations of the same things.\r\n//   Representation sets - so we know which representations as (almost? totally?) interchangable.\r\n//   Can choose different default representations depending on performance.\r\n\r\n// Or implementation sets? Prefer representation here to describe how the types are represented rather than other connotations\r\n//   such as code for operators.\r\n\r\n//console.log('st_color', st_color);\r\n\r\nlang.Type_Signifier = Type_Signifier;\r\nlang.Type_Representation = Type_Representation;\r\n\r\n\r\n\r\n\r\n// Let's make something a little simpler and focused on representing the types of data in Data_Model classes.\r\n//   Control is such a class through inheritance, it extends Data_Object.\r\n\r\n// nfdt new functional data type function....?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// The representation type is a way to represent something\r\n//   What is being represented? That is all within a signifier type.\r\n\r\n// Or Implementation_Type? As in that is concrete in terms of how it is represented.\r\n// Representation_Implementation_Type???\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = lang;", "\r\nconst {each, is_array} = require('lang-mini');\r\n\r\n// collective(arr).bcr() for example.... would call the bcr function on every item in the array (or collection?) \r\n\r\n// would help to make ut support other data types.\r\n//.  possibly ones that can expose an array interface???\r\n\r\n\r\n// eg collect(ctrl.siblings).bcr().overlaps(ctrl.bcr().extend('left', 80)).max('width') >= 80 ????\r\n\r\n// or do:\r\n\r\n// ctrl.bcr().extend('left', 80).overlaps(collect(ctrl.siblings).bcr()).max('width') >= 80\r\n\r\n// or:\r\n\r\n//. Will be nice to allow dense syntax in an unambiguous way where possible.\r\n//.   Would automatically carry out the 'collect' operation, but that could be a more advanced stage of the implementation doing that.\r\n\r\n// Really concise syntax to express the things which would take quite a lot of likes of JS, but simple enough to be able\r\n//.  to be expressed in one dense and very readable line.\r\n\r\n// This would be a good piece of code for the Window control to express looking to its left and seeing if it overlaps any siblings\r\n//.  within 80 px, and what the overlap is with similar syntax.\r\n\r\n\r\n\r\n// ctrl.bcr().extend('left', 80).overlaps(ctrl.siblings).max('width') > 0\r\n\r\n// A direct and readable syntax will help...\r\n// ctrl.bcr.extend('left', 80).overlaps(ctrl.siblings).max('width') > 0\r\n\r\n\r\n\r\nconst collective = (arr) => {\r\n\r\n    /*\r\n    each(arr, (item) => {\r\n\r\n    })\r\n    */\r\n\r\n    if (is_array(arr)) {\r\n        //const ref_arr = [];\r\n        \r\n\r\n        const target = {\r\n          };\r\n          \r\n          const handler2 = {\r\n\r\n            get(target, prop, receiver) {\r\n                if (arr.hasOwnProperty(prop)) {\r\n                    return arr[prop];\r\n                } else {\r\n                    \r\n                    if (typeof arr[0][prop] === 'function') {\r\n\r\n                        return (...a) => {\r\n                            const res = [];\r\n                            each(arr, item => {\r\n                                res.push(item[prop](...a));\r\n                            })\r\n                            return res;\r\n                        }\r\n\r\n                        // Call the function on all of them\r\n                    } else {\r\n                        const res = [];\r\n                        each(arr, item => {\r\n                            res.push(item[prop]);\r\n                        })\r\n                        return res;\r\n                    }\r\n\r\n                    \r\n                }\r\n\r\n              //return \"world\";\r\n            },\r\n          };\r\n          \r\n          const proxy2 = new Proxy(target, handler2);\r\n          return proxy2;\r\n\r\n\r\n    } else {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n\r\n\r\n}\r\n\r\nmodule.exports = collective;", "//var jsgui = require('lang-mini');\r\n//var Evented_Class = require('./_evented-class');\r\n\r\n//var j = jsgui;\r\n//var Evented_Class = j.Evented_Class;\r\n\r\n// What type is the value?\r\n\r\n\r\nconst {Evented_Class} = require('lang-mini');\r\n\r\n\r\n/*\r\n    Possible code inclusions:\r\n\r\n    Could define some things as being more stable in the 2.0.\r\n    All the data model items being given an ID could wind up being very useful.\r\n        Maybe even some kind of 128 or 256 bit GUID / key.\r\n    Though of course it would lower performance for some things.\r\n    However, supporting very large data throughput won't be the objective of this framework.\r\n    Easily supporting large amounts of data could help though.\r\n\r\n\r\n\r\n*/\r\n\r\nclass Data_Model extends Evented_Class {\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        this.__data_model = true;\r\n        if (spec && spec.context) {\r\n            this.context = spec.context;\r\n\r\n        }\r\n        if (spec && spec.name) {\r\n            this.name = spec.name;\r\n        }\r\n        this.__type = 'data_model';\r\n    }\r\n};\r\n\r\nmodule.exports = Data_Model;\r\n", "const Data_Model = require('../Data_Model');\r\nconst {tof} = require('lang-mini');\r\n\r\nconst more_general_equals = (that, other) => {\r\n\r\n    if (other instanceof Data_Model) {\r\n        // Compare the values???\r\n\r\n        // For the moment, get them as JSON....\r\n\r\n        // Though it looks like getting the values as JSON is not working properly in some cases.\r\n\r\n        \r\n\r\n        const my_json = that.toJSON();\r\n        const other_json = other.toJSON();\r\n\r\n\r\n\r\n        //console.log('[my_json, other_json]', [my_json, other_json]);\r\n\r\n        //console.trace();\r\n        //throw 'stop';\r\n\r\n        return my_json === other_json;\r\n\r\n    } else {\r\n        // what type is being stored in this????\r\n\r\n        // look at .value????\r\n        //   or the unwrapped value....?\r\n\r\n        // Does it have a .value????\r\n\r\n        //console.log('[that, other]', [that, other]);\r\n\r\n        if (that === other) {\r\n            return true;\r\n        } else {\r\n\r\n            if (that === undefined) {\r\n                return false;\r\n            } else {\r\n                const {value} = that;\r\n\r\n                const t_value = tof(value), t_other = tof(other);\r\n\r\n                //console.log('[t_value, t_other]', [t_value, t_other]);\r\n                //console.log('*** [value, other]', [value, other]);\r\n\r\n                if (t_value === t_other) {\r\n                    //console.log('*** [value, other]', [value, other]);\r\n\r\n                    if (value === other) {\r\n                        return true;\r\n                    } else {\r\n                        if (typeof value.equals === 'function' && typeof other.equals === 'function') {\r\n                            return value.equals(other);\r\n                        } else {\r\n\r\n                            if (value === other) {\r\n                                return true;\r\n                            } else {\r\n\r\n                                if (t_value === 'number' || t_value === 'string' || t_value === 'boolean') {\r\n                                    return value === other;\r\n                                } else {\r\n\r\n                                    if (t_value === 'array') {\r\n                                        // or tostring / tojson???\r\n\r\n                                        if (value.length === other.length) {\r\n                                            // compare each of them....\r\n\r\n                                            let res = true, c = 0, l = value.length;\r\n\r\n                                            do {\r\n                                                res = more_general_equals(value[c], other[c]);\r\n                                                c++;\r\n                                            } while (res === true && c < l)\r\n                                            return res;\r\n\r\n                                        } else {\r\n                                            return false;\r\n                                        }\r\n\r\n                                    } else {\r\n                                        console.log('[value, other]', [value, other]);\r\n                                        console.trace();\r\n                                        throw 'NYI';\r\n\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n\r\n                    \r\n                } else {\r\n                    // But number parsing etc....\r\n                    return false;\r\n                }\r\n\r\n\r\n            }\r\n        }\r\n\r\n\r\n\r\n\r\n        \r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    more_general_equals\r\n\r\n\r\n}", "\r\n// This is resulting in smaller code in other parts of the framework.\r\n//  This section is getting quite big (again)\r\n//  Still need to make use of the B+ free for ordered indexing.\r\n\r\n// Moving some code to jsgui-lang-essentials\r\n//  Will be publishing a 0.4 version of that before so long?\r\n//   Maybe with more explanation?\r\n\r\n// It may be worth publishing this, and a discussion forum about it on my own web forum.\r\n//  Perhaps that could come later, but jsgui-lang-essentials may be a good step. Could call it version 0.35.\r\n//   Could have a few examples\r\n//   Would be a useful toolkit I could use while working elsewhere.\r\n\r\n//  I think that web site would be lightening fast, and impress people with its speed compared to other web platforms that they are used to\r\n//   (though Facebook is OK)\r\n\r\n/*\r\n if (typeof define !== 'function') {\r\n var define = require('amdefine')(module);\r\n }\r\n\r\n\r\n // May sway implementations of the particular items more easily when they are in their own files.\r\n\r\n define([\"./jsgui-lang-essentials\"], function (jsgui) {\r\n */\r\n//var jsgui = require('./jsgui-lang-essentials');\r\n\r\n// StiffArray: an array with pre-allocated items\r\n// it seems that this array is usually faster (excluding IE javascript engine)\r\n// probably there is a reason to provide IE implementation based on usual dynamic arrays\r\n\r\nvar StiffArray = function (capacity) {\r\n\r\n    // -----------------------------------------\r\n    //              public interface:\r\n    // -----------------------------------------\r\n\r\n    var m_public = {\r\n        items: new Array(capacity), // internal storage array\r\n        count: 0, // items count\r\n        first: function () {\r\n            if (this.count == 0) throw \"StiffArray.first()\";\r\n            return this.items[0];\r\n        },\r\n        last: function () {\r\n            if (this.count == 0) throw \"StiffArray.last()\";\r\n            return this.items[this.count - 1];\r\n        },\r\n        add: function (item) {\r\n            if (this.count >= capacity) throw \"StiffArray.add()\";\r\n            //\r\n            this.items[this.count++] = item;\r\n        },\r\n        add_from: function (source) {\r\n            if (this.count + source.count > capacity) throw \"StiffArray.add_from()\";\r\n            //\r\n            for (var i = 0; i < source.count; i++) this.items[this.count++] = source.items[i];\r\n        },\r\n        insert: function (index, item) {\r\n            if ((index < 0) || (index > this.count)) throw \"StiffArray.insert(): index\";\r\n            if (this.count >= capacity) throw \"StiffArray.insert(): overflow\";\r\n            //\r\n            for (var i = this.count; i > index; i--) this.items[i] = this.items[i - 1];\r\n            this.items[index] = item;\r\n            this.count++;\r\n        },\r\n        removeAt: function (index) {\r\n            if ((index < 0) || (index >= this.count)) throw \"StiffArray.removeAt()\";\r\n            //\r\n            this.count--;\r\n            for (var i = index; i < this.count; i++) this.items[i] = this.items[i + 1];\r\n        },\r\n        removeFirst: function () {\r\n            this.removeAt(0);\r\n        },\r\n        removeLast: function () {\r\n            this.removeAt(this.count - 1);\r\n        },\r\n        copy_from: function (source, index, count) {\r\n            for (var i = 0; i < count; i++) {\r\n                this.items[i] = source.items[i + index];\r\n            }\r\n            this.count = count;\r\n        },\r\n        search_first: function (item) {\r\n            var cnt = this.count;\r\n            var first = 0;\r\n            while (cnt > 0) {\r\n                var step = Math.floor(cnt / 2);\r\n                var index = first + step;\r\n                if (this.items[index] < item) {\r\n                    first = index + 1;\r\n                    cnt -= (step + 1);\r\n                } else {\r\n                    cnt = step;\r\n                }\r\n            }\r\n            //\r\n            if (first < this.count) {\r\n                return { found: (this.items[first] == item), index: first };\r\n            }\r\n            return { found: false, index: first };\r\n        },\r\n        search_last: function (item) {\r\n            var cnt = this.count;\r\n            var first = 0;\r\n            while (cnt > 0) {\r\n                var step = Math.floor(cnt / 2);\r\n                var index = first + step;\r\n                if (item >= this.items[index]) {\r\n                    first = index + 1;\r\n                    cnt -= (step + 1);\r\n                } else {\r\n                    cnt = step;\r\n                }\r\n            }\r\n            //\r\n            if ((first > 0) && (first <= this.count)) {\r\n                if (this.items[first - 1] == item) {\r\n                    return { found: true, index: first - 1 };\r\n                }\r\n            }\r\n            return { found: false, index: first };\r\n        },\r\n        search_last_prefix: function (prefix) {\r\n            var prefix_length = prefix.length;\r\n            //\r\n            var check_prefix = function (item) {\r\n                if (prefix_length > item.length) return false;\r\n                return (item.substr(0, prefix_length) == prefix)\r\n            }\r\n            //\r\n            var cnt = this.count;\r\n            var first = 0;\r\n            while (cnt > 0) {\r\n                var step = Math.floor(cnt / 2);\r\n                var index = first + step;\r\n                var item = this.items[index];\r\n                if ((prefix > item) || check_prefix(item)) {\r\n                    first = index + 1;\r\n                    cnt -= (step + 1);\r\n                } else {\r\n                    cnt = step;\r\n                }\r\n            }\r\n            //\r\n            if ((first > 0) && (first <= this.count)) {\r\n                if (check_prefix(this.items[first - 1])) {\r\n                    return { found: true, index: first - 1 };\r\n                }\r\n            }\r\n            return { found: false, index: first };\r\n        },\r\n        toString: function () {\r\n            return this.items.slice(0, this.count).toString();\r\n        }\r\n    };\r\n\r\n\r\n    // -----------------------------------------\r\n    //       return the public interface:\r\n    // -----------------------------------------\r\n\r\n    return m_public;\r\n};\r\nmodule.exports = StiffArray;\r\n\r\n\r\n//return StiffArray;\r\n\r\n\r\n//});\r\n\r\n\r\n", "\r\n\r\n/*\r\n if (typeof define !== 'function') {\r\n var define = require('amdefine')(module);\r\n }\r\n\r\n\r\n // May sway implementations of the particular items more easily when they are in their own files.\r\n\r\n define([\"./jsgui-lang-essentials\", \"./jsgui-data-structures-stiffarray\"], function (jsgui, StiffArray) {\r\n */\r\n\r\n//var jsgui = require('./jsgui-lang-essentials');\r\n\r\n\r\nvar StiffArray = require('./stiffarray');\r\n\r\n// B+ Tree\r\n\r\n// some B+ Tree description can be found here:\r\n// http://www.cs.berkeley.edu/~kamil/teaching/su02/080802.pdf\r\n// http://baze.fri.uni-lj.si/dokumenti/B+%20Trees.pdf\r\n\r\n\r\n// sample tree classic presentation:\r\n//\r\n//\t              [] 7 []\r\n//\t              /     \\\r\n//\t             /       -----------------\r\n//\t            /                         \\\r\n//\t           /                           \\\r\n//\t     [] 3 [] 5 []                  [] 8 [] 8 []\r\n//\t     /    |     \\                  /     \\    \\\r\n//\t    /     |      \\                /       |    ----\r\n//     /      |       \\              /         \\       \\\r\n//  {1,2}   {3,4}    {5,6,7}      {8,8,8}    {8,8}    {8,9}\r\n//\r\n//   the diagram notation:\r\n//   numbers are \"keys\" array items\r\n//   \"[]\" figures are \"children\" array items\r\n\r\n\r\n// sample tree toText() presentation:\r\n//\r\n//\t      {1,2}\r\n//\t    3\r\n//\t      {3,4}\r\n//\t    5\r\n//\t      {5,6,7}\r\n//  7\r\n//\t      {8,8,8}\r\n//\t    8\r\n//\t      {8,8}\r\n//\t    8\r\n//\t      {8,9}\r\n\r\n\r\n// sample tree toString() presentation:\r\n//\r\n// {{{1,2}3{3,4}5{5,6,7}}7{{8,8,8}8{8,8}8{8,9}}}\r\n\r\n\r\n// some remarks:\r\n//\r\n//  children.length == keys.length + 1\r\n//\r\n//  (max children[i] key) <= (keys[i]) <= (min children[i+1] key)\r\n//\r\n//  the node overflow threshold referred somewhere as \"node order\" is referred as \"node capacity\" here\r\n\r\n\r\n// -----------------------------------------\r\n//\r\n//\t              global variables:\r\n//\r\n// -----------------------------------------\r\n\r\n//var B_Plus_Tree_NextNodeDebugId = 1;\r\n// uncomment the line above to include unique node IDs\r\n// to the toString() and toTest() output\r\n\r\n// -----------------------------------------\r\n//\r\n//\t              B_Plus_Node:\r\n//\r\n// -----------------------------------------\r\n\r\n// Likely to get this into the core, and do some more polymorphic optimization to reduce file size.\r\n//  One various things are running, I will focus on some code size optimizations to bring things down to really small sizes when used in\r\n//  conjunction with Essentials.\r\n\r\n// Not sure about the B+ tree making use of Collections but with no indexing?\r\n//  I think by making Collection really flexible, and a version that mixes in other functionality to a more basic one,\r\n//  it would be possible to make the B+ tree use a Collection with StiffArray capabilities.\r\n//   Not worth it right now. Keep StiffArray as a low level component used for the tree. Maybe move it out of its own JavaScript file, not sure it\r\n//    will be used for that much else. Not sure, could be good for when binary searches are required.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// B+ tree index node:\r\nvar B_Plus_Node = function (nodeCapacity) {\r\n\r\n    // -----------------------------------------\r\n    //              public interface:\r\n    // -----------------------------------------\r\n\r\n    var m_public = {\r\n        isLeaf: false,\r\n        parent: null,\r\n        keys: new StiffArray(nodeCapacity + 1),     // +1: to allow temporary owerflow\r\n        children: new StiffArray(nodeCapacity + 2) // +2: children.length == keys.length + 1\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                  debug ID:\r\n    // -----------------------------------------\r\n\r\n    //if (typeof (B_Plus_Tree_NextNodeDebugId) != \"undefined\") m_public.debugId = B_Plus_Tree_NextNodeDebugId++;\r\n\r\n    // -----------------------------------------\r\n    //       return the public interface:\r\n    // -----------------------------------------\r\n\r\n    return m_public;\r\n};\r\n\r\n// -----------------------------------------\r\n//\r\n//\t              B_Plus_Leaf:\r\n//\r\n// -----------------------------------------\r\n\r\n// B+ tree leaf node:\r\n\r\nvar B_Plus_Leaf = function (nodeCapacity) {\r\n\r\n    // -----------------------------------------\r\n    //              public interface:\r\n    // -----------------------------------------\r\n\r\n    var m_public = {\r\n        isLeaf: true,\r\n        parent: null,\r\n        keys: new StiffArray(nodeCapacity + 1),\r\n        values: new StiffArray(nodeCapacity + 1),\r\n        //\r\n        // leafs chain:\r\n        prevLeaf: null,\r\n        nextLeaf: null\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                  debug ID:\r\n    // -----------------------------------------\r\n\r\n    //if (typeof(B_Plus_Tree_NextNodeDebugId) != \"undefined\") m_public.debugId = B_Plus_Tree_NextNodeDebugId++;\r\n\r\n    // -----------------------------------------\r\n    //       return the public interface:\r\n    // -----------------------------------------\r\n\r\n    return m_public;\r\n};\r\n\r\n\r\n// -----------------------------------------\r\n//\r\n//\t              B_Plus_Tree:\r\n//\r\n// -----------------------------------------\r\n\r\n// B+ tree:\r\n\r\n// Using Crockford's Module Pattern.\r\n//  Need to be careful about how it is not initialized with a constructor and the 'new' keyword.\r\n\r\nvar FindInfo = (key, value, isPrefixSearch) => {\r\n    isPrefixSearch = !!isPrefixSearch;\r\n    var isKeyPresent = (key != undefined);\r\n    var isValuePresent = (value != undefined);\r\n    var prefixLength = 0;\r\n    if (isPrefixSearch) {\r\n        if (typeof (key) != \"string\") {\r\n            isPrefixSearch = false;\r\n        } else {\r\n            prefixLength = key.length;\r\n        }\r\n    }\r\n    //\r\n    return {\r\n        key: key,     // key to find (if present)\r\n        value: value, // value to find (if present)\r\n        isPrefixSearch: isPrefixSearch, // prefix search mode\r\n        leaf: null,   // found leaf\r\n        index: -1,    // found leaf item index\r\n        isKeyPresent: isKeyPresent, // function () { return this.key !== undefined; }, // is the search criteria contains key\r\n        isValuePresent: isValuePresent, // function () { return this.value !== undefined; }, // is the search criteria contains value\r\n        foundKey: function () { return this.leaf.keys.items[this.index]; }, // found items's key\r\n        foundValue: function () { return this.leaf.values.items[this.index]; }, // found item's value\r\n        //\r\n        prefix_length: prefixLength, // prefix length\r\n        check_prefix: function () {  // check the current key to match the prefix\r\n            if (!isPrefixSearch) return false;\r\n            if (this.index >= this.leaf.keys.count) return false;\r\n            var keyToCheck = this.foundKey();\r\n            if (this.prefix_length > keyToCheck.length) return false;\r\n            return (keyToCheck.substr(0, this.prefix_length) == this.key)\r\n        }\r\n    };\r\n};\r\n\r\n\r\n\r\nvar B_Plus_Tree = function (nodeCapacity) {\r\n\r\n    // -----------------------------------------\r\n    //            arguments processing:\r\n    // -----------------------------------------\r\n\r\n    if (nodeCapacity === undefined) nodeCapacity = 10;\r\n    if (nodeCapacity < 4) throw \"B_Plus_Tree(): node capacity must be >= 4\";\r\n\r\n    // -----------------------------------------\r\n    //              public interface:\r\n    // -----------------------------------------\r\n\r\n\r\n    var m_public = {\r\n        // tree root:\r\n        root: new B_Plus_Leaf(nodeCapacity),\r\n        //\r\n        // leafs chain:\r\n        firstLeaf: null,\r\n        //\r\n        lastLeaf: null,\r\n        //\r\n        // ---------------------\r\n        //     editing:\r\n        // ---------------------\r\n        //\r\n        // clear the tree:\r\n        clear: function () {\r\n            p_Clear();\r\n        },\r\n        //\r\n\r\n        // insert(key, value)\r\n        // insert([key, value])\r\n        insert: function (key, value) {\r\n            if (arguments.length == 2) {\r\n                return p_Insert(key, value);\r\n            } else {\r\n                return p_Insert(key[0], key[1]);\r\n            }\r\n        },\r\n        //\r\n\r\n        // remove(key) - remove all values with given key\r\n        // remove(key, value) - remove one value occurrence\r\n        remove: function (key, value) {\r\n            if (arguments.length == 2) {\r\n                return p_Remove(key, value);\r\n            } else {\r\n                p_RemoveKey(key);\r\n            }\r\n        },\r\n        //\r\n        // ---------------------\r\n        //       finding:\r\n        // ---------------------\r\n        //\r\n\r\n        // findFirst() - find the very first item\r\n        // findFirst(key) - find the first item for the given key\r\n        // findFirst(key, value) - find the first key+value occurrence\r\n        //\r\n        // returns the FindInfo object:\r\n        //    key: key,     // key to find (if present)\r\n        //    value: value, // value to find (if present)\r\n        //\r\n        //    leaf: null,   // the current found leaf\r\n        //    index: -1,    // the current found index\r\n        //\r\n        //    foundKey():   // the current found key\r\n        //    foundValue(): // the current found value\r\n        //\r\n        findFirst: function (key, value) {\r\n            return p_FindFirst(key, value);\r\n        },\r\n        //\r\n        // find first key matching the prefix:\r\n        findFirstPrefix: function (prefix) {\r\n            return p_FindFirst(prefix, undefined, true);\r\n        },\r\n        //\r\n        // find next search conditions occurence\r\n        findNext: function (findInfo) {\r\n            return p_FindNext(findInfo);\r\n        },\r\n\r\n        //\r\n        // findLast() - find the very last item\r\n        // findLast(key) - find the last item for the given key\r\n        // findLast(key, value) - find the last key+value occurrence\r\n        findLast: function (key, value) {\r\n            return p_FindLast(key, value);\r\n        },\r\n        //\r\n        // find last key matching the prefix:\r\n        findLastPrefix: function (prefix) {\r\n            return p_FindLast(prefix, undefined, true);\r\n        },\r\n        //\r\n        // find previous search conditions occurence\r\n        findPrevious: function (findInfo) {\r\n            return p_FindPrev(findInfo);\r\n        },\r\n        //\r\n        // ---------------------\r\n        // dictionary-like usage:\r\n        // ---------------------\r\n        //\r\n        // get one value by key (or null):\r\n        getValue: function (key) {\r\n            return p_GetValue(key);\r\n        },\r\n        // set one value by key (insert or update):\r\n        setValue: function (key, value) {\r\n            p_SetValue(key, value);\r\n        },\r\n        //\r\n        //\r\n        // ---------------------\r\n        //   other functions:\r\n        // ---------------------\r\n        //\r\n\r\n        // count() - count all values\r\n        // count(key) - count values with the given key\r\n        count: function (key) {\r\n            if (arguments.length == 1) {\r\n                return p_CountKey(key);\r\n            } else {\r\n                return p_Count();\r\n            }\r\n        },\r\n        //\r\n\r\n        // tree capacity:\r\n        getCapacity: function () {\r\n            return m_nodeMaxCount;\r\n        },\r\n        //\r\n        // ---------------------\r\n        // additional functions:\r\n        // ---------------------\r\n        //\r\n        // iterate through each key + value pair\r\n        // callback is function(key, value)\r\n        'each': function (callback) {\r\n            return p_each(callback);\r\n        },\r\n        //\r\n        // get all keys\r\n        'keys': function () {\r\n            return p_keys();\r\n        },\r\n        //\r\n        // get all [key, value] pairs\r\n        'keys_and_values': function () {\r\n            return p_keys_and_values();\r\n        },\r\n        //\r\n        //\r\n        // get keys and values by prefix\r\n        'get_by_prefix': function (prefix) {\r\n            return p_get_by_prefix(prefix);\r\n        },\r\n        //\r\n        // get keys by prefix\r\n        'get_keys_by_prefix': function (prefix) {\r\n            return p_get_keys_by_prefix(prefix);\r\n        },\r\n        //\r\n        // get values at key...\r\n        'get_values_by_key': function (key) {\r\n            return p_get_values_by_key(key);\r\n        }\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //              initialization:\r\n    // -----------------------------------------\r\n\r\n    m_public.firstLeaf = m_public.root;\r\n    m_public.lastLeaf = m_public.root;\r\n\r\n    // -----------------------------------------\r\n    //              private variables:\r\n    // -----------------------------------------\r\n\r\n    var m_nodeMaxCount = nodeCapacity;\r\n    var m_nodeMinCount = Math.floor(m_nodeMaxCount / 2);\r\n\r\n    // -----------------------------------------\r\n    //                 clear():\r\n    // -----------------------------------------\r\n\r\n    // clear the tree\r\n    // (just create new empty root)\r\n    var p_Clear = function () {\r\n        m_public.root = new B_Plus_Leaf(m_nodeMaxCount);\r\n        m_public.firstLeaf = m_public.root;\r\n        m_public.lastLeaf = m_public.root;\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                iterations:\r\n    // -----------------------------------------\r\n\r\n    var p_keys = function () {\r\n        var res = [];\r\n        _p_each_key(function (key) {\r\n            res.push(key);\r\n        });\r\n        return res;\r\n    }\r\n\r\n    var p_keys_and_values = function () {\r\n        var res = [];\r\n        p_each(function (key, value) {\r\n            res.push([key, value]);\r\n        });\r\n        return res;\r\n    }\r\n\r\n    var _p_each_key = function (callback) {\r\n        var findInfo = p_FindFirst();\r\n        while (findInfo != null) {\r\n            var fk = findInfo.foundKey();\r\n            callback(fk);\r\n            findInfo = p_FindNext(findInfo);\r\n        }\r\n    }\r\n\r\n    var p_each = function (callback) {\r\n        var findInfo = p_FindFirst();\r\n\r\n        var doStop = false;\r\n\r\n\r\n        while (findInfo != null) {\r\n            //var stop =\r\n            //console.log('doStop ' + doStop);\r\n            var fk = findInfo.foundKey();\r\n            var fv = findInfo.foundValue();\r\n            // callback with the key and the value\r\n            callback(fk, fv, function() {\r\n                //throw 'stop';\r\n                //console.log('stop!!!');\r\n                doStop = true;\r\n            });\r\n            //console.log('2) doStop ' + doStop);\r\n            if (doStop) {\r\n                findInfo = null;\r\n            } else {\r\n                findInfo = p_FindNext(findInfo);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // -----------------------------------------\r\n    //                insert():\r\n    // -----------------------------------------\r\n\r\n    // insert (key, value) item to the tree\r\n    var p_Insert = function (key, value) {\r\n        //\r\n        // search leaf to insert:\r\n        var searchResult = searchLeaf(key);\r\n        var leaf = searchResult.node;\r\n        //\r\n        // insert to the leaf:\r\n        leaf.keys.insert(searchResult.index, key);\r\n        leaf.values.insert(searchResult.index, value);\r\n        //\r\n        // if overflow:\r\n        if (leaf.keys.count > m_nodeMaxCount) {\r\n            if ((leaf.prevLeaf != null) && (leaf.prevLeaf.keys.count < m_nodeMaxCount) && (leaf.prevLeaf.parent == leaf.parent)) {\r\n                rotateAmongLeavesToLeft(leaf.prevLeaf, leaf);\r\n            } else if ((leaf.nextLeaf != null) && (leaf.nextLeaf.keys.count < m_nodeMaxCount) && (leaf.nextLeaf.parent == leaf.parent)) {\r\n                rotateAmongLeavesToRight(leaf, leaf.nextLeaf);\r\n            } else {\r\n                splitLeaf(leaf);\r\n            }\r\n        }\r\n    };\r\n\r\n    // split leaf to 2 leaves\r\n    // (create right sibling)\r\n    var splitLeaf = function (leaf) {\r\n        var leftCount = m_nodeMinCount;\r\n        var rightCount = leaf.keys.count - leftCount;\r\n        //\r\n        // create right leaf:\r\n        var newRightLeaf = new B_Plus_Leaf(m_nodeMaxCount);\r\n        newRightLeaf.parent = leaf.parent;\r\n        //\r\n        // copy to the right:\r\n        newRightLeaf.keys.copy_from(leaf.keys, leftCount, rightCount);\r\n        newRightLeaf.values.copy_from(leaf.values, leftCount, rightCount);\r\n        //\r\n        // update the left:\r\n        leaf.keys.count = leftCount;\r\n        leaf.values.count = leftCount;\r\n        //\r\n        // update leafs chain:\r\n        newRightLeaf.nextLeaf = leaf.nextLeaf;\r\n        if (newRightLeaf.nextLeaf != null) newRightLeaf.nextLeaf.prevLeaf = newRightLeaf;\r\n        newRightLeaf.prevLeaf = leaf;\r\n        leaf.nextLeaf = newRightLeaf;\r\n        if (m_public.lastLeaf == leaf) m_public.lastLeaf = newRightLeaf;\r\n        //\r\n        // update parent:\r\n        if (leaf.parent != null) {\r\n            var leafIndex = calcChildIndex(leaf.parent, leaf);\r\n            insertToParent(leaf.parent, newRightLeaf, newRightLeaf.keys.first(), leafIndex + 1);\r\n        } else {\r\n            createNewRoot(leaf, newRightLeaf, newRightLeaf.keys.first());\r\n        }\r\n    };\r\n\r\n    // create new root\r\n    var createNewRoot = function (nodeLeft, nodeRight, key) {\r\n        // create new root containing nodeLeft and nodeRight children\r\n        // btw nodeLeft and nodeRight can be leaves\r\n        //\r\n        // create the root node:\r\n        var newRoot = new B_Plus_Node(m_nodeMaxCount);\r\n        newRoot.keys.add(key);\r\n        newRoot.children.add(nodeLeft);\r\n        newRoot.children.add(nodeRight);\r\n        //\r\n        // update parent references:\r\n        nodeLeft.parent = newRoot;\r\n        nodeRight.parent = newRoot;\r\n        //\r\n        // update root reference:\r\n        m_public.root = newRoot;\r\n    };\r\n\r\n    // insert newChildNode with key newChildFirstKey into the parentNode\r\n    // the newChildNode inserts into the newChildIndex position in the children\r\n    var insertToParent = function (parentNode, newChildNode, newChildFirstKey, newChildIndex) {\r\n        //\r\n        // insert child info:\r\n        parentNode.keys.insert(newChildIndex - 1, newChildFirstKey); // -1: the related key is \"before\" the child\r\n        parentNode.children.insert(newChildIndex, newChildNode);\r\n        //\r\n        // update parent reference:\r\n        newChildNode.parent = parentNode;\r\n        //\r\n        // update parent if overflow:\r\n        if (parentNode.keys.count > m_nodeMaxCount) {\r\n            splitNode(parentNode);\r\n        }\r\n    };\r\n\r\n    // split the overflowed node into 2 nodes\r\n    var splitNode = function (node) {\r\n        // split node: create right sibling\r\n        //\r\n        var newLeftCount = m_nodeMinCount;\r\n        var newRightCount = m_nodeMaxCount - newLeftCount;\r\n        var middleKey = node.keys.items[newLeftCount]; // key to move up\r\n        //\r\n        // create right node:\r\n        var newRightNode = new B_Plus_Node(m_nodeMaxCount);\r\n        newRightNode.keys.copy_from(node.keys, newLeftCount + 1, newRightCount);\r\n        newRightNode.children.copy_from(node.children, newLeftCount + 1, newRightCount + 1);\r\n        //\r\n        // update the node:\r\n        node.keys.count = newLeftCount;\r\n        node.children.count = newLeftCount + 1;\r\n        //\r\n        // update children's parent:\r\n        for (var i = 0; i < newRightNode.children.count; i++) newRightNode.children.items[i].parent = newRightNode;\r\n        //\r\n        // update parent:\r\n        if (node.parent == null) {\r\n            createNewRoot(node, newRightNode, middleKey);\r\n        } else {\r\n            var nodeIndex = calcChildIndex(node.parent, node);\r\n            insertToParent(node.parent, newRightNode, middleKey, nodeIndex + 1);\r\n        }\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                remove():\r\n    // -----------------------------------------\r\n\r\n    // remove (key, value) item from the tree\r\n    var p_Remove = function (key, value) {\r\n        var searchResult = searchLeafValue(key, value);\r\n        if (!searchResult.found) return false;\r\n        //\r\n        removeFromLeaf(searchResult.node, searchResult.index);\r\n        return true;\r\n    };\r\n\r\n    // remove all the items with given key\r\n    var p_RemoveKey = function (key) {\r\n        while (true) {\r\n            var searchResult = searchLeaf(key);\r\n            if (!searchResult.found) break;\r\n            //\r\n            removeFromLeaf(searchResult.node, searchResult.index);\r\n        }\r\n    };\r\n\r\n    // remove the item from index position of the leaf\r\n    var removeFromLeaf = function (leaf, index) {\r\n        leaf.keys.removeAt(index);\r\n        leaf.values.removeAt(index);\r\n        //\r\n        // the item is removed; then update the tree if the leaf is underflowed:\r\n        if (leaf.keys.count < m_nodeMinCount) {\r\n            if ((leaf.prevLeaf != null) && (leaf.parent == leaf.prevLeaf.parent) && (leaf.prevLeaf.keys.count > m_nodeMinCount)) {\r\n                rotateAmongLeavesToRight(leaf.prevLeaf, leaf);\r\n            } else if ((leaf.nextLeaf != null) && (leaf.parent == leaf.nextLeaf.parent) && (leaf.nextLeaf.keys.count > m_nodeMinCount)) {\r\n                rotateAmongLeavesToLeft(leaf, leaf.nextLeaf);\r\n            } else {\r\n                mergeLeaf(leaf);\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    // merge the underflowed leaf with left or right sibling\r\n    var mergeLeaf = function (leaf) {\r\n        // if the leaf is root, then underflow is allowed:\r\n        if (leaf.parent == null) {\r\n            return;\r\n        }\r\n        //\r\n        // calculate keys count in left and right sibling:\r\n        var leftCount = m_nodeMaxCount + 1;\r\n        var rightCount = m_nodeMaxCount + 1;\r\n        if ((leaf.prevLeaf != null) && (leaf.prevLeaf.parent == leaf.parent)) {\r\n            leftCount = leaf.prevLeaf.keys.count;\r\n        }\r\n        if ((leaf.nextLeaf != null) && (leaf.nextLeaf.parent == leaf.parent)) {\r\n            rightCount = leaf.nextLeaf.keys.count;\r\n        }\r\n        //\r\n        // select sibling to merge:\r\n        if (leftCount < rightCount) {\r\n            if (leftCount + leaf.keys.count > m_nodeMaxCount) throw \"B_Plus_Tree.mergeLeaf(): leftCount\";\r\n            mergeLeaves(leaf.prevLeaf, leaf);\r\n        } else {\r\n            if (rightCount + leaf.keys.count > m_nodeMaxCount) throw \"B_Plus_Tree.mergeLeaf(): rightCount\";\r\n            mergeLeaves(leaf, leaf.nextLeaf);\r\n        }\r\n    };\r\n\r\n    // merge 2 leaf nodes: leafLeft and leafRight\r\n    var mergeLeaves = function (leafLeft, leafRight) { // merge (left + right) -> left\r\n        //\r\n        // add right to left:\r\n        leafLeft.keys.add_from(leafRight.keys);\r\n        leafLeft.values.add_from(leafRight.values);\r\n        //\r\n        // update leafs chain:\r\n        leafLeft.nextLeaf = leafRight.nextLeaf;\r\n        if (leafLeft.nextLeaf != null) leafLeft.nextLeaf.prevLeaf = leafLeft;\r\n        if (m_public.lastLeaf == leafRight) m_public.lastLeaf = leafLeft;\r\n        //\r\n        // remove right from parent:\r\n        var parent = leafRight.parent;\r\n        var leafRightIndex = calcChildIndex(parent, leafRight);\r\n        parent.keys.removeAt(leafRightIndex - 1);\r\n        parent.children.removeAt(leafRightIndex);\r\n        //\r\n        // update parent if underflow:\r\n        if (parent.keys.count < m_nodeMinCount) {\r\n            mergeNode(parent);\r\n        };\r\n    };\r\n\r\n    // fix underflower index (non-leaf) node:\r\n    // rotate among sibling, or merge with sibling\r\n    var mergeNode = function (node) { // merge the node with sibling\r\n        var parent = node.parent;\r\n        //\r\n        // remove root if the node became empty root:\r\n        if (node.parent == null) {\r\n            if (node.keys.count == 0) {\r\n                m_public.root = node.children.items[0];\r\n                m_public.root.parent = null;\r\n            }\r\n            return;\r\n        }\r\n        //\r\n        // find left and right siblings:\r\n        var nodeIndex = calcChildIndex(parent, node);\r\n        var leftSibling = (nodeIndex > 0) ? parent.children.items[nodeIndex - 1] : null;\r\n        var rightSibling = ((nodeIndex + 1) < parent.children.count) ? parent.children.items[nodeIndex + 1] : null;\r\n        //\r\n        // try rotation:\r\n        if ((leftSibling != null) && (leftSibling.keys.count > m_nodeMinCount)) {\r\n            rotateAmongNodesToRight(leftSibling, node);\r\n            return;\r\n        }\r\n        if ((rightSibling != null) && (rightSibling.keys.count > m_nodeMinCount)) {\r\n            rotateAmongNodesToLeft(node, rightSibling);\r\n            return;\r\n        }\r\n        //\r\n        // calculate siblings key count:\r\n        var leftCount = m_nodeMaxCount + 1;\r\n        var rightCount = m_nodeMaxCount + 1;\r\n        if (leftSibling != null) {\r\n            leftCount = leftSibling.keys.count;\r\n        }\r\n        if (rightSibling != null) {\r\n            rightCount = rightSibling.keys.count;\r\n        }\r\n        //\r\n        // select sibling to merge:\r\n        if (leftCount < rightCount) {\r\n            if (leftSibling == null) throw \"B_Plus_Tree.mergeNode(): leftSibling\";\r\n            mergeNodes(leftSibling, node, nodeIndex);\r\n        } else {\r\n            if (rightSibling == null) throw \"B_Plus_Tree.mergeNode(): rightSibling\";\r\n            mergeNodes(node, rightSibling, nodeIndex + 1);\r\n        }\r\n    };\r\n\r\n    // merge 2 index (non-leaf) nodes nodeLeft and nodeRight into one node\r\n    // the nodeRightIndex is the nodeRight index in parent's children array;\r\n    // the nodeRightIndex is known in caller, so it's not needed to calculate it here\r\n    var mergeNodes = function (nodeLeft, nodeRight, nodeRightIndex) { // merge (left + right) -> left\r\n        var parent = nodeLeft.parent;\r\n        //\r\n        // update right children parent:\r\n        for (var i = 0; i < nodeRight.children.count; i++) nodeRight.children.items[i].parent = nodeLeft;\r\n        //\r\n        // move down key from parent:\r\n        nodeLeft.keys.add(nodeLeft.parent.keys.items[nodeRightIndex - 1]);\r\n        //\r\n        // add right to left:\r\n        nodeLeft.keys.add_from(nodeRight.keys);\r\n        nodeLeft.children.add_from(nodeRight.children);\r\n        //\r\n        // remove right from parent:\r\n        parent.keys.removeAt(nodeRightIndex - 1);\r\n        parent.children.removeAt(nodeRightIndex);\r\n        //\r\n        // update parent if underflow:\r\n        if (parent.keys.count < m_nodeMinCount) {\r\n            mergeNode(parent);\r\n        };\r\n    };\r\n\r\n\r\n    // -----------------------------------------\r\n    //          findFirst() / findNext():\r\n    // -----------------------------------------\r\n\r\n    // FindInfo nested class\r\n    // contains the search criteria (key, value) and search result (leaf, index)\r\n\r\n\r\n    // find first item matching (key, value) search criteria\r\n    // use cases:\r\n    // p_FindFirst()\r\n    // p_FindFirst(key)\r\n    // p_FindFirst(key, value)\r\n    // p_FindFirst(key, undefined, true)\r\n    var p_FindFirst = function (key, value, isPrefixSearch) {\r\n        var findInfo = FindInfo(key, value, isPrefixSearch);\r\n        //\r\n        if (findInfo.isKeyPresent) {\r\n            if (findInfo.isPrefixSearch && findInfo.isValuePresent) throw \"B_Plus_Tree.p_FindFirst(): arguments error: isPrefixSearch, but value is present\";\r\n            //\r\n            var searchResult = findInfo.isValuePresent ? searchLeafValue(key, value) : searchLeaf(key);\r\n            findInfo.leaf = searchResult.node;\r\n            findInfo.index = searchResult.index;\r\n            if (!searchResult.found) {\r\n                if (!findInfo.check_prefix()) {\r\n                    return null;\r\n                }\r\n            }\r\n        } else {\r\n            if (findInfo.isValuePresent) throw \"B_Plus_Tree.findFirst(): arguments error: key is not present, but value is present\";\r\n            //\r\n            findInfo.leaf = m_public.firstLeaf;\r\n            findInfo.index = 0;\r\n            if (findInfo.leaf.keys.count <= 0) return null;\r\n        }\r\n        //\r\n        return findInfo;\r\n    };\r\n\r\n    // find last item matching (key, value) search criteria\r\n    // use cases:\r\n    // p_FindLast()\r\n    // p_FindLast(key)\r\n    // p_FindLast(key, value)\r\n    // p_FindLast(key, undefined, true)\r\n    var p_FindLast = function (key, value, isPrefixSearch) {\r\n        var findInfo = new FindInfo(key, value, isPrefixSearch);\r\n        //\r\n        if (findInfo.isKeyPresent) {\r\n            if (findInfo.isPrefixSearch && findInfo.isValuePresent) throw \"B_Plus_Tree.p_FindLast(): arguments error: isPrefixSearch, but value is present\";\r\n            //\r\n            if (findInfo.isPrefixSearch) {\r\n                var searchResult = searchLastLeafByPrefix(key);\r\n                findInfo.leaf = searchResult.node;\r\n                findInfo.index = searchResult.index;\r\n                if (!searchResult.found) {\r\n                    return null;\r\n                }\r\n            } else {\r\n                var searchResult = findInfo.isValuePresent ? searchLastLeafValue(key, value) : searchLastLeaf(key);\r\n                findInfo.leaf = searchResult.node;\r\n                findInfo.index = searchResult.index;\r\n                if (!searchResult.found) {\r\n                    return null;\r\n                }\r\n            }\r\n        } else {\r\n            if (findInfo.isValuePresent) throw \"B_Plus_Tree.findLast(): arguments error: key is not present, but value is present\";\r\n            //\r\n            findInfo.leaf = m_public.lastLeaf;\r\n            findInfo.index = findInfo.leaf.keys.count - 1;\r\n            if (findInfo.index < 0) return null;\r\n        }\r\n        //\r\n        return findInfo;\r\n    };\r\n\r\n    // move to next item\r\n    var findGoToNext = function (findInfo) {\r\n        findInfo.index++;\r\n        if (findInfo.index >= findInfo.leaf.keys.count) {\r\n            findInfo.leaf = findInfo.leaf.nextLeaf;\r\n            findInfo.index = 0;\r\n        }\r\n        //\r\n        return (findInfo.leaf != null);\r\n    };\r\n\r\n    // move to previous item\r\n    var findGoToPrev = function (findInfo) {\r\n        findInfo.index--;\r\n        if (findInfo.index < 0) {\r\n            findInfo.leaf = findInfo.leaf.prevLeaf;\r\n            if (findInfo.leaf == null) return false;\r\n            findInfo.index = findInfo.leaf.keys.count - 1;\r\n        }\r\n        //\r\n        return true;\r\n    };\r\n\r\n    // find next item after the findInfo's found item, matching the findInfo's search criteria\r\n    var p_FindNext = function (findInfo) {\r\n        while (true) {\r\n            if (!findGoToNext(findInfo)) return null;\r\n            //\r\n            if (findInfo.isPrefixSearch) {\r\n                if (!findInfo.check_prefix()) return null;\r\n            } else {\r\n                if (findInfo.isKeyPresent && (findInfo.key != findInfo.foundKey())) return null;\r\n            }\r\n            //\r\n            if (findInfo.isValuePresent) {\r\n                if (findInfo.value == findInfo.foundValue()) return findInfo;\r\n            } else {\r\n                return findInfo;\r\n            }\r\n        }\r\n    };\r\n\r\n    // find previous item after the findInfo's found item, matching the findInfo's search criteria\r\n    var p_FindPrev = function (findInfo) {\r\n        while (true) {\r\n            if (!findGoToPrev(findInfo)) return null;\r\n            //\r\n            //if (findInfo.isKeyPresent && (findInfo.key != findInfo.foundKey())) return null;\r\n            if (findInfo.isPrefixSearch) {\r\n                if (!findInfo.check_prefix()) return null;\r\n            } else {\r\n                if (findInfo.isKeyPresent && (findInfo.key != findInfo.foundKey())) return null;\r\n            }\r\n            //\r\n            if (findInfo.isValuePresent) {\r\n                if (findInfo.value == findInfo.foundValue()) return findInfo;\r\n            } else {\r\n                return findInfo;\r\n            }\r\n        }\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //          additional methods:\r\n    // -----------------------------------------\r\n\r\n    // get values at key...\r\n    //  make this always return an array, even if there is one item.\r\n    //  will make interpretation easier.\r\n\r\n    // will move the prefix search code into here.\r\n\r\n    // iterate nodes by prefix... that may be a more efficient way of doing this, may be less efficient, it assigns one more thing I think.\r\n    //  possibly a fast iterator?\r\n\r\n    //  definitely would be easier code, I think it would be worth doing.\r\n    //  could also be given its own check function.\r\n    //   maybe gets given starting location.+\r\n\r\n\r\n    var p_get_values_by_key = function (key) {\r\n        var res = [];\r\n        var findInfo = p_FindFirst(key);\r\n        while (findInfo != null) {\r\n            res.push(findInfo.foundValue());\r\n            findInfo = p_FindNext(findInfo);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    // get keys and values by prefix\r\n\r\n    var p_get_by_prefix = function (prefix) {\r\n        var res = [];\r\n        var findInfo = m_public.findFirstPrefix(prefix);\r\n        while (findInfo != null) {\r\n            res.push([findInfo.foundKey(), findInfo.foundValue()]);\r\n            findInfo = m_public.findNext(findInfo);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    // get keys by prefix\r\n\r\n    var p_get_keys_by_prefix = function (prefix) {\r\n        var res = [];\r\n        var findInfo = m_public.findFirstPrefix(prefix);\r\n        while (findInfo != null) {\r\n            res.push(findInfo.foundKey());\r\n            findInfo = m_public.findNext(findInfo);\r\n        }\r\n        return res;\r\n    }\r\n\r\n\r\n    // -----------------------------------------\r\n    //          getValue() / setValue():\r\n    // -----------------------------------------\r\n\r\n    // get value for the given key\r\n    var p_GetValue = function (key) {\r\n        var searchResult = searchLeaf(key);\r\n        if (!searchResult.found) return null;\r\n        return searchResult.node.values.items[searchResult.index];\r\n    };\r\n\r\n    // set value for the given key\r\n    var p_SetValue = function (key, value) {\r\n        var searchResult = searchLeaf(key);\r\n        if (searchResult.found) {\r\n            removeFromLeaf(searchResult.node, searchResult.index);\r\n        }\r\n        //\r\n        p_Insert(key, value);\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                 count():\r\n    // -----------------------------------------\r\n\r\n    // count all the value items in the tree\r\n    // is that an easier way to iterate?\r\n\r\n    var p_Count = function () {\r\n        var result = 0;\r\n        //\r\n        var leaf = m_public.firstLeaf;\r\n        while (leaf != null) {\r\n            result += leaf.keys.count;\r\n            leaf = leaf.nextLeaf;\r\n        }\r\n        //\r\n        return result;\r\n    };\r\n\r\n    // count the value items with given key in the tree\r\n    var p_CountKey = function (key) {\r\n        var result = 0;\r\n        //\r\n        var findInfo = m_public.findFirst(key);\r\n        while (findInfo != null) {\r\n            result++;\r\n            findInfo = m_public.findNext(findInfo);\r\n        }\r\n        //\r\n        return result;\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //                 toText():\r\n    // -----------------------------------------\r\n\r\n    // returns multi-line text presentation for the tree\r\n\r\n    /*\r\n\r\n     var _p_ToText = function () {\r\n     var result = m_public.root.toText(\"\");\r\n     //\r\n     if (typeof (B_Plus_Tree_NextNodeDebugId) != \"undefined\") {\r\n     // print leafs chain:\r\n     result += \"\\r\\n\";\r\n     var leaf = m_public.firstLeaf;\r\n     while (leaf != null) {\r\n     result += \"(\" + leaf.debugId + \") \";\r\n     leaf = leaf.nextLeaf;\r\n     }\r\n     }\r\n     //\r\n     return result;\r\n     };\r\n\r\n     */\r\n\r\n    // -----------------------------------------\r\n    //                rotations:\r\n    // -----------------------------------------\r\n\r\n    // \"rotation\" means moving items between siblings instead of split/merge\r\n\r\n    // the following conditions are true when rotation is called:\r\n    // leftNode.parent == rightNode.parent\r\n    // leftLeaf.parent == rightLeaf.parent\r\n\r\n    // move a key item to the left between leftNode and rightNode index (non-leaf) nodes\r\n    // right node first item -> parent\r\n    // parent item -> left node\r\n    var rotateAmongNodesToLeft = function (leftNode, rightNode) {\r\n        // move item from rightNode to LeftNode\r\n        //\r\n        var parent = rightNode.parent;\r\n        var rightIndex = calcChildIndex(parent, rightNode);\r\n        //\r\n        // move the key:\r\n        leftNode.keys.add(parent.keys.items[rightIndex - 1]); // copy the key down\r\n        parent.keys.items[rightIndex - 1] = rightNode.keys.first(); // copy the key up\r\n        rightNode.keys.removeFirst(); // remove from right\r\n        //\r\n        // move the child reference:\r\n        rightNode.children.first().parent = leftNode; // update parent reference\r\n        leftNode.children.add(rightNode.children.first()); // copy to left\r\n        rightNode.children.removeFirst(); // remove from right\r\n    };\r\n\r\n    // move a key item to the right between leftNode and rightNode index (non-leaf) nodes\r\n    // left node last item -> parent\r\n    // parent item -> right node\r\n    var rotateAmongNodesToRight = function (leftNode, rightNode) {\r\n        // move item from leftNode to rightNode\r\n        //\r\n        var parent = rightNode.parent;\r\n        var rightIndex = calcChildIndex(parent, rightNode);\r\n        //\r\n        // move the key:\r\n        rightNode.keys.insert(0, parent.keys.items[rightIndex - 1]); // copy the key down\r\n        parent.keys.items[rightIndex - 1] = leftNode.keys.last(); // copy the key up\r\n        leftNode.keys.removeLast(); // remove from left\r\n        //\r\n        // move the child reference:\r\n        rightNode.children.insert(0, leftNode.children.last()); // copy to right\r\n        rightNode.children.first().parent = rightNode; // update parent reference\r\n        leftNode.children.removeLast(); // remove from left\r\n    };\r\n\r\n    // move an item to the left between leftLeaf and rightLeaf leaf nodes\r\n    // right leaf first item -> left leaf\r\n    var rotateAmongLeavesToLeft = function (leftLeaf, rightLeaf) {\r\n        // move item from rightLeaf to leftLeaf\r\n        //\r\n        var rightIndex = calcChildIndex(rightLeaf.parent, rightLeaf);\r\n        //\r\n        // copy to left:\r\n        leftLeaf.keys.add(rightLeaf.keys.first());\r\n        leftLeaf.values.add(rightLeaf.values.first());\r\n        //\r\n        // remove from right:\r\n        rightLeaf.keys.removeFirst();\r\n        rightLeaf.values.removeFirst();\r\n        //\r\n        // update parent:\r\n        rightLeaf.parent.keys.items[rightIndex - 1] = rightLeaf.keys.first();\r\n    };\r\n\r\n    // move an item to the right between leftLeaf and rightLeaf leaf nodes\r\n    // left leaf last item -> right leaf\r\n    var rotateAmongLeavesToRight = function (leftLeaf, rightLeaf) {\r\n        // move from leftLeaf to rightLeaf\r\n        //\r\n        var rightIndex = calcChildIndex(rightLeaf.parent, rightLeaf);\r\n        //\r\n        // copy to right:\r\n        rightLeaf.keys.insert(0, leftLeaf.keys.last());\r\n        rightLeaf.values.insert(0, leftLeaf.values.last());\r\n        //\r\n        // remove from left:\r\n        leftLeaf.keys.removeLast();\r\n        leftLeaf.values.removeLast();\r\n        //\r\n        // update parent:\r\n        rightLeaf.parent.keys.items[rightIndex - 1] = rightLeaf.keys.first();\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //             internal searches:\r\n    // -----------------------------------------\r\n\r\n    // short description: returns the \"child\" index in the \"node\"\r\n    // long description: calculates the \"child\" node index in the \"node.children\" array\r\n    // (usually node == child.paren)\r\n    var calcChildIndex = function (node, child) {\r\n        var key = child.keys.first();\r\n        var searchResult = node.keys.search_first(key);\r\n        if (!searchResult.found) {\r\n            if (node.children.items[searchResult.index] != child) throw \"B_PlusTree.calcChildIndex(): 1\";\r\n            return searchResult.index;\r\n        }\r\n        //\r\n        var index = searchResult.index;\r\n        for (; ; ) {\r\n            if (node.children.items[index] == child) return index;\r\n            //\r\n            index++;\r\n            if (index >= node.children.count) break;\r\n            if (node.keys.items[index - 1] != key) break;\r\n        }\r\n        throw \"B_PlusTree.calcChildIndex(): 2\";\r\n    };\r\n\r\n    // returns leaf node containing an item with the given key\r\n    var searchLeaf = function (key) {\r\n        //\r\n        var doSearchLeaf = function (node, key) {\r\n            var searchResult = node.keys.search_first(key);\r\n            //\r\n            if (node.isLeaf) {\r\n                return { node: node, found: searchResult.found, index: searchResult.index };\r\n            }\r\n            //\r\n            if (searchResult.found) {\r\n                // illustration: [left child] key [right child]\r\n                // both children (left and right i.e. before and after the key) can contain the key\r\n                //\r\n                // try the left child first:\r\n                var resultLeft = doSearchLeaf(node.children.items[searchResult.index], key);\r\n                if (resultLeft.found) return resultLeft;\r\n                //\r\n                // try the right child\r\n                return doSearchLeaf(node.children.items[searchResult.index + 1], key);\r\n            } else {\r\n                // the pointed key is greater than the searched key. Only left child can be considered:\r\n                return doSearchLeaf(node.children.items[searchResult.index], key);\r\n            }\r\n        };\r\n        //\r\n        return doSearchLeaf(m_public.root, key);\r\n    };\r\n\r\n    // returns last leaf node containing an item with the given key\r\n    var searchLastLeaf = function (key) {\r\n        //\r\n        var doSearchLastLeaf = function (node, key) {\r\n            var searchResult = node.keys.search_last(key);\r\n            //\r\n            if (node.isLeaf) {\r\n                return { node: node, found: searchResult.found, index: searchResult.index };\r\n            }\r\n            //\r\n            if (searchResult.found) {\r\n                // illustration: [left child] key [right child]\r\n                // both children (left and right i.e. before and after the key) can contain the key\r\n                //\r\n                // try the right child first:\r\n                var resultRight = doSearchLastLeaf(node.children.items[searchResult.index + 1], key);\r\n                if (resultRight.found) return resultRight;\r\n                //\r\n                // try the left child\r\n                return doSearchLastLeaf(node.children.items[searchResult.index], key);\r\n            } else {\r\n                // the pointed key is greater than the searched key. Only left child can be considered:\r\n                return doSearchLastLeaf(node.children.items[searchResult.index], key);\r\n            }\r\n        };\r\n        //\r\n        return doSearchLastLeaf(m_public.root, key);\r\n    };\r\n\r\n    // returns last leaf node containing an item with the given prefix\r\n    var searchLastLeafByPrefix = function (prefix) {\r\n        //\r\n        var doSearchLastLeafByPrefix = function (node, prefix) {\r\n            var searchResult = node.keys.search_last_prefix(prefix);\r\n            //\r\n            if (node.isLeaf) {\r\n                return { node: node, found: searchResult.found, index: searchResult.index };\r\n            }\r\n            //\r\n            if (searchResult.found) {\r\n                // illustration: [left child] key [right child]\r\n                // both children (left and right i.e. before and after the key) can contain the prefix\r\n                //\r\n                // try the right child first:\r\n                var resultRight = doSearchLastLeafByPrefix(node.children.items[searchResult.index + 1], prefix);\r\n                if (resultRight.found) return resultRight;\r\n                //\r\n                // try the left child\r\n                return doSearchLastLeafByPrefix(node.children.items[searchResult.index], prefix);\r\n            } else {\r\n                // the pointed key is greater than the searched prefix. Only left child can be considered:\r\n                return doSearchLastLeafByPrefix(node.children.items[searchResult.index], prefix);\r\n            }\r\n        };\r\n        //\r\n        return doSearchLastLeafByPrefix(m_public.root, prefix);\r\n    };\r\n\r\n    // returns leaf node containing an item with the given key and value\r\n    var searchLeafValue = function (key, value) {\r\n        // search the key:\r\n        var searchResult = searchLeaf(key);\r\n        if (!searchResult.found) return searchResult;\r\n        //\r\n        // search the value (if there are several the same keys):\r\n        var valueFound = false;\r\n        var leaf = searchResult.node;\r\n        var index = searchResult.index;\r\n        for (; ; ) {\r\n            if (index >= leaf.values.count) {\r\n                leaf = leaf.nextLeaf;\r\n                if (leaf == null) break;\r\n                index = 0;\r\n            }\r\n            if (leaf.keys.items[index] != key) break;\r\n            if (leaf.values.items[index] == value) {\r\n                valueFound = true;\r\n                break;\r\n            }\r\n            index++;\r\n        }\r\n        //\r\n        return { node: leaf, found: valueFound, index: index };\r\n    };\r\n\r\n    // returns last leaf node containing an item with the given key and value\r\n    var searchLastLeafValue = function (key, value) {\r\n        // search the key:\r\n        var searchResult = searchLastLeaf(key);\r\n        if (!searchResult.found) return searchResult;\r\n        //\r\n        // search the value (if there are several the same keys):\r\n        var valueFound = false;\r\n        var leaf = searchResult.node;\r\n        var index = searchResult.index;\r\n        //var foundIndex = 0;\r\n        for (; ; ) {\r\n            if (index < 0) {\r\n                leaf = leaf.prevLeaf;\r\n                if (leaf == null) break;\r\n                index = leaf.values.count - 1;\r\n            }\r\n            if (leaf.keys.items[index] != key) break;\r\n            if (leaf.values.items[index] == value) {\r\n                valueFound = true;\r\n                break;\r\n            }\r\n            index--;\r\n        }\r\n        //\r\n        return { node: leaf, found: valueFound, index: index };\r\n    };\r\n\r\n    // -----------------------------------------\r\n    //       return the public interface:\r\n    // -----------------------------------------\r\n\r\n    return m_public;\r\n};\r\n\r\nB_Plus_Tree.FindInfo = FindInfo;\r\n\r\n//return B_Plus_Tree;\r\nmodule.exports = B_Plus_Tree;\r\n\r\n\r\n", "var jsgui = require('lang-mini');\r\n//var Evented_Class = require('./_evented-class');\r\nconst Data_Model = require('../Data_Model');\r\n\r\nvar j = jsgui;\r\nvar Evented_Class = j.Evented_Class;\r\n//var Class = j.Class;\r\nvar each = j.each;\r\nvar is_array = j.is_array;\r\nvar is_dom_node = j.is_dom_node;\r\nvar is_ctrl = j.is_ctrl;\r\nvar extend = j.extend;\r\nvar get_truth_map_from_arr = j.get_truth_map_from_arr;\r\nvar get_map_from_arr = j.get_map_from_arr;\r\nvar arr_like_to_arr = j.arr_like_to_arr;\r\nvar tof = j.tof;\r\nvar is_defined = j.is_defined;\r\nvar stringify = j.stringify;\r\nvar functional_polymorphism = j.functional_polymorphism;\r\nvar fp = j.fp;\r\nvar arrayify = j.arrayify;\r\nvar mapify = j.mapify;\r\nvar are_equal = j.are_equal;\r\nvar get_item_sig = j.get_item_sig;\r\nvar set_vals = j.set_vals;\r\nvar truth = j.truth;\r\nvar trim_sig_brackets = j.trim_sig_brackets;\r\nvar ll_set = j.ll_set;\r\nvar ll_get = j.ll_get;\r\nvar input_processors = j.input_processors;\r\nvar iterate_ancestor_classes = j.iterate_ancestor_classes;\r\nvar is_arr_of_arrs = j.is_arr_of_arrs;\r\nvar is_arr_of_strs = j.is_arr_of_strs;\r\nvar is_arr_of_t = j.is_arr_of_t;\r\nvar clone = jsgui.clone;\r\n\r\nvar input_processors = jsgui.input_processors;\r\n\r\n// What type is the value?\r\n\r\n// Data_Model items maybe are best existing within a context.\r\n//   Not sure that's a necessary restriction / requirement.\r\n\r\n\r\n\r\n\r\n\r\nclass Data_Value extends Data_Model {\r\n\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        this.__data_value = true;\r\n        //console.log('old (1.1) Data_Value constructor');\r\n\r\n        if (spec.context) {\r\n            this.context = spec.context;\r\n        }\r\n        if (is_defined(spec.value)) {\r\n            this._ = spec.value;\r\n        }\r\n        // Maybe don't use __type.\r\n        //   instanceOf, maybe typeOf ....\r\n        this.__type = 'data_value';\r\n        //this._bound_events = {};\r\n\r\n        // Not so sure about _relationships.\r\n        //   Maybe it will be of use.\r\n\r\n        this._relationships = {};\r\n    }\r\n    // Get but with a format change?\r\n    //   Get and validate???\r\n\r\n    'get'() {\r\n        //return this._val;\r\n        return this._;\r\n    }\r\n\r\n    // get value and set value.\r\n\r\n    'value'() {\r\n        return this._;\r\n    }\r\n\r\n\r\n    'toObject'() {\r\n        return this._;\r\n\r\n    }\r\n\r\n    // .value =\r\n    //   Though .set could have more input, eg a format shifter????\r\n\r\n    'set'(val) {\r\n        //this._val = val;\r\n\r\n        // This may also need to make use of input_processors\r\n\r\n        var input_processor = input_processors[this.__type_name];\r\n\r\n\r\n        if (input_processor) {\r\n            val = input_processor(val);\r\n        }\r\n        var old_val = this._;\r\n        //console.log('old_val', old_val);\r\n        this._ = val;\r\n        //console.log('val', val);\r\n        this.raise('change', {\r\n            'old': old_val,\r\n            'value': val\r\n        });\r\n        return val;\r\n    }\r\n\r\n\r\n    'toString'() {\r\n        //return stringify(this.get());\r\n        // con\r\n        //console.log('this._val ' + stringify(this._val));\r\n        //throw 'stop';\r\n        return this.get();\r\n    }\r\n    // Maybe a particular stringify function?\r\n    'toJSON'() {\r\n        var val = this.get();\r\n        //var tval = tof(val);\r\n        var tval = typeof val;\r\n        if (tval == 'string') {\r\n            return '\"' + val + '\"';\r\n        } else {\r\n            return val;\r\n        }\r\n    }\r\n\r\n    // Need to copy / clone the ._ value\r\n\r\n    'clone'() {\r\n        var res = new Data_Value({\r\n            'value': this._\r\n        });\r\n        return res;\r\n    }\r\n\r\n    // This is important to the running of jsgui3.\r\n\r\n    '_id'() {\r\n        if (this.__id) return this.__id;\r\n        if (this.context) {\r\n            //console.log('this.__type ' + this.__type);\r\n            //throw 'stop';\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (!is_defined(this.__id)) {\r\n                throw 'DataValue should have context';\r\n                this.__id = new_data_value_id();\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n\r\n\r\n    'parent'() {\r\n        var a = arguments; a.l = arguments.length; var sig = get_a_sig(a, 1);\r\n\r\n        // .sibling_index instead. Clearer, matched HTML terminology in places.\r\n\r\n        var obj, index;\r\n        //console.log('parent sig', sig);\r\n        if (a.l == 0) {\r\n            return this._parent;\r\n        } else if (a.l == 1) {\r\n            obj = a[0];\r\n\r\n            if (!this.context && obj.context) {\r\n                this.context = obj.context;\r\n            }\r\n\r\n            var relate_by_id = function (that) {\r\n                var obj_id = obj._id();\r\n                that._relationships[obj_id] = true;\r\n            }\r\n\r\n            var relate_by_ref = function (that) {\r\n                that._parent = obj;\r\n            }\r\n            relate_by_ref(this);\r\n        } else if (a.l == 2) {\r\n            obj = a[0];\r\n            index = a[1];\r\n\r\n            if (!this.context && obj.context) {\r\n                this.context = obj.context;\r\n            }\r\n\r\n            this._parent = obj;\r\n            this._index = index;\r\n        }\r\n\r\n        /*\r\n\r\n        if (is_defined(index)) {\r\n            // I think we just set the __index property.\r\n            //  I think a __parent property and a __index property would do the job here.\r\n            //  Suits DOM heirachy.\r\n            // A __relationships property could make sense for wider things, however, it would be easy (for the moment?)\r\n            // to just have .__parent and .__index\r\n            //\r\n\r\n            // Not sure all Data_Objects will need contexts.\r\n            //  It's mainly useful for Controls so far\r\n        } else {\r\n            // get the object's id...\r\n\r\n            // setting the parent... the parent may have a context.\r\n        }\r\n\r\n        */\r\n    }\r\n};\r\n\r\nmodule.exports = Data_Value;\r\n", "\r\n\r\nclass Mini_Context {\r\n    // Need quite a simple mechanism to get IDs for objects.\r\n    // They will be typed objects/\r\n    constructor(spec) {\r\n        var map_typed_counts = {};\r\n        var typed_id = function (str_type) {\r\n            throw 'stop Mini_Context typed id';\r\n            var res;\r\n            if (!map_typed_counts[str_type]) {\r\n                res = str_type + '_0';\r\n                map_typed_counts[str_type] = 1;\r\n            } else {\r\n                res = str_type + '_' + map_typed_counts[str_type];\r\n                map_typed_counts[str_type]++;\r\n            }\r\n            return res;\r\n        };\r\n        this.new_id = typed_id;\r\n        //new_id\r\n    }\r\n    'make'(abstract_object) {\r\n        if (abstract_object._abstract) {\r\n            //var res = new\r\n            // we need the constructor function.\r\n            var constructor = abstract_object.constructor;\r\n            //console.log('constructor ' + constructor);\r\n            //throw 'stop';\r\n            var aos = abstract_object._spec;\r\n            // could use 'delete?'\r\n            aos.abstract = null;\r\n            //aos._abstract = null;\r\n            aos.context = this;\r\n            var res = new constructor(aos);\r\n            return res;\r\n        } else {\r\n            throw 'Object must be abstract, having ._abstract == true';\r\n        }\r\n    }\r\n}\r\nmodule.exports = Mini_Context;", "var jsgui = require('lang-mini');\r\n\r\n\r\n// 2022 - Looks like it could be modified into being Model, or part of one.\r\n// 2023 - In the process of doing this.\r\n\r\n\r\n//var Evented_Class = require('./_evented-class');\r\n//var Data_Structures = require('./jsgui-data-structures');\r\nvar Data_Value = require('./Data_Value');\r\n//var Constraint = require('./constraint');\r\n//var Fields_Collection = require('./fields-collection');\r\n//var Collection = require('jsgui2-collection');\r\nvar j = jsgui;\r\nvar Evented_Class = j.Evented_Class;\r\nvar Class = j.Class;\r\nvar each = j.each;\r\nvar is_array = j.is_array;\r\nvar is_dom_node = j.is_dom_node;\r\nvar is_ctrl = j.is_ctrl;\r\nvar extend = j.extend;\r\nvar get_truth_map_from_arr = j.get_truth_map_from_arr;\r\nvar get_map_from_arr = j.get_map_from_arr;\r\nvar arr_like_to_arr = j.arr_like_to_arr;\r\nvar tof = j.tof;\r\nvar is_defined = j.is_defined;\r\nvar stringify = j.stringify;\r\nvar functional_polymorphism = j.functional_polymorphism;\r\nvar fp = j.fp;\r\nvar arrayify = j.arrayify;\r\nvar mapify = j.mapify;\r\nvar are_equal = j.are_equal;\r\nvar get_item_sig = j.get_item_sig;\r\nvar get_a_sig = j.get_a_sig;\r\nvar set_vals = j.set_vals;\r\nvar truth = j.truth;\r\nvar trim_sig_brackets = j.trim_sig_brackets;\r\nvar ll_set = j.ll_set;\r\nvar ll_get = j.ll_get;\r\nvar input_processors = j.input_processors;\r\nvar iterate_ancestor_classes = j.iterate_ancestor_classes;\r\nvar is_arr_of_arrs = j.is_arr_of_arrs;\r\nvar is_arr_of_strs = j.is_arr_of_strs;\r\nvar is_arr_of_t = j.is_arr_of_t;\r\nvar clone = jsgui.clone;\r\nvar data_value_index = 0;\r\n//var data_value_abbreviation = 'val';\r\n\r\n// do data objects get an ID when they are initialized.\r\njsgui.__data_id_method = 'init';\r\n\r\n\r\n// Seems worthwhile to get rid of constraint matching and fields.\r\n//  Constraint matching will be added back in using a more functional system.\r\n//  Indexing should be put down to a simple process that calls some simple functions.\r\n//   It has got way too complicated so far. We need to map between an object (reading specific properties) and an array value.\r\n//    The lists of keys for these items will be stored within a sorted structure.\r\n\r\n// Data_Object and Data_Value both being Data_Item????\r\n// Or Data_Model ????\r\n\r\n// Or within a 'Model' category.\r\n//   This is working now as the 'M' within 'MVC' or 'CMVM'\r\n\r\n// data-model directory overall???\r\n// data_model_base perhaps????\r\n\r\n// or just start at data_model Data_Model for now.\r\n\r\n\r\n\r\n// Get fields key from object.\r\n//  Worth keeping consistent and formatted notes about what the fields key is.\r\n//  Possibly will still use some object oriented structures. Complex OO structures are easier to understand than bunches of variables.\r\n\r\n// However, an improved function that calculates field keys from objects makes sense.\r\n//  May not be impossible to fix things from this codebase.\r\n\r\n// Just not sure about the indexing right now.\r\n\r\n\r\n// This seems a little bit like 'Model'.\r\n\r\n\r\n\r\n\r\n\r\n//var obj_matches_constraint = Constraint.obj_matches_constraint;\r\n//var native_constructor_tof = jsgui.native_constructor_tof;\r\n\r\n//var value_as_field_constraint = Constraint.value_as_field_constraint;\r\n\r\n//var Ordered_String_List = Data_Structures.Ordered_String_List;\r\n\r\nconst Mini_Context = require('../Mini_Context');\r\nconst Data_Model = require('../Data_Model');\r\n\r\nvar is_js_native = function (obj) {\r\n    var t = tof(obj);\r\n\r\n    // other types????\r\n    return t == 'number' || t == 'string' || t == 'boolean' || t == 'array';\r\n};\r\n\r\n// Seems as though fields are not important to how these work effectively (fields being in obext / oext)\r\n\r\nclass Data_Object extends Data_Model {\r\n    constructor(spec = {}, fields) {\r\n        //console.log('1* spec.__type_name', spec.__type_name);\r\n        super(spec);\r\n        if (spec.id) {\r\n\t\t\tthis.__id = spec.id;\r\n\t\t}\r\n\t\tif (spec.__id) {\r\n\t\t\tthis.__id = spec.__id;\r\n\t\t}\r\n        this.__type_name = spec.__type_name || 'data_object';\r\n\r\n        // Will be better to use obext for fields.\r\n\r\n        // Does seem worth not using this any longer....\r\n        //   Replace with something more powerful?\r\n\r\n        // Moving obext field to lang-mini could help....\r\n        //   Copying it there, for the moment.\r\n        //     Could even modify obext so it passes through fields from lang-mini.\r\n\r\n\r\n\r\n        if (fields) this.set_fields_from_spec(fields, spec);\r\n\r\n        // Should incorporate data types within fields.\r\n        //   Maybe grammer too....?\r\n\r\n        this.__data_object = true;\r\n\r\n        // Do need to still be concious of performance here.\r\n        //   This is currently working as a basis for jsgui controls, which do work efficiently at the moment.\r\n        //     Will need to be careful about changing the API.\r\n        //     Could even write code at a higher level that would check which API is being used and use that....\r\n        // Late 2023 - Seems as though there is a chance to make breaking changes here and fix them.\r\n        //   So long as it makes the overall concepts clearer, and aids in more concise code.\r\n\r\n        // don't want the .value() function, use getters and setters, or maybe the obext field.\r\n\r\n        // Data_Value could have a 'name' or 'key_name' or 'key' property.\r\n        //   Could use 'key' and 'name' interchangably.\r\n        //   data_value.value ????    seems like it would be needed on some levels.\r\n        //     maybe .toObject, toNumber, toString, toArray, toJSON, toInteger, toHashString????\r\n\r\n        // \r\n\r\n        // .to(type)\r\n\r\n\r\n\r\n\r\n        //   \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        //if (!spec) spec = {};\r\n        // if it's abstract call the abstract_init.\r\n\r\n        //console.log('1** spec', spec);\r\n\r\n        // Possibly will not need to handle abstract Data_Objects.\r\n        //   It was done as an alternative to not using new with the old-style constructors, which was allowed, and could\r\n        //     be detected.\r\n\r\n        // Not sure about removing this.\r\n\r\n        //   Easier of definition of fields.\r\n        //     Fields as provided by obext. See about further support for that.\r\n        //     See about those fields supporting Grammar or other type capabilities from lang-mini.\r\n\r\n        // See about a little bit more code to get lang-mini enforcing (or providing enforcement functions to support) specific types,\r\n        //   incl ranges within types, number of DP (auto-rounding).\r\n\r\n        // \r\n\r\n\r\n\r\n\r\n        if (spec.abstract === true) {\r\n            this._abstract = true;\r\n            var tSpec = tof(spec);\r\n\r\n            if (tSpec == 'function') {\r\n                this._type_constructor = spec;\r\n                // could possibly\r\n                // but maybe want to keep this json-friendly.\r\n\r\n                // the type constructor could be used in a collection.\r\n                //  could be more leightweight than other things? specific constraint objects.\r\n            } else if (tSpec == 'object') {\r\n                this._spec = spec;\r\n                // could possibly\r\n                // but maybe want to keep this json-friendly.\r\n\r\n                // the type constructor could be used in a collection.\r\n                //  could be more leightweight than other things? specific constraint objects.\r\n            }\r\n\r\n        } else {\r\n            //var that = this;\r\n            //this._initializing = true;\r\n\r\n            var t_spec = tof(spec);\r\n            //console.log('t_spec', t_spec);\r\n\r\n            if (!this.__type) {\r\n                this.__type = 'data_object';\r\n            }\r\n\r\n            // 18/12/2016 getting rid of ._\r\n\r\n            //if (!this.hasOwnProperty('_')) {\r\n            //    this._ = {};\r\n            //}\r\n\r\n            //console.log('t_spec', t_spec);\r\n\r\n            // Maybe could check for actual controls better.\r\n            if (t_spec === 'object' || t_spec === 'control') {\r\n                // Normal initialization\r\n\r\n                if (spec.context) {\r\n                    //console.log('spec has context');\r\n                    this.context = spec.context;\r\n                }\r\n                if (spec.id) {\r\n                    this.__id = spec.id;\r\n                }\r\n                if (spec._id) {\r\n                    this.__id = spec._id;\r\n                }\r\n                if (spec.__id) {\r\n                    this.__id = spec.__id;\r\n                }\r\n                //console.log('this.__id', this.__id);\r\n                // want to see if we are using any of the spec items as fields.\r\n            } else if (t_spec == 'data_object') {\r\n                // Initialization by Data_Object value (for the moment)\r\n                // Not so sure about copying the id of another object.\r\n                if (spec.context) this.context = spec.context;\r\n                // then copy the values over from spec\r\n                \r\n                /*.\r\n                //var spec_keys = spec.keys();\r\n                //console.log('spec_keys', spec_keys);\r\n                each(spec_keys, function (i, key) {\r\n                    //that.set(key, spec.get(key));\r\n                    that.set(key, spec.get(key));\r\n                });\r\n                */\r\n            }\r\n\r\n            /*\r\n            if (!is_defined(this.__id) && jsgui.__data_id_method == 'init') {\r\n                if (this.context) {\r\n                    //console.log('this.context ' + this.context);\r\n                    //console.log('sfy this.context ' + stringify(this.context));\r\n\r\n                    // Don't need an ID here.\r\n                    //  I think.\r\n\r\n                    //console.log('getting new id');\r\n                    //this.__id = this.context.new_id(this.__type_name || this.__type);\r\n                    //console.trace();\r\n                    //console.log('DataObject new ID from context: ' + this.__id);\r\n                    //this.context.map_objects[this.__id] = this;\r\n                    // Not keeping a map of objects by id in the context.\r\n                } else {\r\n\r\n                }\r\n            }\r\n            */\r\n\r\n            if (is_defined(spec.parent)) {\r\n                //this.set('parent', spec.parent);\r\n                this.parent = spec.parent;\r\n            }\r\n\r\n            if (this.context) {\r\n                this.init_default_events();\r\n            }\r\n\r\n            //this._initializing = false;\r\n        }\r\n        //console.log('end Data_Object init');\r\n    }\r\n\r\n\r\n\r\n    'set_fields_from_spec'(fields, spec) {\r\n        // obext fields don't work like this.\r\n        //   Should do more to support obext fields, powerful functionality that raises change events.\r\n\r\n        // .field.on('change') ???\r\n\r\n        // So model.background.color would be a field (somehow???)\r\n        //   Make some advances on this level, and then integrate it into an app.\r\n\r\n\r\n\r\n\r\n\r\n\r\n        //let that = this;\r\n        each(fields, field => {\r\n            if (typeof spec[field[0]] !== 'undefined') {\r\n                this[field[0]] = spec[field[0]];\r\n            } else {\r\n                this[field[0]] = field[2];\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    'init_default_events'() {\r\n        // May still / again make use of this with some controls.\r\n\r\n    }\r\n\r\n    /*\r\n     'data_def': fp(function(a, sig) {\r\n     if (sig == '[o]') {\r\n     // create the new data_def constraint.\r\n\r\n\r\n     }\r\n     }),\r\n     */\r\n\r\n    'keys'() {\r\n        return Object.keys(this._);\r\n    }\r\n\r\n    'toJSON'() {\r\n        var res = [];\r\n        res.push('Data_Object(' + JSON.stringify(this._) + ')');\r\n        return res.join('');\r\n    }\r\n\r\n    // using_fields_connection()\r\n    //  will search up the object heirachy, to see if the Data_Objects fields need to be connected through the use of functions.\r\n    //  that will make the fields easy to change by calling a function. Should make things much faster to access than when programming with Backbone.\r\n    // then will connect the fields with connect_fields()\r\n\r\n\r\n    /*\r\n    'using_fields_connection'() {\r\n        var res = false;\r\n        iterate_ancestor_classes(this.constructor, function (a_class, stop) {\r\n            if (is_defined(a_class._connect_fields)) {\r\n                res = a_class._connect_fields;\r\n                stop();\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n    */\r\n\r\n\r\n    get parent() {\r\n        return this._parent;\r\n    }\r\n    set parent(value) {\r\n        return this._parent = value;\r\n    }\r\n\r\n    '_id'() {\r\n        // gets the id.\r\n        //console.log('Data_Object _id this.context ' + this.context);\r\n\r\n        // Should get the context at an early stage if possible.\r\n        //  Need to have it as the item is added, I think.\r\n        if (this.__id) return this.__id;\r\n        //if (!this.context) {\r\n        //    if (this.parent.context) \r\n        //}\r\n\r\n        if (this.context) {\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (this._abstract) {\r\n                return undefined;\r\n            } else if (!is_defined(this.__id)) {\r\n\r\n                // try the context of the parent.\r\n\r\n                // What does not have the abstract?\r\n\r\n                //var stack = new Error().stack;\r\n                //console.log(stack);\r\n\r\n                // no such function... but there should be something declared in many situations.\r\n                //console.trace();\r\n                //throw 'stop, currently unsupported.';\r\n                //this.__id = new_data_object_id();\r\n\r\n                //console.log('!!! no context __id ' + this.__id);\r\n                return undefined;\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n\r\n    // Problems with name (fields).\r\n    //  Fields are given as a description of the fields.\r\n    //   Gets more complicated when we have a function to access the fields as well.\r\n    //   What if we want to override that function?\r\n\r\n    // Will call it field\r\n    //  18/12/2016 - Getting rid of this confusion, will mostly remove / greatly simplify field functionality.\r\n    //  Just need to know which fields any class has, keeping track of this will use some data structures like Sorted_KVS,\r\n    //   but not much complex code within this part.\r\n\r\n    // Not so sure what a field function will do right now.\r\n    //  Does not seem like such an essential part of the API.\r\n    //   Can just define the fields, then they act a bit differently.\r\n    //   Have field handling in Data_Object.\r\n    //   Collection would have the same field capabilities. Fields should not be so important anyway.\r\n\r\n\r\n\r\n    // 18/12/2016 Will remove constraints, then make them much more functional.\r\n    \r\n\r\n    'each'(callback) {\r\n        each(this._, callback);\r\n    }\r\n\r\n\r\n    // could make this polymorphic so that it\r\n    'position_within'(parent) {\r\n        var p_id = parent._id();\r\n        //console.log('p_id ' + p_id);\r\n        //console.log('this._parents ' + stringify(this._parents));\r\n\r\n        if (this._parents && is_defined(this._parents[p_id])) {\r\n            var parent_rel_info = this._parents[p_id];\r\n            //console.log('parent_rel_info ' + stringify(parent_rel_info));\r\n\r\n            //var parents = this._parents;\r\n            //if (parents) {\r\n            //\r\n            //}\r\n            var pos_within = parent_rel_info[1];\r\n\r\n            // It is indexed by position in parent through the parent.\r\n\r\n            return pos_within;\r\n        }\r\n    }\r\n\r\n    // Maybe just 'remove' function.\r\n    //  This may be needed with multiple parents, which are not being used at the moment.\r\n\r\n    'remove_from'(parent) {\r\n        var p_id = parent._id();\r\n\r\n        if (this._parents && is_defined(this._parents[p_id])) {\r\n\r\n            var parent = this._parents[p_id][0];\r\n            var pos_within = this._parents[p_id][1];\r\n\r\n            // is the position within accurate?\r\n            var item = parent._arr[pos_within];\r\n            //console.log('item ' + stringify(item));\r\n\r\n\r\n            //console.log('');\r\n            //console.log('pos_within ' + pos_within);\r\n            // Then remove the item in the collection (or Data_Object?) ....\r\n            // and the actual parent?\r\n\r\n            // can get control / dataobject / collection by its ID of course.\r\n            parent.remove(pos_within);\r\n            // Remove it by index.\r\n            delete this._parents[p_id];\r\n        }\r\n    }\r\n\r\n    //  \r\n    // Maybe only do this with the fields anyway\r\n\r\n    'load_from_spec'(spec, arr_item_names) {\r\n        //var that = this;\r\n        each(arr_item_names, (v) => {\r\n            var spec_item = spec[v];\r\n            if (is_defined(spec_item)) {\r\n                this.set(v, spec_item);\r\n            }\r\n        });\r\n    }\r\n\r\n    // They will be treated as values in many cases anyway.\r\n    //  Will turn them to different types of object where possible.\r\n\r\n    /*\r\n    'value'() {\r\n        var a = arguments; a.l = arguments.length; var sig = get_a_sig(a, 1);\r\n        // could operate like both get and set, but does not return data_objects, returns the value itself.\r\n        var name;\r\n        //var res;\r\n        if (sig === '[s]') {\r\n            name = a[0];\r\n            var possibly_dobj = this.get(name);\r\n            //var t_obj = tof(possibly_dobj);\r\n\r\n            if (possibly_dobj) {\r\n                if (possibly_dobj.value && typeof possibly_dobj.value === 'function') {\r\n                    return possibly_dobj.value();\r\n                } else {\r\n                    return possibly_dobj;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    */\r\n\r\n    // Get could be greatly simplified as well.\r\n    //  Input and output processing will be more streamlined in a functional way.\r\n\r\n    // 19/12/2016 - Not using get or set nearly as much anyway.\r\n\r\n\r\n    'get'() {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        var do_typed_processing = false;\r\n\r\n        // Not sure about this 'typed processing'.\r\n        //  if (is_defined(this.__type_name) && this.__type_name !== 'data_object') do_typed_processing = true;\r\n\r\n        if (do_typed_processing) {\r\n            // should possibly have this assigned for controls...\r\n            //var raw_input = a;\r\n            //console.log('this.__type_name is defined: ' + this.__type_name);\r\n            //var parsed_input_obj = jsgui.input_processors[this.__type_name](raw_input);\r\n            if (a.l === 0) {\r\n                var output_obj = jsgui.output_processors[this.__type_name](this._);\r\n                return output_obj;\r\n            } else {\r\n                console.log('a', a);\r\n                console.trace();\r\n                throw 'not yet implemented';\r\n            }\r\n        } else {\r\n\r\n            // Fields will be done more simply, look up the field by name from the fields skvs.\r\n            //  Can directly use a Sorted_KVS rather than a Collection with indexing to get somet hings like\r\n            //   collection indexing done.\r\n\r\n            // Less signature checking. Make it monomorphic where possible.\r\n            //  Just get the object whether or not is is considered a field.\r\n            //   For the moment, don't look for data or anything in the ._ object.\r\n            //   Getting rid of the ._ object for the moment.\r\n            //    Could have a .private() or .p() function internally.\r\n            //    For the moment, don't have any private fields.\r\n            //  The _ object would be easily proxyable.\r\n            //   a private() object could be proxyable too.\r\n\r\n            // Get and set less important now anyway.\r\n            //  Still useful in some cases probably.\r\n\r\n\r\n\r\n            //var field_info, field_name, field_type_name;\r\n\r\n            if (sig == '[s,f]') {\r\n\r\n                // Not yet????\r\n                //   Or use promises rather than support callbacks here?\r\n                //   Or support callbacks on promises and obs?\r\n\r\n                throw 'Asyncronous access not allowed on Data_Object get.';\r\n                var res = this.get(a[0]);\r\n                var callback = a[1];\r\n                if (typeof res == 'function') {\r\n                    res(callback);\r\n                } else {\r\n                    return res;\r\n                }\r\n                // could check if we had a function returned.\r\n                //  then we execute that function\r\n                //callback(null, res);\r\n            } else if (sig == '[s]') {\r\n                var res = ll_get(this, a[0]);\r\n                return res;\r\n            } else if (a.l === 0) {\r\n                // need to get the values of all fields.\r\n                //  Think they are now being held in the field collection, fc.\r\n                return this._;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Or don't use / support get and set for the moment?\r\n    //   Only use property / field access?\r\n    //   Define property, with getter and setter, seems like a more cleanly defined system.\r\n\r\n    // May see about making a new simplified implementation of this and running it through tests.\r\n    //   Though the new Data_Value seems like the more appropriate way for the moment.\r\n\r\n    // May look into seeing where Data_Value is used in the current system too.\r\n    //   Could see about further incorportating its use (in places).\r\n\r\n\r\n\r\n\r\n\r\n    //'set': fp(function(a, sig) {\r\n    'set'() {\r\n\r\n        // Using ll_set or something recursive would be good.\r\n        //  Again, set function is much less important now that ES6 setters have arrived.\r\n\r\n        // Want a simple API here. No or very little changing of data.\r\n\r\n\r\n        // Make (more) monomorphic\r\n        //  Can greatly simplify this too.\r\n\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n\r\n        if (this._abstract) return false;\r\n\r\n        var that = this,\r\n            res;\r\n\r\n        var input_processors = jsgui.input_processors;\r\n        //if (this._module_jsgui) {\r\n        //    input_processors = this._module_jsgui.input_processors;\r\n        //} else {\r\n        //    input_processors = this._get_input_processors();\r\n        //}\r\n\r\n        if (a.l == 2 || a.l == 3) {\r\n            var property_name = a[0],\r\n                value = a[1];\r\n            var ta2 = tof(a[2]);\r\n            //console.log('ta2', ta2);\r\n            var silent = false;\r\n            var source;\r\n            if (ta2 == 'string' || ta2 == 'boolean') {\r\n                silent = a[2];\r\n            }\r\n            if (ta2 == 'control') {\r\n                source = a[2];\r\n            }\r\n            if (!this._initializing && this._map_read_only && this._map_read_only[property_name]) {\r\n                throw 'Property \"' + property_name + '\" is read-only.';\r\n            } else {\r\n                var split_pn = property_name.split('.');\r\n\r\n                if (split_pn.length > 1 && property_name != '.') {\r\n                    //console.log('split_pn ' + stringify(split_pn));\r\n                    var spn_first = split_pn[0];\r\n                    var spn_arr_next = split_pn.slice(1);\r\n                    var data_object_next = this.get(spn_first);\r\n                    //console.log('data_object_next', data_object_next);\r\n                    if (data_object_next) {\r\n                        res = data_object_next.set(spn_arr_next.join('.'), value);\r\n                        if (!silent) {\r\n                            var e_change = {\r\n                                'name': property_name,\r\n                                'value': value,\r\n                                'bubbled': true\r\n                            };\r\n                            if (source) {\r\n                                e_change.source = source;\r\n                            }\r\n                            this.raise_event('change', e_change);\r\n                        }\r\n                    } else {\r\n                        throw ('No data object at this level.');\r\n                    }\r\n                } else {\r\n                    var data_object_next = this.get(property_name);\r\n                    //console.log('data_object_next', data_object_next);\r\n                    if (data_object_next) {\r\n                        //console.log('property_name', property_name);\r\n                        //var field = this.field(property_name);\r\n                        var field = this[property_name];\r\n                        //console.log('field', field);\r\n                        if (field) {\r\n\r\n                            data_object_next.__type_name = field[1] || data_object_next.__type_name;\r\n                        }\r\n                        //console.log('property_name', property_name);\r\n                        //console.log('value', value);\r\n                        data_object_next.set(value);\r\n                        //console.log('3) data_object_next', data_object_next);\r\n                    }\r\n                    if (!is_defined(data_object_next)) {\r\n                        var tv = typeof value;\r\n                        var dv;\r\n                        //console.log('property_name', property_name);\r\n                        //console.log('tv ' + tv);\r\n                        // And for an array?\r\n                        if (tv === 'string' || tv === 'number' || tv === 'boolean' || tv === 'date') {\r\n                            dv = new Data_Value({\r\n                                'value': value\r\n                            });\r\n                        } else {\r\n                            // And could make an array into a collection.\r\n                            //  That seems like the most logical internal way of doing things.\r\n                            //  An option to have them as arrays would make sense for performance (or typed arrays),\r\n                            //   but a Collection makes the most sense logically.\r\n\r\n                            if (tv === 'array') {\r\n                                dv = new Data_Value({\r\n                                    'value': value\r\n                                });\r\n                            } else {\r\n                                if (tv === 'object') {\r\n                                    if (value.__data_object || value.__data_value || value.__data_grid) {\r\n                                        dv = value;\r\n                                    } else {\r\n                                        dv = new Data_Value({\r\n                                            'value': value\r\n                                        });\r\n                                    }\r\n                                } else {\r\n                                    //console.log('tv', tv);\r\n                                    dv = value;\r\n                                }\r\n                                //dv = value;\r\n                            }\r\n                        }\r\n                        //this._[property_name] = dv;\r\n                        this[property_name] = dv;\r\n\r\n                        if (!silent) {\r\n                            e_change = {\r\n                                'name': property_name,\r\n                                'value': dv\r\n                            };\r\n                            if (source) {\r\n                                e_change.source = source;\r\n                            }\r\n                            this.raise_event('change', e_change);\r\n                        }\r\n                        return value;\r\n                    } else {\r\n                        var next_is_js_native = is_js_native(data_object_next);\r\n                        if (next_is_js_native) {\r\n                            //console.log('is_js_native');\r\n                            //this.set\r\n                            // but maybe that object should be wrapped in Data_Object?\r\n                            //this._[property_name] = value;\r\n                            this[property_name] = value;\r\n                            res = value;\r\n                        } else {\r\n                            //console.log('not is_js_native');\r\n                            //var res = data_object_next.set(value);\r\n                            res = data_object_next;\r\n                            //this._[property_name] = data_object_next;\r\n                            this[property_name] = data_object_next;\r\n                        }\r\n\r\n\r\n                        if (!silent) {\r\n                            var e_change = {\r\n                                'name': property_name,\r\n                                'value': data_object_next.value()\r\n                            };\r\n                            if (source) {\r\n                                e_change.source = source;\r\n                            }\r\n                            this.trigger('change', e_change);\r\n                        }\r\n                        // want to listen to the set event for some things such as GUI components in particular.\r\n\r\n                        return res;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // But maybe it should be a data_value, not a data_object.\r\n            //console.log('3) else sig ' + sig);\r\n            var value = a[0];\r\n            var property_name = a[1];\r\n            var input_processor = input_processors[this.__type_name];\r\n\r\n            if (input_processor) {\r\n\r\n                // Act differently if it has a field as well?\r\n\r\n                var processed_input = input_processor(value);\r\n                //console.log('processed_input', processed_input);\r\n                value = processed_input;\r\n                this._[property_name] = value;\r\n\r\n                this.raise_event('change', {\r\n                    'value': value\r\n                });\r\n                return value;\r\n\r\n\r\n            } else {\r\n                // Need to be on the lookout for that.\r\n\r\n\r\n                // And for a Data_Object?\r\n                //  Basically put it into place.\r\n\r\n                if (sig === '[D]') {\r\n                    //console.log('property_name ' + property_name);\r\n                    this._[property_name] = value;\r\n                    // Or just have 3 parameters?\r\n                    this.raise_event('change', [property_name, value]);\r\n\r\n                    // Raise a change event?\r\n                    //  Or is set event OK?\r\n                    return value;\r\n                } else if (sig === '[o]') {\r\n                    //console.log('setting with a provided object');\r\n\r\n                    //var that = this;\r\n                    // may need to be recursive.\r\n                    res = {};\r\n                    each(a[0], function (v, i) {\r\n                        //console.log('i ' + i);\r\n                        //console.log('v ' + stringify(v));\r\n\r\n                        res[i] = that.set(i, v);\r\n                        //that.raise_event('change', [i, v]);\r\n\r\n                    });\r\n                    return res;\r\n                }\r\n\r\n                // C for collection?\r\n                if (sig === '[c]') {\r\n                    //this._[]\r\n                    this._[property_name] = value;\r\n                    this.raise_event('change', [property_name, value]);\r\n                    //throw 'unsupported';\r\n                    return value;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    'has'(property_name) {\r\n        return is_defined(this.get(property_name));\r\n    }\r\n}\r\n\r\n// Can be done just with a getter, no setter.\r\n\r\njsgui.map_classes = jsgui.map_classes || {};\r\n\r\n// seems like an overlap with the new jsgui.fromObject function.\r\n//  That will initially go in the Enhanced_Data_Object module, or jsgui-enh\r\n\r\nvar dobj = (obj, data_def) => {\r\n    // could take a data_def?\r\n    // Could use the enhanced data object if we patch backwards?\r\n    //  So Enhanced_Data_Object could hopefully patch backwards in the code?\r\n\r\n    //var tdd = tof(data_def);\r\n\r\n    var cstr = Data_Object;\r\n    //if (Enhanced_Data_Object) cstr = Enhanced_Data_Object;\r\n    //console.log('Enhanced_Data_Object ' + Enhanced_Data_Object);\r\n\r\n    var res;\r\n    if (data_def) {\r\n        res = new cstr({\r\n            'data_def': data_def\r\n        });\r\n    } else {\r\n        res = new cstr({});\r\n    }\r\n\r\n    var tobj = tof(obj);\r\n\r\n    //console.log('obj ' + stringify(obj));\r\n    if (tobj == 'object') {\r\n        var res_set = res.set;\r\n        each(obj, (v, i) => {\r\n            //res.set(i, v);\r\n            res_set.call(res, i, v);\r\n        });\r\n    }\r\n\r\n    return res;\r\n};\r\n\r\n\r\nData_Object.dobj = dobj;\r\nData_Object.Mini_Context = Mini_Context;\r\nmodule.exports = Data_Object;", "/**\r\n * Created by James on 25/09/2016.\r\n */\r\n\r\nvar jsgui = require('lang-mini');\r\nvar mapify = jsgui.mapify;\r\nvar B_Plus_Tree = require('./b-plus-tree/b-plus-tree');\r\n\r\nclass Sorted_KVS {\r\n\tconstructor(spec) {\r\n\t\tspec = spec || {};\r\n\t\t// both a dict and a BTree\r\n\t\t//  that is used in this case because the BTree only stores string keys.\r\n\t\t//  the improved B+ tree will have value objects/pointers within them\r\n\r\n\t\tif (typeof spec.unique_keys !== 'undefined') this.unique_keys = spec.unique_keys;\r\n\t\t//this.tree = new B_Plus_Tree(12); // order 12\r\n\t\tthis.tree = B_Plus_Tree(12); // order 12\r\n\r\n\r\n\t\t//this.dict = {};\r\n\t\t// likely to make the dict refer to the tree node\r\n\r\n\r\n\t}\r\n\r\n\t'clear'() {\r\n\t\tthis.tree.clear();\r\n\t\t//this.dict = {};\r\n\t}\r\n\r\n\t/*\r\n\t'put': mapify(function (key, value) {\r\n\t\t// inserting a bunch of things at once... could that be done more efficiently, such as in one traversal?\r\n\t\t//  sort the items, then can skip through the tree a bit quicker?\r\n\r\n\r\n\t\tvar insert_res = this.tree.insert(key, value);\r\n\t\t// with tree.insert - nice if we can keep the treenode as a result.\r\n\t\t//  the tree does not store objects in the node.\r\n\t\t//   could make the tree node hold a reference to the object?\r\n\r\n\t\t//console.log('put insert_res ' + insert_res);\r\n\t\t//this.dict[key] = value;\r\n\t}),\r\n\t*/\r\n\r\n\t'out'(key) {\r\n\t\t//console.log('key ' + key);\r\n\t\t//\r\n\r\n\t\tthis.tree.remove(key);\r\n\t\t//console.log('this.tree.keys_and_values() ' + stringify(this.tree.keys_and_values()));\r\n\t\t//throw '2.stop';\r\n\t\t//delete this.dict[key];\r\n\t}\r\n\r\n\t'get'(key) {\r\n\t\t//console.log('Sorted_KVS get');\r\n\t\t//console.log('key ' + stringify(key));\r\n\r\n\r\n\t\t// get all nodes with that key\r\n\r\n\t\t//var tree_res = this.tree.\r\n\t\t//console.log('this.tree.keys() ' + stringify(this.tree.keys()));\r\n\t\t//throw ('stop');\r\n\r\n\t\t//return\r\n\t\t// if this is treating the keys as unique it will just return 1 item or undefined / null.\r\n\t\t// otherwise it returns array on n items\r\n\r\n\t\t// don't want KVPs\r\n\r\n\t\treturn this.tree.get_values_by_key(key);\r\n\r\n\t\t//return this.dict[key];\r\n\t}\r\n\r\n\r\n\t'has'(key) {\r\n\t\t//return (typeof this.dict[key] !== 'undefined');\r\n\r\n\t\treturn this.key_count(key) > 0;\r\n\r\n\t}\r\n\t'get_cursor'() {\r\n\t\t//var res = new KSVS_Cursor(this);\r\n\t\t//res.move_first();\r\n\t\t//return res;\r\n\t}\r\n\r\n\r\n\t'keys'() {\r\n\r\n\t\treturn this.tree.keys();\r\n\r\n\t\t//return this.tree.keys();\r\n\t}\r\n\r\n\t'keys_and_values'() {\r\n\t\treturn this.tree.keys_and_values();\r\n\t}\r\n\r\n\t/*\r\n\t 'values': function() {\r\n\t var keys = this.keys();\r\n\t var res = [];\r\n\t var that = this;\r\n\t console.log('keys.length ' + keys.length );\r\n\t console.log('keys ' + jsgui.stringify(keys));\r\n\r\n\t each(keys, function(i, v) {\r\n\t res.push(that.dict[v]);\r\n\t });\r\n\t return res;\r\n\t },\r\n\t */\r\n\r\n\t'key_count'(key) {\r\n\r\n\t\tif (typeof key !== 'undefined') {\r\n\t\t\treturn this.tree.count(key);\r\n\t\t} else {\r\n\t\t\treturn this.tree.count();\r\n\t\t}\r\n\r\n\t\t// also want to do it for a particular key\r\n\r\n\r\n\t}\r\n\r\n\t'get_keys_by_prefix'(prefix) {\r\n\t\treturn this.tree.get_keys_by_prefix(prefix);\r\n\t}\r\n\r\n\t'each'(callback) {\r\n\t\t// iterate through every item\r\n\t\t//  key, value\r\n\t\treturn this.tree.each(callback);\r\n\t}\r\n\r\n\t'get_by_prefix'(prefix) {\r\n\r\n\t\treturn this.tree.get_by_prefix(prefix);\r\n\t}\r\n};\r\n\r\n// if we get a\r\n\r\nSorted_KVS.prototype.put = mapify(function (key, value) {\r\n\t// inserting a bunch of things at once... could that be done more efficiently, such as in one traversal?\r\n\t//  sort the items, then can skip through the tree a bit quicker?\r\n\r\n\r\n\tvar insert_res = this.tree.insert(key, value);\r\n\t//return insert_res;\r\n\t// with tree.insert - nice if we can keep the treenode as a result.\r\n\t//  the tree does not store objects in the node.\r\n\t//   could make the tree node hold a reference to the object?\r\n\r\n\r\n\t//console.log('put insert_res ' + insert_res);\r\n\t//this.dict[key] = value;\r\n});\r\n\r\nmodule.exports = Sorted_KVS;", "\r\nvar lang = require('lang-mini');\r\n//var Data_Structures = require('./jsgui-data-structures');\r\nvar Data_Value = require('./Data_Value');\r\nvar Data_Object = require('./Data_Object');\r\nvar Sorted_KVS = require('../../sorted-kvs');\r\nvar dobj = Data_Object.dobj;\r\n//console.log('Data_Object', Data_Object);\r\n//var Data_Object_Field_Collection = Data_Object.Fields_Collection;\r\n//var Constraint = require('./constraint');\r\n\r\nvar Constraint = Data_Object.Constraint;\r\nvar each = lang.each;\r\nvar tof = lang.tof;\r\nvar is_defined = lang.is_defined;\r\nvar stringify = lang.stringify;\r\nvar get_a_sig = lang.get_a_sig;\r\n//var constraint_from_obj = Constraint.from_obj;\r\nvar native_constructor_tof = lang.native_constructor_tof;\r\nvar dop = Data_Object.prototype;\r\n\r\n// Could definitely do with more work and testing.\r\n//  Being sure of what its API is.\r\n// .A fixed version of what it is now, consider and ask about improvements.\r\n\r\n// May make a new version that's a copy of it, and make breaking changes to it.\r\n//   Maybe also work on a ground-up implementation, and introduce parts of that into the new copy of Collection.\r\n\r\n// May also want a Data_Object or Data_Value that holds or uses or represents a Typed_Array.\r\n//   However, would not (be able to??) respond to changes in the value(s) in that typed aray.\r\n//    Unless some trickery was done....\r\n//    A wrapped Data_Model_Typed_Array could slow things down too much.\r\n\r\n// At some points need to be OK with holding and sometimes changing raw values.\r\n//   If you want to trigger the change notifications, use the higher level APIs.\r\n\r\n\r\n\r\n// Want to enable silent updates.\r\n//   So it does not raise events.\r\n\r\n\r\n\r\n// .silent property.\r\n//   would check for it before raising events.\r\n\r\n\r\n\r\n\r\n\r\nclass Collection extends Data_Object {\r\n    constructor(spec = {}, arr_values) {\r\n        super(spec);\r\n        this.__type = 'collection';\r\n        this.__type_name = 'collection';\r\n\r\n        var t_spec = tof(spec);\r\n        if (spec.abstract === true) {\r\n            if (t_spec === 'function') {\r\n                this.constraint(spec);\r\n            }\r\n        } else {\r\n\r\n            // For the moment, mainly wraps the ._arr object.\r\n            //   In newer version(s) may retain the ._arr property. Maybe not though.\r\n            //     Perhaps this class would better use a proxy to provide access to multiple items in the array,\r\n            //      and responding to them being changed?\r\n\r\n\r\n\r\n\r\n\r\n            this._relationships = this._relationships || {};\r\n            this._arr_idx = 0;\r\n            this._arr = [];\r\n            this.index = new Sorted_KVS();\r\n            this.fn_index = spec.fn_index;\r\n\r\n            if (t_spec === 'array') {\r\n                spec = {\r\n                    'load_array': spec\r\n                };\r\n            } else {\r\n                if (t_spec === 'function') {\r\n                    if (spec.abstract === true) {\r\n                        //throw 'Collection with abstract spec function';\r\n                        this._abstract = true;\r\n                    } else {\r\n                    }\r\n\r\n                } else if (t_spec === 'string') {\r\n                    var map_native_constructors = {\r\n                        'array': Array,\r\n                        'boolean': Boolean,\r\n                        'number': Number,\r\n                        'string': String,\r\n                        'object': Object\r\n                    }\r\n                    var nc = map_native_constructors[spec];\r\n                    if (nc) {\r\n                        spec = {\r\n                            'constraint': nc\r\n                        };\r\n                        if (nc == String) {\r\n                            spec.index_by = 'value';\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (is_defined(spec.items)) {\r\n                spec.load_array = spec.load_array || spec.items;\r\n            }\r\n            if (arr_values) {\r\n                //console.log('load arr_values ------------');\r\n                spec.load_array = arr_values;\r\n            }\r\n            // keeping these things below the expected public interface.\r\n            if (is_defined(spec.accepts)) {\r\n                this._accepts = spec.accepts;\r\n            }\r\n            if (lang.__data_id_method === 'init') {\r\n                // but maybe there will always be a context. May save download size on client too.\r\n                if (this.context) {\r\n                    this.__id = this.context.new_id(this.__type_name || this.__type);\r\n                    this.context.map_objects[this.__id] = this;\r\n                } else {\r\n                    // don't think we want a whole bunch of objects mapped like this....\r\n                    //  IDs will be very useful when they are controls... but maybe not always needed.\r\n\r\n                    //this.__id = new_collection_id();\r\n                    //map_jsgui_ids[this.__id] = this;\r\n                }\r\n            }\r\n            if (!this.__type) {\r\n\r\n            }\r\n            if (spec.load_array) {\r\n                this.load_array(spec.load_array);\r\n            }\r\n        }\r\n    }\r\n    // maybe use fp, and otherwise apply with the same params and context.\r\n    'set' (value) {\r\n        var tval = tof(value);\r\n        if (tval === 'data_object' || tval === 'data_value') {\r\n            this.clear();\r\n            return this.push(value);\r\n        } else if (tval === 'array') {\r\n            // for an array... clear, then add each.\r\n            this.clear();\r\n            each(value, (v, i) => {\r\n                this.push(v);\r\n            });\r\n        } else {\r\n            if (tval === 'collection') {\r\n                // need to reindex - though could have optimization that checks to see if the indexes are the same...\r\n                throw 'stop';\r\n                this.clear();\r\n                value.each(function (v, i) {\r\n                    that.push(v);\r\n                });\r\n            } else if (tval === 'string' || tval === 'number' || tval === 'boolean' || tval === 'null' || tval === 'undefined') {\r\n                // Single primitive value: clear and push it\r\n                this.clear();\r\n                return this.push(value);\r\n            } else {\r\n                //console.log(\"_super:\" + value);\r\n                // Fixed <BUG004>: Use proper prototype chain instead of undefined this.super\r\n                const Data_Object = require('./Data_Object');\r\n                return Data_Object.prototype.set.call(this, value);\r\n            }\r\n        }\r\n    }\r\n\r\n    'clear' () {\r\n\r\n\r\n\r\n        this._arr_idx = 0;\r\n        this._arr = [];\r\n        this.index.clear();\r\n        // listner class hears the event but then loses access to its own this.\r\n\r\n        // The future change clear event could have an immutable copy of this efore the change, and return it as the old value???\r\n\r\n        // However, Collection (maybe?) would not even have .value.\r\n        //   or .value could be the array like ._arr???\r\n        //   and also provide a ._arr interface in the future.\r\n\r\n\r\n\r\n\r\n\r\n        this.raise('change', {\r\n            'name': 'clear'\r\n        });\r\n    }\r\n\r\n    'stringify' () {\r\n        var res = [];\r\n        if (this._abstract) {\r\n            // then we can hopefully get the datatype name\r\n            // if it's abstract we detect it, otherwise it should be in there.\r\n            var ncto = native_constructor_tof(this._type_constructor);\r\n            res.push('~Collection(')\r\n            if (ncto) {\r\n                res.push(ncto);\r\n            } else {\r\n\r\n            }\r\n            res.push(')');\r\n        } else {\r\n            res.push('Collection(');\r\n            //console.log('obj._arr ' + stringify(obj._arr));\r\n            var first = true;\r\n            this.each(function (v, i) {\r\n                if (!first) {\r\n                    res.push(', ');\r\n                } else {\r\n                    first = false;\r\n                }\r\n                res.push(stringify(v));\r\n            });\r\n            res.push(')');\r\n        }\r\n        return res.join('');\r\n    }\r\n\r\n    'toString' () {\r\n        return stringify(this._arr);\r\n    }\r\n\r\n    'toObject' () {\r\n        var res = [];\r\n        this.each(function (v, i) {\r\n            res.push(v.toObject());\r\n        });\r\n        return res;\r\n    }\r\n\r\n    'each' () {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        // was callback, context\r\n        // ever given the context?\r\n\r\n        if (sig == '[f]') {\r\n            return each(this._arr, a[0]);\r\n        } else {\r\n\r\n            if (sig == '[X,f]') {\r\n                // X for index\r\n\r\n                // we use the order of the index.\r\n                //  possibly we can iterate using the index itself, maybe with that same callback.\r\n\r\n                var index = a[0];\r\n                var callback = a[1];\r\n                return index.each(callback);\r\n\r\n            } else {\r\n                if (a.l == 2) {\r\n                    return each(this._arr, a[0], a[1]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    '_id' () {\r\n        // gets the id (a new one sometimes)\r\n        if (this.context) {\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            //if (!is_defined(this.__id)) {\r\n\r\n                // get a temporary id from somewhere?\r\n                //  but the collection should really have a context...\r\n                //  or without a context, the collection is its own context?\r\n\r\n                // Won't go setting the ID for the moment.\r\n\r\n                //this.__id = new_collection_id();\r\n            //}\r\n        }\r\n        return this.__id;\r\n    }\r\n    'length' () {\r\n        return this._arr.length;\r\n    }\r\n    get len () {\r\n        return this._arr.length\r\n    }\r\n    'find' () {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        if (a.l == 1) {\r\n            var pos = this.index.get(a[0])[0];\r\n            //console.log('pos', pos);\r\n            var item = this._arr[pos];\r\n            return item;\r\n            // if there is only one index in the system then the search will be simple.\r\n        }\r\n        if (sig == '[o,s]') {\r\n            return this.index_system.find(a[0], a[1]);\r\n        }\r\n        // and if looking for more than one thing...\r\n        if (sig == '[s,s]') {\r\n            return this.index_system.find(a[0], a[1]);\r\n        }\r\n        if (sig == '[a,s]') {\r\n            return this.index_system.find(a[0], a[1]);\r\n        }\r\n        if (sig == '[s,o]') {\r\n            var propertyName = a[0];\r\n            var query = a[1];\r\n            var foundItems = [];\r\n            // for each object we need to go deeper into the fields.\r\n            each(this, (item, index) => {\r\n                if (item.get) {\r\n                    var itemProperty = item.get(propertyName);\r\n                } else {\r\n                    var itemProperty = item[propertyName];\r\n                }\r\n                var tip = tof(itemProperty);\r\n                var tip2;\r\n                var ip2;\r\n\r\n                if (tip === 'data_value') {\r\n                    var ip2 = itemProperty.value();\r\n                    tip2 = tof(ip2);\r\n                } else {\r\n                    ip2 = itemProperty;\r\n                    tip2 = tip;\r\n                }\r\n                if (tip2 === 'array') {\r\n                    each(ip2, (v, i) => {\r\n                        //console.log('v ' + stringify(v));\r\n                        var matches = obj_matches_query_obj(v, query);\r\n                        //console.log('matches ' + matches);\r\n                        if (matches) {\r\n                            foundItems.push(v);\r\n                        }\r\n                    })\r\n                };\r\n            });\r\n            var res = new Collection(foundItems);\r\n            return res;\r\n        }\r\n    }\r\n    // get seems like the way to get unique values.\r\n\r\n    'get' () {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        if (sig == '[n]' || sig == '[i]') {\r\n            return this._arr[a[0]];\r\n        }\r\n        if (sig == '[s]') {\r\n            var ix_sys = this.index_system;\r\n            var res;\r\n            if (ix_sys) {\r\n                //console.log('ix_sys', ix_sys);\r\n                var pui = ix_sys._primary_unique_index;\r\n                //console.log(pui);\r\n                res = pui.get(a[0])[0];\r\n            }\r\n            if (res) {\r\n                return res;\r\n            }\r\n            return Data_Object.prototype.get.apply(this, a);\r\n        }\r\n    }\r\n\r\n    'insert' (item, pos) {\r\n        this._arr.splice(pos, 0, item);\r\n        this.raise('change', {\r\n            'name': 'insert',\r\n            'item': item,\r\n            'value': item,\r\n            'pos': pos\r\n        });\r\n    }\r\n    swap(item, replacement) {\r\n        let r_parent = replacement.parent;\r\n        let repl_pos = replacement.parent.content.remove(replacement);\r\n        let i_parent = item.parent;\r\n        let item_pos = item.parent.content.remove(item);\r\n        let item_index;\r\n        i_parent.content.insert(replacement, item_pos);\r\n        r_parent.content.insert(item, repl_pos);\r\n    }\r\n\r\n    // may have efficiencies for adding and removing multiple items at once.\r\n    //  can be sorted for insertion into index with more rapid algorithmic time.\r\n\r\n    'remove' () {\r\n        // Make more monomorphic. ????2023????\r\n\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        //var that = this;\r\n\r\n        //console.log('remove sig:', sig);\r\n\r\n        if (sig === '[n]') {\r\n            var pos = a[0];\r\n            //console.log('pos - item index', pos);\r\n            var item = this._arr[pos];\r\n            //var o_item = item;\r\n            var spliced_pos = pos;\r\n            this._arr.splice(pos, 1);\r\n            this._arr_idx--;\r\n            //var length = this._arr.length;\r\n\r\n            /*\r\n            while (pos < length) {\r\n                // reassign the stored position of the item\r\n                var item = this._arr[pos];\r\n\r\n                // Not so sure about 'relationships' here.\r\n                //item.relationships[own_id] = [this, pos];\r\n\r\n                pos++;\r\n            }\r\n            */\r\n\r\n\r\n            var e = {\r\n                'target': this,\r\n                'value': item,\r\n                'position': spliced_pos,\r\n                'name': 'remove'\r\n            }\r\n            this.raise('change', e);\r\n\r\n            return pos;\r\n        } else if (sig === '[s]') {\r\n            var key = a[0];\r\n            var obj = this.index_system.find([\r\n                ['value', key]\r\n            ]);\r\n            var my_id = this.__id;\r\n            var item_pos_within_this = obj[0]._relationships[my_id];\r\n            this._arr.splice(item_pos_within_this, 1);\r\n            for (var c = item_pos_within_this, l = this._arr.length; c < l; c++) {\r\n                //console.log('c ' + c);\r\n                var item = this._arr[c];\r\n                item._relationships[my_id]--;\r\n            }\r\n            var e = {\r\n                'target': this,\r\n                'value': obj[0],\r\n                'position': item_pos_within_this,\r\n                'name': 'remove'\r\n            }\r\n            this.raise('change', e);\r\n        } else {\r\n            let item_index;\r\n            // or swap the item itself\r\n            const item = a[0];\r\n\r\n            // \r\n\r\n            let arr = this._arr,\r\n                l = arr.length;\r\n            if (typeof item === 'number') {\r\n                item_index = item;\r\n            } else {\r\n                let found = false,\r\n                    c = 0;\r\n                \r\n                \r\n                while (!found && c < l) {\r\n                    found = arr[c] === item;\r\n\r\n                    if (found) {\r\n                        item_index = c;\r\n                    }\r\n\r\n                    \r\n                    c++;\r\n                }\r\n                //if (found) {\r\n                //}\r\n\r\n                if (is_defined(item_index)) {\r\n                    return this.remove(item_index);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    'has' (obj_key) {\r\n        // This part needs (temp?) fixing...\r\n\r\n        //console.log('obj_key', obj_key);\r\n\r\n        if (this.get_index(obj_key) === undefined) {\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n\r\n        //console.trace();\r\n        //throw 'NYI';\r\n    }\r\n    'get_index' () {\r\n        // Make (more) monomorphic, have it consult the sorted KVS.\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        if (sig === '[s]') {\r\n\r\n            if (this.index_system) {\r\n\r\n                return this.index_system.search(a[0]);\r\n\r\n                \r\n\r\n            } else {\r\n                //console.log('a[0]', a[0]);\r\n\r\n                // Could search by name...?\r\n\r\n                //console.log('this._arr', this._arr);\r\n\r\n                if (this._arr.length === 0) {\r\n                    return undefined;\r\n                } else {\r\n\r\n                    // go through the objects in the array.\r\n                    //   check against 'name' properties...\r\n\r\n                    for (let c = 0; c < this._arr.length; c++) {\r\n                        const item = this._arr[c];\r\n\r\n\r\n\r\n                        if (item?.name === a[0]) {\r\n                            return c;\r\n                        }\r\n\r\n                    }\r\n\r\n                    return undefined;\r\n\r\n                    //console.trace();\r\n                    //throw 'stop';\r\n                }\r\n\r\n                \r\n            }\r\n\r\n            \r\n        } else {\r\n            console.trace();\r\n            throw 'Expected [s]';\r\n        }\r\n    }\r\n    \r\n    // More fp way of indexing.\r\n    'index_by' () {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n\r\n        console.log('Indexing not implemented (like this)');\r\n        console.trace();\r\n    }\r\n\r\n    'push' (value) {\r\n\r\n        const {silent} = this;\r\n\r\n\r\n\r\n        let tv = tof(value);\r\n        let fn_index = this.fn_index;\r\n        let idx_key, has_idx_key = false,\r\n            pos;\r\n        if (fn_index) {\r\n            idx_key = fn_index(value);\r\n            has_idx_key = true;\r\n        }\r\n        if (tv === 'object' || tv === 'function') {\r\n            // Long comments removed. Use functional constraint satisfaction if we have that.\r\n            pos = this._arr.length;\r\n            this._arr.push(value);\r\n            //console.log('pushing value', value);\r\n            //this.index_system.unsafe_add_object(value);\r\n            this._arr_idx++;\r\n\r\n\r\n            if (!silent) {\r\n                const e = {\r\n                    'target': this,\r\n                    'item': value,\r\n                    'value': value,\r\n                    'position': pos,\r\n                    'name': 'insert'\r\n                }\r\n                this.raise('change', e);\r\n            }\r\n\r\n            \r\n        } else if (tv === 'collection') {\r\n            pos = this._arr.length;\r\n            this._arr.push(value);\r\n            this._arr_idx++;\r\n\r\n            if (!silent) {\r\n                const e = {\r\n                    'target': this,\r\n                    'item': value,\r\n                    'value': value,\r\n                    'position': pos,\r\n                    'name': 'insert'\r\n                }\r\n                this.raise('change', e);\r\n            }\r\n\r\n        } else if (tv === 'data_object' || tv === 'control') {\r\n            pos = this._arr.length;\r\n            // Should not need a context or ID just to be put in place.\r\n            this._arr.push(value);\r\n            this._arr_idx++;\r\n            if (!silent) {\r\n                const e = {\r\n                    'target': this,\r\n                    'item': value,\r\n                    'value': value,\r\n                    'position': pos,\r\n                    'name': 'insert'\r\n                }\r\n                this.raise('change', e);\r\n            }\r\n        } else if (tv === 'array') {\r\n            const new_coll = new Collection(value);\r\n            pos = this._arr.length;\r\n            // Should not need a context or ID just to be put in place.\r\n            this._arr.push(new_coll);\r\n            if (!silent) {\r\n                const e = {\r\n                    'target': this,\r\n                    'item': value,\r\n                    'value': value,\r\n                    'position': pos,\r\n                    'name': 'insert'\r\n                }\r\n                this.raise('change', e);\r\n            }\r\n        }\r\n\r\n        // Fixed <BUG003>: Handle boolean, null, undefined by wrapping in Data_Value\r\n        if (tv === 'string' || tv === 'number' || tv === 'boolean' || tv === 'null' || tv === 'undefined') {\r\n            // Not so sure about this now.\r\n            const dv = new Data_Value({\r\n                'value': value\r\n            });\r\n            pos = this._arr.length;\r\n            // Should not need a context or ID just to be put in place.\r\n            this._arr.push(dv);\r\n            if (!silent) {\r\n                const e = {\r\n                    'target': this,\r\n                    'item': value,\r\n                    'value': value,\r\n                    'position': pos,\r\n                    'name': 'insert'\r\n                }\r\n                this.raise('change', e);\r\n            }\r\n        }\r\n        if (has_idx_key) {\r\n            this.index.put(idx_key, pos);\r\n        }\r\n        //this._arr_idx++;\r\n        return value;\r\n    }\r\n\r\n    'load_array' (arr) {\r\n        for (var c = 0, l = arr.length; c < l; c++) {\r\n            this.push(arr[c]);\r\n        }\r\n        this.raise('load');\r\n    }\r\n    'values' () {\r\n        var a = arguments;\r\n        a.l = a.length;\r\n        //var sig = get_a_sig(a, 1);\r\n        if (a.l === 0) {\r\n            return this._arr;\r\n        } else {\r\n            var stack = new Error().stack;\r\n            throw 'not yet implemented';\r\n        }\r\n    }\r\n    'value' () {\r\n        const res = [];\r\n        this.each((v, i) => {\r\n            if (typeof v.value == 'function') {\r\n                res.push(v.value());\r\n            } else {\r\n                res.push(v);\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n};\r\n\r\nvar p = Collection.prototype;\r\np.add = p.push;\r\nmodule.exports = Collection;", "module.exports = require('./old/Data_Object')", "\r\n\r\nconst Data_Model = require('../Data_Model');\r\n\r\nclass Immutable_Data_Model extends Data_Model {\r\n    constructor(...a) {\r\n        super(...a);\r\n    }\r\n}\r\n\r\nmodule.exports = Immutable_Data_Model;", "\r\n\r\nclass Validation_Result {\r\n\r\n}\r\n\r\nmodule.exports = Validation_Result;", "\r\n\r\nconst Validation_Result = require('./Validation_Result');\r\n\r\n\r\nclass Validation_Success extends Validation_Result {\r\n    constructor(spec) {\r\n\r\n        super(spec);\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Validation_Success;", "const Validation_Success = require(\"./Validation_Success\");\r\n\r\n\r\nconst setup_base_data_value_value_property = (data_value) => {\r\n\r\n    let local_js_value;\r\n\r\n    // but the old value too???\r\n    //   do we need more complex usage of isomorphic code????\r\n\r\n    const set_value_with_valid_and_changed_value = (valid_and_changed_value) => {\r\n\r\n        const old = local_js_value;\r\n        local_js_value = valid_and_changed_value;\r\n\r\n        data_value.raise('change', {\r\n            name: 'value',\r\n            old,\r\n            value: local_js_value\r\n        })\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    Object.defineProperty(data_value, 'value', {\r\n\r\n        get() {\r\n            return local_js_value;\r\n        },\r\n        set(value) {\r\n\r\n            if (data_value.transform_validate_value) {\r\n\r\n                // otherwise????\r\n                //   nothing yet.\r\n\r\n                // assume the other functions:\r\n                // is_value_correct_type\r\n                // can_value_be_parsed_to_correct_type\r\n                // parse_value\r\n                // validate_value\r\n\r\n\r\n                // .assess_set ????\r\n\r\n                // maybe a set_with_valid_value function?\r\n\r\n                // get the transform and validare result obj\r\n\r\n                const obj_transform_and_validate_value_results = data_value.transform_validate_value(value);\r\n                //console.log('obj_transform_and_validate_value_results', obj_transform_and_validate_value_results);\r\n\r\n                if (obj_transform_and_validate_value_results.validation instanceof Validation_Success) {\r\n                    // need to check that it's changed....\r\n\r\n\r\n                    if (obj_transform_and_validate_value_results.transformed_value !== undefined) {\r\n                        const value_has_changed = local_js_value !== obj_transform_and_validate_value_results.transformed_value;\r\n\r\n                        if (value_has_changed) {\r\n                            set_value_with_valid_and_changed_value(obj_transform_and_validate_value_results.transformed_value);\r\n                        } else {\r\n                            // maybe nothing here now.\r\n\r\n                        }\r\n                    } else {\r\n                        const value_has_changed = local_js_value !== obj_transform_and_validate_value_results.value;\r\n\r\n                        if (value_has_changed) {\r\n                            set_value_with_valid_and_changed_value(obj_transform_and_validate_value_results.value);\r\n                        } else {\r\n                            // maybe nothing here now.\r\n\r\n                        }\r\n                    }\r\n\r\n                    \r\n\r\n                }\r\n\r\n\r\n\r\n            } else {\r\n                set_value_with_valid_and_changed_value(value);\r\n            }\r\n\r\n            // Will make use of various subclass helper functions when they are available.\r\n\r\n\r\n\r\n\r\n            // transform_validate_value\r\n            // parse_validate_value\r\n\r\n            //if (data_value.validate_value)\r\n\r\n        }\r\n\r\n    })\r\n\r\n\r\n}\r\n\r\nmodule.exports = setup_base_data_value_value_property;", "var jsgui = require('lang-mini');\r\n//var Evented_Class = require('./_evented-class');\r\nconst {more_general_equals} = require('./tools');\r\nconst Data_Model = require('../Data_Model');\r\nconst Immutable_Data_Model = require('./Immutable_Data_Model');\r\n\r\nconst {is_defined, input_processors, field, tof, each} = jsgui;\r\n\r\nconst setup_base_data_value_value_property = require('./setup_base_data_value_value_property');\r\n\r\n// What type is the value???\r\n\r\n// Examples / tests of using this in this module could help.\r\n//   Benchmarks too?\r\nlet util;\r\nif (typeof window === 'undefined') {\r\n    const str_utl = 'util';\r\n    util = require(str_utl);    \r\n}\r\n\r\n\r\nconst lpurple = x => '\\x1b[38;5;129m' + x + '\\x1b[0m';\r\nconst ldarkPurple = x => `\\x1b[38;5;54m${x}\\x1b[0m`;\r\n\r\n// Possibly do some (much?) simpler tests to start with...\r\n\r\n// Copy the value when it gets set somehow.\r\n\r\n// Not actually all that much shared between the mutable and immutable versions right now.\r\n//   Could come back to this later.\r\n\r\n\r\n\r\nclass Base_Data_Value extends Data_Model {\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        this.__data_value = true;\r\n\r\n        if (spec.data_type) this.data_type = spec.data_type;\r\n        if (spec.context) {\r\n            this.context = spec.context;\r\n        }\r\n        this.__type = 'data_value';\r\n\r\n        // this.__data_type = ...\r\n        // this.__data_type_name = ... ?\r\n\r\n        //this._bound_events = {};\r\n        this._relationships = {};\r\n\r\n        //console.log('Base_Data_Value spec', spec);\r\n\r\n        // Does not have the field for 'value' though....\r\n\r\n        // this.setup_value_property????\r\n\r\n\r\n        \r\n\r\n\r\n        // So here field ('value') is doing most of the work here.\r\n\r\n        //  Do want to see about setting up the sub-fields too....\r\n\r\n        const {data_type, context} = this;\r\n\r\n        \r\n        //setup_base_data_value_value_property(this);\r\n\r\n\r\n        // Defining the property here could work....\r\n\r\n\r\n\r\n\r\n        // Some kind of post-constructor function?????\r\n\r\n        // or use an event handler and event????\r\n\r\n\r\n        //setImmediate(() => {\r\n        //    if (spec.value) {\r\n        //        this.value = spec.value;\r\n        //    }\r\n        //})\r\n\r\n    }\r\n\r\n    \r\n\r\n    equals(other) {\r\n        // Are they both Data_Values???\r\n\r\n        // or use Data_Model ???\r\n\r\n        // make a general equals here, give it this for the moment.\r\n        //   the more general equals will be used recursively for comparing arrays.\r\n\r\n        return more_general_equals(this, other);\r\n\r\n    }\r\n\r\n    // Maybe see about immutable mode Data_Values / Data_Models.\r\n    //   Or do make the immutable versions of all of them!!!\r\n    //     And could make core functionality for both the immutable and mutable versions.\r\n    //       Mutability Independent Code.\r\n\r\n\r\n    // Immutable_Data_Integer does seem like it would in principle be (really?) simple.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /*\r\n    toImmutable() {\r\n        // May be slightly difficult / tricky / complex.\r\n        const {context, data_type, value} = this;\r\n\r\n        // Create the new item...\r\n        // Needs to copy the inner value....?\r\n\r\n        const res = new Immutable_Data_Value({\r\n            context, data_type, value\r\n        });\r\n        return res;\r\n    }\r\n    */\r\n\r\n    \r\n    'get'() {\r\n        return this.value;\r\n    }\r\n\r\n    'toString'() {\r\n        //return stringify(this.get());\r\n        // con\r\n        //console.log('this._val ' + stringify(this._val));\r\n        //throw 'stop';\r\n        return this.get() + '';\r\n    }\r\n    // Maybe a particular stringify function?\r\n    'toJSON'() {\r\n        return JSON.stringify(this.get());\r\n    }\r\n\r\n    // Need to copy / clone the ._ value\r\n    /*\r\n    'clone'() {\r\n\r\n        //return this.toImmutable();\r\n    }\r\n    */\r\n\r\n    // This is important to the running of jsgui3.\r\n    //   Move to the lower level of Data_Model?\r\n\r\n\r\n    '_id'() {\r\n        if (this.__id) return this.__id;\r\n        if (this.context) {\r\n            //console.log('this.__type ' + this.__type);\r\n            //throw 'stop';\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (!is_defined(this.__id)) {\r\n                throw 'Data_Value should have context';\r\n                this.__id = new_data_value_id();\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Base_Data_Value;", "class Value_Set_Attempt {\r\n    constructor(spec = {}) {\r\n        // name, old, value (attempted value), success, (current???), error(s)?, reasons????\r\n        // failure.reasons could help....\r\n\r\n        // .success.token perhaps too....\r\n        // .success.transaction.id ????\r\n\r\n        Object.assign(this, spec);\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Value_Set_Attempt;", "var jsgui = require('lang-mini');\r\n//var Evented_Class = require('./_evented-class');\r\nconst {more_general_equals} = require('./tools');\r\nconst Data_Model = require('../Data_Model');\r\nconst Immutable_Data_Model = require('./Immutable_Data_Model');\r\n\r\nconst {is_defined, input_processors, field, tof, each} = jsgui;\r\n\r\n// What type is the value???\r\n\r\n// Examples / tests of using this in this module could help.\r\n//   Benchmarks too?\r\nlet util;\r\nif (typeof window === 'undefined') {\r\n    const str_utl = 'util';\r\n    util = require(str_utl);    \r\n}\r\n\r\n\r\nconst lpurple = x => '\\x1b[38;5;129m' + x + '\\x1b[0m';\r\nconst ldarkPurple = x => `\\x1b[38;5;54m${x}\\x1b[0m`;\r\n\r\n// Possibly do some (much?) simpler tests to start with...\r\n\r\n// Copy the value when it gets set somehow.\r\n\r\n// Not actually all that much shared between the mutable and immutable versions right now.\r\n//   Could come back to this later.\r\n\r\n\r\n\r\nclass Immutable_Base_Data_Value extends Immutable_Data_Model {\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        this.__data_value = true;\r\n\r\n        if (spec.data_type) this.data_type = spec.data_type;\r\n        if (spec.context) {\r\n            this.context = spec.context;\r\n        }\r\n        this.__type = 'data_value';\r\n\r\n        // this.__data_type = ...\r\n        // this.__data_type_name = ... ?\r\n\r\n        //this._bound_events = {};\r\n        this._relationships = {};\r\n\r\n\r\n        // So here field ('value') is doing most of the work here.\r\n\r\n        //  Do want to see about setting up the sub-fields too....\r\n\r\n        const {data_type, context} = this;\r\n\r\n    }\r\n\r\n    equals(other) {\r\n        // Are they both Data_Values???\r\n\r\n        // or use Data_Model ???\r\n\r\n        // make a general equals here, give it this for the moment.\r\n        //   the more general equals will be used recursively for comparing arrays.\r\n\r\n        return more_general_equals(this, other);\r\n\r\n    }\r\n\r\n    // Maybe see about immutable mode Data_Values / Data_Models.\r\n    //   Or do make the immutable versions of all of them!!!\r\n    //     And could make core functionality for both the immutable and mutable versions.\r\n    //       Mutability Independent Code.\r\n\r\n\r\n    // Immutable_Data_Integer does seem like it would in principle be (really?) simple.\r\n\r\n\r\n\r\n\r\n\r\n\r\n    \r\n\r\n    /*\r\n    toImmutable() {\r\n        // May be slightly difficult / tricky / complex.\r\n        const {context, data_type, value} = this;\r\n\r\n        // Create the new item...\r\n        // Needs to copy the inner value....?\r\n\r\n        const res = new Immutable_Data_Value({\r\n            context, data_type, value\r\n        });\r\n        return res;\r\n    }\r\n    */\r\n\r\n    \r\n    'get'() {\r\n        return this.value;\r\n    }\r\n\r\n    'toString'() {\r\n        //return stringify(this.get());\r\n        // con\r\n        //console.log('this._val ' + stringify(this._val));\r\n        //throw 'stop';\r\n        return this.get() + '';\r\n    }\r\n    // Maybe a particular stringify function?\r\n    'toJSON'() {\r\n        return JSON.stringify(this.get());\r\n    }\r\n\r\n    // Need to copy / clone the ._ value\r\n    /*\r\n    'clone'() {\r\n\r\n        //return this.toImmutable();\r\n    }\r\n    */\r\n\r\n    // This is important to the running of jsgui3.\r\n    //   Move to the lower level of Data_Model?\r\n\r\n\r\n    '_id'() {\r\n        if (this.__id) return this.__id;\r\n        if (this.context) {\r\n            //console.log('this.__type ' + this.__type);\r\n            //throw 'stop';\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (!is_defined(this.__id)) {\r\n                throw 'Immutable_Base_Data_Value should have context';\r\n                this.__id = new_data_value_id();\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Immutable_Base_Data_Value;", "var jsgui = require('lang-mini');\r\n//var Evented_Class = require('./_evented-class');\r\nconst {more_general_equals} = require('./tools');\r\nconst Data_Model = require('../Data_Model');\r\nconst Immutable_Data_Model = require('./Immutable_Data_Model');\r\nconst Immutable_Base_Data_Value = require('./Immutable_Base_Data_Value');\r\n\r\nconst {is_defined, input_processors, field, tof, each} = jsgui;\r\n\r\n// What type is the value???\r\n\r\n// Examples / tests of using this in this module could help.\r\n//   Benchmarks too?\r\nlet util;\r\nif (typeof window === 'undefined') {\r\n    const str_utl = 'util';\r\n    util = require(str_utl);    \r\n}\r\n\r\n\r\nconst lpurple = x => '\\x1b[38;5;129m' + x + '\\x1b[0m';\r\nconst ldarkPurple = x => `\\x1b[38;5;54m${x}\\x1b[0m`;\r\n\r\n// Possibly do some (much?) simpler tests to start with...\r\n\r\n// Copy the value when it gets set somehow.\r\n\r\nclass Immutable_Data_Value extends Immutable_Base_Data_Value {\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        this.__data_value = true;\r\n        this.__immutable = true;\r\n        this.__type_name = 'data_value';\r\n\r\n        if (spec.data_type) this.data_type = spec.data_type;\r\n        if (spec.context) {\r\n            this.context = spec.context;\r\n        }\r\n\r\n        const {data_type, context} = this;\r\n        \r\n        if (data_type) {\r\n            \r\n\r\n            const to_local_js_value = (value) => {\r\n                //\r\n                if (value !== undefined) {\r\n                    const t = tof(value);\r\n                    //\r\n\r\n                    if (t === 'number' || t === 'string' || t === 'boolean') {\r\n                        return value;\r\n                    } else {\r\n\r\n                        // So if it's an array....\r\n                        //   Would need to create the items inside it.\r\n                        //     Receate inner items when making a copy of an array, as they could be Data_Values we would need to\r\n                        //     get the value of, or the bare values....\r\n\r\n                        // Does seem a bit laborious here, go through array, depending on type of item copy it in different way.\r\n                        //   As in with the inner strings, numbers and booleans we can do the direct = assignment because they\r\n                        //   dont (?) share actual objects.\r\n\r\n                        if (t === 'array') {\r\n                            // go through it....\r\n                            //const arr_value = value;\r\n                            const l = value.length;\r\n                            const res = new Array(l);\r\n                            for (let c = 0; c < l; c++) {\r\n                                res[c] = to_local_js_value(value[c]);\r\n                            }\r\n                            return res;\r\n                        } else if (t === 'data_value') {\r\n                            return value.toImmutable();\r\n                        } else {\r\n\r\n                            // If it's a Data_Value (in the/an array???) we need to get an immutable version of it.\r\n                            console.log('to_local_js_value value', value);\r\n                            console.log('t', t);\r\n                            \r\n                            console.trace();\r\n                            throw 'NYI';\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            const local_js_value = to_local_js_value(spec.value);\r\n\r\n            //  inner_js_type ???\r\n\r\n            // inner_value could help....\r\n\r\n            // TODO <BUG002>: Immutable Data_Value should have a setter that throws an error\r\n            // Currently only has getter, so assignments silently succeed\r\n            // See BUGS.md for proposed fix\r\n            Object.defineProperty(this, 'value', {\r\n                get() {\r\n                    return local_js_value;\r\n                    //return _prop_value;\r\n                }\r\n                // MISSING: set() { throw new TypeError('Cannot modify immutable Data_Value'); }\r\n            });\r\n            \r\n        } else {\r\n            \r\n            let value;\r\n\r\n            // then if it's an array, would need to slice it, and (possibly) wrap inner items as being immutable too.\r\n\r\n            if (spec.value instanceof Array) {\r\n                value = spec.value.map(x => {\r\n                    if (x instanceof Data_Model) {\r\n                        return x.toImmutable();\r\n                    } else {\r\n                        return x;\r\n                    }\r\n                })\r\n            } else {\r\n                value = spec.value;\r\n            }\r\n            // TODO <BUG002>: This property definition also needs a setter that throws\r\n            // See BUGS.md for proposed fix\r\n            Object.defineProperty(this, 'value', {\r\n                get() {\r\n                    return value\r\n                }\r\n                // MISSING: set() { throw new TypeError('Cannot modify immutable Data_Value'); }\r\n            })\r\n            //field(this, 'value', spec.value);\r\n        }\r\n        this.__type = 'data_value';\r\n\r\n        // this.__data_type = ...\r\n        // this.__data_type_name = ... ?\r\n\r\n        //this._bound_events = {};\r\n        this._relationships = {};\r\n\r\n\r\n    }\r\n\r\n    equals(other) {\r\n\r\n        return more_general_equals(this, other);\r\n    }\r\n\r\n    \r\n    toImmutable() {\r\n        // May be slightly difficult / tricky / complex.\r\n        const {context, data_type, value} = this;\r\n\r\n        // Create the new item...\r\n        // Needs to copy the inner value....?\r\n\r\n        const res = new Immutable_Data_Value({\r\n            context, data_type, value\r\n        });\r\n        return res;\r\n    }\r\n    'get'() {\r\n        return this.value;\r\n    }\r\n\r\n\r\n    'toString'() {\r\n        //return stringify(this.get());\r\n        // con\r\n        //console.log('this._val ' + stringify(this._val));\r\n        //throw 'stop';\r\n        return this.get() + '';\r\n    }\r\n    // Maybe a particular stringify function?\r\n    'toJSON'() {\r\n\r\n        // Seems like cases where sometimes \r\n\r\n        const t_value = tof(this.value);\r\n\r\n        if (t_value === 'string') {\r\n            return JSON.stringify(this.value);\r\n        } else\r\n        if (t_value === 'number') {\r\n            //\r\n            return this.value + '';\r\n\r\n        } else if (t_value === 'boolean' ) {\r\n            this.value ? 'true' : 'false'\r\n        } else if (t_value === 'array') {\r\n\r\n            let res = '[';\r\n            const l = this.value.length;\r\n            for (let c = 0; c < l; c++) {\r\n                const item = this.value[c];\r\n                if (c > 0) res += ','\r\n                if (item.toJSON) {\r\n                    res += item.toJSON();\r\n                } else {\r\n                    res += JSON.stringify(item);\r\n                }\r\n\r\n            }\r\n\r\n            res = res + ']';\r\n\r\n            return res;\r\n            //return JSON.stringify(this.value);\r\n        } else if (t_value === 'data_value') {\r\n            return this.value.toJSON();\r\n        } else if (t_value === 'undefined') {\r\n            return 'null'\r\n        } else if (t_value === 'null') {\r\n            return 'null'\r\n        } else {\r\n            console.log('toJSON this.value', this.value);\r\n            console.log('t_value', t_value);\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n\r\n        \r\n\r\n        //return JSON.stringify(this.value);\r\n    }\r\n\r\n    // Need to copy / clone the ._ value\r\n\r\n    'clone'() {\r\n        return this.toImmutable();\r\n    }\r\n\r\n    // This is important to the running of jsgui3.\r\n    //   Move to the lower level of Data_Model?\r\n\r\n\r\n    '_id'() {\r\n        if (this.__id) return this.__id;\r\n        if (this.context) {\r\n            //console.log('this.__type ' + this.__type);\r\n            //throw 'stop';\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (!is_defined(this.__id)) {\r\n                throw 'Data_Value should have context';\r\n                this.__id = new_data_value_id();\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n\r\n    'toObject'() {\r\n        return this._;\r\n\r\n    }\r\n};\r\n\r\n\r\nif (util) {\r\n    Immutable_Data_Value.prototype[util.inspect.custom] = function(depth, opts) {\r\n        //return 'foo = ' + this.foo.toUpperCase();\r\n\r\n        // But then display it in a specific color....\r\n\r\n        //return ldarkPurple(this.value);\r\n\r\n        const {value} = this;\r\n\r\n        if (value instanceof Array) {\r\n            // could go through each item in that array.\r\n\r\n            let res = ldarkPurple('[ ');\r\n            let first = true;\r\n\r\n            each(value, item => {\r\n                if (!first) {\r\n                    res = res + ldarkPurple(', ');\r\n                } else {\r\n                    first = false;\r\n                }\r\n\r\n                if (item instanceof Data_Model) {\r\n                    const item_value = item.value;\r\n                    res = res + ldarkPurple(item_value)\r\n\r\n                } else [\r\n                    res = res + ldarkPurple(item)\r\n                ]\r\n\r\n            })\r\n            res = res + ldarkPurple(' ]');\r\n            return res;\r\n\r\n        } else {\r\n            return ldarkPurple(this.value);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Immutable_Data_Value;\r\n", "var jsgui = require('lang-mini');\r\nconst {more_general_equals} = require('./tools');\r\nconst Base_Data_Value = require('./Base_Data_Value');\r\nconst Value_Set_Attempt = require('./Value_Set_Attempt');\r\nconst Data_Model = require('../Data_Model');\r\nconst Immutable_Data_Model = require('./Immutable_Data_Model');\r\nconst Immutable_Data_Value = require('./Immutable_Data_Value');\r\nconst {is_defined, input_processors, field, tof, each, is_array, Data_Type} = jsgui;\r\n\r\nconst setup_data_value_data_type_set = (data_value, data_type) => {\r\n    let local_js_value;\r\n\r\n    const define_string_value_property = () => {\r\n\r\n        Object.defineProperty(data_value, 'value', {\r\n            get() {\r\n                return local_js_value;\r\n            },\r\n            set(value) {\r\n\r\n                // Than in 'inner set'???\r\n                \r\n\r\n\r\n\r\n\r\n                //console.log('1) set(value)');\r\n\r\n                const old_value = local_js_value;\r\n\r\n                //console.log('old_value (local_js_value)', old_value);\r\n\r\n                const immu = data_value.toImmutable();\r\n\r\n                //console.log('immu', immu);\r\n                //console.log('value', value);\r\n\r\n                const value_equals_current = immu.equals(value);\r\n                //console.log('value_equals_current', value_equals_current);\r\n                if (!value_equals_current) {\r\n                    const t_value = tof(value);\r\n                    //console.log('t_value', t_value);\r\n                    let made_change = false;\r\n                    if (t_value === 'string') {\r\n                        if (local_js_value instanceof Base_Data_Value) {\r\n                            console.log('existing local_js_value instanceof Data_Value');\r\n                            console.log('local_js_value.value', local_js_value.value);\r\n                            console.log('local_js_value.data_type.name', local_js_value.data_type.name);\r\n                            console.trace();\r\n                            throw 'NYI';\r\n                        } else if (local_js_value === undefined) {\r\n                            local_js_value = value;\r\n                            made_change = true;\r\n                        } else if (typeof local_js_value === 'string') {\r\n                            local_js_value = value;\r\n                            made_change = true;\r\n                        } else {\r\n                            console.trace();\r\n                            throw 'stop';\r\n                        }\r\n                    } else {\r\n                        if (value instanceof Base_Data_Value) {\r\n                            console.log('t_value', t_value);\r\n                            console.log('value', value);\r\n                            console.trace();\r\n                            throw 'stop';\r\n                        } else {\r\n\r\n\r\n                            const tval = tof(value);\r\n\r\n                            if (tval === 'number') {\r\n                                local_js_value = value + '';\r\n                                made_change = true;\r\n\r\n                            } else {\r\n\r\n                                console.log('-- INVALID TYPE --');\r\n\r\n                                // Maybe need more handling here though....\r\n\r\n                                console.log('tof(old_value)', tof(old_value));\r\n                                console.log('tof(value)', tof(value));\r\n\r\n\r\n\r\n                                data_value.raise('validate', {\r\n                                    valid: false,\r\n                                    reason: 'Invalid Type',\r\n                                    value,\r\n                                    old: local_js_value\r\n                                });\r\n\r\n                            }\r\n\r\n                            \r\n                        }\r\n                    }\r\n                    if (made_change) {\r\n                        const my_e = {\r\n                            name: 'value',\r\n                            old: old_value,\r\n                            value: local_js_value\r\n                        }\r\n                        data_value.raise('change', my_e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    const define_data_type_typed_value_property = () => {\r\n        const {wrap_properties, property_names, property_data_types, wrap_value_inner_values, value_js_type,\r\n            abbreviated_property_names, named_property_access, numbered_property_access, parse_string} = data_type;\r\n        let num_properties;\r\n        if (property_names && property_data_types) {\r\n            if (property_names.length === property_data_types.length) {\r\n                num_properties = property_names.length;\r\n                if (numbered_property_access) {\r\n                }\r\n            }\r\n        } else if (property_names) {\r\n            num_properties = property_names.length;\r\n        }\r\n        let _current_immutable_value, _previous_immutable_value;\r\n        let prev_outer_value, current_outer_value;\r\n        let _numbered_property_access_has_been_set_up = false, _named_property_access_has_been_set_up = false;\r\n\r\n\r\n\r\n        Object.defineProperty(data_value, 'value', {\r\n            get() {\r\n                return local_js_value;\r\n            },\r\n            set(value) {\r\n                const immu = data_value.toImmutable();\r\n                const value_equals_current = immu.equals(value);\r\n                //console.log('2) set(value)');\r\n\r\n                if (value_equals_current) {\r\n\r\n                    //console.log('value_equals_current', value_equals_current);\r\n\r\n                    // Don't even validate. Maybe raise event saying set-refused?\r\n                    //   set_to_current event possibly???\r\n\r\n\r\n                } else {\r\n                    const passed_first_validation = data_type.validate(value);\r\n                    //console.log('value', value);\r\n                    //console.log('passed_first_validation', passed_first_validation);\r\n\r\n\r\n                    let passed_validation = passed_first_validation;\r\n                    if (!passed_first_validation) {\r\n                        const t_value = tof(value);\r\n                        //console.log('failed first validation t_value:', t_value);\r\n                        if (t_value === 'string' && data_type.parse_string) {\r\n                            const parsed_value = data_type.parse_string(value);\r\n                            if (parsed_value !== undefined) {\r\n                                if (data_type.validate(parsed_value)) {\r\n                                    if (!immu.equals(parsed_value)) {\r\n                                        value = parsed_value;\r\n                                        passed_validation = true;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        // \r\n                    }\r\n                    //console.log('passed_validation', passed_validation);\r\n                    if (passed_validation) {\r\n                        data_value.raise('validate', {\r\n                            valid: true,\r\n                            value\r\n                        });\r\n                    } else {\r\n                        data_value.raise('validate', {\r\n                            valid: false,\r\n                            value\r\n                        });\r\n                    }\r\n\r\n\r\n                    if (passed_validation) {\r\n                        const do_actual_set = (value) => {\r\n                            //console.log('do_actual_set');\r\n                            const array_specific_value_processing = () => {\r\n                                if (value_js_type === Array) {\r\n                                    let t = tof(local_js_value);\r\n                                    if (t === 'undefined') {\r\n                                        const create_array_with_wrapped_items = () => {\r\n                                            if (num_properties) {\r\n                                                if (wrap_value_inner_values) {\r\n                                                    if (property_data_types) {\r\n                                                        let i = 0;\r\n                                                        if (value.__immutable) {\r\n                                                            const l = value.length;\r\n                                                            const arr_wrapped_value_values = new Array(l);\r\n                                                            const value_value = value.value;\r\n                                                            do_actual_set(value_value);\r\n                                                        } else {\r\n                                                            if (value instanceof Data_Value) {\r\n                                                                const arr_wrapped_value_values = new Array(num_properties);\r\n                                                                const arr_dv_value = value.value;\r\n                                                                console.log('arr_dv_value', arr_dv_value);\r\n                                                                console.trace();\r\n                                                                throw 'stop';\r\n                                                            } else if (is_array(value)) {\r\n                                                                const arr_wrapped_value_values = value.map(value => {\r\n                                                                    const property_index = i;\r\n                                                                    let property_name;\r\n                                                                    if (property_names) {\r\n                                                                        property_name = property_names[property_index];\r\n                                                                    }\r\n                                                                    const wrapped_value = new Data_Value({context, value, data_type: property_data_types[i]});\r\n                                                                    wrapped_value.on('change', e => {\r\n                                                                        const {name} = e;\r\n                                                                        if (name === 'value') {\r\n                                                                            current_outer_value = data_value.toImmutable();\r\n                                                                            const my_e = {\r\n                                                                                name,\r\n                                                                                event_originator: wrapped_value,\r\n                                                                                parent_event: e,\r\n                                                                                value: current_outer_value\r\n                                                                            }\r\n                                                                            if (property_name) {\r\n                                                                                my_e.property_name = property_name;\r\n                                                                            }\r\n                                                                            my_e.property_index = property_index;\r\n                                                                            data_value.raise('change', my_e);\r\n                                                                            prev_outer_value = current_outer_value;\r\n                                                                        }\r\n                                                                    })\r\n                                                                    i++;\r\n                                                                    return wrapped_value;\r\n                                                                });\r\n                                                                local_js_value = arr_wrapped_value_values;\r\n                                                                const my_e = {\r\n                                                                    name: 'value',\r\n                                                                    old: _previous_immutable_value,\r\n                                                                    value: data_value.toImmutable()\r\n                                                                }\r\n                                                                data_value.raise('change', my_e);\r\n                                                            }\r\n                                                        }\r\n                                                    } else {\r\n                                                        let i = 0;\r\n                                                        const arr_wrapped_value_values = value.map(value => {\r\n                                                            const property_index = i;\r\n                                                            let property_name;\r\n                                                            if (property_names) {\r\n                                                                property_name = property_names[property_index];\r\n                                                            }\r\n                                                            const wrapped_value = new Data_Value({context, value});\r\n                                                            wrapped_value.on('change', e => {\r\n                                                                const {name} = e;\r\n                                                                if (name === 'value') {\r\n                                                                    const my_e = {\r\n                                                                        name,\r\n                                                                        event_originator: wrapped_value,\r\n                                                                        parent_event: e,\r\n                                                                        value: data_value.toImmutable()\r\n                                                                    }\r\n                                                                    if (property_name) {\r\n                                                                        my_e.property_name = property_name;\r\n                                                                    }\r\n                                                                    my_e.property_index = property_index;\r\n                                                                    data_value.raise('change', my_e);\r\n                                                                }\r\n                                                            })\r\n                                                            i++;\r\n                                                            return wrapped_value;\r\n                                                        });\r\n                                                        local_js_value = arr_wrapped_value_values;\r\n                                                    }\r\n                                                } else {\r\n                                                    local_js_value = value;\r\n                                                }\r\n                                            } else {\r\n                                                console.trace();\r\n                                                throw 'stop - number of properties not found';\r\n                                            }\r\n                                        }\r\n                                        create_array_with_wrapped_items();\r\n                                    } else if (t === 'array') {\r\n                                        const t_value = tof(value);\r\n                                        if (t_value === 'data_value') {\r\n                                            if (is_array(value.value)) {\r\n                                                if (value.value.length === local_js_value.length) {\r\n                                                    each(value.value, (inner_value, idx) => {\r\n                                                        if (inner_value instanceof Data_Model) {\r\n                                                            const matching_local_inner_value = local_js_value[idx];\r\n                                                            if (inner_value.equals(matching_local_inner_value)) {\r\n                                                            } else {\r\n                                                                matching_local_inner_value.value = inner_value;\r\n                                                            }\r\n                                                        } else {\r\n                                                            console.trace();\r\n                                                            throw 'NYI';\r\n                                                        }\r\n                                                    })\r\n                                                } else {\r\n                                                    console.trace();\r\n                                                    throw 'NYI';\r\n                                                }\r\n                                            } else {\r\n                                                console.trace();\r\n                                                throw 'NYI';\r\n                                            }\r\n                                        } else {\r\n                                            if (t_value === 'array') {\r\n                                                if (local_js_value.length === value.length) {\r\n                                                    const l = value.length;\r\n                                                    let all_local_js_items_are_data_model = true, c = 0;\r\n                                                    do {\r\n                                                        const local_item = local_js_value[c];\r\n                                                        if (!(local_item instanceof Data_Model)) {\r\n                                                            all_local_js_items_are_data_model = false;\r\n                                                        }\r\n                                                        c++;\r\n                                                    } while (all_local_js_items_are_data_model && c < l);\r\n                                                    if (all_local_js_items_are_data_model) {\r\n                                                        let c = 0;\r\n                                                        do {\r\n                                                            const local_item = local_js_value[c];\r\n                                                            local_item.value = value[c];\r\n                                                            c++;\r\n                                                        } while (c < l);\r\n                                                    } else {\r\n                                                        console.trace();\r\n                                                        throw 'NYI';\r\n                                                    }\r\n                                                } else {\r\n                                                    console.trace();\r\n                                                    throw 'NYI';\r\n                                                }\r\n                                            } else {\r\n                                                console.log('value', value);\r\n                                                console.trace();\r\n                                                throw 'NYI';\r\n                                            }\r\n                                        }\r\n                                    } else {\r\n                                    }\r\n                                } else {\r\n                                }\r\n                            }\r\n                            array_specific_value_processing();\r\n                            const general_value_processing = () => {\r\n                                if (local_js_value instanceof Base_Data_Value) {\r\n                                    console.log('existing local_js_value instanceof Data_Value');\r\n                                    console.log('local_js_value.value', local_js_value.value);\r\n                                    console.log('local_js_value.data_type.name', local_js_value.data_type.name);\r\n                                    console.trace();\r\n                                    throw 'NYI';\r\n                                } else if (local_js_value instanceof Array) {\r\n                                    if (value instanceof Data_Model) { \r\n                                        if (value.equals(local_js_value)) {\r\n                                        } else {\r\n                                            console.log('value', value);\r\n                                            console.log('local_js_value', local_js_value);\r\n                                            console.trace();\r\n                                            throw 'NYI';\r\n                                        }\r\n                                    } else if (value instanceof Array) {\r\n                                        if (property_names.length === value.length) {\r\n                                            if (property_data_types) {\r\n                                                const num_properties = property_names.length;\r\n                                                for (let i_property = 0; i_property < num_properties; i_property++) {\r\n                                                    const name = property_names[i_property];\r\n                                                    const data_type = property_data_types[i_property];\r\n                                                    if (local_js_value[i_property] instanceof Data_Value) {\r\n                                                        local_js_value[i_property].value = value[i_property];\r\n                                                    } else {\r\n                                                        console.trace();\r\n                                                        throw 'NYI';\r\n                                                    }\r\n                                                }\r\n                                                if (numbered_property_access && !_numbered_property_access_has_been_set_up) {\r\n                                                    for (let i_property = 0; i_property < num_properties; i_property++) {\r\n                                                        const name = property_names[i_property];\r\n                                                        const data_type = property_data_types[i_property];\r\n                                                        Object.defineProperty(data_value, i_property, {\r\n                                                            get() {\r\n                                                                return local_js_value[i_property];\r\n                                                            },\r\n                                                            set(value) {\r\n                                                                const item_already_there = local_js_value[i_property];\r\n                                                                if (item_already_there instanceof Data_Model) {\r\n                                                                    item_already_there.value = value;\r\n                                                                } else {\r\n                                                                    console.log('item_already_there', item_already_there);\r\n                                                                    console.trace();\r\n                                                                    throw 'stop';\r\n                                                                }\r\n                                                                if (value instanceof Data_Model) {\r\n                                                                } else {\r\n                                                                }\r\n                                                            }\r\n                                                        })\r\n                                                    }\r\n                                                    Object.defineProperty(data_value, 'length', {\r\n                                                        get() {\r\n                                                            return local_js_value.length;\r\n                                                        }\r\n                                                    });\r\n                                                    _numbered_property_access_has_been_set_up = true;\r\n                                                }\r\n                                                if (named_property_access && !_named_property_access_has_been_set_up) {\r\n                                                    if (numbered_property_access) {\r\n                                                        if (property_names) {\r\n                                                            for (let i_property = 0; i_property < num_properties; i_property++) {\r\n                                                                const name = property_names[i_property];\r\n                                                                const data_type = property_data_types[i_property];\r\n                                                                Object.defineProperty(data_value, name, {\r\n                                                                    get() {\r\n                                                                        return local_js_value[i_property];\r\n                                                                    },\r\n                                                                    set(value) {\r\n                                                                        const item_already_there = local_js_value[i_property];\r\n                                                                        if (item_already_there instanceof Data_Model) {\r\n                                                                            item_already_there.value = value;\r\n                                                                        } else {\r\n                                                                            console.log('item_already_there', item_already_there);\r\n                                                                            console.trace();\r\n                                                                            throw 'stop';\r\n                                                                        }\r\n                                                                    }\r\n                                                                })\r\n                                                            }\r\n                                                        }\r\n                                                        if (abbreviated_property_names) {\r\n                                                            for (let i_property = 0; i_property < num_properties; i_property++) {\r\n                                                                const name = abbreviated_property_names[i_property];\r\n                                                                const data_type = property_data_types[i_property];\r\n                                                                Object.defineProperty(data_value, name, {\r\n                                                                    get() {\r\n                                                                        return local_js_value[i_property];\r\n                                                                    },\r\n                                                                    set(value) {\r\n                                                                        const item_already_there = local_js_value[i_property];\r\n                                                                        if (item_already_there instanceof Data_Model) {\r\n                                                                            item_already_there.value = value;\r\n                                                                        } else {\r\n                                                                            console.log('item_already_there', item_already_there);\r\n                                                                            console.trace();\r\n                                                                            throw 'stop';\r\n                                                                        }\r\n                                                                        if (value instanceof Data_Model) {\r\n                                                                        } else {\r\n                                                                        }\r\n                                                                    }\r\n                                                                })\r\n                                                            }\r\n                                                        }\r\n                                                    }\r\n                                                    _named_property_access_has_been_set_up = true;\r\n                                                }\r\n                                            }\r\n                                        } else {\r\n                                            console.trace();\r\n                                            throw 'NYI';\r\n                                        }\r\n                                    } else {\r\n                                        console.log('value', value);\r\n                                        console.log('local_js_value', local_js_value);\r\n                                        console.log('value_equals_current', value_equals_current);\r\n                                        console.log('immu', immu);\r\n                                        console.trace();\r\n                                        throw 'NYI';\r\n                                    }\r\n                                } else {\r\n                                    if (value instanceof Data_Model) {\r\n                                        if (value.data_type === data_value.data_type) {\r\n                                            const tvv = tof(value.value);\r\n                                            if (tvv === 'number' || tvv === 'string' || tvv === 'boolean') {\r\n                                                local_js_value = value.value;\r\n                                            } else {\r\n                                                console.trace();\r\n                                                throw 'NYI';\r\n                                            }\r\n                                        } else {\r\n                                            console.trace();\r\n                                            throw 'NYI';\r\n                                        }\r\n                                    } else {\r\n                                        local_js_value = value;\r\n                                    }\r\n                                    data_value.raise('change', {\r\n                                        name: 'value',\r\n                                        old: immu,\r\n                                        value: value\r\n                                    });\r\n                                    prev_outer_value = current_outer_value;\r\n                                }\r\n                            }\r\n                            general_value_processing();\r\n                        }\r\n\r\n                        do_actual_set(value);\r\n\r\n\r\n                    } else {\r\n                    }\r\n                    \r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    if (data_type === String) {\r\n        define_string_value_property();\r\n    } else if (data_type instanceof Data_Type) {\r\n        define_data_type_typed_value_property();\r\n    } else {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n\r\n\r\n}\r\n\r\nmodule.exports = setup_data_value_data_type_set;", "var jsgui = require('lang-mini');\r\nconst {more_general_equals} = require('./tools');\r\nconst Base_Data_Value = require('./Base_Data_Value');\r\nconst Value_Set_Attempt = require('./Value_Set_Attempt');\r\nconst Data_Model = require('../Data_Model');\r\nconst Immutable_Data_Model = require('./Immutable_Data_Model');\r\nconst Immutable_Data_Value = require('./Immutable_Data_Value');\r\nconst {is_defined, input_processors, field, tof, each, is_array, Data_Type} = jsgui;\r\n\r\n\r\n\r\nconst setup_data_value_data_type_set = require('./setup_data_value_data_type_set');\r\n// Maybe make a more universal Data_Model system???\r\n\r\n\r\n// For the moment improve, test, and refactor this.\r\n\r\n// Do want to have some kind of validation status updates.\r\n\r\n// Maybe deal with 2 models as a pair.\r\n//   Synced, but possibly different data types.\r\nlet util;\r\nif (typeof window === 'undefined') {\r\n    const str_utl = 'util';\r\n    util = require(str_utl);    \r\n}\r\nconst lpurple = x => '\\x1b[38;5;129m' + x + '\\x1b[0m';\r\nconst validate_data_value = data_value => {\r\n    const {data_type} = data_value;\r\n    if (data_type) {\r\n        return data_type.validate(data_value);\r\n    } else {\r\n        return true;\r\n    }\r\n}\r\n\r\n// And attempt_set_value...\r\n\r\n// Maybe we need a Value_Set_Operator class?\r\n// Operator class carries out an operation on something.\r\n\r\n// Data_Value_Set_Operator???\r\n//  Data_Value_Set_Operator_Validator\r\n//  Data_Value_Set_Operator_Input_Transformer (eg parser)\r\n//  \r\n\r\n// Data_Model_Property class even???\r\n\r\n// data value synchronisation....????\r\n\r\n\r\n// And a Base_Data_Value too perhaps, that Data_Number and Data_String would inherit from???\r\n\r\n\r\n\r\n// Want to define relatively simply what this needs to do.\r\n//   Store a value.\r\n//   Store a value with a specified type.\r\n//   Validate changes\r\n//   Raise change events when the value is changed\r\n\r\n\r\n// May well be worth reimplementing this with simpler code.\r\n//   However, want to better test this, and syncing them where types differ.\r\n\r\n// Automatic conversion of types - while keeping the code simple / compact?\r\n\r\n// How could parts of this be moved to a separate file?\r\n//  eg setup_Data_Value_typed_set ????\r\n\r\n// Maybe when .set is called, always run create_set, always make a Value_Set_Attempt object, raise various events concerning setting\r\n// eg begin-set-attempt\r\n//    validate-set-attempt\r\n\r\n// ????\r\n\r\n\r\n\r\n\r\n\r\n// Making a Data_Array or Data_Object could help a lot here, keeping the Data_Value code itself simple.\r\n//   Or continue with this, making the test cases, and fixing the error(s) that stops it working properly.\r\n//   Refactoring code to helper file(s) could help a lot.\r\n\r\n// Maybe something like a mixin for Data_Value functionality?\r\n//   Only uses the mixin function if appropriate to the data_type / other settings.\r\n\r\n// // Want a really simple high-level API if possible.\r\n// See about making a greatly simplified Data_Value.\r\n//   Maybe working on some lower level code will help most, such as field, property?\r\n//   Data types and validation in lang-mini, use it here????\r\n\r\n// Supporting Data_Type should be relatively simple, see what functionality in Data_Type will help.\r\n//   Should be able to avoid needing hugh functions and code paths.\r\n\r\n// Maybe need a bit more API complexity to do with imput parsing / transformations.\r\n\r\n// or a plan_set function, produces a set_plan, which would include the parsing having been done already.\r\n\r\n// \r\n\r\nclass Data_Value extends Base_Data_Value {\r\n    constructor(spec = {}) {\r\n\r\n        //let using_value_as_spec;\r\n        if (typeof spec !== 'object') {\r\n            spec = {\r\n                value: spec\r\n            }\r\n        }\r\n\r\n        super(spec);\r\n\r\n\r\n        this.__data_value = true;\r\n        this.__type_name = 'data_value';\r\n        const that = this;\r\n        if (spec.data_type) {\r\n            this.data_type = spec.data_type;\r\n        } else if (spec.value?.data_type) {\r\n            this.data_type = spec.value.data_type;\r\n        }\r\n        if (spec.context) {\r\n            this.context = spec.context;\r\n        }\r\n        const {data_type, context} = this;\r\n        \r\n\r\n        // If it previously did not validate, but it then does....\r\n        // Maybe some other issues with why 'set' is not working properly accross cases.\r\n\r\n        // Sure gets complex here!!!!\r\n\r\n        // Maybe better to break down the parts into smaller and separate and named logic.\r\n        //   Typed_Data_Value perhaps????\r\n        //     Then the type specific coding in there...???\r\n\r\n\r\n\r\n        if (data_type) {\r\n            //console.log('data_type', data_type);\r\n\r\n\r\n            setup_data_value_data_type_set(this, data_type);\r\n\r\n            // string typed??? String typed????\r\n\r\n            \r\n            if (spec.value) {\r\n                this.value = spec.value;\r\n            }\r\n            \r\n        } else {\r\n\r\n            // just a field????\r\n            //   maybe it's not properly recohered on the client-side.\r\n\r\n            //console.log('* Data_Value setting .value as a field');\r\n            //  does not seem to be working properly here.\r\n            //    maybe look into this further, when not using a data_type.\r\n\r\n            // A more advanced system here than just 'field'?\r\n\r\n            // Some kind of pre-set event. Validation could then take place, and send something back to the code that would\r\n            //   do the set, giving a reason why the set operation will / should not take place.\r\n\r\n\r\n            field(this, 'value', spec.value);\r\n        }\r\n        \r\n\r\n        // This could use some functions that get generalised from the setter.\r\n        //   Could use the same code paths / use attempt_set_value when set is called.\r\n\r\n        // maybe a .last_set_succeeded value.\r\n        //   also the 'validate' event.\r\n\r\n        // Should break things up into their more logical pieces, allowing code reuse.\r\n        //   Being much more explicit would help with some things too.\r\n\r\n\r\n\r\n\r\n        \r\n        const attempt_set_value = this.attempt_set_value = (value) => {\r\n            const get_local_js_value_copy = () => {\r\n                // TODO <BUG001>: local_js_value is not defined - should this be 'value' or 'this._'?\r\n                // See BUGS.md for details and proposed fixes\r\n                const tljsv = tof(local_js_value);\r\n                if (tljsv === 'undefined' || tljsv === 'string' || tljsv === 'number') {\r\n                    return local_js_value;\r\n                } else {\r\n                    console.log('local_js_value', local_js_value);\r\n                    console.log('tljsv', tljsv);\r\n                    console.trace();\r\n                    throw 'stop';\r\n                }\r\n            }\r\n\r\n            // There will be some kind of parsing going on somehow.\r\n\r\n            const old_local_js_value = get_local_js_value_copy();\r\n            const old_equals_new = more_general_equals(old_local_js_value, value);\r\n            if (old_equals_new === true) {\r\n\r\n                // But no validation event raised....\r\n\r\n                return new Value_Set_Attempt({success: false, equal_values: true});\r\n            } else {\r\n                if (this.data_type === undefined) {\r\n                    local_js_value = value;\r\n                    const o_change = {\r\n                        name: 'value',\r\n                        old: old_local_js_value,\r\n                        value\r\n                    }\r\n                    this.raise('change', o_change);\r\n                    return new Value_Set_Attempt({success: true, value});\r\n                } else if (this.data_type instanceof Data_Type) {\r\n                    const t_value = tof(value);\r\n                    if (t_value === 'string') {\r\n                        if (this.data_type.parse_string) {\r\n                            const parsed_value = this.data_type.parse_string(value);\r\n                            if (parsed_value !== undefined) {\r\n                                const res = attempt_set_value(parsed_value);\r\n                                res.parsed = true;\r\n                                return res;\r\n                            } else {\r\n                                return new Value_Set_Attempt({success: false, value});\r\n                            }\r\n                        } else {\r\n                            console.trace();\r\n                            throw 'NYI';\r\n                        }\r\n                    } else {\r\n                        if (t_value === 'number') {\r\n                            const validation = this.data_type.validate(value);\r\n                            if (validation === true) {\r\n                                local_js_value = value;\r\n                                const o_change = {\r\n                                    name: 'value',\r\n                                    old: old_local_js_value,\r\n                                    value\r\n                                }\r\n                                this.raise('change', o_change);\r\n                                return new Value_Set_Attempt({success: true, old: old_local_js_value, value});\r\n                            } else {\r\n                                return new Value_Set_Attempt({success: false, value});\r\n                            }\r\n                        } else {\r\n                            console.log('t_value', t_value);\r\n                            console.trace();\r\n                            throw 'NYI';\r\n                        }\r\n                    }\r\n                } else if (this.data_type === String) {\r\n                    if (typeof value === 'number') {\r\n                        const res = attempt_set_value(value + '');\r\n                        res.data_type_transformation = ['number', 'string'];\r\n                        return res;\r\n                    } else if (typeof value === 'string') {\r\n                        local_js_value = value;\r\n                        const o_change = {\r\n                            name: 'value',\r\n                            old: old_local_js_value,\r\n                            value\r\n                        }\r\n                        this.raise('change', o_change);\r\n                        return new Value_Set_Attempt({success: true, old: old_local_js_value, value});\r\n                    } else {\r\n                        console.trace();\r\n                        throw 'NYI';\r\n                    }\r\n                } else {\r\n                    console.log('this.data_type', this.data_type);\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                }\r\n            }\r\n        }\r\n        this.__type = 'data_value';\r\n        this._relationships = {};\r\n    }\r\n    toImmutable() {\r\n        const {context, data_type, value} = this;\r\n        const res = new Immutable_Data_Value({\r\n            context, data_type, value\r\n        });\r\n        return res;\r\n    }\r\n    'toObject'() {\r\n        return this._;\r\n    }\r\n    'set'(val) {\r\n        this.value = val;\r\n    }\r\n    'get'() {\r\n        return this.value;\r\n    }\r\n    equals(other) {\r\n        return more_general_equals(this, other);\r\n    }\r\n    'toString'() {\r\n        return this.get() + '';\r\n    }\r\n    'toJSON'() {\r\n        const t_value = tof(this.value);\r\n        if (t_value === 'string') {\r\n            return JSON.stringify(this.value);\r\n        } else\r\n        if (t_value === 'number') {\r\n            return this.value + '';\r\n        } else if (t_value === 'boolean' ) {\r\n            this.value ? 'true' : 'false'\r\n        } else if (t_value === 'array') {\r\n            return JSON.stringify(this.value);\r\n        } else if (t_value === 'data_value') {\r\n            return this.value.toJSON();\r\n        } else if (t_value === 'undefined') {\r\n            return 'null'\r\n        } else if (t_value === 'null') {\r\n            return 'null'\r\n        } else {\r\n            console.log('toJSON this.value', this.value);\r\n            console.log('t_value', t_value);\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    'clone'() {\r\n        console.trace();\r\n        throw 'NYI';\r\n        var res = new Data_Value({\r\n            'value': this._\r\n        });\r\n        return res;\r\n    }\r\n    '_id'() {\r\n        if (this.__id) return this.__id;\r\n        if (this.context) {\r\n            this.__id = this.context.new_id(this.__type_name || this.__type);\r\n        } else {\r\n            if (!is_defined(this.__id)) {\r\n                throw 'Data_Value should have context';\r\n                this.__id = new_data_value_id();\r\n            }\r\n        }\r\n        return this.__id;\r\n    }\r\n};\r\n\r\nData_Value.sync = (a, b) => {\r\n    if (a instanceof Base_Data_Value && b instanceof Base_Data_Value) {\r\n\r\n        a.on('change', e => {\r\n            const {name, old, value} = e;\r\n            if (name === 'value') {\r\n                b.value = value;\r\n            }\r\n        });\r\n\r\n        b.on('change', e => {\r\n            const {name, old, value} = e;\r\n            if (name === 'value') {\r\n                a.value = value;\r\n            }\r\n        });\r\n\r\n    } else {\r\n        console.trace();\r\n        throw 'Unexpected types';\r\n    }\r\n\r\n}\r\n\r\nif (util) {\r\n    Data_Value.prototype[util.inspect.custom] = function(depth, opts) {\r\n        const {value} = this;\r\n        const tv = tof(value);\r\n        if (tv === 'number' || tv === 'string' || tv === 'boolean') {\r\n            return lpurple(value);\r\n        } else {\r\n            if (value instanceof Array) {\r\n                let res = lpurple('[ ');\r\n                let first = true;\r\n                each(value, item => {\r\n                    if (!first) {\r\n                        res = res + lpurple(', ');\r\n                    } else {\r\n                        first = false;\r\n                    }\r\n                    if (item instanceof Data_Model) {\r\n                        const item_value = item.value;\r\n                        res = res + lpurple(item_value)\r\n                    } else [\r\n                        res = res + lpurple(item)\r\n                    ]\r\n                })\r\n                res = res + lpurple(' ]');\r\n                return res;\r\n            } else if (value instanceof Data_Model) {\r\n                return value[util.inspect.custom]();\r\n            } else {\r\n                return lpurple(this.value);\r\n            }\r\n        }\r\n    }\r\n}\r\nmodule.exports = Data_Value;\r\n", "module.exports = require('./new/Data_Value')", "class Node {\r\n\tconstructor(spec) {\r\n\t\t// previous and next held as an array.\r\n\r\n\t\t// neighbours\r\n\t\t//  it could have no neighbours.\r\n\t\t//   a list will be empty, with no nodes.\r\n\t\t//   then it will have a node with no neighbours, which is both the first and the last node.\r\n\t\t//   then 2 nodes, 1 with each neighbour\r\n\t\t//   then 3 nodes, with the end nodes still having no neighbours.\r\n\r\n\t\t// This will just be for iterating through the list, adding, removing, doing basic operations.\r\n\t\t//  I may leave inefficient operations out, so the linked list gets used for what it is best at.\r\n\t\t//   But the inefficient/less efficient operations may be done to lower amounts, such as 12, by maintaining small LLs in data structures such as B+ trees.\r\n\r\n\t\tthis.neighbours = spec.neighbours || [];\r\n\r\n\t\t// Adding and removing while maintaining an order?\r\n\t\tthis.value = spec.value;\r\n\r\n\t\t// parent\r\n\r\n\t}\r\n\t'previous'() {\r\n\t\treturn this.neighbours[0];\r\n\t}\r\n\t'next'() {\r\n\t\treturn this.neighbours[1];\r\n\t}\r\n};\r\n\r\n// Do these linked list nodes need to have anything?\r\n//  Just the means to insert their nodes etc?\r\n//   Then their nodes could be made to carry other data by other components.\r\n\r\n// Doubly_Linked_List could extend Node.\r\n//  That way it can be put in a tree, and used for holding the data in a tree.\r\n//  Want a B+ tree so that items can get put in correctly.\r\n\r\n// Having a whole tree made up of a doubly linked list, with other structures indexing it?\r\n//  Need some more fundamental data structures. The Collection and Data_Object will be good, but it will be good to store the fields in an appropriate object.\r\n\r\n\r\n// Ordered_KVS - may be a useful one.\r\n//  Would have the double linked list inside and map.\r\n\r\n\r\n// Mapped_Linked_List? would need to know what field to look at.\r\n\r\n/*\r\nvar nodify = function(fn) {\r\n\r\n\tvar res = function(val) {\r\n\t\tif (val instanceof Node) {\r\n\t\t\treturn fn(val);\r\n\t\t} else {\r\n\t\t\tvar node = new Node({'value': val});\r\n\t\t\treturn fn(node);\r\n\t\t}\r\n\r\n\t};\r\n\treturn res;\r\n\r\n}\r\n*/\r\n\r\nclass Doubly_Linked_List {\r\n\tconstructor(spec) {\r\n\t\t// spec could be the initial items for the list.\r\n\r\n\t\tthis.first = null;\r\n\t\tthis.last = null;\r\n\r\n\t\tthis.length = 0;\r\n\t\t// harder to maintain the length when nodes could be moved around the list.\r\n\t\t//  would need to be able to see if a node is in the list to begin with...\r\n\t\t//   so each node could have a container object, and if it is set to the list already when an insert is done, then the list will be able to keep track of\r\n\t\t//    its length. That would be better than having to count them.\r\n\r\n\t}\r\n\r\n\t'each_node'(callback) {\r\n\t\t//console.log('each_node this.length ' + this.length);\r\n\r\n\t\tvar node = this.first;\r\n\t\tvar ctu = true;\r\n\t\tvar stop = function () {\r\n\t\t\tctu = false;\r\n\t\t};\r\n\t\twhile (node && ctu) {\r\n\t\t\tcallback(node, stop);\r\n\t\t\tnode = node.neighbours[1];\r\n\t\t}\r\n\t}\r\n\r\n\t'each'(callback) {\r\n\t\tthis.each_node(function (node, stop) {\r\n\t\t\tcallback(node.value, stop);\r\n\t\t});\r\n\t}\r\n\r\n\t'remove'(node) {\r\n\r\n\t\t// can not remove a value... have to remove a node.\r\n\t\t//  this will be more useful when there is a map of values.\r\n\r\n\t\tif (node.neighbours[0]) {\r\n\t\t\tnode.neighbours[0].neighbours[1] = node.neighbours[1];\r\n\t\t} else {\r\n\t\t\tthis.first = node.neighbours[1];\r\n\t\t}\r\n\r\n\t\tif (node.neighbours[1]) {\r\n\t\t\tnode.neighbours[1].neighbours[0] = node.neighbours[0];\r\n\t\t} else {\r\n\t\t\tthis.last = node.neighbours[0];\r\n\t\t}\r\n\r\n\t\tnode.neighbours = [];\r\n\r\n\t\tif (node.parent == this) {\r\n\t\t\tdelete node.parent;\r\n\t\t\tthis.length--;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// check to see if the item is a 'node' object.\r\n\t//  if it is, can insert it as a node, otherwise create the node object and insert it.\r\n\t//   a bit like wrapping values in Data_Value.\r\n\r\n\t'insert_beginning'(val) {\r\n\t\tif (val instanceof Node) {\r\n\t\t\tif (this.first == null) {\r\n\t\t\t\tthis.first = val;\r\n\t\t\t\tthis.last = val;\r\n\t\t\t\tval.neighbours = [];\r\n\t\t\t\tif (val.parent != this) {\r\n\t\t\t\t\tval.parent = this;\r\n\t\t\t\t\tthis.length++;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// insert it before first item.\r\n\t\t\t\tthis.insert_before(val, this.first);\r\n\t\t\t}\r\n\t\t\treturn val;\r\n\t\t} else {\r\n\t\t\tvar node = new Node({ 'value': val });\r\n\t\t\treturn this.insert_beginning(node);\r\n\t\t}\r\n\t}\r\n\r\n\t// could use a nodify function.\r\n\t//  or ensure_data_wrapper\r\n\r\n\t'insert_before'(val, node) {\r\n\t\t// check to see if the new value is a node.\r\n\r\n\t\tif (val instanceof Node) {\r\n\t\t\tval.neighbours = [node.neighbours[0], node];\r\n\t\t\tif (node.neighbours[0] == null) {\r\n\t\t\t\tthis.first = val;\r\n\t\t\t} else {\r\n\t\t\t\tnode.neighbours[0].neighbours[1] = val;\r\n\t\t\t}\r\n\t\t\tnode.neighbours[0] = val;\r\n\r\n\t\t\tif (val.parent != this) {\r\n\t\t\t\tval.parent = this;\r\n\t\t\t\tthis.length++;\r\n\t\t\t}\r\n\t\t\treturn val;\r\n\t\t} else {\r\n\t\t\tvar new_node = new Node({ 'value': val });\r\n\t\t\treturn this.insert_before(new_node, node);\r\n\t\t}\r\n\t}\r\n\r\n\t'insert_after'(val, node) {\r\n\t\tif (val instanceof Node) {\r\n\t\t\t//console.log('insert after node ' + node);\r\n\r\n\t\t\tval.neighbours = [node, node.neighbours[1]];\r\n\t\t\tif (node.neighbours[1] == null) {\r\n\t\t\t\tthis.last = val;\r\n\t\t\t} else {\r\n\t\t\t\tnode.neighbours[1].neighbours[0] = val;\r\n\r\n\t\t\t}\r\n\t\t\tnode.neighbours[1] = val;\r\n\r\n\t\t\t//node.neighbours[0].neighbours[1] = val;\r\n\t\t\tif (val.parent != this) {\r\n\t\t\t\tval.parent = this;\r\n\t\t\t\tthis.length++;\r\n\t\t\t}\r\n\t\t\treturn val;\r\n\t\t} else {\r\n\t\t\tvar new_node = new Node({ 'value': val });\r\n\t\t\treturn this.insert_after(new_node, node);\r\n\t\t}\r\n\t}\r\n\t// not wrapping the item in a node?\r\n\r\n\t// want one where we are not pushing nodes, but items stored in nodes.\r\n\t//  Perhaps this is a Data_Value?\r\n\t// Or a doubly_linked_node.\r\n\r\n\t// Doubly_Linked_Node could take the form [prev, item, next]\r\n\t//  [prev, item, key, next]? probably not\r\n\r\n\t//  Maybe we could put more private variables, such as 'neighbours' as a var within the init statement.\r\n\r\n\t'push'(val) {\r\n\r\n\t\tif (val instanceof Node) {\r\n\t\t\tif (this.last == null) {\r\n\t\t\t\tthis.insert_beginning(val);\r\n\t\t\t} else {\r\n\t\t\t\treturn this.insert_after(val, this.last);\r\n\t\t\t\t/*\r\n\t\t\t\t var last = this.last;\r\n\t\t\t\t last.neighbours[1] = val;\r\n\t\t\t\t this.last = val;\r\n\r\n\t\t\t\t //console.log('val.parent ' + val.parent);\r\n\t\t\t\t //console.log('this ' + this);\r\n\r\n\t\t\t\t if (val.parent != this) {\r\n\t\t\t\t val.parent = this;\r\n\t\t\t\t this.length++;\r\n\t\t\t\t }\r\n\t\t\t\t */\r\n\t\t\t}\r\n\t\t\treturn val;\r\n\t\t} else {\r\n\t\t\tvar new_node = new Node({ 'value': val });\r\n\t\t\treturn this.push(new_node);\r\n\t\t}\r\n\t\t// the item gets wrapped in a node.?\r\n\t}\r\n};\r\n\r\nDoubly_Linked_List.Node = Node;\r\n\r\nmodule.exports = Doubly_Linked_List;\r\n", "/**\r\n * Created by James on 16/09/2016.\r\n */\r\n\r\nvar Doubly_Linked_List = require('./doubly-linked-list');\r\n\r\nclass Ordered_KVS {\r\n\tconstructor() {\r\n\t\tthis.dll = new Doubly_Linked_List();\r\n\t\tthis.node_map = {};\r\n\t}\r\n\t'length'() {\r\n\t\treturn this.dll.length;\r\n\t}\r\n\t'put'(key, value) {\r\n\t\t// does it already exist with that key - if so that item gets replaced, stays in the same position?\r\n\t\t// or maybe push - that means the item that goes in gets added to the end.\r\n\t\treturn this.push(key, value);\r\n\t}\r\n\t'get'(key) {\r\n\t\t//console.log('get key ' + key);\r\n\t\tvar kvs_node = this.node_map[key];\r\n\t\tif (kvs_node) {\r\n\t\t\treturn kvs_node.value;\r\n\t\t} else {\r\n\t\t\treturn undefined;\r\n\t\t\t//throw 'Missing KVS node: ' + key;\r\n\t\t}\r\n\t}\r\n\t'push'(key, value) {\r\n\t\t// does it already have a node with that key?\r\n\t\tvar node = this.dll.push(value);\r\n\t\tnode.key = key;\r\n\t\tthis.node_map[key] = node;\r\n\t}\r\n\t'out'(key) {\r\n\t\tvar node = this.node_map[key];\r\n\t\t//delete node.key;\r\n\t\tdelete this.node_map[key]\r\n\r\n\t\tthis.dll.remove(node);\r\n\t}\r\n\t'each'(callback) {\r\n\t\t// return the key as well as the value in the callback.\r\n\t\tthis.dll.each_node(function (node, stop) {\r\n\t\t\tcallback(node.key, node.value, stop);\r\n\t\t});\r\n\t\t//this.dll.each(callback);\r\n\t}\r\n\t'values'() {\r\n\t\tvar res = [];\r\n\t\tthis.each(function (key, value) {\r\n\t\t\tres.push(value);\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\t'keys'() {\r\n\t\tvar res = [];\r\n\t\tthis.each(function (key, value) {\r\n\t\t\tres.push(key);\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\t'keys_and_values'() {\r\n\t\tvar res = [];\r\n\t\tthis.each(function (key, value) {\r\n\t\t\tres.push([key, value]);\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\t// will not need to deal with nodes on the user level.\r\n\t// want to be able to add and remove items, normally items will get pushed to the end of the list.\r\n\r\n\t// will provide a key and value in order to do this.\r\n};\r\n\r\nmodule.exports = Ordered_KVS;", "/**\r\n * Created by James on 16/09/2016.\r\n */\r\n\r\n\r\n// This could be useful for a few things, like storing tables in a DB\r\n// schema.\r\n// Maybe quite a few more things.\r\n\r\n// May make some objects with friendlier interfaces...\r\n//  And may use collection for this to store lists of strings.\r\n//  Like CSS flags at the moment.\r\n\r\n// Uses private variables.\r\nclass Ordered_String_List {\r\n\tconstructor() {\r\n\t\t// console.log('init osl sig ' + sig);\r\n\r\n\t\tvar arr = [];\r\n\t\tvar dict_indexes = {};\r\n\r\n\t\tvar reindex_dict_indexes = function () {\r\n\t\t\tdict_indexes = {};\r\n\t\t\tfor (var c = 0, l = arr.length; c < l; c++) {\r\n\t\t\t\tdict_indexes[arr[c]] = c;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// (add), remove, get, get_all, has, put, move, splice\r\n\t\tthis.has = function (value) {\r\n\t\t\treturn (typeof dict_indexes[value] !== 'undefined');\r\n\t\t}\r\n\r\n\t\tthis.put = function (value) {\r\n\t\t\t// by default puts it at the end.\r\n\t\t\tif (this.has(value)) {\r\n\t\t\t\t// stays in same place.\r\n\t\t\t\t// arr[dict_indexes[value]]\r\n\t\t\t\t// do nothing\r\n\t\t\t} else {\r\n\t\t\t\tvar index = arr.length;\r\n\t\t\t\tarr.push(value);\r\n\t\t\t\tdict_indexes[value] = index;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.out = function (value) {\r\n\t\t\tif (this.has(value)) {\r\n\t\t\t\tvar idx = dict_indexes[value];\r\n\t\t\t\tarr.splice(idx, 1);\r\n\r\n\t\t\t\tdelete dict_indexes[value];\r\n\r\n\t\t\t\tfor (var c = idx, l = arr.length; c < l; c++) {\r\n\t\t\t\t\tvar i = arr[c];\r\n\t\t\t\t\tdict_indexes[i]--;\r\n\t\t\t\t}\r\n\t\t\t\t// will need the items after it and lower their indexes.\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.toggle = function (value) {\r\n\t\t\tif (this.has(value)) {\r\n\t\t\t\tthis.out(value);\r\n\t\t\t} else {\r\n\t\t\t\tthis.put(value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.move_value = function (value, index) {\r\n\t\t\tif (this.has(value) && dict_indexes[value] != index) {\r\n\r\n\t\t\t\t// gets removed from current position, causes items after it\r\n\t\t\t\t// to move back.\r\n\t\t\t\t// gets put in new position, gets items after that to move\r\n\t\t\t\t// forwards.\r\n\r\n\t\t\t\tvar old_index = dict_indexes[value];\r\n\t\t\t\tarr.splice(old_index, 1);\r\n\r\n\t\t\t\tarr.splice(index, 0, value);\r\n\r\n\t\t\t\tif (index < old_index) {\r\n\t\t\t\t\t// moving back.\r\n\t\t\t\t\t// dict_indexes[]\r\n\t\t\t\t\tdict_indexes[arr[index]] = index;\r\n\t\t\t\t\t// the index object of the one it\r\n\r\n\t\t\t\t\t// for (var c = index, l = arr.length; c < l; c++) {\r\n\t\t\t\t\tfor (var c = index + 1; c <= old_index; c++) {\r\n\t\t\t\t\t\tdict_indexes[arr[c]]++;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (index > old_index) {\r\n\t\t\t\t\tdict_indexes[arr[index]] = index;\r\n\t\t\t\t\tfor (var c = old_index; c < index; c++) {\r\n\t\t\t\t\t\tdict_indexes[arr[c]]--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t// for testing\r\n\r\n\t\tthis._index_scan = function () {\r\n\t\t\tfor (var c = 0, l = arr.length; c < l; c++) {\r\n\t\t\t\tconsole.log('c ' + c + ' arr[c] ' + arr[c] + ' idx '\r\n\t\t\t\t\t+ dict_indexes[arr[c]]);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.toString = function () {\r\n\t\t\tvar res = arr.join(' ');\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tthis.toString.stringify = true;\r\n\r\n\t\tthis.set = (function (val) {\r\n\r\n\t\t\tif (typeof val === 'string') {\r\n\t\t\t\tarr = val.split(' ');\r\n\t\t\t\treindex_dict_indexes();\r\n\t\t\t}\r\n\r\n\t\t\t//if (sig == '[s]') {\r\n\t\t\t//\tarr = a[0].split(' ');\r\n\t\t\t//\t// console.log('arr ' + jsgui.stringify(arr));\r\n\t\t\t//\treindex_dict_indexes();\r\n\t\t\t//}\r\n\t\t});\r\n\r\n\t\t// if (sig == '[s]') {\r\n\t\t// this.set(a[0]);\r\n\t\t// }\r\n\r\n\t\tvar a = arguments;\r\n\t\tif (a.length == 1) {\r\n\t\t\tvar spec = a[0];\r\n\t\t\tif (typeof spec === 'string') {\r\n\t\t\t\t// console.log('setting');\r\n\t\t\t\tthis.set(spec);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n};\r\n\r\nmodule.exports = Ordered_String_List;", "module.exports = require('./old/Collection');", "/**\r\n * Created by James on 16/09/2016.\r\n */\r\n\r\nvar jsgui = require('lang-mini');\r\n//var Data_Structures = require('./jsgui-data-structures');\r\nvar Collection = require('./Data_Model/Collection');\r\n\r\n//var Data_Grid = require('jsgui2-data-grid');\r\n\r\nvar j = jsgui;\r\nvar each = j.each;\r\nvar tof = j.tof;\r\nvar atof = j.atof;\r\nvar is_defined = j.is_defined;\r\nvar fp = j.fp;\r\nvar arrayify = j.arrayify;\r\nvar mapify = j.mapify;\r\nvar get_item_sig = j.get_item_sig;\r\n\r\n\r\n// ta-utils?\r\n// ta-matrix\r\n// ta-tensor\r\n\r\n// Maybe expand lang-mini?\r\n// Could spin out a lang-tools project.\r\n// or jsgui3-lang, which uses lang-tools\r\n//  maybe adds some jsgui specific features.\r\n\r\n// A Matrix or Tensor data type could be very useful for single images.\r\n// A Tensor data type could conveniently hold multiple images\r\n\r\n// A Manifold Nexus would be able to store a Tensor within different storage devices / network addresses, and process them too.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//var B_Plus_Tree = Data_Structures.B_Plus_Tree;\r\n\r\n// would prefer a version that applies to typed arrays.\r\n// uses typed arrays internally\r\n\r\nvar vectorify = function(n_fn) {\r\n\t// Creates a new polymorphic function around the original one.\r\n\r\n\tvar fn_res = fp(function(a, sig) {\r\n\t\t//console.log('vectorified sig ' + sig);\r\n\t\tif (a.l > 2) {\r\n\t\t\tvar res = a[0];\r\n\t\t\tfor ( var c = 1, l = a.l; c < l; c++) {\r\n\t\t\t\tres = fn_res(res, a[c]);\r\n\t\t\t\t// console.log('res ' + res);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\tif (sig == '[n,n]') {\r\n\t\t\t\treturn n_fn(a[0], a[1]);\r\n\t\t\t} else {\r\n\t\t\t\t// will need go through the first array, and the 2nd... but\r\n\t\t\t\t// will need to compare them.\r\n\t\t\t\tvar ats = atof(a);\r\n\t\t\t\t//console.log('ats ' + stringify(ats));\r\n\t\t\t\tif (ats[0] == 'array') {\r\n\t\t\t\t\tif (ats[1] == 'number') {\r\n\t\t\t\t\t\tvar res = [], n = a[1];\r\n\t\t\t\t\t\teach(a[0], function(v, i) {\r\n\t\t\t\t\t\t\tres.push(fn_res(v, n));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ats[1] == 'array') {\r\n\t\t\t\t\t\tif (ats[0].length != ats[1].length) {\r\n\t\t\t\t\t\t\tthrow 'vector array lengths mismatch';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar res = [], arr2 = a[1];\r\n\t\t\t\t\t\t\teach(a[0], function(v, i) {\r\n\t\t\t\t\t\t\t\tres.push(fn_res(v, arr2[i]));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn fn_res;\r\n};\r\n\r\nvar n_add = function(n1, n2) {\r\n\treturn n1 + n2;\r\n}, n_subtract = function(n1, n2) {\r\n\treturn n1 - n2;\r\n}, n_multiply = function(n1, n2) {\r\n\treturn n1 * n2;\r\n}, n_divide = function(n1, n2) {\r\n\treturn n1 / n2;\r\n};\r\n\r\n// Simple and fast vector and tensor maths would help.\r\n\r\n// new Vector(4, 3)\r\n//  new Uint8Vector(4, 3);\r\n//  new Uint8Matrix(40, 30);\r\n//  new Uint8Tensor(40, 30, 3, 60);\r\n\r\n\r\nvar v_add = vectorify(n_add), v_subtract = vectorify(n_subtract);\r\n\r\n// these are not the standard, established vector or matrix operations. They\r\n// can be used for scaling of arrays of vectors.\r\nvar v_multiply = vectorify(n_multiply), v_divide = vectorify(n_divide);\r\n\r\nvar vector_magnitude = function(vector) {\r\n\t// may calculate magnitudes of larger dimension vectors too.\r\n\t// alert(tof(vector[0]));\r\n\t// alert(vector[0] ^ 2);\r\n\r\n\tvar res = Math.sqrt((Math.pow(vector[0], 2)) + (Math.pow(vector[1], 2)));\r\n\treturn res;\r\n\r\n};\r\n\r\nvar distance_between_points = function(points) {\r\n\tvar offset = v_subtract(points[1], points[0]);\r\n\t//console.log('offset ' + stringify(offset));\r\n\treturn vector_magnitude(offset);\r\n}\r\n\r\n\r\nvar execute_on_each_simple = function(items, fn) {\r\n\t// currently no arguments provided, there may be in the future / future\r\n\t// versions\r\n\tvar res = [], that = this;\r\n\teach(items, function(i, v) {  // Note: for arrays, each() calls with (value, index)\r\n\t\tres.push(fn.call(that, i)); // function called with item as its only\r\n\t\t\t\t\t\t\t\t\t// parameter (i is the value, v is the index)\r\n\t});\r\n\treturn res;\r\n};\r\n\r\nvar filter_map_by_regex = function(map, regex) {\r\n\tvar res = {};\r\n\teach(map, function(v, i) {  // Note: each() calls with (value, key) for objects\r\n\t\t// if (regex.match(i)) {\r\n\t\tif (i.match(regex)) {\r\n\t\t\tres[i] = v;\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n}\r\n\r\n// May be replaced by a more veristile replacement system, ie input transformation and parsing in schemas.\r\nvar npx = arrayify(function(value) {\r\n\t// don't think we can use arrayify?\r\n\r\n\t// good candidate for pf? but how it deals with array trees...\r\n\t// could have another one, like sf or spf that is simpler in terms of\r\n\t// treating an array in the signature as just one array?\r\n\r\n\tvar res, a = arguments, t = tof(a[0]);\r\n\r\n\t// fn sigs??? performance?\r\n\r\n\tif (t === 'string') {\r\n\t\tres = a[0];\r\n\t} else if (t === 'number') {\r\n\t\tres = a[0] + 'px';\r\n\t}\r\n\treturn res;\r\n});\r\n\r\nvar no_px = arrayify(fp(function(a, sig) {\r\n\t// no_px - removes the 'px' if it ends with px\r\n\t// Generally returns a number.\r\n\t// value\r\n\tvar re = /px$/, res;\r\n\tif (sig == '[s]' && re.test(a[0])) {\r\n\t\tres = parseInt(a[0]);\r\n\t} else {\r\n\t\tres = a[0];\r\n\t}\r\n\t;\r\n\treturn res;\r\n}));\r\n\r\nvar arr_ltrb = [ 'left', 'top', 'right', 'bottom' ];\r\n\r\nvar str_arr_mapify = function(fn) {\r\n\tvar res = fp(function(a, sig) {\r\n\t\tif (a.l == 1) {\r\n\t\t\tif (sig == '[s]') {\r\n\t\t\t\tvar s_pn = a[0].split(' ');\r\n\t\t\t\t// console.log('s_pn ' + s_pn.length);\r\n\r\n\t\t\t\tif (s_pn.length > 1) {\r\n\t\t\t\t\treturn res.call(this, s_pn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.call(this, a[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (tof(a[0]) == 'array') {\r\n\t\t\t\tvar res2 = {}, that = this;\r\n\r\n\t\t\t\teach(a[0], function(i, v) {\r\n\t\t\t\t\tres2[v] = fn.call(that, v);\r\n\t\t\t\t});\r\n\t\t\t\treturn res2;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n};\r\n\r\n\r\nvar arr_hex_chars = [ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\r\n\t'A', 'B', 'C', 'D', 'E', 'F' ];\r\nvar dict_hex_to_bin = {\r\n\t'0' : 0,\r\n\t'1' : 1,\r\n\t'2' : 2,\r\n\t'3' : 3,\r\n\t'4' : 4,\r\n\t'5' : 5,\r\n\t'6' : 6,\r\n\t'7' : 7,\r\n\t'8' : 8,\r\n\t'9' : 9,\r\n\t'A' : 10,\r\n\t'B' : 11,\r\n\t'C' : 12,\r\n\t'D' : 13,\r\n\t'E' : 14,\r\n\t'F' : 15\r\n};\r\nvar str_hex_to_int = function(str_hex) {\r\n\tstr_hex = str_hex.toUpperCase();\r\n\tvar i = str_hex.length; // or 10\r\n\tvar res = 0, exp = 1;\r\n\twhile (i--) {\r\n\t\tvar i_part = dict_hex_to_bin[str_hex.charAt(i)];\r\n\t\tvar ip2 = i_part * exp;\r\n\t\tres = res + ip2;\r\n\t\texp = exp * 16;\r\n\t\t// ...\r\n\t}\r\n\t;\r\n\treturn res;\r\n};\r\nvar byte_int_to_str_hex_2 = function(byte_int) {\r\n\tvar a = Math.floor(byte_int / 16), b = byte_int % 16, sa = arr_hex_chars[a], sb = arr_hex_chars[b], res = sa\r\n\t\t+ sb;\r\n\treturn res;\r\n};\r\nvar arr_rgb_to_str_hex_6 = function(arr_rgb) {\r\n\tvar r = byte_int_to_str_hex_2(arr_rgb[0]);\r\n\tvar res = r + byte_int_to_str_hex_2(arr_rgb[1])\r\n\t\t+ byte_int_to_str_hex_2(arr_rgb[2]);\r\n\treturn res;\r\n};\r\nvar arr_rgb_to_css_hex_6 = function(arr_rgb) {\r\n\t// a / b // divide a by b\r\n\t// a % b // find the remainder of division of a by b\r\n\treturn '#' + arr_rgb_to_str_hex_6(arr_rgb);\r\n};\r\n\r\nvar input_processors = {};\r\n\r\nvar output_processors = {};\r\n\r\nvar validators = {\r\n\t'number' : function(value) {\r\n\t\treturn tof(value) == 'number';\r\n\t}\r\n};\r\n\r\nvar referred_object_is_defined = function(object_reference) {\r\n\treturn is_defined(object_reference[0][object_reference[1]]);\r\n}\r\n\r\nvar set_vals = function(obj, map) {\r\n\teach(map, function(i, v) {\r\n\t\tobj[i] = v;\r\n\t});\r\n};\r\n\r\n\r\nvar extend = jsgui.extend, fp = jsgui.fp, stringify = jsgui.stringify, tof = jsgui.tof;\r\n// Connecting these input processors in this instance to the Enhanced_Data_Object?\r\n// So keep the color declaration here. Outside of HTML?\r\n// color is an indexed array.\r\n//  Does that mean it should be stored as a Data_Value?\r\n\r\nvar data_types_info = {\r\n\t'color': ['indexed_array', [\r\n\t\t['red', 'number'],\r\n\t\t['green', 'number'],\r\n\t\t['blue', 'number']\r\n\t]],\r\n\t'oltrb': ['optional_array', ['left', 'top', 'right', 'bottom']]\r\n}\r\n\r\njsgui.data_types_info = data_types_info;\r\n\r\n// Will use better (ES6) factory methods than create_input_function_from_data_type_info\r\n\r\nvar color_preprocessor_parser = fp(function(a, sig) {\r\n\t//console.log('color_preprocessor_parser a ' + stringify(a));\r\n\t//console.log('color_preprocessor_parser sig ' + sig);\r\n\tif (sig == '[s]') {\r\n\t\tvar input = a[0];\r\n\t\tvar rx_hex = /(#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2}))/;\r\n\t\tvar m = input.match(rx_hex);\r\n\t\t//console.log('m ' + stringify(m));\r\n\r\n\t\tif (m) {\r\n\t\t\t// Could use arrayify or something to make the conversion quicker... will do that in more places, mainly want to get the code working now.\r\n\r\n\t\t\tvar r = jsgui.str_hex_to_int(m[2]);\r\n\t\t\tvar g = jsgui.str_hex_to_int(m[3]);\r\n\t\t\tvar b = jsgui.str_hex_to_int(m[4]);\r\n\r\n\t\t\tvar res = [r, g, b];\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n})\r\n\r\n\r\nvar color_preprocessor = (function (fn_color_processor) {\r\n\tvar that = this;\r\n\t//throw '!stop';\r\n\tvar res = fp(function (a, sig) {\r\n\r\n\t\t//console.log('color_preprocessor sig ' + sig);\r\n\r\n\t\tif (sig == '[[s]]') {\r\n\t\t\t//var new_input =\r\n\t\t\t// use regexes to detect / read the string.\r\n\r\n\t\t\t//var rx_hex = /^#?[a-fA-F0-9][a-fA-F0-9][a-fA-F0-9]$/;\r\n\t\t\tvar rx_hex = /(#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2}))/;\r\n\t\t\t//var rx_hex = /(#(([0-9A-Fa-f]{2}){3}))/;\r\n\t\t\t//var rx_hex = /(#([0-9A-Fa-f]{2}){3})/;\r\n\t\t\tvar input = a[0][0];\r\n\r\n\t\t\t//var m = rx_hex.match(input);\r\n\t\t\tvar m = input.match(rx_hex);\r\n\t\t\t//console.log('m ' + stringify(m));\r\n\r\n\t\t\tif (m) {\r\n\t\t\t\t// Could use arrayify or something to make the conversion quicker... will do that in more places, mainly want to get the code working now.\r\n\r\n\t\t\t\tvar r = jsgui.str_hex_to_int(m[2]);\r\n\t\t\t\tvar g = jsgui.str_hex_to_int(m[3]);\r\n\t\t\t\tvar b = jsgui.str_hex_to_int(m[4]);\r\n\r\n\t\t\t\tvar res = [r, g, b];\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// call with the same arguments.\r\n\t\t\t//console.log('calling normal...');\r\n\t\t\treturn fn_color_processor.apply(that, a);\r\n\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n});\r\n\r\n// In previous modules, it won't keep the same input_processors.\r\n//  Is there a way of retrieving that from the most inner modules?\r\n//test_Color();\r\n\r\n// And inputting an indexed array.\r\n//  Will need to accept 2d size inputs.\r\n// Size could possibly be 3d, maybe 1d? A line has a size, which is also its length (though in the world of GUI it could also have\r\n//  a thickness).\r\n\r\n// Optional array looks more like a language feature (enhancement).\r\n//  Or even a core language feature?\r\n\r\n\r\n// There will be different types of optional arrays, will have different input parameters.\r\ninput_processors['optional_array'] = fp(function (a, sig) {\r\n\r\n\tif (a.l == 2) {\r\n\t\tvar oa_params = a[0],\r\n\t\t\tinput = a[1];\r\n\t\tif (tof(input) == 'array') {\r\n\t\t\t// check it is within the right number.\r\n\t\t\tif (input.length <= oa_params.length) {\r\n\t\t\t\treturn input;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn input;\r\n\t\t}\r\n\t}\r\n\tif (a.l == 3) {\r\n\t\tvar oa_params = a[0],\r\n\t\t\titems_data_type_name = a[1],\r\n\t\t\tinput = a[2];\r\n\t\t// now need to get every item in the array or the item to conform to the given type.\r\n\t\tvar input_processor_for_items = jsgui.input_processors[items_data_type_name];\r\n\t\t//console.log('input_processor_for_items ' + input_processor_for_items);\r\n\t\t//console.log('tof(input) ' + tof(input));\r\n\t\tif (tof(input) == 'array') {\r\n\t\t\t// check it is within the right number.\r\n\t\t\tif (input.length <= oa_params.length) {\r\n\t\t\t\tvar res = [];\r\n\t\t\t\teach(input, function (i, v) {\r\n\t\t\t\t\tres.push(input_processor_for_items(v));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn input_processor_for_items(input);\r\n\t\t}\r\n\t}\r\n\t//console.log('oa_params ' + stringify(oa_params));\r\n});\r\n\r\ninput_processors['indexed_array'] = fp(function (a, sig) {\r\n\t// it may be taking some kind of data type that things need to be applied to.\r\n\t// eg 'size': ['indexed_array', ['distance', ['width', 'height']]],\r\n\t// would need to take in objects with the names of the properties as well.\r\n\r\n\tconsole.log('indexed_array sig', sig);\r\n\r\n\tif (a.l == 2) {\r\n\t\tvar ia_params = a[0],\r\n\t\t\tinput = a[1];\r\n\t\t//console.log('ia_params ' + stringify(ia_params));\r\n\r\n\t\tif (tof(input) == 'array') {\r\n\t\t\tif (input.length <= ia_params.length) {\r\n\t\t\t\treturn input;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (a.l == 3) {\r\n\t\tvar ia_params = a[0],\r\n\t\t\titems_data_type_name = a[1],\r\n\t\t\tinput = a[2];\r\n\t\tvar input_processor_for_items = jsgui.input_processors[items_data_type_name];\r\n\t\tif (tof(input) == 'array') {\r\n\t\t\t// check it is within the right number.\r\n\t\t\tif (input.length <= ia_params.length) {\r\n\t\t\t\tvar res = [];\r\n\t\t\t\teach(input, function (i, v) {\r\n\t\t\t\t\tres.push(input_processor_for_items(v));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\ninput_processors['n_units'] = function (str_units, input) {\r\n\t// this will change things to have both the number of units and a string with the unit in an array.\r\n\t//  will make it easier to do maths on the distances.\r\n\r\n\tif (tof(input) == 'number') {\r\n\t\treturn [input, str_units];\r\n\t}\r\n\tif (tof(input) == 'string') {\r\n\t\t//var rx_n_units = /^(?:(\\d+)(\\w+))|(?:(\\d*)\\.(\\d+)(\\w+))$/;\r\n\t\tvar rx_n_units = /^(\\d+)(\\w+)$/;\r\n\t\t// then match it, should be multiple parts to the match.\r\n\r\n\t\t// Do want to get the various pieces working for the Control system.\r\n\t\t//  Then will be very nice indeed when compacted for a mobile-client.\r\n\r\n\t\tvar match = input.match(rx_n_units);\r\n\t\t//console.log('match ' + stringify(match));\r\n\r\n\t\tif (match) {\r\n\t\t\treturn [parseInt(match[1]), match[2]];\r\n\t\t}\r\n\r\n\t\trx_n_units = /^(\\d*\\.\\d+)(\\w+)$/;\r\n\t\tmatch = input.match(rx_n_units);\r\n\t\t//console.log('match ' + stringify(match));\r\n\t\tif (match) {\r\n\t\t\treturn [parseFloat(match[1]), match[2]];\r\n\t\t}\r\n\t\t//throw('stop');\r\n\t}\r\n};\r\n\r\n\r\n\r\n// Previously...\r\n//var ensure_data_type_data_object_constructor = function (data_type_name) {\r\n// Will use a Factory instead (I think)\r\n//  Simpler coding pattern\r\n//   Not needing such a huge word, or huge words to describe it.\r\n//    Don't need unique constructors anyway, will have far more convenient factory methods\r\n\r\n\r\n//console.log('jsgui.input_processors ' + stringify(Object.keys(jsgui.input_processors)));\r\nvar dti_color = jsgui.data_types_info['color'];\r\n\r\ninput_processors['color'] = function(input) {\r\n\r\n\r\n\tvar res;\r\n\tconsole.log('processing color input: ' + stringify(input));\r\n\r\n\tvar input_sig = get_item_sig(input, 2);\r\n\t//console.log('input_sig ' + input_sig);\r\n\r\n\t//var i;\r\n\r\n\tif (input_sig == '[s]') {\r\n\t\t//i = input[0];\r\n\t\tres = color_preprocessor_parser(input[0]);\r\n\t}\r\n\r\n\tif (input_sig == '[n,n,n]') {\r\n\t\t//input = input[0];\r\n\t\t//i = input[0];\r\n\t\t//var res = color_preprocessor_parser(input);\r\n\t\tres = input;\r\n\t}\r\n\r\n\r\n\r\n\r\n\t// not sure that using the preprocessor is right...\r\n\t//  it returns a function, I think it applies to a function.\r\n\t//throw '!!stop';\r\n\tconsole.log('res ' + stringify(res));\r\n\r\n\t// So, the 'color' property gets set.\r\n\t//  Then would need to set the CSS background-color property?\r\n\t//   Depening on what type of Control it is.\r\n\r\n\r\n\tconsole.log('color input_processors output', res);\r\n\r\n\r\n\r\n\treturn res;\r\n}\r\n\r\n//color_preprocessor(create_input_function_from_data_type_info(dti_color));\r\n//jsgui.ensure_data_type_data_object_constructor('color');\r\n\r\njsgui.output_processors['color'] = function (jsgui_color) {\r\n\tvar res = jsgui.arr_rgb_to_css_hex_6(jsgui_color);\r\n\treturn res;\r\n};\r\n\r\n// collection needs a context...\r\n//  can get the context from the first object.\r\n\r\n// Grouping not working so well so far... ???? Still the case 2016?\r\n//  Maybe a less reflective way of making the group function?\r\n\r\n\r\n\r\nvar group = function() {\r\n\r\n\t// Hope this grouping system is not too slow.\r\n\t//  May be able to optimize / selectively make the grouping functions.\r\n\r\n\tvar a = arguments;\r\n\r\n\tif (a.length == 1 && tof(a[0]) == 'array') {\r\n\t\treturn group.apply(this, a[0]);\r\n\t}\r\n\r\n\t//var res = new Collection();\r\n\tvar res;\r\n\tfor (var c = 0, l = a.length; c < l; c++) {\r\n\t\tvar item = a[c];\r\n\r\n\t\tif (c == 0) {\r\n\t\t\tres = new Collection({'context': item.context});\r\n\r\n\t\t}\r\n\t\tres.push(item);\r\n\r\n\t}\r\n\r\n\tvar C = a[0].constructor;\r\n\tvar p = C.prototype;\r\n\r\n\t//console.log('C ' + C);\r\n\t//console.log('p ' + p);\r\n\tvar i;\r\n\tfor (i in p) {\r\n\t\tvar tpi = tof(p[i]);\r\n\t\tif (tpi == 'function') {\r\n\t\t\t// make a group version.\r\n\t\t\t(function(i) {\r\n\t\t\t\t//console.log('i ' + i);\r\n\r\n\t\t\t\tif (i != 'each' && i != 'get' && i != 'add_event_listener') {\r\n\t\t\t\t\tres[i] = function() {\r\n\t\t\t\t\t\tvar a = arguments;\r\n\t\t\t\t\t\tres.each(function(v, i2) {\r\n\t\t\t\t\t\t\tv[i].apply(v, a);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})(i)\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\n\r\nvar true_vals = function(map) {\r\n\tvar res = [];\r\n\tfor (var i in map) {\r\n\t\tif (map[i]) res.push(map[i]);\r\n\t}\r\n\treturn res;\r\n};\r\n\r\n\r\nconst Ui16toUi32 = (ui16) => {\r\n    let res = new Uint32Array(ui16.length / 2);\r\n    let dv = new DataView(ui16.buffer);\r\n    let l = ui16.length;\r\n    let hl = l / 2;\r\n    //console.log('l', l);\r\n    //console.log('hl', hl);\r\n    let resw = 0;\r\n    for (let c = 0; c < hl; c++) {\r\n        //console.log('c', c);\r\n        res[resw++] = dv.getUint32(c * 4);\r\n    }\r\n    //console.log('res', res);\r\n    return res;\r\n}\r\n\r\nconst Ui32toUi16 = (ui32) => {\r\n    let res = new Uint16Array(ui32.length * 2);\r\n    let dv = new DataView(ui32.buffer);\r\n    let l = ui32.length;\r\n    //let dl = l * 2;\r\n    //console.log('l', l);\r\n    //console.log('dl', dl);\r\n    let resw = 0;\r\n    for (let c = 0; c < l; c++) {\r\n        //console.log('c', c);\r\n        //console.log('dv.getUint16(c)', dv.getUint16(c * 4 + 2));\r\n        //console.log('dv.getUint16(c)', dv.getUint16(c * 4));\r\n\r\n        res[resw++] = dv.getUint16(c * 4 + 2);\r\n        res[resw++] = dv.getUint16(c * 4);\r\n        //res[resw++] = dv.getUint16(c * 2 + 1);\r\n        //res[resw++] = dv.getUint16(c * 2);\r\n    }\r\n    console.log('res', res);\r\n    return res;\r\n}\r\n\r\nvar util = {\r\n\t'Ui16toUi32': Ui16toUi32,\r\n\t'Ui32toUi16': Ui32toUi16,\r\n\t'vectorify' : vectorify,\r\n\t'v_add' : v_add,\r\n\t'v_subtract' : v_subtract,\r\n\t'v_multiply' : v_multiply,\r\n\t'v_divide' : v_divide,\r\n\t'vector_magnitude' : vector_magnitude,\r\n\t'distance_between_points' : distance_between_points,\r\n\r\n\t\r\n\t'execute_on_each_simple' : execute_on_each_simple,\r\n\t'mapify' : mapify,\r\n\t'filter_map_by_regex' : filter_map_by_regex,\r\n\t'atof' : atof,\r\n\t'npx' : npx,\r\n\t'no_px' : no_px,\r\n\t'str_arr_mapify' : str_arr_mapify,\r\n\t'arr_ltrb' : arr_ltrb,\r\n\t'true_vals': true_vals,\r\n\t'validators' : validators,\r\n\t'__data_id_method' : 'lazy',\r\n\t'str_hex_to_int' : str_hex_to_int,\r\n\t'arr_rgb_to_css_hex_6' : arr_rgb_to_css_hex_6,\r\n\t'group': group\r\n};\r\n\r\nmodule.exports = util;\r\n\r\n\r\n\r\n", "/*\r\n    Should make lang-tools module.\r\n    // Get lang_mini using that instead.\r\n    //  And this will use lang-mini.\r\n    //  Cut down on number of code references in some cases.\r\n*/\r\n\r\n\r\nconst lang_mini = require('lang-mini');\r\nconst collective = require('./collective');\r\n\r\nconst {more_general_equals} = require('./Data_Model/new/tools');\r\n\r\nlang_mini.equals = more_general_equals;\r\n\r\nlang_mini.collective = collective;\r\nlang_mini.collect = collective;\r\n\r\nconst Evented_Class = lang_mini.Evented_Class;\r\n//var Evented_Class = require('./_evented-class');\r\n// Could use lang-mini for this.\r\n//  Keep the code consisten\r\n//  lang-ext\r\n//  lang-enh\r\n//  flang\r\n\r\nconst B_Plus_Tree = require('./b-plus-tree/b-plus-tree');\r\nconst Collection = require('./Data_Model/old/Collection');\r\nconst Data_Object = require('./Data_Model/Data_Object');\r\nconst Data_Value = require('././Data_Model/Data_Value');\r\nconst Data_Model = require('././Data_Model/Data_Model');\r\nconst Immutable_Data_Value = require('././Data_Model/new/Immutable_Data_Value');\r\nconst Immutable_Data_Model = require('././Data_Model/new/Immutable_Data_Model');\r\nconst Doubly_Linked_List = require('./doubly-linked-list');\r\n\r\nconst Ordered_KVS = require('./ordered-kvs');\r\nconst Ordered_String_List = require('./ordered-string-list');\r\nconst Sorted_KVS = require('./sorted-kvs');\r\n\r\n// util...\r\n\r\nconst util = require('./util');\r\n\r\n// merge util into lang_mini?\r\n\r\nlang_mini.util = util;\r\n\r\nlang_mini.B_Plus_Tree = B_Plus_Tree;\r\nlang_mini.Collection = Collection;\r\nlang_mini.Data_Object = Data_Object;\r\nlang_mini.Data_Value = Data_Value;\r\nlang_mini.Immutable_Data_Model = Immutable_Data_Model;\r\nlang_mini.Immutable_Data_Value = Immutable_Data_Value;\r\nlang_mini.Data_Model = Data_Model;\r\nlang_mini.Doubly_Linked_List = Doubly_Linked_List;\r\n//lang_mini.Evented_Class = Evented_Class;\r\nlang_mini.Ordered_KVS = Ordered_KVS;\r\nlang_mini.Ordered_String_List = Ordered_String_List;\r\nlang_mini.Sorted_KVS = Sorted_KVS;\r\n// remake it as an ec\r\n\r\nconst ec = new Evented_Class();\r\nObject.assign(ec, lang_mini);\r\n\r\n// Nothing here particularly about Resources.\r\n//  Some resources may need to access the internet.\r\n//   Less clearly lang specific?\r\n\r\n// Or a data-transformer / transformer\r\n//  compiler being a subset of transformer.\r\n//  codec also being a subset of transformer.\r\n\r\n\r\n\r\n\r\n\r\n// a compile command too, for command line usage.\r\n\r\n\r\n// lang_mini.compilers.load('babel', babel.transform) ???\r\n//  but will need to be able to send options through to compilers too.\r\n//  Could have named option sets, easier shorthands.\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = ec;", "//const Control = require('./control-core');\r\nconst {tof, Evented_Class} = require('lang-tools');\r\n\r\n// Using a field / prop may work better.\r\n//  Get closer to the more concise and reasonable functional way of coding this.\r\n\r\nconst escape_html_replacements = [\r\n    [/&/g, '&amp;'],\r\n    [/</g, '&lt;'],\r\n    [/>/g, '&gt;'],\r\n    [/\"/g, '&quot;'], //\"\r\n    [/'/g, '&#x27;'], //'\r\n    [/\\//g, '&#x2F;']\r\n];\r\n\r\nconst escape_html = (str) => {\r\n\r\n    //console.log('tof(str) ' + tof(str));\r\n\r\n    //console.log('escape_html str ' + str);\r\n    //console.log('tof str ' + tof(str));\r\n\r\n    if (tof(str) == 'data_value') str = str.get();\r\n\r\n    var single_replacement;\r\n    for (var c = 0, l = escape_html_replacements.length; c < l; c++) {\r\n        single_replacement = escape_html_replacements[c]\r\n        str = str.replace(single_replacement[0], single_replacement[1]);\r\n    }\r\n    //each(escape_html_replacements, function (i, v) {\r\n    //    str = str.replace(v[0], v[1]);\r\n    //});\r\n\r\n    return str;\r\n};\r\n\r\n// Want to be able to change the text of an active text node.\r\n//  So, the text node will have an 'el'. Maybe dom.node?\r\n\r\n// Maybe don't extend control?\r\n\r\n// Do need to have activation as well...?\r\n//  Need to correlate the text node with its dom element.\r\n//   That can't be done through the use of jsgui ids.\r\n//    Will use sibling_index instead.\r\n\r\n// When activating controls containing text nodes, can then correlate the textNode class with the element, by referring to the sibling index.\r\n\r\n// Can give its parent control or element in the spec?\r\n//  That means we could get access to the element very quickly.\r\n\r\n// Not actually an HTML element.\r\n//   Can't have attributes (such as its jsgui-id in the HTML).\r\nclass textNode extends Evented_Class {\r\n//class textNode extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'text_node'\r\n\r\n        super();\r\n\r\n        //super(spec);\r\n        if (typeof spec == 'string') {\r\n            //this._.text = spec;\r\n            //this.innerHtml = spec;\r\n            spec = {\r\n                'text': spec\r\n            };\r\n        }\r\n\r\n        spec.nodeType = 3;\r\n        spec = spec || {};\r\n\r\n        if (spec.el) {\r\n            this.dom = {\r\n                el: spec.el\r\n            }\r\n        } else {\r\n            this.dom = {};\r\n        }\r\n\r\n        if (spec.sibling_index) this.sibling_index = spec.sibling_index;\r\n\r\n        //ctrl_init_call(this, spec);\r\n        //this._super(spec);\r\n\r\n        // the underscore properties could make sense in Data_Objects and controls.\r\n        //  have the getters and setters that change the property and also raise the change event.\r\n\r\n        // Proxies seem like a possibility to listen for such changes.\r\n        //  However, we would make the changes to the proxy object.\r\n        //  Possibly could have something that raises a change event.\r\n\r\n        // Proxies could get trickier when they are in the object heirachy.\r\n\r\n        //this._ = {};\r\n\r\n        // Value would be better than text - more generic. Better to use it as standard.\r\n\r\n        if (typeof spec.text !== 'undefined') {\r\n            this._text = spec.text;\r\n        }\r\n        //this.typeName = pr.typeName;\r\n        //this.tagName = 'p';\r\n\r\n        // Will not require activation.\r\n        //  Don't think Text_Node gets activated anyway.\r\n        this.on('change', e_change => {\r\n            //console.log('Text_Node change', e_change);\r\n\r\n            if (this.dom.el) {\r\n                this.dom.el.nodeValue = e_change.value;\r\n            }\r\n        })\r\n\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n\r\n            //console.log('activate textNode control');\r\n            //console.log('this.sibling_index', this.sibling_index);\r\n\r\n            this.__active = true;\r\n        }\r\n    }\r\n    get text() {\r\n        return this._text;\r\n    }\r\n    set text(value) {\r\n        this._text = value;\r\n        this.raise('change', {\r\n            'name': 'text',\r\n            'value': value\r\n        });\r\n    }\r\n    'all_html_render'() {\r\n        // nx = no escape\r\n        return this.nx ? this._text || '' : escape_html(this._text || '') || '';\r\n    }\r\n\r\n    // getter and setter for the text itself?\r\n    //  A variety of properties will use getters and setters so that the updates get noted.\r\n\r\n};\r\n\r\nmodule.exports = textNode;", "\r\n\r\n// If it's useful for obs and stages, then input and output transformation in one function with integrated monitoring could work well.\r\n\r\n\r\n\r\n// Separate version for monitored transformations?\r\n//  Keep this as a core?\r\n//  A way to extend this?\r\n\r\n\r\n// Could make a new fn-io-monitored-transform\r\n//  And different options for what gets monitored.\r\n//  Seems easy already to add timings for various things.\r\n//  Not so sure we need another module.\r\n\r\n\r\n\r\n\r\n// fn-io-monitored-transform???\r\n//  that seems like it would be more applicable to stages()\r\n//  seems useful for getting io data rates, and transformation rates?\r\n\r\n// https://www.npmjs.com/package/bson\r\n//  Would be quite simple to get BSON up and running quickly as an optional encoding method.\r\n\r\n\r\n\r\n\r\n\r\nconst {deep_sig} = require('lang-mini');\r\n\r\n\r\n/*\r\n    Definition / map of input transformations by sig\r\n\r\n    This will also wrap a function to create another callable function.\r\n\r\n\r\n    // such as: returned promises are to be resolved.\r\n\r\n    // This is going to use asyncronous transformations.\r\n\r\n\r\n    // and with some functions, could provide transform streams?\r\n\r\n    fn_io_transform(fn, sig_map_input_transformations, sig_map_input_transformations)\r\n\r\n\r\n    // A status wrapper function?\r\n    //  So we can define what the status of the function is when it's been called.\r\n\r\n    // pre, main, post ... complete?\r\n    //  always ends with complete? or 'done'.\r\n\r\n\r\n    // Would allow for a nice complete / done / finished aliasing.\r\n\r\n\r\n    // \r\n\r\n\r\n    // Integrating its own monitoring here could be useful.\r\n\r\n    \r\n\r\n\r\n*/\r\n\r\n// a non-fp version of this?\r\n//  just to do the transformation, get the callback\r\n//   including transformation event callbacks?\r\n\r\n\r\n// and a transformation event callback too?\r\n// options?\r\n//  enable monitoring\r\n//  \r\n\r\n// const obj_transform = (obj, map_transformations)\r\n\r\n// cb_transformation_events(evt)\r\n//  \r\n\r\n// auto_promise_resolve?\r\n//   promise resolution \r\n\r\n\r\n// Are transformations defined backwards right now?\r\n//  Easier to start with what we currently have.\r\n//  Be able to set up a transformation so that looks at the params we have.\r\n\r\nconst isArguments = ( item ) => Object.prototype.toString.call( item ) === '[object Arguments]';\r\n\r\n\r\n// And a transformation event callback too?\r\n\r\n\r\n// including monitoring in the function definition???\r\n//  may be implicit and set up when using stages ().\r\n//  or an easy to set option.\r\n\r\n\r\n\r\n\r\n\r\nconst fn_transformation = (fn, map_transformations) => {\r\n\r\n    //console.log('');\r\n    //console.log('fn_transformation');\r\n    //console.log('');\r\n\r\n    //console.log('Object.keys(map_transformations)', Object.keys(map_transformations));\r\n    //console.trace();\r\n\r\n\r\n    // both input and output tranform, as defined, if defined.\r\n    //  not even automatic promise resolution assured here - needs to be provided in the map.\r\n\r\n    const input_transformations = map_transformations.i;\r\n    const output_transformations = map_transformations.o;\r\n\r\n    // needs to return a function.\r\n\r\n    // function will always be async?\r\n    //  will use event callback rather than observable.\r\n\r\n    const fn_res = function() {\r\n        const args = arguments;\r\n\r\n        if (args.length === 2 && typeof args[1] === 'function') {\r\n            let [a, cb_transform_exec_events] = args;\r\n            if (isArguments(a)) {\r\n                if (a.length === 1) {\r\n                    a = a[0];\r\n                }\r\n            }\r\n\r\n            // so now a is the proper function call args???\r\n            //  check to see if a is an arguments object.\r\n            //   only one object there? swap it for item 0\r\n\r\n            // maybe was not given an arguments object?\r\n            // a could be an object?\r\n\r\n            //let fn_ready_args;\r\n            const sig_called_with = deep_sig(a);\r\n            const sig_arguments = deep_sig(arguments);\r\n            // fishing the argument out of the arguments object?\r\n\r\n            //console.log('transformed fn called with sig', sig_called_with);\r\n            //const exec_output_transformations = () => {\r\n            //}\r\n\r\n            const exec_fn = () => {\r\n\r\n                //console.log('fn transform exec');\r\n\r\n\r\n                //console.log('!!fn.skip', !!fn.skip);\r\n\r\n                // decide if we skip the function call - returning the input.\r\n\r\n\r\n                // exec start, exec complete\r\n\r\n                // And will also measure exec timings.\r\n\r\n\r\n                cb_transform_exec_events({\r\n                    'name': 'exec-start'//,\r\n                    //sig: evt_output_transform.sig,\r\n                    //value: evt_output_transform.value\r\n                });\r\n\r\n                const fn_res = fn.call(null, a);\r\n\r\n                cb_transform_exec_events({\r\n                    'name': 'exec-complete'//,\r\n                    //sig: evt_output_transform.sig,\r\n                    //value: evt_output_transform.value\r\n                });\r\n\r\n\r\n                const sig_fn_res = deep_sig(fn_res);\r\n                if (output_transformations) {\r\n                    if (output_transformations[sig_fn_res]) {\r\n                        output_transformations[sig_fn_res].call(null, fn_res, (evt_output_transform) => {\r\n                            cb_transform_exec_events({\r\n                                'name': 'complete',\r\n                                sig: evt_output_transform.sig,\r\n                                value: evt_output_transform.value\r\n                            });\r\n                        });\r\n                    } else {\r\n                        cb_transform_exec_events({\r\n                            'name': 'complete',\r\n                            sig: sig_fn_res,\r\n                            value: fn_res\r\n                        });\r\n                    }\r\n                } else {\r\n                    // probably should have been given an events cb function.\r\n                    cb_transform_exec_events({\r\n                        'name': 'complete',\r\n                        sig: sig_fn_res,\r\n                        value: fn_res\r\n                    });\r\n                }\r\n            }\r\n\r\n            const skip_fn = () => {\r\n                // complete callback.\r\n                cb_transform_exec_events({\r\n                    'name': 'complete',\r\n                    //sig: sig_fn_res,\r\n                    value: a,\r\n                    skipped: true\r\n                });\r\n\r\n            }\r\n        \r\n            if (input_transformations) {\r\n\r\n                // do we skip the stage?\r\n                let do_skip = false;\r\n                //console.log('!!fn.skip', !!fn.skip);\r\n                if (fn.skip) {\r\n                    do_skip = fn.skip(a);\r\n                }\r\n\r\n                // Only do / try the input transformation if we don't already have accepted parameters?\r\n\r\n                //console.log('have input transformations');\r\n                //console.log('Object.keys(input_transformations)', Object.keys(input_transformations));\r\n\r\n                //console.log('sig_called_with', sig_called_with);\r\n\r\n\r\n                // if the sig_called_with is already in the accepted sigs?\r\n\r\n                //console.log('fn', fn);\r\n                //console.trace();\r\n                //throw 'stop';\r\n\r\n                //console.log('do_skip', do_skip);\r\n\r\n                if (do_skip) {\r\n                    //console.log('skipping function call');\r\n                    skip_fn();\r\n                } else {\r\n\r\n                    if (fn.map_sigs && fn.map_sigs[sig_called_with]) {\r\n                        exec_fn();\r\n                    } else {\r\n                        if (input_transformations[sig_called_with]) {\r\n                            // run that transformation function.\r\n        \r\n                            // need to add the extra callback argument?\r\n                            // apply not call?\r\n        \r\n                            // call seems better.\r\n                            //  call it with an arguments object?\r\n        \r\n                            //console.trace();\r\n                            //throw 'stop';\r\n        \r\n                            // \r\n    \r\n                            // input transform start.\r\n    \r\n                            \r\n    \r\n                            cb_transform_exec_events({\r\n                                'name': 'input-transform-start'\r\n                            });\r\n                            \r\n    \r\n    \r\n        \r\n                            input_transformations[sig_called_with].call(null, a, (evt_input_transform) => {\r\n                                //console.log('evt_input_transform', evt_input_transform);\r\n                                const {name, sig, value, io_sigs} = evt_input_transform;\r\n                                if (name === 'complete') {\r\n                                    a = value;\r\n                                    evt_input_transform.name = 'input-transform-complete';\r\n                                    // then report this event to a listener?\r\n                                    //cb_transform_exec_events\r\n                                    cb_transform_exec_events(evt_input_transform);\r\n                                    exec_fn();\r\n                                } else {\r\n                                    console.trace();\r\n                                    throw 'NYI';\r\n                                }\r\n                                //console.trace();\r\n                                //throw 'stop';\r\n                                // replace the argument(s) a with the value\r\n                            });\r\n                        } else {\r\n                            // just call it\r\n                            //fn_ready_args = a[0][0];\r\n                            exec_fn();\r\n                        }\r\n                    }\r\n\r\n\r\n                }\r\n\r\n                \r\n\r\n                \r\n                // arguments object has already been sorted out.\r\n\r\n\r\n\r\n                /*\r\n\r\n\r\n\r\n\r\n                if (isArguments(a[0]) && typeof a[1] === 'function') {\r\n                    console.log('carry out input_transformations', fn.name);\r\n                    console.trace();\r\n\r\n                    //const input_transformation_sigs = Object.keys(input_transformations);\r\n\r\n                    console.log('!!input_transformations[sig_called_with]', !!input_transformations[sig_called_with]);\r\n                    console.log('sig_called_with', sig_called_with);\r\n\r\n                    \r\n                } else {\r\n\r\n                    console.log('a.length', a.length);\r\n                    console.log('Object.keys(a)', Object.keys(a));\r\n\r\n                    console.log('sig_called_with', sig_called_with);\r\n\r\n\r\n                    if (input_transformations[sig_called_with]) {\r\n                        input_transformations[sig_called_with].call(null, fn_res, (evt_output_transform) => {\r\n                            //console.log('evt_output_transform', evt_output_transform);\r\n        \r\n                            console.trace();\r\n                            throw 'stop';\r\n        \r\n        \r\n                            // Could have been a promise resolution.\r\n                            //const sig_fn_res = deep_sig(fn_res);\r\n                            console.log('Object.keys(evt_output_transform)', Object.keys(evt_output_transform));\r\n        \r\n\r\n                            // / *\r\n\r\n                            //cb_transform_exec_events({\r\n                            //    'name': 'complete',\r\n                            //    sig: evt_output_transform.sig,\r\n                            //    value: evt_output_transform.value\r\n                            //});\r\n                            // * /\r\n        \r\n        \r\n        \r\n        \r\n                            // probably want something for 'sig' which corresponds to the value.\r\n        \r\n        \r\n        \r\n        \r\n        \r\n                        });\r\n                    } else {\r\n                        console.log('89347812 pre exec');\r\n                        exec_fn();\r\n\r\n                    }\r\n\r\n\r\n                    //console.trace();\r\n                    //throw 'NYI';\r\n                }\r\n\r\n                */\r\n\r\n                // transformation sigs\r\n        \r\n                // process them....\r\n                //if (input_transformations)\r\n        \r\n                \r\n        \r\n        \r\n        \r\n            } else {\r\n                //fn_ready_args = arguments;\r\n                exec_fn();\r\n            }\r\n\r\n            //console.log('');\r\n            //console.log('calling transformed function fn.name', fn.name);\r\n            //console.trace();\r\n\r\n\r\n\r\n\r\n\r\n        } else {\r\n            throw 'Expected args: normal_args, cb_transform_event';\r\n        }\r\n\r\n\r\n\r\n        \r\n\r\n\r\n        \r\n    }\r\n\r\n    if (fn.name) fn_res.name = fn.name;\r\n    if (fn.main) fn_res.main = fn.main;\r\n    if (fn.skip) fn_res.skip = fn.skip;\r\n\r\n    // \r\n\r\n\r\n\r\n    return fn_res;\r\n\r\n\r\n   \r\n\r\n}\r\n\r\n\r\nmodule.exports = fn_transformation;", "const {tf, deep_sig, each, def} = require('lang-mini');\r\n\r\n\r\n// Could use callbacks\r\n\r\n// Will be used to monitor arguments and values between stages().\r\n\r\n// Complete?\r\n//  Monitoring complete makes sense.\r\n\r\n// Various parts now measure their byte rates.\r\n\r\n// \r\n\r\n\r\n\r\n\r\nconst monitor_item = (item, cb_evt_monitoring) => {\r\n\r\n    // The type of item...\r\n\r\n    const ti = tf(item);\r\n\r\n    // promise\r\n    // stream\r\n\r\n    // \r\n\r\n    // some objects... can just get the size.\r\n\r\n    // readable stream....\r\n\r\n    // monitoring arguments - monitor every object there.\r\n    //  subitems too?\r\n    //  a subitems tree?\r\n\r\n    // array?\r\n\r\n    // \r\n    //console.log('monitor_item ti', ti);\r\n\r\n    if (ti === 'A') {\r\n        const l = item.length;\r\n        // no different with just one argyment.\r\n        // begin args?\r\n        //  then args complete?\r\n        for (let c = 0; c < l; c++) {\r\n            const arg = item[c];\r\n\r\n\r\n\r\n            // carry out monitoring on that arg.\r\n            ((arg, c) => {\r\n                monitor_item(arg, (evt_arg_monitor) => {\r\n                    //console.log('evt_arg_monitor', evt_arg_monitor);\r\n                    // need to callback for cb_evt_monitoring\r\n                    //  say the arg_index\r\n                    // say it's a subitem?\r\n                    // type and subtype?\r\n                    evt_arg_monitor.arg_index = c;\r\n                    cb_evt_monitoring(evt_arg_monitor);\r\n                    //console.trace();\r\n                    //throw 'stop';\r\n                })\r\n            })(arg, c);\r\n        }\r\n        // monitor each of the items in the arguments.\r\n    } else if (ti === 's') {\r\n        // the length of the string = length * 2\r\n\r\n        // say what type it is.\r\n        //  bytes_length\r\n\r\n        cb_evt_monitoring({\r\n            name: 'complete',\r\n            t: 's',\r\n            bytes: item.length * 2\r\n        });\r\n\r\n\r\n        // object... probably don't get its size.\r\n        //  get its keys?\r\n\r\n\r\n    } else if (ti === 'o') {\r\n        // the length of the string = length * 2\r\n\r\n        // say what type it is.\r\n        //  bytes_length\r\n        // get the object sig?\r\n\r\n        // need to wait for that observable to complete?\r\n        //  could wait for the io complete event.\r\n\r\n        // Do need to wait for observables to complete?\r\n        //  Or wait for the io complete event?\r\n\r\n        // Only want to say that the item is complete when its io is complete?\r\n\r\n        \r\n\r\n\r\n\r\n\r\n        cb_evt_monitoring({\r\n            name: 'complete',\r\n            t: 'o'//,\r\n            //bytes: item.length * 2\r\n        });\r\n\r\n        // object... probably don't get its size.\r\n        //  get its keys?\r\n\r\n\r\n    } else if (ti === 'R') {\r\n        // could be output monitoring.\r\n\r\n        //console.trace();\r\n\r\n        // the length of the string = length * 2\r\n\r\n        // say what type it is.\r\n        //  bytes_length\r\n\r\n        // get the object sig?\r\n\r\n        // monitor the rs data.\r\n        const rs = item;\r\n        // stream identified / available\r\n        // stream data started (first data event)???\r\n        // stream data event\r\n        // stream data complete\r\n\r\n        // the time?\r\n\r\n        let bytes = 0;\r\n\r\n        // ms_started ....\r\n\r\n        const ms_start = Date.now();\r\n\r\n        // and a start?\r\n        //  instead of available?\r\n\r\n        // available?\r\n        //  start?\r\n\r\n        let content_length, bytes_remaining;\r\n\r\n        const {headers} = item;\r\n        //console.log('headers', headers);\r\n        //console.log('item', item);\r\n\r\n        if (headers && headers['content-length']) {\r\n            content_length = parseInt(headers['content-length'], 10);\r\n            bytes_remaining = content_length;\r\n        }\r\n\r\n        //console.log('**** headers', headers);\r\n        //console.log('content_length', content_length);\r\n        //console.trace();\r\n\r\n        // Be able to look into the headers, get numbers such as content-length.\r\n\r\n        // and send the headers.\r\n        //  the content length will be useful in particular.\r\n\r\n        const o_evt = {\r\n            name: 'available',\r\n            t: 'R',\r\n            ms: ms_start,\r\n            headers: headers\r\n            //,\r\n            //bytes: item.length * 2\r\n        }\r\n\r\n        if (def(content_length)) {\r\n            o_evt.content_length = content_length;\r\n        }\r\n        cb_evt_monitoring(o_evt);\r\n        // Providing the rate and estimated time complete and remaining will be useful.\r\n        //  Want that encapsulated here. Maybe make it optional?\r\n\r\n        rs.on('data', data => {\r\n            bytes += data.length;\r\n            bytes_remaining -= data.length;\r\n            // bytes remaining\r\n            // be able to calculate / estimate time remaining?\r\n            //  and estimated completion time?\r\n\r\n            // calculating the rate within this part would make a lot of sense.\r\n            //  and not in observable stages?\r\n\r\n            // Rate calculation here would definitely be useful.\r\n\r\n            // could include the time for each piece of data that arrives.\r\n            //  \r\n\r\n            // how long it has taken\r\n            //  the bytes output total so far?\r\n\r\n            // ms into? ms so far? ms_total? ms_processing?\r\n\r\n\r\n            const ms = Date.now();\r\n            const ms_taken = ms - ms_start;\r\n            // Should be able to calculate how long it will take to do the bytes_remaining based on the rate.\r\n            const byte_rate = bytes / (ms_taken / 1000);\r\n            const est_remaining = bytes_remaining / byte_rate * 1000;\r\n            const proportion = bytes / content_length;\r\n\r\n            const ms_est_complete = ms + est_remaining;\r\n\r\n            // bytes_total?\r\n            cb_evt_monitoring({\r\n                name: 'data',\r\n                t: 'B',\r\n                bytes: data.length,\r\n                bytes_total: bytes,\r\n                byte_rate: byte_rate,\r\n                content_length: content_length,\r\n                bytes_remaining: bytes_remaining,\r\n                ms_est_remaining: est_remaining,\r\n                ms_est_complete: ms_est_complete,\r\n                ms_taken: ms_taken,\r\n                proportion: proportion\r\n            });\r\n            // and readable stream output data too.\r\n            // input_data function?\r\n            //  makes sense.\r\n            //  for monitoring a readable stream.\r\n\r\n            //console.log('pre post-data-out raise_stage_event ' + stage_name);\r\n            //raise_stage_event('post-data-out', {\r\n            //    data: data\r\n            //});\r\n            //chunks.push(data);\r\n        });\r\n        rs.on('end', () => {\r\n            // raise the stage complete at a different time. ???\r\n            // monitoring / length recording / events?\r\n            //exec_fn();\r\n            // ms_taken would be of use here.\r\n            const ms_complete = Date.now();\r\n            const ms_taken = ms_complete - ms_start;\r\n\r\n            // and byte_rate...\r\n            const byte_rate = bytes / (ms_taken / 1000);\r\n\r\n            cb_evt_monitoring({\r\n                name: 'complete',\r\n                ms: ms_complete,\r\n                ms_taken: ms_taken,\r\n                t: 'R',\r\n                'bytes': bytes,\r\n                byte_rate: byte_rate//,\r\n                //bytes: item.length * 2\r\n            });\r\n        });\r\n        rs.on('error', err => {\r\n            //console.log('error reading stream for param transformation in stages()');\r\n            //error(err);\r\n            cb_evt_monitoring({\r\n                name: 'error',\r\n                value: err,\r\n                t: 'R'//,\r\n                //bytes: item.length * 2\r\n            });\r\n        });\r\n\r\n        /*\r\n        cb_evt_monitoring({\r\n            name: 'complete',\r\n            t: 'o'//,\r\n            //bytes: item.length * 2\r\n        });\r\n        */\r\n\r\n        // object... probably don't get its size.\r\n        //  get its keys?\r\n\r\n\r\n    } else if (ti === 'B') {\r\n        // the length of the string = length * 2\r\n        // say what type it is.\r\n        //  bytes_length\r\n        cb_evt_monitoring({\r\n            name: 'complete',\r\n            t: 'B',\r\n            bytes: item.length\r\n        });\r\n        // object... probably don't get its size.\r\n        //  get its keys?\r\n\r\n    } else if (ti === 'a') {\r\n        // the length of the string = length * 2\r\n        // say what type it is.\r\n        //  bytes_length\r\n\r\n        // recursive function to calculate the size of a js object in bytes.\r\n        //  should be in lang-mini.\r\n\r\n\r\n        cb_evt_monitoring({\r\n            name: 'complete',\r\n            t: 'a'\r\n        });\r\n        // object... probably don't get its size.\r\n        //  get its keys?\r\n    } else {\r\n        console.log('ti', ti);\r\n        console.trace();\r\n        throw 'stop';\r\n    }\r\n}\r\n\r\nmodule.exports = monitor_item;", "\r\n// args all in one objet?\r\n// then we have a monitoring callback?\r\n//  optional?\r\n\r\n\r\n// monitored-arg-transformations as well?\r\n//  though, these themselves could be observables or promises.\r\n//  possibly callback events would be more efficient, especially within the implementation of observables and other function calling system.\r\n// right now though, function arg transformations are not built into observable.\r\n//  a monitoring callback could be the best way?\r\n// does not quite fit the next, complete, error framework.\r\n// an events callback makes the most sense.\r\n//  \r\n//  do need some kind of callback system anyway.\r\n//   events callback makes the most sense.\r\nconst {deep_sig} = require('lang-mini');\r\n// monitored_arg_transformations too?\r\n\r\n// should be able to wrap this in a monitoring function to be able to monitor function io.\r\n//  monitoring params / args themselves directly could work better as we wouldn't make duplicate measurements.\r\n\r\n// so in stages, monitoring the input, output, and intermediate objects makes sense.\r\n//  then consider inner stage monitoring / stage events API.\r\n//   stages / stage events API does seem useful, but it can't be a huge amount of repetitive code.\r\n//   needs proper abstractions.\r\n\r\n\r\n\r\n// promise, resolving to anything.\r\n\r\n// *, P\r\n\r\n// anything, can be got from a promise.\r\n//  or keep promise resolution separate?\r\n\r\n// o, i?\r\n\r\n// i, o probably makes more sense.\r\n\r\n// easier for processing promise input.\r\n\r\n// capitalise P for promise?\r\n\r\n\r\n\r\n/*\r\n\r\n\r\n\r\n    'R': {\r\n\r\n        // just a default change to buffer...\r\n\r\n        'B': (input_readable_stream, cb_events) => {\r\n            // No monitoring here right now.\r\n            //  Maybe make monitored transformations.\r\n            // Argument (and result object) monitoring seems best to get io data.\r\n            // transformation event start?\r\n            const chunks = [];\r\n            // maybe data-in-start will make for nicer programming. not sure.\r\n            // pre-data-in-start?\r\n            input_readable_stream.on('data', data => {\r\n                // monitoring event?\r\n                chunks.push(data);\r\n            });\r\n            input_readable_stream.on('end', () => {\r\n                fn_ready_args = Buffer.concat(chunks);\r\n                if (cb_events) cb_events({\r\n                    name: 'complete',\r\n                    io_sigs: ['R', 'B'],\r\n                    value: fn_ready_args\r\n                });\r\n                // no events at present to raise\r\n                / *\r\n                raise_stage_event('pre-data-in-complete', {\r\n                    //'sig_from': 'R',\r\n                    //'sig_to': 'B',\r\n                    //'from': next_apply_args,\r\n                    //'to': fn_ready_args\r\n                });\r\n                // does not seem to be a pre-processing output process / stream.\r\n                //  do not need to have data-in and data-out in all cases.\r\n                raise_stage_event('pre-complete', {\r\n                    'sig_from': 'R',\r\n                    'sig_to': 'B',\r\n                    'from': next_apply_args,\r\n                    'to': fn_ready_args\r\n                });\r\n                */\r\n                /*\r\n                raise_stage_event('post-input-transform', {\r\n                    'from': 'R',\r\n                    'to': 'B'\r\n                });\r\n                * /\r\n                // monitoring / length recording / events?\r\n                //exec_fn();\r\n            });\r\n            input_readable_stream.on('error', err => {\r\n                console.log('error reading stream for param transformation in stages()');\r\n                // callback with the error event.\r\n                error(err);\r\n            });\r\n        }\r\n    }\r\n\r\n*/\r\n\r\n// Default transformations...\r\n//  but would be nice to annotate with the result type. maybe with mfp.\r\n\r\nconst transformations = {\r\n    'O': (obs, cb_events) => {\r\n        // build up the chunks?\r\n        // or could use then.\r\n        obs.then(res => {\r\n            // get the res sig...\r\n            const sig = deep_sig(res);\r\n            if (cb_events) cb_events({\r\n                name: 'complete',\r\n                io_sigs: ['O', sig],\r\n                sig: sig,\r\n                value: res\r\n            });\r\n        }, err => {});\r\n        /*\r\n        obs.on('complete', complete_data => {\r\n        });\r\n        */\r\n    },\r\n\r\n    'p': (p, cb_events) => {\r\n        p.then(res => {\r\n            // get the res sig...\r\n            const sig = deep_sig(res);\r\n            if (cb_events) cb_events({\r\n                name: 'complete',\r\n                io_sigs: ['p', sig],\r\n                sig: sig,\r\n                value: res\r\n            });\r\n        }, err => {});\r\n    },\r\n    'R': (input_readable_stream, cb_events) => {\r\n        // Only transforms to a buffer.\r\n        // No monitoring here right now.\r\n        //  Maybe make monitored transformations.\r\n        // Argument (and result object) monitoring seems best to get io data.\r\n        // transformation event start?\r\n        const chunks = [];\r\n        // maybe data-in-start will make for nicer programming. not sure.\r\n        // pre-data-in-start?\r\n        // may as well monitor number of ms taken\r\n        // timing monitoring elsewhere?\r\n        //  could have another external layer that logs the times of the various events?\r\n        // for the moment, ms_taken would help here.\r\n        const ms_start = Date.now();\r\n        // raise a start event.\r\n        input_readable_stream.on('data', data => {\r\n            // monitoring event?\r\n            // Could raise the data event.\r\n            //  A version with integrated monitoring as well?\r\n            chunks.push(data);\r\n        });\r\n        input_readable_stream.on('end', () => {\r\n            //fn_ready_args = ;\r\n            const ms_complete = Date.now();\r\n            const buf = Buffer.concat(chunks);\r\n            const ms_taken = ms_complete - ms_start;\r\n            //  byte_rate (per s)\r\n            const byte_rate = buf.length / (ms_taken / 1000);\r\n            if (cb_events) cb_events({\r\n                name: 'complete',\r\n                sig: 'B',\r\n                io_sigs: ['R', 'B'],\r\n                value: buf,\r\n                bytes: buf.length,\r\n                ms: ms_complete,\r\n                ms_taken: ms_taken,\r\n                byte_rate: byte_rate\r\n            });\r\n            // monitoring / length recording / events?\r\n            //exec_fn();\r\n        });\r\n        input_readable_stream.on('error', err => {\r\n            console.log('error reading stream for param transformation in stages()');\r\n            // callback with the error event.\r\n            error(err);\r\n        });\r\n    }\r\n    // this level: param sig required\r\n    // this level: param sig given: function to transform\r\n    // promise resolution here?\r\n}\r\n\r\nmodule.exports = transformations;", "\r\n//const lang = require('lang-mini');\r\n//const Evented_Class = lang.Evented_Class;\r\n//const get_a_sig = lang.get_a_sig;\r\n//const get_truth_map_from_arr = lang.get_truth_map_from_arr;\r\nconst {each, Evented_Class, get_a_sig, get_truth_map_from_arr, tof, tf, mfp, deep_sig, clone, def, is_array} = require('lang-mini');\r\nconst fn_io_transform = require('./fn-io-transform');\r\n\r\n\r\n/*\r\n    18/06/2019 - New version, will use io transform and measurement abstractions.\r\n\r\n\r\n    21/06/2019 - Get it working (basically) using function io wrappers.\r\n        Now need the abstractions for monitoring / stage monitoring / arg & param & res monitoring.\r\n\r\n\r\n    // Also the initial arg?\r\n    // For the moment, monitor the arguments between the stages.\r\n    // Also the result arg.\r\n\r\n    //  can monitor arrays too?\r\n    // monitor_item(item, evt_monitoring => ())\r\n\r\n    // The event callback system makes a lot of sense to use.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // function monitoring\r\n\r\n\r\n    // io transformations\r\n\r\n    // monitoring the io transformations\r\n\r\n    overall fn input = first stage fn input = first stage pre-processing input\r\n\r\n\r\n    // Tracking where the same arguments are used?\r\n\r\n    // Tracking execution stage - where the execution is between?\r\n\r\n\r\n\r\n    // really want to know the input and output of each function call.\r\n\r\n\r\n    //  arguments watcher?\r\n    //  arguments info and watcher?\r\n\r\n\r\n    // call a function on the args.\r\n    //  gets the sig\r\n    //  monitors any streams and observables.\r\n\r\n    // observe_args?\r\n\r\n\r\n    //  monitor-args?\r\n    //   seems best as a callback function? or multi-callback function?\r\n    //    event callback function.\r\n    //     \r\n\r\n\r\n    // Monitoring the args at various io / function call stages will be useful so we don't wind up monitoring the same arguments / io too many times.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n// Most likely will leave out a separate status() function wrapper.\r\n//  Maybe that should be part of the normal observable?\r\n\r\n// Anyway, need to have the monitoring and io transforms\r\n\r\n\r\n// input to the whole function\r\n// output to the whole function.\r\n\r\n\r\n//  Monitoring of io transforms too....\r\n\r\n\r\n// monitoring functions with stages, and output transformed stages:\r\n//  do we need to monitor the same stream twice? 3 times?\r\n\r\n// monitoring the variables involved is important.\r\n//  output from one function is (often?) input to the next.\r\n\r\n//  so monitoring the variables / parameters will mean that we have both the output of one part and input to the next.\r\n\r\n//  see about just wrapping all of the functions with io_transform.\r\n//   leave monitoring out of it for the moment.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst log = () => {};\r\n\r\n//const log = console.log;\r\n\r\n// Could have one overriding fnl function?\r\n//  Not yet.\r\n\r\n\r\n// Stages could be redone in the near future so that it makes use of a pre / main / post function call system.\r\n//  mfp+\r\n\r\n// For the moment, continue and finish the implementation here.\r\n//  But possibly a lower level observable function call system will help?\r\n\r\n// Observable function call with preprocessing.\r\n//  So each stage is an observable.\r\n//   observables with a 'start' event?\r\n\r\n// or each stage as an Evented_Function?\r\n//  like an observable in some ways, but raises events that can be listened to.\r\n\r\n// efn?\r\n//  efp?\r\n//   evented functional polymorphism?\r\n\r\n// iofn? \r\n//  allows input and output processing\r\n\r\n\r\n// .io , .i, .o interfaces?\r\n//  quick to type :)\r\n\r\n// measure(fn)\r\n// measure_io(fn)\r\n// io_events = measure_io(fn_call)\r\n\r\n\r\n// finishing of the current system would make sense though\r\n//  will create the io object.\r\n\r\n//  will create the stages object?\r\n\r\n//  .info?\r\n//   the information object that contains info about things such as io?\r\n\r\n\r\n// .io_events\r\n//  get an event_stream function / object?\r\n//   and is that possible to make here?\r\n\r\n// subscribe to all function events....\r\n//  measure those function events\r\n\r\n// measure timings\r\n\r\n// possibilities such as getting the event processing info as its own observable?\r\n\r\n// move stages processing out of observable?\r\n\r\n\r\n//  \r\n\r\n\r\n\r\n\r\n\r\n// 12/06/2019 - Stages working so far, want to try it on some more important functions such as dl.\r\n//  Each stage can provide an observable\r\n//   when data needs to be batched and decompressed that won't be so useful in some cases.\r\n//  Allow data to be used as soon as available.\r\n//   Can integrate download / transfer / process rates more easily in some cases.\r\n\r\n// 12/06/2019 - quite effectine in storing stage execution timing info so far.\r\n\r\n// More work on data rate analysis here?\r\n//  Or worth having real code that deals with these buffers first\r\n//   That would make sense.\r\n//    See where is can send over such data if necessary\r\n\r\n/*\r\n\r\n14/06/2019\r\n\r\nFurther events: ??\r\n\r\ninput-stream-start\r\ninput-stream-complete / end?\r\n\r\n// observable end?\r\n//  change from complete?\r\n\r\n// and next becomes data?\r\n// Observables are very much like readable streams.\r\n//  Not quite the same.\r\n\r\n// Time from input start to output complete\r\n\r\n// start\r\n\r\n// input-start\r\n// input-complete\r\n// output-start\r\n// output-complete\r\n\r\n// complete\r\n\r\n// an events callback on an observable?\r\n//  or io object is enough?\r\n\r\n\r\n// observable.io seems fine.\r\n//  maybe make it optional? later?\r\n// does make sense for basic timings.\r\n\r\n// function call io tracking definitely makes sense as a separate part.\r\n//  encapsulating this seems like it would definitely help. maybe with performance too?\r\n\r\n// then a system of [pre, main, post] would be wrapped like this.\r\n\r\n// .stages.events?\r\n\r\n// .events\r\n//  execution events? io events?\r\n\r\n// stage api...\r\n\r\n// execution times wrappers.\r\n//  argument transformation events?\r\n\r\n\r\n// could likely make this simpler through making further wrapping functions.\r\n//  would only work on an observable function?\r\n//  \r\n\r\n// monitor observable\r\n//  monitor(fn_obs)\r\n//  monitor(obs)\r\n\r\n// io_transforming(fn)\r\n//  itself with 3 stags?\r\n\r\n\r\n// function io monitoring seems like it would be generally useful.\r\n\r\n\r\n//  functionally / event driven involving hooks or similar?\r\n//   could directly give it an event handler function.\r\n\r\n// maybe want some different ways of using these advanced function calls.\r\n\r\n\r\n\r\n// oobs.io.rate\r\n//  but getting the rates of different stages is important too.\r\n\r\n//     .io.stages\r\n\r\n\r\n\r\n\r\n// \r\n\r\n\r\n\r\n\r\n\r\n// option: monitor: true\r\n\r\n\r\n// o_dl.monitor?\r\n\r\n\r\n\r\n\r\n\r\n\r\n//  ms (absolute)\r\n//  ms since start of the observable\r\n//  ms since start of the stage\r\n\r\n// do want detailed timing information.\r\n//  but could have a time updater on 1 ms ticks for performance reasons.\r\n//   means we just measure the time 1000 times a second.\r\n\r\n*/\r\n\r\n\r\n// fnl()\r\n// fns-es6 ?\r\n\r\n// could use the word 'obs'.\r\n// observe, observable\r\n// res, result\r\n// resolve\r\n// done\r\n// then\r\n// to\r\n// wait\r\n// after\r\n// go\r\n// open\r\n// r() gets result\r\n// sequence\r\n// seq\r\n// let obs = seq(definition).go();\r\n// let res_all = await(seq(definition)).go();\r\n// complete\r\n// end\r\n// begin\r\n// start\r\n// stop\r\n// finish\r\n//  autostart\r\n//   auto\r\n// args?\r\n\r\n// listen   |\r\n// hear     |\r\n// follow   |\r\n\r\n// monitor\r\n// map\r\n\r\n// observable.filter\r\n// observable.map\r\n// observable.stop, pause, resume\r\n// observable.status (get)\r\n\r\n// Decoding options in observable too (possibly)\r\n// An observable that does the decoding?\r\n\r\n// Observable and observer in one...\r\n//  observer.observe(other_observable, (my_next, my_complete, my_data))???\r\n\r\n// spread operators could be useful.\r\n\r\n// so, we want a function sequencer\r\n//  could change every function that gets called into an observable if it is not already\r\n\r\n// stages now involves each stage having pre, main, and post, each having possible intermediate data events.\r\n//  possibly a long download will help to illustrate this better.\r\n\r\n// need to be better at raising timing events\r\n\r\n// input start to input complete during each stage\r\n\r\n\r\n//  know how long the input takes\r\n//   be able to calculate input rate b/s\r\n// output start to output complete during each stage\r\n\r\n\r\n// could be more concise and on-point with an imo input, main, output abstraction.\r\n//  with automatic input and output processing.\r\n\r\n\r\n// Getting the event & timing working with the current code structure makes most sense.\r\n\r\n// Possible to log all event names?\r\n\r\n// We don't exactly have a function for preprocessing.\r\n//  may be nice to use the right abstraction(s) there.\r\n\r\n// For the moment, implement it without them, and then use regression testing to check that code improvements keep the right API and measurements.\r\n\r\n// pre-input-start\r\n// pre-input-data\r\n// pre-input-complete\r\n// pre-exec-start???\r\n\r\n// main-exec-input-start\r\n// main-exec-input-data\r\n// main-exec-input-complete ??? where will this occurr?\r\n\r\n// main-exec-start\r\n\r\n// main-exec-run-complete  ????? before the input has necessarily complete ?????\r\n//  main-exec-fn-complete?\r\n\r\n\r\n// main-exec-complete ?????          exec_complete? because maybe it's not complete, as in all data processed.\r\n\r\n// main-exec-output-start\r\n// main-exec-output-data\r\n// main-exec-output-complete\r\n\r\n\r\n\r\n// don't want function monitoring and io transformations to only be part of stages.\r\n//  it's come about because it's needed for the stages to work, be instrumented, but it could be used elsewhere too.\r\n\r\n\r\n// create the packages later.\r\n\r\n\r\n// monitor and transform could likely be brought in under fnl, returned with it too.\r\n\r\n\r\n\r\n// \r\n\r\n\r\n\r\n\r\n// monitor-function ???\r\n\r\n// function-monitor is available within npm. unabbreviated names better for SEO. abbreviated quicker to type.\r\n// could bring function-monitor into vhl, and through the functions, such as dl, that vhl provides.\r\n\r\n// function-io-transform\r\n//  as part of mfp? or extended from it?\r\n\r\n\r\n\r\n\r\n\r\n// mf???\r\n\r\n// mfp - monitored functional polymorphism?\r\n//  maybe monitor-function could use this\r\n//   input and output types, sizes, data events.\r\n//    this should be able to calculate rates.\r\n\r\n\r\n// function monitoring, as well as io transformations.\r\n\r\n\r\n\r\n// even put function monitoring in mfp?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Want rates and stage rates easily available in staged fn results.\r\n//  Can have rates for various streams\r\n//  For various transformations (2 streams?)\r\n\r\n// calculating rates and ratios is nearner now.\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst nce = (obs, next, complete, error) => {\r\n    obs.on('next', next);\r\n    obs.on('complete', complete);\r\n    obs.on('error', error);\r\n    return obs;\r\n}\r\n\r\n\r\nconst monitor_item = require('./monitor-item');\r\n/*\r\nconst obs = (next, complete, error) => {\r\n    let res = new Evented_Class();\r\n}\r\n*/\r\n\r\n// This is essentially a function wrapper.\r\n//  creates an observable function.\r\n//  Defining params in the function could really help.\r\n// definitely want more examples and tests of this observable type system.\r\n//  this seems like one of my best developments so far.\r\n// ofn?\r\n//  an object and a function together as parameters for a function call\r\n//  always returns a function?\r\n// a variety of standard functions such as...? all functions?\r\n//  obext, vhl, fnl, obs, fp, mfp, ofp, ofn\r\n// ofp and ofn could be useful general purspose functional modules.\r\n// ofn - executes a function, taking the parameters and re-ordering them?\r\n// allow mfp to do function reordering.\r\n//  that could work very nicely.\r\n// Definitely need some very cool and efficient functional programming tools.\r\n// redoing observable makes a bit of sense here.\r\n// remove always_plural\r\n//  it's been there, but have not been using it for advanced tech.\r\n\r\n// the new observable function...\r\n//  seems to be malfunctioning a little.\r\n//  fixed now. Has more flexibility with opts object.\r\n\r\n// mfp could be really useful here.\r\n//  could put it in later though.\r\n\r\n// would be nice to give the return type, other parts of grammar.\r\n\r\n// paused?\r\n//  definitely seems relevant / useful.\r\n\r\nconst tm_status_strings = {\r\n    'init': true,\r\n    'ok': true,\r\n    'complete': true,\r\n    'error': true,\r\n    'paused': true\r\n}\r\n\r\n// observable could do with a way of implementing different stages\r\n//  defining the stages?\r\n//   want them to be readable\r\n\r\n// or even give an object with functions instead of fn_inner?\r\n//  better to store stages in an array?\r\n//   seems more conventional.\r\n\r\n// array of stages does make sense.\r\n//  and a function for each stage\r\n\r\n// maybe a stages([fn, fn]) function?\r\n// stages below observable?\r\n//  or a more like a lang-mini upgrade to call_multi\r\n// stages is a better idiom.\r\n//  possibly could / should return an object\r\n//   a staged_fn?\r\n\r\n// seems like the staged_fn could be a building block for obs.\r\n\r\n// what would it return?\r\n//  result of the last stage.\r\n//   not some kind of staged obs?\r\n\r\n// but then async stages being specifically important\r\n//  defining stages as an array.....\r\n//   seems better within the observable function body for the moment?\r\n//  therefore a stages function.\r\n//   lang-mini?\r\n//    worth giving it a go.\r\n\r\n// observable stages will be useful.\r\n// for the moment, make the 'stages' function do some things, but don't have a specic stages array enclosure function.\r\n\r\n// looks like the right way to do it.\r\n// itself tracks its timings.\r\n\r\n// got a lot more support for stages.\r\n//  the stages() function now is built on top of obs, and provides syntactic sugar to use it well.\r\n\r\n// active rate monitoring events, say every 1s, would help.\r\n//  it could traverse back through its own next data info array.\r\n//   calculate the rate going back for the last 1s.\r\n\r\n// and want to be able to calculate the average_rate of a stage for all its data.\r\n//  bytes per second (by default)\r\n//   other rates could cauls problems if we expect bytes per second.\r\n//   data_rate?\r\n//    plus there will maybe be input_rate.\r\n//    output_rate is what we are referring to, maybe processing rate.\r\n//     output_rate sounds nice.\r\n\r\n// be able to watch the output rate.\r\n//  or be able to get readouts, like for the last 5s.\r\n\r\n// getting the output_rate for any stage seems very useful.\r\n\r\n// will be a slightly complex function.\r\n//  need to think of the best API / APIs.\r\n\r\n// possibly an analysis API.\r\n//  possibly feed stages next data through further.\r\n//   the stages observable next event?\r\n//    maybe it could cover all next events, feed them through.\r\n//     and we look at .stage to see when it changes stage.\r\n//      not sure.\r\n//   want a decent idiom / convention.\r\n\r\n// however, maybe we want stage exec start\r\n// stage exec complete\r\n//  or end?\r\n//  going with complete for the moment.\r\n//   may have an 'end' synonym in the observable\r\n//    Evented_Class event name alises / syonyms.\r\n\r\n// pre-exec\r\n// post-exec\r\n//  could measure the complete time there.\r\n//   pre and post is shorter than start and complete.\r\n//   makes sense here.\r\n// would be called in stages(...);\r\n\r\n// input-start definitely seems like a good start or a stage.\r\n//  \r\n// Observable will measure its ms_complete value\r\n//  How long it takes to complete.\r\n// ms_error as well?\r\n\r\n// o_something.i, .o, .io\r\n// .io.rate\r\n//  .io.ratio?\r\n//  .io.stages[name].rate / ratio?\r\n\r\n// .io.stages[name] seems OK in terms of following the same pattern. separately breaking down io.\r\n//  ????\r\n\r\n// .i.stages[name] is the input data\r\n// .o.stages[name] is the output data\r\n\r\n// .io as array of input and output.\r\n\r\n// res.io\r\n//  one single object there.\r\n//   simpler API.\r\n\r\n// .stages[name].ms?\r\n//   the stages relative to the staer, all together work quite nicely.\r\n//   leaving .ms.rel.stages for the moment.\r\n//  maybe .ms will have more detailed timing info.\r\n\r\n// .stages[name].io.rate?\r\n\r\n\r\n// Obs has come on well for use in stages\r\n// Could do with a bit more clarity about status feature.\r\n\r\n// Will now make it raise .io complete when its not waiting for a readable stream (or other?)\r\n\r\n// Having stages make a note that there is ongoing io?\r\n\r\n\r\n// io.ongoing?\r\n\r\n// a 'done' synonym / alias could work well.\r\n//  done being more concise than 'complete'. Same / very similar meaning too.\r\n\r\n\r\n// some kind of status saying io is ongoing?\r\n//  not always having an io object?\r\n\r\n\r\n\r\n// \r\n\r\n\r\n// Named observables may be of use\r\n//  Where the returned observable object has a name\r\n\r\n// Identified observables\r\n//  Where the returned observable object has a unique (probably ascending) id\r\n\r\n\r\n// Event name aliasing could help.\r\n// It can be convenient and intuitive to program a 'data' event rather than a 'next' event.\r\n// Raising them both would help.\r\n\r\nconst observable = function(fn_inner, opts) {\r\n    // 12/06/2019 - much improved.\r\n    // 13/06/2019 - working on stages events API\r\n    //  An observable will be able to run in stages\r\n    //  use stages() call to set it up easily.\r\n\r\n    const a = arguments;\r\n    const l = a.length;\r\n    const sig = get_a_sig(a);\r\n    let _opts, _fn_inner;\r\n\r\n    // will have .i, .o, .io in the result.\r\n\r\n    // stages will write expanded io data there.\r\n    //  input_bytes\r\n    //  output_bytes\r\n\r\n    // input_rate\r\n    // output_rate\r\n\r\n    // will have plenty of nice and interesting measurements from a variety of function calls.\r\n\r\n    //  Application instrumentation of a function call will definitely help.\r\n    //   Choose the params for running it.\r\n    //   Observe the (nested) results.\r\n    //    View profiling / timing info.\r\n\r\n    // Could do that with with dl quite soon.\r\n    //  A simple version at least.\r\n    //   Maybe then make the simple version extensible.\r\n    //   Still simple to use.\r\n    // Maybe could keep it simple, but allow complex functions and UIs to be plugged in.\r\n\r\n    // .i\r\n    // .o\r\n    // .io = [.i, .o];\r\n    // Anyway, need to obs_instance.io array.\r\n\r\n    // work out rates over time\r\n    // case?\r\n    \r\n    if (sig === '[f]' || sig === '[f,u]') {\r\n        _opts = {};\r\n        _fn_inner = a[0];\r\n    } else if (sig === '[f,o]') {\r\n        _fn_inner = a[0];\r\n        _opts = a[1];\r\n    } else if (sig === '[o,f]') {\r\n        _opts = a[0];\r\n        _fn_inner = a[1];\r\n    } else {\r\n\r\n        if (sig === '[O]' || sig === '[O,u]') {\r\n            return a[0];\r\n        } else {\r\n            console.log('sig', sig);\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n        // when we already have an observable - not sure why wrapping would again be attempted.\r\n\r\n        \r\n    }\r\n\r\n\r\n    // not on the specific function...?\r\n    //  may be nice to have an obs_fn?\r\n    //  \r\n\r\n\r\n\r\n\r\n    \r\n\r\n    const obs_res = ((opts, fn_inner) => {\r\n        // get values from the opts....\r\n        //  name option is becoming important now.\r\n        // then this will need to return something.\r\n        const ms_start = Date.now();\r\n        // ms.abs, ms.rel\r\n        const ms_since_start = () => Date.now() - ms_start;\r\n        const res = new Evented_Class();\r\n\r\n        // make that optional?\r\n        const io = res.io = new Evented_Class();\r\n\r\n\r\n\r\n        // io.ongoing?\r\n        //  would be a decent place for that flag.\r\n\r\n        // io.status?\r\n        //  be able to tell / automatically tell when the status is complete.\r\n        //   may be better there than the function's overall status\r\n        //    io status being automatically set in function execution?\r\n        //     in stages function execution?\r\n\r\n\r\n\r\n\r\n\r\n        // Flagging whether we are waiting for io makes sense.\r\n        //  Want to say the io is complete when the function call is totally complete.\r\n        //  For the moment the .io complete event is what we'll use\r\n        //   maybe it's not perfect.\r\n\r\n        // .io complete event is important...\r\n        //  want to detect cases where there is ongoing io.\r\n\r\n        // maybe the complete event will also contain the/an io complete callback.\r\n\r\n        // io complete will be the completion of the last uncomplete stage.\r\n        //res.io = new Evented_Class();\r\n\r\n        // Save res time?\r\n        //  record res time\r\n        //  record_res_ms\r\n        // Absolute and relative timings \r\n        // Only have stages there when using stages???\r\n\r\n        // not so sure about res.ms right now.\r\n        //  changing the time that measurement works during staged functions.\r\n\r\n        // probably not using .ms and .io for the moment.\r\n\r\n        /*\r\n\r\n        res.ms = {\r\n            abs: {\r\n                start: ms_start\r\n            },\r\n            rel: {\r\n                start: {\r\n                    //stages: {\r\n\r\n                    //}\r\n                }\r\n            }\r\n        }\r\n\r\n        */\r\n        // res is the evented class.\r\n        //res.i = {};\r\n        //res.o = {};\r\n        //res.io = [res.i = {}, res.o = {}];\r\n\r\n        // write stage output io?\r\n        // want the stage names as objects.\r\n\r\n        //  And functions to get the recent rate?\r\n        //  logging data events too?\r\n        //   could track the number per second?\r\n\r\n        // Want to send events through .io.\r\n\r\n        // and will raise io events at various points in time\r\n        //  for the overall function\r\n        //  for the stages\r\n        //   for substages of those stages      (encapsulate the 3 stage input(transform), main, output(transform))\r\n\r\n        // input_main_output\r\n        //  probably best not to use the 'stages' api for this, stages will use the IO transform system. call it a 'substage'.\r\n        //res.io = {};\r\n        // then it will have stages too for the io.\r\n        // res.ms.latency\r\n        // res.ms.taken?\r\n        // res.ms.total?\r\n        /*\r\n        const record_res_ms = (name) => {\r\n            const now = Date.now();\r\n            res.ms.abs[name] = now;\r\n            res.ms.rel.start[name] = now - ms_start;\r\n        }\r\n        */\r\n\r\n        let llog = [];\r\n        let _status = 'init';\r\n        \r\n        //log('ms_start', ms_start);\r\n        // obext read_only?\r\n\r\n        Object.defineProperty(res, \"ms_start\", {\r\n            value: ms_start,\r\n            writable: false\r\n        });\r\n        // latency property as well.\r\n        //  until it is in the 'ok' stage\r\n        // just the raw timings stored here.\r\n\r\n        let ms_ok, ms_complete, ms_error;\r\n        let ms_to_ok, ms_to_complete, ms_to_error;\r\n\r\n        // automatic timing measurements of observables will be very useful.\r\n        // time_taken?\r\n        //  since the start, as it continues\r\n\r\n        // time_to_complete\r\n        //  undefined if it's errored.\r\n        // time_to_error\r\n        const map_status_data = {};\r\n\r\n        // total ms, as in full time. wont be 0 in map at least.\r\n        const map_ms_reached_status = {};\r\n\r\n        let stage_number = -1;\r\n        let stage_name = 'init';  // automatic stage.  or 'start' stage?\r\n        // respond to the stage function call.\r\n        // it's stage -1. unindexed.\r\n\r\n        // for example:\r\n        //const stage_execution_info = [_stage_number, stage_name, stage_call_type_abbreviation, stage_res_type_abbreviation, time_started, time_into_observable];\r\n\r\n        // also make the stage event API available?\r\n        //  and stage info API?\r\n\r\n        // stage info being the info needed for simpler monitoring.\r\n        // as a map or array?\r\n        //  array does make more sense.\r\n\r\n        /*\r\n\r\n        const stages_execution_info = [\r\n            // any further execution info?\r\n            // it could go here.\r\n            // how many ms into the stages execution / since start.\r\n            // anything about data type here?\r\n            //[stage_number, stage_name, '', ms_start, 0]\r\n            // leaving this init stage out for the moment.\r\n        ];\r\n        */\r\n\r\n        // seems basically unused now.\r\n        //const arr_stage_log = [];\r\n        // stage execution info.\r\n        //  mapped by name\r\n        //   in an array too?\r\n\r\n        // want decent stage execution info.\r\n\r\n        // map of stage indexes by name\r\n        //  vice versa?\r\n\r\n        // stages can't share names.\r\n        //  seems easy enough, decent restriction.\r\n\r\n        // stage timings.\r\n        //  want to record specific info about stages and statuses\r\n\r\n        // log gets the status and the stages too?\r\n        //  and inner obs log data?\r\n        const log = (data) => {\r\n            const log_item = [Date.now(), data];\r\n            llog.push(log_item);\r\n            res.raise('log', log_item);\r\n        }\r\n\r\n        // stages will simply be names.\r\n        //  status can have accompanying data.\r\n\r\n        // Could there just be a status object?\r\n        //  Maybe don't need to map / track status changes.\r\n\r\n        const status = (str_status, data) => {\r\n            if (tm_status_strings[str_status]) {\r\n                const old_status = _status;\r\n                if (!map_ms_reached_status[str_status]) {\r\n                    map_ms_reached_status[str_status] = Date.now();\r\n                }\r\n                map_status_data[str_status] = data;\r\n                _status = str_status;\r\n                res.raise('status', {\r\n                    old: old_status,\r\n                    value: str_status,\r\n                    data: data\r\n                });\r\n            } else {\r\n                console.trace();\r\n                log('str_status', str_status);\r\n                throw 'invalid str_status ' + str_status;\r\n            }\r\n        }\r\n        // initial stage?\r\n        //  'init' by default?\r\n\r\n        let _stage;\r\n        let current_stage_info;\r\n\r\n        // stage events API will solve it.\r\n\r\n        /*\r\n        const _____begin_stage = stage_name => {\r\n            _stage = stage_name;\r\n            const now = Date.now();\r\n            const ms_into = now - ms_start;\r\n            current_stage_info = [stage_name, ms_into, now];\r\n            arr_stage_log.push(current_stage_info);\r\n        }\r\n\r\n        // autocall this if beginning new stage, or if complete is called.\r\n        const ____stage_complete = (stage_name, stage_res) => {\r\n            const [_stage_name, ms_into, ms_stage_start] = current_stage_info;\r\n            const now = Date.now();\r\n            const ms_time_taken = now - ms_stage_start;\r\n            current_stage_info.push(ms_time_taken);\r\n            _stage = null;\r\n        }\r\n        */\r\n        // also stage input data given here?\r\n        //  could be optional??\r\n        //   being given the stage number here as an arg would help.\r\n        //    do that from 'stages'. maybe autoincrement if undefined?\r\n        //     error stage is -2?\r\n\r\n        // lets see if /that we can do it.\r\n\r\n        //  maybe we do need stage_complete for when non-obs promises resolve.\r\n        //   think it's just promises for the moment that needs it.\r\n\r\n        //   but that would be in the stages part.\r\n        //    could give an event to this function for promise resolution?\r\n        //     that may need to be within the 'stages' section.\r\n        //     promise resolution happens there.\r\n        //      maybe could also send observable events here? not sure....\r\n\r\n        // a num_stages property could help.\r\n        //  need to know if a promise is the last stage?\r\n        //   as that promise needs to resolve, and be returned in the obs res.\r\n\r\n        // the last promise in the chain is a bit of an odd case.\r\n        //  functions are OK at getting the result of a promise as its param,\r\n        //   but with the last function if it's a promise, need to wait for the promise result.\r\n\r\n        // maybe should keep this as minimal as possible.\r\n\r\n        //  unsure about stage resolution / further systems within obs.\r\n        //   or that obs provides the stage facility / API for it, then stages() makes it easy to use.\r\n        //   keep it like this for the moment, or similar.\r\n\r\n        // ec_stage_events\r\n\r\n        //  seems necessary to observe a stage, but don't want to use another observable for it.\r\n\r\n        // Monitor stage IO.\r\n        //  a stage could have stages in a sense.\r\n        //   dont want it to become confusing.\r\n\r\n        // Don't give it the result immediately?\r\n        //  This part could also cover the pre-stage steps such as input param transformation.\r\n        //   eg getting a buffer from a stream means waiting for the stream to complete, want to get info about the data transfer rate\r\n\r\n        // Stage Events API.\r\n        //  That would make more sense.\r\n\r\n        // Be able to say what stage an observable is in.\r\n        //  stages() sets it up nicely for normal usage.\r\n        // Evented_Class_That_Remembers???\r\n        // stage_events API\r\n        // stage name, stage events evented class\r\n        // Probably best to redo this function.\r\n        //  change to stage_api.\r\n        // and a stage info API?\r\n        // this part is only for measurement / monitoring / instrumentation.\r\n        /// will be very interesting to measure a large amout of dls at once.\r\n        //   instrument it with a monitoring app too.\r\n        // Including timing data within io would help a lot.\r\n        //  time taken only - that is what is used to calculate the rate.\r\n        // io.stages.stage.ms_taken?\r\n        //  .ms?\r\n\r\n        // a stage could have a .ms measurement, within the io part.\r\n        //  absolute and other more detailed timing info would be stored elsewhere.\r\n\r\n        // separate input and output rates.\r\n\r\n        // Most likely, will remove all or most of this.\r\n        //  will make use of the io transformation and monitoring on each of the stages\r\n\r\n        // io transformation monitoring too.\r\n        //  seems somewhat important, integrating them at least.\r\n\r\n        // maybe going a little slower to make this now makes sense.\r\n        //  need to make sure that we make the right use of abstractions.\r\n\r\n        // observing the io on the stages\r\n        // applying io transformations to the stages.\r\n\r\n        // examples and tests of io transformations.\r\n        //  abstracting away io transformations and monitored io transformations will be very useful.\r\n\r\n\r\n        // get rid of this and some other stage monitoring.\r\n        //  it's going to be done with some other (slightly lower level) functions.\r\n\r\n\r\n        //const stage = (stage_name, ec_stage_api) => {\r\n\r\n\r\n        // another abstraction for dealing with function status, and its timing?\r\n        //  function status could work well for pre, main, awaiting-result, post\r\n\r\n        //  fn_status would be a nice and simple abstraction.\r\n        //   can specify the status values.\r\n        //    will understand simple works like 'pre', 'post', 'main'.\r\n        //     status will be less sophisticated than stages.\r\n\r\n        /*\r\n\r\n        //  as in stage io timings.\r\n        Object.defineProperty(res, \"latency\", {\r\n            get: () => {\r\n                if (map_ms_reached_status['ok']) {\r\n                    // calc it here\r\n                    return map_ms_reached_status['ok'] - ms_start;\r\n                }\r\n            }//,\r\n            //writable: false\r\n        });\r\n        */\r\n\r\n        /*\r\n        Object.defineProperty(res, \"ms_to_complete\", {\r\n            get: () => {\r\n                if (map_ms_reached_status['complete']) {\r\n                    // calc it here\r\n                    return map_ms_reached_status['complete'] - ms_start;\r\n                }\r\n            }//,\r\n            //writable: false\r\n        });\r\n        */\r\n\r\n        // stages_execution_info\r\n        //  logs are different. still consider them.\r\n        //   including summary such as data size where applicable would help.\r\n\r\n        // doesnt show as a key.\r\n\r\n        /*\r\n        Object.defineProperty(res, \"stages_execution_info\", {\r\n            get: () => stages_execution_info//,\r\n            //writable: false\r\n        });\r\n        */\r\n\r\n        // stages list?\r\n        //  num_stages\r\n\r\n        // stage_names?\r\n\r\n        /*\r\n        Object.defineProperty(res, \"stage_log\", {\r\n            get: () => arr_stage_log//,\r\n            //writable: false\r\n        });\r\n        */\r\n        // log and status a little neglected recently.\r\n\r\n        Object.defineProperty(res, 'log', {\r\n            get() {\r\n                // Could clone it for security so it can't be changed\r\n                return llog;\r\n            }\r\n        });\r\n\r\n        // More work / clarity on obs status?\r\n        //  Want to get the doc website up first.\r\n\r\n        Object.defineProperty(res, 'status', {\r\n            get() {\r\n                // Could clone it for security so it can't be changed\r\n                return _status;\r\n            }\r\n        });\r\n\r\n        // .ms and .io as a property?\r\n        //  not doing that right now.\r\n\r\n        // We call the inner function on each function call.\r\n        //  This provides the closure.\r\n        //  Could change fnl stages so that it calls function inner upon the function call.\r\n        //   not just at the beginning?\r\n        //    or not at the beginning?\r\n\r\n        // Maybe better not to have the timeout when debugging / looking at the callstack.\r\n\r\n        let had_next = false, had_complete = false, had_error = false;\r\n\r\n        setTimeout(() => {\r\n            //console.log('fn_inner', fn_inner);\r\n\r\n            // the inner function could be an async function....\r\n            //console.trace();\r\n\r\n            // Inner function should not be async???\r\n            //  Should be sync to return these functions as results.\r\n\r\n            // If it is async, we can't use those fns?\r\n\r\n            const res_fn_inner = fn_inner(data => {\r\n                // And could apply a filter here.\r\n                //  Could apply a number of filters.\r\n\r\n                // can not have raised complete or error.\r\n\r\n                let passes = true;\r\n\r\n                had_next = true;\r\n                // but only if not had an error or complete.\r\n                if (!had_complete && !had_error) {\r\n                    if (this.filters) {\r\n                        for (let filter of this.filters) {\r\n                            passes = filter(data);\r\n                            if (!passes) break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (had_complete) {\r\n                        // Only a warn I think?\r\n                        console.warn('Observable can not raise \"next\" event after having raised its \"complete\" event.')\r\n                    }\r\n                    if (had_error) {\r\n                        console.warn('Observable can not raise \"next\" event after having raised its \"error\" event.')\r\n                    }\r\n                }\r\n\r\n\r\n                // Maybe remove filtering?\r\n                //  Or filtering here is more efficient?\r\n\r\n                \r\n\r\n                // check the type of what's bein returned here?\r\n                // keep track of it?\r\n\r\n                // meaning if we don't see any R objects (maybe some others) then there is no need to wait for anything to say that the obs is complete.\r\n                //  special cases for identifying ongoing io?\r\n                //   the function status makes a lot of sense there.\r\n\r\n                // as does .io complete.\r\n\r\n                if (passes) {\r\n                    res.raise('next', data);\r\n                    res.raise('data', data);\r\n                }\r\n            }, last_data => {\r\n                // The observable complete event\r\n                //  Are we still waiting on any output?\r\n                //   This is an important thing to know.\r\n                //    Is this the final at least slightly tricky thing to solve?\r\n\r\n                if (!had_complete && !had_error) {\r\n                    had_complete = true;\r\n                    const tld = tf(last_data);\r\n                    //console.log('obs complete function called');\r\n                    //console.log('should now check if any io is still going. if not, raise io.complete');\r\n\r\n                    //console.log('tld', tld);\r\n                    //console.trace();\r\n\r\n\r\n                    // Give more thought towards if .io complete is the best way.\r\n                    //setImmediate(() => {\r\n                    //log('!!last_data', !!last_data);\r\n                    // Seems like we could do with noticing output-start event. <- do that now.\r\n                    // stage.input, stage.output?\r\n                    //  clearer definitions there?\r\n                    //   output based on a description of what happens to the input? can be calculated / known in advance anyway???\r\n                    //  especially when it's a stream / observable.\r\n                    // definitely want the io timings\r\n                    //  then will work on collecting io sizes\r\n                    //  then will work on calculating io rates\r\n                    // set the ms_complete value as well.\r\n                    //  make it a read_only property? enumerable as well?\r\n                    // An error doesn't seem to appear in here. look into it.\r\n                    // optimize date calls?\r\n                    // observable complete.\r\n                    // do this for has-response as well.\r\n                    //  that's an event (where the latency gets set)\r\n                    //record_res_ms('complete');\r\n                    const ms_complete = Date.now();\r\n\r\n                    res.ms_complete = ms_complete;\r\n                    res.ms_taken = ms_complete - ms_start;\r\n\r\n                    // ms_latency for consistency.\r\n                    //  only for staged functions so far?\r\n                    //  or could respond to the 'have-response' / 'response' / 'main-response' event.\r\n                    // listen for the main stage response?\r\n                    //  to begin with, want to build up more detailed stages data in the res.stages array.\r\n                    //res.ms.taken = res.ms.rel.start.complete;\r\n                    //res.ms_taken = ms_since_start();\r\n                    //res.ms_complete = Date.now();\r\n                    // and ms.taken is the relative measurement between start and complete.\r\n                    // ms complete is the absolute time measurement\r\n                    //  or ms_taken is better\r\n                    //log('res.ms_complete', res.ms_complete);\r\n\r\n                    if (tld !== 'u') {\r\n                        // See if it's an (ongoing?) readable stream?\r\n                        if (tld === 'R') {\r\n                            // Can we see the stage or status of the R?\r\n                            // listen for the complete event...?\r\n                            // Need to put the last data inside a wrapper object?\r\n                            // \r\n                            io.ongoing = true;\r\n                            // Monitoring not standard within observable.\r\n                            last_data.on('complete', () => {\r\n                                io.ongoing = false;\r\n                                io.raise('complete');\r\n                            });\r\n                        } else {\r\n                            //console.log('not an R, will raise complete and .io complete now');\r\n\r\n                            res.raise('complete', last_data);\r\n                            // io.complete = true?\r\n                            // raise the io.complete event?\r\n                            io.raise('complete');\r\n\r\n                            // \r\n                            // Should be complete enough...?\r\n                        }\r\n                        \r\n                    } else {\r\n                        res.raise('complete');\r\n                    }\r\n\r\n                } else {\r\n                    if (had_complete) {\r\n                        // Only a warn I think?\r\n                        console.warn('WARNING: Observable can not raise \"complete\" event after having raised it already.')\r\n                    }\r\n                    if (had_error) {\r\n                        console.warn('WARNING: Observable can not raise \"complete\" event after having raised its \"error\" event.')\r\n                    }\r\n\r\n                }\r\n\r\n                \r\n                //});\r\n            }, error => {\r\n\r\n                if (!had_complete && !had_error) {\r\n                    had_error = true;\r\n                    // Can only raise error once.\r\n                    //  After an error, it should stop, and will not produce further results.\r\n                    //console.log('error being raised', error);\r\n                    //console.log('tof error', tof(error));\r\n                    res.raise('error', error);\r\n                } else {\r\n                    if (had_complete) {\r\n                        // Only a warn I think?\r\n                        console.warn('WARNING: Observable can not raise \"error\" event after having raised its \"complete\" event.')\r\n                    }\r\n                    if (had_error) {\r\n                        console.warn('WARNING: Observable can not raise \"error\" event after having raised it already.')\r\n                    }\r\n                }\r\n\r\n\r\n                \r\n            }, status, log) || [];\r\n\r\n            if (is_array(res_fn_inner)) {\r\n                const [stop, pause, resume] = res_fn_inner;\r\n\r\n                if (stop) res.stop = stop;\r\n                if (pause) res.pause = pause;\r\n                if (resume) res.resume = resume;\r\n            \r\n                if (pause && resume) {\r\n                    res.delay = (ms) => {\r\n                        pause();\r\n                        res.raise('paused');\r\n                        setTimeout(() => {\r\n                            res.resume();\r\n                            res.raise('resumed');\r\n                        }, ms);\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n\r\n            //\r\n\r\n            // status before log!!!\r\n    \r\n            \r\n        }, 0);\r\n    \r\n        res.next = handler => {\r\n            res.on('next', handler);\r\n            return res;\r\n        }\r\n        res.data = res.next;\r\n        res.complete = handler => {\r\n            res.on('complete', handler);\r\n            return res;\r\n        }\r\n\r\n\r\n        // and a res.statud handler?\r\n\r\n        // copy the result when complete?\r\n        //  the .data to .res\r\n    \r\n        res.on('complete', data => {\r\n            // set the status\r\n            // don't have status data here though.\r\n            //  maybe could integrate that\r\n            status('complete');\r\n\r\n            // is it still doing io there?\r\n            //  need to be clever and clear about that.\r\n            //  it's a bit of a complication, and solving it means that we will have a source of confusion in programming more solved.\r\n\r\n\r\n\r\n            // an ongoing io flag that gets set somewhere would be useful?\r\n\r\n\r\n            // More explicit way of recognising ongoing io?\r\n            //  The dl function does that\r\n            //  As do some of the stages\r\n            //   But it is only when all the stages are over does io complete get called.\r\n\r\n            // and stage to 'complete'.\r\n            // don't store res?\r\n            //  leads to memory leak?\r\n            const store_res = () => {\r\n                if (data) {\r\n    \r\n                    if (data.data) {\r\n                        res.res = data.data;\r\n                    } else {\r\n                        res.res = data;\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    \r\n        res.done = res.end = res.complete;\r\n        res.error = handler => {\r\n            res.on('error', handler);\r\n            return res;\r\n        }\r\n    \r\n        res.then = handler => {\r\n            // the whole thing in set immediate?\r\n            //log('then');\r\n            // what if it's already resolved?\r\n            let res_all = [];\r\n\r\n\r\n            res.next(data => {\r\n                res_all.push(data);\r\n                had_next = true;\r\n            });\r\n    \r\n            if (res.completed) {\r\n\r\n                if (res.singular_result) {\r\n                    handler(res_all[0]);\r\n                } else {\r\n                    handler(res_all);\r\n                }\r\n\r\n                //res.ms.taken = res.ms.rel.start.complete;\r\n                \r\n            } else {\r\n                res.complete(last => {\r\n                    //res.ms.taken = res.ms.rel.start.complete;\r\n                    // not sure when we had the 'last' here.\r\n                    //log('complete last', last);\r\n                    //log('had_next', had_next);\r\n                    //log('res_all', res_all);\r\n                    if (had_next && res_all.length > 0) {\r\n                        if (res.singular_result) {\r\n                            handler(res_all[0]);\r\n                        } else {\r\n                            handler(res_all);\r\n                        }\r\n\r\n\r\n                    } else {\r\n                        handler(last);\r\n                    }\r\n                })\r\n            }\r\n            // and error handling\r\n        }\r\n        res.__type_name = 'observable';\r\n        // Could make these static read-only.\r\n        res._is_obs = res._is_observable = true;\r\n        // Not been using the _ ec.\r\n        //  Worth declaring earlier?\r\n        res._ = new Evented_Class();\r\n        // a bit (too) unconventional programming?\r\n        res.meta = (k, v) => {\r\n            if (v === undefined) {\r\n                // just the key\r\n            } else {\r\n                res._[key] = value;\r\n                res._.raise('change', {\r\n                    key: k,\r\n                    value: v\r\n                })\r\n            }\r\n        }\r\n        return res;\r\n    })(_opts, _fn_inner);\r\n\r\n    /*\r\n\r\n    const _ = obs_res._ = {\r\n        async: true,\r\n        return_type: 'observable'\r\n    }\r\n\r\n    // Should be a nice improvement.\r\n\r\n    console.log('observable create res._', obs_res._);\r\n    console.trace();\r\n\r\n    //throw 'stop';\r\n    */\r\n\r\n    return obs_res;\r\n    // Looks like a decent and performent startup pattern here.\r\n}\r\n\r\n// but observable itself is a function. seems ok like this.\r\nobservable._ = {\r\n    name: 'observable',\r\n    return_type: 'observable',\r\n    async: true\r\n}\r\n\r\n//observable.return_type = 'observable';\r\n//observable.async = true;\r\n\r\n\r\n// need to look into the observable examples in detail.\r\n//const observable = observable;\r\n\r\n//const observable = _observable;\r\n\r\n//obsfilter\r\n// by default will filter the 'next'\r\n//  returns a new observable that's filtered.\r\n//   So we can get a filtered output but also process the original because its still there.\r\n\r\n// a filter function.\r\n\r\n// obs.filter could generate a new observable with the filtering function.\r\n// but the obsfilter function would compress better.\r\n\r\nconst obsfilter = (obs, next_filter) => observable((next, complete, error) => {\r\n    obs.on('next', data => {\r\n        if (next_filter(data)) {\r\n            next(data);\r\n        }\r\n    })\r\n    obs.on('complete', data => {\r\n        if (data) {\r\n            complete(data)\r\n        } else {\r\n            complete();\r\n        }\r\n    })\r\n    obs.on('error', err => {\r\n        error(err);\r\n    })\r\n});\r\n// Examples, tests!!!\r\n\r\nconst obsmap = (obs, fn_map) => observable((next, complete, error) => {\r\n    obs.on('next', data => next(fn_map(data)));\r\n    obs.on('complete', complete);\r\n    obs.on('error', error);\r\n});\r\n\r\nconst obsalias = (obs_like, mapping) => {\r\n\r\n    let next, complete, error;\r\n\r\n    // mfp would help here.\r\n    //  Compiler has improved a lot in many cases since fp was first made.\r\n    const tmapping = tof(mapping);\r\n    if (tmapping === 'array') {\r\n        [next, complete, error] = mapping;\r\n    } else if (tmapping === 'object') {\r\n        //{next, complete, error} = mapping;\r\n        next = mapping.next;\r\n        complete = mapping.complete;\r\n        error = mapping.error;\r\n    }\r\n    return observable((n, c, e) => {\r\n        if (next) {\r\n            obs_like.on(next, n);\r\n        } else {\r\n            obs_like.on('next', n);\r\n        }\r\n        //log('!!complete', !!complete);\r\n        //log('complete', complete);\r\n\r\n        if (complete) {\r\n            obs_like.on(complete, c);\r\n        } else {\r\n            obs_like.on('complete', c);\r\n        }\r\n\r\n        if (error) {\r\n            obs_like.on(error, e);\r\n        } else {\r\n            obs_like.on('error', e);\r\n        }\r\n    })\r\n    // should be strings...\r\n    /*\r\n    log('Object.keys(obs_like)', Object.keys(obs_like));\r\n    const k = Object.keys(obs_like);\r\n    // make a map from them...\r\n    const km = get_truth_map_from_arr(k);\r\n    log('km', km);\r\n\r\n    if (km._events) {\r\n        log('Object.keys(km._events)', Object.keys(km._events));\r\n        log('obs_like._events', obs_like._events);\r\n        log('obs_like._eventsCount', obs_like._eventsCount);\r\n    }\r\n\r\n    throw 'stop';\r\n    */\r\n}\r\n\r\nconst obscollect = (obs, fn_collect, arr_res) => {\r\n    obs.on('next', data => {\r\n        const item_res = fn_collect(data);\r\n        arr_res.push(item_res);\r\n    })\r\n    return obs; // built for chaining fns.\r\n}\r\n\r\n// need to make sure mfp works properly for this...\r\n// also will help to give the function a name using mfp.\r\n// mfp now gets used during fnl setup\r\n// maybe obspool will be obselete or better explained in the future.\r\n// should remove obspool until mfp is (more) complete.\r\n\r\nconst obspool = () => {\r\n    console.trace();\r\n    throw 'out of order';\r\n}\r\n\r\n// mfp works so this may be worth bringing back.\r\n\r\n/*\r\nconst _obspool = mfp({\r\n\r\n    // 07/06/2019 - making mfp more capable & flexible - need to fix it though so it handles simple sig matching again...\r\n    //  or it's now f,a?\r\n    //   be able to recognise an 'a' in a sig.\r\n    //   would be useful for sig matching.\r\n    //    also be able to give / use details inside an array.\r\n\r\n\r\n    '[f,a]': (fn_obs, arr_params) => {\r\n        log('[f,a]');\r\n        log('arr_params', arr_params);\r\n        //log('arguments', arguments);\r\n        // each of the arr params - create the observable\r\n        return observable((next, complete, error, status, log) => {\r\n            let c = arr_params.length;\r\n            // not pooling the complete data...?\r\n            each(arr_params, param => {\r\n                const res_obs = fn_obs(param);\r\n                res_obs.on('next', next);\r\n                res_obs.on('error', err => {\r\n                    c--;\r\n                    //error(err);\r\n\r\n                    // next(err)\r\n                    //  then need to check it's not an error object?\r\n                    // {type: 'error'}\r\n                    //  could be easier?\r\n                    // next with an error object?\r\n                    //  log it?\r\n                    log(err);\r\n\r\n                    if (c === 0) complete();\r\n                });\r\n                res_obs.on('complete', err => {\r\n                    c--;\r\n                    if (c === 0) complete();\r\n                });\r\n\r\n                // then will need to listen to see if they are all complete?\r\n                //  or all errored?\r\n\r\n                // Rules / option to allow this to stop_on_error\r\n                //  default being false.\r\n            })\r\n        })\r\n    }\r\n})\r\n*/\r\n\r\n// fcall\r\n//  an enhanced way of calling a function\r\n// Pausable sequence\r\n\r\n// not so sure about the usage right now.\r\nconst seq = (q_obs) => {\r\n    return observable((next, complete, error) => {\r\n        let c = 0,\r\n            obs_q_item;\r\n        let process = () => {\r\n            if (c < q_obs.length) {\r\n                let q_item = q_obs[c];\r\n                obs_q_item = q_item[1].apply(q_item[0], q_item[2]);\r\n                obs_q_item.on('next', data => {\r\n                    next(data);\r\n                });\r\n                obs_q_item.on('error', error => {\r\n                    error(error);\r\n                });\r\n                obs_q_item.on('complete', data => {\r\n                    c++;\r\n                    process();\r\n                });\r\n            } else {\r\n                complete();\r\n            }\r\n        }\r\n        process();\r\n        let stop = () => {\r\n            obs_q_item.stop();\r\n            complete();\r\n        }\r\n        let pause = () => {\r\n            obs_q_item.pause();\r\n        }\r\n        let resume = () => {\r\n            obs_q_item.resume();\r\n            //complete();\r\n        }\r\n        return [stop, pause, resume];\r\n    });\r\n}\r\n\r\nconst obs_to_cb = (obs, callback) => {\r\n    let _obs = observable(obs);\r\n    let arr_all = [];\r\n    //log('obs_to_cb callback', callback);\r\n    //console.trace();\r\n    _obs.on('next', data => arr_all.push(data));\r\n    _obs.on('error', err => callback(err));\r\n    _obs.on('complete', last => {\r\n        //log('arr_all.length ', arr_all.length);\r\n        /*\r\n        if (arr_all.length === 0) {\r\n            callback(null, last);\r\n        } else {\r\n            callback(null, arr_all);\r\n        }\r\n        */\r\n        if (typeof last !== 'undefined') {\r\n            // don't return the array of all, they are only interim results\r\n            // or have it as the 3rd callback param!\r\n            callback(null, last, arr_all);\r\n        } else {\r\n            //log('callback', callback);\r\n            callback(null, arr_all);\r\n        }\r\n    });\r\n}\r\n// an unpaging version...\r\n//  or put unpaging elsewhere, around the definition of observable function.\r\n\r\n// page / chunked\r\n\r\n// unpaged function\r\n// takes an observable that gives arrays (pages), breaks them up\r\n\r\nconst unpage = (obs) => {\r\n    return observable((next, complete, error) => {\r\n        obs.on('next', arr_data => {\r\n            //log('arr_data', arr_data);\r\n            // Specialised processing for Command_Response_Message?\r\n            // An unpage function would be nice there.\r\n            //  or each_record\r\n            // Unpage would make sense because it can be used here, it's generic.\r\n            if ('unpaged' in arr_data) {\r\n                let unpaged = arr_data.unpaged;\r\n                for (let c = 0, l = unpaged.length; c < l; c++) {\r\n                    //log('unpaged[c]', unpaged[c]);\r\n                    next(unpaged[c]);\r\n                }\r\n            } else {\r\n                for (let c = 0, l = arr_data.length; c < l; c++) {\r\n                    next(arr_data[c]);\r\n                }\r\n            }\r\n        });\r\n        obs.on('complete', () => {\r\n            complete();\r\n        });\r\n        obs.on('error', err => error(err));\r\n        // Stop, pause, resume\r\n        return [];\r\n    });\r\n}\r\n\r\nconst obs_or_cb = (obs, callback, always_plural) => {\r\n    //log('obs_or_cb callback', callback);\r\n    if (callback) {\r\n        //log('is cb');\r\n        //log('has obs', obs);\r\n        obs_to_cb(obs, callback);\r\n    } else {\r\n        return observable(obs, always_plural);\r\n    }\r\n}\r\n\r\nconst sig_obs_or_cb = (a, inner) => {\r\n    // then if the last is a callback (function)\r\n    let a2;\r\n    //let using_cb = false;\r\n    let callback;\r\n    // \r\n    if (typeof a[a.length - 1] === 'function') {\r\n        // its a callback\r\n        //log('its a cb');\r\n        a2 = Array.prototype.slice.call(a, 0, -1);\r\n        callback = a[a.length - 1];\r\n        //using_cb = true;\r\n    } else if (typeof a[a.length - 1] === 'undefined') {\r\n        // its a callback\r\n        //log('its a cb');\r\n        a2 = Array.prototype.slice.call(a, 0, -1);\r\n        //using_cb = true;\r\n    } else {\r\n        a2 = Array.prototype.slice.call(a);\r\n    }\r\n    // if the last one is undefined\r\n    //  (as in a missing callback)\r\n\r\n    let sig = get_a_sig(a2);\r\n\r\n    let obs = observable((next, complete, error) => {\r\n        // no, can't return that...\r\n        //  need to return the observable???\r\n        //  \r\n        return inner(a2, sig, next, complete, error, a2.length);\r\n    });\r\n\r\n    //log('obs', obs);\r\n    //throw 'stop';\r\n    return obs_or_cb(obs, callback);\r\n    //let [stop, pause, resume] = inner();\r\n    // need to call the inner function as though an observable gets made.\r\n    //  maybe it's not possible / justifyable to put that handling here.\r\n    //return obs_or_cb()\r\n    // then call the inner function?\r\n}\r\n\r\n// -------------- Promises ----------------\r\n// ________________________________________\r\n\r\n// Just give it a function...?\r\n\r\nconst cb_to_prom_or_cb = (inner_with_cb, opt_cb) => {\r\n    if (typeof opt_cb !== 'undefined') {\r\n        inner_with_cb(opt_cb);\r\n    } else {\r\n        return new Promise((resolve, reject) => {\r\n            inner_with_cb((err, res) => {\r\n                if (err) {\r\n                    reject(err);\r\n                } else {\r\n                    resolve(res);\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n\r\nconst prom_or_cb = (prom, opt_cb) => {\r\n    let _prom;\r\n    if (prom instanceof Promise) {\r\n        //return prom;\r\n        _prom = prom;\r\n    } else {\r\n        // assuming its a function.\r\n        _prom = new Promise(prom);\r\n    }\r\n\r\n    if (opt_cb) {\r\n        _prom.then((res) => {\r\n            opt_cb(null, res);\r\n        }, err => {\r\n            opt_cb(err);\r\n        });\r\n    } else {\r\n        return _prom;\r\n    }\r\n}\r\n\r\nconst prom = (prom) => {\r\n    if (prom instanceof Promise) {\r\n        return prom;\r\n    } else {\r\n        // assuming its a function.\r\n        return new Promise(prom);\r\n    }\r\n}\r\n\r\n/*\r\n    Advanced Function\r\n\r\n    // Will have a function call that assists with typing / signatures.\r\n    //  Regex and wildcard checking would be nice.\r\n    //   Regex too slow\r\n    //   Check if the signatures match a few regular expressions and parse the \r\n\r\n*/\r\n\r\n// Data_Source\r\n//  a closure where 3 functions next, complete, error can be called.\r\nconst is_obs = obj => {\r\n    return obj.is_obs === true;\r\n}\r\nconst is_prom = obj => {\r\n    return obj instanceof Promise || obj.is_obs === true;\r\n}\r\n\r\n//  Not sure what this is for.\r\n// Multi-type specifier\r\nconst obs_prom_arr_item = (obj, obs, prom, arr, item) => {\r\n    if (obj.is_obs === true) {\r\n        return obs(obj);\r\n    } else {\r\n        if (obj instanceof Promise) {\r\n            return prom(obj);\r\n        } else {\r\n            if (Array.isArray(obj)) {\r\n                return arr(obj)\r\n            } else {\r\n                return item(obj);\r\n            }\r\n        }\r\n    }\r\n}\r\n// limit\r\n\r\n// limit the number of results from an observable\r\n//  then stop\r\n\r\n// Will this take an obs-multi wrapper? Like vml?\r\n\r\n// Definitely need examples and tests.\r\n\r\n// This is lower level than ofp.\r\n//  A full understanding and testing of this and ofp will help.\r\n//   ofp will be a platform for quite a few functions.\r\n//   maybe in combination with moft or omfp?\r\n//    could incorporate upgrades here too.\r\n\r\n// but will use mfp as a module in its own right.\r\n\r\n// obs.collect? etc...\r\n\r\n// Summary:\r\n// 1. obs() does allow for and implement functionality to support stages\r\n// 2. stages() uses and returns an obs. it's to help set up an observable that uses stages.\r\n//  no inner observable\r\n//  it's a way to get observables setting its stage values.\r\n\r\n//  The intermediate stages could be observables.\r\n//   Would help some types of observations.\r\n\r\n// returns a function.\r\n//  mfp could help annotate this.\r\n\r\n// mfp warnings on the wrong return type will help.\r\n//  console.warn as the wrong return type.\r\n\r\n// this could be a relatively simple function?\r\n\r\n// this will help to compose functions out of other functions\r\n//  eg same decompression function within a download or load from disk function.\r\n\r\n// fn_stages???\r\n// declarative mfp?\r\n// mfp with object and function....\r\n\r\n//  stages could have improved pipe stages.\r\n//   a syntax for data piping?\r\n//   readable and writable streams?\r\n//  stream into the next function, not using an observable?\r\n\r\n//  a function accepting a readable_stream?\r\n//   we could make a writable stream from the buffer results too.\r\n\r\n//  integrating the methods and syntax with pipe would make sense.\r\n//   downloading and decompressing without buffering in between would be useful.\r\n//    will be optional too.\r\n\r\n// A stage could itself be defined as a transform stream.\r\n//  want nicer syntax to decare a Transform_Stream.\r\n\r\n// works with obs, incorporates monitoring.\r\n//  want to be able to inspect the data rate of specific stages of a function.\r\n\r\n//  now need to work on inspecting the data rates of stages that involve / process R readable_stream.\r\n\r\n// when the input type of a stage is a readable stream\r\n// output type is readable stream\r\n\r\n// fn.io?\r\n\r\n// a .io property would be good for providing rates.\r\n//  input b/s, output b/s   i/o ratio\r\n//   some fairly simple measurements, code needs to be a little complex to do it.\r\n\r\n// could have monitoring elsewhere, and brought in here?\r\n//  for the moment put it here and in obs stages.\r\n//  maybe refer to / use monitoring code lower in the platform if it's suitable there.\r\n\r\n// the rate monitoring is currently a feature of observable.\r\n//  however, in some cases it appears as though we are moving away from observables to the node native streams.\r\n\r\n// observe_stream?\r\n\r\n// observables monitoring themselves?\r\n//  observables monitoring internal stages.\r\n//  that makes most sense for how monitoring will be used at the moment.\r\n\r\n//  want to calculate the rates of various operations within the function.\r\n//   and latencies too of course.\r\n\r\n//  want a dl etc function which has got built in advanced monitoring, compression handling etc.\r\n\r\n// this will help to tell in many cases what the performance is like.\r\n\r\n// monitor_stream\r\n//  could be a useful encapsulation for this.\r\n\r\n// raise stage event / events.\r\n\r\n// mid_stage_event?\r\n\r\n// try listening to stream events.\r\n\r\n// stage input stream event\r\n// stage output stream event\r\n\r\n// log info about both of them.\r\n\r\n//  want to measure log ram usage sizes too\r\n//   keep it under control where necessary.\r\n//    log size limits.\r\n\r\nconst arg_transformation = require('./default-arg-transformations');\r\n\r\nconst transform_stage_input = {\r\n    'R': arg_transformation.R\r\n}\r\n\r\n\r\n\r\n// turns out to be a considerably large amount of code.\r\n\r\n// returns a 'staged function'.\r\n\r\n// 16/06/2019 - about 2000 lines including comments.\r\n\r\n\r\n// 18/06/2019 - want to remake stages, so that makes use of fn-io-transform and fn-monitor.\r\n\r\n\r\n// 19/06/2019 - OK, stages is not so long or complex with the IO transformations and monitoring stripped from it.\r\n//  Having those encapsulated in their own functions will improve the code.\r\n\r\n\r\n// Calculate the overall 'rate'.\r\n//  Function output rate.\r\n\r\n// input rate is not so relevant to this function.\r\n// hard to calculate in fact. maybe irrelevant.\r\n\r\n\r\n// create stages object of the result.\r\n\r\n\r\n// .stages object\r\n//  .main true\r\n//  \r\n// .main object?\r\n//  could be the main stage object.\r\n\r\n// .input object\r\n// .output object\r\n\r\n// .output.rate\r\n\r\nconst stages = mfp({\r\n    name: 'stages',\r\n    return_type: 'function'   // function that returns an observable.\r\n}, function() {\r\n    // arrow function instead?\r\n    //  can we keep the same this in some places? or it doesn't matter when we use arrow fns elsewhere?\r\n    const a = arguments, l = a.length;\r\n    const sig = get_a_sig(a);\r\n    //const arr_stages = [];\r\n    //log('stages sig', sig);\r\n    let arr_stages;\r\n    let num_stages;\r\n\r\n    // simpler way to raise a stage event?\r\n\r\n    // its within the function that gets called.\r\n    //  want access to the observable result?\r\n\r\n    let fn_inner;\r\n    //let _raise_stage_event;\r\n\r\n    // Not so sure that preparing these functions works so well....\r\n    //  Or does it...?\r\n\r\n\r\n    // Not so sure that stage preparation actually works (here).\r\n    //  Possibly should use functions that have already been prepared if possible.\r\n    //   Or make a non-functional (ie does not wrap a function) system of io transformations.\r\n\r\n\r\n    // Possibility of calling the prepared functions within the right closure?\r\n\r\n    const prepare_arr_fns = (ofns) => {\r\n\r\n        const input_ofns = ofns => {\r\n            const map_stage_reserved_names = {\r\n                _raise_stage_event: true\r\n            }\r\n            const res = [];\r\n            //arr_stages = [];\r\n            // a 'pre' stage?\r\n            //  or do without that?\r\n            //   implement it separately / differently?\r\n            //log('ofns', ofns);\r\n            // filter it so it's not the reserved words...\r\n\r\n            const o_filtered_stage_fns = {};\r\n            let num_stages = 0;\r\n            let last_stage_name;\r\n\r\n            each(ofns, (fn_stage, stage_name) => {\r\n                // want to know if it's the last too.\r\n                //  won't have output transformation of promise.\r\n                // io transformed stage...\r\n                //  with transformation event callback?\r\n                //   then could give that to monitoring function.\r\n                // doing input and output on the stage function makes sense.\r\n                //  definitly makes sense to wait for promises to resolve.\r\n\r\n                //const io_transformed_stage = fn_io_transform(fn_stage)\r\n                //  then monitored stage...\r\n\r\n                // evented_fn, like evented_class?\r\n                //  events given in a callback\r\n                //   or observable if the callback is not provided?\r\n                //   or relatively basic Evented_Class, with the right API?\r\n\r\n                // leaving stage events out of here for the moment.\r\n\r\n                // an events callback function makes a lot of sense in some cases.\r\n                //  it's quite simple and performant, direct, and could then be wrapped in some kinds of objects.\r\n\r\n                if (!map_stage_reserved_names[stage_name]) {\r\n                    o_filtered_stage_fns[stage_name] = fn_stage;\r\n                    num_stages++;\r\n                    last_stage_name = stage_name;\r\n                }\r\n            });\r\n\r\n            each(o_filtered_stage_fns, (fn_stage, stage_name) => {\r\n                // want to know if it's the last too.\r\n                //  won't have output transformation of promise.\r\n                // define the transforms based on what the function accepts?\r\n                //  so if the fn is known to only accept some params, we can give it transforms to that parameter / those parameter arrangements.\r\n                // see what the stage accepts, if that's defined.\r\n                //log('stage_name', stage_name);\r\n                //log('fn_stage', fn_stage);\r\n                //log('Object.keys(fn_stage)', Object.keys(fn_stage));\r\n                const is_last_stage = stage_name === last_stage_name;\r\n                //log('is_last_stage', is_last_stage);\r\n                const map_sigs = fn_stage.map_sigs;\r\n\r\n                if (Object.keys(fn_stage).length === 0) {\r\n                    // still should io wrap it for arguments and promise resolution.\r\n                    const io_transform = {\r\n\r\n                    }\r\n                    // all stages apart from last should have output promise resolution.\r\n                    if (!is_last_stage) {\r\n                        io_transform.o = {\r\n                            p: arg_transformation.p\r\n                        }\r\n                    }\r\n                    // io transformed, with the io transformation monitoring?\r\n                    //  monitor the output of the input transform only?\r\n                    //  then monitor the function call too?\r\n                    //  monitor the input to the output processing stage?\r\n\r\n                    // monitoring integrated here?\r\n\r\n                    const io_transformed_stage = fn_io_transform(fn_stage, io_transform);\r\n                    io_transformed_stage.name = stage_name;\r\n                    res.push([stage_name, io_transformed_stage]);\r\n                    //fn_stage.name = stage_name;\r\n                    //arr_stages.push([stage_name, fn_stage]);\r\n                } else {\r\n                    // if we have the map of signatures...\r\n                    //  we can tell \r\n\r\n                    if (map_sigs) {\r\n                        const io_transform = {\r\n                            i: transform_stage_input\r\n                        }\r\n                        io_transform.o = {\r\n                            'p': arg_transformation.p,\r\n                            'O': arg_transformation.O\r\n                        }\r\n                        const io_transformed_stage = fn_io_transform(fn_stage, io_transform);\r\n                        io_transformed_stage.name = stage_name;\r\n                        res.push([stage_name, io_transformed_stage]);\r\n                    } else {\r\n                        const io_transform = {\r\n\r\n                        }\r\n                        //if (!is_last_stage) {\r\n                            //io_transform.p = arg_transformation.p;\r\n                        io_transform.o = {\r\n                            'p': arg_transformation.p,\r\n                            'O': arg_transformation.O\r\n                        }\r\n                        //}\r\n                        const io_transformed_stage = fn_io_transform(fn_stage, io_transform);\r\n                        io_transformed_stage.name = stage_name;\r\n                        res.push([stage_name, io_transformed_stage]);\r\n                    }\r\n                }\r\n            });\r\n            //num_stages = res.length;\r\n            //log('input_ofns num_stages', num_stages);\r\n            //console.trace();\r\n            return res;\r\n        }\r\n        return input_ofns(ofns);\r\n    }\r\n\r\n    const prepare = () => {\r\n        // but really its best to execute a function inside stages.\r\n        //  giving that function the capability of?:\r\n        //   Raising events on the result object\r\n        //   Raising stage events that go through the exising stages and observable system?\r\n        // Raising the 'have-result' or 'have-result-stream' would help to determine the latency\r\n        // 'have-result-stream' or 'result-stream' or 'response-stream' event.\r\n        //  knowing when a stram starts to be recieved is useful when calculating latency.\r\n\r\n        // Preparing the functions for execution.\r\n        //  Seems tricky now if we want to choose which closure the functions run in.\r\n        \r\n        if (sig === '[a]') {\r\n            valid = true;\r\n            each(a[0], stage => {\r\n                // and the stage should be an array\r\n                //log('stage', stage);\r\n                //log('get_a_sig(stage)', get_a_sig(stage));\r\n                if (get_a_sig(stage) === '[s,f]') {\r\n                    const [stage_name, fn_stage] = stage;\r\n                    if (!fn_stage.name) fn_stage.name = stage_name;\r\n                } else {\r\n                    valid = false;\r\n                    console.trace();\r\n                    throw 'expected stage to be specified as an array [s,f]'\r\n                }\r\n            });\r\n            if (valid) {\r\n                //arr_stages = a[0];\r\n                arr_stages = prepare_arr_fns(a[0]);\r\n                num_stages = arr_stages.length;\r\n            }\r\n        } else if (sig === '[o]') {\r\n            input_ofns(a[0]);\r\n        } else if (sig === '[f]') {\r\n\r\n            // Giving the function a single function.\r\n            //  That function event working independently with all function calls.\r\n\r\n            // But we are given a single function here.\r\n            //  Not sure how it will apply to the particular function call and particular result obs object.\r\n\r\n            // maybe this does work....\r\n\r\n            // Want to be able to raise stage events through the running of the stages.\r\n            //  possibly we should use an evented_fn wrapper.\r\n            //   has a .events as part of the result.\r\n            //    maybe it would be more flexible and less constrained than observable.\r\n\r\n\r\n            // Wrong use of closures here so far.\r\n            //  Not sure...\r\n\r\n            // sending the function raise_stage_event into the function call.\r\n            //  likely would be better to do this through access to the result observable.\r\n            //   not as sure about doing it through the closure here.\r\n\r\n            // Don't think we can define this function during the stages prep.\r\n\r\n            /*\r\n            const raise_stage_event = (name, evt) => {\r\n\r\n                // Within the definition part?\r\n                //  Not sure how to get this to apply to the result.\r\n\r\n                // This part is within the definition rather than the part that produces the result.\r\n                //  Making a new instance of that function for each call?\r\n\r\n                // Want to get events back to the 'stages' part.\r\n                //  Should be OK....\r\n                //   Because of closures.\r\n                //  ?????\r\n\r\n                // no, can't set _raise_stage_event for every function call.\r\n                //  however, an events property on each function call would make sense.\r\n\r\n\r\n\r\n                //if (_raise_stage_event) _raise_stage_event(name, evt);\r\n\r\n                console.trace();\r\n                throw 'stop';\r\n\r\n\r\n            }\r\n            */\r\n\r\n            // yes, can pass the function in here...\r\n            //  however, that would probably only work with singletons.\r\n            //  need to get it so that a new function is made before the function call?\r\n            //  but then a whole execution of the prepare function each time the function is run?\r\n            //   maybe, as it may need a new closure each time.\r\n\r\n            // want this raise_stage_event to be used on specific function calls.\r\n            //  its calls are relevant to specific executions of the function.\r\n\r\n            // Need to way the function input and calling? Seems we are close...\r\n\r\n            // Not so sure how to wrap the whole thing in a closure....\r\n            //  Need a different function call with the raise_stage_event for every time the stages fn is called.\r\n\r\n            //console.trace();\r\n            //throw 'Broken';\r\n\r\n            // Maybe this sets up the stage functions within the wrong closure when this is called at the beginning.\r\n            // first call of it... but it's possibly in the wrong closure.\r\n            //  for the moment, lets call it within the right closure.\r\n\r\n            // call the prepared functions?\r\n            //  but they are prepared to operate within the wrong closure?\r\n            \r\n            // Think that the functions that are prepared need to be called within local closure.\r\n            //  This could be done with a callback on the setup closure.\r\n            //   ???\r\n\r\n            // Preparing the functions on each call...?\r\n\r\n            //const res_fns_stages = a[0]();\r\n\r\n            // Not so wure we eant to call this now...?\r\n\r\n            // really not so sure about calling the inner function on setup.\r\n            //  maybe a different api that works with prepared functions will work better.\r\n            arr_stages = prepare_arr_fns(a[0]());\r\n            num_stages = arr_stages.length;\r\n            //input_ofns(res_fns_stages);\r\n            //return stages(res_fns_stages);\r\n            //console.trace();\r\n            //throw 'stages expected an array (may become more flexible in the future)';\r\n        } else {\r\n            // an object...\r\n            //  will put that into the arr_stages.\r\n            //arr_stages = [];\r\n            //each()\r\n            console.trace();\r\n            throw 'stages expected an array or object (may become more flexible in the future)';\r\n        }\r\n    }\r\n    const ms_pre_prepare = Date.now();\r\n    // maybe best not to (try to) prepare the functions all at once.\r\n    let res_prepare = prepare();\r\n    const ms_prep_time = Date.now() - ms_pre_prepare;\r\n\r\n    if (res_prepare) {\r\n        //log('pre prepare');\r\n        log('ms_prep_time', ms_prep_time);\r\n        return res_prepare;\r\n    }\r\n    //log('post prepare');\r\n    // can call the prepared functions, with the unique function / functions / objects from the wanted closure?\r\n\r\n    // set up the empty stage result info here?\r\n    //  then can clone it for every function call.\r\n\r\n    const arr_stages_info = new Array(arr_stages.length);\r\n    each(arr_stages, (arr_stage, i) => {\r\n        //log('fn_stage.name', fn_stage.name);\r\n        //log('fn_stage', fn_stage);\r\n        const stage_name = arr_stage[0];\r\n        //log('stage_name', stage_name);\r\n        // ms_input_start\r\n        // ms_input_complete\r\n        arr_stages_info[i] = {\r\n            name: stage_name\r\n        }\r\n    });\r\n    //throw 'stop';\r\n    // or the stages event function will be fine applying to the function def?\r\n    // Ability to respond to stage events here?\r\n    // Some kind of function execution closure...?\r\n    // Takes an event callback function?\r\n\r\n    // Main part of the fn, after prepare.\r\n    //  Not the execution closure.\r\n\r\n\r\n    // 06/07/2019 - Want to make it so that completion and io completion are better handled and dealt with.\r\n    //  would be nice if we didnt need to use io complete in many circumstances\r\n    //   and tell easily when we do need to use it.\r\n    //   be able to easily tell if the io is ongoing\r\n    //    that would be nice by default\r\n\r\n    //  see what the result is when it's complete.\r\n    //   if it's an R (or others not yet specced / done) then there is ongoing io.\r\n    //  normally complete event will mean totally complete\r\n    //   ongoing io will be considered a bit more of a special case.\r\n    //    could return an ongoing_io flag in the complete event.\r\n\r\n    //  yes. an ongoing io flag makes most sense.\r\n    //   boolean value for easiest checking.\r\n    //    other bits of functionality can bring this into a 'status' system.\r\n    \r\n\r\n    \r\n\r\n\r\n\r\n\r\n\r\n    const process = () => {\r\n        //log('3) process() num_stages', num_stages);\r\n        // I think the current system is broken, but I'm not sure.\r\n        //  Need to get various events back.\r\n\r\n        // Even have the stages function return the event?\r\n        //  Not got the event passing all sorted out yet.\r\n\r\n        // Likely to need different event function callbacks here.\r\n\r\n        // 1. a stage event function here perhaps?\r\n        //  How to get the stages function to provide the stage event function?\r\n\r\n        // think I have it....\r\n        const res = function() {\r\n            const a2 = arguments, l2 = a2.length;\r\n            const sig2 = get_a_sig(a2);\r\n            // 2. a stage event function here perhaps?\r\n            // raise it on the obs_res?\r\n            // The stages event function?\r\n            // Can monitor the input args here.\r\n            // input.status\r\n            //  waiting?\r\n            //  processing / on / started / running?\r\n            //   'on' is simplest\r\n            //  complete?\r\n            // input.bytes\r\n            // res.input.events\r\n            //  an evented_class\r\n            // res.output.events\r\n            let next_apply_args = a2.length === 0 ? undefined : a2;\r\n            //log('pre return stages obs');\r\n            // Could raise a stage event here...?\r\n            //  But really want stage timings to be nicely integrated.\r\n            // // is it just io?\r\n            // or info? metadata? md?\r\n            // .info?\r\n            // obs.io?\r\n            //  .io seems like a decent name.\r\n            // or 'other' event types in the observable?\r\n            // .stages would make sense too.\r\n            //  where data is provided about the various stages.\r\n            // .stage_events?\r\n            // maybe don't want to necessarily observe events (again), but want the data provided through observing / listening to their events.\r\n\r\n            // Events seem easier to raise here.\r\n            // This would be the place to call the closure for the stages to run in.\r\n            //  Call the given function each time the function executes.\r\n            //  Also call it for preparing the stages?\r\n            //   Should be fine, so long as it executes within the correct scope.\r\n            // Call the given function here....\r\n            // Define the stage callback function?\r\n            // or later on when it's got access to the callback function.\r\n            //  latencies for \r\n\r\n            // need to know the last stage that wasnt skipped.\r\n\r\n            // will raise 'stage' events on obs_res\r\n\r\n            //console.log('');\r\n            //console.log('pre create obs_res');\r\n            //console.trace();\r\n\r\n            const obs_res = observable((next, complete, error, status, log, stage) => {\r\n                // create the stage event callback function\r\n                // timings for make-request\r\n                // have-response\r\n\r\n                //console.log('');\r\n                //console.log('wrapped stages function being processed!!!');\r\n                //console.log('');\r\n                //console.trace();\r\n\r\n                const log_stage_events = [];\r\n                obs_res.log_stage_events = log_stage_events;\r\n                // map of stage events by name.\r\n                //  will help with latency calculations.\r\n\r\n                const map_stage_events_by_name = {};\r\n                // want to record the timings for the stage events.\r\n                //  and the times between subsequent stage events will be useful too... such as for providing a latency measurement.\r\n                // a log / list of stage event timings.\r\n                //  and just stage event info?\r\n                // and the time since the previous event too...\r\n                //  will be useful for finding things like latencies.\r\n\r\n                let ms_last_stage_event;\r\n                // just with a name, no properties here???\r\n                // Specific stage events...?\r\n                // And have the general ones, such as stage exec start etc?\r\n                // Want to be able to raise stage events.\r\n                // It should definitely know which stage it applies to!\r\n                //  And should not need to be told in the idiomatic code.\r\n                // Knowing what stage is running would be very useful for the stage_event function.\r\n                //  have we got / can we set a single running stage variable?\r\n\r\n                let c = 0;\r\n\r\n                // the c variable does not follow asyncronous execution.?\r\n\r\n                const cb_stage_event = (name, evt) => {\r\n                    // the evt name?\r\n                    // the event name being included in the event object?\r\n                    evt = evt || {\r\n                        name: name\r\n                    }\r\n                    //console.log('cb_stage_event name:', name);\r\n                    //console.log('evt', evt);\r\n                    //console.log('c', c);\r\n\r\n                    // c is the current stage index?\r\n                    //  not so sure it will be reliable. may need more testing.\r\n                    //console.trace();\r\n                    const now = Date.now();\r\n                    // want the stage name here as well.\r\n                    evt.ms = now;\r\n                    evt.i_stage = c;\r\n\r\n                    // Seems it does do OK waiting for promise resolution.\r\n                    //console.log('arr_stages[c]', arr_stages[c]);\r\n                    evt.stage_name = arr_stages[c][0];\r\n                    \r\n                    if (ms_last_stage_event) {\r\n                        evt.ms_since_last = now - ms_last_stage_event;\r\n                    }\r\n                    ms_last_stage_event = now;\r\n                    log_stage_events.push(evt);\r\n                    map_stage_events_by_name[name] = evt;\r\n\r\n                    if (name === 'have-response') {\r\n                        // can set the result latency.\r\n                        obs_res.ms_latency = now - map_stage_events_by_name['make-request'].ms;\r\n                    }\r\n\r\n                    obs_res.raise('stage', evt);\r\n                    /*\r\n                    log('cb_stage_event');\r\n                    log('name', name);\r\n                    log('evt', evt);\r\n                    console.trace();\r\n                    throw 'stop';\r\n                    */\r\n                    // It works with function reprep.\r\n                    //  Maybe a single closure will be fine so long as no local variables are needed.\r\n                    //  Though we could pass in a local {} to store local (in purpose) variables.\r\n                };\r\n                // call the main inner function (it returns the functions, but hopefully we can use the ones that are already prepared.)\r\n                //  but those prepared ones could be within the wrong closure :( )\r\n\r\n                const t1 = Date.now();\r\n                const new_obj_fns = a[0](cb_stage_event);\r\n                // and prepare them again?\r\n                // and newly prepared stages....\r\n\r\n                //log('new_obj_fns', new_obj_fns);\r\n                // Maybe function reprep won't take so long....? Especially if function prep gets called a lot, it will get compiled to run faster.\r\n\r\n                const newly_prepared_stages = prepare_arr_fns(new_obj_fns);\r\n                const arr_stages = newly_prepared_stages; // overrides in this scope.\r\n                const reprep_time = Date.now() - t1;\r\n                log('reprep_time', reprep_time);\r\n\r\n                // Repreparation of functions could be very inefficient :(\r\n                //  Maybe necessery for easiest use of the wanted closure.\r\n                //   Likely not though.\r\n                //   Or direct reference to the obs res would be another route - could use some syntactic sugar.\r\n                //console.trace();\r\n                //throw 'stop';\r\n\r\n                \r\n                //let _last_stage_res;\r\n                const res_input = obs_res.input = {};\r\n                // and a stages object?\r\n                const res_output = obs_res.output = {};\r\n                // res.events\r\n                //  would be simple enough to watch for events on that.\r\n                //   could send them all through that.\r\n                // Likely won't use res_events.???\r\n                //const res_events = obs_res.events = new Evented_Class();\r\n                //  And another route for transmitting events.\r\n                //log('arr_stages_info', arr_stages_info);\r\n                //console.trace();\r\n                const res_stages = obs_res.stages = clone(arr_stages_info);\r\n\r\n                //log('res_stages', res_stages);\r\n                //throw 'stop';\r\n                //const res_stages = res.stages = \r\n\r\n                // Raising stage events?\r\n\r\n                // Monitor what goes into the function.\r\n\r\n                //console.log('a2', a2);\r\n                //console.trace();\r\n\r\n                monitor_item(a2, (evt_input_args) => {\r\n                    //log('evt_input_args', evt_input_args);\r\n                    const event_name = evt_input_args.name;\r\n                    //log('event_name', event_name);\r\n                    //res_events.raise('input', evt_input_args);\r\n\r\n                    //console.trace();\r\n                    //throw 'stop';\r\n                    // input started..\r\n                });\r\n                // Need to do some further work in order to get latency.\r\n                //  It will have more to do with relative timings.\r\n                // since_start           start of the whole observable system\r\n                // since_stage_start\r\n                // need more relative timings to work out the latency.\r\n                //  or latency is the time the main function has its result available / output starting?\r\n                // ms until the main output?\r\n                //  the main stream starting.\r\n                \r\n                // seems like we need that in order to measure the latency.\r\n                //  or an event that gives the latency point?\r\n                //  and better to measure the latency without the fn setup etc.\r\n                // need more / better relative timings.\r\n                // time from the request being made until we have the response object.\r\n                // need a clear way of measuring the latency?\r\n                //  not something where it looks into the response of the 'main' stage?\r\n                //  status change, from waiting to has-response?\r\n                // sent-request first.\r\n                // raising a has-response event?\r\n                // keep track of the last stage that was run.\r\n                //  then if the execution is complete, ie with missed stages, \r\n                let i_last_unskipped_stage = -1;\r\n                let exec_is_complete = false;\r\n                // last unskipped stage index may be better.\r\n                //  not sure we need the name\r\n                const process_next = () => {\r\n                    // post processing promise resolution?\r\n                    //  better if it's set up ahead of time.\r\n                    //log('next_apply_args', next_apply_args);\r\n                    //log('num_stages', num_stages);\r\n                    // need promise resolution post-processing.\r\n                    //  the io processing will already be put in place.\r\n                    // monitor the input ags to the first stage.\r\n                    // Will (at first) monitor the objects before, after, and in between the different stages.\r\n                    const have_next_stage = !!arr_stages[c];\r\n                    const i_stage = c;\r\n                    //const ec_stage_api = new Evented_Class();\r\n                    //log('process_next c:', c);\r\n                    log('have_next_stage', have_next_stage);\r\n                    //log('Object.keys(arr_stages)', Object.keys(arr_stages));\r\n\r\n                    if (have_next_stage) {\r\n                        const stage_name = arr_stages[c][0];\r\n                        const fn_stage = arr_stages[c][1];\r\n                        // crate the stage info object in the result.\r\n                        const is_main_stage = fn_stage.main === true;\r\n                        const is_last_stage = c === arr_stages.length -1;\r\n                        //log('');\r\n                        //log('stage_name', stage_name);\r\n                        //console.trace();\r\n                        //log('is_main_stage', is_main_stage);\r\n                        //log('');\r\n                        const res_stage = res_stages[c];\r\n                        const res_prev_stage = res_stages[c - 1];\r\n                        const res_next_stage = res_stages[c + 1];\r\n                        res_stage.ms_start = Date.now();\r\n                        /*\r\n                        if (res_prev_stage && res_prev_stage.bytes_out) {\r\n                            // only when the previous stage's io is complete.\r\n                            res_stage.bytes_in = res_prev_stage.bytes_out;\r\n                        }\r\n                        */\r\n                        // bytes in being the bytes out of the prev stage.\r\n                        if (is_main_stage) {\r\n                            res_stage.main = true;\r\n                            // monitor the output?\r\n                            //  get the output rate from it.\r\n                        }\r\n                        // \r\n\r\n                        // and raise a main stage result when necessary.\r\n                        //throw 'stop';\r\n                        //_raise_stage_event = raise_stage_event;\r\n                        // Could work this way :)\r\n                        //  sending it to the closure works...\r\n                        //stage(stage_name, ec_stage_api);\r\n                        //let stage_res;\r\n                        //let dsargs = deep_sig(next_apply_args);\r\n                        // when it's the main stage, will set the .main object as well as the stage object in the array.\r\n\r\n                        let fn_ready_args;\r\n                        const exec_fn = () => {\r\n                            const i_stage = c;\r\n                            //log();\r\n                            console.log('calling exec_fn ' + stage_name);\r\n                            console.trace();\r\n                            //log();\r\n                            //const given_args_sig = deep_sig(fn_ready_args);\r\n                            // ms_exec_start?\r\n                            // need the output-start and output-complete events.\r\n                            //  maybe only output-start if its async output.\r\n                            //log('pre fn_stage.call');\r\n                            //log('fn_stage', fn_stage);\r\n                            //log('!!fn_ready_args', !!fn_ready_args);\r\n                            // Does the function get skipped?\r\n                            //  Need to know which is the last executed function.\r\n                            const stage_res = fn_stage.call(this, fn_ready_args, transform_call_event => {\r\n                                //log('Object.keys(transform_call_event)', Object.keys(transform_call_event));\r\n                                const {name, sig, value} = transform_call_event;\r\n                                // likely not to need an output sig.\r\n                                //log('name, sig', name, sig);\r\n                                // at the start?\r\n                                if (name === 'complete') {\r\n                                    // the stage could have been skipped.\r\n                                    //  no need to monitor output in that case.\r\n                                    //console.log('transform_call_event', transform_call_event);\r\n                                    //console.log('Object.keys(transform_call_event)', Object.keys(transform_call_event));\r\n                                    if (transform_call_event.skipped === true) {\r\n                                        res_stage.skipped = true;\r\n                                    } else {\r\n                                        // The last unskipped stage...?\r\n                                        if (i_stage > i_last_unskipped_stage) i_last_unskipped_stage = i_stage;\r\n                                        // Raising monitoring events may work best.\r\n                                        // monitor the output when the function call is complete?\r\n                                        // could send the input and output transforms / transformed parameters here.\r\n                                        let content_length;\r\n                                        // Not so sure we know what the last unskipped stage is at this point?\r\n                                        //  Telling when the io is complete would work better at the very end of the call chain?\r\n                                        // skipped function calls have output too?\r\n                                        //  same as the input.\r\n                                        // so the output from the last stage still happens....\r\n                                        // be able to get access to the monitoring later as well?\r\n                                        monitor_item(value, (evt_stage_res) => {\r\n                                            // will maybe have 'start'?\r\n                                            //  'available'?\r\n                                            const cl_evt = clone(evt_stage_res);\r\n                                            //log('cl_evt', cl_evt);\r\n                                            //console.trace();\r\n                                            //log('');\r\n                                            const event_name = evt_stage_res.name;\r\n                                            // io complete.\r\n                                            // these are output events.\r\n                                            // 'available' event.\r\n                                            // used to say the result start.\r\n                                            // possible event names...\r\n                                            // 'data'\r\n                                            // but also want to know the bytes into a function.\r\n                                            //  could be previous stage .bytes_out.\r\n                                            // Calculate its rate before its complete.\r\n                                            if (event_name === 'complete') {\r\n                                                console.log('c', c);\r\n                                                console.log('stage item complete');\r\n\r\n\r\n                                                // Or the complete event could contain a separate callback too for the io-complete?\r\n\r\n\r\n                                                // output_complete_ms\r\n                                                const ms_output_complete = Date.now();\r\n                                                const ms_taken = ms_output_complete - res_stage.ms_start;\r\n                                                res_stage.ms_output_complete = ms_output_complete;\r\n                                                // But what if we have not recorded bytes being output?\r\n                                                if (res_stage.ms_output_start) {\r\n                                                    const ms_output_taken = res_stage.ms_output_taken = ms_output_complete - res_stage.ms_output_start;\r\n                                                    if (ms_output_taken > 0) {\r\n                                                        //console.log('res_stage.bytes_out', res_stage.bytes_out);\r\n                                                        if (res_stage.bytes_out) {\r\n                                                            const output_rate = res_stage.bytes_out / (ms_output_taken / 1000);\r\n                                                            res_stage.output_rate = output_rate;\r\n                                                            // and if it's the main stage:\r\n                                                            if (is_main_stage) {\r\n                                                                obs_res.main_rate = output_rate;\r\n                                                            }\r\n                                                        }\r\n                                                    }\r\n                                                    // can also calculate the output rate.\r\n                                                }\r\n                                                res_stage.ms_taken = ms_taken;\r\n                                                // main stage complete?\r\n\r\n                                                // last unskipped stage complete?\r\n                                                \r\n\r\n                                                //console.log('i_last_unskipped_stage', i_last_unskipped_stage);\r\n                                                //console.log('i_stage', i_stage);\r\n                                                \r\n                                                // May have got into race consdition?\r\n                                                //  Only want to raise 'complete' after the last stage has executed at least.\r\n\r\n                                                console.log('c', c);\r\n                                                console.log('i_stage', i_stage);\r\n                                                console.log('is_last_stage', is_last_stage);\r\n\r\n                                                // only when execution is complete as well.\r\n\r\n                                                // Working on the monitored item right now.\r\n\r\n                                                // Maybe don't use .io object by default?\r\n                                                //  So it not being there means there is no ongoing io?\r\n\r\n\r\n                                                // Worth having a more serious and signigicant look into this.\r\n                                                //  It was a bit tricky before.\r\n                                                //  Want clarity and ease of use.\r\n\r\n\r\n\r\n                                                // Now this is (so far untested) done within obs, when it returns an R.\r\n\r\n                                                /*\r\n                                                if (exec_is_complete && i_stage === i_last_unskipped_stage) {\r\n                                                    obs_res.io.raise('complete');\r\n                                                }\r\n                                                */\r\n                                                // this stage number?\r\n\r\n\r\n                                                // at the end, c would be the length of the stages array....\r\n\r\n                                                /*\r\n                                                if (is_last_stage) {\r\n                                                    obs_res.io.raise('complete');\r\n                                                }\r\n                                                */\r\n\r\n                                                /*\r\n                                                if (c === arr_stages.length) {\r\n                                                    obs_res.io.raise('complete');\r\n                                                }\r\n                                                */\r\n\r\n                                                /*\r\n\r\n                                                // would work with a timeout?\r\n                                                //  probably best on the end of the whole thing.\r\n                                                //  last stage.\r\n\r\n                                                if (i_last_unskipped_stage === i_stage) {\r\n                                                    obs_res.io.raise('complete');\r\n\r\n                                                    // OK, looks like this is working now.\r\n                                                    // Make use of this within ofp.\r\n\r\n                                                }\r\n                                                */\r\n\r\n\r\n                                                // can calculate the output rate of the stage here.\r\n                                                ///log('monitor_item event:');\r\n                                                //log('-------------------')\r\n                                                //log('stage_name', stage_name);\r\n                                                //log('evt_stage_res', evt_stage_res);\r\n                                                // and the next stage's bytes in...\r\n                                                //if (res_next_stage && res_stage.bytes_out) {\r\n                                                    //res_next_stage.bytes_in = res_stage.bytes_out;\r\n                                                //}\r\n                                            } else if (event_name === 'available') {\r\n                                                // look at the content_length\r\n                                                //console.log('R available evt_stage_res', evt_stage_res);\r\n                                                //console.trace();\r\n                                                if (evt_stage_res.content_length) {\r\n                                                    res_stage.content_length = evt_stage_res.content_length;\r\n                                                    // also want to check to see if its the main stage.\r\n                                                    // main_content_length?\r\n                                                    if (is_main_stage) {\r\n                                                        content_length = obs_res.content_length = evt_stage_res.content_length;\r\n                                                    }\r\n                                                }\r\n                                                res_stage.ms_output_start = Date.now();\r\n                                            } else if (event_name === 'data') {\r\n                                                // evt_stage_res\r\n                                                // Can get the estimated time remaining here.\r\n                                                /*\r\n                                                    Don't need to calculate as much here - it's already been calculated in the monitoring function.\r\n                                                    {\r\n                                                        name: 'data',\r\n                                                        t: 'B',\r\n                                                        bytes: data.length,\r\n                                                        bytes_total: bytes,\r\n                                                        byte_rate: byte_rate,\r\n                                                        content_length: content_length,\r\n                                                        bytes_remaining: bytes_remaining,\r\n                                                        ms_est_remaining: est_remaining,\r\n                                                        ms_taken: ms_taken,\r\n                                                        proportion: proportion\r\n                                                    }\r\n                                                */\r\n                                                // bytes_total\r\n                                                const {bytes, bytes_total, byte_rate, content_length, bytes_remaining, ms_est_remaining, ms_est_complete, ms_taken, proportion} = evt_stage_res;\r\n                                                //res_stage.ms_output_start = Date.now();\r\n                                                // though we could add to the bytes_out.\r\n                                                //res_stage.bytes_out = res_stage.bytes_out || 0;\r\n                                                //res_stage.bytes_out += cl_evt.bytes;\r\n                                                // and can measure / record the bytes out rate.\r\n                                                //const ms_outputting = Date.now() - res_stage.ms_output_start;\r\n                                                const ms_processing_output = ms_taken; // subtract paused time too?\r\n                                                const out_rate = byte_rate;\r\n                                                // Some of this may be better encapsulated elsewhere.\r\n                                                //console.log('stage_name', stage_name);\r\n                                                //console.log('byte_rate', byte_rate);\r\n                                                res_stage.bytes_out = bytes_total;\r\n                                                // the bytes io gets stored in the stages info anyway.\r\n                                                // also will skip decompression stage if we don't get gzipped or whatever web compression.\r\n                                                if (res_stage.bytes_in) {\r\n                                                    // out / in\r\n                                                    //  oi ratio seems like the one we want most.\r\n                                                    // just bytes_ratio?\r\n                                                    res_stage.bytes_oi_ratio = res_stage.bytes_out / res_stage.bytes_in;\r\n                                                }\r\n                                                // the main rate makes sense to use.\r\n                                                //  not say its the overall fn output rate.\r\n                                                if (is_main_stage) {\r\n                                                    // main_bytes_out\r\n                                                    // main_byte_rate?\r\n                                                    // main_rate\r\n                                                    // obs_res.main_bytes_out = obs_res.main_bytes_out || 0;\r\n                                                    obs_res.main_bytes_out = bytes_total;\r\n                                                    // and main_rate\r\n                                                    // the main rate.\r\n                                                    obs_res.main_output_rate = out_rate;\r\n                                                    // estimated completion time?\r\n                                                }\r\n\r\n                                                if (i_last_unskipped_stage === i_stage) {\r\n                                                    // this will be the output for all the stages as a whole.\r\n                                                    // do want to be able to calculate the sizes of arrays etc.\r\n                                                    //  be able to switch it off, but it will be useful for consistency in measurements.\r\n                                                    //   will be useful in knowing and using actual data rates.\r\n                                                    obs_res.bytes_out = bytes_total;\r\n                                                    //obs_res.bytes_out += cl_evt.bytes;\r\n                                                    obs_res.output_rate = out_rate;\r\n                                                    // and the out / output rate.\r\n                                                    // estimated completion time?\r\n                                                    //console.log('cl_evt', cl_evt);\r\n                                                    // \r\n                                                    if (def(proportion)) obs_res.proportion = proportion;\r\n                                                    if (def(bytes_remaining)) obs_res.bytes_remaining = bytes_remaining;\r\n                                                    if (def(ms_est_remaining)) obs_res.ms_est_remaining = ms_est_remaining;\r\n                                                    if (def(ms_est_complete)) obs_res.ms_est_complete = ms_est_complete;\r\n                                                    // and estimate when it will be complete too.\r\n                                                }\r\n\r\n                                                if (res_next_stage) {\r\n                                                    res_next_stage.bytes_in = res_next_stage.bytes_in || 0;\r\n                                                    res_next_stage.bytes_in += cl_evt.bytes;\r\n                                                }\r\n                                            } else {\r\n                                                // ignore data events for the moment\r\n                                                log('event_name', event_name);\r\n                                                console.trace();\r\n                                                throw 'stop';\r\n                                            }\r\n                                            // output complete separate to stage exec complete.\r\n                                            // send this through to further monitoring?\r\n                                        });\r\n                                    }\r\n                                    // can go to the next\r\n                                    // we have the value it was completed with :)\r\n                                    // don't need last_stage_res?\r\n                                    //_last_stage_res = value;\r\n                                    next_apply_args = value;\r\n                                    c++;\r\n                                    // output complete?\r\n                                    log('pre process next stage');\r\n                                    process_next();\r\n                                } else {\r\n                                    log('transform_call_event', transform_call_event);\r\n                                    //console.trace();\r\n                                    // send it through as a stages event?\r\n                                    /// want to \r\n                                    // determining rate and latency with a few different operations...?\r\n                                    // and output-transform-complete too?\r\n                                    if (name === 'input-transform-complete') {\r\n                                        // record the stage as having an input transformation.\r\n                                        //o_dl.stages?\r\n                                        // .stages could work better than .io and .io.stages.\r\n                                        // .rate and .latency seem the most important.\r\n                                        \r\n                                        //  definitely the most important for eos-live.\r\n                                        // set the time of io transform complete...\r\n                                        const ms_input_transform_complete = Date.now();\r\n                                        res_stage.ms_input_transform_complete = ms_input_transform_complete;\r\n                                        res_stage.ms_input_transform_taken = ms_input_transform_complete - res_stage.ms_input_transform_start;\r\n                                    } else if (name === 'input-transform-start') {\r\n                                        // record the stage as having an input transformation.\r\n                                        //o_dl.stages?\r\n                                        // .stages could work better than .io and .io.stages.\r\n                                        // .rate and .latency seem the most important.\r\n                                        \r\n                                        //  definitely the most important for eos-live.\r\n                                        // set the time of io transform complete...\r\n                                        res_stage.ms_input_transform_start = Date.now();\r\n                                    } else if (name === 'exec-start') {\r\n                                        // record the stage as having an input transformation.\r\n                                        //o_dl.stages?\r\n                                        // .stages could work better than .io and .io.stages.\r\n                                        // .rate and .latency seem the most important.\r\n                                        \r\n                                        //  definitely the most important for eos-live.\r\n                                        // set the time of io transform complete...\r\n                                        res_stage.ms_exec_start = Date.now();\r\n                                    } else if (name === 'exec-complete') {\r\n                                        // record the stage as having an input transformation.\r\n                                        //o_dl.stages?\r\n                                        // .stages could work better than .io and .io.stages.\r\n                                        // .rate and .latency seem the most important.\r\n                                        \r\n                                        //  definitely the most important for eos-live.\r\n                                        // set the time of io transform complete...\r\n                                        const ms_exec_complete = Date.now();\r\n                                        res_stage.ms_exec_complete = ms_exec_complete;\r\n                                        res_stage.ms_exec_taken = ms_exec_complete - res_stage.ms_exec_start;\r\n                                    } else {\r\n                                        log('name', name);\r\n                                        log('transform_call_event', transform_call_event);\r\n                                        console.trace();\r\n                                        throw 'stop';\r\n                                    }\r\n                                    // input-transform-complete\r\n                                    // input transfom data events...?\r\n                                    //  will want to know what the data was changed to.\r\n                                    // stage input transformation event...?\r\n                                }\r\n                            });\r\n                        }\r\n                        fn_ready_args = next_apply_args;\r\n                        log('pre exec_fn');\r\n                        exec_fn();\r\n                    } else {\r\n                        //log('process_next reached completion. may still need to do some output transformation.');\r\n                        //console.log('i_last_unskipped_stage', i_last_unskipped_stage);\r\n                        // then the output from the last unskipped stage is the main function output\r\n                        // connect to that stage's output monitoring / events?\r\n                        const tsr = tf(next_apply_args);\r\n                        c++;\r\n                        log('tsr', tsr);\r\n                        //log('pre raise complete');\r\n                        // can complete the download function with a readable stream.\r\n                        //  or a parsed object.\r\n                        // and the io complete?\r\n                        //  wait for the whole of the io to be complete?\r\n                        // wait for the last unskipped stage?\r\n                        console.log('the stages exec is complete');\r\n                        console.log('i_last_unskipped_stage', i_last_unskipped_stage);\r\n                        // then we want to wait for the completion of that stage to say that the whole function is complete?\r\n                        // or monitor the next_apply_args specially here, this will be the output monitoring of the function.\r\n                        //  But these args are already monitoried?\r\n                        exec_is_complete = true;\r\n                        complete(next_apply_args);\r\n                        //log('post raise complete');\r\n                    }\r\n                }\r\n                process_next();\r\n            });\r\n            return obs_res;\r\n        }\r\n        res.is_staged = true;\r\n        // or it returns a function?\r\n        res.return_type = 'observable'; //???should already be.\r\n        return res;\r\n    }\r\n    return process();\r\n})\r\n\r\n// output_complete - final output for the stage.\r\n//  either main part or post-processing.\r\n\r\n//  main-output-complete\r\n//  post-output-complete\r\n//  output-complete - whichever of the above two is later.\r\n//   always gets called.\r\n\r\n\r\n// need to finish off single function staged call:\r\n//  finish measurements of all parts\r\n//   calculate rate\r\n//   and io ratio\r\n\r\n// measuring the overall rate is important\r\n//  still need to do more work on getting the data sizes for the stages.\r\n\r\n// Stages\r\n//  will return an observable\r\n//   so yes, use mfp to include the return type at least.\r\n//   only accept an array or an object?\r\n//    only accept array for the moment.\r\n//    must be an array of functions.\r\n//     more type checking / grammar work needed?\r\n\r\n// An observable that gives info about the various stages inside it....\r\n\r\nmodule.exports = {\r\n    'observable': observable,\r\n    'nce': nce,\r\n    'obs': observable,\r\n    'obsalias': obsalias,\r\n    'obscollect': obscollect,\r\n    'obsfilter': obsfilter,\r\n    'obspool': obspool,\r\n    'obsmap': obsmap,\r\n    'seq': seq,\r\n    'sequence': seq,\r\n    'sig_obs_or_cb': sig_obs_or_cb,\r\n    'cb_to_prom_or_cb': cb_to_prom_or_cb,\r\n    'prom_or_cb': prom_or_cb,\r\n    'prom': prom,\r\n    'obs_or_cb': obs_or_cb,\r\n    'unpage': unpage,\r\n    'is_obs': is_obs,\r\n    'is_prom': is_prom,\r\n    'obs_prom_arr_item': obs_prom_arr_item,\r\n    'stages': stages\r\n}\r\n\r\nif (require.main === module) {\r\n\r\n    console.log('running fnl as main');\r\n    // Could return its stop function.\r\n    //  Use its next, complete, error functions in one closure\r\n    //  Get back its stop, pause, resume functions as the result in an array\r\n\r\n    /*\r\n    // Keeping this longer form -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-\r\n\r\n    let data_source_interval_mult = (next, complete, error) => {\r\n        ...\r\n        return [stop, pause, resume];\r\n    }\r\n    // -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~\r\n\r\n    // Other code with a data_source functionality?\r\n    // Seems like a fairly good standad for making an observable.\r\n\r\n    let obs = observable(data_source_interval_mult);\r\n\r\n    */\r\n    // observables / data sources that apply to something else?\r\n    //  anyway, can use this observable for the moment to improve some server code.\r\n\r\n    // Data source - gets functions to call, returns functions.\r\n    //  The observable manages that.\r\n\r\n    // Maybe return a data_source itself? or the data source is simply a function being executed.\r\n    // This looks like it could tidy up some server code.\r\n\r\n    const make_timer_obs = () => observable((next, complete, error) => {\r\n        let c = 2;\r\n        let paused = false;\r\n\r\n        let cease = () => {\r\n            clearInterval(ivl);\r\n        }\r\n\r\n        let stop = () => {\r\n            clearInterval(ivl);\r\n            complete();\r\n        }\r\n\r\n        let ivl = setInterval(() => {\r\n            if (!paused) {\r\n                let v = c * 2;\r\n                //log('v', v);\r\n                next({\r\n                    'v': v\r\n                });\r\n                c++;\r\n\r\n                if (c > 6) {\r\n                    error(new Error('A problem'));\r\n                    cease();\r\n                    // After error, should not allow 'next' or 'complete'.\r\n\r\n                }\r\n\r\n                if (c > 8) {\r\n                    stop();\r\n                }\r\n            }\r\n\r\n        }, 1000);\r\n\r\n        return [stop, () => {\r\n            paused = true;\r\n        }, () => {\r\n            paused = false;\r\n        }];\r\n    });\r\n\r\n    let obs = make_timer_obs();\r\n\r\n\r\n\r\n    /* .filter(data => {\r\n        return data.v !== 8;\r\n    }).filter(data => {\r\n        return data.v % 3 !== 0;\r\n    }); */\r\n\r\n    // ok, this event listener works too.\r\n\r\n    let test_obs = () => {\r\n        obs.on('paused', () => log('* paused'));\r\n        obs.on('resumed', () => log('* resumed'));\r\n        obs.on('error', (err) => log('* error', err));\r\n        obs.next(data => {\r\n            log('data', data);\r\n        });\r\n    }\r\n    test_obs();\r\n\r\n    let test_then = () => {\r\n        (async () => {\r\n            let res = await obs;\r\n            log('awaited res', res);\r\n        })();\r\n    }\r\n    //test_then();\r\n\r\n    log('stages', stages);\r\n\r\n    let test_split = () => {\r\n        obs.on('paused', () => log('* paused'));\r\n        obs.on('resumed', () => log('* resumed'));\r\n\r\n        let [obs1, obs2] = obs.split(data => data.v % 3 === 0)\r\n\r\n        obs1.on('next', data => log('obs1 data', data));\r\n        obs2.on('next', data => log('obs2 data', data));\r\n    }\r\n\r\n    //test_split();\r\n\r\n    let test_filter = () => {\r\n        obs.filter(data => {\r\n            return data.v !== 8;\r\n        }).filter(data => {\r\n            return data.v % 3 !== 0;\r\n        });\r\n\r\n        obs.next(data => {\r\n            //log('data', data);\r\n            if (data === 8) {\r\n                obs.delay(5000);\r\n\r\n                // works nicely here.\r\n                // want listeners for the pause and resume events.\r\n                // That would be convenient syntax\r\n\r\n                obs.pause();\r\n                log('paused');\r\n                setTimeout(() => {\r\n                    log('wait over');\r\n                    obs.resume();\r\n                }, 2000);\r\n\r\n            }\r\n        }).end(() => {\r\n            log('end');\r\n        })\r\n    }\r\n} else {\r\n\r\n}\r\n", "// Late 2023 - Should include field from obext as well?\r\n\r\n// Bring more data functionality to a lower level...?\r\n//   Have more of a platform to support Data_Model, Data_Value and Data_Object with.\r\n\r\n// data.schema?\r\n// data.model.schema???\r\n\r\n// Would be worth integrating various parts together here and with Data_Model, Data_Object, Data_Value\r\n\r\n\r\nconst running_in_browser = typeof window !== 'undefined';\r\nconst running_in_node = !running_in_browser;\r\nlet Readable_Stream, Writable_Stream, Transform_Stream;\r\nconst get_stream = () => {\r\n\tif (running_in_node) {\r\n\t\treturn (() => {\r\n\t\t\tconst str_libname = ('str') + ('eam');\r\n\t\t\tconst stream = require(str_libname);\r\n\t\t\tReadable_Stream = stream.Readable;\r\n\t\t\tWritable_Stream = stream.Writable;\r\n\t\t\tTransform_Stream = stream.Transform;\r\n\t\t\treturn stream;\r\n\t\t})();\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n}\r\nconst stream = get_stream();\r\nconst each = (collection, fn, context) => {\r\n\tif (collection) {\r\n\t\tif (collection.__type == 'collection') {\r\n\t\t\treturn collection.each(fn, context);\r\n\t\t}\r\n\t\tlet ctu = true;\r\n\t\tlet stop = function () {\r\n\t\t\tctu = false;\r\n\t\t};\r\n\t\tif (is_array(collection)) {\r\n\t\t\tlet res = [],\r\n\t\t\t\tres_item;\r\n\t\t\tfor (let c = 0, l = collection.length; c < l; c++) {\r\n\t\t\t\tres_item;\r\n\t\t\t\tif (ctu == false) break;\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tres_item = fn.call(context, collection[c], c, stop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres_item = fn(collection[c], c, stop);\r\n\t\t\t\t}\r\n\t\t\t\tres.push(res_item);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\tlet name, res = {};\r\n\t\t\tfor (name in collection) {\r\n\t\t\t\tif (ctu === false) break;\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tres[name] = fn.call(context, collection[name], name, stop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres[name] = fn(collection[name], name, stop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n};\r\nconst is_array = Array.isArray;\r\nconst is_dom_node = function isDomNode(obj) {\r\n\treturn (!!obj && typeof obj.nodeType !== 'undefined' && typeof obj.childNodes !== 'undefined');\r\n};\r\nconst get_truth_map_from_arr = function (arr) {\r\n\tlet res = {};\r\n\teach(arr, function (v, i) {\r\n\t\tres[v] = true;\r\n\t});\r\n\treturn res;\r\n};\r\nconst get_arr_from_truth_map = function (truth_map) {\r\n\tlet res = [];\r\n\teach(truth_map, function (v, i) {\r\n\t\tres.push(i);\r\n\t});\r\n\treturn res;\r\n};\r\nconst get_map_from_arr = function (arr) {\r\n\tlet res = {};\r\n\tfor (let c = 0, l = arr.length; c < l; c++) {\r\n\t\tres[arr[c]] = c;\r\n\t}\r\n\treturn res;\r\n}\r\nconst arr_like_to_arr = function (arr_like) {\r\n\tlet res = new Array(arr_like.length);\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tres[c] = arr_like[c];\r\n\t};\r\n\treturn res;\r\n};\r\nconst is_ctrl = function (obj) {\r\n\treturn (typeof obj !== 'undefined' && obj !== null && is_defined(obj.__type_name) && is_defined(obj.content) && is_defined(obj.dom));\r\n};\r\nconst map_loaded_type_fn_checks = {},\r\n\tmap_loaded_type_abbreviations = {\r\n\t\t'object': 'o',\r\n\t\t'number': 'n',\r\n\t\t'string': 's',\r\n\t\t'function': 'f',\r\n\t\t'boolean': 'b',\r\n\t\t'undefined': 'u',\r\n\t\t'array': 'a',\r\n\t\t'arguments': 'A',\r\n\t\t'date': 'd',\r\n\t\t'regex': 'r',\r\n\t\t'error': 'e',\r\n\t\t'buffer': 'B',\r\n\t\t'promise': 'p',\r\n\t\t'observable': 'O',\r\n\t\t'readable_stream': 'R',\r\n\t\t'writable_stream': 'W',\r\n\t\t'data_value': 'V'\r\n\t};\r\nlet using_type_plugins = false;\r\nconst invert = (obj) => {\r\n\tif (!is_array(obj)) {\r\n\t\tlet res = {};\r\n\t\teach(obj, (v, k) => {\r\n\t\t\tres[v] = k;\r\n\t\t})\r\n\t\treturn res;\r\n\t} else {\r\n\t\tconsole.trace();\r\n\t\tthrow 'invert(obj) not supported on arrays'\r\n\t}\r\n}\r\nconst map_loaded_type_names = invert(map_loaded_type_abbreviations);\r\nconst load_type = (name, abbreviation, fn_detect_instance) => {\r\n\tmap_loaded_type_fn_checks[name] = fn_detect_instance;\r\n\tmap_loaded_type_names[abbreviation] = name;\r\n\tmap_loaded_type_abbreviations[name] = abbreviation;\r\n\tusing_type_plugins = true;\r\n}\r\nconst tof = (obj, t1) => {\r\n\tlet res = t1 || typeof obj;\r\n\tif (using_type_plugins) {\r\n\t\tlet res;\r\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\r\n\t\t\tif (fn_check(obj)) {\r\n\t\t\t\tres = name;\r\n\t\t\t\tstop();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (res) {\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean') {\r\n\t\treturn res;\r\n\t}\r\n\tif (res === 'object') {\r\n\t\tif (typeof obj !== 'undefined') {\r\n\t\t\tif (obj === null) {\r\n\t\t\t\treturn 'null';\r\n\t\t\t}\r\n\t\t\tif (obj.__type) {\r\n\t\t\t\treturn obj.__type;\r\n\t\t\t} else if (obj.__type_name) {\r\n\t\t\t\treturn obj.__type_name;\r\n\t\t\t} else {\r\n\t\t\t\tif (obj instanceof Promise) {\r\n\t\t\t\t\treturn 'promise';\r\n\t\t\t\t}\r\n\t\t\t\tif (is_ctrl(obj)) {\r\n\t\t\t\t\treturn 'control';\r\n\t\t\t\t}\r\n\t\t\t\tif (obj instanceof Date) {\r\n\t\t\t\t\treturn 'date';\r\n\t\t\t\t}\r\n\t\t\t\tif (is_array(obj)) {\r\n\t\t\t\t\treturn 'array';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (obj instanceof Error) {\r\n\t\t\t\t\t\tres = 'error';\r\n\t\t\t\t\t} else if (obj instanceof RegExp) res = 'regex';\r\n\t\t\t\t\tif (typeof window === 'undefined') {\r\n\t\t\t\t\t\tif (obj && obj.readInt8) res = 'buffer';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn 'undefined';\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\nconst tf = (obj) => {\r\n\tlet res = typeof obj;\r\n\tif (using_type_plugins) {\r\n\t\tlet res;\r\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\r\n\t\t\tif (fn_check(obj)) {\r\n\t\t\t\tres = map_loaded_type_abbreviations[name];\r\n\t\t\t\tstop();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (res) {\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean' || res === 'undefined') {\r\n\t\treturn res[0];\r\n\t} else {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'N';\r\n\t\t} else {\r\n\t\t\tif (running_in_node) {\r\n\t\t\t\tif (obj instanceof Readable_Stream) {\r\n\t\t\t\t\treturn 'R';\r\n\t\t\t\t} else if (obj instanceof Writable_Stream) {\r\n\t\t\t\t\treturn 'W';\r\n\t\t\t\t} else if (obj instanceof Transform_Stream) {\r\n\t\t\t\t\treturn 'T';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof Buffer !== 'undefined' && obj instanceof Buffer) {\r\n\t\t\t\treturn 'B';\r\n\t\t\t} else if (obj instanceof Promise) {\r\n\t\t\t\treturn 'p';\r\n\t\t\t} else if (obj instanceof Date) {\r\n\t\t\t\treturn 'd';\r\n\t\t\t} else if (is_array(obj)) {\r\n\t\t\t\treturn 'a';\r\n\t\t\t} else {\r\n\t\t\t\tif (obj._is_observable === true) {\r\n\t\t\t\t\treturn 'O';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (typeof obj.callee === 'function') {\r\n\t\t\t\t\t\treturn 'A';\r\n\t\t\t\t\t} else if (obj instanceof Error) {\r\n\t\t\t\t\t\treturn 'e';\r\n\t\t\t\t\t} else if (obj instanceof RegExp) return 'r';\r\n\t\t\t\t\treturn 'o';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tconsole.trace();\r\n\tconsole.log('item', item);\r\n\tthrow 'type not found';\r\n\treturn res;\r\n};\r\nconst atof = (arr) => {\r\n\tlet res = new Array(arr.length);\r\n\tfor (let c = 0, l = arr.length; c < l; c++) {\r\n\t\tres[c] = tof(arr[c]);\r\n\t}\r\n\treturn res;\r\n};\r\nconst is_defined = (value) => {\r\n\t\treturn typeof (value) != 'undefined';\r\n\t},\r\n\tisdef = is_defined;\r\nconst stringify = JSON.stringify;\r\n\r\n// Older version???\r\n\r\nlet _get_item_sig = (i, arr_depth) => {\r\n\tlet res;\r\n\tlet t1 = typeof i;\r\n\tif (t1 === 'string') {\r\n\t\tres = 's';\r\n\t} else if (t1 === 'number') {\r\n\t\tres = 'n';\r\n\t} else if (t1 === 'boolean') {\r\n\t\tres = 'b';\r\n\t} else if (t1 === 'function') {\r\n\t\tres = 'f';\r\n\t} else {\r\n\t\tlet t = tof(i, t1);\r\n\t\tif (t === 'array') {\r\n\t\t\tif (arr_depth) {\r\n\t\t\t\tres = '['\r\n\t\t\t\tfor (let c = 0, l = i.length; c < l; c++) {\r\n\t\t\t\t\tif (c > 0) res = res + ',';\r\n\t\t\t\t\tres = res + get_item_sig(i[c], arr_depth - 1);\r\n\t\t\t\t}\r\n\t\t\t\tres = res + ']';\r\n\t\t\t} else {\r\n\t\t\t\tres = 'a';\r\n\t\t\t}\r\n\t\t} else if (t === 'control') {\r\n\t\t\tres = 'c';\r\n\t\t} else if (t === 'date') {\r\n\t\t\tres = 'd';\r\n\t\t} else if (t === 'observable') {\r\n\t\t\tres = 'O';\r\n\t\t} else if (t === 'regex') {\r\n\t\t\tres = 'r';\r\n\t\t} else if (t === 'buffer') {\r\n\t\t\tres = 'B';\r\n\t\t} else if (t === 'readable_stream') {\r\n\t\t\tres = 'R';\r\n\t\t} else if (t === 'writable_stream') {\r\n\t\t\tres = 'W';\r\n\t\t} else if (t === 'object') {\r\n\t\t\tres = 'o';\r\n\t\t} else if (t === 'undefined') {\r\n\t\t\tres = 'u';\r\n\t\t} else {\r\n\t\t\tif (t === 'collection_index') {\r\n\t\t\t\treturn 'X';\r\n\t\t\t} else if (t === 'data_object') {\r\n\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\tres = '~D';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres = 'D';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (t === 'data_value') {\r\n\t\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\t\tres = '~V';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres = 'V';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (t === 'null') {\r\n\t\t\t\t\tres = '!';\r\n\t\t\t\t} else if (t === 'collection') {\r\n\t\t\t\t\tif (i._abstract) {\r\n\t\t\t\t\t\tres = '~C';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres = 'C';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres = '?';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\nconst get_item_sig = (item, arr_depth) => {\r\n\tif (arr_depth) {\r\n\t\treturn _get_item_sig(item, arr_depth);\r\n\t}\r\n\tconst t = tof(item);\r\n\r\n\tif (map_loaded_type_abbreviations[t]) {\r\n\t\treturn map_loaded_type_abbreviations[t];\r\n\t} else {\r\n\t\tlet bt = typeof item;\r\n\t\tif (bt === 'object') {\r\n\t\t\tif (is_array(item)) {\r\n\t\t\t\treturn 'a';\r\n\t\t\t} else {\r\n\t\t\t\treturn 'o';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log('map_loaded_type_abbreviations type name not found', t);\r\n\t\t\tconsole.log('bt', bt);\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'stop';\r\n\t\t}\r\n\t}\r\n}\r\nconst get_a_sig = (a) => {\r\n\tlet c = 0,\r\n\t\tl = a.length;\r\n\r\n\t//console.log('is_array(a)', is_array(a));\r\n\t//console.log('a', a);\r\n\t//console.log('get_a_sig l', l);\r\n\tlet res = '[';\r\n\tlet first = true;\r\n\tfor (c = 0; c < l; c++) {\r\n\t\tif (!first) {\r\n\t\t\tres = res + ',';\r\n\t\t} else {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tres = res + get_item_sig(a[c]);\r\n\t}\r\n\tres = res + ']';\r\n\treturn res;\r\n}\r\nconst deep_sig = (item, max_depth = -1, depth = 0) => {\r\n\tconst t = tf(item);\r\n\tlet res = '';\r\n\tif (t === 'a') {\r\n\t\tconst l = item.length;\r\n\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\tres = res + '[';\r\n\t\t\tlet first = true;\r\n\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\tif (!first) res = res + ',';\r\n\t\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tres = res + ']';\r\n\t\t} else {\r\n\t\t\treturn 'a';\r\n\t\t}\r\n\t} else if (t === 'A') {\r\n\t\tconst l = item.length;\r\n\t\tlet first = true;\r\n\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\tif (!first) res = res + ',';\r\n\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t} else if (t === 'o') {\r\n\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\tlet res = '{';\r\n\t\t\tlet first = true;\r\n\t\t\teach(item, (v, k) => {\r\n\t\t\t\tif (!first) res = res + ',';\r\n\t\t\t\tres = res + '\"' + k + '\":' + deep_sig(v, max_depth, depth + 1);\r\n\t\t\t\tfirst = false;\r\n\t\t\t});\r\n\t\t\tres = res + '}';\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\treturn 'o';\r\n\t\t}\r\n\t} else {\r\n\t\tres = res + t;\r\n\t}\r\n\treturn res;\r\n}\r\nconst trim_sig_brackets = function (sig) {\r\n\tif (tof(sig) === 'string') {\r\n\t\tif (sig.charAt(0) == '[' && sig.charAt(sig.length - 1) == ']') {\r\n\t\t\treturn sig.substring(1, sig.length - 1);\r\n\t\t} else {\r\n\t\t\treturn sig;\r\n\t\t}\r\n\t}\r\n};\r\nconst arr_trim_undefined = function (arr_like) {\r\n\tlet res = [];\r\n\tlet last_defined = -1;\r\n\tlet t, v;\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tv = arr_like[c];\r\n\t\tt = tof(v);\r\n\t\tif (t == 'undefined') {} else {\r\n\t\t\tlast_defined = c;\r\n\t\t}\r\n\t}\r\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\r\n\t\tif (c <= last_defined) {\r\n\t\t\tres.push(arr_like[c]);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n};\r\n\r\n// Could see about simply integrating data types into fp....?\r\n//   That could mean habing get_item_sig return sigs for those data types.\r\n//     Would need to define signature abbreviations for them.\r\n\r\n\r\n\r\n\r\n\r\nconst functional_polymorphism = function (options, fn) {\r\n\tlet a0 = arguments;\r\n\tif (a0.length === 1) {\r\n\t\tfn = a0[0];\r\n\t\toptions = null;\r\n\t}\r\n\tlet arr_slice = Array.prototype.slice;\r\n\tlet arr, sig, a2, l, a;\r\n\treturn function () {\r\n\t\ta = arguments;\r\n\t\tl = a.length;\r\n\t\tif (l === 1) {\r\n\t\t\tsig = get_item_sig([a[0]], 1);\r\n\t\t\ta2 = [a[0]];\r\n\t\t\ta2.l = 1;\r\n\t\t\treturn fn.call(this, a2, sig);\r\n\t\t} else if (l > 1) {\r\n\t\t\tarr = arr_trim_undefined(arr_slice.call(a, 0));\r\n\t\t\tsig = get_item_sig(arr, 1);\r\n\t\t\tarr.l = arr.length;\r\n\t\t\treturn fn.call(this, arr, sig);\r\n\t\t} else if (a.length === 0) {\r\n\t\t\tarr = new Array(0);\r\n\t\t\tarr.l = 0;\r\n\t\t\treturn fn.call(this, arr, '[]');\r\n\t\t}\r\n\t}\r\n};\r\nconst fp = functional_polymorphism;\r\nconst parse_sig = (str_sig, opts = {}) => {\r\n\tconst sig2 = str_sig.split(', ').join(',');\r\n\tconst sig_items = sig2.split(',');\r\n\tconst res = [];\r\n\teach(sig_items, sig_item => {\r\n\t\tif (sig_item.length === 1) {\r\n\t\t\tlet type_name = map_loaded_type_names[sig_item];\r\n\t\t\tres.push({\r\n\t\t\t\tabbreviation: sig_item,\r\n\t\t\t\ttype_name: type_name\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tlet suffix_modifiers;\r\n\t\t\tlet zero_or_more = false;\r\n\t\t\tlet one_or_more = false;\r\n\t\t\tlet type_name = sig_item;\r\n\t\t\tconst obj_res = {\r\n\t\t\t\ttype_name: type_name\r\n\t\t\t}\r\n\t\t\tconst distil_suffix_modifiers = () => {\r\n\t\t\t\tlet last_char = type_name.substr(type_name.length - 1);\r\n\t\t\t\tif (last_char === '*') {\r\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\r\n\t\t\t\t\tzero_or_more = true;\r\n\t\t\t\t\tobj_res.zero_or_more = true;\r\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\r\n\t\t\t\t\tobj_res.modifiers.push('*');\r\n\t\t\t\t\tdistil_suffix_modifiers();\r\n\t\t\t\t} else if (last_char === '+') {\r\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\r\n\t\t\t\t\tone_or_more = true;\r\n\t\t\t\t\tobj_res.one_or_more = true;\r\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\r\n\t\t\t\t\tobj_res.modifiers.push('+');\r\n\t\t\t\t\tdistil_suffix_modifiers();\r\n\t\t\t\t} else {}\r\n\t\t\t}\r\n\t\t\tdistil_suffix_modifiers();\r\n\t\t\tobj_res.type_name = type_name;\r\n\t\t\tres.push(obj_res);\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n}\r\nconst mfp_not_sigs = get_truth_map_from_arr(['pre', 'default', 'post']);\r\nconst mfp_unparse_sig = arr_sig => {\r\n\tlet res = '[';\r\n\tlet first = true;\r\n\teach(arr_sig, sig_item => {\r\n\t\tif (!first) {\r\n\t\t\tres = res + ',';\r\n\t\t}\r\n\t\tres = res + sig_item.abbreviation;\r\n\t\tfirst = false;\r\n\t})\r\n\tres = res + ']';\r\n\treturn res;\r\n}\r\nconst map_grammar_def_abbreviations = {\r\n\t'string': 's',\r\n\t'number': 'n',\r\n\t'boolean': 'b',\r\n\t's': 's',\r\n\t'n': 'n',\r\n\t'b': 'b'\r\n}\r\nconst log = () => {};\r\nconst combinations = (arr, arr_idxs_to_ignore) => {\r\n\tconst map_ignore_idxs = {};\r\n\tif (arr_idxs_to_ignore) {\r\n\t\teach(arr_idxs_to_ignore, idx_to_ignore => {\r\n\t\t\tmap_ignore_idxs[idx_to_ignore] = true;\r\n\t\t});\r\n\t}\r\n\tconst res = [];\r\n\tconst l = arr.length;\r\n\tconst arr_idxs_num_options = new Uint32Array(l);\r\n\teach(arr, (arr_item1, i1) => {\r\n\t\tarr_idxs_num_options[i1] = arr_item1.length;\r\n\t});\r\n\tconst arr_current_option_idxs = (new Uint32Array(l)).fill(0);\r\n\tconst result_from_indexes = (arr, arg_indexes) => {\r\n\t\tconst res = new Array(l);\r\n\t\tif (arg_indexes.length === l) {\r\n\t\t\tfor (var c = 0; c < l; c++) {\r\n\t\t\t\tres[c] = arr[c][arg_indexes[c]];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Arguments length mismatch';\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\tconst incr = () => {\r\n\t\tfor (c = l - 1; c >= 0; c--) {\r\n\t\t\tconst ival = arr_current_option_idxs[c];\r\n\t\t\tconst max = arr_idxs_num_options[c] - 1;\r\n\t\t\tif (ival < max) {\r\n\t\t\t\tarr_current_option_idxs[c]++;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tif (c === 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tarr_current_option_idxs.fill(0, c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\r\n\tres.push(vals);\r\n\twhile (incr()) {\r\n\t\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\r\n\t\tres.push(vals);\r\n\t}\r\n\treturn res;\r\n}\r\nconst map_native_types = {\r\n\t'string': true,\r\n\t'boolean': true,\r\n\t'number': true,\r\n\t'object': true\r\n}\r\nconst map_native_type_sigs = {\r\n\t's': true,\r\n\t'n': true,\r\n\t'o': true,\r\n\t'a': true,\r\n\t'd': true\r\n}\r\n\r\n\r\n// Late 2023 - mfp may be a good basis to proceed with more data-type aware idioms.\r\n//   Want to use it for mid-level precise and concise code where possible.\r\n//     May use it or its conventions in implementing some higher level (incl mid level) things.\r\n\r\n// Would be worth setting up and testing (maybe also benchmarking) Data_Value objects that specifically represent numbers between\r\n//  -180 and 180. Also integrating such Data_Value objects within a Data_Object or other Data_Model.\r\n// Maybe want some kind of _, $, or dm or _dm type shorthand for things that are very useful.\r\n//   Though it does make sense to abstractify things that get used a lot to make it mroe concise.\r\n//     Also worth designing and then using the concise idioms.\r\n\r\n// mfp seems like some code that could be redone / changed and parts used elsewhere to implement the mid and high level\r\n//   APIs as wanted.\r\n\r\n\r\n\r\n\r\n\r\nconst mfp = function () {\r\n\r\n\t// mfp looks complex. may need to look into what it's for and can do.\r\n\t//   Looks like an old work-in-progress.\r\n\t//     Should look into benchmarking its usage in different places.\r\n\r\n\tconst a1 = arguments;\r\n\tconst sig1 = get_a_sig(a1);\r\n\tlet options = {};\r\n\tlet fn_pre, provided_map_sig_fns, inner_map_sig_fns = {},\r\n\t\tinner_map_parsed_sigs = {},\r\n\t\tarr_sig_parsed_sig_fns = [],\r\n\t\tfn_post;\r\n\tlet tm_sig_fns;\r\n\tlet fn_default;\r\n\tlet single_fn;\r\n\tlet req_sig_single_fn;\r\n\tif (sig1 === '[o]') {\r\n\t\tprovided_map_sig_fns = a1[0];\r\n\t} else if (sig1 === '[o,o]') {\r\n\t\toptions = a1[0];\r\n\t\tprovided_map_sig_fns = a1[1];\r\n\t} else if (sig1 === '[o,f]') {\r\n\t\toptions = a1[0];\r\n\t\tsingle_fn = a1[1];\r\n\t} else if (sig1 === '[o,s,f]') {\r\n\t\toptions = a1[0];\r\n\t\treq_sig_single_fn = a1[1];\r\n\t\tsingle_fn = a1[2];\r\n\t\tprovided_map_sig_fns = {};\r\n\t\tprovided_map_sig_fns[req_sig_single_fn] = single_fn;\r\n\t} else if (sig1 === '[f,o]') {\r\n\t\tsingle_fn = a1[0];\r\n\t\toptions = a1[1];\r\n\t} else if (sig1 === '[f]') {\r\n\t\tsingle_fn = a1[0];\r\n\t} else {\r\n\t\tconsole.log('sig1', sig1);\r\n\t\tconsole.trace();\r\n\t\tthrow 'mfp NYI';\r\n\t}\r\n\tlet {\r\n\t\tsingle,\r\n\t\tname,\r\n\t\tgrammar,\r\n\t\tverb,\r\n\t\tnoun,\r\n\t\treturn_type,\r\n\t\treturn_subtype,\r\n\t\tpure,\r\n\t\tmain,\r\n\t\tskip\r\n\t} = options;\r\n\tlet parsed_grammar;\r\n\tlet identify, validate;\r\n\tlet dsig = deep_sig;\r\n\t(() => {\r\n\t\tif (provided_map_sig_fns) {\r\n\t\t\tif (provided_map_sig_fns.default) fn_default = provided_map_sig_fns.default;\r\n\t\t\teach(provided_map_sig_fns, (fn, sig) => {\r\n\t\t\t\tif (typeof fn === 'function') {\r\n\t\t\t\t\tif (!mfp_not_sigs[sig]) {\r\n\t\t\t\t\t\tconst parsed_sig = parse_sig(sig);\r\n\t\t\t\t\t\tconst arr_args_with_modifiers = [];\r\n\t\t\t\t\t\tconst arr_args_all_modification_versions = [];\r\n\t\t\t\t\t\teach(parsed_sig, (arg, i) => {\r\n\t\t\t\t\t\t\tarr_args_all_modification_versions[i] = [];\r\n\t\t\t\t\t\t\tif (arg.modifiers) {\r\n\t\t\t\t\t\t\t\tconst arg_num_modifiers = arg.modifiers.length;\r\n\t\t\t\t\t\t\t\tif (arg_num_modifiers > 1) {\r\n\t\t\t\t\t\t\t\t\tthrow 'Use of more than 1 modifier is currently unsupported.';\r\n\t\t\t\t\t\t\t\t} else if (arg_num_modifiers === 1) {\r\n\t\t\t\t\t\t\t\t\tarr_args_with_modifiers.push([i, arg]);\r\n\t\t\t\t\t\t\t\t\tconst single_modifier = arg.modifiers[0];\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '*') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '+') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (single_modifier === '?') {\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\r\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconst combo_args = combinations(arr_args_all_modification_versions);\r\n\t\t\t\t\t\tconst combo_sigs = [];\r\n\t\t\t\t\t\tlet i_first_of_last_undefined = -1;\r\n\t\t\t\t\t\teach(combo_args, arg_set => {\r\n\t\t\t\t\t\t\tlet combo_sig = '';\r\n\t\t\t\t\t\t\teach(arg_set, (arg, i) => {\r\n\t\t\t\t\t\t\t\tlet lsigb4 = combo_sig.length;\r\n\t\t\t\t\t\t\t\tif (i > 0) {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + ',';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (arg === '') {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + 'u';\r\n\t\t\t\t\t\t\t\t\tif (i_first_of_last_undefined === -1) {\r\n\t\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = lsigb4;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + arg;\r\n\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = -1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tif (i_first_of_last_undefined > 0) {\r\n\t\t\t\t\t\t\t\tconst combo_sig_no_last_undefined = combo_sig.substr(0, i_first_of_last_undefined);\r\n\t\t\t\t\t\t\t\tcombo_sigs.push(combo_sig_no_last_undefined);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcombo_sigs.push(combo_sig);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (combo_sigs.length > 0) {\r\n\t\t\t\t\t\t\teach(combo_sigs, combo_sig => {\r\n\t\t\t\t\t\t\t\tinner_map_sig_fns[combo_sig] = fn;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tinner_map_sig_fns[sig] = fn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinner_map_parsed_sigs[sig] = parsed_sig;\r\n\t\t\t\t\t\tarr_sig_parsed_sig_fns.push([sig, parsed_sig, fn]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('ommiting, not parsing sig', sig);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('fn', fn);\r\n\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\tthrow 'Expected: function';\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\t\teach(inner_map_sig_fns, (fn, sig) => {\r\n\t\t\ttm_sig_fns = tm_sig_fns || {};\r\n\t\t\ttm_sig_fns[sig] = true;\r\n\t\t});\r\n\t})();\r\n\tconst res = function () {\r\n\t\tconst a2 = arguments;\r\n\t\tconst l2 = a2.length;\r\n\t\tconsole.log('');\r\n\t\tconsole.log('calling mfp function');\r\n\t\tconsole.log('--------------------');\r\n\t\tconsole.log('');\r\n\t\tlet mfp_fn_call_deep_sig;\r\n\t\tlet ltof = tof;\r\n\t\tconst lsig = dsig;\r\n\t\tlet ltf = tf;\r\n\t\tmfp_fn_call_deep_sig = lsig(a2);\r\n\t\tlet do_skip = false;\r\n\t\tif (skip) {\r\n\t\t\tif (skip(a2)) {\r\n\t\t\t\tdo_skip = true;\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\tif (!do_skip) {\r\n\t\t\tif (inner_map_sig_fns[mfp_fn_call_deep_sig]) {\r\n\t\t\t\treturn inner_map_sig_fns[mfp_fn_call_deep_sig].apply(this, a2);\r\n\t\t\t} else {\r\n\t\t\t\tlet idx_last_fn = -1;\r\n\t\t\t\tlet idx_last_obj = -1;\r\n\t\t\t\teach(a2, (arg, i_arg) => {\r\n\t\t\t\t\ti_arg = parseInt(i_arg, 10);\r\n\t\t\t\t\tconst targ = tf(arg);\r\n\t\t\t\t\tif (targ === 'o') {\r\n\t\t\t\t\t\tidx_last_obj = i_arg;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (targ === 'f') {\r\n\t\t\t\t\t\tidx_last_fn = i_arg;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tconst last_arg_is_fn = idx_last_fn > -1 && idx_last_fn === a2.length - 1;\r\n\t\t\t\tconst last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 1;\r\n\t\t\t\tconst second_last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 2;\r\n\t\t\t\tlet possible_options_obj;\r\n\t\t\t\tif (last_arg_is_obj) possible_options_obj = a2[idx_last_obj];\r\n\t\t\t\tconst new_args_arrangement = [];\r\n\t\t\t\tfor (let f = 0; f < idx_last_obj; f++) {\r\n\t\t\t\t\tnew_args_arrangement.push(a2[f]);\r\n\t\t\t\t}\r\n\t\t\t\teach(possible_options_obj, (value, key) => {\r\n\t\t\t\t\tnew_args_arrangement.push(value);\r\n\t\t\t\t});\r\n\t\t\t\tlet naa_sig = lsig(new_args_arrangement);\r\n\t\t\t\tnaa_sig = naa_sig.substring(1, naa_sig.length - 1);\r\n\t\t\t\tif (inner_map_sig_fns[naa_sig]) {\r\n\t\t\t\t\treturn inner_map_sig_fns[naa_sig].apply(this, new_args_arrangement);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (fn_default) {\r\n\t\t\t\t\t\treturn fn_default.call(this, a2, mfp_fn_call_deep_sig);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (single_fn) {\r\n\t\t\t\t\t\t\tconsole.log('pre apply single_fn');\r\n\t\t\t\t\t\t\treturn single_fn.apply(this, a2);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_parsed_sigs)', Object.keys(inner_map_parsed_sigs));\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tconsole.log('mfp_fn_call_deep_sig', mfp_fn_call_deep_sig);\r\n\t\t\t\t\t\t\tconsole.log('provided_map_sig_fns', provided_map_sig_fns);\r\n\t\t\t\t\t\t\tif (provided_map_sig_fns) log('Object.keys(provided_map_sig_fns)', Object.keys(provided_map_sig_fns));\r\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_sig_fns)', Object.keys(inner_map_sig_fns));\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tthrow 'no signature match found. consider using a default signature. mfp_fn_call_deep_sig: ' + mfp_fn_call_deep_sig;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst _ = {}\r\n\tif (name) _.name = name;\r\n\tif (single) _.single = single;\r\n\tif (skip) _.skip = skip;\r\n\tif (grammar) _.grammar = grammar;\r\n\tif (typeof options !== 'undefined' && options.async) _.async = options.async;\r\n\tif (main === true) _.main = true;\r\n\tif (return_type) _.return_type = return_type;\r\n\tif (return_subtype) _.return_subtype = return_subtype;\r\n\tif (pure) _.pure = pure;\r\n\tif (tm_sig_fns) _.map_sigs = tm_sig_fns;\r\n\tif (Object.keys(_).length > 0) {\r\n\t\tres._ = _;\r\n\t}\r\n\treturn res;\r\n}\r\nconst convert = (input, conversion_schema) => {}\r\nlet arrayify = fp(function (a, sig) {\r\n\tlet param_index, num_parallel = 1,\r\n\t\tdelay = 0,\r\n\t\tfn;\r\n\tlet res;\r\n\tlet process_as_fn = function () {\r\n\t\tres = function () {\r\n\t\t\tlet a = arr_like_to_arr(arguments),\r\n\t\t\t\tts = atof(a),\r\n\t\t\t\tt = this;\r\n\t\t\tlet last_arg = a[a.length - 1];\r\n\t\t\tif (tof(last_arg) == 'function') {\r\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tlet fns = [];\r\n\t\t\t\t\teach(a[param_index], function (v, i) {\r\n\t\t\t\t\t\tlet new_params = a.slice(0, a.length - 1);\r\n\t\t\t\t\t\tnew_params[param_index] = v;\r\n\t\t\t\t\t\tfns.push([t, fn, new_params]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcall_multiple_callback_functions(fns, num_parallel, delay, (err, res) => {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tthrow err;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet a = [];\r\n\t\t\t\t\t\t\ta = a.concat.apply(a, res);\r\n\t\t\t\t\t\t\tlet callback = last_arg;\r\n\t\t\t\t\t\t\tcallback(null, a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.apply(t, a);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tfor (let c = 0, l = a[param_index].length; c < l; c++) {\r\n\t\t\t\t\t\ta[param_index] = arguments[param_index][c];\r\n\t\t\t\t\t\tlet result = fn.apply(t, a);\r\n\t\t\t\t\t\tres.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.apply(t, a);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tif (sig == '[o]') {\r\n\t\tlet res = [];\r\n\t\teach(a[0], function (v, i) {\r\n\t\t\tres.push([v, i]);\r\n\t\t});\r\n\t} else if (sig == '[f]') {\r\n\t\tparam_index = 0, fn = a[0];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,f]') {\r\n\t\tparam_index = a[0], fn = a[1];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,n,f]') {\r\n\t\tparam_index = a[0], num_parallel = a[1], fn = a[2];\r\n\t\tprocess_as_fn();\r\n\t} else if (sig == '[n,n,n,f]') {\r\n\t\tparam_index = a[0], num_parallel = a[1], delay = a[2], fn = a[3];\r\n\t\tprocess_as_fn();\r\n\t}\r\n\treturn res;\r\n});\r\nlet mapify = (target) => {\r\n\tlet tt = tof(target);\r\n\tif (tt == 'function') {\r\n\t\tlet res = fp(function (a, sig) {\r\n\t\t\tlet that = this;\r\n\t\t\tif (sig == '[o]') {\r\n\t\t\t\tlet map = a[0];\r\n\t\t\t\teach(map, function (v, i) {\r\n\t\t\t\t\ttarget.call(that, v, i);\r\n\t\t\t\t});\r\n\t\t\t} else if (sig == '[o,f]') {\r\n\t\t\t\tlet map = a[0];\r\n\t\t\t\tlet callback = a[1];\r\n\t\t\t\tlet fns = [];\r\n\t\t\t\teach(map, function (v, i) {\r\n\t\t\t\t\tfns.push([target, [v, i]]);\r\n\t\t\t\t});\r\n\t\t\t\tcall_multi(fns, function (err_multi, res_multi) {\r\n\t\t\t\t\tif (err_multi) {\r\n\t\t\t\t\t\tcallback(err_multi);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(null, res_multi);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (a.length >= 2) {\r\n\t\t\t\ttarget.apply(this, a);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t} else if (tt == 'array') {\r\n\t\tlet res = {};\r\n\t\tif (arguments.length == 1) {\r\n\t\t\tif (is_arr_of_strs(target)) {\r\n\t\t\t\teach(target, function (v, i) {\r\n\t\t\t\t\tres[v] = true;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\teach(target, function (v, i) {\r\n\t\t\t\t\tres[v[0]] = v[1];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet by_property_name = arguments[1];\r\n\t\t\teach(target, function (v, i) {\r\n\t\t\t\tres[v[by_property_name]] = v;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n};\r\nlet clone = fp((a, sig) => {\r\n\tlet obj = a[0];\r\n\tif (a.l === 1) {\r\n\t\tif (obj && typeof obj.clone === 'function') {\r\n\t\t\treturn obj.clone();\r\n\t\t} else {\r\n\t\t\tlet t = tof(obj);\r\n\t\t\tif (t === 'array') {\r\n\t\t\t\tlet res = [];\r\n\t\t\t\teach(obj, v => {\r\n\t\t\t\t\tres.push(clone(v));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (t === 'undefined') {\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else if (t === 'string') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'number') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'function') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'boolean') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else if (t === 'null') {\r\n\t\t\t\treturn obj;\r\n\t\t\t} else {\r\n\t\t\t\treturn Object.assign({}, obj);\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (a.l === 2 && tof(a[1]) === 'number') {\r\n\t\tlet res = [];\r\n\t\tfor (let c = 0; c < a[1]; c++) {\r\n\t\t\tres.push(clone(obj));\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n});\r\nlet set_vals = function (obj, map) {\r\n\teach(map, function (v, i) {\r\n\t\tobj[i] = v;\r\n\t});\r\n};\r\nlet ll_set = (obj, prop_name, prop_value) => {\r\n\tlet arr = prop_name.split('.');\r\n\tlet c = 0,\r\n\t\tl = arr.length;\r\n\tlet i = obj._ || obj,\r\n\t\ts;\r\n\twhile (c < l) {\r\n\t\ts = arr[c];\r\n\t\tif (typeof i[s] == 'undefined') {\r\n\t\t\tif (c - l == -1) {\r\n\t\t\t\ti[s] = prop_value;\r\n\t\t\t} else {\r\n\t\t\t\ti[s] = {};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (c - l == -1) {\r\n\t\t\t\ti[s] = prop_value;\r\n\t\t\t}\r\n\t\t}\r\n\t\ti = i[s];\r\n\t\tc++;\r\n\t};\r\n\treturn prop_value;\r\n};\r\nlet ll_get = (a0, a1) => {\r\n\tif (a0 && a1) {\r\n\t\tlet i = a0._ || a0;\r\n\t\tif (a1 == '.') {\r\n\t\t\tif (typeof i['.'] == 'undefined') {\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else {\r\n\t\t\t\treturn i['.'];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet arr = a1.split('.');\r\n\t\t\tlet c = 0,\r\n\t\t\t\tl = arr.length,\r\n\t\t\t\ts;\r\n\t\t\twhile (c < l) {\r\n\t\t\t\ts = arr[c];\r\n\t\t\t\tif (typeof i[s] == 'undefined') {\r\n\t\t\t\t\tif (c - l == -1) {} else {\r\n\t\t\t\t\t\tthrow 'object ' + s + ' not found';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (c - l == -1) {\r\n\t\t\t\t\t\treturn i[s];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti = i[s];\r\n\t\t\t\tc++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nlet truth = function (value) {\r\n\treturn value === true;\r\n};\r\nlet iterate_ancestor_classes = (obj, callback) => {\r\n\tlet ctu = true;\r\n\tlet stop = () => {\r\n\t\tctu = false;\r\n\t}\r\n\tcallback(obj, stop);\r\n\tif (obj._superclass && ctu) {\r\n\t\titerate_ancestor_classes(obj._superclass, callback);\r\n\t}\r\n}\r\nlet is_arr_of_t = function (obj, type_name) {\r\n\tlet t = tof(obj),\r\n\t\ttv;\r\n\tif (t === 'array') {\r\n\t\tlet res = true;\r\n\t\teach(obj, function (v, i) {\r\n\t\t\ttv = tof(v);\r\n\t\t\tif (tv != type_name) res = false;\r\n\t\t});\r\n\t\treturn res;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nlet is_arr_of_arrs = function (obj) {\r\n\treturn is_arr_of_t(obj, 'array');\r\n}\r\nlet is_arr_of_strs = function (obj) {\r\n\treturn is_arr_of_t(obj, 'string');\r\n}\r\nlet input_processors = {};\r\nlet output_processors = {};\r\nlet call_multiple_callback_functions = fp(function (a, sig) {\r\n\tlet arr_functions_params_pairs, callback, return_params = false;\r\n\tlet delay;\r\n\tlet num_parallel = 1;\r\n\tif (a.l === 1) {\r\n\t} else if (a.l === 2) {\r\n\t\tarr_functions_params_pairs = a[0];\r\n\t\tcallback = a[1];\r\n\t} else if (a.l === 3) {\r\n\t\tif (sig === '[a,n,f]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tnum_parallel = a[1];\r\n\t\t\tcallback = a[2];\r\n\t\t} else if (sig === '[n,a,f]') {\r\n\t\t\tarr_functions_params_pairs = a[1];\r\n\t\t\tnum_parallel = a[0];\r\n\t\t\tcallback = a[2];\r\n\t\t} else if (sig === '[a,f,b]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tcallback = a[1];\r\n\t\t\treturn_params = a[2];\r\n\t\t}\r\n\t} else if (a.l === 4) {\r\n\t\tif (sig === '[a,n,n,f]') {\r\n\t\t\tarr_functions_params_pairs = a[0];\r\n\t\t\tnum_parallel = a[1];\r\n\t\t\tdelay = a[2];\r\n\t\t\tcallback = a[3];\r\n\t\t} else if (sig == '[n,n,a,f]') {\r\n\t\t\tarr_functions_params_pairs = a[2];\r\n\t\t\tnum_parallel = a[0];\r\n\t\t\tdelay = a[1];\r\n\t\t\tcallback = a[3];\r\n\t\t}\r\n\t}\r\n\tlet res = [];\r\n\tlet l = arr_functions_params_pairs.length;\r\n\tlet c = 0;\r\n\tlet count_unfinished = l;\r\n\tlet num_currently_executing = 0;\r\n\tlet process = delay => {\r\n\t\tnum_currently_executing++;\r\n\t\tlet main = () => {\r\n\t\t\tlet pair = arr_functions_params_pairs[c];\r\n\t\t\tlet context;\r\n\t\t\tlet fn, params, fn_callback;\r\n\t\t\tlet pair_sig = get_item_sig(pair);\r\n\t\t\tlet t_pair = tof(pair);\r\n\t\t\tif (t_pair == 'function') {\r\n\t\t\t\tfn = pair;\r\n\t\t\t\tparams = [];\r\n\t\t\t} else {\r\n\t\t\t\tif (pair) {\r\n\t\t\t\t\tif (pair.length == 1) {}\r\n\t\t\t\t\tif (pair.length == 2) {\r\n\t\t\t\t\t\tif (tof(pair[1]) == 'function') {\r\n\t\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\t\tparams = [];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfn = pair[0];\r\n\t\t\t\t\t\t\tparams = pair[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pair.length == 3) {\r\n\t\t\t\t\t\tif (tof(pair[0]) === 'function' && tof(pair[1]) === 'array' && tof(pair[2]) === 'function') {\r\n\t\t\t\t\t\t\tfn = pair[0];\r\n\t\t\t\t\t\t\tparams = pair[1];\r\n\t\t\t\t\t\t\tfn_callback = pair[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tof(pair[1]) === 'function' && tof(pair[2]) === 'array') {\r\n\t\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\t\tparams = pair[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pair.length == 4) {\r\n\t\t\t\t\t\tcontext = pair[0];\r\n\t\t\t\t\t\tfn = pair[1];\r\n\t\t\t\t\t\tparams = pair[2];\r\n\t\t\t\t\t\tfn_callback = pair[3];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {}\r\n\t\t\t}\r\n\t\t\tlet i = c;\r\n\t\t\tc++;\r\n\t\t\tlet cb = (err, res2) => {\r\n\t\t\t\tnum_currently_executing--;\r\n\t\t\t\tcount_unfinished--;\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tlet stack = new Error().stack;\r\n\t\t\t\t\tcallback(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (return_params) {\r\n\t\t\t\t\t\tres[i] = [params, res2];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres[i] = res2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fn_callback) {\r\n\t\t\t\t\t\tfn_callback(null, res2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (c < l) {\r\n\t\t\t\t\t\tif (num_currently_executing < num_parallel) {\r\n\t\t\t\t\t\t\tprocess(delay);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (count_unfinished <= 0) {\r\n\t\t\t\t\t\t\tcallback(null, res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tlet arr_to_call = params || [];\r\n\t\t\tarr_to_call.push(cb);\r\n\t\t\tif (fn) {\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tfn.apply(context, arr_to_call);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfn.apply(this, arr_to_call);\r\n\t\t\t\t}\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\tif (arr_functions_params_pairs[c]) {\r\n\t\t\tif (delay) {\r\n\t\t\t\tsetTimeout(main, delay);\r\n\t\t\t} else {\r\n\t\t\t\tmain();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (arr_functions_params_pairs.length > 0) {\r\n\t\twhile ((c < l) && (num_currently_executing < num_parallel)) {\r\n\t\t\tif (delay) {\r\n\t\t\t\tprocess(delay * c);\r\n\t\t\t} else {\r\n\t\t\t\tprocess();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif (callback) {}\r\n\t}\r\n});\r\nlet multi = call_multiple_callback_functions;\r\nlet call_multi = call_multiple_callback_functions;\r\nlet Fns = function (arr) {\r\n\tlet fns = arr || [];\r\n\tfns.go = function (parallel, delay, callback) {\r\n\t\tlet a = arguments;\r\n\t\tlet al = a.length;\r\n\t\tif (al == 1) {\r\n\t\t\tcall_multi(fns, a[0]);\r\n\t\t}\r\n\t\tif (al == 2) {\r\n\t\t\tcall_multi(parallel, fns, delay);\r\n\t\t}\r\n\t\tif (al == 3) {\r\n\t\t\tcall_multi(parallel, delay, fns, callback);\r\n\t\t}\r\n\t}\r\n\treturn fns;\r\n}\r\nlet native_constructor_tof = function (value) {\r\n\tif (value === String) {\r\n\t\treturn 'String';\r\n\t}\r\n\tif (value === Number) {\r\n\t\treturn 'Number';\r\n\t}\r\n\tif (value === Boolean) {\r\n\t\treturn 'Boolean';\r\n\t}\r\n\tif (value === Array) {\r\n\t\treturn 'Array';\r\n\t}\r\n\tif (value === Object) {\r\n\t\treturn 'Object';\r\n\t}\r\n}\r\nlet sig_match = function (sig1, sig2) {\r\n\tlet sig1_inner = sig1.substr(1, sig1.length - 2);\r\n\tlet sig2_inner = sig2.substr(1, sig2.length - 2);\r\n\tif (sig1_inner.indexOf('[') > -1 || sig1_inner.indexOf(']') > -1 || sig2_inner.indexOf('[') > -1 || sig2_inner.indexOf(']') > -1) {\r\n\t\tthrow 'sig_match only supports flat signatures.';\r\n\t}\r\n\tlet sig1_parts = sig1_inner.split(',');\r\n\tlet sig2_parts = sig2_inner.split(',');\r\n\tlet res = true;\r\n\tif (sig1_parts.length == sig2_parts.length) {\r\n\t\tlet c = 0,\r\n\t\t\tl = sig1_parts.length,\r\n\t\t\ti1, i2;\r\n\t\twhile (res && c < l) {\r\n\t\t\ti1 = sig1_parts[c];\r\n\t\t\ti2 = sig2_parts[c];\r\n\t\t\tif (i1 === i2) {} else {\r\n\t\t\t\tif (i1 !== '?') {\r\n\t\t\t\t\tres = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tc++;\r\n\t\t}\r\n\t\treturn res;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nlet remove_sig_from_arr_shell = function (sig) {\r\n\tif (sig[0] == '[' && sig[sig.length - 1] == ']') {\r\n\t\treturn sig.substring(1, sig.length - 1);\r\n\t}\r\n\treturn sig;\r\n};\r\nlet str_arr_mapify = function (fn) {\r\n\tlet res = fp(function (a, sig) {\r\n\t\tif (a.l == 1) {\r\n\t\t\tif (sig == '[s]') {\r\n\t\t\t\tlet s_pn = a[0].split(' ');\r\n\t\t\t\tif (s_pn.length > 1) {\r\n\t\t\t\t\treturn res.call(this, s_pn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn fn.call(this, a[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (tof(a[0]) == 'array') {\r\n\t\t\t\tlet res2 = {},\r\n\t\t\t\t\tthat = this;\r\n\t\t\t\teach(a[0], function (v, i) {\r\n\t\t\t\t\tres2[v] = fn.call(that, v);\r\n\t\t\t\t});\r\n\t\t\t\treturn res2;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n};\r\nlet to_arr_strip_keys = (obj) => {\r\n\tlet res = [];\r\n\teach(obj, v => {\r\n\t\tres.push(v);\r\n\t});\r\n\treturn res;\r\n}\r\nlet arr_objs_to_arr_keys_values_table = (arr_objs) => {\r\n\tlet keys = Object.keys(arr_objs[0]);\r\n\tlet arr_items = [],\r\n\t\tarr_values;\r\n\teach(arr_objs, (item) => {\r\n\t\tarr_items.push(to_arr_strip_keys(item));\r\n\t});\r\n\treturn [keys, arr_items];\r\n}\r\nlet set_arr_tree_value = (arr_tree, arr_path, value) => {\r\n\tlet item_current = arr_tree;\r\n\tlet last_item_current, last_path_item;\r\n\teach(arr_path, (path_item) => {\r\n\t\tlast_item_current = item_current;\r\n\t\titem_current = item_current[path_item];\r\n\t\tlast_path_item = path_item;\r\n\t});\r\n\tlast_item_current[last_path_item] = value;\r\n}\r\nlet get_arr_tree_value = (arr_tree, arr_path) => {\r\n\tlet item_current = arr_tree;\r\n\teach(arr_path, (path_item) => {\r\n\t\titem_current = item_current[path_item];\r\n\t});\r\n\treturn item_current;\r\n}\r\nlet deep_arr_iterate = (arr, path = [], callback) => {\r\n\tif (arguments.length === 2) {\r\n\t\tcallback = path;\r\n\t\tpath = [];\r\n\t}\r\n\teach(arr, (item, i) => {\r\n\t\tlet c_path = clone(path);\r\n\t\tc_path.push(i);\r\n\t\tlet t = tof(item);\r\n\t\tif (t === 'array') {\r\n\t\t\tdeep_arr_iterate(item, c_path, callback);\r\n\t\t} else {\r\n\t\t\tcallback(c_path, item);\r\n\t\t}\r\n\t})\r\n}\r\nlet prom = (fn) => {\r\n\tlet fn_res = function () {\r\n\t\tconst a = arguments;\r\n\t\tconst t_a_last = typeof a[a.length - 1];\r\n\t\tif (t_a_last === 'function') {\r\n\t\t\tfn.apply(this, a);\r\n\t\t} else {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t[].push.call(a, (err, res) => {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tfn.apply(this, a);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\treturn fn_res;\r\n}\r\nconst vectorify = n_fn => {\r\n\tlet fn_res = fp(function (a, sig) {\r\n\t\tif (a.l > 2) {\r\n\t\t\tthrow 'stop - need to check.'\r\n\t\t\tlet res = a[0];\r\n\t\t\tfor (let c = 1, l = a.l; c < l; c++) {\r\n\t\t\t\tres = fn_res(res, a[c]);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} else {\r\n\t\t\tif (sig === '[n,n]') {\r\n\t\t\t\treturn n_fn(a[0], a[1]);\r\n\t\t\t} else {\r\n\t\t\t\tconst ats = atof(a);\r\n\t\t\t\tif (ats[0] === 'array') {\r\n\t\t\t\t\tif (ats[1] === 'number') {\r\n\t\t\t\t\t\tconst res = [],\r\n\t\t\t\t\t\t\tn = a[1],\r\n\t\t\t\t\t\t\tl = a[0].length\r\n\t\t\t\t\t\tlet c;\r\n\t\t\t\t\t\tfor (c = 0; c < l; c++) {\r\n\t\t\t\t\t\t\tres.push(fn_res(a[0][c], n));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ats[1] === 'array') {\r\n\t\t\t\t\t\tif (ats[0].length !== ats[1].length) {\r\n\t\t\t\t\t\t\tthrow 'vector array lengths mismatch';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst l = a[0].length, res = new Array(l),\r\n\t\t\t\t\t\t\t\tarr2 = a[1];\r\n\t\t\t\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\t\t\t\tres[c] = fn_res(a[0][c], arr2[c]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\treturn fn_res;\r\n};\r\nconst n_add = (n1, n2) => n1 + n2,\r\n\tn_subtract = (n1, n2) => n1 - n2,\r\n\tn_multiply = (n1, n2) => n1 * n2,\r\n\tn_divide = (n1, n2) => n1 / n2;\r\nconst v_add = vectorify(n_add),\r\n\tv_subtract = vectorify(n_subtract),\r\n\tv_multiply = vectorify(n_multiply),\r\n\tv_divide = vectorify(n_divide);\r\nconst vector_magnitude = function (vector) {\r\n\t// may calculate magnitudes of larger dimension vectors too.\r\n\t// alert(tof(vector[0]));\r\n\t// alert(vector[0] ^ 2);\r\n\tvar res = Math.sqrt((Math.pow(vector[0], 2)) + (Math.pow(vector[1], 2)));\r\n\treturn res;\r\n};\r\nconst distance_between_points = function (points) {\r\n\tvar offset = v_subtract(points[1], points[0]);\r\n\t//console.log('offset ' + stringify(offset));\r\n\treturn vector_magnitude(offset);\r\n}\r\n// ui8c?\r\n//  ui8x???  for both?\r\n//  \r\n// Getting into some lower level types here.\r\n//   Consider specifying endianness for numbers.\r\n// Specify things from the basics.\r\n//   Have the descriptions make sense in English and programatically.\r\n//   Have it understand the descriptions of data types including signifiers and representations.\r\n// srtype.add_representation(...)\r\n//   .representations.add\r\n// or 'rep' function.\r\n//  rep(str_tsig_name, definition of representaion / instructions)\r\nconst map_tas_by_type = {\r\n\t'c': Uint8ClampedArray,\r\n\t'ui8': Uint8Array,\r\n\t'i16': Int16Array,\r\n\t'i32': Int32Array,\r\n\t'ui16': Uint16Array,\r\n\t'ui32': Uint32Array,\r\n\t'f32': Float32Array,\r\n\t'f64': Float64Array\r\n}\r\nconst get_typed_array = function () {\r\n\tconst a = arguments;\r\n\tlet length, input_array;\r\n\tconst type = a[0];\r\n\tif (is_array(a[1])) {\r\n\t\tinput_array = a[1];\r\n\t} else {\r\n\t\tlength = a[1];\r\n\t}\r\n\tconst ctr = map_tas_by_type[type];\r\n\tif (ctr) {\r\n\t\tif (input_array) {\r\n\t\t\treturn ctr(input_array);\r\n\t\t} else if (length) {\r\n\t\t\treturn ctr(length);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Grammar class may be a bit tricky / complex.\r\n//   Maybe it will help because it can be used to define objects easily???\r\n//   Maybe need to get into much more detail??? Maybe a quick and efficient piece of grammar code could work here.\r\n\r\nclass Grammar {\r\n\tconstructor(spec) {\r\n\t\tconst eg_spec = {\r\n\t\t\tname: 'User Auth Grammar'\r\n\t\t}\r\n\t\tconst {\r\n\t\t\tname\r\n\t\t} = spec;\r\n\t\tthis.name = name;\r\n\t\tconst eg_indexing = () => {\r\n\t\t\tlet map_sing_plur = {};\r\n\t\t\tlet map_plur_sing = {};\r\n\t\t\tlet map_sing_def = {};\r\n\t\t\tlet map_sig_sing = {};\r\n\t\t\tlet map_sig0_sing = {};\r\n\t\t\tlet map_sig1_sing = {};\r\n\t\t\tlet map_sig2_sing = {};\r\n\t\t}\r\n\t\tthis.maps = {\r\n\t\t\tsing_plur: {},\r\n\t\t\tplur_sing: {},\r\n\t\t\tsing_def: {},\r\n\t\t\tdeep_sig_sing: {},\r\n\t\t\tobj_sig_sing: {},\r\n\t\t\tsig_levels_sing: {}\r\n\t\t}\r\n\t\tthis.load_grammar(spec.def);\r\n\t}\r\n\tload_grammar(grammar_def) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst resolve_def = (def) => {\r\n\t\t\tconst td = tf(def);\r\n\t\t\tif (td === 'a') {\r\n\t\t\t\tconst res = [];\r\n\t\t\t\teach(def, def_item => {\r\n\t\t\t\t\tres.push(resolve_def(def_item));\r\n\t\t\t\t});\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (td === 's') {\r\n\t\t\t\tif (def === 'string') {\r\n\t\t\t\t\treturn 'string';\r\n\t\t\t\t} else if (def === 'number') {\r\n\t\t\t\t\treturn 'number';\r\n\t\t\t\t} else if (def === 'boolean') {\r\n\t\t\t\t\treturn 'boolean';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst found_sing_def = sing_def[def];\r\n\t\t\t\t\treturn found_sing_def;\r\n\t\t\t\t}\r\n\t\t\t} else if (td === 'n') {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t} else if (td === 'b') {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst resolved_def_to_sig = (resolved_def, level = 0) => {\r\n\t\t\tconst trd = tf(resolved_def);\r\n\t\t\tif (trd === 's') {\r\n\t\t\t\tif (resolved_def === 'string') {\r\n\t\t\t\t\treturn 's'\r\n\t\t\t\t} else if (resolved_def === 'number') {\r\n\t\t\t\t\treturn 'n'\r\n\t\t\t\t} else if (resolved_def === 'boolean') {\r\n\t\t\t\t\treturn 'b'\r\n\t\t\t\t}\r\n\t\t\t} else if (trd === 'a') {\r\n\t\t\t\tlet res = '';\r\n\t\t\t\tif (level === 0) {} else {\r\n\t\t\t\t\tres = res + '[';\r\n\t\t\t\t}\r\n\t\t\t\teach(resolved_def, (item, c) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tres = res + resolved_def_to_sig(item, level + 1);\r\n\t\t\t\t});\r\n\t\t\t\tif (level === 0) {} else {\r\n\t\t\t\t\tres = res + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\teach(grammar_def, (def1, sing_word) => {\r\n\t\t\tconst {\r\n\t\t\t\tdef,\r\n\t\t\t\tplural\r\n\t\t\t} = def1;\r\n\t\t\tsing_def[sing_word] = def;\r\n\t\t\tsing_plur[sing_word] = plural;\r\n\t\t\tplur_sing[plural] = sing_word;\r\n\t\t\tconst tdef = tf(def);\r\n\t\t\tconst resolved_def = resolve_def(def);\r\n\t\t\tconst resolved_def_sig = resolved_def_to_sig(resolved_def);\r\n\t\t\tdeep_sig_sing[resolved_def_sig] = deep_sig_sing[resolved_def_sig] || [];\r\n\t\t\tdeep_sig_sing[resolved_def_sig].push(sing_word);\r\n\t\t\tlet def_is_all_custom_types = true;\r\n\t\t\teach(def, (def_item, c, stop) => {\r\n\t\t\t\tconst tdi = tf(def_item);\r\n\t\t\t\tif (tdi === 's') {\r\n\t\t\t\t\tif (sing_def[def_item]) {} else {\r\n\t\t\t\t\t\tdef_is_all_custom_types = false;\r\n\t\t\t\t\t\tstop();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdef_is_all_custom_types = false;\r\n\t\t\t\t\tstop();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tlet obj_sig;\r\n\t\t\tif (def_is_all_custom_types) {\r\n\t\t\t\tobj_sig = '{';\r\n\t\t\t\teach(def, (def_item, c, stop) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tobj_sig = obj_sig + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst resolved = resolve_def(def_item);\r\n\t\t\t\t\tconst abr_resolved = resolved_def_to_sig(resolved);\r\n\t\t\t\t\tobj_sig = obj_sig + '\"' + def_item + '\":'\r\n\t\t\t\t\tobj_sig = obj_sig + abr_resolved;\r\n\t\t\t\t});\r\n\t\t\t\tobj_sig = obj_sig + '}';\r\n\t\t\t}\r\n\t\t\tif (obj_sig) {\r\n\t\t\t\tobj_sig_sing[obj_sig] = obj_sig_sing[obj_sig] || [];\r\n\t\t\t\tobj_sig_sing[obj_sig].push(sing_word);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\ttof(item) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst titem = tf(item);\r\n\t\tconsole.log('titem', titem);\r\n\t\tif (titem === 'a') {\r\n\t\t\tlet all_arr_items_type;\r\n\t\t\teach(item, (subitem, c, stop) => {\r\n\t\t\t\tconst subitem_type = this.tof(subitem);\r\n\t\t\t\tconsole.log('subitem_type', subitem_type);\r\n\t\t\t\tif (c === 0) {\r\n\t\t\t\t\tall_arr_items_type = subitem_type;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (all_arr_items_type === subitem_type) {} else {\r\n\t\t\t\t\t\tall_arr_items_type = null;\r\n\t\t\t\t\t\tstop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (all_arr_items_type) {\r\n\t\t\t\tconsole.log('has all_arr_items_type', all_arr_items_type);\r\n\t\t\t\tif (!map_native_types[all_arr_items_type]) {\r\n\t\t\t\t\tconst res = sing_plur[all_arr_items_type];\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('no all_arr_items_type');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn tof(item);\r\n\t\t}\r\n\t\tconst item_deep_sig = deep_sig(item);\r\n\t\tconsole.log('Grammar tof() item_deep_sig', item_deep_sig);\r\n\t\tlet arr_sing;\r\n\t\tif (titem === 'a') {\r\n\t\t\tconst unenclosed_sig = item_deep_sig.substring(1, item_deep_sig.length - 1);\r\n\t\t\tconsole.log('unenclosed_sig', unenclosed_sig);\r\n\t\t\tarr_sing = deep_sig_sing[unenclosed_sig];\r\n\t\t} else {\r\n\t\t\tarr_sing = deep_sig_sing[item_deep_sig];\r\n\t\t}\r\n\t\tif (arr_sing) {\r\n\t\t\tif (arr_sing.length === 1) {\r\n\t\t\t\treturn arr_sing[0];\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsig(item, max_depth = -1, depth = 0) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tconst extended_sig = item => {\r\n\t\t\tconst ti = tf(item);\r\n\t\t\tlet res = '';\r\n\t\t\tlet same_grammar_type;\r\n\t\t\tconst record_subitem_sigs = item => {\r\n\t\t\t\tsame_grammar_type = undefined;\r\n\t\t\t\tlet same_sig = undefined;\r\n\t\t\t\teach(item, (subitem, c) => {\r\n\t\t\t\t\tif (c > 0) {\r\n\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst sig_subitem = this.sig(subitem, max_depth, depth + 1);\r\n\t\t\t\t\tif (same_sig === undefined) {\r\n\t\t\t\t\t\tsame_sig = sig_subitem;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (sig_subitem !== same_sig) {\r\n\t\t\t\t\t\t\tsame_sig = false;\r\n\t\t\t\t\t\t\tsame_grammar_type = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (same_sig) {\r\n\t\t\t\t\t\tif (sing_def[sig_subitem]) {\r\n\t\t\t\t\t\t\tif (same_grammar_type === undefined) {\r\n\t\t\t\t\t\t\t\tsame_grammar_type = sig_subitem;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (same_grammar_type === sig_subitem) {} else {\r\n\t\t\t\t\t\t\t\t\tsame_grammar_type = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tres = res + sig_subitem;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (ti === 'A') {\r\n\t\t\t\trecord_subitem_sigs(item);\r\n\t\t\t\treturn res;\r\n\t\t\t} else if (ti === 'a') {\r\n\t\t\t\trecord_subitem_sigs(item);\r\n\t\t\t\tif (same_grammar_type) {\r\n\t\t\t\t\tconst plur_name = sing_plur[same_grammar_type];\r\n\t\t\t\t\treturn plur_name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst found_obj_type = obj_sig_sing[res];\r\n\t\t\t\t\tconst found_deep_sig_type = deep_sig_sing[res];\r\n\t\t\t\t\tlet found_type_sing;\r\n\t\t\t\t\tif (found_deep_sig_type) {\r\n\t\t\t\t\t\tif (found_deep_sig_type.length === 1) {\r\n\t\t\t\t\t\t\tfound_type_sing = found_deep_sig_type[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (found_type_sing) {\r\n\t\t\t\t\t\treturn found_type_sing;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst enclosed_res = '[' + res + ']';\r\n\t\t\t\t\t\treturn enclosed_res;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (ti === 'o') {\r\n\t\t\t\tif (max_depth === -1 || depth <= max_depth) {\r\n\t\t\t\t\tres = res + '{';\r\n\t\t\t\t\tlet first = true;\r\n\t\t\t\t\teach(item, (value, key) => {\r\n\t\t\t\t\t\tconst vsig = this.sig(value, max_depth, depth + 1);\r\n\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\tres = res + ',';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfirst = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tres = res + '\"' + key + '\":' + vsig;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tres = res + '}';\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 'o';\r\n\t\t\t\t}\r\n\t\t\t} else if (ti === 's' || ti === 'n' || ti === 'b') {\r\n\t\t\t\treturn ti;\r\n\t\t\t} else {\r\n\t\t\t\treturn ti;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn extended_sig(item);\r\n\t}\r\n\tsingle_forms_sig(item) {\r\n\t\tconst {\r\n\t\t\tsing_plur,\r\n\t\t\tplur_sing,\r\n\t\t\tsing_def,\r\n\t\t\tsig_levels_sing,\r\n\t\t\tdeep_sig_sing,\r\n\t\t\tobj_sig_sing\r\n\t\t} = this.maps;\r\n\t\tlet sig = this.sig(item);\r\n\t\tlet s_sig = sig.split(',');\r\n\t\tconst arr_res = [];\r\n\t\teach(s_sig, (sig_item, c) => {\r\n\t\t\tconst sing = plur_sing[sig_item] || sig_item;\r\n\t\t\tarr_res.push(sing);\r\n\t\t});\r\n\t\tconst res = arr_res.join(',');\r\n\t\treturn res;\r\n\t}\r\n}\r\nclass Evented_Class {\r\n\t'constructor'() {\r\n\t\tObject.defineProperty(this, '_bound_events', {\r\n\t\t\tvalue: {}\r\n\t\t});\r\n\t}\r\n\t'raise_event'() {\r\n\t\tlet a = Array.prototype.slice.call(arguments),\r\n\t\t\tsig = get_a_sig(a);\r\n\t\ta.l = a.length;\r\n\t\tlet target = this;\r\n\t\tlet c, l, res;\r\n\t\tif (sig === '[s]') {\r\n\t\t\tlet target = this;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) == 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,a]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,b]' || sig === '[s,s]' || sig === '[s,n]' || sig === '[s,B]' || sig === '[s,O]' || sig === '[s,e]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sig === '[s,o]' || sig === '[s,?]') {\r\n\t\t\tlet be = this._bound_events;\r\n\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tres = [];\r\n\t\t\tif (bgh) {\r\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (be) {\r\n\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\tif (tof(bei) === 'array') {\r\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (a.l > 2) {\r\n\t\t\t\tlet event_name = a[0];\r\n\t\t\t\tlet additional_args = [];\r\n\t\t\t\tlet bgh_args = [event_name];\r\n\t\t\t\tfor (c = 1, l = a.l; c < l; c++) {\r\n\t\t\t\t\tadditional_args.push(a[c]);\r\n\t\t\t\t\tbgh_args.push(a[c]);\r\n\t\t\t\t}\r\n\t\t\t\tlet be = this._bound_events;\r\n\t\t\t\tlet bgh = this._bound_general_handler;\r\n\t\t\t\tres = [];\r\n\t\t\t\tif (bgh) {\r\n\t\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\r\n\t\t\t\t\t\tres.push(bgh[c].apply(target, bgh_args));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (be) {\r\n\t\t\t\t\tlet bei = be[event_name];\r\n\t\t\t\t\tif (tof(bei) == 'array') {\r\n\t\t\t\t\t\tif (bei.length > 0) {\r\n\t\t\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\r\n\t\t\t\t\t\t\t\tif (bei[c]) res.push(bei[c].apply(target, additional_args));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'add_event_listener'() {\r\n\t\tconst {\r\n\t\t\tevent_events\r\n\t\t} = this;\r\n\t\tlet a = Array.prototype.slice.call(arguments),\r\n\t\t\tsig = get_a_sig(a);\r\n\t\tif (sig === '[f]') {\r\n\t\t\tthis._bound_general_handler = this._bound_general_handler || [];\r\n\t\t\tif (is_array(this._bound_general_handler)) {\r\n\t\t\t\tthis._bound_general_handler.push(a[0]);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (sig === '[s,f]') {\r\n\t\t\tlet event_name = a[0],\r\n\t\t\t\tfn_listener = a[1];\r\n\t\t\tif (!this._bound_events[event_name]) this._bound_events[event_name] = [];\r\n\t\t\tlet bei = this._bound_events[event_name];\r\n\t\t\tif (is_array(bei)) {\r\n\t\t\t\tbei.push(fn_listener);\r\n\t\t\t\tif (event_events) {\r\n\t\t\t\t\tthis.raise('add-event-listener', {\r\n\t\t\t\t\t\t'name': event_name\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'Expected: array';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t'remove_event_listener'(event_name, fn_listener) {\r\n\t\tconst {\r\n\t\t\tevent_events\r\n\t\t} = this;\r\n\t\tif (this._bound_events) {\r\n\t\t\tlet bei = this._bound_events[event_name] || [];\r\n\t\t\tif (is_array(bei)) {\r\n\t\t\t\tlet c = 0,\r\n\t\t\t\t\tl = bei.length,\r\n\t\t\t\t\tfound = false;\r\n\t\t\t\twhile (!found && c < l) {\r\n\t\t\t\t\tif (bei[c] === fn_listener) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (found) {\r\n\t\t\t\t\tbei.splice(c, 1);\r\n\t\t\t\t\tif (event_events) {\r\n\t\t\t\t\t\tthis.raise('remove-event-listener', {\r\n\t\t\t\t\t\t\t'name': event_name\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'Expected: array';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tget bound_named_event_counts() {\r\n\t\tconst res = {};\r\n\t\tif (this._bound_events) {\r\n\t\t\tconst keys = Object.keys(this._bound_events);\r\n\t\t\teach(keys, key => {\r\n\t\t\t\tres[key] = this._bound_events[key].length;\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'one'(event_name, fn_handler) {\r\n\t\tlet inner_handler = function (e) {\r\n\t\t\tfn_handler.call(this, e);\r\n\t\t\tthis.off(event_name, inner_handler);\r\n\t\t};\r\n\t\tthis.on(event_name, inner_handler);\r\n\t}\r\n\t'changes'(obj_changes) {\r\n\t\tif (!this.map_changes) {\r\n\t\t\tthis.map_changes = {};\r\n\t\t}\r\n\t\teach(obj_changes, (handler, name) => {\r\n\t\t\tthis.map_changes[name] = this.map_changes[name] || [];\r\n\t\t\tthis.map_changes[name].push(handler);\r\n\t\t})\r\n\t\tif (!this._using_changes) {\r\n\t\t\tthis._using_changes = true;\r\n\t\t\tthis.on('change', e_change => {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tvalue\r\n\t\t\t\t} = e_change;\r\n\t\t\t\tif (this.map_changes[name]) {\r\n\t\t\t\t\teach(this.map_changes[name], h_change => {\r\n\t\t\t\t\t\th_change(value);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n};\r\nconst p = Evented_Class.prototype;\r\np.raise = p.raise_event;\r\np.trigger = p.raise_event;\r\np.subscribe = p.add_event_listener;\r\np.on = p.add_event_listener;\r\np.off = p.remove_event_listener;\r\nconst eventify = obj => {\r\n\tconst bound_events = {};\r\n\tconst add_event_listener = (name, handler) => {\r\n\t\tif (handler === undefined && typeof name === 'function') {\r\n\t\t\thandler = name;\r\n\t\t\tname = '';\r\n\t\t}\r\n\t\tif (!bound_events[name]) bound_events[name] = [];\r\n\t\tbound_events[name].push(handler);\r\n\t}\r\n\tconst remove_event_listener = (name, handler) => {\r\n\t\tif (bound_events[name]) {\r\n\t\t\tconst i = bound_events[name].indexOf(handler);\r\n\t\t\tif (i > -1) {\r\n\t\t\t\tbound_events[name].splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst raise_event = (name, optional_param) => {\r\n\t\tconst arr_named_events = bound_events[name];\r\n\t\tif (arr_named_events !== undefined) {\r\n\t\t\tif (optional_param !== undefined) {\r\n\t\t\t\tconst l = arr_named_events.length;\r\n\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\tarr_named_events[c].call(obj, optional_param);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst l = arr_named_events.length;\r\n\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\tarr_named_events[c].call(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tobj.on = obj.add_event_listener = add_event_listener;\r\n\tobj.off = obj.remove_event_listener = remove_event_listener;\r\n\tobj.raise = obj.raise_event = raise_event;\r\n\treturn obj;\r\n}\r\n\r\n// Assign_From_Spec_Class\r\n\r\n\r\n// Assign_From_Spec_Evented_Class\r\n\r\n\r\n\r\n\r\nclass Publisher extends Evented_Class {\r\n\tconstructor(spec = {}) {\r\n\t\tsuper({});\r\n\t\tthis.one('ready', () => {\r\n\t\t\tthis.is_ready = true;\r\n\t\t})\r\n\t}\r\n\tget when_ready () {\r\n\t\treturn new Promise((solve, jettison) => {\r\n\t\t\tif (this.is_ready === true) {\r\n\t\t\t\tsolve();\r\n\t\t\t} else {\r\n\t\t\t\tthis.one('ready', () => {\r\n\t\t\t\t\tsolve();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\nconst prop = (...a) => {\r\n\r\n\t// Using (predefined?) data types here?\r\n\r\n\t// ...args?\r\n\tlet s = get_a_sig(a);\r\n\tconst raise_change_events = true;\r\n\tconst ifn = item => typeof item === \"function\";\r\n\r\n\tif (s === \"[a]\") {\r\n\t\teach(a[0], item_params => {\r\n\t\t\tprop.apply(this, item_params);\r\n\t\t});\r\n\t} else {\r\n\t\tif (a.length === 2) {\r\n\t\t\tif (ia(a[1])) {\r\n\t\t\t\tconst target = a[0];\r\n\t\t\t\teach(a[1], item => {\r\n\t\t\t\t\tif (ia(item)) {\r\n\t\t\t\t\t\tthrow \"NYI 468732\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprop(target, item);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconst ta1 = tof(a[1]);\r\n\t\t\t\tif (ta1 === \"string\") {\r\n\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow \"NYI 468732b\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (a.length > 2) {\r\n\t\t\tif (is_array(a[0])) {\r\n\t\t\t\t// the rest of the properties applied to the array of items.\r\n\t\t\t\tthrow \"stop\";\r\n\t\t\t\tlet objs = a.shift();\r\n\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\tprop.apply(this, [obj].concat(item_params)); // bug\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tlet obj, prop_name, default_value, fn_onchange, fn_transform, fn_on_ready, options;\r\n\t\t\t\tconst load_options = options => {\r\n\t\t\t\t\tprop_name = prop_name || options.name || options.prop_name;\r\n\t\t\t\t\tfn_onchange =\r\n\t\t\t\t\t\toptions.fn_onchange || options.onchange || options.change;\r\n\t\t\t\t\tfn_transform =\r\n\t\t\t\t\t\toptions.fn_transform || options.ontransform || options.transform;\r\n\t\t\t\t\tfn_on_ready = options.ready || options.on_ready;\r\n\t\t\t\t\tdefault_value = default_value || options.default_value || options.default;\r\n\t\t\t\t};\r\n\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t[obj, options] = a;\r\n\t\t\t\t\tload_options(options);\r\n\t\t\t\t} else if (a.length === 3) {\r\n\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t[obj, prop_name, fn_onchange] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (a[2].change || a[2].ready) {\r\n\t\t\t\t\t\t\tload_options(a[2]);\r\n\r\n\t\t\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t} else if (a.length === 4) {\r\n\t\t\t\t\tif (ifn(a[2]) && ifn(a[3])) {\r\n\t\t\t\t\t\t[obj, prop_name, fn_transform, fn_onchange] = a;\r\n\t\t\t\t\t} else if (ifn(a[3])) {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_onchange] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, options] = a;\r\n\t\t\t\t\t\tload_options(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (a.length === 5) {\r\n\t\t\t\t\t[obj, prop_name, default_value, fn_transform, fn_onchange] = a;\r\n\t\t\t\t}\r\n\t\t\t\tlet _prop_value;\r\n\r\n\t\t\t\tif (typeof default_value !== 'undefined') _prop_value = default_value;\r\n\t\t\t\t// And a silent set function that does not raise the change event.\r\n\t\t\t\tconst _silent_set = value => {\r\n\t\t\t\t\tlet _value;\r\n\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t}\r\n\t\t\t\tconst _set = value => {\r\n\t\t\t\t\tlet _value;\r\n\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet old = _prop_value;\r\n\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t\tif (fn_onchange) {\r\n\t\t\t\t\t\tfn_onchange({\r\n\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (obj.raise && raise_change_events) {\r\n\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tif (is_defined(default_value)) {\r\n\t\t\t\t\t_prop_value = default_value;\r\n\t\t\t\t}\r\n\t\t\t\tconst t_prop_name = tf(prop_name);\r\n\t\t\t\tif (t_prop_name === 's') {\r\n\r\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t} else if (t_prop_name === 'a') {\r\n\t\t\t\t\tconst l = prop_name.length;\r\n\t\t\t\t\t//console.log('prop_name', prop_name);\r\n\t\t\t\t\tlet item_prop_name;\r\n\t\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\t\titem_prop_name = prop_name[c];\r\n\t\t\t\t\t\t//console.log('item_prop_name', item_prop_name);\r\n\t\t\t\t\t\tObject.defineProperty(obj, item_prop_name, {\r\n\t\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow 'Unexpected name type: ' + t_prop_name;\r\n\t\t\t\t}\r\n\t\t\t\tif (fn_on_ready) {\r\n\t\t\t\t\tfn_on_ready({\r\n\t\t\t\t\t\tsilent_set: _silent_set\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\r\nclass Data_Type {\r\n\r\n}\r\n\r\nclass Functional_Data_Type extends Data_Type {\r\n    constructor(spec) {\r\n\r\n\t\t/*\r\n\t\tnamed_property_access: true,\r\n\t\tproperty_names: ['latitude', 'longitude'],\r\n\t\t// And the property types as well being the same in this case?\r\n\t\tabbreviated_property_names: ['lat', 'long'],\r\n\t\tnumbered_property_access: true, // Maybe that's good enough to make it like an array when there are 2 properties.\r\n\r\n\t\t*/\r\n        \r\n        // fns for: validate as exact type...?\r\n        // convert from whatever it is to that exact type (if possible)\r\n        //   string and binary conversions.\r\n        //   eg a convert_load type operation.\r\n\r\n        // it's super / parent type.\r\n        super(spec);\r\n\r\n        if (spec.supertype) this.supertype = spec.supertype;\r\n        if (spec.name) this.name = spec.name;\r\n        if (spec.abbreviated_name) this.abbreviated_name = spec.abbreviated_name;\r\n\t\tif (spec.named_property_access) this.named_property_access = spec.named_property_access;\r\n\t\tif (spec.numbered_property_access) this.numbered_property_access = spec.numbered_property_access;\r\n\t\tif (spec.property_names) this.property_names = spec.property_names;\r\n\t\tif (spec.property_data_types) this.property_data_types = spec.property_data_types;\r\n\t\tif (spec.wrap_properties) this.wrap_properties = spec.wrap_properties;\r\n\t\tif (spec.wrap_value_inner_values) this.wrap_value_inner_values = spec.wrap_value_inner_values;\r\n\t\tif (spec.value_js_type) this.value_js_type = spec.value_js_type;\r\n\t\t// value_js_type\r\n\r\n\t\t// wrap_value as well????\r\n\t\t//   Though the value kind-of is itself.\r\n\t\t//    maybe .inner_js_value is much clearer here?\r\n\t\t// wrap_value_inner_values\r\n\r\n\r\n\r\n\t\tif (spec.abbreviated_property_names) this.abbreviated_property_names = spec.abbreviated_property_names;\r\n        if (spec.validate) this.validate = spec.validate;\r\n        if (spec.validate_explain) this.validate_explain = spec.validate_explain;\r\n\t\tif (spec.parse_string) this.parse_string = spec.parse_string;\r\n\t\tif (spec.parse) this.parse = spec.parse;\r\n\r\n\t\t// But also want it to be able to accept undefined value (usually???)\r\n\r\n\r\n\r\n\r\n        // and abbreviated name\r\n        // spec.validate (needs to be perfect...)\r\n\r\n        // spec.load_from(...?)\r\n        // spec.poly_load??\r\n\r\n        // spec.input transformers???\r\n        //   transform from other identified types...?\r\n\r\n        // For the moment, we don't want too many and too complex functions.\r\n\r\n    }\r\n}\r\n\r\n//lang.Data_Type = Data_Type;\r\n//lang.Functional_Data_Type = Functional_Data_Type;\r\n\r\n\r\n\r\n// And let's define some....\r\n\r\n// And a correct value...?\r\n//   Eg if a number is not valid because it has too many decimal points, it could be corrected.\r\n//     Or even an int that's too large, outside a range, corrected to fit in that range.\r\n\r\n// So making a Data_Value stick to using these Data_Types could be helpful.\r\n\r\n// For the moment this is really simple and should work fine for some things.\r\n\r\n// Allow undefined????\r\n//   Or better to have that on a different level.\r\n//     Maybe does make sense as an option here.\r\n\r\n//     Or consider it and do it later.\r\n\r\n\r\nFunctional_Data_Type.number = new Functional_Data_Type({\r\n    name: 'number',\r\n    abbreviated_name: 'n',\r\n    validate: x => {\r\n        return !isNaN(x);\r\n    },\r\n\tparse_string(str) {\r\n\t\tconst p = parseFloat(str);\r\n\t\t// then is it a number???\r\n\r\n\t\t// then is its string the same....?\r\n\t\tif (p + '' === str) {\r\n\t\t\tconst parsed_is_valid = this.validate(p);\r\n\t\t\tif (parsed_is_valid) {\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n});\r\n\r\nFunctional_Data_Type.integer = new Functional_Data_Type({\r\n    name: 'integer',\r\n    abbreviated_name: 'int',\r\n    validate: x => {\r\n        return Number.isInteger(x);\r\n    },\r\n\tparse_string(str) {\r\n\t\tconst p = parseInt(str);\r\n\t\t// then is it a number???\r\n\r\n\t\t// then is its string the same....?\r\n\t\tif (p + '' === str) {\r\n\t\t\tconst parsed_is_valid = this.validate(p);\r\n\t\t\tif (parsed_is_valid) {\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n});\r\n\r\n// Need fdts for things like a [lat, long] array.\r\n//   Maybe see about making it (easily) from composite data types.\r\n//     Pair(Lat, Long) or similar\r\n//     Maybe want it defined in a few lines of string grammar if it's easy.\r\n//       Would make for a simple API - but would require parsing a custom language.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Would be worth getting into creating conventions and idioms for higher level code.\r\n//   Though first getting data type systems working right would help.\r\n//     Making them easy to use.\r\n\r\nconst field = (...a) => {\r\n\r\n\t// Will also want to set data types of fields....\r\n\r\n\t// Uses obj._\r\n\t//   Seems quite simple, powerful, flexible.\r\n\t//     However, would like a different way of doing it too, could use a local variable defined within the 'field' function.\r\n\r\n\t// Want to incorporate data types, maybe grammar too.\r\n\r\n\t// Could use fp for this as well????\r\n\t//   See about really concise function definitions.\r\n\r\n\t//  Also want to see about some benchmarks too.\r\n\t//    Eg rendering a large page server side 10 times.\r\n\r\n\tconst raise_change_events = true;\r\n\r\n\tconst ifn = item => typeof item === \"function\";\r\n\r\n\tlet s = get_a_sig(a);\r\n\tif (s === \"[a]\") {\r\n\t\t// prop????\r\n\t\teach(a[0], item_params => {\r\n\t\t\tprop.apply(this, item_params);\r\n\t\t});\r\n\t} else {\r\n\t\tif (a.length > 1) {\r\n\t\t\tif (is_array(a[0])) {\r\n\r\n\t\t\t\tthrow 'stop - need to fix';\r\n\t\t\t\t// the rest of the properties applied to the array of items.\r\n\r\n\t\t\t\t// But field.apply here...???\r\n\t\t\t\tlet objs = a.shift();\r\n\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\tfield.apply(this, [obj].concat(item_params));\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Maybe will have a Data_Type....\r\n\r\n\t\t\t\tlet obj, prop_name, data_type, default_value, fn_transform;\r\n\t\t\t\t//let raise_change_events = opts.raise_change_events;\r\n\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t} else if (a.length === 3) {\r\n\r\n\t\t\t\t\t// And also check a[2] for being a Data_Type.\r\n\r\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\r\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, fn_transform] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t} else if (a.length === 4) {\r\n\r\n\t\t\t\t\t// field(this, 'value', this.data_type, spec.value);\r\n\r\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\r\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (obj !== undefined) {\r\n\r\n\r\n\r\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\tif (is_defined(obj._)) {\r\n\t\t\t\t\t\t\t\treturn obj._[prop_name];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//return _prop_value;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t//console.log('setting prop: ' + prop_name);\r\n\t\t\t\t\t\t\tlet old = (obj._ = obj._ || {})[prop_name];\r\n\t\t\t\t\t\t\t// value must be an array of length 2.\r\n\r\n\r\n\t\t\t\t\t\t\tif (old !== value) {\r\n\r\n\t\t\t\t\t\t\t\tlet is_valid = true;\r\n\t\t\t\t\t\t\t\tif (data_type) {\r\n\r\n\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(value);\r\n\r\n\t\t\t\t\t\t\t\t\t// if not valid directly, can we parse it from a string???\r\n\r\n\t\t\t\t\t\t\t\t\tif (typeof value === 'string') {\r\n\t\t\t\t\t\t\t\t\t\tconst parsed_value = data_type.parse_string(value);\r\n\t\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(parsed_value);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (is_valid) value = parsed_value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (is_valid) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet _value;\r\n\t\t\t\t\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t\t\t\t\t//try {\r\n\t\t\t\t\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t\t\t\t\t\t//} catch (err) {\r\n\t\t\t\t\t\t\t\t\t\t//    throw err;\r\n\t\t\t\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\r\n\t\r\n\t\r\n\t\t\t\t\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tobj._[prop_name] = _value;\r\n\t\t\t\t\t\t\t\t\tif (raise_change_events) {\r\n\t\t\t\t\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: _value\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (is_defined(default_value)) {\r\n\t\t\t\t\t\tlet is_valid = true;\r\n\t\t\t\t\t\tif (data_type) {\r\n\t\t\t\t\t\t\tis_valid = data_type.validate(default_value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (is_valid) {\r\n\t\t\t\t\t\t\t(obj._ = obj._ || {})[prop_name] = default_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow 'stop';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\r\n// Probably need an 'equals' function.\r\n//   Would make use of .equals and .hash functions / properties when available.\r\n\r\n// Though Data_Value.toString and toJSON may be most useful sooner...\r\n\r\n// lang-tools should have the equals function that supports Data_Value (maybe Data_Model in general).\r\n\r\nconst lang_mini_props = {\r\n\teach,\r\n\tis_array,\r\n\tis_dom_node,\r\n\tis_ctrl,\r\n\tclone,\r\n\tget_truth_map_from_arr,\r\n\ttm: get_truth_map_from_arr,\r\n\tget_arr_from_truth_map,\r\n\tarr_trim_undefined,\r\n\tget_map_from_arr,\r\n\tarr_like_to_arr,\r\n\ttof,\r\n\tatof,\r\n\ttf,\r\n\tload_type,\r\n\tis_defined,\r\n\tdef: is_defined,\r\n\tGrammar,\r\n\tstringify,\r\n\tfunctional_polymorphism,\r\n\tfp,\r\n\tmfp,\r\n\tarrayify,\r\n\tmapify,\r\n\tstr_arr_mapify,\r\n\tget_a_sig,\r\n\tdeep_sig,\r\n\tget_item_sig,\r\n\tset_vals,\r\n\ttruth,\r\n\ttrim_sig_brackets,\r\n\tll_set,\r\n\tll_get,\r\n\titerate_ancestor_classes,\r\n\tis_arr_of_t,\r\n\tis_arr_of_arrs,\r\n\tis_arr_of_strs,\r\n\tinput_processors,\r\n\toutput_processors,\r\n\tcall_multiple_callback_functions,\r\n\tcall_multi,\r\n\tmulti: call_multi,\r\n\tnative_constructor_tof,\r\n\tFns,\r\n\tsig_match,\r\n\tremove_sig_from_arr_shell,\r\n\tto_arr_strip_keys,\r\n\tarr_objs_to_arr_keys_values_table,\r\n\tset_arr_tree_value,\r\n\tget_arr_tree_value,\r\n\tdeep_arr_iterate,\r\n\tprom,\r\n\tcombinations,\r\n\tcombos: combinations,\r\n\tEvented_Class,\r\n\teventify,\r\n\tvectorify,\r\n\tv_add,\r\n\tv_subtract,\r\n\tv_multiply,\r\n\tv_divide,\r\n\tvector_magnitude,\r\n\tdistance_between_points,\r\n\tget_typed_array,\r\n\tgta: get_typed_array,\r\n\tPublisher,\r\n\tfield,\r\n\tprop,\r\n\tData_Type,\r\n\tFunctional_Data_Type\r\n};\r\n\r\nconst lang_mini = new Evented_Class();\r\nObject.assign(lang_mini, lang_mini_props);\r\nlang_mini.note = (str_name, str_state, obj_properties) => {\r\n\tobj_properties = obj_properties || {};\r\n\tobj_properties.name = str_name;\r\n\tobj_properties.state = str_state;\r\n\tlang_mini.raise('note', obj_properties)\r\n}\r\nmodule.exports = lang_mini;\r\n\r\n// Bring in grammar / compound types to this typedef type thing.\r\n//   Types in the fields. \r\n\r\n// Detecting invalid view model states.\r\n//   Validating according to the spec of the data basically.\r\n\r\n// Defining data types and models with a gui....\r\n\r\n\r\n\r\n\r\nif (require.main === module) {\r\n\r\n\r\n\r\n\t/*\r\n\tfunction test_evented_class(test_data) {\r\n\t\tconst create_empty_test_res = () => {\r\n\t\t  return {\r\n\t\t\tpassed: [],\r\n\t\t\tfailed: []\r\n\t\t  };\r\n\t\t};\r\n\t  \r\n\t\t// Initialize res object with empty arrays\r\n\t\tconst res = create_empty_test_res();\r\n\t  \r\n\t\t// Test each event in test_data\r\n\t\tfor (let i = 0; i < test_data.length; i++) {\r\n\t\t  const { event_name, event_data } = test_data[i];\r\n\t  \r\n\t\t  // Test adding the event\r\n\t\t  const evented_class = new Evented_Class();\r\n\t\t  evented_class.add_event_listener(event_name, (data) => {\r\n\t\t\tif (data === event_data) {\r\n\t\t\t  res.passed.push(event_name);\r\n\t\t\t} else {\r\n\t\t\t  res.failed.push(event_name);\r\n\t\t\t}\r\n\t\t  });\r\n\t  \r\n\t\t  // Test raising the event\r\n\t\t  evented_class.raise_event(event_name, event_data);\r\n\t\t}\r\n\t  \r\n\t\t// Return test results\r\n\t\treturn res;\r\n\t  }\r\n\t  */\r\n\r\n\t  const test_data = [\r\n\t\t{\r\n\t\t\tevent_name: 'foo',\r\n\t\t\tevent_data: 'hello'\r\n\t\t},\r\n\t\t{\r\n\t\t\tevent_name: 'bar',\r\n\t\t\tevent_data: 'world'\r\n\t\t},\r\n\t\t{\r\n\t\t\tevent_name: 'baz',\r\n\t\t\tevent_data: true\r\n\t\t}\r\n\t];\r\n\t\r\n\tconst create_empty_test_res = () => ({\r\n\t\tpassed: [],\r\n\t\tfailed: []\r\n\t});\r\n\r\n\t  \r\n\t  function test_evented_class(test_data) {\r\n\t\tconst res = create_empty_test_res();\r\n\t\r\n\t\t// Create a new instance of Evented_Class\r\n\t\tconst evented_class = new Evented_Class();\r\n\t\r\n\t\t// Test each event in the test data\r\n\t\ttest_data.forEach(test_event => {\r\n\t\t\tconst event_name = test_event.event_name;\r\n\t\t\tconst event_data = test_event.event_data;\r\n\t\r\n\t\t\t// Define a listener for the event\r\n\t\t\tconst listener = data => {\r\n\t\t\t\tif (data === event_data) {\r\n\t\t\t\t\t// The event was raised with the expected data\r\n\t\t\t\t\tres.passed.push(event_name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// The event was raised with the wrong data\r\n\t\t\t\t\tres.failed.push(event_name);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\t// Add the listener to the evented class\r\n\t\t\tevented_class.on(event_name, listener);\r\n\t\r\n\t\t\t// Raise the event\r\n\t\t\tevented_class.raise_event(event_name, event_data);\r\n\t\t});\r\n\t\r\n\t\treturn res;\r\n\t}\r\n\t\r\n\r\n\r\n\tconst result = test_evented_class(test_data);\r\n\r\n\t// Print the results of the test\r\n\tconsole.log('Passed:', result.passed);\r\n\tconsole.log('Failed:', result.failed);\r\n\r\n\r\n}", "const lang = require('./lang-mini');\n\nconst {each, tof} = lang;\n\n\n// and lang types...\n//  Will use a Type class.\n//   Number_Type etc. String_Type perhaps.\n//     and then restrictions. JSON_Type is a String_Type.\n\n\n\n// Could have first implementation of types here even....\n//   Maybe don't use classes for them?\n//     Or do because they are so integrated into the language now.\n\n// Representation_Type\n//   eg represents a color (in specific way?) How it represents it...?\n//     ?? represents a 24bit rgb color ??\n//       why not? should be possible.\n\n\n// Some / all of oext would be nice within lang-mini...?\n\n// oext seems to work with types though, or would benefit from types.\n//   No, oext does not have much for types, moving field and prop from oext here, need to get the data types working with Data_Object\n//   and Data_Value. \n\n\n\n\n\n// Maybe move to lang-tools?\n//   fp() may benefit from integration with this.\n\n\n\n// What the type represents.\n// What it signifies?\n\n// But then how it's represented?\n\n\n// Not really about storing the data in memory or transmitting it.\n//   But saying it's 24 bit color is kind of about its representation.\n//   Still that's what it's called.\n\n// Type_Signifier seems better. Now it's called that.\n\n// Wider signification than just JS.\n\n\n// Type_Signifier_Component ????\n\n// Type_Signifier perhaps. Signifier_Type???\n\nclass Type_Signifier {\n    // Name\n    constructor(spec = {}) {\n\n        const name = spec.name;\n\n        // And use fields / quicker way to define these?\n\n        Object.defineProperty(this, 'name', {\n            get() {\n                return name;\n            }\n        });\n\n        const parent = spec.parent;\n\n        Object.defineProperty(this, 'parent', {\n            get() {\n                return parent;\n            }\n        });\n\n        const map_reserved_property_names = {\n            name: true,\n            parent: true\n        }\n\n        const _ = {};\n\n        each(spec, (value, name) => {\n            if (map_reserved_property_names[name]) {\n\n            } else {\n                _[name] = value;\n            }\n        });\n\n\n\n        // And other fields too....\n\n\n    }\n    extend(o_extension) {\n\n        const o = {\n            parent: this\n        }\n        Object.assign(o, o_extension);\n        const res = new Type_Signifier(o_extension);\n        return res;\n\n\n    }\n    //  Other options?\n    //  Disambiguiation? Descriptive text?\n    //    Or is naming them the main thing there?\n\n    // Color representation\n    //   And that is simple, does not go into internal representation.\n\n}\n\n\n\n\n// A representation for what is signified.\n//   This way if the programmer gets stuck about 'the' representation to make, they can make a decent representation, make it default,\n//     and move on for the moment.\n\n\n// Can be multiple allowed representations for a type.\n//   Binary data, JSON\n//   Compressed, uncompressed, maybe encrypted too.\n\n\n// Probably don't need subclasses for string or binary representations.\n//  Make this able to deal with both.\n//  String (kind of) is binary but likely uses UTF-8.\n\nclass Type_Representation {\n    // Name\n    //  Other options?\n    //  Disambiguiation? Descriptive text?\n    //    Or is naming them the main thing there?\n\n    // Color representation\n    //   And that is simple, does not go into internal representation.\n\n    // This should be able to represent types and lang features not available to JS.\n    //   Names may be optional? May be autogenerated and quite long?\n\n\n\n    constructor(spec = {}) {\n\n        // May be used on a lower level where the most suitable representation is selected.\n\n        // Generally:\n        //  string incl json\n        //  binary\n\n        // bridge the gap between numeric and binary.\n        //   make this ta-friendly and aware.\n\n        // represent components within a typed array? closely packed data structure?\n        \n\n        const name = spec.name;\n        Object.defineProperty(this, 'name', {\n            get() {\n                return name;\n            }\n        });\n\n        const parent = spec.parent;\n        Object.defineProperty(this, 'parent', {\n            get() {\n                return parent;\n            }\n        });\n\n        // Then the other fields?\n        //  Could have named fields.\n        //  Could have ordered fields?\n\n        const _ = {};\n\n        const map_reserved_property_names = {\n            'name': true\n        };\n\n        //  Even the number of bits being in here...?\n\n        each(spec, (value, name) => {\n            if (map_reserved_property_names[name]) {\n\n            } else {\n                _[name] = value;\n\n                // Could define the property here.\n                //  Read only (for the moment)\n\n                Object.defineProperty(this, name, {\n                    get() {\n                        return _[name];\n                    },\n                    enumerable: true\n                });\n\n\n            }\n        });\n        // Then a proxy to get other properties?\n    }\n    extend(o_extension) {\n\n        const o = {\n            parent: this\n        }\n        Object.assign(o, o_extension);\n        const res = new Type_Representation(o_extension);\n        return res;\n\n\n    }\n\n}\n\n// Will spell out some things in a quite verbose vanilla-js way here.\n//   Some higher level code will use types and other lang functionality to be less verbose and closer to English / the direct concepts.\n\n// Joins together 1 signifier and multiple representations.\n//   Name of item will be the signifier's name.\n\nclass Signifier_Representations_Type {\n    constructor(spec = {}) {\n        // 2 params in constructor? (signifier, arr_reps)???\n        //  could check for that.\n\n        if (spec.signifier && spec.representations) {\n\n            let signifier, arr_representations;\n\n            //if (spec.signifier) {\n            if (spec.signifier instanceof Type_Signifier) {\n                signifier = spec.signifier;\n            } else {\n                throw 'expected spec.signifier to be a Type_Signifier instance';\n            }\n            //}\n\n            if (tof(spec.representations) === 'array') {\n                let pass = true;\n                each(spec.representations, (representation, idx, stop) => {\n                    if (!(representation instanceof Type_Representation)) {\n                        pass = false;\n                        stop();\n                    }\n                })\n                if (pass) {\n                    arr_representations = spec.representations;\n                } else {\n                    throw 'Expected spec.representations to be an array of Type_Representation instances.';\n                }\n            }\n\n\n\n\n\n        } else {\n            throw 'Expected spec.signifier and spec.representations'\n        }\n\n        \n\n\n\n    }\n}\n\n\n\n\n\n\n// And could be subclasses of signification types...???\n\n// ui8 type signification?\n//   OK to signify that type, could indeed be represented with different actual values.\n//    such as as a string of decimal or hex digits.\n\n\n// Will have some basic / core types within lang-mini.\n//   Will not have a large amount of code.\n\n\n// Thematic types perhaps....\n//   seems like there could be overlap as well, eg image and document, text and document\n//   color, date/time, image, video, text, document, font, number, integer, floating point, string\n//     Type signifier could have theme property instead of or as well as name?\n//       Then representation of one thing as another. Represent a color as a number.\n\n// One advantage of putting in its own module is possible smaller file size.\n//   Though could possibly use lang-mini functionality as a platform for signifier and representer types.\n//   Type_Representer perhaps, not Type_Representation???\n//     Representation is probably the more accurate / better reading word.\n\n\n\n\nconst st_color = new Type_Signifier({'name': 'color'});\n\n// Signify an image. Signify a JPEG image. Etc.\n\n// then make a new one that extends st_color\n//   as in, a subtype.\nconst st_24bit_color = st_color.extend({'bits': 24});\n// Other types of 3 component color?\n\n//const st_24bit_rgb_color = st_24bit_color.extend({'components': ['red', 'green', 'blue']});\nconst st_24bit_rgb_color = st_24bit_color.extend({'components': ['red byte', 'green byte', 'blue byte']});\n//  or it already knows that these are bytes, when its 3 components in 24 bits.\n\n// st_24bit_rgb_color is only a signifier of 24 bit rgb color.\n//  Then there can be an implementation of it.\n//  Or a type (or class etc) could indicate it can handle it.\n\n// Type representation index could help.\n//   Query by name could return multiple items....\n//     Could have a property for the default representation with the name being searched for.\n\n\n\n\n\n\n// And have info about the properties by which it is represented?\n\nconst tr_string = new Type_Representation({'name': 'string'});\nconst tr_binary = new Type_Representation({'name': 'binary'}); // And could include number....\n// Numbers maybe extend binary.\n\n// And tr_ui8 even perhaps....\n\n\n\n\n// represent it as a binary sequence.\n//   Then could use more application specific tools like a Buffer or Typed Array.\n\n// Or extend the string type representation?\n\n// = tr_binary.extend();\n// trep maybe. and tsig or tsign.\n\n// Will make / finish some lower level components that interact with some specifically typed data.\n//   May well be worth doing more under 'grammar', getting type signifiers and type representations into the system.\n//     So far, types have been type representations. Now, they can be a signifier along with multiple representations.\n// A 'tags' type system of properties could help. Make it easy to specify / set up types.\n\n// Representation = Implementation (kind of)\n//   Or an interface.\n\n// Could use a Representation as an interface, in some cases.\n//   Inner representations as well\n//   Eg single color channel has a representation\n//     Would have a color name.\n//       Could even have a wavelength measurement for the color.\n\n// color channel 8 bit\n//   could use some language interpretation even. Some language processing could have the system 'understand' simple phrases describing\n//   type representations.\n\n// Actually using struct syntax for C++ or rust would be really good.\n//   Rust structs don't require fixed length strings in definition.\n\n// A struct being a Type_Representation, or Representational_Type.\n//   Dates can and do operate on different calendars.\n//     Same thing being signified, but with a different representation.\n// Diffent ways of representing strings and text. Now emojis too, they are part of unicode, and they keep getting updated.\n\n// Text characters are images that represent a letter or something else.\n//   They are symbols.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst rt_bin_24bit_rgb_color = new Type_Representation({\n    // A binary type representation.\n    'signifier': st_24bit_rgb_color,\n    'bytes': [\n        [0, 'red', 'ui8'],\n        [1, 'green', 'ui8'],\n        [2, 'blue', 'ui8']\n    ]\n});\n\n// Maybe do some work on a concise format for defining these types.\n// Maybe worth using or allowing the exact same syntax as C++ and/or rust for these stucts.\n//  Possibly some kind of syntax import. An example of how the same type of information can have different representations.\n\n\n\n\n// And an editor control could use a representation in terms of how it represents the data being edited to the user.\n\n// Binary type representation\nconst rt_hex_24bit_rgb_color = new Type_Representation({\n    // Likely some kind of string template.\n    //  Or a function?\n    //  Best to keep this function free here.\n    //  Or maybe make a few quite standard ones.\n    'signifier': st_24bit_rgb_color,\n\n    // Or could just have the sequence / template literal even.\n\n    'bytes': [\n        [0, '#', 'char'],\n        [1, 'hex(red)', 'string(2)'],\n        [3, 'hex(green)', 'string(2)'],\n        [5, 'hex(blue)', 'string(2)']\n    ]\n});\n\n// Year could be negative.\nconst st_date = new Type_Signifier({'name': 'date', 'components': ['day uint', 'month uint', 'year int']});\n// And datetime signification.\n\n// Approximate date ie date +- x years.\n\n\n// Just the date.\n\n\n\n//  or don't have the component types here?\n\n// String representation type.\n//  String_Type_Representation\n\n// Lots of different ways to represent a type.\n\n// Or say that they are numeric strings as well....\n\n// But a string char possibly takes more than 1 byte! Maybe not as defined here.\n//  String of int?\n//  Go into more details about how dates are represented?\n\n// Could consider JPEG to be a representation of Image.\n//   May want / need to think in terms of segments or blocks...\n//    segment_name = 'block' even. So it at least knows the right technical term.\n//   JPEG can have different versions, or subrepresentations.\n//     Type representations can have a supertype. That can be used with JPEG and then their versions are subtypes.\n//       A bit like the super-JPEG is a type representation of its own - except its got the details of the syntax.\n//     Want to make the overall system flexible in terms of what it represesnts, a fairly simple base structure.\n\n\n// Maybe make sections that define the representations just after the signifiers.\n//   Could have a fair few basic things defined.\n\n// Type Signifiers and Type Representations\n//   Think it could become an interesting book / programming topic.\n//   Could have implementations in a few languages too. Maybe suggestions for future languages and versions of them.\n\n// Make it its own module even?\n//   Could work better at a lower level.\n\n// srtypes module perhaps, or just srtype.\n// Coding with the distinction between signified and represented types could be really useful.\n//   Be able to handle serialization and deserialization (or format changes in some cases) 'for free', that is once the definitions\n//     have been made, the system will be able to convert between them (maybe requires some conversion functions to be written)\n//   System will have decent default type conversions.\n\n// Probably worth having set of 'standard' type definitions.\n//   System needs to be flexible so that they can be amended.\n\n\n\n\n\n\n\n\n\n\n\n\nconst rt_string_date_uk_ddmmyy = new Type_Representation({\n    'signifier': st_date,\n    'bytes': [\n        [0, '#', 'char'],\n        [1, 'day', 'string(2)'],\n        [3, '/', 'char'],\n        [4, 'month', 'string(2)'],\n        [6, '/', 'char'],\n        [7, 'year', 'string(2)']\n    ]\n});\n\n// Extra rules or restrictions? Defaults eg year 38 is 2038 etc...\n\n\n// A types registry could help.\n//  Registry of signified types\n//  Registry of type representations.\n//   Meaning 1 'type' in this system can be represented in multiple different ways.\n\n// Then the infrastructure within control declaration...\n//   Though likely will use the .model and .view mixins for this.\n//   Views (or controls?) will be made so that the model is a specific representation of a signified type.\n//     Or one a a few supported representations.\n//     Eg a color palette working for monochrome (8bit color depth).\n//       Or a color palette could allow selection of multiple colors.\n\n// Color_Chooser perhaps being simpler?\n//   Color_Palette seems like it should be able to deal with a bunch of different ways in which the data could be represented\n//     either in the app as the user interacts with it, in app memory, in transmission, in storage.\n\n\n\n\n\n\n\n\n\n\n// There could be quite a lot of these type representations.\n\n\n\n// Can have plenty of ways of representing a date. Fewer ways of signifying one.\n\n\n// To signify something is in some ways less than to represent it.\n//   Signification is only about saying that it is there.\n\n// Maybe have a nice UI app to set up the signifier / representer links.\n\n\n\n\n\n// A moderate amount of data type representation info would help get JSGUI controls working nicely on the specific types\n//   of data they are supposed to interact with.\n\n// Ways of getting the data in and out of typed arrays\n//   Typed array (or buffer?) access for these data types?\n\n// Could make some nice GUI components (controls) for selecing / editing dates and colors.\n//   Can do it in a way that avoids code repetition.\n//   Make it so that the controls are able to represent the type on the screen.\n\n\n\n\n\n \n// These types seem most useful for the types that the user interacts with and putting the type knowledge into the GUI.\n\n// Type registry makes sense too.\n//  jsgui.types perhaps / lang.types\n//   An index of types? Collection of them?\n\n// Also registry of controls that are set up for dealing with specific types?\n//   Being able to identify and use variety of representations.\n\n// May integrate this into image format work - or make this good so that image format work can use this as a platform.\n\n\n\n\n\n\n\n\n\n// and then day, month, year components\n\n\n\n\n// day, month year\n\n\n\n// or 'hexdigit(2)' maybe.\n\n// And the Control could conveniently show and allow editing of values using different representations.\n//   Such as a hex representation, or hex representations for comonents.\n\n// A Control could be aware of, and use both representations of a Data_Type.\n//   Color Palette seems like the right place to use that more advanced and general purpose functionality.\n//     Will work well for some imaging tools as well too.\n\n\n// More functional composition of controls could be cool....\n//   But let's make / improve the color palette.\n//     Moving the data outside it could work too.\n//     Consts directory. Or basis. Basics.\n\n\n\n// Have a class / instance of one that tracks ie is a DB for the type representations and significations.\n\n\n\n\n\n\n\n\n\n\n\n// Then put that within an array? 32 bit number used as 24 bit?\n\n\n// Though it may be most/least significant in some cases.\n\n\n\n\n// Then create a representation of 24 bit rgb color where it's the 3 components as bytes.\n//   Could be deduced from what we have already. May be easy enough to get from the Type_Signifier to this.\n//     However, will then have representations of the individual components too....\n//     Perhaps represent the whole thing as a string. eg #RRGGBB color for HTML. Or as items in an array.\n//       Even representing them as items within a typed array.\n\n\n// Allowing multiple representations of the same things.\n//   Representation sets - so we know which representations as (almost? totally?) interchangable.\n//   Can choose different default representations depending on performance.\n\n// Or implementation sets? Prefer representation here to describe how the types are represented rather than other connotations\n//   such as code for operators.\n\n//console.log('st_color', st_color);\n\nlang.Type_Signifier = Type_Signifier;\nlang.Type_Representation = Type_Representation;\n\n\n\n\n// Let's make something a little simpler and focused on representing the types of data in Data_Model classes.\n//   Control is such a class through inheritance, it extends Data_Object.\n\n// nfdt new functional data type function....?\n\n\n\n\n\n\n\n// The representation type is a way to represent something\n//   What is being represented? That is all within a signifier type.\n\n// Or Implementation_Type? As in that is concrete in terms of how it is represented.\n// Representation_Implementation_Type???\n\n\n\n\n\n\n\nmodule.exports = lang;", "// Field\r\n// Prop\r\n\r\n// put this in lang-mini?\r\n\r\n// Validate and transform in one function?\r\n//  Throws an exception then it's a validation error.\r\n\r\n// Relatively simple and powerful functionality here.\r\n//   Could put within lang-mini????\r\n\r\n\r\nconst {\r\n\teach,\r\n\tget_a_sig,\r\n\tdef,\r\n\tis_array,\r\n\ttof,\r\n\ttf\r\n} = require(\"lang-mini\");\r\n\r\nconst ifn = item => typeof item === \"function\";\r\nconst ia = is_array;\r\n\r\nconst get_instance = function () {\r\n\r\n\tconst opts = {\r\n\t\traise_change_events: true\r\n\t}\r\n\r\n\r\n\t// Maybe use MFP for this too?\r\n\t//  Worth benchmarking before and after. mfp not benchmarked yet.\r\n\r\n\tconst states = (obj, states) => {\r\n\t\t// set the states\r\n\t\t// set / get the state by name\r\n\t\t// set / get the states by index\r\n\t\t// alternate / toggle between states\r\n\t};\r\n\r\n\t// add the db field data\r\n\r\n\r\n\t// uses ._[name]\r\n\r\n\t// Maybe move field to lang-mini.\r\n\t//   Maybe want to be able to apply \r\n\r\n\r\n\t// Should make the prop_name work as an array for aliases.\r\n\r\n\t// But field makes use of 'prop'.\r\n\t//   Moving this entirely to lang-mini may help. Then in lang-mini can integrate it with data type and grammar.\r\n\r\n\r\n\t// Field has a nicer / simpler API than prop it seems, but it internally makes use of prop.\r\n\t//   May look further into using prop....\r\n\r\n\t// raise_change_events being an option....?\r\n\r\n\t\r\n\r\n\r\n\tconst get_set = (obj, prop_name, fn_get, fn_set) => {\r\n\t\tconst def = {\r\n\t\t\t// Using shorthand method names (ES2015 feature).\r\n\t\t\t// This is equivalent to:\r\n\t\t\t// get: function() { return bValue; },\r\n\t\t\t// set: function(newValue) { bValue = newValue; },\r\n\t\t\tget: fn_get,\r\n\t\t\tset: fn_set,\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: false\r\n\t\t}\r\n\r\n\t\tconst t_prop_name = tf(prop_name);\r\n\t\tif (t_prop_name === 'a') {\r\n\t\t\teach(prop_name, name => Object.defineProperty(obj, name, def));\r\n\t\t} else if (t_prop_name === 's') {\r\n\t\t\tObject.defineProperty(obj, prop_name, def);\r\n\t\t} else {\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Unexpected prop_name, must be array or string';\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\r\n\t// Should make the prop_name work as an array for aliases.\r\n\tconst read_only = (obj, prop_name, fn_get) => {\r\n\t\t/*\r\n\t\t  Object.defineProperty(obj, prop_name, {\r\n\t\t      get() {\r\n\t\t          return fn_get();\r\n\t\t      }\r\n\t\t  });\r\n\t\t  */\r\n\r\n\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: fn_get\r\n\t\t});\r\n\t};\r\n\r\n\r\n\t// prop is a bit like field. Somewhat more complicated. Not sure how much it gets used in jsgui3 or other code.\r\n\t//   Maybe change / improve it.\r\n\t//     Seems like very large overlap with 'field', could introduce more capabilities like tranformation functions.\r\n\t//   field.validator = \r\n\t//   field.input_transformer = \r\n\t//   field.input.transformer = ...\r\n\t//   field.input.validator = ....\r\n\r\n\t// field.security = ....?\r\n\t//   which users have access? which components in the webapp have access?\r\n\r\n\r\n\r\n\tconst prop = (...a) => {\r\n\t\t// ...args?\r\n\t\tlet s = get_a_sig(a);\r\n\t\tif (s === \"[a]\") {\r\n\t\t\teach(a[0], item_params => {\r\n\t\t\t\tprop.apply(this, item_params);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (a.length === 2) {\r\n\t\t\t\tif (ia(a[1])) {\r\n\t\t\t\t\tconst target = a[0];\r\n\t\t\t\t\teach(a[1], item => {\r\n\t\t\t\t\t\tif (ia(item)) {\r\n\t\t\t\t\t\t\tthrow \"NYI 468732\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tprop(target, item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst ta1 = tof(a[1]);\r\n\t\t\t\t\tif (ta1 === \"string\") {\r\n\t\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow \"NYI 468732b\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (a.length > 2) {\r\n\t\t\t\tif (ia(a[0])) {\r\n\t\t\t\t\t// the rest of the properties applied to the array of items.\r\n\t\t\t\t\tthrow \"stop\";\r\n\t\t\t\t\tlet objs = a.shift();\r\n\t\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\t\tprop.apply(this, [obj].concat(item_params)); // bug\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet obj, prop_name, default_value, fn_onchange, fn_transform, fn_on_ready, options;\r\n\t\t\t\t\tconst load_options = options => {\r\n\t\t\t\t\t\tprop_name = prop_name || options.name || options.prop_name;\r\n\t\t\t\t\t\tfn_onchange =\r\n\t\t\t\t\t\t\toptions.fn_onchange || options.onchange || options.change;\r\n\t\t\t\t\t\tfn_transform =\r\n\t\t\t\t\t\t\toptions.fn_transform || options.ontransform || options.transform;\r\n\t\t\t\t\t\tfn_on_ready = options.ready || options.on_ready;\r\n\t\t\t\t\t\tdefault_value = default_value || options.default_value || options.default;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t\t[obj, options] = a;\r\n\t\t\t\t\t\tload_options(options);\r\n\t\t\t\t\t} else if (a.length === 3) {\r\n\t\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, fn_onchange] = a;\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tif (a[2] !== undefined && (a[2].change || a[2].ready)) {\r\n\t\t\t\t\t\t\t\tload_options(a[2]);\r\n\r\n\t\t\t\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t\t} else if (a.length === 4) {\r\n\t\t\t\t\t\tif (ifn(a[2]) && ifn(a[3])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, fn_transform, fn_onchange] = a;\r\n\t\t\t\t\t\t} else if (ifn(a[3])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value, fn_onchange] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value, options] = a;\r\n\t\t\t\t\t\t\tload_options(options);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (a.length === 5) {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_transform, fn_onchange] = a;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _prop_value;\r\n\r\n\t\t\t\t\tif (typeof default_value !== 'undefined') _prop_value = default_value;\r\n\t\t\t\t\t// And a silent set function that does not raise the change event.\r\n\t\t\t\t\tconst _silent_set = value => {\r\n\t\t\t\t\t\tlet _value;\r\n\t\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst _set = value => {\r\n\t\t\t\t\t\tlet _value;\r\n\t\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet old = _prop_value;\r\n\t\t\t\t\t\t_prop_value = _value;\r\n\t\t\t\t\t\tif (fn_onchange) {\r\n\t\t\t\t\t\t\tfn_onchange({\r\n\t\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (obj.raise && opts.raise_change_events) {\r\n\t\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\t\tvalue: _prop_value\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (def(default_value)) {\r\n\t\t\t\t\t\t_prop_value = default_value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst t_prop_name = tf(prop_name);\r\n\t\t\t\t\tif (t_prop_name === 's') {\r\n\r\n\t\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t} else if (t_prop_name === 'a') {\r\n\t\t\t\t\t\tconst l = prop_name.length;\r\n\t\t\t\t\t\t//console.log('prop_name', prop_name);\r\n\t\t\t\t\t\tlet item_prop_name;\r\n\t\t\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\t\t\titem_prop_name = prop_name[c];\r\n\t\t\t\t\t\t\t//console.log('item_prop_name', item_prop_name);\r\n\t\t\t\t\t\t\tObject.defineProperty(obj, item_prop_name, {\r\n\t\t\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\t\t\treturn _prop_value;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t\t\t_set(value);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow 'Unexpected name type: ' + t_prop_name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fn_on_ready) {\r\n\t\t\t\t\t\tfn_on_ready({\r\n\t\t\t\t\t\t\tsilent_set: _silent_set\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst field = (...a) => {\r\n\r\n\t\t// Uses obj._\r\n\t\t//   Seems quite simple, powerful, flexible.\r\n\t\t//     However, would like a different way of doing it too, could use a local variable defined within the 'field' function.\r\n\r\n\r\n\r\n\t\tlet s = get_a_sig(a);\r\n\t\tif (s === \"[a]\") {\r\n\t\t\t// prop????\r\n\t\t\teach(a[0], item_params => {\r\n\t\t\t\tprop.apply(this, item_params);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (a.length > 1) {\r\n\t\t\t\tif (ia(a[0])) {\r\n\t\t\t\t\t// the rest of the properties applied to the array of items.\r\n\t\t\t\t\tlet objs = a.shift();\r\n\t\t\t\t\teach(objs, obj => {\r\n\t\t\t\t\t\tprop.apply(this, [obj].concat(item_params));\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet obj, prop_name, default_value, fn_transform;\r\n\t\t\t\t\tlet raise_change_events = opts.raise_change_events;\r\n\t\t\t\t\tif (a.length === 2) {\r\n\t\t\t\t\t\t[obj, prop_name] = a;\r\n\t\t\t\t\t} else if (a.length === 3) {\r\n\t\t\t\t\t\tif (ifn(a[2])) {\r\n\t\t\t\t\t\t\t[obj, prop_name, fn_transform] = a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (a.length === 4) {\r\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_transform] = a;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (obj !== undefined) {\r\n\t\t\t\t\t\tObject.defineProperty(obj, prop_name, {\r\n\t\t\t\t\t\t\tget() {\r\n\t\t\t\t\t\t\t\tif (def(obj._)) {\r\n\t\t\t\t\t\t\t\t\treturn obj._[prop_name];\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//return _prop_value;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tset(value) {\r\n\t\t\t\t\t\t\t\t//console.log('setting prop: ' + prop_name);\r\n\t\t\t\t\t\t\t\tlet old = (obj._ = obj._ || {})[prop_name];\r\n\t\t\t\t\t\t\t\t// value must be an array of length 2.\r\n\t\t\t\t\t\t\t\tlet _value;\r\n\t\t\t\t\t\t\t\tif (fn_transform) {\r\n\t\t\t\t\t\t\t\t\t//try {\r\n\t\t\t\t\t\t\t\t\t_value = fn_transform(value);\r\n\t\t\t\t\t\t\t\t\t//} catch (err) {\r\n\t\t\t\t\t\t\t\t\t//    throw err;\r\n\t\t\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t_value = value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tobj._[prop_name] = _value;\r\n\t\t\t\t\t\t\t\tif (raise_change_events) {\r\n\t\t\t\t\t\t\t\t\tobj.raise(\"change\", {\r\n\t\t\t\t\t\t\t\t\t\tname: prop_name,\r\n\t\t\t\t\t\t\t\t\t\told: old,\r\n\t\t\t\t\t\t\t\t\t\tvalue: _value\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (def(default_value)) {\r\n\t\t\t\t\t\t\t(obj._ = obj._ || {})[prop_name] = default_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow 'stop';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// could return a function get_instance, with those functions merged.\r\n\treturn {\r\n\t\topts, // module level options\r\n\t\tprop,\r\n\t\tfield,\r\n\t\tread_only,\r\n\t\tro: read_only,\r\n\t\tget_set,\r\n\t\tgs: get_set\r\n\t};\r\n};\r\nmodule.exports = get_instance();\r\n\r\n\r\n\r\n", "const jsgui = require('lang-tools');\r\nconst oext = require('obext');\r\nconst {Data_Model, Data_Object, Collection, tof, stringify, get_a_sig, each, Evented_Class } = jsgui;\r\nconst Text_Node = require('./text-node');\r\nconst {\r\n\tprop,\r\n\tfield\r\n} = require('obext');\r\nvar px_handler = (target, property, value, receiver) => {\r\n\tlet res;\r\n\tvar t_val = tof(value);\r\n\tif (t_val === 'number') {\r\n\t\tres = value + 'px';\r\n\t} else if (t_val === 'string') {\r\n\t\tvar match = value.match(/(\\d*\\.?\\d*)(.*)/);\r\n\t\tif (match.length === 2) {\r\n\t\t\tres = value + 'px';\r\n\t\t} else {\r\n\t\t\tres = value;\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n}\r\nvar style_input_handlers = {\r\n\t'width': px_handler,\r\n\t'height': px_handler,\r\n\t'left': px_handler,\r\n\t'top': px_handler\r\n}\r\nvar new_obj_style = () => {\r\n\tlet style = new Evented_Class({});\r\n\tstyle.__empty = true;\r\n\tstyle.toString = () => {\r\n\t\tvar res = [];\r\n\t\tvar first = true;\r\n\t\teach(style, (value, key) => {\r\n\t\t\tconst tval = typeof value;\r\n\t\t\tif (tval !== 'function' && key !== 'toString' && key !== '__empty' && key !== '_bound_events' && key !== 'on' && key !== 'subscribe' && key !== 'raise' && key !== 'trigger') {\r\n\t\t\t\tif (first) {\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres.push(' ');\r\n\t\t\t\t}\r\n\t\t\t\tres.push(key + ': ' + value + ';');\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res.join('');\r\n\t}\r\n\tconst res = new Proxy(style, {\r\n\t\tset: (target, property, value, receiver) => {\r\n\t\t\tlet res;\r\n\t\t\ttarget['__empty'] = false;\r\n\t\t\tvar old_value = target[property];\r\n\t\t\tif (style_input_handlers[property]) {\r\n\t\t\t\tres = target[property] = style_input_handlers[property](target, property, value, receiver);\r\n\t\t\t} else {\r\n\t\t\t\tres = target[property] = value;\r\n\t\t\t}\r\n\t\t\tstyle.raise('change', {\r\n\t\t\t\t'key': property,\r\n\t\t\t\t'name': property,\r\n\t\t\t\t'old': old_value,\r\n\t\t\t\t'new': value,\r\n\t\t\t\t'value': value\r\n\t\t\t});\r\n\t\t\treturn res;\r\n\t\t},\r\n\t\tget: (target, property, receiver) => {\r\n\t\t\tif (property === 'toString') {\r\n\t\t\t\treturn () => target + '';\r\n\t\t\t} else {\r\n\t\t\t\treturn target[property];\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn res;\r\n}\r\nclass DOM_Attributes extends Evented_Class {\r\n\tconstructor(spec) {\r\n\t\tsuper(spec);\r\n\t\tthis.style = new_obj_style();\r\n\t\tthis.style.on('change', e_change => {\r\n\t\t\tthis.raise('change', {\r\n\t\t\t\t'property': 'style',\r\n\t\t\t\t'key': 'style',\r\n\t\t\t\t'name': 'style',\r\n\t\t\t\t'value': this.style.toString()\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n}\r\nclass Control_DOM extends Evented_Class {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tvar dom_attributes = new DOM_Attributes();\r\n\t\tvar attrs = this.attrs = this.attributes = new Proxy(dom_attributes, {\r\n\t\t\t'set': (target, property, value, receiver) => {\r\n\t\t\t\tif (property === 'style') {\r\n\t\t\t\t\tvar t_value = tof(value);\r\n\t\t\t\t\tif (t_value === 'string') {\r\n\t\t\t\t\t\tvar s_values = value.trim().split(';');\r\n\t\t\t\t\t\tvar kv;\r\n\t\t\t\t\t\teach(s_values, (s_value) => {\r\n\t\t\t\t\t\t\tkv = s_value.split(':');\r\n\t\t\t\t\t\t\tif (kv.length === 2) {\r\n\t\t\t\t\t\t\t\tkv[0] = kv[0].trim();\r\n\t\t\t\t\t\t\t\tkv[1] = kv[1].trim();\r\n\t\t\t\t\t\t\t\ttarget.style[kv[0]] = kv[1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tdom_attributes.raise('change', {\r\n\t\t\t\t\t\t\t'property': property\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar old_value = target[property];\r\n\t\t\t\t\ttarget[property] = value;\r\n\t\t\t\t\tdom_attributes.raise('change', {\r\n\t\t\t\t\t\t'key': property,\r\n\t\t\t\t\t\t'name': property,\r\n\t\t\t\t\t\t'old': old_value,\r\n\t\t\t\t\t\t'new': value,\r\n\t\t\t\t\t\t'value': value\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tget: (target, property, receiver) => {\r\n\t\t\t\treturn target[property];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nclass Control_Background extends Evented_Class {\r\n\tconstructor(spec = {}) {\r\n\t\tsuper(spec);\r\n\t\tlet _color, _opacity;\r\n\t\tObject.defineProperty(this, 'color', {\r\n\t\t\tget() {\r\n\t\t\t\treturn _color;\r\n\t\t\t},\r\n\t\t\tset(value) {\r\n\t\t\t\tconst old = _color;\r\n\t\t\t\t_color = value;\r\n\t\t\t\tthis.raise('change', {\r\n\t\t\t\t\t'name': 'color',\r\n\t\t\t\t\t'old': old,\r\n\t\t\t\t\t'new': _color,\r\n\t\t\t\t\t'value': _color\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t}\r\n\tset(val) {}\r\n}\r\nclass Control_Core extends Data_Object {\r\n\tconstructor(spec = {}, fields) {\r\n\t\tspec.__type_name = spec.__type_name || 'control';\r\n\t\tsuper(spec, fields);\r\n\t\tif (spec.id) {\r\n\t\t\tthis.__id = spec.id;\r\n\t\t}\r\n\t\tif (spec.__id) {\r\n\t\t\tthis.__id = spec.__id;\r\n\t\t}\r\n\t\tthis.mapListeners = {};\r\n\t\tthis.__type = 'control';\r\n\t\tvar spec_content;\r\n\t\tlet d = this.dom = new Control_DOM();\r\n\t\tprop(this, 'background', new Control_Background(), (e_change) => {\r\n\t\t\tlet {\r\n\t\t\t\tvalue\r\n\t\t\t} = e_change;\r\n\t\t});\r\n\t\tthis.background.on('change', evt => {\r\n\t\t\tif (evt.name === 'color') {\r\n\t\t\t\td.attributes.style['background-color'] = evt.value;\r\n\t\t\t}\r\n\t\t});\r\n\t\tprop(this, 'disabled', false);\r\n\t\tprop(this, 'size', spec.size, (e_change) => {\r\n\t\t\tlet {\r\n\t\t\t\tvalue,\r\n\t\t\t\told\r\n\t\t\t} = e_change;\r\n\t\t\tlet [width, height] = value;\r\n\t\t\tconst s = this.dom.attrs.style;\r\n\t\t\ts.width = width;\r\n\t\t\ts.height = height;\r\n\t\t\tthis.raise('resize', {\r\n\t\t\t\t'value': value\r\n\t\t\t});\r\n\t\t});\r\n\t\tprop(this, 'pos', undefined, (e_change) => {\r\n\t\t\tlet {\r\n\t\t\t\tvalue,\r\n\t\t\t\told\r\n\t\t\t} = e_change;\r\n\t\t\tif (value.length === 2) {\r\n\t\t\t}\r\n\t\t\tlet [left, top] = value;\r\n\t\t\tlet o_style = {\r\n\t\t\t\t'left': left,\r\n\t\t\t\t'top': top\r\n\t\t\t}\r\n\t\t\tthis.style(o_style);\r\n\t\t\tthis.raise('move', {\r\n\t\t\t\t'value': value\r\n\t\t\t});\r\n\t\t});\r\n\t\tif (spec.pos) this.pos = spec.pos;\r\n\t\tthis.on('change', e => {\r\n\t\t\tif (e.name === 'disabled') {\r\n\t\t\t\tif (e.value === true) {\r\n\t\t\t\t\tthis.add_class('disabled');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.remove_class('disabled');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tlet tagName = spec.tagName || spec.tag_name || 'div';\r\n\t\td.tagName = tagName;\r\n\t\tvar content = this.content = new Collection({});\r\n\t\tspec_content = spec.content;\r\n\t\tif (spec_content) {\r\n\t\t\tvar tsc = tof(spec_content);\r\n\t\t\tif (tsc === 'array') {\r\n\t\t\t\teach(spec.content, item => {\r\n\t\t\t\t\tcontent.add(item);\r\n\t\t\t\t})\r\n\t\t\t} else if (tsc === 'string' || tsc === 'control') {\r\n\t\t\t\tcontent.add(spec_content);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (spec.el) {\r\n\t\t\td.el = spec.el;\r\n\t\t\tif (spec.el.tagName) d.tagName = spec.el.tagName.toLowerCase();\r\n\t\t}\r\n\t\tvar context = this.context || spec.context;\r\n\t\tif (context) {\r\n\t\t\tif (context.register_control) context.register_control(this);\r\n\t\t} else {}\r\n\t\tif (spec['class']) {\r\n\t\t\tthis.add_class(spec['class']);\r\n\t\t}\r\n\t\tif (spec['css_class']) {\r\n\t\t\tthis.add_class(spec['css_class']);\r\n\t\t}\r\n\t\tif (spec['cssClass']) {\r\n\t\t\tthis.add_class(spec['cssClass']);\r\n\t\t}\r\n\t\tif (spec.hide) {\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\tif (spec.add) {\r\n\t\t\tthis.add(spec.add);\r\n\t\t}\r\n\t\tif (spec.attrs) {\r\n\t\t\tthis.dom.attributes = spec.attrs;\r\n\t\t}\r\n\t}\r\n\tget left() {\r\n\t\tconst sl = this.dom.attributes.style.left;\r\n\t\tif (sl) {\r\n\t\t\treturn parseInt(sl) + this.ta[6];\r\n\t\t}\r\n\t}\r\n\tget top() {\r\n\t\tconst st = this.dom.attributes.style.top;\r\n\t\tif (st) {\r\n\t\t\treturn parseInt(st) + this.ta[7];\r\n\t\t}\r\n\t}\r\n\tset top(value) {\r\n\t\tif (typeof value === 'number') {\r\n\t\t\tconst measured_current_top = this.top;\r\n\t\t\tconst diff = Math.round(value - measured_current_top);\r\n\t\t\tthis.ta[7] += diff;\r\n\t\t}\r\n\t}\r\n\t'hide'() {\r\n\t\tlet e = {\r\n\t\t\tcancelDefault: false\r\n\t\t}\r\n\t\tthis.raise('hide', e)\r\n\t\tif (!e.cancelDefault) {\r\n\t\t\tthis.add_class('hidden');\r\n\t\t}\r\n\t}\r\n\t'show'() {\r\n\t\tlet e = {\r\n\t\t\tcancelDefault: false\r\n\t\t}\r\n\t\tthis.raise('show', e);\r\n\t\tif (!e.cancelDefault) {\r\n\t\t\tthis.remove_class('hidden');\r\n\t\t}\r\n\t}\r\n\tget html() {\r\n\t\treturn this.all_html_render();\r\n\t}\r\n\tget internal_relative_div() {\r\n\t\treturn this._internal_relative_div || false;\r\n\t}\r\n\tset internal_relative_div(value) {\r\n\t\tvar old_value = this._internal_relative_div;\r\n\t\tthis._internal_relative_div = value;\r\n\t\tif (value === true) {}\r\n\t}\r\n\tget color() {\r\n\t\treturn this.background.color;\r\n\t}\r\n\tset color(value) {\r\n\t\tthis.background.color = value;\r\n\t}\r\n\t'post_init'(spec) {\r\n\t\tif (spec && spec.id === true) {\r\n\t\t\tthis.dom.attrs.id = this._id();\r\n\t\t}\r\n\t}\r\n\t'has'(item_name) {\r\n\t\tvar arr = item_name.split('.');\r\n\t\tvar c = 0,\r\n\t\t\tl = arr.length;\r\n\t\tvar i = this;\r\n\t\tvar s;\r\n\t\twhile (c < l) {\r\n\t\t\ts = arr[c];\r\n\t\t\tif (typeof i[s] == 'undefined') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\ti = i[s];\r\n\t\t\tc++;\r\n\t\t};\r\n\t\treturn i;\r\n\t}\r\n\t'renderDomAttributes'() {\r\n\t\tif (this.beforeRenderDomAttributes) {\r\n\t\t\tthis.beforeRenderDomAttributes();\r\n\t\t}\r\n\t\tvar dom_attrs = this.dom.attributes;\r\n\t\tif (!dom_attrs) {\r\n\t\t\tthrow 'expecting dom_attrs';\r\n\t\t} else {\r\n\t\t\tif (this._) {\r\n\t\t\t\tvar keys = Object.keys(this._);\r\n\t\t\t\tvar key;\r\n\t\t\t\tfor (var c = 0, l = keys.length; c < l; c++) {\r\n\t\t\t\t\tkey = keys[c];\r\n\t\t\t\t\tif (key !== '_bound_events') {\r\n\t\t\t\t\t\tif (key instanceof Control_Core) {\r\n\t\t\t\t\t\t\t(this._ctrl_fields = this._ctrl_fields || {})[key] = this._[key];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._fields = this._fields || {};\r\n\t\t\t\t\t\t\tthis._fields[key] = this._[key];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._ctrl_fields) {\r\n\t\t\t\tvar obj_ctrl_fields = {};\r\n\t\t\t\tvar keys = Object.keys(this._ctrl_fields);\r\n\t\t\t\tvar key;\r\n\t\t\t\tfor (var c = 0, l = keys.length; c < l; c++) {\r\n\t\t\t\t\tkey = keys[c];\r\n\t\t\t\t\tif (key !== '_bound_events') {\r\n\t\t\t\t\t\tobj_ctrl_fields[key] = this._ctrl_fields[key]._id();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet scf = stringify(obj_ctrl_fields).replace(/\"/g, \"'\");\r\n\t\t\t\tif (scf.length > 2) {\r\n\t\t\t\t\tdom_attrs['data-jsgui-ctrl-fields'] = scf;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._fields) {\r\n\t\t\t\tlet sf = stringify(this._fields).replace(/\"/g, \"'\");\r\n\t\t\t\tif (sf.length > 2) {\r\n\t\t\t\t\tdom_attrs['data-jsgui-fields'] = sf;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Then will get these back in activate / pre-activate.\r\n\t\t\t//   Or post-activate even?\r\n\r\n\t\t\t// Pre seems best. Or the autoactivate part of the activate process.\r\n\r\n\r\n\t\t\tif (this.view.data.model.mixins) {\r\n\t\t\t\tlet smxs = '[';\r\n\t\t\t\tlet first = true;\r\n\t\t\t\tthis.view?.data?.model?.mixins?.each((mx) => {\r\n\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\tsmxs += ',';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfirst = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst smx = JSON.stringify(mx);\r\n\t\t\t\t\tsmxs += smx;\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\tsmxs += ']';\r\n\t\t\t\tsmxs = smxs.replace(/\"/g, \"'\");\r\n\t\t\t\tif (smxs.length > 2) {\r\n\t\t\t\t\tdom_attrs['data-jsgui-mixins'] = smxs;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t// is this.\r\n\r\n\t\t\t// mixins as well?\r\n\t\t\t//   or within ._fields?\r\n\r\n\t\t\t// a separate ._mixins property would help.\r\n\r\n\r\n\r\n\r\n\t\t\tconst arr = [];\r\n\t\t\tconst id = this._id();\r\n\t\t\tif (id !== undefined) {\r\n\t\t\t\tarr.push(' data-jsgui-id=\"' + this._id() + '\"');\r\n\t\t\t}\r\n\t\t\tif (this.data && this.data._model instanceof Data_Model) {\r\n\t\t\t\tconst dmid = this.data._model.__id;\r\n\t\t\t\tif (dmid) {\r\n\t\t\t\t\tarr.push(' data-jsgui-data-model-id=\"' + dmid + '\"');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst exempt_types = {\r\n\t\t\t\thtml: true,\r\n\t\t\t\thead: true,\r\n\t\t\t\tbody: true\r\n\t\t\t}\r\n\t\t\tif (this.context && this.__type_name) {\r\n\t\t\t\tif (!exempt_types[this.__type_name] && this.__type_name !== undefined) {\r\n\t\t\t\t\tarr.push(' data-jsgui-type=\"' + this.__type_name + '\"');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar dom_attrs_keys = Object.keys(dom_attrs);\r\n\t\t\tvar key, item;\r\n\t\t\tfor (var c = 0, l = dom_attrs_keys.length; c < l; c++) {\r\n\t\t\t\tkey = dom_attrs_keys[c];\r\n\t\t\t\tif (key == '_bound_events') {} else if (key === 'style') {\r\n\t\t\t\t\titem = dom_attrs[key];\r\n\t\t\t\t\tif (typeof item !== 'function') {\r\n\t\t\t\t\t\tif (typeof item === 'object') {\r\n\t\t\t\t\t\t\tif (key === 'style') {\r\n\t\t\t\t\t\t\t\tconst sprops = [];\r\n\t\t\t\t\t\t\t\teach(item, (v, k) => {\r\n\t\t\t\t\t\t\t\t\tconst tval = typeof v;\r\n\t\t\t\t\t\t\t\t\tif (tval !== 'function') {\r\n\t\t\t\t\t\t\t\t\t\tif (k !== '__empty') {\r\n\t\t\t\t\t\t\t\t\t\t\tconst sprop = k + ':' + v;\r\n\t\t\t\t\t\t\t\t\t\t\tsprops.push(sprop);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tif (sprops.length > 0) arr.push(' ', key, '=\"', sprops.join(';'), '\"');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\t\tthrow 'NYI';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet is = item.toString();\r\n\t\t\t\t\t\t\tif (!item.__empty && is.length > 0) {\r\n\t\t\t\t\t\t\t\tarr.push(' ', key, '=\"', is, '\"');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem = dom_attrs[key];\r\n\t\t\t\t\tif (item && item.toString) {\r\n\t\t\t\t\t\tarr.push(' ', key, '=\"', item.toString(), '\"');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn arr.join('');\r\n\t\t}\r\n\t}\r\n\t'renderBeginTagToHtml'() {\r\n\t\tconst tagName = this.dom.tagName;\r\n\t\tvar res;\r\n\t\tif (tagName === false) {\r\n\t\t\tres = '';\r\n\t\t} else {\r\n\t\t\tres = ['<', tagName, this.renderDomAttributes(), '>'].join('');\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'renderEndTagToHtml'() {\r\n\t\tvar res;\r\n\t\tconst tagName = this.dom.tagName;\r\n\t\tconst noClosingTag = this.dom.noClosingTag;\r\n\t\tif (tagName === false || noClosingTag) {\r\n\t\t\tres = '';\r\n\t\t} else {\r\n\t\t\tres = ['</', tagName, '>'].join('');\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'renderHtmlAppendment'() {\r\n\t\treturn this.htmlAppendment || '';\r\n\t}\r\n\t'renderEmptyNodeJqo'() {\r\n\t\treturn [this.renderBeginTagToHtml(), this.renderEndTagToHtml(), this.renderHtmlAppendment()].join('');\r\n\t}\r\n\t'register_this_and_subcontrols'() {\r\n\t\tconst context = this.context;\r\n\t\tthis.iterate_this_and_subcontrols((ctrl) => {\r\n\t\t\tcontext.register_control(ctrl);\r\n\t\t});\r\n\t}\r\n\t'iterate_subcontrols'(ctrl_callback) {\r\n\t\tconst content = this.content;\r\n\t\tcontent.each(v => {\r\n\t\t\tctrl_callback(v);\r\n\t\t\tif (v && v.iterate_subcontrols) {\r\n\t\t\t\tv.iterate_subcontrols(ctrl_callback);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'iterate_this_and_subcontrols'(ctrl_callback) {\r\n\t\tctrl_callback(this);\r\n\t\tconst content = this.content;\r\n\t\tlet tv;\r\n\t\tif (typeof content !== 'string') {\r\n\t\t\tcontent.each(v => {\r\n\t\t\t\ttv = tof(v);\r\n\t\t\t\tif (tv == 'string') {} else if (tv == 'data_value') {} else {\r\n\t\t\t\t\tif (v && v.iterate_this_and_subcontrols) {\r\n\t\t\t\t\t\tv.iterate_this_and_subcontrols(ctrl_callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t'all_html_render'(callback) {\r\n\t\tif (callback) {\r\n\t\t\tvar arr_waiting_controls = [];\r\n\t\t\tthis.iterate_this_and_subcontrols((control) => {\r\n\t\t\t\tif (control.__status == 'waiting') arr_waiting_controls.push(control);\r\n\t\t\t});\r\n\t\t\tif (arr_waiting_controls.length == 0) {\r\n\t\t\t\tcallback(null, this.all_html_render());\r\n\t\t\t} else {\r\n\t\t\t\tvar c = arr_waiting_controls.length;\r\n\t\t\t\tvar complete = () => {\r\n\t\t\t\t\tthis.pre_all_html_render();\r\n\t\t\t\t\tvar dom = this.dom;\r\n\t\t\t\t\tif (dom) {\r\n\t\t\t\t\t\tcallback(null, [this.renderBeginTagToHtml(), this.all_html_render_internal_controls(), this.renderEndTagToHtml(), this.renderHtmlAppendment()].join(''));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\teach(arr_waiting_controls, (control, i) => {\r\n\t\t\t\t\tcontrol.on('ready', e_ready => {\r\n\t\t\t\t\t\tc--;\r\n\t\t\t\t\t\tif (c == 0) {\r\n\t\t\t\t\t\t\tcomplete();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.pre_all_html_render();\r\n\t\t\tvar dom = this.dom;\r\n\t\t\tif (dom) {\r\n\t\t\t\treturn [this.renderBeginTagToHtml(), this.all_html_render_internal_controls(), this.renderEndTagToHtml(), this.renderHtmlAppendment()].join('');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'render_content'() {\r\n\t\tvar content = this.content;\r\n\t\tif (tof(content) === 'string') {\r\n\t\t\treturn content;\r\n\t\t} else {\r\n\t\t\tvar contentLength = content.length();\r\n\t\t\tvar res = new Array(contentLength);\r\n\t\t\tvar tn, output;\r\n\t\t\tvar arr = content._arr;\r\n\t\t\tvar c, l = arr.length,\r\n\t\t\t\tn;\r\n\t\t\tfor (c = 0; c < l; c++) {\r\n\t\t\t\tn = arr[c];\r\n\t\t\t\ttn = tof(n);\r\n\t\t\t\tif (tn === 'string') {\r\n\t\t\t\t\tres.push(jsgui.output_processors['string'](n));\r\n\t\t\t\t} else if (tn === 'data_value') {\r\n\t\t\t\t\tres.push(n._);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (tn === 'data_object') {\r\n\t\t\t\t\t\tthrow 'stop';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres.push(n.all_html_render());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res.join('');\r\n\t\t}\r\n\t}\r\n\t'all_html_render_internal_controls'() {\r\n\t\treturn this.render_content();\r\n\t}\r\n\t'render'() {\r\n\t\treturn this.all_html_render(); \r\n\t}\r\n\t'pre_all_html_render'() {\r\n\t\t// if on the server side...\r\n\t\t//   not sure to what extent this fn call on every render will slow it down, raising an event on the server too.\r\n\r\n\t\t\r\n\r\n\t\tif (typeof document === 'undefined') {\r\n\t\t\tthis.raise('server-pre-render');\r\n\t\t}\r\n\r\n\t}\r\n\t'compose'() {}\r\n\t'visible'(callback) {\r\n\t\tthis.style('display', 'block', callback);\r\n\t}\r\n\t'transparent'(callback) {\r\n\t\tthis.style('opacity', 0, callback);\r\n\t}\r\n\t'opaque'(callback) {\r\n\t\treturn this.style({\r\n\t\t\t'opacity': 1\r\n\t\t}, callback);\r\n\t}\r\n\t'remove'() {\r\n\t\treturn this.parent.content.remove(this);\r\n\t}\r\n\t'add'(new_content) {\r\n\t\tconst tnc = tof(new_content);\r\n\t\tlet res;\r\n\t\tif (tnc === 'array') {\r\n\t\t\tlet res = [];\r\n\t\t\teach(new_content, (v) => {\r\n\t\t\t\tres.push(this.add(v));\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (new_content) {\r\n\t\t\t\tif (tnc === 'string') {\r\n\t\t\t\t\tnew_content = new Text_Node({\r\n\t\t\t\t\t\t'text': new_content,\r\n\t\t\t\t\t\t'context': this.context\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!new_content.context) {\r\n\t\t\t\t\t\tif (this.context) {\r\n\t\t\t\t\t\t\tnew_content.context = this.context;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar inner_control = this.inner_control;\r\n\t\t\t\tif (inner_control) {\r\n\t\t\t\t\tres = inner_control.content.add(new_content);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres = this.content.add(new_content);\r\n\t\t\t\t}\r\n\t\t\t\tnew_content.parent = this;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'insert_before'(target) {\r\n\t\tconst target_parent = target.parent;\r\n\t\tconst target_index = target._index;\r\n\t\tconst content = target_parent.content;\r\n\t\tcontent.insert(this, target_index);\r\n\t}\r\n\t'style'() {\r\n\t\tconst a = arguments,\r\n\t\t\tsig = get_a_sig(a, 1), d = this.dom,\r\n\t\t\tda = d.attrs;\r\n\t\ta.l = a.length;\r\n\t\tlet style_name, style_value, modify_dom = true;\r\n\t\tif (sig == '[s]') {\r\n\t\t\tstyle_name = a[0];\r\n\t\t\tconst res = getComputedStyle(d.el)[style_name];\r\n\t\t\treturn res;\r\n\t\t} else if (sig == '[s,s,b]') {\r\n\t\t\t[style_name, style_value, modify_dom] = a;\r\n\t\t} else if (sig == '[s,s]' || sig == '[s,n]') {\r\n\t\t\t[style_name, style_value] = a;\r\n\t\t};\r\n\t\tif (style_name && typeof style_value !== 'undefined') {\r\n\t\t\tif (da.style) {\r\n\t\t\t\tda.style[style_name] = style_value;\r\n\t\t\t\tda.raise('change', {\r\n\t\t\t\t\t'property': 'style',\r\n\t\t\t\t\t'name': 'style',\r\n\t\t\t\t\t'value': da.style + ''\r\n\t\t\t\t});\r\n\t\t\t} else {}\r\n\t\t}\r\n\t\tif (sig == '[o]') {\r\n\t\t\teach(a[0], (v, i) => {\r\n\t\t\t\tthis.style(i, v);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t'active'() {}\r\n\t'find_selection_scope'() {\r\n\t\tvar res = this.selection_scope;\r\n\t\tif (res) return res;\r\n\t\tif (this.parent && this.parent.find_selection_scope) return this.parent.find_selection_scope();\r\n\t}\r\n\t'click'(handler) {\r\n\t\tthis.on('click', handler);\r\n\t}\r\n\t'add_class'(class_name) {\r\n\t\tlet da = this.dom.attrs,\r\n\t\t\tcls = da['class'];\r\n\t\tif (!cls) {\r\n\t\t\tda['class'] = class_name;\r\n\t\t} else {\r\n\t\t\tconst tCls = tof(cls);\r\n\t\t\tif (tCls == 'object') {\r\n\t\t\t\tthrow 'removed';\r\n\t\t\t} else if (tCls == 'string') {\r\n\t\t\t\tlet arr_classes = cls.split(' '),\r\n\t\t\t\t\talready_has_class = false,\r\n\t\t\t\t\tl = arr_classes.length,\r\n\t\t\t\t\tc = 0;\r\n\t\t\t\twhile (c < l && !already_has_class) {\r\n\t\t\t\t\tif (arr_classes[c] === class_name) {\r\n\t\t\t\t\t\talready_has_class = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc++;\r\n\t\t\t\t}\r\n\t\t\t\tif (!already_has_class) {\r\n\t\t\t\t\tarr_classes.push(class_name);\r\n\t\t\t\t}\r\n\t\t\t\tda['class'] = arr_classes.join(' ');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'has_class'(class_name) {\r\n\t\tlet da = this.dom.attrs,\r\n\t\t\tcls = da['class'];\r\n\t\tif (cls) {\r\n\t\t\tvar tCls = tof(cls);\r\n\t\t\tif (tCls == 'object') {\r\n\t\t\t\tthrow 'removed';\r\n\t\t\t}\r\n\t\t\tif (tCls == 'string') {\r\n\t\t\t\tvar arr_classes = cls.split(' ');\r\n\t\t\t\tvar arr_res = [];\r\n\t\t\t\tvar l = arr_classes.length,\r\n\t\t\t\t\tc = 0;\r\n\t\t\t\twhile (c < l) {\r\n\t\t\t\t\tif (arr_classes[c] === class_name) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'remove_class'(class_name) {\r\n\t\tlet da = this.dom.attrs,\r\n\t\t\tcls = da['class'];\r\n\t\tif (cls) {\r\n\t\t\tvar tCls = tof(cls);\r\n\t\t\tif (tCls == 'object') {\r\n\t\t\t\tthrow 'removed';\r\n\t\t\t}\r\n\t\t\tif (tCls == 'string') {\r\n\t\t\t\tvar arr_classes = cls.split(' ');\r\n\t\t\t\tvar arr_res = [];\r\n\t\t\t\tvar l = arr_classes.length,\r\n\t\t\t\t\tc = 0;\r\n\t\t\t\twhile (c < l) {\r\n\t\t\t\t\tif (arr_classes[c] != class_name) {\r\n\t\t\t\t\t\tarr_res.push(arr_classes[c]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc++;\r\n\t\t\t\t}\r\n\t\t\t\tda['class'] = arr_res.join(' ');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'is_ancestor_of'(target) {\r\n\t\tvar t_target = tof(target);\r\n\t\tvar el = this.dom.el;\r\n\t\tvar inner = (target2) => {\r\n\t\t\tif (target2 == el) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar parent = target2.parentNode;\r\n\t\t\tif (!parent) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn inner(parent);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (t_target === 'object') {\r\n\t\t\tif (el !== target) {\r\n\t\t\t\tvar parent = target.parentNode;\r\n\t\t\t\tif (parent) {\r\n\t\t\t\t\treturn inner(parent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (t_target === 'control') {}\r\n\t\t}\r\n\t}\r\n\t'find_selected_ancestor_in_scope'() {\r\n\t\tvar s = this.selection_scope;\r\n\t\tvar ps = this.parent.selection_scope;\r\n\t\tif (s === ps) {\r\n\t\t\tvar psel = this.parent.selected;\r\n\t\t\tif (psel && psel.value && psel.value() == true) {\r\n\t\t\t\treturn this.parent;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.parent.find_selected_ancestor_in_scope();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'closest'(match) {\r\n\t\tlet tmatch = tof(match);\r\n\t\tif (tmatch === 'string') {}\r\n\t\tif (tmatch === 'function') {\r\n\t\t\tlet search = (ctrl) => {\r\n\t\t\t\tif (match(ctrl)) {\r\n\t\t\t\t\treturn ctrl;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (ctrl.parent) {\r\n\t\t\t\t\t\treturn search(ctrl.parent);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn search(this);\r\n\t\t}\r\n\t}\r\n\t'shallow_copy'() {\r\n\t\tvar res = new Control({\r\n\t\t\t'context': this.context\r\n\t\t});\r\n\t\tvar da = this.dom.attributes;\r\n\t\tvar cl = da.class;\r\n\t\tvar map_class_exclude = {\r\n\t\t\t'selected': true\r\n\t\t}\r\n\t\teach(cl.split(' '), (v, i) => {\r\n\t\t\tif (i && !map_class_exclude[i]) res.add_class(i);\r\n\t\t})\r\n\t\tvar res_content = res.content;\r\n\t\tthis.content.each((v, i) => {\r\n\t\t\tif (tof(v) == 'data_value') {\r\n\t\t\t\tres_content.add(v.value());\r\n\t\t\t} else {\r\n\t\t\t\tres_content.add(v.shallow_copy());\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn res;\r\n\t}\r\n\t'matches_selector'(selector) {\r\n\t\tthrow 'NYI'\r\n\t}\r\n\t'find'(selector) { \r\n\t\tconst res = [];\r\n\t\tconst desc = (node, callback) => {\r\n\t\t\tif (node.$match(selector)) {\r\n\t\t\t\tcallback(node);\r\n\t\t\t}\r\n\t\t\tnode.content.each(child => {\r\n\t\t\t\tdesc(child, callback);\r\n\t\t\t})\r\n\t\t}\r\n\t\tdesc(this, (node => res.push(node)));\r\n\t\treturn res;\r\n\t}\r\n\t'$match'(selector) {\r\n\t\tif (typeof selector === 'function') {\r\n\t\t\treturn selector(this);\r\n\t\t} else {\r\n\t\t\tlet parse_word = word => {\r\n\t\t\t\tif (word[0] === '.') {\r\n\t\t\t\t\treturn () => this.has_class(word.substr(1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn () => this.__type_name === word;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet parse_selector = selector => {\r\n\t\t\t\tlet words = selector.split(' ');\r\n\t\t\t\tlet res = words.map(x => parse_word(x));\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t\tlet parsed = parse_selector(selector);\r\n\t\t\tif (parsed.length === 1) {\r\n\t\t\t\treturn parsed[0]();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI';\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet res = false;\r\n\t\tlet tn = this.__type_name;\r\n\t\tif (tn) {\r\n\t\t\tif (tn === selector) res = true;\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t'$'(selector, handler) {\r\n\t\tlet match = this.$match(selector);\r\n\t\tlet res = [];\r\n\t\tif (match) {\r\n\t\t\tif (handler) handler(this);\r\n\t\t\tres.push(this)\r\n\t\t}\r\n\t\tthis.content.each(item => {\r\n\t\t\tif (item.$) {\r\n\t\t\t\tlet nested_res = item.$(selector, handler);\r\n\t\t\t\tArray.prototype.push.apply(res, nested_res);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\t'clear'() {\r\n\t\tthis.content.clear();\r\n\t}\r\n\t'activate'() {}\r\n\tget this_and_descendents() {\r\n\t\tconst res = [];\r\n\t\tthis.iterate_this_and_subcontrols(ctrl => res.push(ctrl));\r\n\t\treturn res;\r\n\t}\r\n\tget descendents() {\r\n\t\tconst res = [];\r\n\t\tthis.iterate_subcontrols(ctrl => res.push(ctrl));\r\n\t\treturn res;\r\n\t}\r\n\tget siblings() {\r\n\t\tconst res = [];\r\n\t\tif (this.parent) {\r\n\t\t\tconst _ = this.parent.content._arr;\r\n\t\t\t_.forEach(x => {\r\n\t\t\t\tif (x !== this) res.push(x);\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n};\r\nvar p = Control_Core.prototype;\r\np.connect_fields = true;\r\nconst customInspectSymbol = Symbol.for('nodejs.util.inspect.custom');\r\nif (jsgui.custom_rendering === 'very-simple') {\r\n\tp[customInspectSymbol] = function(depth, inspectOptions, inspect) {\r\n\t\treturn '< ' + this.dom.tagName + ' ' + this.__type_name +  ' >'\r\n\t};\r\n}\r\nmodule.exports = Control_Core;\r\nif (require.main === module) {\r\n\tconst Control = Control_Core;\r\n\tfunction test_svg() {\r\n\t\tconst passed = [];\r\n\t\tconst failed = [];\r\n\t\tlet svg;\r\n\t\ttry {\r\n\t\t\tsvg = new Control({\r\n\t\t\t\ttagName: 'svg'\r\n\t\t\t});\r\n\t\t\tpassed.push('Create SVG control');\r\n\t\t} catch (error) {\r\n\t\t\tfailed.push('Create SVG control');\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst circle = new Control({\r\n\t\t\t\ttagName: 'circle',\r\n\t\t\t\tattrs: {\r\n\t\t\t\t\tcx: 100,\r\n\t\t\t\t\tcy: 100,\r\n\t\t\t\t\tr: 50\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsvg.add(circle);\r\n\t\t\tpassed.push('Add circle to SVG control');\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('error', error);\r\n\t\t\tfailed.push('Add circle to SVG control');\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst rect = new Control({\r\n\t\t\t\ttagName: 'rect',\r\n\t\t\t\tattrs: {\r\n\t\t\t\t\tx: 150,\r\n\t\t\t\t\ty: 150,\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\theight: 100\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsvg.add(rect);\r\n\t\t\tpassed.push('Add rectangle to SVG control');\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('error', error);\r\n\t\t\tfailed.push('Add rectangle to SVG control');\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst expected = '<svg><circle cx=\"100\" cy=\"100\" r=\"50\"></circle><rect x=\"150\" y=\"150\" width=\"100\" height=\"100\"></rect></svg>';\r\n\t\t\tconst actual = svg.all_html_render();\r\n\t\t\tconsole.log('actual', actual);\r\n\t\t\tif (expected === actual) {\r\n\t\t\t\tpassed.push('Check rendering of SVG control');\r\n\t\t\t} else {\r\n\t\t\t\tfailed.push('Check rendering of SVG control');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('error', error);\r\n\t\t\tfailed.push('Check rendering of SVG control');\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tpassed,\r\n\t\t\tfailed\r\n\t\t};\r\n\t}\r\n\tconsole.log(test_svg()); \r\n\tconst test_background_color = () => {\r\n\t\tconst expectedColor = '#ff0000';\r\n\t\tconst passed = [];\r\n\t\tconst failed = [];\r\n\t\tlet div;\r\n\t\ttry {\r\n\t\t\tdiv = new Control({\r\n\t\t\t\ttagName: 'div',\r\n\t\t\t});\r\n\t\t\tpassed.push('Create div control');\r\n\t\t} catch (error) {\r\n\t\t\tfailed.push(['Create div control', error]);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tdiv.background.color = expectedColor;\r\n\t\t\tpassed.push('Set background color of div control');\r\n\t\t} catch (error) {\r\n\t\t\tfailed.push(['Set background color of div control', error]);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst validationColor = div.background.color;\r\n\t\t\tif (validationColor === expectedColor) {\r\n\t\t\t\tpassed.push('Validate background color of div control');\r\n\t\t\t} else {\r\n\t\t\t\tfailed.push(['Validate background color of div control', 'Background color is not as expected']);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tfailed.push(['Validate background color of div control', error]);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst expected = `<div style=\"background-color:${expectedColor}\"></div>`;\r\n\t\t\tconst actual = div.all_html_render();\r\n\t\t\tif (expected === actual) {\r\n\t\t\t\tpassed.push('Check rendering of div control');\r\n\t\t\t} else {\r\n\t\t\t\tfailed.push(['Check rendering of div control', 'Rendering does not match expected output', {\r\n\t\t\t\t\texpected,\r\n\t\t\t\t\tactual\r\n\t\t\t\t}]);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tfailed.push(['Check rendering of div control', error]);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tpassed,\r\n\t\t\tfailed,\r\n\t\t};\r\n\t};\r\n\tconst rtest = test_background_color();\r\n\tconsole.log(rtest);\r\n\tconsole.log(rtest.failed);\r\n}", "\r\n\r\nclass Shape {\r\n\r\n}\r\n\r\nmodule.exports = Shape;", "// Late 2023 - Should include field from obext as well?\n\n// Bring more data functionality to a lower level...?\n//   Have more of a platform to support Data_Model, Data_Value and Data_Object with.\n\n// data.schema?\n// data.model.schema???\n\n// Would be worth integrating various parts together here and with Data_Model, Data_Object, Data_Value\n\n\nconst running_in_browser = typeof window !== 'undefined';\nconst running_in_node = !running_in_browser;\nlet Readable_Stream, Writable_Stream, Transform_Stream;\nconst get_stream = () => {\n\tif (running_in_node) {\n\t\treturn (() => {\n\t\t\tconst str_libname = ('str') + ('eam');\n\t\t\tconst stream = require(str_libname);\n\t\t\tReadable_Stream = stream.Readable;\n\t\t\tWritable_Stream = stream.Writable;\n\t\t\tTransform_Stream = stream.Transform;\n\t\t\treturn stream;\n\t\t})();\n\t} else {\n\t\treturn undefined;\n\t}\n}\nconst stream = get_stream();\nconst each = (collection, fn, context) => {\n\tif (collection) {\n\t\tif (collection.__type == 'collection') {\n\t\t\treturn collection.each(fn, context);\n\t\t}\n\t\tlet ctu = true;\n\t\tlet stop = function () {\n\t\t\tctu = false;\n\t\t};\n\t\tif (is_array(collection)) {\n\t\t\tlet res = [],\n\t\t\t\tres_item;\n\t\t\tfor (let c = 0, l = collection.length; c < l; c++) {\n\t\t\t\tres_item;\n\t\t\t\tif (ctu == false) break;\n\t\t\t\tif (context) {\n\t\t\t\t\tres_item = fn.call(context, collection[c], c, stop);\n\t\t\t\t} else {\n\t\t\t\t\tres_item = fn(collection[c], c, stop);\n\t\t\t\t}\n\t\t\t\tif (ctu == false) break; // If stop() was called, do not push current item\n\t\t\t\tres.push(res_item);\n\t\t\t}\n\t\t\treturn res;\n\t\t} else {\n\t\t\tlet name, res = {};\n\t\t\tfor (name in collection) {\n\t\t\t\tif (ctu === false) break;\n\t\t\t\tif (context) {\n\t\t\t\t\tres[name] = fn.call(context, collection[name], name, stop);\n\t\t\t\t} else {\n\t\t\t\t\tres[name] = fn(collection[name], name, stop);\n\t\t\t\t}\n\t\t\t\tif (ctu === false) break; // If stop() was called, do not set current property\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t}\n};\nconst is_array = Array.isArray;\nconst is_dom_node = function isDomNode(obj) {\n\treturn (!!obj && typeof obj.nodeType !== 'undefined' && typeof obj.childNodes !== 'undefined');\n};\nconst get_truth_map_from_arr = function (arr) {\n\tlet res = {};\n\teach(arr, function (v, i) {\n\t\tres[v] = true;\n\t});\n\treturn res;\n};\nconst get_arr_from_truth_map = function (truth_map) {\n\tlet res = [];\n\teach(truth_map, function (v, i) {\n\t\tres.push(i);\n\t});\n\treturn res;\n};\nconst get_map_from_arr = function (arr) {\n\tlet res = {};\n\tfor (let c = 0, l = arr.length; c < l; c++) {\n\t\tres[arr[c]] = c;\n\t}\n\treturn res;\n}\nconst arr_like_to_arr = function (arr_like) {\n\tlet res = new Array(arr_like.length);\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\n\t\tres[c] = arr_like[c];\n\t};\n\treturn res;\n};\nconst is_ctrl = function (obj) {\n\treturn (typeof obj !== 'undefined' && obj !== null && is_defined(obj.__type_name) && is_defined(obj.content) && is_defined(obj.dom));\n};\nconst map_loaded_type_fn_checks = {},\n\tmap_loaded_type_abbreviations = {\n\t\t'object': 'o',\n\t\t'number': 'n',\n\t\t'string': 's',\n\t\t'function': 'f',\n\t\t'boolean': 'b',\n\t\t'undefined': 'u',\n\t\t'null': 'N',\n\t\t'array': 'a',\n\t\t'arguments': 'A',\n\t\t'date': 'd',\n\t\t'regex': 'r',\n\t\t'error': 'e',\n\t\t'buffer': 'B',\n\t\t'promise': 'p',\n\t\t'observable': 'O',\n\t\t'readable_stream': 'R',\n\t\t'writable_stream': 'W',\n\t\t'data_value': 'V'\n\t};\nlet using_type_plugins = false;\nconst invert = (obj) => {\n\tif (!is_array(obj)) {\n\t\tlet res = {};\n\t\teach(obj, (v, k) => {\n\t\t\tres[v] = k;\n\t\t})\n\t\treturn res;\n\t} else {\n\t\tconsole.trace();\n\t\tthrow 'invert(obj) not supported on arrays'\n\t}\n}\nconst map_loaded_type_names = invert(map_loaded_type_abbreviations);\nconst load_type = (name, abbreviation, fn_detect_instance) => {\n\tmap_loaded_type_fn_checks[name] = fn_detect_instance;\n\tmap_loaded_type_names[abbreviation] = name;\n\tmap_loaded_type_abbreviations[name] = abbreviation;\n\tusing_type_plugins = true;\n}\nconst tof = (obj, t1) => {\n\tlet res = t1 || typeof obj;\n\tif (using_type_plugins) {\n\t\tlet res;\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\n\t\t\tif (fn_check(obj)) {\n\t\t\t\tres = name;\n\t\t\t\tstop();\n\t\t\t}\n\t\t});\n\t\tif (res) {\n\t\t\treturn res;\n\t\t}\n\t}\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean') {\n\t\treturn res;\n\t}\n\tif (res === 'object') {\n\t\tif (typeof obj !== 'undefined') {\n\t\t\tif (obj === null) {\n\t\t\t\treturn 'null';\n\t\t\t}\n\t\t\tif (obj.__type) {\n\t\t\t\treturn obj.__type;\n\t\t\t} else if (obj.__type_name) {\n\t\t\t\treturn obj.__type_name;\n\t\t\t} else {\n\t\t\t\tif (obj instanceof Promise) {\n\t\t\t\t\treturn 'promise';\n\t\t\t\t}\n\t\t\t\tif (is_ctrl(obj)) {\n\t\t\t\t\treturn 'control';\n\t\t\t\t}\n\t\t\t\tif (obj instanceof Date) {\n\t\t\t\t\treturn 'date';\n\t\t\t\t}\n\t\t\t\tif (is_array(obj)) {\n\t\t\t\t\treturn 'array';\n\t\t\t\t} else {\n\t\t\t\t\tif (obj instanceof Error) {\n\t\t\t\t\t\tres = 'error';\n\t\t\t\t\t} else if (obj instanceof RegExp) res = 'regex';\n\t\t\t\t\tif (typeof window === 'undefined') {\n\t\t\t\t\t\tif (obj && obj.readInt8) res = 'buffer';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t}\n\t\t} else {\n\t\t\treturn 'undefined';\n\t\t}\n\t}\n\treturn res;\n};\nconst tf = (obj) => {\n\tlet res = typeof obj;\n\tif (using_type_plugins) {\n\t\tlet res;\n\t\teach(map_loaded_type_fn_checks, (fn_check, name, stop) => {\n\t\t\tif (fn_check(obj)) {\n\t\t\t\tres = map_loaded_type_abbreviations[name];\n\t\t\t\tstop();\n\t\t\t}\n\t\t});\n\t\tif (res) {\n\t\t\treturn res;\n\t\t}\n\t}\n\tif (res === 'number' || res === 'string' || res === 'function' || res === 'boolean' || res === 'undefined') {\n\t\treturn res[0];\n\t} else {\n\t\tif (obj === null) {\n\t\t\treturn 'N';\n\t\t} else {\n\t\t\tif (running_in_node) {\n\t\t\t\tif (obj instanceof Readable_Stream) {\n\t\t\t\t\treturn 'R';\n\t\t\t\t} else if (obj instanceof Writable_Stream) {\n\t\t\t\t\treturn 'W';\n\t\t\t\t} else if (obj instanceof Transform_Stream) {\n\t\t\t\t\treturn 'T';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof Buffer !== 'undefined' && obj instanceof Buffer) {\n\t\t\t\treturn 'B';\n\t\t\t} else if (obj instanceof Promise) {\n\t\t\t\treturn 'p';\n\t\t\t} else if (obj instanceof Date) {\n\t\t\t\treturn 'd';\n\t\t\t} else if (is_array(obj)) {\n\t\t\t\treturn 'a';\n\t\t\t} else {\n\t\t\t\tif (obj._is_observable === true) {\n\t\t\t\t\treturn 'O';\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof obj.callee === 'function') {\n\t\t\t\t\t\treturn 'A';\n\t\t\t\t\t} else if (obj instanceof Error) {\n\t\t\t\t\t\treturn 'e';\n\t\t\t\t\t} else if (obj instanceof RegExp) return 'r';\n\t\t\t\t\treturn 'o';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t}\n\tconsole.trace();\n\tconsole.log('item', item);\n\tthrow 'type not found';\n\treturn res;\n};\nconst atof = (arr) => {\n\tlet res = new Array(arr.length);\n\tfor (let c = 0, l = arr.length; c < l; c++) {\n\t\tres[c] = tof(arr[c]);\n\t}\n\treturn res;\n};\nconst is_defined = (value) => {\n\t\treturn typeof (value) != 'undefined';\n\t},\n\tisdef = is_defined;\nconst stringify = JSON.stringify;\n\n// Older version???\n\nlet _get_item_sig = (i, arr_depth) => {\n\tlet res;\n\tlet t1 = typeof i;\n\tif (t1 === 'string') {\n\t\tres = 's';\n\t} else if (t1 === 'number') {\n\t\tres = 'n';\n\t} else if (t1 === 'boolean') {\n\t\tres = 'b';\n\t} else if (t1 === 'function') {\n\t\tres = 'f';\n\t} else {\n\t\tlet t = tof(i, t1);\n\t\tif (t === 'array') {\n\t\t\tif (arr_depth) {\n\t\t\t\tres = '['\n\t\t\t\tfor (let c = 0, l = i.length; c < l; c++) {\n\t\t\t\t\tif (c > 0) res = res + ',';\n\t\t\t\t\tres = res + get_item_sig(i[c], arr_depth - 1);\n\t\t\t\t}\n\t\t\t\tres = res + ']';\n\t\t\t} else {\n\t\t\t\tres = 'a';\n\t\t\t}\n\t\t} else if (t === 'control') {\n\t\t\tres = 'c';\n\t\t} else if (t === 'date') {\n\t\t\tres = 'd';\n\t\t} else if (t === 'observable') {\n\t\t\tres = 'O';\n\t\t} else if (t === 'regex') {\n\t\t\tres = 'r';\n\t\t} else if (t === 'buffer') {\n\t\t\tres = 'B';\n\t\t} else if (t === 'readable_stream') {\n\t\t\tres = 'R';\n\t\t} else if (t === 'writable_stream') {\n\t\t\tres = 'W';\n\t\t} else if (t === 'object') {\n\t\t\tres = 'o';\n\t\t} else if (t === 'undefined') {\n\t\t\tres = 'u';\n\t\t} else {\n\t\t\tif (t === 'collection_index') {\n\t\t\t\treturn 'X';\n\t\t\t} else if (t === 'data_object') {\n\t\t\t\tif (i._abstract) {\n\t\t\t\t\tres = '~D';\n\t\t\t\t} else {\n\t\t\t\t\tres = 'D';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (t === 'data_value') {\n\t\t\t\t\tif (i._abstract) {\n\t\t\t\t\t\tres = '~V';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres = 'V';\n\t\t\t\t\t}\n\t\t\t\t} else if (t === 'null') {\n\t\t\t\t\tres = '!';\n\t\t\t\t} else if (t === 'collection') {\n\t\t\t\t\tif (i._abstract) {\n\t\t\t\t\t\tres = '~C';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres = 'C';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tres = '?';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\nconst get_item_sig = (item, arr_depth) => {\n\tif (arr_depth) {\n\t\treturn _get_item_sig(item, arr_depth);\n\t}\n\tconst t = tof(item);\n\n\tif (map_loaded_type_abbreviations[t]) {\n\t\treturn map_loaded_type_abbreviations[t];\n\t} else {\n\t\tlet bt = typeof item;\n\t\tif (bt === 'object') {\n\t\t\tif (is_array(item)) {\n\t\t\t\treturn 'a';\n\t\t\t} else {\n\t\t\t\treturn 'o';\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('map_loaded_type_abbreviations type name not found', t);\n\t\t\tconsole.log('bt', bt);\n\t\t\tconsole.trace();\n\t\t\tthrow 'stop';\n\t\t}\n\t}\n}\nconst get_a_sig = (a) => {\n\tlet c = 0,\n\t\tl = a.length;\n\n\t//console.log('is_array(a)', is_array(a));\n\t//console.log('a', a);\n\t//console.log('get_a_sig l', l);\n\tlet res = '[';\n\tlet first = true;\n\tfor (c = 0; c < l; c++) {\n\t\tif (!first) {\n\t\t\tres = res + ',';\n\t\t}\n\t\tfirst = false;\n\t\tres = res + get_item_sig(a[c]);\n\t}\n\tres = res + ']';\n\treturn res;\n}\nconst deep_sig = (item, max_depth = -1, depth = 0) => {\n\tconst t = tf(item);\n\tlet res = '';\n\tif (t === 'a') {\n\t\tconst l = item.length;\n\t\tif (max_depth === -1 || depth <= max_depth) {\n\t\t\tres = res + '[';\n\t\t\tlet first = true;\n\t\t\tfor (let c = 0; c < l; c++) {\n\t\t\t\tif (!first) res = res + ',';\n\t\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\n\t\t\t\tfirst = false;\n\t\t\t}\n\t\t\tres = res + ']';\n\t\t} else {\n\t\t\treturn 'a';\n\t\t}\n\t} else if (t === 'A') {\n\t\tconst l = item.length;\n\t\tlet first = true;\n\t\tfor (let c = 0; c < l; c++) {\n\t\t\tif (!first) res = res + ',';\n\t\t\tres = res + deep_sig(item[c], max_depth, depth + 1);\n\t\t\tfirst = false;\n\t\t}\n\t} else if (t === 'o') {\n\t\tif (max_depth === -1 || depth <= max_depth) {\n\t\t\tlet res = '{';\n\t\t\tlet first = true;\n\t\t\teach(item, (v, k) => {\n\t\t\t\tif (!first) res = res + ',';\n\t\t\t\tres = res + '\"' + k + '\":' + deep_sig(v, max_depth, depth + 1);\n\t\t\t\tfirst = false;\n\t\t\t});\n\t\t\tres = res + '}';\n\t\t\treturn res;\n\t\t} else {\n\t\t\treturn 'o';\n\t\t}\n\t} else {\n\t\tres = res + t;\n\t}\n\treturn res;\n}\nconst trim_sig_brackets = function (sig) {\n\tif (tof(sig) === 'string') {\n\t\tif (sig.charAt(0) == '[' && sig.charAt(sig.length - 1) == ']') {\n\t\t\treturn sig.substring(1, sig.length - 1);\n\t\t} else {\n\t\t\treturn sig;\n\t\t}\n\t}\n};\nconst arr_trim_undefined = function (arr_like) {\n\tlet res = [];\n\tlet last_defined = -1;\n\tlet t, v;\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\n\t\tv = arr_like[c];\n\t\tt = tof(v);\n\t\tif (t == 'undefined') {} else {\n\t\t\tlast_defined = c;\n\t\t}\n\t}\n\tfor (let c = 0, l = arr_like.length; c < l; c++) {\n\t\tif (c <= last_defined) {\n\t\t\tres.push(arr_like[c]);\n\t\t}\n\t}\n\treturn res;\n};\n\n// Could see about simply integrating data types into fp....?\n//   That could mean habing get_item_sig return sigs for those data types.\n//     Would need to define signature abbreviations for them.\n\n\n\n\n\nconst functional_polymorphism = function (options, fn) {\n\tlet a0 = arguments;\n\tif (a0.length === 1) {\n\t\tfn = a0[0];\n\t\toptions = null;\n\t}\n\tlet arr_slice = Array.prototype.slice;\n\tlet arr, sig, a2, l, a;\n\treturn function () {\n\t\ta = arguments;\n\t\tl = a.length;\n\t\tif (l === 1) {\n\t\t\tsig = get_item_sig([a[0]], 1);\n\t\t\ta2 = [a[0]];\n\t\t\ta2.l = 1;\n\t\t\treturn fn.call(this, a2, sig);\n\t\t} else if (l > 1) {\n\t\t\tarr = arr_trim_undefined(arr_slice.call(a, 0));\n\t\t\tsig = get_item_sig(arr, 1);\n\t\t\tarr.l = arr.length;\n\t\t\treturn fn.call(this, arr, sig);\n\t\t} else if (a.length === 0) {\n\t\t\tarr = new Array(0);\n\t\t\tarr.l = 0;\n\t\t\treturn fn.call(this, arr, '[]');\n\t\t}\n\t}\n};\nconst fp = functional_polymorphism;\nconst parse_sig = (str_sig, opts = {}) => {\n\tconst sig2 = str_sig.split(', ').join(',');\n\tconst sig_items = sig2.split(',');\n\tconst res = [];\n\teach(sig_items, sig_item => {\n\t\tif (sig_item.length === 1) {\n\t\t\tlet type_name = map_loaded_type_names[sig_item];\n\t\t\tres.push({\n\t\t\t\tabbreviation: sig_item,\n\t\t\t\ttype_name: type_name\n\t\t\t});\n\t\t} else {\n\t\t\tlet suffix_modifiers;\n\t\t\tlet zero_or_more = false;\n\t\t\tlet one_or_more = false;\n\t\t\tlet type_name = sig_item;\n\t\t\tconst obj_res = {\n\t\t\t\ttype_name: type_name\n\t\t\t}\n\t\t\tconst distil_suffix_modifiers = () => {\n\t\t\t\tlet last_char = type_name.substr(type_name.length - 1);\n\t\t\t\tif (last_char === '*') {\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\n\t\t\t\t\tzero_or_more = true;\n\t\t\t\t\tobj_res.zero_or_more = true;\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\n\t\t\t\t\tobj_res.modifiers.push('*');\n\t\t\t\t\tdistil_suffix_modifiers();\n\t\t\t\t} else if (last_char === '+') {\n\t\t\t\t\ttype_name = type_name.substr(0, type_name.length - 1);\n\t\t\t\t\tone_or_more = true;\n\t\t\t\t\tobj_res.one_or_more = true;\n\t\t\t\t\tobj_res.modifiers = obj_res.modifiers || [];\n\t\t\t\t\tobj_res.modifiers.push('+');\n\t\t\t\t\tdistil_suffix_modifiers();\n\t\t\t\t} else {}\n\t\t\t}\n\t\t\tdistil_suffix_modifiers();\n\t\t\tobj_res.type_name = type_name;\n\t\t\tres.push(obj_res);\n\t\t}\n\t});\n\treturn res;\n}\nconst mfp_not_sigs = get_truth_map_from_arr(['pre', 'default', 'post']);\nconst mfp_unparse_sig = arr_sig => {\n\tlet res = '[';\n\tlet first = true;\n\teach(arr_sig, sig_item => {\n\t\tif (!first) {\n\t\t\tres = res + ',';\n\t\t}\n\t\tres = res + sig_item.abbreviation;\n\t\tfirst = false;\n\t})\n\tres = res + ']';\n\treturn res;\n}\nconst map_grammar_def_abbreviations = {\n\t'string': 's',\n\t'number': 'n',\n\t'boolean': 'b',\n\t's': 's',\n\t'n': 'n',\n\t'b': 'b'\n}\nconst log = () => {};\nconst combinations = (arr, arr_idxs_to_ignore) => {\n\tconst map_ignore_idxs = {};\n\tif (arr_idxs_to_ignore) {\n\t\teach(arr_idxs_to_ignore, idx_to_ignore => {\n\t\t\tmap_ignore_idxs[idx_to_ignore] = true;\n\t\t});\n\t}\n\n\t// Check for empty arrays in the input\n\tif (arr.some(subArray => subArray.length === 0)) {\n\t\treturn []; // Return an empty result if any sub-array is empty\n\t}\n\n\tconst res = [];\n\tconst l = arr.length;\n\tconst arr_idxs_num_options = new Uint32Array(l);\n\teach(arr, (arr_item1, i1) => {\n\t\tarr_idxs_num_options[i1] = arr_item1.length;\n\t});\n\tconst arr_current_option_idxs = (new Uint32Array(l)).fill(0);\n\tconst result_from_indexes = (arr, arg_indexes) => {\n\t\tconst res = new Array(l);\n\t\tif (arg_indexes.length === l) {\n\t\t\tfor (var c = 0; c < l; c++) {\n\t\t\t\tres[c] = arr[c][arg_indexes[c]];\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.trace();\n\t\t\tthrow 'Arguments length mismatch';\n\t\t}\n\t\treturn res;\n\t}\n\tconst incr = () => {\n\t\tfor (c = l - 1; c >= 0; c--) {\n\t\t\tconst ival = arr_current_option_idxs[c];\n\t\t\tconst max = arr_idxs_num_options[c] - 1;\n\t\t\tif (ival < max) {\n\t\t\t\tarr_current_option_idxs[c]++;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tif (c === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\tarr_current_option_idxs.fill(0, c);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\n\tres.push(vals);\n\twhile (incr()) {\n\t\tlet vals = result_from_indexes(arr, arr_current_option_idxs);\n\t\tres.push(vals);\n\t}\n\treturn res;\n}\nconst map_native_types = {\n\t'string': true,\n\t'boolean': true,\n\t'number': true,\n\t'object': true\n}\nconst map_native_type_sigs = {\n\t's': true,\n\t'n': true,\n\t'o': true,\n\t'a': true,\n\t'd': true\n}\n\n\n// Late 2023 - mfp may be a good basis to proceed with more data-type aware idioms.\n//   Want to use it for mid-level precise and concise code where possible.\n//     May use it or its conventions in implementing some higher level (incl mid level) things.\n\n// Would be worth setting up and testing (maybe also benchmarking) Data_Value objects that specifically represent numbers between\n//  -180 and 180. Also integrating such Data_Value objects within a Data_Object or other Data_Model.\n// Maybe want some kind of _, $, or dm or _dm type shorthand for things that are very useful.\n//   Though it does make sense to abstractify things that get used a lot to make it mroe concise.\n//     Also worth designing and then using the concise idioms.\n\n// mfp seems like some code that could be redone / changed and parts used elsewhere to implement the mid and high level\n//   APIs as wanted.\n\n\n\n\n\nconst mfp = function () {\n\n\t// mfp looks complex. may need to look into what it's for and can do.\n\t//   Looks like an old work-in-progress.\n\t//     Should look into benchmarking its usage in different places.\n\n\tconst a1 = arguments;\n\tconst sig1 = get_a_sig(a1);\n\tlet options = {};\n\tlet fn_pre, provided_map_sig_fns, inner_map_sig_fns = {},\n\t\tinner_map_parsed_sigs = {},\n\t\tarr_sig_parsed_sig_fns = [],\n\t\tfn_post;\n\tlet tm_sig_fns;\n\tlet fn_default;\n\tlet single_fn;\n\tlet req_sig_single_fn;\n\tif (sig1 === '[o]') {\n\t\tprovided_map_sig_fns = a1[0];\n\t} else if (sig1 === '[o,o]') {\n\t\toptions = a1[0];\n\t\tprovided_map_sig_fns = a1[1];\n\t} else if (sig1 === '[o,f]') {\n\t\toptions = a1[0];\n\t\tsingle_fn = a1[1];\n\t} else if (sig1 === '[o,s,f]') {\n\t\toptions = a1[0];\n\t\treq_sig_single_fn = a1[1];\n\t\tsingle_fn = a1[2];\n\t\tprovided_map_sig_fns = {};\n\t\tprovided_map_sig_fns[req_sig_single_fn] = single_fn;\n\t} else if (sig1 === '[f,o]') {\n\t\tsingle_fn = a1[0];\n\t\toptions = a1[1];\n\t} else if (sig1 === '[f]') {\n\t\tsingle_fn = a1[0];\n\t} else {\n\t\tconsole.log('sig1', sig1);\n\t\tconsole.trace();\n\t\tthrow 'mfp NYI';\n\t}\n\tlet {\n\t\tsingle,\n\t\tname,\n\t\tgrammar,\n\t\tverb,\n\t\tnoun,\n\t\treturn_type,\n\t\treturn_subtype,\n\t\tpure,\n\t\tmain,\n\t\tskip\n\t} = options;\n\tlet parsed_grammar;\n\tlet identify, validate;\n\tlet dsig = deep_sig;\n\t(() => {\n\t\tif (provided_map_sig_fns) {\n\t\t\tif (provided_map_sig_fns.default) fn_default = provided_map_sig_fns.default;\n\t\t\teach(provided_map_sig_fns, (fn, sig) => {\n\t\t\t\tif (typeof fn === 'function') {\n\t\t\t\t\tif (!mfp_not_sigs[sig]) {\n\t\t\t\t\t\tconst parsed_sig = parse_sig(sig);\n\t\t\t\t\t\tconst arr_args_with_modifiers = [];\n\t\t\t\t\t\tconst arr_args_all_modification_versions = [];\n\t\t\t\t\t\teach(parsed_sig, (arg, i) => {\n\t\t\t\t\t\t\tarr_args_all_modification_versions[i] = [];\n\t\t\t\t\t\t\tif (arg.modifiers) {\n\t\t\t\t\t\t\t\tconst arg_num_modifiers = arg.modifiers.length;\n\t\t\t\t\t\t\t\tif (arg_num_modifiers > 1) {\n\t\t\t\t\t\t\t\t\tthrow 'Use of more than 1 modifier is currently unsupported.';\n\t\t\t\t\t\t\t\t} else if (arg_num_modifiers === 1) {\n\t\t\t\t\t\t\t\t\tarr_args_with_modifiers.push([i, arg]);\n\t\t\t\t\t\t\t\t\tconst single_modifier = arg.modifiers[0];\n\t\t\t\t\t\t\t\t\tif (single_modifier === '*') {\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (single_modifier === '+') {\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\n\t\t\t\t\t\t\t\t\t\tconst plural_name = grammar.maps.sing_plur[arg.type_name];\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(plural_name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (single_modifier === '?') {\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push('');\n\t\t\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tarr_args_all_modification_versions[i].push(arg.abbreviation || arg.type_name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst combo_args = combinations(arr_args_all_modification_versions);\n\t\t\t\t\t\tconst combo_sigs = [];\n\t\t\t\t\t\tlet i_first_of_last_undefined = -1;\n\t\t\t\t\t\teach(combo_args, arg_set => {\n\t\t\t\t\t\t\tlet combo_sig = '';\n\t\t\t\t\t\t\teach(arg_set, (arg, i) => {\n\t\t\t\t\t\t\t\tlet lsigb4 = combo_sig.length;\n\t\t\t\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + ',';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (arg === '') {\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + 'u';\n\t\t\t\t\t\t\t\t\tif (i_first_of_last_undefined === -1) {\n\t\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = lsigb4;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcombo_sig = combo_sig + arg;\n\t\t\t\t\t\t\t\t\ti_first_of_last_undefined = -1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tif (i_first_of_last_undefined > 0) {\n\t\t\t\t\t\t\t\tconst combo_sig_no_last_undefined = combo_sig.substr(0, i_first_of_last_undefined);\n\t\t\t\t\t\t\t\tcombo_sigs.push(combo_sig_no_last_undefined);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcombo_sigs.push(combo_sig);\n\t\t\t\t\t\t})\n\t\t\t\t\t\tif (combo_sigs.length > 0) {\n\t\t\t\t\t\t\teach(combo_sigs, combo_sig => {\n\t\t\t\t\t\t\t\tinner_map_sig_fns[combo_sig] = fn;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinner_map_sig_fns[sig] = fn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinner_map_parsed_sigs[sig] = parsed_sig;\n\t\t\t\t\t\tarr_sig_parsed_sig_fns.push([sig, parsed_sig, fn]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('ommiting, not parsing sig', sig);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('fn', fn);\n\t\t\t\t\tconsole.trace();\n\t\t\t\t\tthrow 'Expected: function';\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\teach(inner_map_sig_fns, (fn, sig) => {\n\t\t\ttm_sig_fns = tm_sig_fns || {};\n\t\t\ttm_sig_fns[sig] = true;\n\t\t});\n\t})();\n\tconst res = function () {\n\t\tconst a2 = arguments;\n\t\tconst l2 = a2.length;\n\t\tconsole.log('');\n\t\tconsole.log('calling mfp function');\n\t\tconsole.log('--------------------');\n\t\tconsole.log('');\n\t\tlet mfp_fn_call_deep_sig;\n\t\tlet ltof = tof;\n\t\tconst lsig = dsig;\n\t\tlet ltf = tf;\n\t\tmfp_fn_call_deep_sig = lsig(a2);\n\t\tlet do_skip = false;\n\t\tif (skip) {\n\t\t\tif (skip(a2)) {\n\t\t\t\tdo_skip = true;\n\t\t\t} else {}\n\t\t}\n\t\tif (!do_skip) {\n\t\t\tif (inner_map_sig_fns[mfp_fn_call_deep_sig]) {\n\t\t\t\treturn inner_map_sig_fns[mfp_fn_call_deep_sig].apply(this, a2);\n\t\t\t} else {\n\t\t\t\tlet idx_last_fn = -1;\n\t\t\t\tlet idx_last_obj = -1;\n\t\t\t\teach(a2, (arg, i_arg) => {\n\t\t\t\t\ti_arg = parseInt(i_arg, 10);\n\t\t\t\t\tconst targ = tf(arg);\n\t\t\t\t\tif (targ === 'o') {\n\t\t\t\t\t\tidx_last_obj = i_arg;\n\t\t\t\t\t}\n\t\t\t\t\tif (targ === 'f') {\n\t\t\t\t\t\tidx_last_fn = i_arg;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tconst last_arg_is_fn = idx_last_fn > -1 && idx_last_fn === a2.length - 1;\n\t\t\t\tconst last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 1;\n\t\t\t\tconst second_last_arg_is_obj = idx_last_obj > -1 && idx_last_obj === a2.length - 2;\n\t\t\t\tlet possible_options_obj;\n\t\t\t\tif (last_arg_is_obj) possible_options_obj = a2[idx_last_obj];\n\t\t\t\tconst new_args_arrangement = [];\n\t\t\t\tfor (let f = 0; f < idx_last_obj; f++) {\n\t\t\t\t\tnew_args_arrangement.push(a2[f]);\n\t\t\t\t}\n\t\t\t\teach(possible_options_obj, (value, key) => {\n\t\t\t\t\tnew_args_arrangement.push(value);\n\t\t\t\t});\n\t\t\t\tlet naa_sig = lsig(new_args_arrangement);\n\t\t\t\tnaa_sig = naa_sig.substring(1, naa_sig.length - 1);\n\t\t\t\tif (inner_map_sig_fns[naa_sig]) {\n\t\t\t\t\treturn inner_map_sig_fns[naa_sig].apply(this, new_args_arrangement);\n\t\t\t\t} else {\n\t\t\t\t\tif (fn_default) {\n\t\t\t\t\t\treturn fn_default.call(this, a2, mfp_fn_call_deep_sig);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (single_fn) {\n\t\t\t\t\t\t\tconsole.log('pre apply single_fn');\n\t\t\t\t\t\t\treturn single_fn.apply(this, a2);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_parsed_sigs)', Object.keys(inner_map_parsed_sigs));\n\t\t\t\t\t\t\tconsole.trace();\n\t\t\t\t\t\t\tconsole.log('mfp_fn_call_deep_sig', mfp_fn_call_deep_sig);\n\t\t\t\t\t\t\tconsole.log('provided_map_sig_fns', provided_map_sig_fns);\n\t\t\t\t\t\t\tif (provided_map_sig_fns) log('Object.keys(provided_map_sig_fns)', Object.keys(provided_map_sig_fns));\n\t\t\t\t\t\t\tconsole.log('Object.keys(inner_map_sig_fns)', Object.keys(inner_map_sig_fns));\n\t\t\t\t\t\t\tconsole.trace();\n\t\t\t\t\t\t\tthrow 'no signature match found. consider using a default signature. mfp_fn_call_deep_sig: ' + mfp_fn_call_deep_sig;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tconst _ = {}\n\tif (name) _.name = name;\n\tif (single) _.single = single;\n\tif (skip) _.skip = skip;\n\tif (grammar) _.grammar = grammar;\n\tif (typeof options !== 'undefined' && options.async) _.async = options.async;\n\tif (main === true) _.main = true;\n\tif (return_type) _.return_type = return_type;\n\tif (return_subtype) _.return_subtype = return_subtype;\n\tif (pure) _.pure = pure;\n\tif (tm_sig_fns) _.map_sigs = tm_sig_fns;\n\tif (Object.keys(_).length > 0) {\n\t\tres._ = _;\n\t}\n\treturn res;\n}\nconst convert = (input, conversion_schema) => {}\nlet arrayify = fp(function (a, sig) {\n\tlet param_index, num_parallel = 1,\n\t\tdelay = 0,\n\t\tfn;\n\tlet res;\n\tlet process_as_fn = function () {\n\t\tres = function () {\n\t\t\tlet a = arr_like_to_arr(arguments),\n\t\t\t\tts = atof(a),\n\t\t\t\tt = this;\n\t\t\tlet last_arg = a[a.length - 1];\n\t\t\tif (tof(last_arg) == 'function') {\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\n\t\t\t\t\tlet res = [];\n\t\t\t\t\tlet fns = [];\n\t\t\t\t\teach(a[param_index], function (v, i) {\n\t\t\t\t\t\tlet new_params = a.slice(0, a.length - 1);\n\t\t\t\t\t\tnew_params[param_index] = v;\n\t\t\t\t\t\tfns.push([t, fn, new_params]);\n\t\t\t\t\t});\n\t\t\t\t\tcall_multiple_callback_functions(fns, num_parallel, delay, (err, res) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tconsole.trace();\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet a = [];\n\t\t\t\t\t\t\ta = a.concat.apply(a, res);\n\t\t\t\t\t\t\tlet callback = last_arg;\n\t\t\t\t\t\t\tcallback(null, a);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treturn fn.apply(t, a);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (typeof param_index !== 'undefined' && ts[param_index] == 'array') {\n\t\t\t\t\tlet res = [];\n\t\t\t\t\tfor (let c = 0, l = a[param_index].length; c < l; c++) {\n\t\t\t\t\t\ta[param_index] = arguments[param_index][c];\n\t\t\t\t\t\tlet result = fn.apply(t, a);\n\t\t\t\t\t\tres.push(result);\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t} else {\n\t\t\t\t\treturn fn.apply(t, a);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\tif (sig == '[o]') {\n\t\tlet res = [];\n\t\teach(a[0], function (v, i) {\n\t\t\tres.push([v, i]);\n\t\t});\n\t} else if (sig == '[f]') {\n\t\tparam_index = 0, fn = a[0];\n\t\tprocess_as_fn();\n\t} else if (sig == '[n,f]') {\n\t\tparam_index = a[0], fn = a[1];\n\t\tprocess_as_fn();\n\t} else if (sig == '[n,n,f]') {\n\t\tparam_index = a[0], num_parallel = a[1], fn = a[2];\n\t\tprocess_as_fn();\n\t} else if (sig == '[n,n,n,f]') {\n\t\tparam_index = a[0], num_parallel = a[1], delay = a[2], fn = a[3];\n\t\tprocess_as_fn();\n\t}\n\treturn res;\n});\nlet mapify = (target) => {\n\tlet tt = tof(target);\n\tif (tt == 'function') {\n\t\tlet res = fp(function (a, sig) {\n\t\t\tlet that = this;\n\t\t\tif (sig == '[o]') {\n\t\t\t\tlet map = a[0];\n\t\t\t\teach(map, function (v, i) {\n\t\t\t\t\ttarget.call(that, v, i);\n\t\t\t\t});\n\t\t\t} else if (sig == '[o,f]') {\n\t\t\t\tlet map = a[0];\n\t\t\t\tlet callback = a[1];\n\t\t\t\tlet fns = [];\n\t\t\t\teach(map, function (v, i) {\n\t\t\t\t\tfns.push([target, [v, i]]);\n\t\t\t\t});\n\t\t\t\tcall_multi(fns, function (err_multi, res_multi) {\n\t\t\t\t\tif (err_multi) {\n\t\t\t\t\t\tcallback(err_multi);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(null, res_multi);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (a.length >= 2) {\n\t\t\t\ttarget.apply(this, a);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t} else if (tt == 'array') {\n\t\tlet res = {};\n\t\tif (arguments.length == 1) {\n\t\t\tif (is_arr_of_strs(target)) {\n\t\t\t\teach(target, function (v, i) {\n\t\t\t\t\tres[v] = true;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\teach(target, function (v, i) {\n\t\t\t\t\tres[v[0]] = v[1];\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tlet by_property_name = arguments[1];\n\t\t\teach(target, function (v, i) {\n\t\t\t\tres[v[by_property_name]] = v;\n\t\t\t});\n\t\t}\n\t\treturn res;\n\t}\n};\nlet clone = fp((a, sig) => {\n\tlet obj = a[0];\n\tif (a.l === 1) {\n\t\tif (obj && typeof obj.clone === 'function') {\n\t\t\treturn obj.clone();\n\t\t} else {\n\t\t\tlet t = tof(obj);\n\t\t\tif (t === 'array') {\n\t\t\t\tlet res = [];\n\t\t\t\teach(obj, v => {\n\t\t\t\t\tres.push(clone(v));\n\t\t\t\t});\n\t\t\t\treturn res;\n\t\t\t} else if (t === 'undefined') {\n\t\t\t\treturn undefined;\n\t\t\t} else if (t === 'string') {\n\t\t\t\treturn obj;\n\t\t\t} else if (t === 'number') {\n\t\t\t\treturn obj;\n\t\t\t} else if (t === 'function') {\n\t\t\t\treturn obj;\n\t\t\t} else if (t === 'boolean') {\n\t\t\t\treturn obj;\n\t\t\t} else if (t === 'null') {\n\t\t\t\treturn obj;\n\t\t\t} else {\n\t\t\t\treturn Object.assign({}, obj);\n\t\t\t}\n\t\t}\n\t} else if (a.l === 2 && tof(a[1]) === 'number') {\n\t\tlet res = [];\n\t\tfor (let c = 0; c < a[1]; c++) {\n\t\t\tres.push(clone(obj));\n\t\t}\n\t\treturn res;\n\t}\n});\nlet set_vals = function (obj, map) {\n\teach(map, function (v, i) {\n\t\tobj[i] = v;\n\t});\n};\nlet ll_set = (obj, prop_name, prop_value) => {\n\tlet arr = prop_name.split('.');\n\tlet c = 0,\n\t\tl = arr.length;\n\tlet i = obj._ || obj,\n\t\ts;\n\twhile (c < l) {\n\t\ts = arr[c];\n\t\tif (typeof i[s] == 'undefined') {\n\t\t\tif (c - l == -1) {\n\t\t\t\ti[s] = prop_value;\n\t\t\t} else {\n\t\t\t\ti[s] = {};\n\t\t\t}\n\t\t} else {\n\t\t\tif (c - l == -1) {\n\t\t\t\ti[s] = prop_value;\n\t\t\t}\n\t\t}\n\t\ti = i[s];\n\t\tc++;\n\t};\n\treturn prop_value;\n};\nlet ll_get = (a0, a1) => {\n\tif (a0 && a1) {\n\t\tlet i = a0._ || a0;\n\t\tif (a1 == '.') {\n\t\t\tif (typeof i['.'] == 'undefined') {\n\t\t\t\treturn undefined;\n\t\t\t} else {\n\t\t\t\treturn i['.'];\n\t\t\t}\n\t\t} else {\n\t\t\tlet arr = a1.split('.');\n\t\t\tlet c = 0,\n\t\t\t\tl = arr.length,\n\t\t\t\ts;\n\t\t\twhile (c < l) {\n\t\t\t\ts = arr[c];\n\t\t\t\tif (typeof i[s] == 'undefined') {\n\t\t\t\t\tif (c - l == -1) {} else {\n\t\t\t\t\t\tthrow 'object ' + s + ' not found';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (c - l == -1) {\n\t\t\t\t\t\treturn i[s];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ti = i[s];\n\t\t\t\tc++;\n\t\t\t}\n\t\t}\n\t}\n};\nlet truth = function (value) {\n\treturn value === true;\n};\nlet iterate_ancestor_classes = (obj, callback) => {\n\tlet ctu = true;\n\tlet stop = () => {\n\t\tctu = false;\n\t}\n\tcallback(obj, stop);\n\tif (obj._superclass && ctu) {\n\t\titerate_ancestor_classes(obj._superclass, callback);\n\t}\n}\nlet is_arr_of_t = function (obj, type_name) {\n\tlet t = tof(obj),\n\t\ttv;\n\tif (t === 'array') {\n\t\tlet res = true;\n\t\teach(obj, function (v, i) {\n\t\t\ttv = tof(v);\n\t\t\tif (tv != type_name) res = false;\n\t\t});\n\t\treturn res;\n\t} else {\n\t\treturn false;\n\t}\n}\nlet is_arr_of_arrs = function (obj) {\n\treturn is_arr_of_t(obj, 'array');\n}\nlet is_arr_of_strs = function (obj) {\n\treturn is_arr_of_t(obj, 'string');\n}\nlet input_processors = {};\nlet output_processors = {};\nlet call_multiple_callback_functions = fp(function (a, sig) {\n\tlet arr_functions_params_pairs, callback, return_params = false;\n\tlet delay;\n\tlet num_parallel = 1;\n\tif (a.l === 1) {\n\t} else if (a.l === 2) {\n\t\tarr_functions_params_pairs = a[0];\n\t\tcallback = a[1];\n\t} else if (a.l === 3) {\n\t\tif (sig === '[a,n,f]') {\n\t\t\tarr_functions_params_pairs = a[0];\n\t\t\tnum_parallel = a[1];\n\t\t\tcallback = a[2];\n\t\t} else if (sig === '[n,a,f]') {\n\t\t\tarr_functions_params_pairs = a[1];\n\t\t\tnum_parallel = a[0];\n\t\t\tcallback = a[2];\n\t\t} else if (sig === '[a,f,b]') {\n\t\t\tarr_functions_params_pairs = a[0];\n\t\t\tcallback = a[1];\n\t\t\treturn_params = a[2];\n\t\t}\n\t} else if (a.l === 4) {\n\t\tif (sig === '[a,n,n,f]') {\n\t\t\tarr_functions_params_pairs = a[0];\n\t\t\tnum_parallel = a[1];\n\t\t\tdelay = a[2];\n\t\t\tcallback = a[3];\n\t\t} else if (sig == '[n,n,a,f]') {\n\t\t\tarr_functions_params_pairs = a[2];\n\t\t\tnum_parallel = a[0];\n\t\t\tdelay = a[1];\n\t\t\tcallback = a[3];\n\t\t}\n\t}\n\tlet res = [];\n\tlet l = arr_functions_params_pairs.length;\n\tlet c = 0;\n\tlet count_unfinished = l;\n\tlet num_currently_executing = 0;\n\tlet process = delay => {\n\t\tnum_currently_executing++;\n\t\tlet main = () => {\n\t\t\tlet pair = arr_functions_params_pairs[c];\n\t\t\tlet context;\n\t\t\tlet fn, params, fn_callback;\n\t\t\tlet pair_sig = get_item_sig(pair);\n\t\t\tlet t_pair = tof(pair);\n\t\t\tif (t_pair == 'function') {\n\t\t\t\tfn = pair;\n\t\t\t\tparams = [];\n\t\t\t} else {\n\t\t\t\tif (pair) {\n\t\t\t\t\tif (pair.length == 1) {}\n\t\t\t\t\tif (pair.length == 2) {\n\t\t\t\t\t\tif (tof(pair[1]) == 'function') {\n\t\t\t\t\t\t\tcontext = pair[0];\n\t\t\t\t\t\t\tfn = pair[1];\n\t\t\t\t\t\t\tparams = [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfn = pair[0];\n\t\t\t\t\t\t\tparams = pair[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (pair.length == 3) {\n\t\t\t\t\t\tif (tof(pair[0]) === 'function' && tof(pair[1]) === 'array' && tof(pair[2]) === 'function') {\n\t\t\t\t\t\t\tfn = pair[0];\n\t\t\t\t\t\t\tparams = pair[1];\n\t\t\t\t\t\t\tfn_callback = pair[2];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tof(pair[1]) === 'function' && tof(pair[2]) === 'array') {\n\t\t\t\t\t\t\tcontext = pair[0];\n\t\t\t\t\t\t\tfn = pair[1];\n\t\t\t\t\t\t\tparams = pair[2];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (pair.length == 4) {\n\t\t\t\t\t\tcontext = pair[0];\n\t\t\t\t\t\tfn = pair[1];\n\t\t\t\t\t\tparams = pair[2];\n\t\t\t\t\t\tfn_callback = pair[3];\n\t\t\t\t\t}\n\t\t\t\t} else {}\n\t\t\t}\n\t\t\tlet i = c;\n\t\t\tc++;\n\t\t\tlet cb = (err, res2) => {\n\t\t\t\tnum_currently_executing--;\n\t\t\t\tcount_unfinished--;\n\t\t\t\tif (err) {\n\t\t\t\t\tlet stack = new Error().stack;\n\t\t\t\t\tcallback(err);\n\t\t\t\t} else {\n\t\t\t\t\tif (return_params) {\n\t\t\t\t\t\tres[i] = [params, res2];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres[i] = res2;\n\t\t\t\t\t}\n\t\t\t\t\tif (fn_callback) {\n\t\t\t\t\t\tfn_callback(null, res2);\n\t\t\t\t\t}\n\t\t\t\t\tif (c < l) {\n\t\t\t\t\t\tif (num_currently_executing < num_parallel) {\n\t\t\t\t\t\t\tprocess(delay);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (count_unfinished <= 0) {\n\t\t\t\t\t\t\tcallback(null, res);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tlet arr_to_call = params || [];\n\t\t\tarr_to_call.push(cb);\n\t\t\tif (fn) {\n\t\t\t\tif (context) {\n\t\t\t\t\tfn.apply(context, arr_to_call);\n\t\t\t\t} else {\n\t\t\t\t\tfn.apply(this, arr_to_call);\n\t\t\t\t}\n\t\t\t} else {}\n\t\t}\n\t\tif (arr_functions_params_pairs[c]) {\n\t\t\tif (delay) {\n\t\t\t\tsetTimeout(main, delay);\n\t\t\t} else {\n\t\t\t\tmain();\n\t\t\t}\n\t\t}\n\t}\n\tif (arr_functions_params_pairs.length > 0) {\n\t\twhile ((c < l) && (num_currently_executing < num_parallel)) {\n\t\t\tif (delay) {\n\t\t\t\tprocess(delay * c);\n\t\t\t} else {\n\t\t\t\tprocess();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (callback) {}\n\t}\n});\nlet multi = call_multiple_callback_functions;\nlet call_multi = call_multiple_callback_functions;\nlet Fns = function (arr) {\n\tlet fns = arr || [];\n\tfns.go = function (parallel, delay, callback) {\n\t\tlet a = arguments;\n\t\tlet al = a.length;\n\t\tif (al == 1) {\n\t\t\tcall_multi(fns, a[0]);\n\t\t}\n\t\tif (al == 2) {\n\t\t\tcall_multi(parallel, fns, delay);\n\t\t}\n\t\tif (al == 3) {\n\t\t\tcall_multi(parallel, delay, fns, callback);\n\t\t}\n\t}\n\treturn fns;\n}\nlet native_constructor_tof = function (value) {\n\tif (value === String) {\n\t\treturn 'String';\n\t}\n\tif (value === Number) {\n\t\treturn 'Number';\n\t}\n\tif (value === Boolean) {\n\t\treturn 'Boolean';\n\t}\n\tif (value === Array) {\n\t\treturn 'Array';\n\t}\n\tif (value === Object) {\n\t\treturn 'Object';\n\t}\n}\nlet sig_match = function (sig1, sig2) {\n\tlet sig1_inner = sig1.substr(1, sig1.length - 2);\n\tlet sig2_inner = sig2.substr(1, sig2.length - 2);\n\tif (sig1_inner.indexOf('[') > -1 || sig1_inner.indexOf(']') > -1 || sig2_inner.indexOf('[') > -1 || sig2_inner.indexOf(']') > -1) {\n\t\tthrow 'sig_match only supports flat signatures.';\n\t}\n\tlet sig1_parts = sig1_inner.split(',');\n\tlet sig2_parts = sig2_inner.split(',');\n\tlet res = true;\n\tif (sig1_parts.length == sig2_parts.length) {\n\t\tlet c = 0,\n\t\t\tl = sig1_parts.length,\n\t\t\ti1, i2;\n\t\twhile (res && c < l) {\n\t\t\ti1 = sig1_parts[c];\n\t\t\ti2 = sig2_parts[c];\n\t\t\tif (i1 === i2) {} else {\n\t\t\t\tif (i1 !== '?') {\n\t\t\t\t\tres = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tc++;\n\t\t}\n\t\treturn res;\n\t} else {\n\t\treturn false;\n\t}\n}\nlet remove_sig_from_arr_shell = function (sig) {\n\tif (sig[0] == '[' && sig[sig.length - 1] == ']') {\n\t\treturn sig.substring(1, sig.length - 1);\n\t}\n\treturn sig;\n};\nlet str_arr_mapify = function (fn) {\n\tlet res = fp(function (a, sig) {\n\t\tif (a.l == 1) {\n\t\t\tif (sig == '[s]') {\n\t\t\t\tlet s_pn = a[0].split(' ');\n\t\t\t\tif (s_pn.length > 1) {\n\t\t\t\t\treturn res.call(this, s_pn);\n\t\t\t\t} else {\n\t\t\t\t\treturn fn.call(this, a[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (tof(a[0]) == 'array') {\n\t\t\t\tlet res2 = {},\n\t\t\t\t\tthat = this;\n\t\t\t\teach(a[0], function (v, i) {\n\t\t\t\t\tres2[v] = fn.call(that, v);\n\t\t\t\t});\n\t\t\t\treturn res2;\n\t\t\t}\n\t\t}\n\t});\n\treturn res;\n};\nlet to_arr_strip_keys = (obj) => {\n\tlet res = [];\n\teach(obj, v => {\n\t\tres.push(v);\n\t});\n\treturn res;\n}\nlet arr_objs_to_arr_keys_values_table = (arr_objs) => {\n\tlet keys = Object.keys(arr_objs[0]);\n\tlet arr_items = [],\n\t\tarr_values;\n\teach(arr_objs, (item) => {\n\t\tarr_items.push(to_arr_strip_keys(item));\n\t});\n\treturn [keys, arr_items];\n}\nlet set_arr_tree_value = (arr_tree, arr_path, value) => {\n\tlet item_current = arr_tree;\n\tlet last_item_current, last_path_item;\n\teach(arr_path, (path_item) => {\n\t\tlast_item_current = item_current;\n\t\titem_current = item_current[path_item];\n\t\tlast_path_item = path_item;\n\t});\n\tlast_item_current[last_path_item] = value;\n}\nlet get_arr_tree_value = (arr_tree, arr_path) => {\n\tlet item_current = arr_tree;\n\teach(arr_path, (path_item) => {\n\t\titem_current = item_current[path_item];\n\t});\n\treturn item_current;\n}\nlet deep_arr_iterate = (arr, path = [], callback) => {\n\tif (arguments.length === 2) {\n\t\tcallback = path;\n\t\tpath = [];\n\t}\n\teach(arr, (item, i) => {\n\t\tlet c_path = clone(path);\n\t\tc_path.push(i);\n\t\tlet t = tof(item);\n\t\tif (t === 'array') {\n\t\t\tdeep_arr_iterate(item, c_path, callback);\n\t\t} else {\n\t\t\tcallback(c_path, item);\n\t\t}\n\t})\n}\nlet prom = (fn) => {\n\tlet fn_res = function () {\n\t\tconst a = arguments;\n\t\tconst t_a_last = typeof a[a.length - 1];\n\t\tif (t_a_last === 'function') {\n\t\t\tfn.apply(this, a);\n\t\t} else {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t[].push.call(a, (err, res) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfn.apply(this, a);\n\t\t\t})\n\t\t}\n\t}\n\treturn fn_res;\n}\nconst vectorify = n_fn => {\n\tlet fn_res = fp(function (a, sig) {\n\t\tif (a.l > 2) {\n\t\t\tthrow 'stop - need to check.'\n\t\t\tlet res = a[0];\n\t\t\tfor (let c = 1, l = a.l; c < l; c++) {\n\t\t\t\tres = fn_res(res, a[c]);\n\t\t\t}\n\t\t\treturn res;\n\t\t} else {\n\t\t\tif (sig === '[n,n]') {\n\t\t\t\treturn n_fn(a[0], a[1]);\n\t\t\t} else {\n\t\t\t\tconst ats = atof(a);\n\t\t\t\tif (ats[0] === 'array') {\n\t\t\t\t\tif (ats[1] === 'number') {\n\t\t\t\t\t\tconst res = [],\n\t\t\t\t\t\t\tn = a[1],\n\t\t\t\t\t\t\tl = a[0].length\n\t\t\t\t\t\tlet c;\n\t\t\t\t\t\tfor (c = 0; c < l; c++) {\n\t\t\t\t\t\t\tres.push(fn_res(a[0][c], n));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t} else if (ats[1] === 'array') {\n\t\t\t\t\t\tif (ats[0].length !== ats[1].length) {\n\t\t\t\t\t\t\tthrow 'vector array lengths mismatch';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst l = a[0].length, res = new Array(l),\n\t\t\t\t\t\t\t\tarr2 = a[1];\n\t\t\t\t\t\t\tfor (let c = 0; c < l; c++) {\n\t\t\t\t\t\t\t\tres[c] = fn_res(a[0][c], arr2[c]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t});\n\treturn fn_res;\n};\nconst n_add = (n1, n2) => n1 + n2,\n\tn_subtract = (n1, n2) => n1 - n2,\n\tn_multiply = (n1, n2) => n1 * n2,\n\tn_divide = (n1, n2) => n1 / n2;\nconst v_add = vectorify(n_add),\n\tv_subtract = vectorify(n_subtract),\n\tv_multiply = vectorify(n_multiply),\n\tv_divide = vectorify(n_divide);\nconst vector_magnitude = function (vector) {\n\t// may calculate magnitudes of larger dimension vectors too.\n\t// alert(tof(vector[0]));\n\t// alert(vector[0] ^ 2);\n\tvar res = Math.sqrt((Math.pow(vector[0], 2)) + (Math.pow(vector[1], 2)));\n\treturn res;\n};\nconst distance_between_points = function (points) {\n\tvar offset = v_subtract(points[1], points[0]);\n\t//console.log('offset ' + stringify(offset));\n\treturn vector_magnitude(offset);\n}\n// ui8c?\n//  ui8x???  for both?\n//  \n// Getting into some lower level types here.\n//   Consider specifying endianness for numbers.\n// Specify things from the basics.\n//   Have the descriptions make sense in English and programatically.\n//   Have it understand the descriptions of data types including signifiers and representations.\n// srtype.add_representation(...)\n//   .representations.add\n// or 'rep' function.\n//  rep(str_tsig_name, definition of representaion / instructions)\nconst map_tas_by_type = {\n\t'c': Uint8ClampedArray,\n\t'ui8': Uint8Array,\n\t'i16': Int16Array,\n\t'i32': Int32Array,\n\t'ui16': Uint16Array,\n\t'ui32': Uint32Array,\n\t'f32': Float32Array,\n\t'f64': Float64Array\n}\nconst get_typed_array = function () {\n\tconst a = arguments;\n\tlet length, input_array;\n\tconst type = a[0];\n\tif (is_array(a[1])) {\n\t\tinput_array = a[1];\n\t} else {\n\t\tlength = a[1];\n\t}\n\tconst ctr = map_tas_by_type[type];\n\tif (ctr) {\n\t\tif (input_array) {\n\t\t\treturn new ctr(input_array);\n\t\t} else if (length) {\n\t\t\treturn new ctr(length);\n\t\t}\n\t}\n}\n\n// Grammar class may be a bit tricky / complex.\n//   Maybe it will help because it can be used to define objects easily???\n//   Maybe need to get into much more detail??? Maybe a quick and efficient piece of grammar code could work here.\n\nclass Grammar {\n\tconstructor(spec) {\n\t\tconst eg_spec = {\n\t\t\tname: 'User Auth Grammar'\n\t\t}\n\t\tconst {\n\t\t\tname\n\t\t} = spec;\n\t\tthis.name = name;\n\t\tconst eg_indexing = () => {\n\t\t\tlet map_sing_plur = {};\n\t\t\tlet map_plur_sing = {};\n\t\t\tlet map_sing_def = {};\n\t\t\tlet map_sig_sing = {};\n\t\t\tlet map_sig0_sing = {};\n\t\t\tlet map_sig1_sing = {};\n\t\t\tlet map_sig2_sing = {};\n\t\t}\n\t\tthis.maps = {\n\t\t\tsing_plur: {},\n\t\t\tplur_sing: {},\n\t\t\tsing_def: {},\n\t\t\tdeep_sig_sing: {},\n\t\t\tobj_sig_sing: {},\n\t\t\tsig_levels_sing: {}\n\t\t}\n\t\tthis.load_grammar(spec.def);\n\t}\n\tload_grammar(grammar_def) {\n\t\tconst {\n\t\t\tsing_plur,\n\t\t\tplur_sing,\n\t\t\tsing_def,\n\t\t\tsig_levels_sing,\n\t\t\tdeep_sig_sing,\n\t\t\tobj_sig_sing\n\t\t} = this.maps;\n\t\tconst resolve_def = (def) => {\n\t\t\tconst td = tf(def);\n\t\t\tif (td === 'a') {\n\t\t\t\tconst res = [];\n\t\t\t\teach(def, def_item => {\n\t\t\t\t\tres.push(resolve_def(def_item));\n\t\t\t\t});\n\t\t\t\treturn res;\n\t\t\t} else if (td === 's') {\n\t\t\t\tif (def === 'string') {\n\t\t\t\t\treturn 'string';\n\t\t\t\t} else if (def === 'number') {\n\t\t\t\t\treturn 'number';\n\t\t\t\t} else if (def === 'boolean') {\n\t\t\t\t\treturn 'boolean';\n\t\t\t\t} else {\n\t\t\t\t\tconst found_sing_def = sing_def[def];\n\t\t\t\t\treturn found_sing_def;\n\t\t\t\t}\n\t\t\t} else if (td === 'n') {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'NYI';\n\t\t\t} else if (td === 'b') {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'NYI';\n\t\t\t}\n\t\t}\n\t\tconst resolved_def_to_sig = (resolved_def, level = 0) => {\n\t\t\tconst trd = tf(resolved_def);\n\t\t\tif (trd === 's') {\n\t\t\t\tif (resolved_def === 'string') {\n\t\t\t\t\treturn 's'\n\t\t\t\t} else if (resolved_def === 'number') {\n\t\t\t\t\treturn 'n'\n\t\t\t\t} else if (resolved_def === 'boolean') {\n\t\t\t\t\treturn 'b'\n\t\t\t\t}\n\t\t\t} else if (trd === 'a') {\n\t\t\t\tlet res = '';\n\t\t\t\tif (level === 0) {} else {\n\t\t\t\t\tres = res + '[';\n\t\t\t\t}\n\t\t\t\teach(resolved_def, (item, c) => {\n\t\t\t\t\tif (c > 0) {\n\t\t\t\t\t\tres = res + ',';\n\t\t\t\t\t}\n\t\t\t\t\tres = res + resolved_def_to_sig(item, level + 1);\n\t\t\t\t});\n\t\t\t\tif (level === 0) {} else {\n\t\t\t\t\tres = res + ']';\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t} else {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'NYI';\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t\teach(grammar_def, (def1, sing_word) => {\n\t\t\tconst {\n\t\t\t\tdef,\n\t\t\t\tplural\n\t\t\t} = def1;\n\t\t\tsing_def[sing_word] = def;\n\t\t\tsing_plur[sing_word] = plural;\n\t\t\tplur_sing[plural] = sing_word;\n\t\t\tconst tdef = tf(def);\n\t\t\tconst resolved_def = resolve_def(def);\n\t\t\tconst resolved_def_sig = resolved_def_to_sig(resolved_def);\n\t\t\tdeep_sig_sing[resolved_def_sig] = deep_sig_sing[resolved_def_sig] || [];\n\t\t\tdeep_sig_sing[resolved_def_sig].push(sing_word);\n\t\t\tlet def_is_all_custom_types = true;\n\t\t\teach(def, (def_item, c, stop) => {\n\t\t\t\tconst tdi = tf(def_item);\n\t\t\t\tif (tdi === 's') {\n\t\t\t\t\tif (sing_def[def_item]) {} else {\n\t\t\t\t\t\tdef_is_all_custom_types = false;\n\t\t\t\t\t\tstop();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdef_is_all_custom_types = false;\n\t\t\t\t\tstop();\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet obj_sig;\n\t\t\tif (def_is_all_custom_types) {\n\t\t\t\tobj_sig = '{';\n\t\t\t\teach(def, (def_item, c, stop) => {\n\t\t\t\t\tif (c > 0) {\n\t\t\t\t\t\tobj_sig = obj_sig + ',';\n\t\t\t\t\t}\n\t\t\t\t\tconst resolved = resolve_def(def_item);\n\t\t\t\t\tconst abr_resolved = resolved_def_to_sig(resolved);\n\t\t\t\t\tobj_sig = obj_sig + '\"' + def_item + '\":'\n\t\t\t\t\tobj_sig = obj_sig + abr_resolved;\n\t\t\t\t});\n\t\t\t\tobj_sig = obj_sig + '}';\n\t\t\t}\n\t\t\tif (obj_sig) {\n\t\t\t\tobj_sig_sing[obj_sig] = obj_sig_sing[obj_sig] || [];\n\t\t\t\tobj_sig_sing[obj_sig].push(sing_word);\n\t\t\t}\n\t\t})\n\t}\n\ttof(item) {\n\t\tconst {\n\t\t\tsing_plur,\n\t\t\tplur_sing,\n\t\t\tsing_def,\n\t\t\tsig_levels_sing,\n\t\t\tdeep_sig_sing,\n\t\t\tobj_sig_sing\n\t\t} = this.maps;\n\t\tconst titem = tf(item);\n\t\tconsole.log('titem', titem);\n\t\tif (titem === 'a') {\n\t\t\tlet all_arr_items_type;\n\t\t\teach(item, (subitem, c, stop) => {\n\t\t\t\tconst subitem_type = this.tof(subitem);\n\t\t\t\tconsole.log('subitem_type', subitem_type);\n\t\t\t\tif (c === 0) {\n\t\t\t\t\tall_arr_items_type = subitem_type;\n\t\t\t\t} else {\n\t\t\t\t\tif (all_arr_items_type === subitem_type) {} else {\n\t\t\t\t\t\tall_arr_items_type = null;\n\t\t\t\t\t\tstop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (all_arr_items_type) {\n\t\t\t\tconsole.log('has all_arr_items_type', all_arr_items_type);\n\t\t\t\tif (!map_native_types[all_arr_items_type]) {\n\t\t\t\t\tconst res = sing_plur[all_arr_items_type];\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('no all_arr_items_type');\n\t\t\t}\n\t\t} else {\n\t\t\treturn tof(item);\n\t\t}\n\t\tconst item_deep_sig = deep_sig(item);\n\t\tconsole.log('Grammar tof() item_deep_sig', item_deep_sig);\n\t\tlet arr_sing;\n\t\tif (titem === 'a') {\n\t\t\tconst unenclosed_sig = item_deep_sig.substring(1, item_deep_sig.length - 1);\n\t\t\tconsole.log('unenclosed_sig', unenclosed_sig);\n\t\t\tarr_sing = deep_sig_sing[unenclosed_sig];\n\t\t} else {\n\t\t\tarr_sing = deep_sig_sing[item_deep_sig];\n\t\t}\n\t\tif (arr_sing) {\n\t\t\tif (arr_sing.length === 1) {\n\t\t\t\treturn arr_sing[0];\n\t\t\t} else {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'NYI';\n\t\t\t}\n\t\t}\n\t}\n\tsig(item, max_depth = -1, depth = 0) {\n\t\tconst {\n\t\t\tsing_plur,\n\t\t\tplur_sing,\n\t\t\tsing_def,\n\t\t\tsig_levels_sing,\n\t\t\tdeep_sig_sing,\n\t\t\tobj_sig_sing\n\t\t} = this.maps;\n\t\tconst extended_sig = item => {\n\t\t\tconst ti = tf(item);\n\t\t\tlet res = '';\n\t\t\tlet same_grammar_type;\n\t\t\tconst record_subitem_sigs = item => {\n\t\t\t\tsame_grammar_type = undefined;\n\t\t\t\tlet same_sig = undefined;\n\t\t\t\teach(item, (subitem, c) => {\n\t\t\t\t\tif (c > 0) {\n\t\t\t\t\t\tres = res + ',';\n\t\t\t\t\t}\n\t\t\t\t\tconst sig_subitem = this.sig(subitem, max_depth, depth + 1);\n\t\t\t\t\tif (same_sig === undefined) {\n\t\t\t\t\t\tsame_sig = sig_subitem;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (sig_subitem !== same_sig) {\n\t\t\t\t\t\t\tsame_sig = false;\n\t\t\t\t\t\t\tsame_grammar_type = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (same_sig) {\n\t\t\t\t\t\tif (sing_def[sig_subitem]) {\n\t\t\t\t\t\t\tif (same_grammar_type === undefined) {\n\t\t\t\t\t\t\t\tsame_grammar_type = sig_subitem;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (same_grammar_type === sig_subitem) {} else {\n\t\t\t\t\t\t\t\t\tsame_grammar_type = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {}\n\t\t\t\t\t}\n\t\t\t\t\tres = res + sig_subitem;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (ti === 'A') {\n\t\t\t\trecord_subitem_sigs(item);\n\t\t\t\treturn res;\n\t\t\t} else if (ti === 'a') {\n\t\t\t\trecord_subitem_sigs(item);\n\t\t\t\tif (same_grammar_type) {\n\t\t\t\t\tconst plur_name = sing_plur[same_grammar_type];\n\t\t\t\t\treturn plur_name;\n\t\t\t\t} else {\n\t\t\t\t\tconst found_obj_type = obj_sig_sing[res];\n\t\t\t\t\tconst found_deep_sig_type = deep_sig_sing[res];\n\t\t\t\t\tlet found_type_sing;\n\t\t\t\t\tif (found_deep_sig_type) {\n\t\t\t\t\t\tif (found_deep_sig_type.length === 1) {\n\t\t\t\t\t\t\tfound_type_sing = found_deep_sig_type[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (found_type_sing) {\n\t\t\t\t\t\treturn found_type_sing;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst enclosed_res = '[' + res + ']';\n\t\t\t\t\t\treturn enclosed_res;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (ti === 'o') {\n\t\t\t\tif (max_depth === -1 || depth <= max_depth) {\n\t\t\t\t\tres = res + '{';\n\t\t\t\t\tlet first = true;\n\t\t\t\t\teach(item, (value, key) => {\n\t\t\t\t\t\tconst vsig = this.sig(value, max_depth, depth + 1);\n\t\t\t\t\t\tif (!first) {\n\t\t\t\t\t\t\tres = res + ',';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = res + '\"' + key + '\":' + vsig;\n\t\t\t\t\t});\n\t\t\t\t\tres = res + '}';\n\t\t\t\t\treturn res;\n\t\t\t\t} else {\n\t\t\t\t\treturn 'o';\n\t\t\t\t}\n\t\t\t} else if (ti === 's' || ti === 'n' || ti === 'b') {\n\t\t\t\treturn ti;\n\t\t\t} else {\n\t\t\t\treturn ti;\n\t\t\t}\n\t\t}\n\t\treturn extended_sig(item);\n\t}\n\tsingle_forms_sig(item) {\n\t\tconst {\n\t\t\tsing_plur,\n\t\t\tplur_sing,\n\t\t\tsing_def,\n\t\t\tsig_levels_sing,\n\t\t\tdeep_sig_sing,\n\t\t\tobj_sig_sing\n\t\t} = this.maps;\n\t\tlet sig = this.sig(item);\n\t\tlet s_sig = sig.split(',');\n\t\tconst arr_res = [];\n\t\teach(s_sig, (sig_item, c) => {\n\t\t\tconst sing = plur_sing[sig_item] || sig_item;\n\t\t\tarr_res.push(sing);\n\t\t});\n\t\tconst res = arr_res.join(',');\n\t\treturn res;\n\t}\n}\nclass Evented_Class {\n\t'constructor'() {\n\t\tObject.defineProperty(this, '_bound_events', {\n\t\t\tvalue: {}\n\t\t});\n\t}\n\t'raise_event'() {\n\t\tlet a = Array.prototype.slice.call(arguments),\n\t\t\tsig = get_a_sig(a);\n\t\ta.l = a.length;\n\t\tlet target = this;\n\t\tlet c, l, res;\n\t\tif (sig === '[s]') {\n\t\t\tlet target = this;\n\t\t\tlet event_name = a[0];\n\t\t\tlet bgh = this._bound_general_handler;\n\t\t\tlet be = this._bound_events;\n\t\t\tres = [];\n\t\t\tif (bgh) {\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\n\t\t\t\t\tres.push(bgh[c].call(target, event_name));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (be) {\n\t\t\t\tlet bei = be[event_name];\n\t\t\t\tif (tof(bei) == 'array') {\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\n\t\t\t\t\t\tres.push(bei[c].call(target));\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (sig === '[s,a]') {\n\t\t\tlet be = this._bound_events;\n\t\t\tlet bgh = this._bound_general_handler;\n\t\t\tlet event_name = a[0];\n\t\t\tres = [];\n\t\t\tif (bgh) {\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (be) {\n\t\t\t\tlet bei = be[event_name];\n\t\t\t\tif (tof(bei) === 'array') {\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (sig === '[s,b]' || sig === '[s,s]' || sig === '[s,n]' || sig === '[s,B]' || sig === '[s,O]' || sig === '[s,e]') {\n\t\t\tlet be = this._bound_events;\n\t\t\tlet bgh = this._bound_general_handler;\n\t\t\tlet event_name = a[0];\n\t\t\tres = [];\n\t\t\tif (bgh) {\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (be) {\n\t\t\t\tlet bei = be[event_name];\n\t\t\t\tif (tof(bei) === 'array') {\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (sig === '[s,o]' || sig === '[s,?]') {\n\t\t\tlet be = this._bound_events;\n\t\t\tlet bgh = this._bound_general_handler;\n\t\t\tlet event_name = a[0];\n\t\t\tres = [];\n\t\t\tif (bgh) {\n\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\n\t\t\t\t\tres.push(bgh[c].call(target, event_name, a[1]));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (be) {\n\t\t\t\tlet bei = be[event_name];\n\t\t\t\tif (tof(bei) === 'array') {\n\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\n\t\t\t\t\t\tres.push(bei[c].call(target, a[1]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (a.l > 2) {\n\t\t\t\tlet event_name = a[0];\n\t\t\t\tlet additional_args = [];\n\t\t\t\tlet bgh_args = [event_name];\n\t\t\t\tfor (c = 1, l = a.l; c < l; c++) {\n\t\t\t\t\tadditional_args.push(a[c]);\n\t\t\t\t\tbgh_args.push(a[c]);\n\t\t\t\t}\n\t\t\t\tlet be = this._bound_events;\n\t\t\t\tlet bgh = this._bound_general_handler;\n\t\t\t\tres = [];\n\t\t\t\tif (bgh) {\n\t\t\t\t\tfor (c = 0, l = bgh.length; c < l; c++) {\n\t\t\t\t\t\tres.push(bgh[c].apply(target, bgh_args));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (be) {\n\t\t\t\t\tlet bei = be[event_name];\n\t\t\t\t\tif (tof(bei) == 'array') {\n\t\t\t\t\t\tif (bei.length > 0) {\n\t\t\t\t\t\t\tfor (c = 0, l = bei.length; c < l; c++) {\n\t\t\t\t\t\t\t\tif (bei[c]) res.push(bei[c].apply(target, additional_args));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {}\n\t\t}\n\t\treturn res;\n\t}\n\t'add_event_listener'() {\n\t\tconst {\n\t\t\tevent_events\n\t\t} = this;\n\t\tlet a = Array.prototype.slice.call(arguments),\n\t\t\tsig = get_a_sig(a);\n\t\tif (sig === '[f]') {\n\t\t\tthis._bound_general_handler = this._bound_general_handler || [];\n\t\t\tif (is_array(this._bound_general_handler)) {\n\t\t\t\tthis._bound_general_handler.push(a[0]);\n\t\t\t};\n\t\t}\n\t\tif (sig === '[s,f]') {\n\t\t\tlet event_name = a[0],\n\t\t\t\tfn_listener = a[1];\n\t\t\tif (!this._bound_events[event_name]) this._bound_events[event_name] = [];\n\t\t\tlet bei = this._bound_events[event_name];\n\t\t\tif (is_array(bei)) {\n\t\t\t\tbei.push(fn_listener);\n\t\t\t\tif (event_events) {\n\t\t\t\t\tthis.raise('add-event-listener', {\n\t\t\t\t\t\t'name': event_name\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'Expected: array';\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\t'remove_event_listener'(event_name, fn_listener) {\n\t\tconst {\n\t\t\tevent_events\n\t\t} = this;\n\t\tif (this._bound_events) {\n\t\t\tlet bei = this._bound_events[event_name] || [];\n\t\t\tif (is_array(bei)) {\n\t\t\t\tlet c = 0,\n\t\t\t\t\tl = bei.length,\n\t\t\t\t\tfound = false;\n\t\t\t\twhile (!found && c < l) {\n\t\t\t\t\tif (bei[c] === fn_listener) {\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (found) {\n\t\t\t\t\tbei.splice(c, 1);\n\t\t\t\t\tif (event_events) {\n\t\t\t\t\t\tthis.raise('remove-event-listener', {\n\t\t\t\t\t\t\t'name': event_name\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.trace();\n\t\t\t\tthrow 'Expected: array';\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tget bound_named_event_counts() {\n\t\tconst res = {};\n\t\tif (this._bound_events) {\n\t\t\tconst keys = Object.keys(this._bound_events);\n\t\t\teach(keys, key => {\n\t\t\t\tres[key] = this._bound_events[key].length;\n\t\t\t})\n\t\t}\n\t\treturn res;\n\t}\n\t'one'(event_name, fn_handler) {\n\t\tlet inner_handler = function (e) {\n\t\t\tfn_handler.call(this, e);\n\t\t\tthis.off(event_name, inner_handler);\n\t\t};\n\t\tthis.on(event_name, inner_handler);\n\t}\n\t'changes'(obj_changes) {\n\t\tif (!this.map_changes) {\n\t\t\tthis.map_changes = {};\n\t\t}\n\t\teach(obj_changes, (handler, name) => {\n\t\t\tthis.map_changes[name] = this.map_changes[name] || [];\n\t\t\tthis.map_changes[name].push(handler);\n\t\t})\n\t\tif (!this._using_changes) {\n\t\t\tthis._using_changes = true;\n\t\t\tthis.on('change', e_change => {\n\t\t\t\tconst {\n\t\t\t\t\tname,\n\t\t\t\t\tvalue\n\t\t\t\t} = e_change;\n\t\t\t\tif (this.map_changes[name]) {\n\t\t\t\t\teach(this.map_changes[name], h_change => {\n\t\t\t\t\t\th_change(value);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n};\nconst p = Evented_Class.prototype;\np.raise = p.raise_event;\np.trigger = p.raise_event;\np.subscribe = p.add_event_listener;\np.on = p.add_event_listener;\np.off = p.remove_event_listener;\nconst eventify = obj => {\n\tconst bound_events = {};\n\tconst add_event_listener = (name, handler) => {\n\t\tif (handler === undefined && typeof name === 'function') {\n\t\t\thandler = name;\n\t\t\tname = '';\n\t\t}\n\t\tif (!bound_events[name]) bound_events[name] = [];\n\t\tbound_events[name].push(handler);\n\t}\n\tconst remove_event_listener = (name, handler) => {\n\t\tif (bound_events[name]) {\n\t\t\tconst i = bound_events[name].indexOf(handler);\n\t\t\tif (i > -1) {\n\t\t\t\tbound_events[name].splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\tconst raise_event = (name, optional_param) => {\n\t\tconst arr_named_events = bound_events[name];\n\t\tif (arr_named_events !== undefined) {\n\t\t\tif (optional_param !== undefined) {\n\t\t\t\tconst l = arr_named_events.length;\n\t\t\t\tfor (let c = 0; c < l; c++) {\n\t\t\t\t\tarr_named_events[c].call(obj, optional_param);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst l = arr_named_events.length;\n\t\t\t\tfor (let c = 0; c < l; c++) {\n\t\t\t\t\tarr_named_events[c].call(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tobj.on = obj.add_event_listener = add_event_listener;\n\tobj.off = obj.remove_event_listener = remove_event_listener;\n\tobj.raise = obj.raise_event = raise_event;\n\treturn obj;\n}\n\n// Assign_From_Spec_Class\n\n\n// Assign_From_Spec_Evented_Class\n\n\n\n\nclass Publisher extends Evented_Class {\n\tconstructor(spec = {}) {\n\t\tsuper({});\n\t\tthis.one('ready', () => {\n\t\t\tthis.is_ready = true;\n\t\t})\n\t}\n\tget when_ready () {\n\t\treturn new Promise((solve, jettison) => {\n\t\t\tif (this.is_ready === true) {\n\t\t\t\tsolve();\n\t\t\t} else {\n\t\t\t\tthis.one('ready', () => {\n\t\t\t\t\tsolve();\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n}\n\nconst prop = (...a) => {\n\n\t// Using (predefined?) data types here?\n\n\t// ...args?\n\tlet s = get_a_sig(a);\n\tconst raise_change_events = true;\n\tconst ifn = item => typeof item === \"function\";\n\n\tif (s === \"[a]\") {\n\t\teach(a[0], item_params => {\n\t\t\tprop.apply(this, item_params);\n\t\t});\n\t} else {\n\t\tif (a.length === 2) {\n\t\t\tif (ia(a[1])) {\n\t\t\t\tconst target = a[0];\n\t\t\t\teach(a[1], item => {\n\t\t\t\t\tif (ia(item)) {\n\t\t\t\t\t\tthrow \"NYI 468732\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprop(target, item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst ta1 = tof(a[1]);\n\t\t\t\tif (ta1 === \"string\") {\n\t\t\t\t\t[obj, prop_name] = a;\n\t\t\t\t} else {\n\t\t\t\t\tthrow \"NYI 468732b\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (a.length > 2) {\n\t\t\tif (is_array(a[0])) {\n\t\t\t\t// the rest of the properties applied to the array of items.\n\t\t\t\tthrow \"stop\";\n\t\t\t\tlet objs = a.shift();\n\t\t\t\teach(objs, obj => {\n\t\t\t\t\tprop.apply(this, [obj].concat(item_params)); // bug\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet obj, prop_name, default_value, fn_onchange, fn_transform, fn_on_ready, options;\n\t\t\t\tconst load_options = options => {\n\t\t\t\t\tprop_name = prop_name || options.name || options.prop_name;\n\t\t\t\t\tfn_onchange =\n\t\t\t\t\t\toptions.fn_onchange || options.onchange || options.change;\n\t\t\t\t\tfn_transform =\n\t\t\t\t\t\toptions.fn_transform || options.ontransform || options.transform;\n\t\t\t\t\tfn_on_ready = options.ready || options.on_ready;\n\t\t\t\t\tdefault_value = default_value || options.default_value || options.default;\n\t\t\t\t};\n\t\t\t\tif (a.length === 2) {\n\t\t\t\t\t[obj, options] = a;\n\t\t\t\t\tload_options(options);\n\t\t\t\t} else if (a.length === 3) {\n\t\t\t\t\tif (ifn(a[2])) {\n\t\t\t\t\t\t[obj, prop_name, fn_onchange] = a;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (a[2].change || a[2].ready) {\n\t\t\t\t\t\t\tload_options(a[2]);\n\n\t\t\t\t\t\t\t[obj, prop_name] = a;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t//[obj, prop_name, default_value, fn_transform] = a;\n\t\t\t\t} else if (a.length === 4) {\n\t\t\t\t\tif (ifn(a[2]) && ifn(a[3])) {\n\t\t\t\t\t\t[obj, prop_name, fn_transform, fn_onchange] = a;\n\t\t\t\t\t} else if (ifn(a[3])) {\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_onchange] = a;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t[obj, prop_name, default_value, options] = a;\n\t\t\t\t\t\tload_options(options);\n\t\t\t\t\t}\n\t\t\t\t} else if (a.length === 5) {\n\t\t\t\t\t[obj, prop_name, default_value, fn_transform, fn_onchange] = a;\n\t\t\t\t}\n\t\t\t\tlet _prop_value;\n\n\t\t\t\tif (typeof default_value !== 'undefined') _prop_value = default_value;\n\t\t\t\t// And a silent set function that does not raise the change event.\n\t\t\t\tconst _silent_set = value => {\n\t\t\t\t\tlet _value;\n\t\t\t\t\tif (fn_transform) {\n\t\t\t\t\t\t_value = fn_transform(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_value = value;\n\t\t\t\t\t}\n\t\t\t\t\t_prop_value = _value;\n\t\t\t\t}\n\t\t\t\tconst _set = value => {\n\t\t\t\t\tlet _value;\n\t\t\t\t\tif (fn_transform) {\n\t\t\t\t\t\t_value = fn_transform(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_value = value;\n\t\t\t\t\t}\n\t\t\t\t\tlet old = _prop_value;\n\t\t\t\t\t_prop_value = _value;\n\t\t\t\t\tif (fn_onchange) {\n\t\t\t\t\t\tfn_onchange({\n\t\t\t\t\t\t\told: old,\n\t\t\t\t\t\t\tvalue: _prop_value\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (obj.raise && raise_change_events) {\n\t\t\t\t\t\tobj.raise(\"change\", {\n\t\t\t\t\t\t\tname: prop_name,\n\t\t\t\t\t\t\told: old,\n\t\t\t\t\t\t\tvalue: _prop_value\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (is_defined(default_value)) {\n\t\t\t\t\t_prop_value = default_value;\n\t\t\t\t}\n\t\t\t\tconst t_prop_name = tf(prop_name);\n\t\t\t\tif (t_prop_name === 's') {\n\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\n\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\treturn _prop_value;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tset(value) {\n\t\t\t\t\t\t\t_set(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t} else if (t_prop_name === 'a') {\n\t\t\t\t\tconst l = prop_name.length;\n\t\t\t\t\t//console.log('prop_name', prop_name);\n\t\t\t\t\tlet item_prop_name;\n\t\t\t\t\tfor (let c = 0; c < l; c++) {\n\t\t\t\t\t\titem_prop_name = prop_name[c];\n\t\t\t\t\t\t//console.log('item_prop_name', item_prop_name);\n\t\t\t\t\t\tObject.defineProperty(obj, item_prop_name, {\n\t\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\t\treturn _prop_value;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tset(value) {\n\t\t\t\t\t\t\t\t_set(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow 'Unexpected name type: ' + t_prop_name;\n\t\t\t\t}\n\t\t\t\tif (fn_on_ready) {\n\t\t\t\t\tfn_on_ready({\n\t\t\t\t\t\tsilent_set: _silent_set\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nclass Data_Type {\n\n}\n\nclass Functional_Data_Type extends Data_Type {\n    constructor(spec) {\n\n\t\t/*\n\t\tnamed_property_access: true,\n\t\tproperty_names: ['latitude', 'longitude'],\n\t\t// And the property types as well being the same in this case?\n\t\tabbreviated_property_names: ['lat', 'long'],\n\t\tnumbered_property_access: true, // Maybe that's good enough to make it like an array when there are 2 properties.\n\n\t\t*/\n        \n        // fns for: validate as exact type...?\n        // convert from whatever it is to that exact type (if possible)\n        //   string and binary conversions.\n        //   eg a convert_load type operation.\n\n        // it's super / parent type.\n        super(spec);\n\n        if (spec.supertype) this.supertype = spec.supertype;\n        if (spec.name) this.name = spec.name;\n        if (spec.abbreviated_name) this.abbreviated_name = spec.abbreviated_name;\n\t\tif (spec.named_property_access) this.named_property_access = spec.named_property_access;\n\t\tif (spec.numbered_property_access) this.numbered_property_access = spec.numbered_property_access;\n\t\tif (spec.property_names) this.property_names = spec.property_names;\n\t\tif (spec.property_data_types) this.property_data_types = spec.property_data_types;\n\t\tif (spec.wrap_properties) this.wrap_properties = spec.wrap_properties;\n\t\tif (spec.wrap_value_inner_values) this.wrap_value_inner_values = spec.wrap_value_inner_values;\n\t\tif (spec.value_js_type) this.value_js_type = spec.value_js_type;\n\t\t// value_js_type\n\n\t\t// wrap_value as well????\n\t\t//   Though the value kind-of is itself.\n\t\t//    maybe .inner_js_value is much clearer here?\n\t\t// wrap_value_inner_values\n\n\n\n\t\tif (spec.abbreviated_property_names) this.abbreviated_property_names = spec.abbreviated_property_names;\n        if (spec.validate) this.validate = spec.validate;\n        if (spec.validate_explain) this.validate_explain = spec.validate_explain;\n\t\tif (spec.parse_string) this.parse_string = spec.parse_string;\n\t\tif (spec.parse) this.parse = spec.parse;\n\n\t\t// But also want it to be able to accept undefined value (usually???)\n\n\n\n\n        // and abbreviated name\n        // spec.validate (needs to be perfect...)\n\n        // spec.load_from(...?)\n        // spec.poly_load??\n\n        // spec.input transformers???\n        //   transform from other identified types...?\n\n        // For the moment, we don't want too many and too complex functions.\n\n    }\n}\n\n//lang.Data_Type = Data_Type;\n//lang.Functional_Data_Type = Functional_Data_Type;\n\n\n\n// And let's define some....\n\n// And a correct value...?\n//   Eg if a number is not valid because it has too many decimal points, it could be corrected.\n//     Or even an int that's too large, outside a range, corrected to fit in that range.\n\n// So making a Data_Value stick to using these Data_Types could be helpful.\n\n// For the moment this is really simple and should work fine for some things.\n\n// Allow undefined????\n//   Or better to have that on a different level.\n//     Maybe does make sense as an option here.\n\n//     Or consider it and do it later.\n\n\nFunctional_Data_Type.number = new Functional_Data_Type({\n    name: 'number',\n    abbreviated_name: 'n',\n    validate: x => {\n        return !isNaN(x);\n    },\n\tparse_string(str) {\n\t\tconst p = parseFloat(str);\n\t\t// then is it a number???\n\n\t\t// then is its string the same....?\n\t\tif (p + '' === str) {\n\t\t\tconst parsed_is_valid = this.validate(p);\n\t\t\tif (parsed_is_valid) {\n\t\t\t\treturn p;\n\t\t\t}\n\t\t}\n\n\n\t}\n});\n\nFunctional_Data_Type.integer = new Functional_Data_Type({\n    name: 'integer',\n    abbreviated_name: 'int',\n    validate: x => {\n        return Number.isInteger(x);\n    },\n    parse_string(str) {\n        const p = parseInt(str, 10);\n        if (!isNaN(p) && p.toString() === str) {\n            return p;\n        }\n        return undefined;\n    }\n});\n\n// Need fdts for things like a [lat, long] array.\n//   Maybe see about making it (easily) from composite data types.\n//     Pair(Lat, Long) or similar\n//     Maybe want it defined in a few lines of string grammar if it's easy.\n//       Would make for a simple API - but would require parsing a custom language.\n\n\n\n\n\n\n\n\n// Would be worth getting into creating conventions and idioms for higher level code.\n//   Though first getting data type systems working right would help.\n//     Making them easy to use.\n\nconst field = (...a) => {\n\n\t// Will also want to set data types of fields....\n\n\t// Uses obj._\n\t//   Seems quite simple, powerful, flexible.\n\t//     However, would like a different way of doing it too, could use a local variable defined within the 'field' function.\n\n\t// Want to incorporate data types, maybe grammar too.\n\n\t// Could use fp for this as well????\n\t//   See about really concise function definitions.\n\n\t//  Also want to see about some benchmarks too.\n\t//    Eg rendering a large page server side 10 times.\n\n\tconst raise_change_events = true;\n\n\tconst ifn = item => typeof item === \"function\";\n\n\tlet s = get_a_sig(a);\n\tif (s === \"[a]\") {\n\t\t// prop????\n\t\teach(a[0], item_params => {\n\t\t\tprop.apply(this, item_params);\n\t\t});\n\t} else {\n\t\tif (a.length > 1) {\n\t\t\tif (is_array(a[0])) {\n\n\t\t\t\tthrow 'stop - need to fix';\n\t\t\t\t// the rest of the properties applied to the array of items.\n\n\t\t\t\t// But field.apply here...???\n\t\t\t\tlet objs = a.shift();\n\t\t\t\teach(objs, obj => {\n\t\t\t\t\tfield.apply(this, [obj].concat(item_params));\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Maybe will have a Data_Type....\n\n\t\t\t\tlet obj, prop_name, data_type, default_value, fn_transform;\n\t\t\t\t//let raise_change_events = opts.raise_change_events;\n\t\t\t\tif (a.length === 2) {\n\t\t\t\t\t[obj, prop_name] = a;\n\t\t\t\t} else if (a.length === 3) {\n\n\t\t\t\t\t// And also check a[2] for being a Data_Type.\n\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (ifn(a[2])) {\n\t\t\t\t\t\t\t[obj, prop_name, fn_transform] = a;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t[obj, prop_name, default_value] = a;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t\t\n\t\t\t\t} else if (a.length === 4) {\n\n\t\t\t\t\t// field(this, 'value', this.data_type, spec.value);\n\n\t\t\t\t\tif (a[2] instanceof Data_Type) {\n\t\t\t\t\t\t[obj, prop_name, data_type, default_value] = a;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t[obj, prop_name, default_value, fn_transform] = a;\n\t\t\t\t\t}\n\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (obj !== undefined) {\n\n\t\t\t\t\t// Setting with a data_model or data_value ????\n\n\n\t\t\t\t\tObject.defineProperty(obj, prop_name, {\n\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\tif (is_defined(obj._)) {\n\t\t\t\t\t\t\t\treturn obj._[prop_name];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//return _prop_value;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tset(value) {\n\t\t\t\t\t\t\t//console.log('setting prop: ' + prop_name);\n\n\t\t\t\t\t\t\t// Get an immutable copy of it???\n\n\t\t\t\t\t\t\tlet old = (obj._ = obj._ || {})[prop_name];\n\n\t\t\t\t\t\t\t// Want better tof that can deal with Data_Model, Data_Value\n\t\t\t\t\t\t\t// Maybe Data_String, Data_Array, Data_Object, Data_Number???\n\n\t\t\t\t\t\t\t// Could make some more specifically typed ones....\n\n\n\n\n\n\n\t\t\t\t\t\t\t// value must be an array of length 2.\n\n\t\t\t\t\t\t\t// And what's the typeof value???\n\n\n\n\t\t\t\t\t\t\t// Upgrade the field set procedure.\n\n\n\n\n\n\n\t\t\t\t\t\t\tif (old !== value) {\n\n\t\t\t\t\t\t\t\tlet is_valid = true;\n\t\t\t\t\t\t\t\tif (data_type) {\n\n\t\t\t\t\t\t\t\t\tconst t_value = typeof value;\n\n\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(value);\n\n\t\t\t\t\t\t\t\t\t// if not valid directly, can we parse it from a string???\n\n\t\t\t\t\t\t\t\t\tif (t_value === 'string') {\n\t\t\t\t\t\t\t\t\t\tconst parsed_value = data_type.parse_string(value);\n\t\t\t\t\t\t\t\t\t\tis_valid = data_type.validate(parsed_value);\n\n\t\t\t\t\t\t\t\t\t\tif (is_valid) value = parsed_value;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconsole.log('t_value', t_value);\n\n\t\t\t\t\t\t\t\t\t// but also some type of stringifying the value....\n\n\n\n\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (is_valid) {\n\n\t\t\t\t\t\t\t\t\tlet _value;\n\t\t\t\t\t\t\t\t\tif (fn_transform) {\n\t\t\t\t\t\t\t\t\t\t//try {\n\t\t\t\t\t\t\t\t\t\t_value = fn_transform(value);\n\t\t\t\t\t\t\t\t\t\t//} catch (err) {\n\t\t\t\t\t\t\t\t\t\t//    throw err;\n\t\t\t\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t\t\t\t} else {\n\t\n\t\n\t\n\t\t\t\t\t\t\t\t\t\t_value = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tobj._[prop_name] = _value;\n\t\t\t\t\t\t\t\t\tif (raise_change_events) {\n\t\t\t\t\t\t\t\t\t\tobj.raise(\"change\", {\n\t\t\t\t\t\t\t\t\t\t\tname: prop_name,\n\t\t\t\t\t\t\t\t\t\t\told: old,\n\t\t\t\t\t\t\t\t\t\t\tvalue: _value\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//console.log('old === value');\n\t\t\t\t\t\t\t\t//console.log('old', old);\n\t\t\t\t\t\t\t\t//console.log('value', value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (is_defined(default_value)) {\n\t\t\t\t\t\tlet is_valid = true;\n\t\t\t\t\t\tif (data_type) {\n\t\t\t\t\t\t\tis_valid = data_type.validate(default_value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (is_valid) {\n\t\t\t\t\t\t\t(obj._ = obj._ || {})[prop_name] = default_value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow 'stop';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\n// Probably need an 'equals' function.\n//   Would make use of .equals and .hash functions / properties when available.\n\n// Though Data_Value.toString and toJSON may be most useful sooner...\n\n// lang-tools should have the equals function that supports Data_Value (maybe Data_Model in general).\n\n// Expression Parser implementation\nconst KEYWORD_LITERALS = new Set(['true', 'false', 'null', 'undefined']);\nconst KEYWORD_OPERATORS = new Set(['typeof', 'void', 'delete', 'in', 'instanceof']);\nconst MULTI_CHAR_OPERATORS = [\n\t'===', '!==', '==', '!=', '<=', '>=', '&&', '||', '??', '++', '--',\n\t'+=', '-=', '*=', '/=', '%=', '&=', '|=', '^=', '<<', '>>', '>>>', '**'\n];\nconst SINGLE_CHAR_OPERATORS = new Set(['+', '-', '*', '/', '%', '=', '!', '<', '>', '&', '|', '^', '~']);\nconst PUNCTUATION_CHARS = new Set(['(', ')', '{', '}', '[', ']', ',', ':', '?', '.']);\nconst GLOBAL_SCOPE = typeof globalThis !== 'undefined'\n\t? globalThis\n\t: (typeof self !== 'undefined' ? self : (typeof window !== 'undefined' ? window : {}));\n\nclass Tokenizer {\n\tconstructor(expression) {\n\t\tthis.expression = expression || '';\n\t\tthis.length = this.expression.length;\n\t\tthis.position = 0;\n\t}\n\n\ttokenize() {\n\t\tconst tokens = [];\n\t\tif (!this.expression.trim()) {\n\t\t\treturn tokens;\n\t\t}\n\t\twhile (!this.isAtEnd()) {\n\t\t\tthis.skipWhitespace();\n\t\t\tif (this.isAtEnd()) break;\n\t\t\tconst ch = this.peek();\n\t\t\tif (this.isIdentifierStart(ch)) {\n\t\t\t\ttokens.push(this.tokenizeIdentifier());\n\t\t\t} else if (this.isDigit(ch) || (ch === '.' && this.isDigit(this.peek(1)))) {\n\t\t\t\ttokens.push(this.tokenizeNumber());\n\t\t\t} else if (ch === '\"' || ch === '\\'') {\n\t\t\t\ttokens.push(this.tokenizeString());\n\t\t\t} else if (this.isOperatorStart(ch)) {\n\t\t\t\ttokens.push(this.tokenizeOperator());\n\t\t\t} else if (PUNCTUATION_CHARS.has(ch)) {\n\t\t\t\ttokens.push(this.tokenizePunctuation());\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Unexpected character: ${ch}`);\n\t\t\t}\n\t\t}\n\t\treturn tokens;\n\t}\n\n\tisAtEnd() {\n\t\treturn this.position >= this.length;\n\t}\n\n\tpeek(offset = 0) {\n\t\tif (this.position + offset >= this.length) return '\\0';\n\t\treturn this.expression[this.position + offset];\n\t}\n\n\tadvance() {\n\t\treturn this.expression[this.position++];\n\t}\n\n\tskipWhitespace() {\n\t\twhile (!this.isAtEnd()) {\n\t\t\tconst ch = this.peek();\n\t\t\tif (/\\s/.test(ch)) {\n\t\t\t\tthis.advance();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch === '/' && this.peek(1) === '/') {\n\t\t\t\twhile (!this.isAtEnd() && this.peek() !== '\\n') {\n\t\t\t\t\tthis.advance();\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch === '/' && this.peek(1) === '*') {\n\t\t\t\tthis.advance();\n\t\t\t\tthis.advance();\n\t\t\t\twhile (!this.isAtEnd()) {\n\t\t\t\t\tif (this.peek() === '*' && this.peek(1) === '/') {\n\t\t\t\t\t\tthis.advance();\n\t\t\t\t\t\tthis.advance();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tthis.advance();\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tisIdentifierStart(ch) {\n\t\treturn /[A-Za-z_$]/.test(ch);\n\t}\n\n\tisIdentifierPart(ch) {\n\t\treturn /[A-Za-z0-9_$]/.test(ch);\n\t}\n\n\tisDigit(ch) {\n\t\treturn /[0-9]/.test(ch);\n\t}\n\n\tisOperatorStart(ch) {\n\t\tif (ch === '.' && this.peek(1) === '.' && this.peek(2) === '.') {\n\t\t\tthrow new Error('Spread syntax is not supported');\n\t\t}\n\t\tif (ch === '?' && this.peek(1) === '?') {\n\t\t\treturn true;\n\t\t}\n\t\treturn SINGLE_CHAR_OPERATORS.has(ch);\n\t}\n\n\ttokenizeIdentifier() {\n\t\tlet value = '';\n\t\twhile (!this.isAtEnd() && this.isIdentifierPart(this.peek())) {\n\t\t\tvalue += this.advance();\n\t\t}\n\t\tif (KEYWORD_LITERALS.has(value)) {\n\t\t\treturn { type: 'KEYWORD', value };\n\t\t}\n\t\tif (KEYWORD_OPERATORS.has(value)) {\n\t\t\treturn { type: 'OPERATOR', value };\n\t\t}\n\t\treturn { type: 'IDENTIFIER', value };\n\t}\n\n\ttokenizeNumber() {\n\t\tlet value = '';\n\t\tlet hasDot = false;\n\t\twhile (!this.isAtEnd()) {\n\t\t\tconst ch = this.peek();\n\t\t\tif (this.isDigit(ch)) {\n\t\t\t\tvalue += this.advance();\n\t\t\t} else if (ch === '.' && !hasDot) {\n\t\t\t\thasDot = true;\n\t\t\t\tvalue += this.advance();\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn { type: 'NUMBER', value: Number(value) };\n\t}\n\n\ttokenizeString() {\n\t\tconst quote = this.advance();\n\t\tlet value = '';\n\t\twhile (!this.isAtEnd()) {\n\t\t\tconst ch = this.advance();\n\t\t\tif (ch === quote) {\n\t\t\t\treturn { type: 'STRING', value };\n\t\t\t}\n\t\t\tif (ch === '\\\\') {\n\t\t\t\tconst next = this.advance();\n\t\t\t\tswitch (next) {\n\t\t\t\t\tcase 'n': value += '\\n'; break;\n\t\t\t\t\tcase 'r': value += '\\r'; break;\n\t\t\t\t\tcase 't': value += '\\t'; break;\n\t\t\t\t\tcase '\\\\': value += '\\\\'; break;\n\t\t\t\t\tcase '\"': value += '\"'; break;\n\t\t\t\t\tcase '\\'': value += '\\''; break;\n\t\t\t\t\tdefault: value += next;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvalue += ch;\n\t\t\t}\n\t\t}\n\t\tthrow new Error('Unterminated string literal');\n\t}\n\n\ttokenizeOperator() {\n\t\tconst remaining = this.expression.slice(this.position);\n\t\tfor (const op of MULTI_CHAR_OPERATORS) {\n\t\t\tif (remaining.startsWith(op)) {\n\t\t\t\tif (op === '=>') {\n\t\t\t\t\tthrow new Error('Arrow functions are not supported');\n\t\t\t\t}\n\t\t\t\tthis.position += op.length;\n\t\t\t\treturn { type: 'OPERATOR', value: op };\n\t\t\t}\n\t\t}\n\t\tconst ch = this.advance();\n\t\tif (ch === '=' && this.peek() === '>') {\n\t\t\tthrow new Error('Arrow functions are not supported');\n\t\t}\n\t\tif (!SINGLE_CHAR_OPERATORS.has(ch) && ch !== '?') {\n\t\t\tthrow new Error('Unexpected operator');\n\t\t}\n\t\treturn { type: 'OPERATOR', value: ch };\n\t}\n\n\ttokenizePunctuation() {\n\t\tconst ch = this.advance();\n\t\tif (ch === '.' && this.peek() === '.' && this.peek(1) === '.') {\n\t\t\tthrow new Error('Spread syntax is not supported');\n\t\t}\n\t\treturn { type: 'PUNCTUATION', value: ch };\n\t}\n}\n\nclass Parser {\n\tconstructor(tokens) {\n\t\tthis.tokens = tokens;\n\t\tthis.pos = 0;\n\t}\n\n\tparse() {\n\t\tif (!this.tokens.length) {\n\t\t\tthrow new Error('Empty expression');\n\t\t}\n\t\tconst ast = this.parseExpression();\n\t\tif (!this.isAtEnd()) {\n\t\t\tthrow new Error(`Unexpected token: ${this.peek().value}`);\n\t\t}\n\t\treturn ast;\n\t}\n\n\tparseExpression() {\n\t\treturn this.parseConditionalExpression();\n\t}\n\n\tparseConditionalExpression() {\n\t\tlet expr = this.parseLogicalOrExpression();\n\t\tif (this.matchPunctuation('?')) {\n\t\t\tconst consequent = this.parseExpression();\n\t\t\tthis.consume('PUNCTUATION', ':');\n\t\t\tconst alternate = this.parseExpression();\n\t\t\texpr = {\n\t\t\t\ttype: 'ConditionalExpression',\n\t\t\t\ttest: expr,\n\t\t\t\tconsequent,\n\t\t\t\talternate\n\t\t\t};\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseLogicalOrExpression() {\n\t\tlet expr = this.parseLogicalAndExpression();\n\t\twhile (this.matchOperator('||')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseLogicalAndExpression();\n\t\t\texpr = this.buildLogicalExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseLogicalAndExpression() {\n\t\tlet expr = this.parseNullishExpression();\n\t\twhile (this.matchOperator('&&')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseNullishExpression();\n\t\t\texpr = this.buildLogicalExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseNullishExpression() {\n\t\tlet expr = this.parseEqualityExpression();\n\t\twhile (this.matchOperator('??')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseEqualityExpression();\n\t\t\texpr = this.buildLogicalExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseEqualityExpression() {\n\t\tlet expr = this.parseRelationalExpression();\n\t\twhile (this.matchOperator('==', '!=', '===', '!==')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseRelationalExpression();\n\t\t\texpr = this.buildBinaryExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseRelationalExpression() {\n\t\tlet expr = this.parseAdditiveExpression();\n\t\twhile (this.matchOperator('<', '>', '<=', '>=', 'in', 'instanceof')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseAdditiveExpression();\n\t\t\texpr = this.buildBinaryExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseAdditiveExpression() {\n\t\tlet expr = this.parseMultiplicativeExpression();\n\t\twhile (this.matchOperator('+', '-')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseMultiplicativeExpression();\n\t\t\texpr = this.buildBinaryExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseMultiplicativeExpression() {\n\t\tlet expr = this.parseUnaryExpression();\n\t\twhile (this.matchOperator('*', '/', '%')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst right = this.parseUnaryExpression();\n\t\t\texpr = this.buildBinaryExpression(operator, expr, right);\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparseUnaryExpression() {\n\t\tif (this.matchOperator('+', '-', '!', '~', 'typeof', 'void', 'delete')) {\n\t\t\tconst operator = this.previous().value;\n\t\t\tconst argument = this.parseUnaryExpression();\n\t\t\treturn { type: 'UnaryExpression', operator, argument };\n\t\t}\n\t\treturn this.parseLeftHandSideExpression();\n\t}\n\n\tparseLeftHandSideExpression() {\n\t\tlet expr = this.parsePrimaryExpression();\n\t\twhile (true) {\n\t\t\tif (this.matchPunctuation('.')) {\n\t\t\t\tconst property = this.consumePropertyIdentifier();\n\t\t\t\texpr = {\n\t\t\t\t\ttype: 'MemberExpression',\n\t\t\t\t\tobject: expr,\n\t\t\t\t\tproperty,\n\t\t\t\t\tcomputed: false\n\t\t\t\t};\n\t\t\t} else if (this.matchPunctuation('[')) {\n\t\t\t\tconst property = this.parseExpression();\n\t\t\t\tthis.consume('PUNCTUATION', ']');\n\t\t\t\texpr = {\n\t\t\t\t\ttype: 'MemberExpression',\n\t\t\t\t\tobject: expr,\n\t\t\t\t\tproperty,\n\t\t\t\t\tcomputed: true\n\t\t\t\t};\n\t\t\t} else if (this.matchPunctuation('(')) {\n\t\t\t\tconst args = this.parseArguments();\n\t\t\t\texpr = {\n\t\t\t\t\ttype: 'CallExpression',\n\t\t\t\t\tcallee: expr,\n\t\t\t\t\targuments: args\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn expr;\n\t}\n\n\tparsePrimaryExpression() {\n\t\tconst token = this.peek();\n\t\tif (!token) {\n\t\t\tthrow new Error('Unexpected end of expression');\n\t\t}\n\t\tif (token.type === 'NUMBER' || token.type === 'STRING') {\n\t\t\tthis.advance();\n\t\t\treturn { type: 'Literal', value: token.value };\n\t\t}\n\t\tif (token.type === 'KEYWORD') {\n\t\t\tthis.advance();\n\t\t\treturn { type: 'Literal', value: this.literalFromKeyword(token.value) };\n\t\t}\n\t\tif (token.type === 'IDENTIFIER') {\n\t\t\tthis.advance();\n\t\t\treturn { type: 'Identifier', value: token.value };\n\t\t}\n\t\tif (this.matchPunctuation('(')) {\n\t\t\tconst expr = this.parseExpression();\n\t\t\tthis.consume('PUNCTUATION', ')');\n\t\t\treturn expr;\n\t\t}\n\t\tif (this.matchPunctuation('[')) {\n\t\t\tconst elements = [];\n\t\t\tif (!this.check('PUNCTUATION', ']')) {\n\t\t\t\tdo {\n\t\t\t\t\telements.push(this.parseExpression());\n\t\t\t\t} while (this.matchPunctuation(','));\n\t\t\t}\n\t\t\tthis.consume('PUNCTUATION', ']');\n\t\t\treturn { type: 'ArrayExpression', elements };\n\t\t}\n\t\tif (this.matchPunctuation('{')) {\n\t\t\tconst properties = [];\n\t\t\tif (!this.check('PUNCTUATION', '}')) {\n\t\t\t\tdo {\n\t\t\t\t\tconst key = this.parsePropertyKey();\n\t\t\t\t\tthis.consume('PUNCTUATION', ':');\n\t\t\t\t\tconst value = this.parseExpression();\n\t\t\t\t\tproperties.push({ key, value });\n\t\t\t\t} while (this.matchPunctuation(','));\n\t\t\t}\n\t\t\tthis.consume('PUNCTUATION', '}');\n\t\t\treturn { type: 'ObjectExpression', properties };\n\t\t}\n\t\tthrow new Error(`Unexpected token: ${token.value}`);\n\t}\n\n\tparsePropertyKey() {\n\t\tconst token = this.peek();\n\t\tif (token.type === 'IDENTIFIER') {\n\t\t\tthis.advance();\n\t\t\treturn { type: 'Identifier', value: token.value };\n\t\t}\n\t\tif (token.type === 'STRING' || token.type === 'NUMBER' || token.type === 'KEYWORD') {\n\t\t\tthis.advance();\n\t\t\tconst value = token.type === 'KEYWORD' ? this.literalFromKeyword(token.value) : token.value;\n\t\t\treturn { type: 'Literal', value };\n\t\t}\n\t\tthrow new Error('Invalid object property key');\n\t}\n\n\tparseArguments() {\n\t\tconst args = [];\n\t\tif (!this.check('PUNCTUATION', ')')) {\n\t\t\tdo {\n\t\t\t\targs.push(this.parseExpression());\n\t\t\t} while (this.matchPunctuation(','));\n\t\t}\n\t\tthis.consume('PUNCTUATION', ')');\n\t\treturn args;\n\t}\n\n\tliteralFromKeyword(value) {\n\t\tswitch (value) {\n\t\t\tcase 'true': return true;\n\t\t\tcase 'false': return false;\n\t\t\tcase 'null': return null;\n\t\t\tcase 'undefined': return undefined;\n\t\t\tdefault: return value;\n\t\t}\n\t}\n\n\tconsume(type, value) {\n\t\tif (this.check(type, value)) {\n\t\t\treturn this.advance();\n\t\t}\n\t\tconst expected = value ? `${type} '${value}'` : type;\n\t\tthrow new Error(`Expected ${expected}`);\n\t}\n\n\tcheck(type, value) {\n\t\tif (this.isAtEnd()) return false;\n\t\tconst token = this.peek();\n\t\tif (token.type !== type) return false;\n\t\tif (typeof value === 'undefined') return true;\n\t\treturn token.value === value;\n\t}\n\n\tmatchOperator(...operators) {\n\t\tif (this.check('OPERATOR') && operators.includes(this.peek().value)) {\n\t\t\tthis.advance();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tmatchPunctuation(value) {\n\t\tif (this.check('PUNCTUATION', value)) {\n\t\t\tthis.advance();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconsumePropertyIdentifier() {\n\t\tconst token = this.peek();\n\t\tif (token.type === 'IDENTIFIER') {\n\t\t\tthis.advance();\n\t\t\treturn { type: 'Identifier', value: token.value };\n\t\t}\n\t\tif (token.type === 'STRING' || token.type === 'NUMBER' || token.type === 'KEYWORD') {\n\t\t\tthis.advance();\n\t\t\tconst value = token.type === 'KEYWORD' ? this.literalFromKeyword(token.value) : token.value;\n\t\t\treturn { type: 'Literal', value };\n\t\t}\n\t\tthrow new Error('Expected property name');\n\t}\n\n\tbuildBinaryExpression(operator, left, right) {\n\t\treturn { type: 'BinaryExpression', operator, left, right };\n\t}\n\n\tbuildLogicalExpression(operator, left, right) {\n\t\treturn { type: 'LogicalExpression', operator, left, right };\n\t}\n\n\tadvance() {\n\t\tif (!this.isAtEnd()) {\n\t\t\tthis.pos += 1;\n\t\t}\n\t\treturn this.tokens[this.pos - 1];\n\t}\n\n\tpeek() {\n\t\tif (this.isAtEnd()) return null;\n\t\treturn this.tokens[this.pos];\n\t}\n\n\tprevious() {\n\t\treturn this.tokens[this.pos - 1];\n\t}\n\n\tisAtEnd() {\n\t\treturn this.pos >= this.tokens.length;\n\t}\n}\n\nclass Evaluator {\n\tconstructor(context = {}, options = {}) {\n\t\tthis.context = context || {};\n\t\tthis.helpers = options.helpers || {};\n\t\tthis.strict = options.strict || false;\n\t\tthis.allowCall = options.allowCall || null;\n\t\tthis.allowedFunctions = new Set(options.allowedFunctions || []);\n\t\tObject.values(this.helpers).forEach(value => {\n\t\t\tif (typeof value === 'function') {\n\t\t\t\tthis.allowedFunctions.add(value);\n\t\t\t}\n\t\t});\n\t}\n\n\tevaluate(node) {\n\t\tswitch (node.type) {\n\t\t\tcase 'Literal': return node.value;\n\t\t\tcase 'Identifier': return this.evaluateIdentifier(node);\n\t\t\tcase 'MemberExpression': return this.evaluateMemberExpression(node);\n\t\t\tcase 'CallExpression': return this.evaluateCallExpression(node);\n\t\t\tcase 'UnaryExpression': return this.evaluateUnaryExpression(node);\n\t\t\tcase 'BinaryExpression': return this.evaluateBinaryExpression(node);\n\t\t\tcase 'LogicalExpression': return this.evaluateLogicalExpression(node);\n\t\t\tcase 'ArrayExpression': return node.elements.map(element => this.evaluate(element));\n\t\t\tcase 'ObjectExpression': return this.evaluateObjectExpression(node);\n\t\t\tcase 'ConditionalExpression': return this.evaluateConditionalExpression(node);\n\t\t\tdefault: throw new Error(`Unsupported AST node type: ${node.type}`);\n\t\t}\n\t}\n\n\tevaluateIdentifier(node) {\n\t\tconst name = node.value;\n\t\tif (Object.prototype.hasOwnProperty.call(this.helpers, name)) {\n\t\t\treturn this.helpers[name];\n\t\t}\n\t\tif (this.context && Object.prototype.hasOwnProperty.call(this.context, name)) {\n\t\t\treturn this.context[name];\n\t\t}\n\t\tif (name in GLOBAL_SCOPE) {\n\t\t\treturn GLOBAL_SCOPE[name];\n\t\t}\n\t\tif (this.strict) {\n\t\t\tthrow new Error(`Undefined identifier: ${name}`);\n\t\t}\n\t\tconsole.error(`Undefined identifier: ${name}`);\n\t\treturn undefined;\n\t}\n\n\tevaluateMemberExpression(node) {\n\t\tconst object = this.evaluate(node.object);\n\t\tif (object === null || object === undefined) {\n\t\t\tthrow new Error('Cannot read property of null or undefined');\n\t\t}\n\t\tconst property = node.computed\n\t\t\t? this.evaluate(node.property)\n\t\t\t: node.property.type === 'Identifier'\n\t\t\t\t? node.property.value\n\t\t\t\t: node.property.value;\n\t\treturn object[property];\n\t}\n\n\tevaluateCallExpression(node) {\n\t\tlet callee;\n\t\tlet thisArg;\n\t\tif (node.callee.type === 'MemberExpression') {\n\t\t\tconst object = this.evaluate(node.callee.object);\n\t\t\tif (object === null || object === undefined) {\n\t\t\t\tthrow new Error('Cannot call property of null or undefined');\n\t\t\t}\n\t\t\tconst property = node.callee.computed\n\t\t\t\t? this.evaluate(node.callee.property)\n\t\t\t\t: node.callee.property.type === 'Identifier'\n\t\t\t\t\t? node.callee.property.value\n\t\t\t\t\t: node.callee.property.value;\n\t\t\tcallee = object[property];\n\t\t\tthisArg = object;\n\t\t} else {\n\t\t\tcallee = this.evaluate(node.callee);\n\t\t\tthisArg = undefined;\n\t\t}\n\t\tif (typeof callee !== 'function') {\n\t\t\tthrow new Error('Attempted to call a non-function');\n\t\t}\n\t\tif (!this.isCallAllowed(callee, thisArg)) {\n\t\t\tthrow new Error('Function call not allowed by policy');\n\t\t}\n\t\tconst args = node.arguments.map(arg => this.evaluate(arg));\n\t\treturn callee.apply(thisArg, args);\n\t}\n\n\tisCallAllowed(fn, thisArg) {\n\t\tif (this.allowCall) {\n\t\t\tconst decision = this.allowCall(fn, thisArg);\n\t\t\tif (decision === true) return true;\n\t\t\tif (decision === false) return false;\n\t\t}\n\t\treturn this.allowedFunctions.has(fn);\n\t}\n\n\tevaluateUnaryExpression(node) {\n\t\tlet argumentValue;\n\t\tif (node.operator === 'delete') {\n\t\t\targumentValue = node.argument;\n\t\t} else if (node.operator === 'typeof' && node.argument.type === 'Identifier' && !this.isIdentifierDefined(node.argument.value)) {\n\t\t\targumentValue = undefined;\n\t\t} else {\n\t\t\targumentValue = this.evaluate(node.argument);\n\t\t}\n\t\tswitch (node.operator) {\n\t\t\tcase '+': return +argumentValue;\n\t\t\tcase '-': return -argumentValue;\n\t\t\tcase '!': return !argumentValue;\n\t\t\tcase '~': return ~argumentValue;\n\t\t\tcase 'typeof':\n\t\t\t\tif (node.argument.type === 'Identifier' && !this.isIdentifierDefined(node.argument.value)) {\n\t\t\t\t\treturn 'undefined';\n\t\t\t\t}\n\t\t\t\treturn typeof argumentValue;\n\t\t\tcase 'void': return void argumentValue;\n\t\t\tcase 'delete': return this.performDelete(node.argument);\n\t\t\tdefault: throw new Error(`Unsupported unary operator: ${node.operator}`);\n\t\t}\n\t}\n\n\tisIdentifierDefined(name) {\n\t\treturn (Object.prototype.hasOwnProperty.call(this.helpers, name) ||\n\t\t\t(this.context && Object.prototype.hasOwnProperty.call(this.context, name)) ||\n\t\t\tname in GLOBAL_SCOPE);\n\t}\n\n\tperformDelete(argument) {\n\t\tif (argument.type === 'Identifier' && this.context && typeof this.context === 'object') {\n\t\t\treturn delete this.context[argument.value];\n\t\t}\n\t\tif (argument.type === 'MemberExpression') {\n\t\t\tconst target = this.evaluate(argument.object);\n\t\t\tif (target === null || target === undefined) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst property = argument.computed\n\t\t\t\t? this.evaluate(argument.property)\n\t\t\t\t: argument.property.type === 'Identifier'\n\t\t\t\t\t? argument.property.value\n\t\t\t\t\t: argument.property.value;\n\t\t\treturn delete target[property];\n\t\t}\n\t\tthis.evaluate(argument);\n\t\treturn true;\n\t}\n\n\tevaluateBinaryExpression(node) {\n\t\tconst left = this.evaluate(node.left);\n\t\tconst right = this.evaluate(node.right);\n\t\tswitch (node.operator) {\n\t\t\tcase '+': return left + right;\n\t\t\tcase '-': return left - right;\n\t\t\tcase '*': return left * right;\n\t\t\tcase '/': return left / right;\n\t\t\tcase '%': return left % right;\n\t\t\tcase '==': return left == right; // eslint-disable-line eqeqeq\n\t\t\tcase '!=': return left != right; // eslint-disable-line eqeqeq\n\t\t\tcase '===': return left === right;\n\t\t\tcase '!==': return left !== right;\n\t\t\tcase '<': return left < right;\n\t\t\tcase '>': return left > right;\n\t\t\tcase '<=': return left <= right;\n\t\t\tcase '>=': return left >= right;\n\t\t\tcase 'in': return left in right;\n\t\t\tcase 'instanceof': return left instanceof right;\n\t\t\tdefault: throw new Error(`Unsupported binary operator: ${node.operator}`);\n\t\t}\n\t}\n\n\tevaluateLogicalExpression(node) {\n\t\tswitch (node.operator) {\n\t\t\tcase '&&': {\n\t\t\t\tconst left = this.evaluate(node.left);\n\t\t\t\treturn left ? this.evaluate(node.right) : left;\n\t\t\t}\n\t\t\tcase '||': {\n\t\t\t\tconst left = this.evaluate(node.left);\n\t\t\t\treturn left ? left : this.evaluate(node.right);\n\t\t\t}\n\t\t\tcase '??': {\n\t\t\t\tconst left = this.evaluate(node.left);\n\t\t\t\treturn left !== null && left !== undefined ? left : this.evaluate(node.right);\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported logical operator: ${node.operator}`);\n\t\t}\n\t}\n\n\tevaluateObjectExpression(node) {\n\t\tconst obj = {};\n\t\tnode.properties.forEach(property => {\n\t\t\tconst key = this.evaluatePropertyKey(property.key);\n\t\t\tobj[key] = this.evaluate(property.value);\n\t\t});\n\t\treturn obj;\n\t}\n\n\tevaluatePropertyKey(node) {\n\t\tif (node.type === 'Identifier') {\n\t\t\treturn node.value;\n\t\t}\n\t\treturn node.value;\n\t}\n\n\tevaluateConditionalExpression(node) {\n\t\tconst test = this.evaluate(node.test);\n\t\treturn test ? this.evaluate(node.consequent) : this.evaluate(node.alternate);\n\t}\n}\n\nclass ExpressionParser {\n\tconstructor(options = {}) {\n\t\tthis.options = { cache: options.cache !== false, ...options };\n\t\tthis.astCache = new Map();\n\t\tthis.valueCache = new Map();\n\t}\n\n\ttokenize(expression) {\n\t\treturn new Tokenizer(expression).tokenize();\n\t}\n\n\tparse(expression, options = this.options) {\n\t\tconst useCache = this.shouldUseCache(options);\n\t\tif (useCache && this.astCache.has(expression)) {\n\t\t\treturn this.astCache.get(expression);\n\t\t}\n\t\tconst tokens = this.tokenize(expression);\n\t\tif (!tokens.length) {\n\t\t\tthrow new Error('Empty expression');\n\t\t}\n\t\tconst parser = new Parser(tokens);\n\t\tconst ast = parser.parse();\n\t\tObject.defineProperty(ast, 'tokens', {\n\t\t\tvalue: tokens,\n\t\t\tenumerable: false,\n\t\t\tconfigurable: true\n\t\t});\n\t\tif (useCache) {\n\t\t\tthis.astCache.set(expression, ast);\n\t\t}\n\t\treturn ast;\n\t}\n\n\tevaluate(expression, context = {}, options = {}) {\n\t\tconst mergedOptions = this.mergeOptions(options);\n\t\tconst useCache = this.shouldUseCache(mergedOptions);\n\t\tif (useCache) {\n\t\t\tconst cached = this.getCachedValue(expression, context, mergedOptions);\n\t\t\tif (cached.hit) {\n\t\t\t\treturn cached.value;\n\t\t\t}\n\t\t}\n\t\tconst ast = this.parse(expression, mergedOptions);\n\t\tconst evaluator = new Evaluator(context, mergedOptions);\n\t\tconst result = evaluator.evaluate(ast);\n\t\tif (useCache) {\n\t\t\tthis.storeCachedValue(expression, context, result, mergedOptions);\n\t\t}\n\t\treturn result;\n\t}\n\n\tshouldUseCache(options) {\n\t\treturn options.cache !== false;\n\t}\n\n\tmergeOptions(override = {}) {\n\t\tconst base = this.options || {};\n\t\tconst helpers = { ...(base.helpers || {}), ...(override.helpers || {}) };\n\t\tconst allowedFunctions = new Set([\n\t\t\t...((base.allowedFunctions) || []),\n\t\t\t...((override.allowedFunctions) || [])\n\t\t]);\n\t\treturn {\n\t\t\t...base,\n\t\t\t...override,\n\t\t\thelpers,\n\t\t\tallowedFunctions: Array.from(allowedFunctions)\n\t\t};\n\t}\n\n\tgetCachedValue(expression, context, options) {\n\t\tconst bucket = this.valueCache.get(expression);\n\t\tif (!bucket) {\n\t\t\treturn { hit: false };\n\t\t}\n\t\tif (this.isObjectLike(context)) {\n\t\t\tif (bucket.objectCache && bucket.objectCache.has(context)) {\n\t\t\t\treturn { hit: true, value: bucket.objectCache.get(context) };\n\t\t\t}\n\t\t\treturn { hit: false };\n\t\t}\n\t\tconst key = this.resolvePrimitiveKey(context, options);\n\t\tif (key === undefined) {\n\t\t\treturn { hit: false };\n\t\t}\n\t\tif (bucket.primitiveCache && bucket.primitiveCache.has(key)) {\n\t\t\treturn { hit: true, value: bucket.primitiveCache.get(key) };\n\t\t}\n\t\treturn { hit: false };\n\t}\n\n\tstoreCachedValue(expression, context, value, options) {\n\t\tlet bucket = this.valueCache.get(expression);\n\t\tif (!bucket) {\n\t\t\tbucket = { objectCache: new WeakMap(), primitiveCache: new Map() };\n\t\t\tthis.valueCache.set(expression, bucket);\n\t\t}\n\t\tif (this.isObjectLike(context)) {\n\t\t\tbucket.objectCache.set(context, value);\n\t\t\treturn;\n\t\t}\n\t\tconst key = this.resolvePrimitiveKey(context, options);\n\t\tif (key === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tbucket.primitiveCache.set(key, value);\n\t}\n\n\tresolvePrimitiveKey(context, options) {\n\t\tif (options.cacheKeyResolver) {\n\t\t\treturn options.cacheKeyResolver(context);\n\t\t}\n\t\treturn context;\n\t}\n\n\tisObjectLike(value) {\n\t\treturn value !== null && (typeof value === 'object' || typeof value === 'function');\n\t}\n\n}\n\nconst lang_mini_props = {\n\teach,\n\tis_array,\n\tis_dom_node,\n\tis_ctrl,\n\tclone,\n\tget_truth_map_from_arr,\n\ttm: get_truth_map_from_arr,\n\tget_arr_from_truth_map,\n\tarr_trim_undefined,\n\tget_map_from_arr,\n\tarr_like_to_arr,\n\ttof,\n\tatof,\n\ttf,\n\tload_type,\n\tis_defined,\n\tdef: is_defined,\n\tGrammar,\n\tstringify,\n\tfunctional_polymorphism,\n\tfp,\n\tmfp,\n\tarrayify,\n\tmapify,\n\tstr_arr_mapify,\n\tget_a_sig,\n\tdeep_sig,\n\tget_item_sig,\n\tset_vals,\n\ttruth,\n\ttrim_sig_brackets,\n\tll_set,\n\tll_get,\n\titerate_ancestor_classes,\n\tis_arr_of_t,\n\tis_arr_of_arrs,\n\tis_arr_of_strs,\n\tinput_processors,\n\toutput_processors,\n\tcall_multiple_callback_functions,\n\tcall_multi,\n\tmulti: call_multi,\n\tnative_constructor_tof,\n\tFns,\n\tsig_match,\n\tremove_sig_from_arr_shell,\n\tto_arr_strip_keys,\n\tarr_objs_to_arr_keys_values_table,\n\tset_arr_tree_value,\n\tget_arr_tree_value,\n\tdeep_arr_iterate,\n\tprom,\n\tcombinations,\n\tcombos: combinations,\n\tEvented_Class,\n\teventify,\n\tvectorify,\n\tv_add,\n\tv_subtract,\n\tv_multiply,\n\tv_divide,\n\tvector_magnitude,\n\tdistance_between_points,\n\tget_typed_array,\n\tgta: get_typed_array,\n\tPublisher,\n\tfield,\n\tprop,\n\tData_Type,\n\tFunctional_Data_Type,\n\tExpressionParser\n};\n\nconst lang_mini = new Evented_Class();\nObject.assign(lang_mini, lang_mini_props);\nlang_mini.note = (str_name, str_state, obj_properties) => {\n\tobj_properties = obj_properties || {};\n\tobj_properties.name = str_name;\n\tobj_properties.state = str_state;\n\tlang_mini.raise('note', obj_properties)\n}\nmodule.exports = lang_mini;\n\n// Bring in grammar / compound types to this typedef type thing.\n//   Types in the fields. \n\n// Detecting invalid view model states.\n//   Validating according to the spec of the data basically.\n\n// Defining data types and models with a gui....\n\n\n\n\nif (require.main === module) {\n\n\n\n\t/*\n\tfunction test_evented_class(test_data) {\n\t\tconst create_empty_test_res = () => {\n\t\t  return {\n\t\t\tpassed: [],\n\t\t\tfailed: []\n\t\t  };\n\t\t};\n\t  \n\t\t// Initialize res object with empty arrays\n\t\tconst res = create_empty_test_res();\n\t  \n\t\t// Test each event in test_data\n\t\tfor (let i = 0; i < test_data.length; i++) {\n\t\t  const { event_name, event_data } = test_data[i];\n\t  \n\t\t  // Test adding the event\n\t\t  const evented_class = new Evented_Class();\n\t\t  evented_class.add_event_listener(event_name, (data) => {\n\t\t\tif (data === event_data) {\n\t\t\t  res.passed.push(event_name);\n\t\t\t} else {\n\t\t\t  res.failed.push(event_name);\n\t\t\t}\n\t\t  });\n\t  \n\t\t  // Test raising the event\n\t\t  evented_class.raise_event(event_name, event_data);\n\t\t}\n\t  \n\t\t// Return test results\n\t\treturn res;\n\t  }\n\t  */\n\n\t  const test_data = [\n\t\t{\n\t\t\tevent_name: 'foo',\n\t\t\tevent_data: 'hello'\n\t\t},\n\t\t{\n\t\t\tevent_name: 'bar',\n\t\t\tevent_data: 'world'\n\t\t},\n\t\t{\n\t\t\tevent_name: 'baz',\n\t\t\tevent_data: true\n\t\t}\n\t];\n\t\n\tconst create_empty_test_res = () => ({\n\t\tpassed: [],\n\t\tfailed: []\n\t});\n\n\t  \n\t  function test_evented_class(test_data) {\n\t\tconst res = create_empty_test_res();\n\t\n\t\t// Create a new instance of Evented_Class\n\t\tconst evented_class = new Evented_Class();\n\t\n\t\t// Test each event in the test data\n\t\ttest_data.forEach(test_event => {\n\t\t\tconst event_name = test_event.event_name;\n\t\t\tconst event_data = test_event.event_data;\n\t\n\t\t\t// Define a listener for the event\n\t\t\tconst listener = data => {\n\t\t\t\tif (data === event_data) {\n\t\t\t\t\t// The event was raised with the expected data\n\t\t\t\t\tres.passed.push(event_name);\n\t\t\t\t} else {\n\t\t\t\t\t// The event was raised with the wrong data\n\t\t\t\t\tres.failed.push(event_name);\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\t// Add the listener to the evented class\n\t\t\tevented_class.on(event_name, listener);\n\t\n\t\t\t// Raise the event\n\t\t\tevented_class.raise_event(event_name, event_data);\n\t\t});\n\t\n\t\treturn res;\n\t}\n\t\n\n\n\tconst result = test_evented_class(test_data);\n\n\t// Print the results of the test\n\tconsole.log('Passed:', result.passed);\n\tconsole.log('Failed:', result.failed);\n\n\n}\n", "const lang = require('./lang-mini');\r\n\r\nconst {each, tof} = lang;\r\n\r\n\r\n// and lang types...\r\n//  Will use a Type class.\r\n//   Number_Type etc. String_Type perhaps.\r\n//     and then restrictions. JSON_Type is a String_Type.\r\n\r\n\r\n\r\n// Could have first implementation of types here even....\r\n//   Maybe don't use classes for them?\r\n//     Or do because they are so integrated into the language now.\r\n\r\n// Representation_Type\r\n//   eg represents a color (in specific way?) How it represents it...?\r\n//     ?? represents a 24bit rgb color ??\r\n//       why not? should be possible.\r\n\r\n\r\n// Some / all of oext would be nice within lang-mini...?\r\n\r\n// oext seems to work with types though, or would benefit from types.\r\n//   No, oext does not have much for types, moving field and prop from oext here, need to get the data types working with Data_Object\r\n//   and Data_Value. \r\n\r\n\r\n\r\n\r\n\r\n// Maybe move to lang-tools?\r\n//   fp() may benefit from integration with this.\r\n\r\n\r\n\r\n// What the type represents.\r\n// What it signifies?\r\n\r\n// But then how it's represented?\r\n\r\n\r\n// Not really about storing the data in memory or transmitting it.\r\n//   But saying it's 24 bit color is kind of about its representation.\r\n//   Still that's what it's called.\r\n\r\n// Type_Signifier seems better. Now it's called that.\r\n\r\n// Wider signification than just JS.\r\n\r\n\r\n// Type_Signifier_Component ????\r\n\r\n// Type_Signifier perhaps. Signifier_Type???\r\n\r\nclass Type_Signifier {\r\n    // Name\r\n    constructor(spec = {}) {\r\n\r\n        const name = spec.name;\r\n\r\n        // And use fields / quicker way to define these?\r\n\r\n        Object.defineProperty(this, 'name', {\r\n            get() {\r\n                return name;\r\n            }\r\n        });\r\n\r\n        const parent = spec.parent;\r\n\r\n        Object.defineProperty(this, 'parent', {\r\n            get() {\r\n                return parent;\r\n            }\r\n        });\r\n\r\n        const map_reserved_property_names = {\r\n            name: true,\r\n            parent: true\r\n        }\r\n\r\n        const _ = {};\r\n\r\n        each(spec, (value, name) => {\r\n            if (map_reserved_property_names[name]) {\r\n\r\n            } else {\r\n                _[name] = value;\r\n            }\r\n        });\r\n\r\n\r\n\r\n        // And other fields too....\r\n\r\n\r\n    }\r\n    extend(o_extension) {\r\n\r\n        const o = {\r\n            parent: this\r\n        }\r\n        Object.assign(o, o_extension);\r\n        const res = new Type_Signifier(o_extension);\r\n        return res;\r\n\r\n\r\n    }\r\n    //  Other options?\r\n    //  Disambiguiation? Descriptive text?\r\n    //    Or is naming them the main thing there?\r\n\r\n    // Color representation\r\n    //   And that is simple, does not go into internal representation.\r\n\r\n}\r\n\r\n\r\n\r\n\r\n// A representation for what is signified.\r\n//   This way if the programmer gets stuck about 'the' representation to make, they can make a decent representation, make it default,\r\n//     and move on for the moment.\r\n\r\n\r\n// Can be multiple allowed representations for a type.\r\n//   Binary data, JSON\r\n//   Compressed, uncompressed, maybe encrypted too.\r\n\r\n\r\n// Probably don't need subclasses for string or binary representations.\r\n//  Make this able to deal with both.\r\n//  String (kind of) is binary but likely uses UTF-8.\r\n\r\nclass Type_Representation {\r\n    // Name\r\n    //  Other options?\r\n    //  Disambiguiation? Descriptive text?\r\n    //    Or is naming them the main thing there?\r\n\r\n    // Color representation\r\n    //   And that is simple, does not go into internal representation.\r\n\r\n    // This should be able to represent types and lang features not available to JS.\r\n    //   Names may be optional? May be autogenerated and quite long?\r\n\r\n\r\n\r\n    constructor(spec = {}) {\r\n\r\n        // May be used on a lower level where the most suitable representation is selected.\r\n\r\n        // Generally:\r\n        //  string incl json\r\n        //  binary\r\n\r\n        // bridge the gap between numeric and binary.\r\n        //   make this ta-friendly and aware.\r\n\r\n        // represent components within a typed array? closely packed data structure?\r\n        \r\n\r\n        const name = spec.name;\r\n        Object.defineProperty(this, 'name', {\r\n            get() {\r\n                return name;\r\n            }\r\n        });\r\n\r\n        const parent = spec.parent;\r\n        Object.defineProperty(this, 'parent', {\r\n            get() {\r\n                return parent;\r\n            }\r\n        });\r\n\r\n        // Then the other fields?\r\n        //  Could have named fields.\r\n        //  Could have ordered fields?\r\n\r\n        const _ = {};\r\n\r\n        const map_reserved_property_names = {\r\n            'name': true\r\n        };\r\n\r\n        //  Even the number of bits being in here...?\r\n\r\n        each(spec, (value, name) => {\r\n            if (map_reserved_property_names[name]) {\r\n\r\n            } else {\r\n                _[name] = value;\r\n\r\n                // Could define the property here.\r\n                //  Read only (for the moment)\r\n\r\n                Object.defineProperty(this, name, {\r\n                    get() {\r\n                        return _[name];\r\n                    },\r\n                    enumerable: true\r\n                });\r\n\r\n\r\n            }\r\n        });\r\n        // Then a proxy to get other properties?\r\n    }\r\n    extend(o_extension) {\r\n\r\n        const o = {\r\n            parent: this\r\n        }\r\n        Object.assign(o, o_extension);\r\n        const res = new Type_Representation(o_extension);\r\n        return res;\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n// Will spell out some things in a quite verbose vanilla-js way here.\r\n//   Some higher level code will use types and other lang functionality to be less verbose and closer to English / the direct concepts.\r\n\r\n// Joins together 1 signifier and multiple representations.\r\n//   Name of item will be the signifier's name.\r\n\r\nclass Signifier_Representations_Type {\r\n    constructor(spec = {}) {\r\n        // 2 params in constructor? (signifier, arr_reps)???\r\n        //  could check for that.\r\n\r\n        if (spec.signifier && spec.representations) {\r\n\r\n            let signifier, arr_representations;\r\n\r\n            //if (spec.signifier) {\r\n            if (spec.signifier instanceof Type_Signifier) {\r\n                signifier = spec.signifier;\r\n            } else {\r\n                throw 'expected spec.signifier to be a Type_Signifier instance';\r\n            }\r\n            //}\r\n\r\n            if (tof(spec.representations) === 'array') {\r\n                let pass = true;\r\n                each(spec.representations, (representation, idx, stop) => {\r\n                    if (!(representation instanceof Type_Representation)) {\r\n                        pass = false;\r\n                        stop();\r\n                    }\r\n                })\r\n                if (pass) {\r\n                    arr_representations = spec.representations;\r\n                } else {\r\n                    throw 'Expected spec.representations to be an array of Type_Representation instances.';\r\n                }\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n        } else {\r\n            throw 'Expected spec.signifier and spec.representations'\r\n        }\r\n\r\n        \r\n\r\n\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// And could be subclasses of signification types...???\r\n\r\n// ui8 type signification?\r\n//   OK to signify that type, could indeed be represented with different actual values.\r\n//    such as as a string of decimal or hex digits.\r\n\r\n\r\n// Will have some basic / core types within lang-mini.\r\n//   Will not have a large amount of code.\r\n\r\n\r\n// Thematic types perhaps....\r\n//   seems like there could be overlap as well, eg image and document, text and document\r\n//   color, date/time, image, video, text, document, font, number, integer, floating point, string\r\n//     Type signifier could have theme property instead of or as well as name?\r\n//       Then representation of one thing as another. Represent a color as a number.\r\n\r\n// One advantage of putting in its own module is possible smaller file size.\r\n//   Though could possibly use lang-mini functionality as a platform for signifier and representer types.\r\n//   Type_Representer perhaps, not Type_Representation???\r\n//     Representation is probably the more accurate / better reading word.\r\n\r\n\r\n\r\n\r\nconst st_color = new Type_Signifier({'name': 'color'});\r\n\r\n// Signify an image. Signify a JPEG image. Etc.\r\n\r\n// then make a new one that extends st_color\r\n//   as in, a subtype.\r\nconst st_24bit_color = st_color.extend({'bits': 24});\r\n// Other types of 3 component color?\r\n\r\n//const st_24bit_rgb_color = st_24bit_color.extend({'components': ['red', 'green', 'blue']});\r\nconst st_24bit_rgb_color = st_24bit_color.extend({'components': ['red byte', 'green byte', 'blue byte']});\r\n//  or it already knows that these are bytes, when its 3 components in 24 bits.\r\n\r\n// st_24bit_rgb_color is only a signifier of 24 bit rgb color.\r\n//  Then there can be an implementation of it.\r\n//  Or a type (or class etc) could indicate it can handle it.\r\n\r\n// Type representation index could help.\r\n//   Query by name could return multiple items....\r\n//     Could have a property for the default representation with the name being searched for.\r\n\r\n\r\n\r\n\r\n\r\n\r\n// And have info about the properties by which it is represented?\r\n\r\nconst tr_string = new Type_Representation({'name': 'string'});\r\nconst tr_binary = new Type_Representation({'name': 'binary'}); // And could include number....\r\n// Numbers maybe extend binary.\r\n\r\n// And tr_ui8 even perhaps....\r\n\r\n\r\n\r\n\r\n// represent it as a binary sequence.\r\n//   Then could use more application specific tools like a Buffer or Typed Array.\r\n\r\n// Or extend the string type representation?\r\n\r\n// = tr_binary.extend();\r\n// trep maybe. and tsig or tsign.\r\n\r\n// Will make / finish some lower level components that interact with some specifically typed data.\r\n//   May well be worth doing more under 'grammar', getting type signifiers and type representations into the system.\r\n//     So far, types have been type representations. Now, they can be a signifier along with multiple representations.\r\n// A 'tags' type system of properties could help. Make it easy to specify / set up types.\r\n\r\n// Representation = Implementation (kind of)\r\n//   Or an interface.\r\n\r\n// Could use a Representation as an interface, in some cases.\r\n//   Inner representations as well\r\n//   Eg single color channel has a representation\r\n//     Would have a color name.\r\n//       Could even have a wavelength measurement for the color.\r\n\r\n// color channel 8 bit\r\n//   could use some language interpretation even. Some language processing could have the system 'understand' simple phrases describing\r\n//   type representations.\r\n\r\n// Actually using struct syntax for C++ or rust would be really good.\r\n//   Rust structs don't require fixed length strings in definition.\r\n\r\n// A struct being a Type_Representation, or Representational_Type.\r\n//   Dates can and do operate on different calendars.\r\n//     Same thing being signified, but with a different representation.\r\n// Diffent ways of representing strings and text. Now emojis too, they are part of unicode, and they keep getting updated.\r\n\r\n// Text characters are images that represent a letter or something else.\r\n//   They are symbols.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst rt_bin_24bit_rgb_color = new Type_Representation({\r\n    // A binary type representation.\r\n    'signifier': st_24bit_rgb_color,\r\n    'bytes': [\r\n        [0, 'red', 'ui8'],\r\n        [1, 'green', 'ui8'],\r\n        [2, 'blue', 'ui8']\r\n    ]\r\n});\r\n\r\n// Maybe do some work on a concise format for defining these types.\r\n// Maybe worth using or allowing the exact same syntax as C++ and/or rust for these stucts.\r\n//  Possibly some kind of syntax import. An example of how the same type of information can have different representations.\r\n\r\n\r\n\r\n\r\n// And an editor control could use a representation in terms of how it represents the data being edited to the user.\r\n\r\n// Binary type representation\r\nconst rt_hex_24bit_rgb_color = new Type_Representation({\r\n    // Likely some kind of string template.\r\n    //  Or a function?\r\n    //  Best to keep this function free here.\r\n    //  Or maybe make a few quite standard ones.\r\n    'signifier': st_24bit_rgb_color,\r\n\r\n    // Or could just have the sequence / template literal even.\r\n\r\n    'bytes': [\r\n        [0, '#', 'char'],\r\n        [1, 'hex(red)', 'string(2)'],\r\n        [3, 'hex(green)', 'string(2)'],\r\n        [5, 'hex(blue)', 'string(2)']\r\n    ]\r\n});\r\n\r\n// Year could be negative.\r\nconst st_date = new Type_Signifier({'name': 'date', 'components': ['day uint', 'month uint', 'year int']});\r\n// And datetime signification.\r\n\r\n// Approximate date ie date +- x years.\r\n\r\n\r\n// Just the date.\r\n\r\n\r\n\r\n//  or don't have the component types here?\r\n\r\n// String representation type.\r\n//  String_Type_Representation\r\n\r\n// Lots of different ways to represent a type.\r\n\r\n// Or say that they are numeric strings as well....\r\n\r\n// But a string char possibly takes more than 1 byte! Maybe not as defined here.\r\n//  String of int?\r\n//  Go into more details about how dates are represented?\r\n\r\n// Could consider JPEG to be a representation of Image.\r\n//   May want / need to think in terms of segments or blocks...\r\n//    segment_name = 'block' even. So it at least knows the right technical term.\r\n//   JPEG can have different versions, or subrepresentations.\r\n//     Type representations can have a supertype. That can be used with JPEG and then their versions are subtypes.\r\n//       A bit like the super-JPEG is a type representation of its own - except its got the details of the syntax.\r\n//     Want to make the overall system flexible in terms of what it represesnts, a fairly simple base structure.\r\n\r\n\r\n// Maybe make sections that define the representations just after the signifiers.\r\n//   Could have a fair few basic things defined.\r\n\r\n// Type Signifiers and Type Representations\r\n//   Think it could become an interesting book / programming topic.\r\n//   Could have implementations in a few languages too. Maybe suggestions for future languages and versions of them.\r\n\r\n// Make it its own module even?\r\n//   Could work better at a lower level.\r\n\r\n// srtypes module perhaps, or just srtype.\r\n// Coding with the distinction between signified and represented types could be really useful.\r\n//   Be able to handle serialization and deserialization (or format changes in some cases) 'for free', that is once the definitions\r\n//     have been made, the system will be able to convert between them (maybe requires some conversion functions to be written)\r\n//   System will have decent default type conversions.\r\n\r\n// Probably worth having set of 'standard' type definitions.\r\n//   System needs to be flexible so that they can be amended.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst rt_string_date_uk_ddmmyy = new Type_Representation({\r\n    'signifier': st_date,\r\n    'bytes': [\r\n        [0, '#', 'char'],\r\n        [1, 'day', 'string(2)'],\r\n        [3, '/', 'char'],\r\n        [4, 'month', 'string(2)'],\r\n        [6, '/', 'char'],\r\n        [7, 'year', 'string(2)']\r\n    ]\r\n});\r\n\r\n// Extra rules or restrictions? Defaults eg year 38 is 2038 etc...\r\n\r\n\r\n// A types registry could help.\r\n//  Registry of signified types\r\n//  Registry of type representations.\r\n//   Meaning 1 'type' in this system can be represented in multiple different ways.\r\n\r\n// Then the infrastructure within control declaration...\r\n//   Though likely will use the .model and .view mixins for this.\r\n//   Views (or controls?) will be made so that the model is a specific representation of a signified type.\r\n//     Or one a a few supported representations.\r\n//     Eg a color palette working for monochrome (8bit color depth).\r\n//       Or a color palette could allow selection of multiple colors.\r\n\r\n// Color_Chooser perhaps being simpler?\r\n//   Color_Palette seems like it should be able to deal with a bunch of different ways in which the data could be represented\r\n//     either in the app as the user interacts with it, in app memory, in transmission, in storage.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// There could be quite a lot of these type representations.\r\n\r\n\r\n\r\n// Can have plenty of ways of representing a date. Fewer ways of signifying one.\r\n\r\n\r\n// To signify something is in some ways less than to represent it.\r\n//   Signification is only about saying that it is there.\r\n\r\n// Maybe have a nice UI app to set up the signifier / representer links.\r\n\r\n\r\n\r\n\r\n\r\n// A moderate amount of data type representation info would help get JSGUI controls working nicely on the specific types\r\n//   of data they are supposed to interact with.\r\n\r\n// Ways of getting the data in and out of typed arrays\r\n//   Typed array (or buffer?) access for these data types?\r\n\r\n// Could make some nice GUI components (controls) for selecing / editing dates and colors.\r\n//   Can do it in a way that avoids code repetition.\r\n//   Make it so that the controls are able to represent the type on the screen.\r\n\r\n\r\n\r\n\r\n\r\n \r\n// These types seem most useful for the types that the user interacts with and putting the type knowledge into the GUI.\r\n\r\n// Type registry makes sense too.\r\n//  jsgui.types perhaps / lang.types\r\n//   An index of types? Collection of them?\r\n\r\n// Also registry of controls that are set up for dealing with specific types?\r\n//   Being able to identify and use variety of representations.\r\n\r\n// May integrate this into image format work - or make this good so that image format work can use this as a platform.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// and then day, month, year components\r\n\r\n\r\n\r\n\r\n// day, month year\r\n\r\n\r\n\r\n// or 'hexdigit(2)' maybe.\r\n\r\n// And the Control could conveniently show and allow editing of values using different representations.\r\n//   Such as a hex representation, or hex representations for comonents.\r\n\r\n// A Control could be aware of, and use both representations of a Data_Type.\r\n//   Color Palette seems like the right place to use that more advanced and general purpose functionality.\r\n//     Will work well for some imaging tools as well too.\r\n\r\n\r\n// More functional composition of controls could be cool....\r\n//   But let's make / improve the color palette.\r\n//     Moving the data outside it could work too.\r\n//     Consts directory. Or basis. Basics.\r\n\r\n\r\n\r\n// Have a class / instance of one that tracks ie is a DB for the type representations and significations.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Then put that within an array? 32 bit number used as 24 bit?\r\n\r\n\r\n// Though it may be most/least significant in some cases.\r\n\r\n\r\n\r\n\r\n// Then create a representation of 24 bit rgb color where it's the 3 components as bytes.\r\n//   Could be deduced from what we have already. May be easy enough to get from the Type_Signifier to this.\r\n//     However, will then have representations of the individual components too....\r\n//     Perhaps represent the whole thing as a string. eg #RRGGBB color for HTML. Or as items in an array.\r\n//       Even representing them as items within a typed array.\r\n\r\n\r\n// Allowing multiple representations of the same things.\r\n//   Representation sets - so we know which representations as (almost? totally?) interchangable.\r\n//   Can choose different default representations depending on performance.\r\n\r\n// Or implementation sets? Prefer representation here to describe how the types are represented rather than other connotations\r\n//   such as code for operators.\r\n\r\n//console.log('st_color', st_color);\r\n\r\nlang.Type_Signifier = Type_Signifier;\r\nlang.Type_Representation = Type_Representation;\r\n\r\n\r\n\r\n\r\n// Let's make something a little simpler and focused on representing the types of data in Data_Model classes.\r\n//   Control is such a class through inheritance, it extends Data_Object.\r\n\r\n// nfdt new functional data type function....?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// The representation type is a way to represent something\r\n//   What is being represented? That is all within a signifier type.\r\n\r\n// Or Implementation_Type? As in that is concrete in terms of how it is represented.\r\n// Representation_Implementation_Type???\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = lang;", "\r\n\r\nconst Shape = require('./Shape');\r\n\r\n// new Rectangle([w, h], [x, y]); seems like the most standard format.\r\n//.  Does seem best when defining the rectangle.\r\n//.    Possibly have some default parameter order property? Or a bit of online explanation?\r\n\r\nconst {tof, get_item_sig, is_arr_of_t} = require('lang-mini');\r\n\r\n\r\n//.  what it is, where it is???\r\n//.  or [pos, size]????\r\n// But it can exist without its position (usually / in theory at least).\r\n\r\n// \r\n\r\n// May be worth considering some kind of virtual (non-JS-class) rectangles that can be accessed through operations on \r\n//.  a single class instance that internally uses a ta efficiently?\r\n//.   Could have an API that returns Rectangle class instances but internally keeps all the data in a single (large enough) ta.\r\n//.     That would likely be best regarding performance concerns.\r\n\r\n\r\n\r\n// Rectangular_Geometry_Virtual_Container perhaps....\r\n\r\n// That could be a really specific class for \r\n\r\n// Could have some kind of lower level Geometry_Container.\r\n//.Or Rect_Geometry_Container\r\n//.  With capabilities and optimisations specifically for multiple rectangles on a 2d plane.\r\n\r\n// Could allow dealing with many rectangles without using the garbage collector for them.\r\n\r\n// Does seem worth using 'prop' function for brevity.\r\n\r\nconst {prop, get_set} = require('obext');\r\n\r\n// But want to be able to have this within a coord system where the y coordinates increase downwards.\r\n\r\n// rect.box???\r\n\r\n// rect.ta may help in some / many cases.\r\n\r\n// .rect.box perhaps????\r\n// .rect.coords ? .r.c?\r\n\r\n// and have jsgui3-html make use of this Rectangle class.\r\n//.  will support collision detection / avoidance for controls, which will help controls dynamically rearrange themselves.\r\n\r\n\r\n\r\nclass Rectangle extends Shape {\r\n\r\n    // y_axis_up_direction = -1 for example?\r\n\r\n    // up property being -1 or 1?\r\n    //. y_axis_scaling_factor = -1 would make sense here.\r\n\r\n    // though up_is_negitive would be simpler and quicker logically, could subtract vectors rater than multiply them by -1 and\r\n    // then add them.\r\n\r\n\r\n\r\n\r\n\r\n    // Should hold a typed array to keep a few values.\r\n    //.  Or even be able to be part of a larger typed array holding many rects.\r\n\r\n    // up_direction...?\r\n\r\n    // up = +1?\r\n\r\n\r\n    // This constructor system is maybe too slow for when many such rectangles get made.\r\n\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        this.up_is_negitive = true;\r\n        \r\n\r\n        const al = a.length;\r\n\r\n        // Could provide it a single typed array. That could maybe be initialised as a subarray (from the spec).\r\n\r\n        let x, y, w, h;\r\n\r\n        const sig = get_item_sig(a, 2);\r\n        //console.log('sig', sig);\r\n\r\n        // \r\n\r\n        if (sig === '[[n,n],[n,n]]') {\r\n            [[w, h], [x, y]] = a;\r\n        }\r\n\r\n        // Maybe defineProperty would be the better way here???\r\n\r\n        // const get_set = (obj, prop_name, fn_get, fn_set) => {\r\n\r\n        // And get_set could raise change events too....\r\n\r\n        get_set(this, 'x', () => x, (value) => x = value);\r\n        get_set(this, 'y', () => y, (value) => y = value);\r\n        get_set(this, ['w', 'width'], () => w, (value) => w = value);\r\n        get_set(this, ['h', 'height'], () => h, (value) => h = value);\r\n        \r\n        get_set(this, 'size', () => [w, h], (value) => [w, h] = value);\r\n        get_set(this, 'pos', () => [x, y], (value) => [x, y] = value);\r\n\r\n\r\n\r\n        get_set(this, 'left', () => x);\r\n        get_set(this, 'top', () => this.up_is_negitive ? y : y + h, value => this.up_is_negitive ? y = value : y = value - height);\r\n\r\n\r\n        get_set(this, 'right', () => x + w);\r\n        get_set(this, 'bottom', () => this.up_is_negitive ? y + h : y);\r\n\r\n\r\n        // The bcr interface.\r\n\r\n        const using_bcr_interface = true;\r\n\r\n        if (using_bcr_interface) {\r\n            get_set(this, '0', () => [x, y]);\r\n            get_set(this, '1', () => [this.right, this.bottom]);\r\n            get_set(this, '2', () => [w, h]);\r\n        }\r\n\r\n\r\n        \r\n        \r\n\r\n\r\n        // then the bounds...\r\n\r\n        // t, r\r\n        // top and right....\r\n\r\n\r\n\r\n\r\n\r\n        //prop(this, '')\r\n\r\n        //. Though that arrangement with y being top will not always be the case.\r\n        //.   Probably want that as an option in some place, such as when declaring a coord space.\r\n\r\n\r\n\r\n        // properties such as width, height, left (x), top (y)\r\n\r\n        //if (al === 2) {\r\n            // [size, pos]\r\n\r\n\r\n\r\n\r\n            // And are they both arrays?\r\n\r\n        //}\r\n    }\r\n\r\n    extend(direction, px) {\r\n        if (direction === 'left' || direction === 'l') {\r\n            const cx = this.x, cw = this.width;\r\n            this.x = cx - px;\r\n            this.width = cw + px;\r\n        } else if (direction === 'right' || direction === 'r') {\r\n            const cx = this.x, cw = this.width;\r\n            //this.x = cx - px;\r\n            this.width = cw + px;\r\n        } else if (direction === 'up' || direction === 'u') {\r\n            //const cx = this.x, cw = this.width;\r\n            //this.x = cx - px;\r\n            //this.width = cw + px;\r\n\r\n            if (this.up_is_negitive) {\r\n                this.y = this.y - px;\r\n                this.h = this.h + px;\r\n            } else {\r\n                this.h = this.h + px;\r\n            }\r\n        } else if (direction === 'down' || direction === 'd') {\r\n            //const cx = this.x, cw = this.width;\r\n            //this.x = cx - px;\r\n            //this.width = cw + px;\r\n\r\n            if (!this.up_is_negitive) {\r\n                this.y = this.y - px;\r\n                this.h = this.h + px;\r\n            } else {\r\n                this.h = this.h + px;\r\n            }\r\n        } else {\r\n            throw 'Supported directions: left l right r up u down d';\r\n        }\r\n        return this;\r\n    }\r\n\r\n\r\n    // Maybe we don't want Control specific things in here???\r\n    //.  Seems OK for now, though maybe should refactor it out later on.\r\n    //.  And this gfx-core is specific to jsgui3 so let's do it.\r\n\r\n    overlaps(overlap_target) {\r\n\r\n        const a = arguments;\r\n        const al = a.length;\r\n\r\n        if (al === 1) {\r\n\r\n            // Identify if it's an array of controls....\r\n\r\n            // shared_tof ???\r\n\r\n            const t_overlap_target = tof(overlap_target);\r\n            if (t_overlap_target === 'array') {\r\n                if (is_arr_of_t(overlap_target, 'control')) {\r\n                    const res = [];\r\n\r\n                    // then go through the overlap target array of controls...\r\n\r\n                    for (const target_ctrl of overlap_target) {\r\n                        //const target_bcr = target_ctrl.bcr();\r\n                        const target_overlap = this.overlaps(target_ctrl);\r\n                        if (target_overlap) { res.push(target_overlap)}\r\n                        \r\n                    }\r\n                    return res;\r\n\r\n                }\r\n            } else if (t_overlap_target === 'control') {\r\n                const target_bcr = overlap_target.bcr();\r\n                return this.overlaps(target_bcr);\r\n\r\n            } else if (overlap_target instanceof Rectangle) {\r\n\r\n                // Need to do the computation....\r\n\r\n                // Want to produce the overlapping rect if there is such a thing.\r\n                //.  Otherwise, false.\r\n\r\n                // Possibly rule it out quickly first....\r\n\r\n                // Calculate a bunch of offsets...? (subtractions)\r\n\r\n                // rect 1 is above rect 2\r\n                // rect 2 is above rect 1\r\n                //  below\r\n                //. left of\r\n                //. right of\r\n\r\n                // So that is 8 checks.\r\n                //.  Then if it's not checked like that, we have an overlap.\r\n                //.   Then detect where the overlap is....\r\n\r\n                const calculate_overlap = (box1, box2) => {\r\n                    const x = Math.max(box1.x, box2.x);\r\n                    const y = Math.max(box1.y, box2.y);\r\n                    const w = Math.min(box1.x + box1.w, box2.x + box2.w) - x;\r\n                    const h = Math.min(box1.y + box1.h, box2.y + box2.h) - y;\r\n                  \r\n                    if (w <= 0 || h <= 0) {\r\n                        return false; // No overlap\r\n                    } else {\r\n                        return new Rectangle([w, h], [x, y]);\r\n                    }\r\n                  \r\n                    \r\n                };\r\n\r\n                return calculate_overlap(this, overlap_target);\r\n\r\n\r\n            }\r\n\r\n            \r\n\r\n\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n\r\n        // Or even have it able to take an array of targets in the multiple params?\r\n\r\n        // is overlap_target an array of controls???\r\n\r\n        // Is the overlap target an array? a collective???\r\n\r\n        // array of controls?\r\n        // iterator of controls?\r\n        // iterable function of controls?\r\n\r\n    }\r\n\r\n    // Properties\r\n\r\n\r\n\r\n}\r\n\r\n\r\nif (require.main === module) {\r\n    const rect = new Rectangle([30, 40], [100, 100]);\r\n    console.log('rect', rect);\r\n\r\n    console.log('rect.right', rect.right);\r\n\r\n    rect.extend('l', 40);\r\n    rect.extend('u', 40);\r\n\r\n\r\n    console.log('rect.left', rect.left);\r\n    console.log('rect.top', rect.top);\r\n    console.log('rect.right', rect.right);\r\n\r\n    // rect.pos\r\n\r\n\r\n}\r\n\r\n\r\nmodule.exports = Rectangle;", "// Simple enough... can add pixels, can iterate through the pixels.\r\n//  Would be good to .to_pixel_buffer?\r\n\r\n// Getting lists of pixel positions when extracting regions would be a nice optimization over bit masks that use 8 bpp.\r\n//  Will support 1 bipp properly. 0.125bypp.\r\n//  While this is 32bpp, it's only specific pixels.\r\n\r\nconst inspect = Symbol.for('nodejs.util.inspect.custom');\r\n\r\nconst Ui16toUi32 = (ui16) => {\r\n    let res = new Uint32Array(ui16.length / 2);\r\n    let dv = new DataView(ui16.buffer);\r\n    let l = ui16.length;\r\n    let hl = l / 2;\r\n    let resw = 0;\r\n    for (let c = 0; c < hl; c++) {\r\n        res[resw++] = dv.getUint32(c * 4);\r\n    }\r\n    return res;\r\n}\r\n\r\nconst Ui32toUi16 = (ui32) => {\r\n    let res = new Uint16Array(ui32.length * 2);\r\n    let dv = new DataView(ui32.buffer);\r\n    let l = ui32.length;\r\n    let resw = 0;\r\n    for (let c = 0; c < l; c++) {\r\n        res[resw++] = dv.getUint16(c * 4 + 2);\r\n        res[resw++] = dv.getUint16(c * 4);\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * A class for efficiently managing a list of pixel positions.\r\n * Provides methods for adding, removing, sorting, and iterating over pixel positions.\r\n */\r\nclass Pixel_Pos_List {\r\n    [Symbol.iterator]() {\r\n        let index = 0;\r\n        const pixels = [];\r\n        \r\n        this.each_pixel(pos => {\r\n            pixels.push([pos[0], pos[1]]);\r\n        });\r\n        \r\n        return {\r\n            next: () => {\r\n                if (index < pixels.length) {\r\n                    return { value: pixels[index++], done: false };\r\n                } else {\r\n                    return { done: true };\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    [inspect]() {\r\n        return this.toString();\r\n    }\r\n\r\n    toString() {\r\n        const res = 'PPL ' + JSON.stringify({\r\n            length: this.length,\r\n            pixels: this.str_pixels\r\n        });\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Creates a new Pixel_Pos_List instance.\r\n     * @param {Object} [spec] - Optional specification object.\r\n     */\r\n    constructor(spec) {\r\n        // current capacity * 10 when expanding.\r\n        const capacities = new Uint32Array([16, 1024, 1024 * 1024 / 8, 1024 * 1024 / 2, 1024 * 1024 * 2, 1024 * 1024 * 8]);\r\n        let i_capacity = 0;\r\n        let capacity = capacities[i_capacity];\r\n        let max_index = capacity * 2 - 1;\r\n        // Could start with much lower capacity and increase it if necessary.\r\n        let i = 0;\r\n        let ta_pixels = new Uint16Array(capacity * 2);\r\n        let read_pos = 0;\r\n\r\n        // Array methods\r\n        /**\r\n         * Sorts the pixel positions.\r\n         * Compacts the array first if needed.\r\n         * @returns {Pixel_Pos_List} this instance for chaining\r\n         */\r\n        this.sort = () => {\r\n            // If there are elements that have been shifted out, compact the array first\r\n            if (read_pos > 0) {\r\n                // Copy remaining elements to the beginning of the array\r\n                const length = i - read_pos;\r\n                for (let idx = 0; idx < length; idx++) {\r\n                    ta_pixels[idx] = ta_pixels[idx + read_pos];\r\n                }\r\n                i = length;\r\n                read_pos = 0;\r\n            }\r\n            \r\n            // Only sort the actually used part of the array\r\n            const activeSlice = ta_pixels.slice(0, i);\r\n            let ui32 = Ui16toUi32(activeSlice);\r\n            ui32.sort();\r\n            \r\n            // Copy the sorted values back\r\n            const sortedUi16 = Ui32toUi16(ui32);\r\n            for (let idx = 0; idx < i; idx++) {\r\n                ta_pixels[idx] = sortedUi16[idx];\r\n            }\r\n            \r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * Removes and returns the first pixel position in the list.\r\n         * @returns {Uint16Array|undefined} The pixel position or undefined if empty\r\n         */\r\n        this.shift = () => {\r\n            if (read_pos < i) {\r\n                const res = new Uint16Array(2);\r\n                res[0] = ta_pixels[read_pos];\r\n                res[1] = ta_pixels[read_pos + 1];\r\n                read_pos += 2;\r\n                \r\n                // If we've removed a significant number of elements, compact the array\r\n                if (read_pos >= 1024 && read_pos > i / 2) {\r\n                    // Create a new array with just the remaining elements\r\n                    const newArray = new Uint16Array(i - read_pos);\r\n                    for (let idx = 0; idx < i - read_pos; idx++) {\r\n                        newArray[idx] = ta_pixels[idx + read_pos];\r\n                    }\r\n                    \r\n                    // Update internal arrays and indices\r\n                    ta_pixels = this.ta = newArray;\r\n                    i = i - read_pos;\r\n                    read_pos = 0;\r\n                    max_index = ta_pixels.length - 1;\r\n                }\r\n                \r\n                return res;\r\n            }\r\n            \r\n            // Return undefined if there are no more pixels to shift\r\n            return undefined;\r\n        }\r\n\r\n        /**\r\n         * Removes and returns the last pixel position in the list.\r\n         * @returns {Uint16Array|undefined} The pixel position or undefined if empty\r\n         */\r\n        this.pop = () => {\r\n            // If index pointer is at least 2 (meaning there's at least one pixel)\r\n            if (i > read_pos) {\r\n                // Create a new array for the result\r\n                const res = new Uint16Array(2);\r\n                // Decrease the index by 2 (one full pixel)\r\n                i -= 2;\r\n                // Copy the values\r\n                res[0] = ta_pixels[i];\r\n                res[1] = ta_pixels[i+1];\r\n                return res;\r\n            }\r\n            // Return undefined if there are no pixels to pop\r\n            return undefined;\r\n        }\r\n\r\n        // Could start out with a smaller ta_pixels.\r\n        this.ta = ta_pixels;\r\n\r\n        /**\r\n         * Adds a pixel position to the list.\r\n         * @param {Array|Uint16Array} pos - The [x, y] position to add\r\n         * @returns {Pixel_Pos_List} this instance for chaining\r\n         * @throws {Error} If the position is invalid\r\n         */\r\n        this.add = (pos) => {\r\n            // Validate input\r\n            if (!pos || pos.length < 2) {\r\n                throw new Error('Invalid pixel position. Expected [x, y] array with at least 2 elements.');\r\n            }\r\n            \r\n            // Ensure position values are integers\r\n            const x = Math.floor(pos[0]);\r\n            const y = Math.floor(pos[1]);\r\n            \r\n            // Check if we need to resize the array\r\n            if (i > max_index) {\r\n                // Could check to see if the array can be shortened.\r\n                // Same capacity, but move it forward.\r\n                if (read_pos >= 1024) {\r\n                    const new_ta = new Uint16Array(capacity * 2);\r\n                    const l = ta_pixels.length - read_pos;\r\n                    for (let c = 0; c < l; c++) {\r\n                        new_ta[c] = ta_pixels[c + read_pos];\r\n                    }\r\n                    ta_pixels = new_ta;\r\n                    i -= read_pos;\r\n                    read_pos = 0;\r\n                } else {\r\n                    // Need to increase the capacity\r\n                    if (i_capacity < capacities.length - 1) {\r\n                        capacity = capacities[++i_capacity];\r\n                    } else {\r\n                        // If we've reached the maximum predefined capacity, double the current capacity\r\n                        capacity *= 2;\r\n                    }\r\n                    \r\n                    max_index = capacity * 2 - 1;\r\n                    const new_ta = new Uint16Array(capacity * 2);\r\n                    const l = ta_pixels.length;\r\n                    for (let c = 0; c < l; c++) {\r\n                        new_ta[c] = ta_pixels[c];\r\n                    }\r\n                    ta_pixels = this.ta = new_ta;\r\n                }\r\n            }\r\n            \r\n            ta_pixels[i++] = x;\r\n            ta_pixels[i++] = y;\r\n            \r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * Iterates over each pixel in the list.\r\n         * @param {Function} cb - Callback function receiving (pixel, index)\r\n         */\r\n        this.each_pixel = (cb) => {\r\n            // Start from the read pos\r\n            let count = 0;\r\n            for (let i2 = read_pos; i2 < i; i2 += 2) {\r\n                // Create a fresh copy of the pixel data for the callback\r\n                const pixelPos = new Uint16Array(2);\r\n                pixelPos[0] = ta_pixels[i2];\r\n                pixelPos[1] = ta_pixels[i2 + 1];\r\n                cb(pixelPos, count++);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Trims the internal array to the actual size of the data.\r\n         * @returns {Pixel_Pos_List} this instance for chaining\r\n         */\r\n        this.fix = () => {\r\n            // Slice the array to only include the actual pixels\r\n            const adjusted = ta_pixels.slice(0, i);\r\n            // Update both the instance property and the local variable\r\n            this.ta = ta_pixels = adjusted;\r\n            // Reset the max_index since we've resized\r\n            max_index = this.ta.length - 1;\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * Compares this list with another pixel position list.\r\n         * @param {Pixel_Pos_List} pixel_pos_list - The list to compare with\r\n         * @returns {boolean} True if the lists contain the same pixels\r\n         */\r\n        this.equals = (pixel_pos_list) => {\r\n            // Check if both instances have the same number of pixels\r\n            if (this.length !== pixel_pos_list.length) {\r\n                return false;\r\n            }\r\n            \r\n            // Extract all pixels from both lists for comparison\r\n            const thisList = [];\r\n            const otherList = [];\r\n            \r\n            this.each_pixel(pos => {\r\n                thisList.push([pos[0], pos[1]]);\r\n            });\r\n            \r\n            pixel_pos_list.each_pixel(pos => {\r\n                otherList.push([pos[0], pos[1]]);\r\n            });\r\n            \r\n            // Sort both lists for consistent comparison\r\n            thisList.sort((a, b) => {\r\n                if (a[0] === b[0]) return a[1] - b[1];\r\n                return a[0] - b[0];\r\n            });\r\n            \r\n            otherList.sort((a, b) => {\r\n                if (a[0] === b[0]) return a[1] - b[1];\r\n                return a[0] - b[0];\r\n            });\r\n            \r\n            // Compare each pixel\r\n            for (let i = 0; i < thisList.length; i++) {\r\n                if (thisList[i][0] !== otherList[i][0] || thisList[i][1] !== otherList[i][1]) {\r\n                    return false;\r\n                }\r\n            }\r\n            \r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * Maps each pixel position to a new value using the callback function.\r\n         * @param {Function} mapFn - Function that receives (pixel, index) and returns a new value\r\n         * @returns {Array} Array of mapped values\r\n         */\r\n        this.map = (mapFn) => {\r\n            const result = [];\r\n            this.each_pixel((pos, idx) => {\r\n                result.push(mapFn(pos, idx));\r\n            });\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * Filters pixel positions based on the predicate function.\r\n         * @param {Function} predicate - Function that receives (pixel, index) and returns boolean\r\n         * @returns {Pixel_Pos_List} A new Pixel_Pos_List with the filtered pixels\r\n         */\r\n        this.filter = (predicate) => {\r\n            const result = new Pixel_Pos_List();\r\n            this.each_pixel((pos, idx) => {\r\n                if (predicate(pos, idx)) {\r\n                    result.add([pos[0], pos[1]]);\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * Executes a function for each pixel position.\r\n         * @param {Function} callback - Function that receives (pixel, index)\r\n         */\r\n        this.forEach = (callback) => {\r\n            this.each_pixel(callback);\r\n        }\r\n\r\n        /**\r\n         * Creates a string representation of all pixels.\r\n         * @private\r\n         */\r\n        const str_pixels = () => {\r\n            let res = '';\r\n            let first = true;\r\n            this.each_pixel(pos => {\r\n                if (first) {\r\n                    first = false;\r\n                } else {\r\n                    res = res + ', ';\r\n                }\r\n                res = res + '[' + pos[0] + ', ' + pos[1] + ']';\r\n            });\r\n            return res;\r\n        }\r\n\r\n        /**\r\n         * Property to get a string representation of all pixels.\r\n         */\r\n        Object.defineProperty(this, 'str_pixels', {\r\n            get: () => str_pixels(),\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        /**\r\n         * Property to get the number of pixels in the list.\r\n         */\r\n        Object.defineProperty(this, 'length', {\r\n            get: () => ((i - read_pos) / 2),\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        /**\r\n         * Property to get the bounding box of all pixels.\r\n         * @returns {Uint16Array} [minX, minY, maxX, maxY]\r\n         */\r\n        let _bounds;\r\n        Object.defineProperty(this, 'bounds', {\r\n            get: () => {\r\n                // Always recalculate bounds when accessed\r\n                _bounds = new Uint16Array(4);\r\n                \r\n                // Initialize bounds with values that will be replaced\r\n                if (this.length > 0) {\r\n                    // Default to extreme values\r\n                    _bounds[0] = Number.MAX_SAFE_INTEGER; // Minimum x\r\n                    _bounds[1] = Number.MAX_SAFE_INTEGER; // Minimum y\r\n                    _bounds[2] = 0; // Maximum x\r\n                    _bounds[3] = 0; // Maximum y\r\n                    \r\n                    // Iterate through all pixels to find min/max values\r\n                    this.each_pixel(pos => {\r\n                        if (pos[0] < _bounds[0]) _bounds[0] = pos[0];\r\n                        if (pos[0] > _bounds[2]) _bounds[2] = pos[0];\r\n                        if (pos[1] < _bounds[1]) _bounds[1] = pos[1];\r\n                        if (pos[1] > _bounds[3]) _bounds[3] = pos[1];\r\n                    });\r\n                } else {\r\n                    // If no pixels, use default bounds of 0,0,0,0\r\n                    _bounds[0] = 0;\r\n                    _bounds[1] = 0;\r\n                    _bounds[2] = 0;\r\n                    _bounds[3] = 0;\r\n                }\r\n                \r\n                return _bounds;\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        /**\r\n         * Property to get the top-left position of all pixels.\r\n         * @returns {Uint16Array} [minX, minY]\r\n         */\r\n        let _pos;\r\n        Object.defineProperty(this, 'pos', {\r\n            get: () => {\r\n                // Always recalculate position when accessed\r\n                _pos = new Uint16Array(2);\r\n                \r\n                if (this.length > 0) {\r\n                    _pos[0] = Number.MAX_SAFE_INTEGER;\r\n                    _pos[1] = Number.MAX_SAFE_INTEGER;\r\n                    \r\n                    this.each_pixel(pos => {\r\n                        if (pos[0] < _pos[0]) _pos[0] = pos[0];\r\n                        if (pos[1] < _pos[1]) _pos[1] = pos[1];\r\n                    });\r\n                } else {\r\n                    _pos[0] = 0;\r\n                    _pos[1] = 0;\r\n                }\r\n                \r\n                return _pos;\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        /**\r\n         * Clears all pixels from the list.\r\n         * @returns {Pixel_Pos_List} this instance for chaining\r\n         */\r\n        this.clear = () => {\r\n            i = 0;\r\n            read_pos = 0;\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * Checks if the list contains the given pixel position.\r\n         * @param {Array|Uint16Array} pos - The [x, y] position to check\r\n         * @returns {boolean} True if the position is in the list\r\n         */\r\n        this.contains = (pos) => {\r\n            if (!pos || pos.length < 2) return false;\r\n            \r\n            // For non-integer values, check if they need to be floored\r\n            // We only match exact integer values or floored non-integers\r\n            const isXInteger = Number.isInteger(pos[0]);\r\n            const isYInteger = Number.isInteger(pos[1]);\r\n            \r\n            // If both values are non-integers, we won't find a match\r\n            if (!isXInteger && !isYInteger) {\r\n                return false;\r\n            }\r\n            \r\n            const x = Math.floor(pos[0]);\r\n            const y = Math.floor(pos[1]);\r\n            \r\n            let found = false;\r\n            this.each_pixel(pixel => {\r\n                if (pixel[0] === x && pixel[1] === y) {\r\n                    // For non-integer inputs, only match if the input values floor to the same values\r\n                    if ((!isXInteger && Math.floor(pos[0]) !== pos[0]) || \r\n                        (!isYInteger && Math.floor(pos[1]) !== pos[1])) {\r\n                        return; // Skip this match for non-integers\r\n                    }\r\n                    found = true;\r\n                }\r\n            });\r\n            \r\n            return found;\r\n        }\r\n\r\n        /**\r\n         * Converts the list to a plain array of [x,y] positions.\r\n         * @returns {Array} Array of [x,y] positions\r\n         */\r\n        this.toArray = () => {\r\n            const result = [];\r\n            this.each_pixel(pos => {\r\n                result.push([pos[0], pos[1]]);\r\n            });\r\n            return result;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a Pixel_Pos_List from an array of positions.\r\n     * @param {Array} positions - Array of [x,y] positions\r\n     * @returns {Pixel_Pos_List} A new Pixel_Pos_List\r\n     * @static\r\n     */\r\n    static fromArray(positions) {\r\n        const ppl = new Pixel_Pos_List();\r\n        if (Array.isArray(positions)) {\r\n            positions.forEach(pos => {\r\n                if (Array.isArray(pos) && pos.length >= 2) {\r\n                    ppl.add(pos);\r\n                }\r\n            });\r\n        }\r\n        return ppl;\r\n    }\r\n}\r\n\r\n// Example usage when run as a script\r\nif (require.main === module) {\r\n    const test1 = () => {\r\n        let ppl = new Pixel_Pos_List();\r\n        ppl.add([2, 2]);\r\n        ppl.add([2, 3]);\r\n        ppl.add([8, 4]);\r\n        ppl.add([8, 3]);\r\n        ppl.add([3, 3]);\r\n        ppl.add([1, 2]);\r\n        ppl.add([1, 3]);\r\n        ppl.add([3, 2]);\r\n        ppl.fix();\r\n        \r\n        // Using iterator protocol\r\n        console.log('Pixels using for...of:');\r\n        for (const pos of ppl) {\r\n            console.log(`  [${pos[0]}, ${pos[1]}]`);\r\n        }\r\n        \r\n        // Using new methods\r\n        console.log('\\nFiltered pixels (x > 2):');\r\n        const filtered = ppl.filter(pos => pos[0] > 2);\r\n        filtered.forEach(pos => {\r\n            console.log(`  [${pos[0]}, ${pos[1]}]`);\r\n        });\r\n        \r\n        // Map\r\n        console.log('\\nMapped pixels (x+y):');\r\n        const sums = ppl.map(pos => pos[0] + pos[1]);\r\n        console.log(sums);\r\n        \r\n        console.log('\\nSorted pixels:');\r\n        ppl = ppl.sort();\r\n        let item;\r\n        while ((item = ppl.shift())) {\r\n            console.log(`  [${item[0]}, ${item[1]}]`);\r\n        }\r\n    }\r\n    test1();\r\n} else {\r\n    // Required as a module\r\n}\r\n\r\nmodule.exports = Pixel_Pos_List;", "\r\nclass Typed_Array_Binary_Read_Write {\r\n\r\n    constructor(ta) {\r\n        this.ta = ta;\r\n        this.dv = new DataView(ta.buffer, ta.byteOffset, ta.byteLength);\r\n        this.byl = ta.byteLength;\r\n        this.bil = this.byl << 3;\r\n    }\r\n\r\n    get_bit(idx_bit) {\r\n        const idx_byte_bit = idx_bit & 7;\r\n        return (this.dv.getUint8(idx_bit >>> 3) & (1 << idx_byte_bit)) >> idx_byte_bit;\r\n    }\r\n\r\n    set_bit(idx_bit, value) {\r\n        // Ensure value is constrained to either 0 or 1\r\n        value = value ? 1 : 0;\r\n\r\n        const { dv } = this;\r\n        const idx_byte = idx_bit >>> 3;\r\n        const idx_byte_bit = idx_bit & 7;\r\n        const byte_mask = 1 << idx_byte_bit;\r\n        const read_byte = dv.getUint8(idx_byte);\r\n        const updated_byte = (read_byte & ~byte_mask) | (value << idx_byte_bit);\r\n        \r\n        dv.setUint8(idx_byte, updated_byte);\r\n    }\r\n}\r\n\r\nmodule.exports = Typed_Array_Binary_Read_Write;", "\r\n\r\n\r\n// dest_aligned_copy_rect_1to4bypp\r\n//  the destination size is aligned with the ta_source_bounds\r\n//   could check that previously in a more generalised copy_rect function.\r\n\r\nconst get_instance = () => {\r\n\r\n    const copy_ta_byte_range = (ta_source, ta_dest, byte_idx_source_start, byte_idx_dest_start, length) => {\r\n\r\n        // Try the system from row copy.\r\n    \r\n        // Could try version with inner loop?\r\n    \r\n        ta_dest.set(ta_source.subarray(byte_idx_source_start, byte_idx_source_start + length), byte_idx_dest_start);\r\n    \r\n    }\r\n    \r\n    \r\n    // Need more general version of this.\r\n    \r\n    // Some more work on copying aligned / non-aligned tas.\r\n    //  Different mathematical operations needed for different image operations specifics.\r\n    \r\n    \r\n    // Should rename this to be more specific about it writing into the full ta space.\r\n    //  dest is the same size as the bounds.\r\n    \r\n    // copy to same bounds size.\r\n    \r\n    const copy_rect_to_same_size_8bipp = (xy, bounds, ta, ta_res, ta_byte_indexes, bytes_read_row_end_jump) => {\r\n            // bytes_read_row_end_jump : ta_op_further_info[0]\r\n        //const bytes_read_row_end_jump = ta_op_further_info[0];\r\n        // Safety checking to begin with?\r\n    \r\n        // May as well use local variables for loop...\r\n        \r\n    \r\n    \r\n        for (xy[1] = bounds[1]; xy[1] < bounds[3]; xy[1]++) {\r\n            for (xy[0] = bounds[0]; xy[0] < bounds[2]; xy[0]++) {\r\n                ta_res[ta_byte_indexes[1]++] = ta[ta_byte_indexes[0]++];\r\n            }\r\n            // then row jump increase.\r\n            ta_byte_indexes[0] += bytes_read_row_end_jump;\r\n        }\r\n    }\r\n    \r\n    \r\n    const copy_rect_to_same_size_24bipp = (xy, bounds, ta, ta_res, ta_byte_indexes, bytes_read_row_end_jump) => {\r\n        \r\n        // Safety checking to begin with?\r\n        for (xy[1] = bounds[1]; xy[1] < bounds[3]; xy[1]++) {\r\n            for (xy[0] = bounds[0]; xy[0] < bounds[2]; xy[0]++) {\r\n    \r\n                //const ui8_px_value = ta[byte_idx_pb_read];\r\n                //ui8_px_value = ta[byte_idx_pb_read];\r\n    \r\n                //console.log('byte_idx_pb_read')\r\n    \r\n                ta_res[ta_byte_indexes[1]++] = ta[ta_byte_indexes[0]++];\r\n                ta_res[ta_byte_indexes[1]++] = ta[ta_byte_indexes[0]++];\r\n                ta_res[ta_byte_indexes[1]++] = ta[ta_byte_indexes[0]++];\r\n    \r\n                // But don't need to copy the px value in many cases.\r\n    \r\n                //  Maybe have / use lower level fuctions for copying between different pbs / tas.\r\n                //  Iterating spaces.\r\n                //   Iterating spaces defined by a function / equation?\r\n                //    Eg could functionally / mathematically define a circle and draw it.\r\n                \r\n                // got the xy iteration pos set correctly here :)\r\n    \r\n                // could copy px values?\r\n                //  reading and using them directly may work best....\r\n    \r\n                //byte_idx_pb_read += bytes_per_pixel;\r\n    \r\n            }\r\n            // then row jump increase.\r\n            ta_byte_indexes[0] += bytes_read_row_end_jump;\r\n        }\r\n    }\r\n    \r\n    // pre-running functions to uptimize them?\r\n    \r\n    \r\n    // Worth writing and trying / exemplifying fast copy algorithms.\r\n    \r\n    // copy from 8bipp to 24 bipp as well.\r\n    //   likely should read and write by pixel?\r\n    //   should be easy to make synced algorithm for this.\r\n    \r\n    \r\n    // for the moment, likely to use many function parameters...\r\n    \r\n    // Will use byte index iteration?\r\n    //  Will do xy iteration having been given the source bounds and the dest pos?\r\n    \r\n    \r\n    // Use byte indexes?\r\n    \r\n    // bytes_pre_row source\r\n    // bytes_per_row_dest\r\n    \r\n    // bypr_source\r\n    \r\n    \r\n    // dest_pos is alway [0, 0]. For when the size of the copied area = the size of the dest.\r\n    \r\n    const dest_aligned_copy_rect_1to4bypp = (ta_source, ta_dest, bypr_source, bytes_per_pixel, ta_source_bounds) => {\r\n        let y;\r\n    \r\n        // check ta_dest.length meets expectation?\r\n    \r\n    \r\n        //console.log('ta_source_bounds', ta_source_bounds);\r\n        //console.log('bytes_per_pixel', bytes_per_pixel);\r\n    \r\n    \r\n        // Uses copy ta byte range function underneith.\r\n    \r\n        // need to calculate initial read and write byte idxs\r\n    \r\n        // calculate the start index for both the source and the dest.\r\n    \r\n        const bounds_row_width = ta_source_bounds[2] - ta_source_bounds[0];\r\n        const bypr_dest = bounds_row_width * bytes_per_pixel;\r\n        //console.log('bounds_row_width', bounds_row_width);\r\n        const bytes_per_bounds_row = bytes_per_pixel * bounds_row_width;\r\n        const byi_read_start = (ta_source_bounds[0] * bytes_per_pixel) + (ta_source_bounds[1] * bypr_source);\r\n        //const byi_dest_start = (bytes_per_pixel) + (ta_dest_pos[1] * bypr_dest);\r\n        const byi_dest_start = 0;\r\n    \r\n        let byi_read = byi_read_start, byi_write = byi_dest_start;\r\n        //const bytes_source_row_jump = bypr_source - bytes_per_bounds_row, bytes_dest_row_jump = bypr_dest - bytes_per_bounds_row;\r\n    \r\n        //console.log('bytes_source_row_jump', bytes_source_row_jump);\r\n        //console.log('bytes_dest_row_jump', bytes_dest_row_jump);\r\n    \r\n        //console.log('bytes_per_bounds_row', bytes_per_bounds_row);\r\n    \r\n    \r\n        for (y = ta_source_bounds[1]; y < ta_source_bounds[3]; y++) {\r\n            //console.log('byi_read, byi_write', [byi_read, byi_write]);\r\n            copy_ta_byte_range(ta_source, ta_dest, byi_read, byi_write, bytes_per_bounds_row);\r\n    \r\n            byi_read += bypr_source;\r\n            byi_write += bypr_dest;\r\n    \r\n            // use the sopy row function?\r\n            //  worth giving it a try.\r\n    \r\n            // Can use the full row copy procedure.\r\n            //copy_ta_byte_range\r\n        }\r\n    }\r\n    \r\n    // Worth writing and using some copy algorithms. Further work on supporting abstractions / data.\r\n    \r\n    const unaligned_copy_rect_1to4bypp = (ta_source, ta_dest, bypr_source, bypr_dest, bytes_per_pixel, ta_source_bounds, ta_dest_pos) => {\r\n        // try own local y and x...\r\n    \r\n        let y;\r\n    \r\n        //console.log('ta_source_bounds', ta_source_bounds);\r\n        //console.log('bytes_per_pixel', bytes_per_pixel);\r\n    \r\n    \r\n        // Uses copy ta byte range function underneith.\r\n    \r\n        // need to calculate initial read and write byte idxs\r\n    \r\n        // calculate the start index for both the source and the dest.\r\n    \r\n        const bounds_row_width = ta_source_bounds[2] - ta_source_bounds[0];\r\n        //console.log('bounds_row_width', bounds_row_width);\r\n        const bytes_per_bounds_row = bytes_per_pixel * bounds_row_width;\r\n    \r\n        //console.log('bypr_source', bypr_source);\r\n        //console.log('bypr_dest', bypr_dest);\r\n    \r\n    \r\n        const byi_read_start = (ta_source_bounds[0] * bytes_per_pixel) + (ta_source_bounds[1] * bypr_source);\r\n        const byi_dest_start = (ta_dest_pos[0] * bytes_per_pixel) + (ta_dest_pos[1] * bypr_dest);\r\n    \r\n        //console.log('byi_read_start', byi_read_start);\r\n        //console.log('byi_dest_start', byi_dest_start);\r\n    \r\n        let byi_read = byi_read_start, byi_write = byi_dest_start;\r\n    \r\n    \r\n        // Use this 'jump' method when dealing with advancing the position to the end of the r/w row.\r\n        //  Copying whole rows, need to advance the whole row position.\r\n        //const bytes_source_row_jump = bypr_source - bytes_per_bounds_row, bytes_dest_row_jump = bypr_dest - bytes_per_bounds_row;\r\n    \r\n        //console.log('bytes_source_row_jump', bytes_source_row_jump);\r\n        //console.log('bytes_dest_row_jump', bytes_dest_row_jump);\r\n    \r\n        //console.log('bytes_per_bounds_row', bytes_per_bounds_row);\r\n    \r\n        for (y = ta_source_bounds[1]; y < ta_source_bounds[3]; y++) {\r\n            //console.log('byi_read, byi_write', [byi_read, byi_write]);\r\n            copy_ta_byte_range(ta_source, ta_dest, byi_read, byi_write, bytes_per_bounds_row);\r\n    \r\n            byi_read += bypr_source;\r\n            byi_write += bypr_dest;\r\n    \r\n            // use the sopy row function?\r\n            //  worth giving it a try.\r\n    \r\n            // Can use the full row copy procedure.\r\n    \r\n            //copy_ta_byte_range\r\n        }\r\n    }\r\n        \r\n    const copy_px_to_ta_dest_byi = (ta_source, source_colorspace, source_xy, ta_dest, byi_dest) => {\r\n        const [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n\r\n        if (bipp === 24) {\r\n            let byi_read = source_xy[0] * bypp + source_xy[1] * bypr;\r\n            ta_dest[byi_dest] = ta_source[byi_read++];\r\n            ta_dest[byi_dest + 1] = ta_source[byi_read++];\r\n            ta_dest[byi_dest + 2] = ta_source[byi_read++];\r\n\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n\r\n        \r\n    const copy_px_24bipp = (ta_source, byi_read, ta_dest, byi_write) => {\r\n        ta_dest[byi_write] = ta_source[byi_read++];\r\n        ta_dest[byi_write + 1] = ta_source[byi_read++];\r\n        ta_dest[byi_write + 2] = ta_source[byi_read++];\r\n    }\r\n\r\n\r\n    return {\r\n    \r\n        unaligned_copy_rect_1to4bypp: unaligned_copy_rect_1to4bypp,\r\n        dest_aligned_copy_rect_1to4bypp: dest_aligned_copy_rect_1to4bypp,\r\n        copy_rect_to_same_size_24bipp: copy_rect_to_same_size_24bipp,\r\n        copy_rect_to_same_size_8bipp: copy_rect_to_same_size_8bipp,\r\n        copy_ta_byte_range: copy_ta_byte_range,\r\n        get_instance: get_instance,\r\n        copy_px_to_ta_dest_byi: copy_px_to_ta_dest_byi,\r\n        copy_px_24bipp: copy_px_24bipp\r\n    };\r\n}\r\n\r\n\r\n\r\n// copy_px_to_ta\r\n\r\nmodule.exports = get_instance();", "\r\n\r\n\r\n\r\nconst get_instance = () => {\r\n\r\n\r\n    // Maybe keeping colorspace as a simple array would work best.\r\n    //  Using consts to get the value from the colorspace... would that work well?\r\n    // const [...] = _colorspace_fields\r\n\r\n    const byi_from_cs_pos = (colorspace, pos) => {\r\n        const [width, height, bypp, bypr, bipp, bipr] = colorspace;\r\n        //console.log('bypp, bypr', [bypp, bypr]);\r\n\r\n        //console.log('pos', pos)\r\n        //console.trace();\r\n\r\n        return pos[0] * bypp + pos[1] * bypr;\r\n\r\n    }\r\n    // pb.color_space\r\n\r\n\r\n    // Could read it as a subarray.\r\n    //  Could then be writable too.\r\n\r\n    // Optionally set the res into an existing ta.\r\n    //  Benchmarks...\r\n\r\n\r\n\r\n\r\n\r\n    //  Could work out somewhat faster? Harder to program though???\r\n    //   May be simpler for C++ and making and using wrappers.\r\n    //   Could use consts to refer to positions in arrays?\r\n    //    Would be worth doing speed comparisons.\r\n\r\n\r\n\r\n\r\n\r\n    // (source, dest, ta_op_info)\r\n\r\n\r\n\r\n    // Or maybe it's worth providing existing tas? Supporting that at least.\r\n    //  The bounds etc are likely to be given as tas.\r\n\r\n\r\n\r\n    // This is really about:  *** Syncronised iteration of an xy position bounds within 2 typed arrays that share the same bits_per_pixel ***\r\n\r\n\r\n\r\n    // Wonder if the end jump value not in a ta slows it down? Compiler needs to guess / support multiple types.\r\n    //  Maybe calling it with numeric types is good?\r\n\r\n    // ta_op_further_info seems unnecessary...\r\n\r\n\r\n    // Try a version with a callback?\r\n\r\n\r\n    // Compacted param tas could be of use.\r\n\r\n    // all in one ta:?\r\n    //  xy, bounds, ta_byte_indexes, bytes_read_row_end_jump\r\n\r\n\r\n    // Maybe this will be fastest?\r\n\r\n    // Maybe make / make standard an Int32Array(16) or so\r\n    //  Could contain other info...\r\n\r\n\r\n    // Not using this kind of system for the moment. Going with variable names.\r\n    //  Will help porting too.\r\n\r\n\r\n    /*\r\n\r\n    const idx_ta_vars = {\r\n        0: ['xy', 0],\r\n        1: ['xy', 1],\r\n        2: ['bounds', 0],\r\n        3: ['bounds', 1],\r\n        4: ['bounds', 2],\r\n        5: ['bounds', 3],\r\n        6: 'byte_idx_read',\r\n        7: 'byte_idx_write',\r\n        8: 'bytes_read_row_end_jump'\r\n\r\n        // Other...?\r\n        / *\r\n        9?  bytes_per_pixel\r\n        10? bytes_per_read_row\r\n        11? bytes_per_write_row\r\n\r\n        * /\r\n\r\n\r\n    }\r\n    */\r\n\r\n\r\n    // Overlapping 2d bounds calculations would be useful too.\r\n    // May want a quick (functional) way to describe the interface over the typed array.\r\n\r\n    \r\n\r\n\r\n\r\n    // calculate intersecting bounds on 2 given bounds (given as tas)\r\n\r\n    const overlapping_bounds = (bounds_1, bounds_2, res_bounds = new Int16Array(4)) => {\r\n        // the area of intersection between both bounds.\r\n\r\n        //console.log('overlapping_bounds', overlapping_bounds);\r\n        //console.log('bounds_1', bounds_1);\r\n        //console.log('bounds_2', bounds_2);\r\n\r\n        //console.trace();\r\n\r\n\r\n        // Ensure the result is within the bounds of another...\r\n        //  Need to find the range at which they overlap, if any.\r\n\r\n        // A bit more than just ajusting one so it fits within the other?\r\n        //  Maybe not? Could be based on that. Then check that it's not negative?\r\n\r\n        // If bounds 1 were to fit within bounds 2, what would those new bounds be?\r\n\r\n        // the max value of the lower bounds (x and y)\r\n        // the min value of the higher bounds (x and y)\r\n\r\n        //  see if it's positive\r\n        //   otherwise return undefined? false?\r\n        //   false could work well.\r\n\r\n\r\n\r\n        // math.max and min? which would be faster?\r\n\r\n        res_bounds[0] = bounds_1[0] < bounds_2[0] ? bounds_2[0] : bounds_1[0];\r\n        res_bounds[1] = bounds_1[1] < bounds_2[1] ? bounds_2[1] : bounds_1[1];\r\n        res_bounds[2] = bounds_1[2] > bounds_2[2] ? bounds_2[2] : bounds_1[2];\r\n        res_bounds[3] = bounds_1[3] > bounds_2[3] ? bounds_2[3] : bounds_1[3];\r\n\r\n        //throw 'stop';\r\n\r\n\r\n\r\n\r\n        return res_bounds;\r\n    }\r\n\r\n    return {\r\n        overlapping_bounds: overlapping_bounds,\r\n        byi_from_cs_pos: byi_from_cs_pos,\r\n        get_instance: get_instance\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nmodule.exports = get_instance();", "\r\n\r\n\r\nconst get_instance = () => {\r\n\r\n\r\n        \r\n    const read_px = (ta_source, ta_colorspace, ta_pos) => {\r\n\r\n        // calculate byte index from pos and colorspace\r\n\r\n        const bipp = ta_colorspace[4];\r\n\r\n        //console.log('read_px bipp', bipp);\r\n\r\n        if (bipp === 1) {\r\n            // 1bipp\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            const byi = byi_from_cs_pos(ta_colorspace, ta_pos);\r\n            return ta_source[byi];\r\n        } else if (bipp === 24) {\r\n            const byi = byi_from_cs_pos(ta_colorspace, ta_pos);\r\n\r\n            //console.log('byi', byi);\r\n\r\n            //console.log('ta_source.subarray(byi, byi + 3)', ta_source.subarray(byi, byi + 3));\r\n\r\n            return ta_source.subarray(byi, byi + 3);\r\n        } else if (bipp === 32) {\r\n            const byi = byi_from_cs_pos(ta_colorspace, ta_pos);\r\n            return ta_source.subarray(byi, byi + 4);\r\n        }\r\n\r\n        \r\n\r\n    }\r\n\r\n    //const read_4_px_rect = (ta_source, source_width, bytes_per_pixel, bytes_per_row, pos) => {\r\n\r\n\r\n    const read_2x1_rect = (ta_source, ta_colorspace, ta_pos) => {\r\n        // will just return the values of these 2 px in a single ta.\r\n\r\n\r\n        const [x, y] = ta_pos;\r\n        const [width, height, bypp, bypr, bipp, bipr] = ta_colorspace;\r\n\r\n        if (x < 0) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (x > width - 1) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (y < 0) {\r\n            throw 'y position must be between 0 and height'\r\n        }\r\n        if (y > height) {\r\n            throw 'y position must be between 0 and height'\r\n        }\r\n\r\n        let byi_read = (x * bypp) + (y * bypr);\r\n\r\n        if (bipp === 1) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            // different result sizes... maybe return a specific version of this.\r\n            // unsafe_read_4px_rect(different params?)\r\n            \r\n            // lets do the work here... not so much to do.\r\n            const res = new Uint8ClampedArray(2);\r\n            res[0] = ta_source[byi_read];\r\n            res[1] = ta_source[byi_read + 1];\r\n            //res[2] = ta_source[byi_read + bypr];\r\n            //res[3] = ta_source[byi_read + bypr + 1];\r\n\r\n            //res[0] = \r\n\r\n\r\n            return res;\r\n\r\n        } else if (bipp === 24) {\r\n            const res = new Uint8ClampedArray(6);\r\n            //res[0] = \r\n\r\n            // best to read 2 rows of pixels. 6 bytes per row of the copy space.\r\n            res.set(ta_source.subarray(byi_read, byi_read + 6), 0);\r\n            //byi_read += bypr;\r\n            //res.set(ta_source.subarray(byi_read, byi_read + 6), 6);\r\n\r\n\r\n\r\n            return res;\r\n            \r\n        } else if (bipp === 32) {\r\n            //console.trace();\r\n            //throw 'NYI';\r\n            const res = new Uint8ClampedArray(8);\r\n            //res[0] = \r\n\r\n            res.set(ta_source.subarray(byi_read, byi_read + 8), 0);\r\n            //byi_read += bypr;\r\n            //res.set(ta_source.subarray(byi_read, byi_read + 8), 8);\r\n\r\n\r\n            return res;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    const read_1x2_rect = (ta_source, ta_colorspace, ta_pos) => {\r\n        // will just return the values of these 2 px in a single ta.\r\n\r\n\r\n        const [x, y] = ta_pos;\r\n        const [width, height, bypp, bypr, bipp, bipr] = ta_colorspace;\r\n\r\n        if (x < 0) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (x > width - 1) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (y < 0) {\r\n            throw 'y position must be between 0 and height'\r\n        }\r\n        if (y > height) {\r\n            throw 'y position must be between 0 and height'\r\n        }\r\n\r\n        let byi_read = (x * bypp) + (y * bypr);\r\n\r\n        if (bipp === 1) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            // different result sizes... maybe return a specific version of this.\r\n            // unsafe_read_4px_rect(different params?)\r\n            \r\n            // lets do the work here... not so much to do.\r\n            const res = new Uint8ClampedArray(2);\r\n            res[0] = ta_source[byi_read];\r\n            res[1] = ta_source[byi_read + bypr];\r\n            //res[2] = ta_source[byi_read + bypr];\r\n            //res[3] = ta_source[byi_read + bypr + 1];\r\n\r\n            //res[0] = \r\n\r\n\r\n            return res;\r\n\r\n        } else if (bipp === 24) {\r\n            const res = new Uint8ClampedArray(6);\r\n            //res[0] = \r\n\r\n            // best to read 2 rows of pixels. 6 bytes per row of the copy space.\r\n            res.set(ta_source.subarray(byi_read, byi_read + 3), 0);\r\n            byi_read += bypr;\r\n\r\n            res.set(ta_source.subarray(byi_read, byi_read + 3), 3);\r\n            //byi_read += bypr;\r\n            //res.set(ta_source.subarray(byi_read, byi_read + 6), 6);\r\n\r\n\r\n\r\n            return res;\r\n            \r\n        } else if (bipp === 32) {\r\n            //console.trace();\r\n            //throw 'NYI';\r\n            const res = new Uint8ClampedArray(8);\r\n            //res[0] = \r\n\r\n            res.set(ta_source.subarray(byi_read, byi_read + 4), 0);\r\n            byi_read += bypr;\r\n            res.set(ta_source.subarray(byi_read, byi_read + 4), 4);\r\n            //res.set(ta_source.subarray(byi_read, byi_read + 8), 8);\r\n\r\n\r\n            return res;\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    // Hopefully will be v fast!\r\n    //  Consider C++ optimization too - but likely will be implemented and called in C++ because its very low level for some operations.\r\n    const read_2x2_rect = (ta_source, ta_colorspace, ta_pos) => {\r\n\r\n        const [x, y] = ta_pos;\r\n\r\n        const [width, height, bypp, bypr, bipp, bipr] = ta_colorspace;\r\n\r\n        //console.log('read_4_px_rect [width, height, bypp, bypr, bipp, bipr]', [width, height, bypp, bypr, bipp, bipr]);\r\n\r\n        // Worth using pixel index / necessary to do so.\r\n        //  Seems to come down to that at the lowest levels.\r\n\r\n\r\n\r\n\r\n\r\n        // can not read an out of bounds 4px block\r\n        //  should raise an error if it's attempted. it should not be attempted.\r\n\r\n        // check it's within bounds...\r\n        //  maybe better not to. see about speed increase when this is commented out.\r\n\r\n        if (x < 0) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (x > width - 1) {\r\n            throw 'x position must be between 0 and (width - 1)'\r\n        }\r\n        if (y < 0) {\r\n            throw 'y position must be between 0 and (height - 1)'\r\n        }\r\n        if (y > height - 1) {\r\n            throw 'y position must be between 0 and (height - 1)'\r\n        }\r\n\r\n        let byi_read = (x * bypp) + (y * bypr);\r\n\r\n        if (bipp === 1) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            // different result sizes... maybe return a specific version of this.\r\n            // unsafe_read_4px_rect(different params?)\r\n            \r\n            // lets do the work here... not so much to do.\r\n            const res = new Uint8ClampedArray(4);\r\n            res[0] = ta_source[byi_read];\r\n            res[1] = ta_source[byi_read + 1];\r\n            res[2] = ta_source[byi_read + bypr];\r\n            res[3] = ta_source[byi_read + bypr + 1];\r\n\r\n            //res[0] = \r\n\r\n\r\n            return res;\r\n\r\n        } else if (bipp === 24) {\r\n            const res = new Uint8ClampedArray(12);\r\n            //res[0] = \r\n\r\n            // best to read 2 rows of pixels. 6 bytes per row of the copy space.\r\n            res.set(ta_source.subarray(byi_read, byi_read + 6), 0);\r\n            byi_read += bypr;\r\n            res.set(ta_source.subarray(byi_read, byi_read + 6), 6);\r\n\r\n\r\n\r\n            return res;\r\n            \r\n        } else if (bipp === 32) {\r\n            //console.trace();\r\n            //throw 'NYI';\r\n            const res = new Uint8ClampedArray(16);\r\n            //res[0] = \r\n\r\n            res.set(ta_source.subarray(byi_read, byi_read + 8), 0);\r\n            byi_read += bypr;\r\n            res.set(ta_source.subarray(byi_read, byi_read + 8), 8);\r\n\r\n\r\n            return res;\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    const read_merged_vfpx_24bipp = (ta_source, colorspace, vfpx) => {\r\n\r\n        // Other version of algo that bypasses the vfpx?\r\n\r\n\r\n        const [width, height, bypp, bypr, bipp, bipr] = colorspace;\r\n        const {weights, i_any_coverage_bounds} = vfpx;\r\n        // \r\n        const xy = new Int16Array(2);\r\n        let byi_read = 3 * i_any_coverage_bounds[0] + bypr * i_any_coverage_bounds[1];\r\n        let byi_weight = 0;\r\n        // \r\n\r\n        const iw = i_any_coverage_bounds[2] - i_any_coverage_bounds[0];\r\n\r\n        const bytes_read_row_end_jump = bypr - iw * 3;\r\n        const acc_rgb = new Float32Array(3);\r\n        // Probably a problem at this merging stage.\r\n\r\n        //console.log('colorspace: [width, height, bypp, bypr, bipp, bipr]', [width, height, bypp, bypr, bipp, bipr]);\r\n        //console.log('vfpx.i_size', vfpx.i_size);\r\n        //console.log('vfpx.i_any_coverage_bounds', vfpx.i_any_coverage_bounds);\r\n\r\n        //console.log('weights', weights);\r\n\r\n        // Direct accumulation without createing any weights object...\r\n\r\n\r\n        for (xy[1] = i_any_coverage_bounds[1]; xy[1] < i_any_coverage_bounds[3]; xy[1]++) {\r\n            for (xy[0] = i_any_coverage_bounds[0]; xy[0] < i_any_coverage_bounds[2]; xy[0]++) {\r\n\r\n                //const ui8_px_value = ta[byte_idx_pb_read];\r\n                //ui8_px_value = ta[byte_idx_pb_read];\r\n\r\n                //console.log('byte_idx_pb_read')\r\n\r\n                acc_rgb[0] += ta_source[byi_read++] * weights[byi_weight];\r\n                acc_rgb[1] += ta_source[byi_read++] * weights[byi_weight];\r\n                acc_rgb[2] += ta_source[byi_read++] * weights[byi_weight++];\r\n                //ta_res[ta_byte_indexes[1]++] = ta[byi_read[0]++];\r\n                //ta_res[ta_byte_indexes[1]++] = ta[byi_read[0]++];\r\n\r\n                // But don't need to copy the px value in many cases.\r\n\r\n                //  Maybe have / use lower level fuctions for copying between different pbs / tas.\r\n                //  Iterating spaces.\r\n                //   Iterating spaces defined by a function / equation?\r\n                //    Eg could functionally / mathematically define a circle and draw it.\r\n                \r\n                // got the xy iteration pos set correctly here :)\r\n\r\n                // could copy px values?\r\n                //  reading and using them directly may work best....\r\n\r\n                //byte_idx_pb_read += bytes_per_pixel;\r\n\r\n            }\r\n            // then row jump increase.\r\n            byi_read += bytes_read_row_end_jump;\r\n        }\r\n        // then copy the weighted values into the result...\r\n        /*\r\n        console.log('acc_rgb', acc_rgb);\r\n        if (acc_rgb[0] === 0) {\r\n            console.trace();\r\n            throw 'stop';\r\n        }\r\n        */\r\n\r\n        const res = new Uint8ClampedArray(acc_rgb);\r\n        //console.log('read_merged_vfpx_24bipp res', res);\r\n        return res;\r\n\r\n\r\n    }\r\n\r\n\r\n    const read_merged_vfpx = (ta_source, colorspace, vfpx) => {\r\n        // get the weights for that vfpx ... very useful to have them!\r\n        //  need to know the any coverage row width\r\n        //console.log('colorspace', colorspace);\r\n        //const [width, height, bypp, bypr, bipp, bipr] = colorspace;\r\n        const bipp = colorspace[4];\r\n\r\n        if (bipp === 1) {\r\n            console.trace(); throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            console.trace(); throw 'NYI';\r\n        } else if (bipp === 24) {\r\n            return read_merged_vfpx_24bipp(ta_source, colorspace, vfpx)\r\n        } else if (bipp === 32) {\r\n            console.trace(); throw 'NYI';\r\n        }\r\n\r\n        //const {weights, i_total_coverage_bounds} = vfpx;\r\n\r\n\r\n        // Worth having separate methods... different sized accumulator for different bipp.\r\n\r\n        // RGB accumulator...?\r\n\r\n        // depending on the number of bipp in the colorspace too.\r\n\r\n        \r\n\r\n\r\n\r\n    }\r\n\r\n    const each_pixel_in_colorspace = (colorspace, callback) => {\r\n        const [width, height, bypp, bypr, bipp, bipr] = colorspace;\r\n        let byi = 0;\r\n        const xy = new Int16Array(2);\r\n        for (xy[1] = 0; xy[1] < height; xy[1]++) {\r\n            for (xy[0] = 0; xy[0] < width; xy[0]++) {\r\n                callback(xy, byi);\r\n                byi += bypp;\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        read_2x2_rect: read_2x2_rect,\r\n        read_1x2_rect: read_1x2_rect,\r\n        read_2x1_rect: read_2x1_rect,\r\n        read_merged_vfpx_24bipp: read_merged_vfpx_24bipp,\r\n        read_merged_vfpx: read_merged_vfpx,\r\n        get_instance: get_instance,\r\n        each_pixel_in_colorspace: each_pixel_in_colorspace\r\n    }\r\n    \r\n\r\n\r\n}\r\n\r\n\r\nmodule.exports = get_instance();", "const copy_px_to_ta_dest_byi = (ta_source, source_colorspace, source_xy, ta_dest, byi_dest) => {\r\n    const [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n    if (bipp === 24) {\r\n        let byi_read = source_xy[0] * bypp + source_xy[1] * bypr;\r\n        ta_dest[byi_dest] = ta_source[byi_read++];\r\n        ta_dest[byi_dest + 1] = ta_source[byi_read++];\r\n        ta_dest[byi_dest + 2] = ta_source[byi_read++];\r\n    } else {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n}\r\nconst each_pixel_in_colorspace = (colorspace, callback) => {\r\n    const [width, height, bypp, bypr, bipp, bipr] = colorspace;\r\n    let byi = 0;\r\n    const xy = new Int16Array(2);\r\n    for (xy[1] = 0; xy[1] < height; xy[1]++) {\r\n        for (xy[0] = 0; xy[0] < width; xy[0]++) {\r\n            callback(xy, byi);\r\n            byi += bypp;\r\n        }\r\n    }\r\n}\r\nconst __each_source_dest_pixels_resized = (source_colorspace, dest_size, callback) => {\r\n    const [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], bypp, bypp * dest_size[0], bipp, bipp * dest_size[0]]);\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const source_fbounds = new Float32Array(4);\r\n    const source_ibounds = new Int16Array(4);\r\n    const source_i_any_coverage_size = new Int16Array(2);\r\n    const source_total_coverage_ibounds = new Int16Array(4);\r\n    let byi_read;\r\n    each_pixel_in_colorspace(dest_colorspace, (dest_xy, dest_byi) => {\r\n        source_fbounds[0] = dest_xy[0] * dest_to_source_ratio[0];\r\n        source_fbounds[1] = dest_xy[1] * dest_to_source_ratio[1];\r\n        source_fbounds[2] = source_fbounds[0] + dest_to_source_ratio[0];\r\n        source_fbounds[3] = source_fbounds[1] + dest_to_source_ratio[1];\r\n        source_ibounds[0] = source_fbounds[0];\r\n        source_ibounds[1] = source_fbounds[1];\r\n        source_ibounds[2] = Math.ceil(source_fbounds[2]);\r\n        source_ibounds[3] = Math.ceil(source_fbounds[3]);\r\n        source_i_any_coverage_size[0] = source_ibounds[2] - source_ibounds[0];\r\n        source_i_any_coverage_size[1] = source_ibounds[3] - source_ibounds[1];\r\n        byi_read = source_ibounds[0] * bypp + source_ibounds[1] * bypr;\r\n        source_total_coverage_ibounds[0] = Math.ceil(source_fbounds[0]);\r\n        source_total_coverage_ibounds[1] = Math.ceil(source_fbounds[1]);\r\n        source_total_coverage_ibounds[2] = source_fbounds[2];\r\n        source_total_coverage_ibounds[3] = source_fbounds[3];\r\n        callback(dest_xy, dest_byi, source_fbounds, source_ibounds, source_i_any_coverage_size, source_total_coverage_ibounds, byi_read);\r\n    });\r\n}\r\nconst each_source_dest_pixels_resized_inline = (source_colorspace, dest_size, callback) => {\r\n    let [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n    const source_bypr = bypr;\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], bypp, bypp * dest_size[0], bipp, bipp * dest_size[0]]);\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const source_fbounds = new Float32Array(4);\r\n    const source_ibounds = new Int16Array(4);\r\n    const source_i_any_coverage_size = new Int16Array(2);\r\n    const source_total_coverage_ibounds = new Int16Array(4);\r\n    let byi_read = 0;\r\n    let dest_byi = 0;\r\n    const dest_xy = new Int16Array(2);\r\n    [width, height, bypp, bypr, bipp, bipr] = dest_colorspace;\r\n    const _x_source_fbounds0 = new Float32Array(width);\r\n    const _x_source_fbounds2 = new Float32Array(width);\r\n    const _x_source_ibounds0 = new Int16Array(width);\r\n    const _x_source_ibounds2 = new Int16Array(width);\r\n    const _x_source_i_any_coverage_size = new Int16Array(width);\r\n    const _x_source_i_total_coverage_l = new Int16Array(width);\r\n    const _x_source_i_total_coverage_r = new Int16Array(width);\r\n    const _x_byi_read = new Int32Array(width);\r\n    for (dest_xy[0] = 0; dest_xy[0] < width; dest_xy[0]++) {\r\n        _x_source_fbounds0[dest_xy[0]] = dest_xy[0] * dest_to_source_ratio[0];\r\n        _x_source_fbounds2[dest_xy[0]] = _x_source_fbounds0[dest_xy[0]] + dest_to_source_ratio[0];\r\n        _x_source_ibounds0[dest_xy[0]] = _x_source_fbounds0[dest_xy[0]];\r\n        _x_source_ibounds2[dest_xy[0]] = Math.ceil(_x_source_fbounds2[dest_xy[0]]);\r\n        _x_source_i_any_coverage_size[dest_xy[0]] = _x_source_ibounds2[dest_xy[0]] - _x_source_ibounds0[dest_xy[0]];\r\n        _x_byi_read[dest_xy[0]] = _x_source_ibounds0[dest_xy[0]] * bypp;\r\n        _x_source_i_total_coverage_l[dest_xy[0]] = Math.ceil(_x_source_fbounds0[dest_xy[0]]);\r\n        _x_source_i_total_coverage_r[dest_xy[0]] = Math.floor(_x_source_fbounds2[dest_xy[0]]);\r\n    }\r\n    let row_byi;\r\n    for (dest_xy[1] = 0; dest_xy[1] < height; dest_xy[1]++) {\r\n        source_fbounds[1] = dest_xy[1] * dest_to_source_ratio[1];\r\n        source_ibounds[1] = source_fbounds[1];\r\n        source_fbounds[3] = source_fbounds[1] + dest_to_source_ratio[1];\r\n        source_ibounds[3] = Math.ceil(source_fbounds[3]);\r\n        source_i_any_coverage_size[1] = source_ibounds[3] - source_ibounds[1];\r\n        source_total_coverage_ibounds[1] = Math.ceil(source_fbounds[1]);\r\n        source_total_coverage_ibounds[3] = source_fbounds[3];\r\n        row_byi = source_ibounds[1] * source_bypr;\r\n        for (dest_xy[0] = 0; dest_xy[0] < width; dest_xy[0]++) {\r\n            source_fbounds[0] = _x_source_fbounds0[dest_xy[0]];\r\n            source_fbounds[2] = _x_source_fbounds2[dest_xy[0]];\r\n            source_ibounds[0] = _x_source_ibounds0[dest_xy[0]];\r\n            source_ibounds[2] = _x_source_ibounds2[dest_xy[0]];\r\n            source_i_any_coverage_size[0] = _x_source_i_any_coverage_size[dest_xy[0]];\r\n            byi_read = _x_byi_read[dest_xy[0]] + row_byi;\r\n            source_total_coverage_ibounds[0] = _x_source_i_total_coverage_l[dest_xy[0]];\r\n            source_total_coverage_ibounds[2] = _x_source_i_total_coverage_r[dest_xy[0]];\r\n            callback(dest_xy, dest_byi, source_fbounds, source_ibounds, source_i_any_coverage_size, source_total_coverage_ibounds, byi_read);\r\n            dest_byi += bypp;\r\n        }\r\n    }\r\n}\r\nconst each_source_dest_pixels_resized = each_source_dest_pixels_resized_inline;\r\nconst __each_source_dest_pixels_resized_limited_further_info = (source_colorspace, dest_size, callback) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const source_edge_distances = new Float32Array(4);\r\n    const edge_distances_proportions_of_total = new Float32Array(4);\r\n    const edge_segment_areas_proportion_of_total_area = new Float32Array(4);\r\n    const corner_areas_proportions_of_total = new Float32Array(4);\r\n    const fpx_area = dest_to_source_ratio[0] * dest_to_source_ratio[1];\r\n    each_source_dest_pixels_resized(source_colorspace, dest_size, (dest_xy, dest_byi, source_fbounds, source_ibounds, source_i_any_coverage_size, source_total_coverage_ibounds, byi_read) => {\r\n        if (source_i_any_coverage_size[0] === 1 && source_i_any_coverage_size[1] === 1) {\r\n            callback(dest_byi, source_i_any_coverage_size, undefined, undefined, byi_read);\r\n        } else if (source_i_any_coverage_size[0] === 1 && source_i_any_coverage_size[1] === 2) {\r\n            source_edge_distances[1] = source_total_coverage_ibounds[1] - source_fbounds[1];\r\n            source_edge_distances[3] = source_fbounds[3] - source_total_coverage_ibounds[3];\r\n            if (source_edge_distances[1] === 0) source_edge_distances[1] = 1;\r\n            if (source_edge_distances[3] === 0) source_edge_distances[3] = 1;\r\n            edge_distances_proportions_of_total[1] = source_edge_distances[1] / dest_to_source_ratio[1];\r\n            edge_distances_proportions_of_total[3] = source_edge_distances[3] / dest_to_source_ratio[1];\r\n            callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, undefined, byi_read);\r\n        } else if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 1) {\r\n            source_edge_distances[0] = source_total_coverage_ibounds[0] - source_fbounds[0];\r\n            source_edge_distances[2] = source_fbounds[2] - source_total_coverage_ibounds[2];\r\n            if (source_edge_distances[0] === 0) source_edge_distances[0] = 1;\r\n            if (source_edge_distances[2] === 0) source_edge_distances[2] = 1;\r\n            edge_distances_proportions_of_total[0] = source_edge_distances[0] / dest_to_source_ratio[0];\r\n            edge_distances_proportions_of_total[2] = source_edge_distances[2] / dest_to_source_ratio[0];\r\n            callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, undefined, byi_read);\r\n        } else if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 2) {\r\n            source_edge_distances[0] = source_total_coverage_ibounds[0] - source_fbounds[0];\r\n            source_edge_distances[1] = source_total_coverage_ibounds[1] - source_fbounds[1];\r\n            source_edge_distances[2] = source_fbounds[2] - source_total_coverage_ibounds[2];\r\n            source_edge_distances[3] = source_fbounds[3] - source_total_coverage_ibounds[3];\r\n            if (source_edge_distances[0] === 0) source_edge_distances[0] = 1;\r\n            if (source_edge_distances[1] === 0) source_edge_distances[1] = 1;\r\n            if (source_edge_distances[2] === 0) source_edge_distances[2] = 1;\r\n            if (source_edge_distances[3] === 0) source_edge_distances[3] = 1;\r\n            corner_areas_proportions_of_total[0] = source_edge_distances[0] * source_edge_distances[1] / fpx_area;\r\n            corner_areas_proportions_of_total[1] = source_edge_distances[2] * source_edge_distances[1] / fpx_area;\r\n            corner_areas_proportions_of_total[2] = source_edge_distances[0] * source_edge_distances[3] / fpx_area;\r\n            corner_areas_proportions_of_total[3] = source_edge_distances[2] * source_edge_distances[3] / fpx_area;\r\n            callback(dest_byi, source_i_any_coverage_size, undefined, corner_areas_proportions_of_total, byi_read);\r\n        } else {\r\n            source_edge_distances[0] = source_total_coverage_ibounds[0] - source_fbounds[0];\r\n            source_edge_distances[1] = source_total_coverage_ibounds[1] - source_fbounds[1];\r\n            source_edge_distances[2] = source_fbounds[2] - source_total_coverage_ibounds[2];\r\n            source_edge_distances[3] = source_fbounds[3] - source_total_coverage_ibounds[3];\r\n            if (source_edge_distances[0] === 0) source_edge_distances[0] = 1;\r\n            if (source_edge_distances[1] === 0) source_edge_distances[1] = 1;\r\n            if (source_edge_distances[2] === 0) source_edge_distances[2] = 1;\r\n            if (source_edge_distances[3] === 0) source_edge_distances[3] = 1;\r\n            edge_distances_proportions_of_total[0] = source_edge_distances[0] / fpx_area;\r\n            edge_distances_proportions_of_total[1] = source_edge_distances[1] / fpx_area;\r\n            edge_distances_proportions_of_total[2] = source_edge_distances[2] / fpx_area;\r\n            edge_distances_proportions_of_total[3] = source_edge_distances[3] / fpx_area;\r\n            edge_segment_areas_proportion_of_total_area[0] = source_edge_distances[0] * source_edge_distances[1] / fpx_area;\r\n            edge_segment_areas_proportion_of_total_area[1] = source_edge_distances[2] * source_edge_distances[1] / fpx_area;\r\n            edge_segment_areas_proportion_of_total_area[2] = source_edge_distances[0] * source_edge_distances[3] / fpx_area;\r\n            edge_segment_areas_proportion_of_total_area[3] = source_edge_distances[2] * source_edge_distances[3] / fpx_area;\r\n            callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, edge_segment_areas_proportion_of_total_area, byi_read);\r\n        }\r\n    });\r\n}\r\nconst each_source_dest_pixels_resized_limited_further_info$inline = (source_colorspace, dest_size, callback) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const source_edge_distances = new Float32Array(4);\r\n    const edge_distances_proportions_of_total = new Float32Array(4);\r\n    const corner_areas_proportions_of_total = new Float32Array(4);\r\n    const fpx_area = dest_to_source_ratio[0] * dest_to_source_ratio[1];\r\n    let [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n    const source_bypr = bypr;\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], bypp, bypp * dest_size[0], bipp, bipp * dest_size[0]]);\r\n    const source_fbounds = new Float32Array(4);\r\n    const source_ibounds = new Int16Array(4);\r\n    const source_i_any_coverage_size = new Int16Array(2);\r\n    const source_total_coverage_ibounds = new Int16Array(4);\r\n    let byi_read;\r\n    let dest_byi = 0;\r\n    [width, height, bypp, bypr, bipp, bipr] = dest_colorspace;\r\n    let x, y;\r\n    for (y = 0; y < height; y++) {\r\n        source_fbounds[1] = y * dest_to_source_ratio[1];\r\n        source_fbounds[3] = source_fbounds[1] + dest_to_source_ratio[1];\r\n        source_ibounds[1] = source_fbounds[1];\r\n        source_ibounds[3] = Math.ceil(source_fbounds[3]);\r\n        source_i_any_coverage_size[1] = source_ibounds[3] - source_ibounds[1];\r\n        source_total_coverage_ibounds[1] = Math.ceil(source_fbounds[1]);\r\n        source_total_coverage_ibounds[3] = source_fbounds[3];\r\n        source_edge_distances[1] = source_total_coverage_ibounds[1] - source_fbounds[1];\r\n        source_edge_distances[3] = source_fbounds[3] - source_total_coverage_ibounds[3];\r\n        if (source_edge_distances[1] === 0) source_edge_distances[1] = 1;\r\n        if (source_edge_distances[3] === 0) source_edge_distances[3] = 1;\r\n        edge_distances_proportions_of_total[1] = source_edge_distances[1] / fpx_area;\r\n        edge_distances_proportions_of_total[3] = source_edge_distances[3] / fpx_area;\r\n        for (x = 0; x < width; x++) {\r\n            source_fbounds[0] = x * dest_to_source_ratio[0];\r\n            source_fbounds[2] = source_fbounds[0] + dest_to_source_ratio[0];\r\n            source_ibounds[0] = source_fbounds[0];\r\n            source_ibounds[2] = Math.ceil(source_fbounds[2]);\r\n            source_i_any_coverage_size[0] = source_ibounds[2] - source_ibounds[0];\r\n            byi_read = source_ibounds[0] * bypp + source_ibounds[1] * source_bypr;\r\n            if (source_i_any_coverage_size[0] === 1 && source_i_any_coverage_size[1] === 1) {\r\n                callback(dest_byi, source_i_any_coverage_size, undefined, undefined, byi_read);\r\n            } else {\r\n                source_total_coverage_ibounds[0] = Math.ceil(source_fbounds[0]);\r\n                source_total_coverage_ibounds[2] = source_fbounds[2];\r\n                if (source_i_any_coverage_size[0] === 1 && source_i_any_coverage_size[1] === 2) {\r\n                    callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, undefined, byi_read);\r\n                } else {\r\n                    source_edge_distances[0] = source_total_coverage_ibounds[0] - source_fbounds[0];\r\n                    source_edge_distances[2] = source_fbounds[2] - source_total_coverage_ibounds[2];\r\n                    if (source_edge_distances[0] === 0) source_edge_distances[0] = 1;\r\n                    if (source_edge_distances[2] === 0) source_edge_distances[2] = 1;\r\n                    if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 1) {\r\n                        edge_distances_proportions_of_total[0] = source_edge_distances[0] / dest_to_source_ratio[0];\r\n                        edge_distances_proportions_of_total[2] = source_edge_distances[2] / dest_to_source_ratio[0];\r\n                        callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, undefined, byi_read);\r\n                    } else if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 2) {\r\n                        corner_areas_proportions_of_total[0] = source_edge_distances[0] * source_edge_distances[1] / fpx_area;\r\n                        corner_areas_proportions_of_total[1] = source_edge_distances[2] * source_edge_distances[1] / fpx_area;\r\n                        corner_areas_proportions_of_total[2] = source_edge_distances[0] * source_edge_distances[3] / fpx_area;\r\n                        corner_areas_proportions_of_total[3] = source_edge_distances[2] * source_edge_distances[3] / fpx_area;\r\n                        callback(dest_byi, source_i_any_coverage_size, undefined, corner_areas_proportions_of_total, byi_read);\r\n                    } else {\r\n                        edge_distances_proportions_of_total[0] = source_edge_distances[0] / fpx_area;\r\n                        edge_distances_proportions_of_total[2] = source_edge_distances[2] / fpx_area;\r\n                        corner_areas_proportions_of_total[0] = source_edge_distances[0] * source_edge_distances[1] / fpx_area;\r\n                        corner_areas_proportions_of_total[1] = source_edge_distances[2] * source_edge_distances[1] / fpx_area;\r\n                        corner_areas_proportions_of_total[2] = source_edge_distances[0] * source_edge_distances[3] / fpx_area;\r\n                        corner_areas_proportions_of_total[3] = source_edge_distances[2] * source_edge_distances[3] / fpx_area;\r\n                        callback(dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, byi_read);\r\n                    }\r\n                }\r\n            }\r\n            dest_byi += bypp;\r\n        }\r\n    }\r\n}\r\nconst each_source_dest_pixels_resized_limited_further_info = each_source_dest_pixels_resized_limited_further_info$inline;\r\nconst copy_px_24bipp = (ta_source, byi_read, ta_dest, byi_write) => {\r\n    ta_dest[byi_write] = ta_source[byi_read++];\r\n    ta_dest[byi_write + 1] = ta_source[byi_read++];\r\n    ta_dest[byi_write + 2] = ta_source[byi_read++];\r\n}\r\nconst read_1x2_weight_write_24bipp = (ta_source, bypr, byi_read, ta_dest, byi_write, weight_t, weight_b) => {\r\n    let byi_read_below = byi_read + bypr;\r\n    ta_dest[byi_write] = weight_t * ta_source[byi_read++] + weight_b * ta_source[byi_read_below++];\r\n    ta_dest[byi_write + 1] = weight_t * ta_source[byi_read++] + weight_b * ta_source[byi_read_below++];\r\n    ta_dest[byi_write + 2] = weight_t * ta_source[byi_read++] + weight_b * ta_source[byi_read_below++];\r\n}\r\nconst read_1x2_weight_write_24bipp$ta4byis = (ta_source, ta4byis, ta_dest, byi_write, weight_t, weight_b) => {\r\n    ta_dest[byi_write] = weight_t * ta_source[ta4byis[0]++] + weight_b * ta_source[ta4byis[2]++];\r\n    ta_dest[byi_write + 1] = weight_t * ta_source[ta4byis[0]++] + weight_b * ta_source[ta4byis[2]++];\r\n    ta_dest[byi_write + 2] = weight_t * ta_source[ta4byis[0]++] + weight_b * ta_source[ta4byis[2]++];\r\n}\r\nconst read_2x1_weight_write_24bipp = (ta_source, byi_read, ta_dest, byi_write, weight_l, weight_r) => {\r\n    let byi_read_right = byi_read + 3;\r\n    ta_dest[byi_write] = weight_l * ta_source[byi_read++] + weight_r * ta_source[byi_read_right++];\r\n    ta_dest[byi_write + 1] = weight_l * ta_source[byi_read++] + weight_r * ta_source[byi_read_right++];\r\n    ta_dest[byi_write + 2] = weight_l * ta_source[byi_read++] + weight_r * ta_source[byi_read_right++];\r\n}\r\nconst read_2x1_weight_write_24bipp$ta4byis = (ta_source, ta4byis, ta_dest, byi_write, weight_l, weight_r) => {\r\n    ta_dest[byi_write] = weight_l * ta_source[ta4byis[0]++] + weight_r * ta_source[ta4byis[1]++];\r\n    ta_dest[byi_write + 1] = weight_l * ta_source[ta4byis[0]++] + weight_r * ta_source[ta4byis[1]++];\r\n    ta_dest[byi_write + 2] = weight_l * ta_source[ta4byis[0]++] + weight_r * ta_source[ta4byis[1]++];\r\n}\r\nconst read_2x2_weight_write_24bipp = (ta_source, bypr, byi_read, ta_dest, byi_write, corner_weights_ltrb) => {\r\n    let byi_read_right = byi_read + 3;\r\n    let byi_read_below = byi_read + bypr;\r\n    let byi_read_below_right = byi_read_below + 3;\r\n    ta_dest[byi_write] = corner_weights_ltrb[0] * ta_source[byi_read++] + corner_weights_ltrb[1] * ta_source[byi_read_right++] + corner_weights_ltrb[2] * ta_source[byi_read_below++] + corner_weights_ltrb[3] * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 1] = corner_weights_ltrb[0] * ta_source[byi_read++] + corner_weights_ltrb[1] * ta_source[byi_read_right++] + corner_weights_ltrb[2] * ta_source[byi_read_below++] + corner_weights_ltrb[3] * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 2] = corner_weights_ltrb[0] * ta_source[byi_read++] + corner_weights_ltrb[1] * ta_source[byi_read_right++] + corner_weights_ltrb[2] * ta_source[byi_read_below++] + corner_weights_ltrb[3] * ta_source[byi_read_below_right++];\r\n}\r\nconst read_2x2_weight_write_24bipp$locals = (ta_source, source_bypr, byi_read, \r\n    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,                    \r\n    ta_dest, byi_write) => {\r\n    let byi_read_right = byi_read + 3;\r\n    let byi_read_below = byi_read + source_bypr;\r\n    let byi_read_below_right = byi_read_below + 3;\r\n    ta_dest[byi_write] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 1] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 2] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n}\r\nconst read_2x2_weight_write_24bipp$ta4byis = (ta_source, ta4byis, ta_dest, byi_write, corner_weights_ltrb) => {\r\n    ta_dest[byi_write] = corner_weights_ltrb[0] * ta_source[ta4byis[0]++] + corner_weights_ltrb[1] * ta_source[ta4byis[1]++] + corner_weights_ltrb[2] * ta_source[ta4byis[2]++] + corner_weights_ltrb[3] * ta_source[ta4byis[3]++];\r\n    ta_dest[byi_write + 1] = corner_weights_ltrb[0] * ta_source[ta4byis[0]++] + corner_weights_ltrb[1] * ta_source[ta4byis[1]++] + corner_weights_ltrb[2] * ta_source[ta4byis[2]++] + corner_weights_ltrb[3] * ta_source[ta4byis[3]++];\r\n    ta_dest[byi_write + 2] = corner_weights_ltrb[0] * ta_source[ta4byis[0]++] + corner_weights_ltrb[1] * ta_source[ta4byis[1]++] + corner_weights_ltrb[2] * ta_source[ta4byis[2]++] + corner_weights_ltrb[3] * ta_source[ta4byis[3]++];\r\n}\r\nconst read_2x2_weight_write_24bipp$2_weight_ints = (ta_source, bypr, byi_read, ta_dest, byi_write, ta_lt_props) => {\r\n    const tl = l_prop * t_prop;\r\n    const tr = (1 - l_prop) * t_prop;\r\n    const bl = l_prop * (1 - t_prop);\r\n    const br = (1 - l_prop) * (1 - t_prop);\r\n    let byi_read_right = byi_read + 3;\r\n    let byi_read_below = byi_read + bypr;\r\n    let byi_read_below_right = byi_read_below + 3;\r\n    ta_dest[byi_write] = l_prop * t_prop * ta_source[byi_read++] + (1 - l_prop) * t_prop * ta_source[byi_read_right++] + l_prop * (1 - t_prop) * ta_source[byi_read_below++] + (1 - l_prop) * (1 - t_prop) * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 1] = l_prop * t_prop * ta_source[byi_read++] + (1 - l_prop) * t_prop * ta_source[byi_read_right++] + l_prop * (1 - t_prop) * ta_source[byi_read_below++] + (1 - l_prop) * (1 - t_prop) * ta_source[byi_read_below_right++];\r\n    ta_dest[byi_write + 2] = l_prop * t_prop * ta_source[byi_read++] + (1 - l_prop) * t_prop * ta_source[byi_read_right++] + l_prop * (1 - t_prop) * ta_source[byi_read_below++] + (1 - l_prop) * (1 - t_prop) * ta_source[byi_read_below_right++];\r\n}\r\nconst read_3x2_weight_write_24bipp = (ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_weights_ltrb, ta_dest, dest_byi) => {\r\n    const bypp = 3;\r\n    let byi_tl = byi_read;\r\n    let byi_tm = byi_tl + bypp, byi_tr = byi_tm + bypp;\r\n    let byi_bl = byi_tm + bypr, byi_bm = byi_bl + bypp, byi_br = byi_bm + bypp;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_distances_proportions_of_total[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_distances_proportions_of_total[3] + ta_source[byi_br++] * corner_weights_ltrb[3];\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_distances_proportions_of_total[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_distances_proportions_of_total[3] + ta_source[byi_br++] * corner_weights_ltrb[3];\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_distances_proportions_of_total[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_distances_proportions_of_total[3] + ta_source[byi_br++] * corner_weights_ltrb[3];\r\n}\r\nconst read_3x2_weight_write_24bipp$locals = (ta_source, bypr, byi_read, \r\n    edge_p_l, edge_p_t, edge_p_r, edge_p_b, \r\n    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n    ta_dest, dest_byi) => {\r\n    const bypp = 3;\r\n    let byi_tl = byi_read;\r\n    let byi_tm = byi_tl + bypp, byi_tr = byi_tm + bypp;\r\n    let byi_bl = byi_tm + bypr, byi_bm = byi_bl + bypp, byi_br = byi_bm + bypp;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n}\r\nconst read_2x3_weight_write_24bipp = (ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_weights_ltrb, ta_dest, dest_byi) => {\r\n    const bypp = 3;\r\n    let byi_tl = byi_read, byi_tr = byi_tl + bypp;\r\n    let byi_ml = byi_tl + bypr, byi_mr = byi_ml + bypp;\r\n    let byi_bl = byi_ml + bypr, byi_br = byi_bl + bypp;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_distances_proportions_of_total[0] + ta_source[byi_mr++] * edge_distances_proportions_of_total[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_distances_proportions_of_total[0] + ta_source[byi_mr++] * edge_distances_proportions_of_total[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_distances_proportions_of_total[0] + ta_source[byi_mr++] * edge_distances_proportions_of_total[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n}\r\nconst read_2x3_weight_write_24bipp$locals = (ta_source, bypr, byi_read, \r\n    edge_p_l, edge_p_t, edge_p_r, edge_p_b, \r\n    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n    ta_dest, dest_byi) => {\r\n    let byi_tl = byi_read, byi_tr = byi_tl + 3;\r\n    let byi_ml = byi_tl + bypr, byi_mr = byi_ml + 3;\r\n    let byi_bl = byi_ml + bypr, byi_br = byi_bl + 3;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n}\r\nconst read_3x3_weight_write_24bipp = (ta_source, bypr, byi_read, edge_weights, corner_weights_ltrb, fpx_area_recip, ta_dest, dest_byi) => {\r\n    const bypp = 3;\r\n    let byi_tl = byi_read, byi_tm = byi_tl + bypp, byi_tr = byi_tm + bypp;\r\n    let byi_ml = byi_tl + bypr, byi_mm = byi_ml + bypp, byi_mr = byi_mm + bypp;\r\n    let byi_bl = byi_ml + bypr, byi_bm = byi_bl + bypp, byi_br = byi_bm + bypp;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_weights[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_weights[0] + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_weights[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_weights[3] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_weights[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_weights[0] + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_weights[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_weights[3] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_weights_ltrb[0] + ta_source[byi_tm++] * edge_weights[1] + ta_source[byi_tr++] * corner_weights_ltrb[1] +\r\n                            ta_source[byi_ml++] * edge_weights[0] + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_weights[2] +\r\n                            ta_source[byi_bl++] * corner_weights_ltrb[2] + ta_source[byi_bm++] * edge_weights[3] + ta_source[byi_br++] * corner_weights_ltrb[3]\r\n}\r\nconst read_3x3_weight_write_24bipp$locals = (ta_source, bypr, byi_read, \r\n    edge_p_l, edge_p_t, edge_p_r, edge_p_b, \r\n    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n    fpx_area_recip, \r\n    ta_dest, dest_byi) => {\r\n    const bypp = 3;\r\n    let byi_tl = byi_read, byi_tm = byi_tl + bypp, byi_tr = byi_tm + bypp;\r\n    let byi_ml = byi_tl + bypr, byi_mm = byi_ml + bypp, byi_mr = byi_mm + bypp;\r\n    let byi_bl = byi_ml + bypr, byi_bm = byi_bl + bypp, byi_br = byi_bm + bypp;\r\n    ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n    ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n    ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                            ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n}\r\nconst read_gt3x3_weight_write_24bipp = (ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_weights_ltrb, fpx_area_recip, ta_dest, dest_byi) => {\r\n    const byi_tl = byi_read;\r\n    let r = 0, g = 0, b = 0;\r\n    let x, y;\r\n    const end_hmiddle = source_i_any_coverage_size[0] - 1, end_vmiddle = source_i_any_coverage_size[1] - 1;\r\n    r += ta_source[byi_read++] * corner_weights_ltrb[0];\r\n    g += ta_source[byi_read++] * corner_weights_ltrb[0];\r\n    b += ta_source[byi_read++] * corner_weights_ltrb[0];\r\n    for (x = 1; x < end_hmiddle; x++) {\r\n        r += ta_source[byi_read++] * edge_distances_proportions_of_total[1];\r\n        g += ta_source[byi_read++] * edge_distances_proportions_of_total[1];\r\n        b += ta_source[byi_read++] * edge_distances_proportions_of_total[1];\r\n    }\r\n    r += ta_source[byi_read++] * corner_weights_ltrb[1];\r\n    g += ta_source[byi_read++] * corner_weights_ltrb[1];\r\n    b += ta_source[byi_read++] * corner_weights_ltrb[1];\r\n    for (y = 1; y < end_vmiddle; y++) {\r\n        byi_read = byi_tl + y * bypr;\r\n        r += ta_source[byi_read++] * edge_distances_proportions_of_total[0];\r\n        g += ta_source[byi_read++] * edge_distances_proportions_of_total[0];\r\n        b += ta_source[byi_read++] * edge_distances_proportions_of_total[0];\r\n        for (x = 1; x < end_hmiddle; x++) {\r\n            r += ta_source[byi_read++] * fpx_area_recip;\r\n            g += ta_source[byi_read++] * fpx_area_recip;\r\n            b += ta_source[byi_read++] * fpx_area_recip;\r\n        }\r\n        r += ta_source[byi_read++] * edge_distances_proportions_of_total[2];\r\n        g += ta_source[byi_read++] * edge_distances_proportions_of_total[2];\r\n        b += ta_source[byi_read++] * edge_distances_proportions_of_total[2];\r\n    }\r\n    byi_read = byi_tl + end_vmiddle * bypr;\r\n    r += ta_source[byi_read++] * corner_weights_ltrb[2];\r\n    g += ta_source[byi_read++] * corner_weights_ltrb[2];\r\n    b += ta_source[byi_read++] * corner_weights_ltrb[2];\r\n    for (x = 1; x < end_hmiddle; x++) {\r\n        r += ta_source[byi_read++] * edge_distances_proportions_of_total[3];\r\n        g += ta_source[byi_read++] * edge_distances_proportions_of_total[3];\r\n        b += ta_source[byi_read++] * edge_distances_proportions_of_total[3];\r\n    }\r\n    r += ta_source[byi_read++] * corner_weights_ltrb[3];\r\n    g += ta_source[byi_read++] * corner_weights_ltrb[3];\r\n    b += ta_source[byi_read++] * corner_weights_ltrb[3];\r\n    ta_dest[dest_byi] = Math.round(r);\r\n    ta_dest[dest_byi + 1] = Math.round(g);\r\n    ta_dest[dest_byi + 2] = Math.round(b);\r\n}\r\nconst read_gt3x3_weight_write_24bipp$locals = (ta_source, bypr, byi_read, \r\n    any_coverage_w, any_coverage_h,\r\n    edge_p_l, edge_p_t, edge_p_r, edge_p_b,\r\n    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n    fpx_area_recip, \r\n    ta_dest, dest_byi) => {\r\n    const byi_tl = byi_read;\r\n    let r = 0, g = 0, b = 0;\r\n    let x, y;\r\n    const end_hmiddle = any_coverage_w - 1, end_vmiddle = any_coverage_h - 1;\r\n    r += ta_source[byi_read++] * corner_p_tl;\r\n    g += ta_source[byi_read++] * corner_p_tl;\r\n    b += ta_source[byi_read++] * corner_p_tl;\r\n    for (x = 1; x < end_hmiddle; x++) {\r\n        r += ta_source[byi_read++] * edge_p_t;\r\n        g += ta_source[byi_read++] * edge_p_t;\r\n        b += ta_source[byi_read++] * edge_p_t;\r\n    }\r\n    r += ta_source[byi_read++] * corner_p_tr;\r\n    g += ta_source[byi_read++] * corner_p_tr;\r\n    b += ta_source[byi_read++] * corner_p_tr;\r\n    for (y = 1; y < end_vmiddle; y++) {\r\n        byi_read = byi_tl + y * bypr;\r\n        r += ta_source[byi_read++] * edge_p_l;\r\n        g += ta_source[byi_read++] * edge_p_l;\r\n        b += ta_source[byi_read++] * edge_p_l;\r\n        for (x = 1; x < end_hmiddle; x++) {\r\n            r += ta_source[byi_read++] * fpx_area_recip;\r\n            g += ta_source[byi_read++] * fpx_area_recip;\r\n            b += ta_source[byi_read++] * fpx_area_recip;\r\n        }\r\n        r += ta_source[byi_read++] * edge_p_r;\r\n        g += ta_source[byi_read++] * edge_p_r;\r\n        b += ta_source[byi_read++] * edge_p_r;\r\n    }\r\n    byi_read = byi_tl + end_vmiddle * bypr;\r\n    r += ta_source[byi_read++] * corner_p_bl;\r\n    g += ta_source[byi_read++] * corner_p_bl;\r\n    b += ta_source[byi_read++] * corner_p_bl;\r\n    for (x = 1; x < end_hmiddle; x++) {\r\n        r += ta_source[byi_read++] * edge_p_b;\r\n        g += ta_source[byi_read++] * edge_p_b;\r\n        b += ta_source[byi_read++] * edge_p_b;\r\n    }\r\n    r += ta_source[byi_read++] * corner_p_br;\r\n    g += ta_source[byi_read++] * corner_p_br;\r\n    b += ta_source[byi_read++] * corner_p_br;\r\n    ta_dest[dest_byi] = Math.round(r);\r\n    ta_dest[dest_byi + 1] = Math.round(g);\r\n    ta_dest[dest_byi + 2] = Math.round(b);\r\n}\r\nconst __resize_ta_colorspace_24bipp$subpixel = (ta_source, source_colorspace, dest_size, ta_dest) => {\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const [f_px_w, f_px_h] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let f_source_x, f_source_r;\r\n    let i_source_l, i_source_lr_crossover;\r\n    let f_source_y, f_source_b;\r\n    let i_source_t, i_source_tb_crossover;\r\n    let i_dest_x, i_dest_y;\r\n    const ta_left_proportions = new Float32Array(dest_size[0]);\r\n    const ta_top_proportions = new Float32Array(dest_size[1]);\r\n    const ta_source_x = new Int16Array(dest_size[0]);\r\n    const ta_source_y = new Int16Array(dest_size[1]);\r\n    const ta_source_x_byi_component = new Int32Array(dest_size[0]);\r\n    const ta_source_y_byi_component = new Int32Array(dest_size[1]);\r\n    for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n        f_source_x = i_dest_x * f_px_w;\r\n        f_source_r = f_source_x + f_px_w;\r\n        i_source_l = Math.floor(f_source_x);\r\n        i_source_lr_crossover = i_source_l + 1;\r\n        ta_source_x[i_dest_x] = i_source_l;\r\n        ta_source_x_byi_component[i_dest_x] = i_source_l * source_bypp;\r\n        if (f_source_r < i_source_lr_crossover || i_source_l === f_source_x) {\r\n            ta_left_proportions[i_dest_x] = 1;\r\n        } else {\r\n            ta_left_proportions[i_dest_x] = (i_source_lr_crossover - f_source_x) / f_px_w;\r\n        }\r\n    }\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        f_source_y = i_dest_y * f_px_h;\r\n        f_source_b = f_source_y + f_px_h;\r\n        i_source_t = Math.floor(f_source_y);\r\n        i_source_tb_crossover = i_source_t + 1;\r\n        ta_source_y[i_dest_y] = i_source_t;\r\n        ta_source_y_byi_component[i_dest_y] = i_source_t * source_bypr;\r\n        if (f_source_b < i_source_tb_crossover || i_source_t === f_source_y) {\r\n            ta_top_proportions[i_dest_y] = 1;\r\n        } else {\r\n            ta_top_proportions[i_dest_y] = (i_source_tb_crossover - f_source_y) / f_px_h;\r\n        }\r\n    }\r\n    const ta_ltrb_edge_props = new Float32Array(4);\r\n    let byi_source;\r\n    let byi_write = 0;\r\n    const ta_ltrb_corner_props = new Float32Array(4);\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        ta_ltrb_edge_props[1] = ta_top_proportions[i_dest_y];\r\n        ta_ltrb_edge_props[3] = 1 - ta_top_proportions[i_dest_y];\r\n        for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n            ta_ltrb_edge_props[0] = ta_left_proportions[i_dest_x];\r\n            ta_ltrb_edge_props[2] = 1 - ta_left_proportions[i_dest_x];\r\n            byi_source = ta_source_x_byi_component[i_dest_x] + ta_source_y_byi_component[i_dest_y];\r\n            if (ta_ltrb_edge_props[0] === 1) {\r\n                if (ta_ltrb_edge_props[1] === 1) {\r\n                    copy_px_24bipp(ta_source, byi_source, ta_dest, byi_write);\r\n                } else {\r\n                    read_1x2_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_dest, byi_write, ta_ltrb_edge_props[1], ta_ltrb_edge_props[3]);\r\n                }\r\n            } else {\r\n                if (ta_ltrb_edge_props[1] === 1) {\r\n                    read_2x1_weight_write_24bipp(ta_source, byi_source, ta_dest, byi_write, ta_ltrb_edge_props[0], ta_ltrb_edge_props[2]);\r\n                } else {\r\n                    ta_ltrb_corner_props[0] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[1];\r\n                    ta_ltrb_corner_props[1] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[1];\r\n                    ta_ltrb_corner_props[2] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[3];\r\n                    ta_ltrb_corner_props[3] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[3];\r\n                    read_2x2_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_dest, byi_write, ta_ltrb_corner_props);\r\n                }\r\n            }\r\n            byi_write += 3;\r\n        }\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$subpixel$inline = (ta_source, source_colorspace, dest_size, ta_dest) => {\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const [f_px_w, f_px_h] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let f_source_x, f_source_r;\r\n    let i_source_l, i_source_lr_crossover;\r\n    let f_source_y, f_source_b;\r\n    let i_source_t, i_source_tb_crossover;\r\n    let i_dest_x, i_dest_y;\r\n    const ta_left_proportions = new Float32Array(dest_size[0]);\r\n    const ta_top_proportions = new Float32Array(dest_size[1]);\r\n    const ta_source_x_byi_component = new Int32Array(dest_size[0]);\r\n    for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n        f_source_x = i_dest_x * f_px_w;\r\n        f_source_r = f_source_x + f_px_w;\r\n        i_source_l = Math.floor(f_source_x);\r\n        i_source_lr_crossover = i_source_l + 1;\r\n        ta_source_x_byi_component[i_dest_x] = i_source_l * source_bypp;\r\n        if (f_source_r < i_source_lr_crossover || i_source_l === f_source_x) {\r\n            ta_left_proportions[i_dest_x] = 1;\r\n        } else {\r\n            ta_left_proportions[i_dest_x] = (i_source_lr_crossover - f_source_x) / f_px_w;\r\n        }\r\n    }\r\n    let byi_source;\r\n    let byi_write = 0;\r\n    let byi_read_below, byi_read_right, byi_read_below_right;\r\n    let edge_l, edge_t, edge_r;\r\n    let corner_tl, corner_tr, corner_bl, corner_br;\r\n    let y_byi;\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        f_source_y = i_dest_y * f_px_h;\r\n        f_source_b = f_source_y + f_px_h;\r\n        i_source_t = Math.floor(f_source_y);\r\n        i_source_tb_crossover = i_source_t + 1;\r\n        y_byi = i_source_t * source_bypr;\r\n        if (f_source_b < i_source_tb_crossover || i_source_t === f_source_y) {\r\n            ta_top_proportions[i_dest_y] = 1;\r\n        } else {\r\n            ta_top_proportions[i_dest_y] = (i_source_tb_crossover - f_source_y) / f_px_h;\r\n        }\r\n        edge_t = ta_top_proportions[i_dest_y];\r\n        \r\n        if (edge_t === 1) {\r\n\r\n            for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n                edge_l = ta_left_proportions[i_dest_x];\r\n                edge_r = 1 - ta_left_proportions[i_dest_x];\r\n                byi_source = ta_source_x_byi_component[i_dest_x] + y_byi;\r\n                if (edge_l === 1) {\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                } else {\r\n                    byi_read_right = byi_source + 3;\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                }\r\n            }\r\n\r\n\r\n\r\n        } else {\r\n            const edge_b = 1 - ta_top_proportions[i_dest_y];\r\n            for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n                edge_l = ta_left_proportions[i_dest_x];\r\n                edge_r = 1 - ta_left_proportions[i_dest_x];\r\n                byi_source = ta_source_x_byi_component[i_dest_x] + y_byi;\r\n                if (edge_l === 1) {\r\n                    byi_read_below = byi_source + source_bypr;\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                } else {\r\n                    corner_tl = edge_l * edge_t;\r\n                    corner_tr = edge_r * edge_t;\r\n                    corner_bl = edge_l * edge_b;\r\n                    corner_br = edge_r * edge_b;\r\n                    byi_read_right = byi_source + 3;\r\n                    byi_read_below = byi_source + source_bypr;\r\n                    byi_read_below_right = byi_read_below + 3;\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n            edge_l = ta_left_proportions[i_dest_x];\r\n            edge_r = 1 - ta_left_proportions[i_dest_x];\r\n            byi_source = ta_source_x_byi_component[i_dest_x] + y_byi;\r\n            if (edge_l === 1) {\r\n                if (edge_t === 1) {\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                    ta_dest[byi_write++] = ta_source[byi_source++];\r\n                } else {\r\n                    byi_read_below = byi_source + source_bypr;\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                    ta_dest[byi_write++] = edge_t * ta_source[byi_source++] + edge_b * ta_source[byi_read_below++];\r\n                }\r\n            } else {\r\n                if (edge_t === 1) {\r\n                    byi_read_right = byi_source + 3;\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                    ta_dest[byi_write++] = edge_l * ta_source[byi_source++] + edge_r * ta_source[byi_read_right++];\r\n                } else {\r\n                    corner_tl = edge_l * edge_t;\r\n                    corner_tr = edge_r * edge_t;\r\n                    corner_bl = edge_l * edge_b;\r\n                    corner_br = edge_r * edge_b;\r\n                    byi_read_right = byi_source + 3;\r\n                    byi_read_below = byi_source + source_bypr;\r\n                    byi_read_below_right = byi_read_below + 3;\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[byi_write++] = corner_tl * ta_source[byi_source++] + corner_tr * ta_source[byi_read_right++] + corner_bl * ta_source[byi_read_below++] + corner_br * ta_source[byi_read_below_right++];\r\n                }\r\n            }\r\n        }\r\n            */\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$subpixel = resize_ta_colorspace_24bipp$subpixel$inline;\r\nlet __attempt__resize_ta_colorspace_24bipp$superpixel = (ta_source, source_colorspace, dest_size, ta_dest) => {\r\n    console.log('resize_ta_colorspace_24bipp$superpixel');\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const [f_px_w, f_px_h] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let f_source_x, f_source_r;\r\n    let i_source_l, i_source_r;\r\n    let f_source_y, f_source_b;\r\n    let i_source_t, i_source_b;\r\n    let i_dest_x, i_dest_y;\r\n    let left_edge_dist, top_edge_dist, right_edge_dist, bottom_edge_dist;\r\n    const ta_left_edge_segment_proportions = new Float32Array(dest_size[0]);\r\n    const ta_top_edge_segment_proportions = new Float32Array(dest_size[1]);\r\n    const ta_right_edge_segment_proportions = new Float32Array(dest_size[0]);\r\n    const ta_bottom_edge_segment_proportions = new Float32Array(dest_size[1]);\r\n    const ta_source_x = new Int16Array(dest_size[0]);\r\n    const ta_source_y = new Int16Array(dest_size[1]);\r\n    const ta_source_x_byi_component = new Int32Array(dest_size[0]);\r\n    const ta_source_y_byi_component = new Int32Array(dest_size[1]);\r\n    const ta_source_x_any_coverage_w = new Int16Array(dest_size[0]);\r\n    const ta_source_y_any_coverage_h = new Int16Array(dest_size[1]);\r\n    const source_i_any_coverage_size = new Int16Array(2);\r\n    let fpx_area_recip = 1 / (f_px_w * f_px_h);\r\n    for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n        f_source_x = i_dest_x * f_px_w;\r\n        f_source_r = (i_dest_x + 1) * f_px_w;\r\n        i_source_l = Math.floor(f_source_x);\r\n        i_source_r = Math.ceil(f_source_r);\r\n        ta_source_x[i_dest_x] = i_source_l;\r\n        ta_source_x_byi_component[i_dest_x] = i_source_l * source_bypp;\r\n        ta_source_x_any_coverage_w[i_dest_x] = i_source_r - i_source_l;\r\n        left_edge_dist = f_source_x - i_source_l;\r\n        if (left_edge_dist === 0) left_edge_dist = 1;\r\n        right_edge_dist = i_source_r - f_source_r;\r\n        if (right_edge_dist === 0) right_edge_dist = 1;\r\n        ta_left_edge_segment_proportions[i_dest_x] = (left_edge_dist) * fpx_area_recip;\r\n        ta_right_edge_segment_proportions[i_dest_x] = (right_edge_dist) * fpx_area_recip;\r\n    }\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        f_source_y = i_dest_y * f_px_h;\r\n        f_source_b = (i_dest_y + 1) * f_px_h;\r\n        i_source_t = Math.floor(f_source_y);\r\n        i_source_b = Math.ceil(f_source_b);\r\n        ta_source_y[i_dest_y] = i_source_t;\r\n        ta_source_y_byi_component[i_dest_y] = i_source_t * source_bypr;\r\n        ta_source_y_any_coverage_h[i_dest_y] = i_source_b - i_source_t;\r\n        top_edge_dist = f_source_y - i_source_t;\r\n        if (top_edge_dist === 0) top_edge_dist = 1;\r\n        bottom_edge_dist = i_source_b - f_source_b;\r\n        if (bottom_edge_dist === 0) bottom_edge_dist = 1;\r\n        ta_top_edge_segment_proportions[i_dest_y] = (top_edge_dist) * fpx_area_recip;\r\n        ta_bottom_edge_segment_proportions[i_dest_y] = (bottom_edge_dist) * fpx_area_recip;\r\n    }\r\n    const ta_ltrb_edge_props = new Float32Array(4);\r\n    let byi_source;\r\n    let byi_write = 0;\r\n    const ta_ltrb_corner_props = new Float32Array(4);\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        ta_ltrb_edge_props[1] = ta_top_edge_segment_proportions[i_dest_y];\r\n        ta_ltrb_edge_props[3] = ta_bottom_edge_segment_proportions[i_dest_y];\r\n        source_i_any_coverage_size[1] = ta_source_y_any_coverage_h[i_dest_y];\r\n        for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n            source_i_any_coverage_size[0] = ta_source_x_any_coverage_w[i_dest_x];\r\n            byi_source = ta_source_x_byi_component[i_dest_x] + ta_source_y_byi_component[i_dest_y];\r\n            ta_ltrb_edge_props[0] = ta_left_edge_segment_proportions[i_dest_x];\r\n            ta_ltrb_edge_props[2] = ta_right_edge_segment_proportions[i_dest_x];\r\n            ta_ltrb_corner_props[0] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[1];\r\n            ta_ltrb_corner_props[1] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[1];\r\n            ta_ltrb_corner_props[2] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[3];\r\n            ta_ltrb_corner_props[3] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[3];\r\n            if (source_i_any_coverage_size[0] === 2) {\r\n                if (source_i_any_coverage_size[1] === 2) {\r\n                    read_2x2_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_dest, byi_write, ta_ltrb_corner_props);\r\n                } else if (source_i_any_coverage_size[1] === 3) {\r\n                    read_2x3_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_dest, byi_write, ta_ltrb_edge_props[1], ta_ltrb_edge_props[3]);\r\n                } else {\r\n                    read_gt3x3_weight_write_24bipp(ta_source, source_bypr, byi_source, source_i_any_coverage_size, ta_ltrb_edge_props, ta_ltrb_corner_props, fpx_area_recip, ta_dest, byi_write);\r\n                }\r\n            } else if (source_i_any_coverage_size[0] === 3) {\r\n                if (source_i_any_coverage_size[1] === 2) {\r\n                    read_3x2_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_ltrb_edge_props, ta_ltrb_corner_props, ta_dest, byi_write);\r\n                } else if (source_i_any_coverage_size[1] === 3) {\r\n                    read_3x3_weight_write_24bipp(ta_source, source_bypr, byi_source, ta_ltrb_edge_props, ta_ltrb_corner_props, ta_dest, byi_write);\r\n                } else {\r\n                    read_gt3x3_weight_write_24bipp(ta_source, source_bypr, byi_source, source_i_any_coverage_size, ta_ltrb_edge_props, ta_ltrb_corner_props, fpx_area_recip, ta_dest, byi_write);\r\n                }\r\n            } else {\r\n                read_gt3x3_weight_write_24bipp(ta_source, source_bypr, byi_source, source_i_any_coverage_size, ta_ltrb_edge_props, ta_ltrb_corner_props, fpx_area_recip, ta_dest, byi_write);\r\n            }\r\n            byi_write += 3;\r\n        }\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$subpixel$ta4byis = (ta_source, source_colorspace, dest_size, ta_dest) => {\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const [f_px_w, f_px_h] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let f_source_x, f_source_r;\r\n    let i_source_l, i_source_lr_crossover;\r\n    let f_source_y, f_source_b;\r\n    let i_source_t, i_source_tb_crossover;\r\n    let i_dest_x, i_dest_y;\r\n    const ta_left_proportions = new Float32Array(dest_size[0]);\r\n    const ta_top_proportions = new Float32Array(dest_size[1]);\r\n    const ta_source_x = new Int16Array(dest_size[0]);\r\n    const ta_source_y = new Int16Array(dest_size[1]);\r\n    const ta_source_x_byi_component = new Int32Array(dest_size[0]);\r\n    const ta_source_y_byi_component = new Int32Array(dest_size[1]);\r\n    for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n        f_source_x = i_dest_x * f_px_w;\r\n        f_source_r = f_source_x + f_px_w;\r\n        i_source_l = Math.floor(f_source_x);\r\n        i_source_lr_crossover = i_source_l + 1;\r\n        ta_source_x[i_dest_x] = i_source_l;\r\n        ta_source_x_byi_component[i_dest_x] = i_source_l * source_bypp;\r\n        if (f_source_r < i_source_lr_crossover || i_source_l === f_source_x) {\r\n            ta_left_proportions[i_dest_x] = 1;\r\n        } else {\r\n            ta_left_proportions[i_dest_x] = (i_source_lr_crossover - f_source_x) / f_px_w;\r\n        }\r\n    }\r\n    for (i_dest_y = 0; i_dest_y < dest_size[0]; i_dest_y++) {\r\n        f_source_y = i_dest_y * f_px_h;\r\n        f_source_b = f_source_y + f_px_h;\r\n        i_source_t = Math.floor(f_source_y);\r\n        i_source_tb_crossover = i_source_t + 1;\r\n        ta_source_y[i_dest_y] = i_source_t;\r\n        ta_source_y_byi_component[i_dest_y] = i_source_t * source_bypr;\r\n        if (f_source_b < i_source_tb_crossover || i_source_t === f_source_y) {\r\n            ta_top_proportions[i_dest_y] = 1;\r\n        } else {\r\n            ta_top_proportions[i_dest_y] = (i_source_tb_crossover - f_source_y) / f_px_h;\r\n        }\r\n    }\r\n    const ta_ltrb_edge_props = new Float32Array(4);\r\n    let byi_source;\r\n    let byi_write = 0;\r\n    const ta_tl_weight_props = new Float32Array(2);\r\n    const ta_byi_reads = new Int32Array(4);\r\n    const ta_ltrb_corner_props = new Float32Array(4);\r\n    for (i_dest_y = 0; i_dest_y < dest_size[1]; i_dest_y++) {\r\n        ta_ltrb_edge_props[1] = ta_top_proportions[i_dest_y];\r\n        ta_ltrb_edge_props[3] = 1 - ta_top_proportions[i_dest_y];\r\n        for (i_dest_x = 0; i_dest_x < dest_size[0]; i_dest_x++) {\r\n            ta_ltrb_edge_props[0] = ta_left_proportions[i_dest_x];\r\n            ta_ltrb_edge_props[2] = 1 - ta_left_proportions[i_dest_x];\r\n            ta_byi_reads[0] = ta_source_x_byi_component[i_dest_x] + ta_source_y_byi_component[i_dest_y];\r\n            if (ta_ltrb_edge_props[0] === 1) {\r\n                if (ta_ltrb_edge_props[1] === 1) {\r\n                    copy_px_24bipp(ta_source, ta_byi_reads[0], ta_dest, byi_write);\r\n                } else {\r\n                    ta_byi_reads[2] = ta_byi_reads[0] + source_bypr;\r\n                    read_1x2_weight_write_24bipp$ta4byis(ta_source, ta_byi_reads, ta_dest, byi_write, ta_ltrb_edge_props[1], ta_ltrb_edge_props[3]);\r\n                }\r\n            } else {\r\n                if (ta_ltrb_edge_props[1] === 1) {\r\n                    ta_byi_reads[1] = ta_byi_reads[0] + source_bypp;\r\n                    read_2x1_weight_write_24bipp$ta4byis(ta_source, ta_byi_reads, ta_dest, byi_write, ta_ltrb_edge_props[0], ta_ltrb_edge_props[2]);\r\n                } else {\r\n                    ta_byi_reads[1] = ta_byi_reads[0] + source_bypp;\r\n                    ta_byi_reads[2] = ta_byi_reads[0] + source_bypr;\r\n                    ta_byi_reads[3] = ta_byi_reads[2] + source_bypp;\r\n                    ta_ltrb_corner_props[0] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[1];\r\n                    ta_ltrb_corner_props[1] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[1];\r\n                    ta_ltrb_corner_props[2] = ta_ltrb_edge_props[0] * ta_ltrb_edge_props[3];\r\n                    ta_ltrb_corner_props[3] = ta_ltrb_edge_props[2] * ta_ltrb_edge_props[3];\r\n                    read_2x2_weight_write_24bipp$ta4byis(ta_source, ta_byi_reads, ta_dest, byi_write, ta_ltrb_corner_props);\r\n                }\r\n            }\r\n            byi_write += 3;\r\n        }\r\n    }\r\n}\r\nconst __resize_ta_colorspace_24bipp$superpixel = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const bypr = source_colorspace[3];\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const fpx_area_recip = 1 / (dest_to_source_ratio[0] * dest_to_source_ratio[1]);\r\n    each_source_dest_pixels_resized_limited_further_info(source_colorspace, dest_size, (dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, byi_read) => {\r\n        if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 2) {\r\n            read_2x2_weight_write_24bipp(ta_source, bypr, byi_read, opt_ta_dest, dest_byi, corner_areas_proportions_of_total);\r\n        } else if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 3) {\r\n            read_2x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n        } else if (source_i_any_coverage_size[0] === 3 && source_i_any_coverage_size[1] === 2) {\r\n            read_3x2_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n        } else if (source_i_any_coverage_size[0] === 3 && source_i_any_coverage_size[1] === 3) {\r\n            read_3x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n        } else {\r\n            read_gt3x3_weight_write_24bipp(ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n        }\r\n    });\r\n}\r\nconst __resize_ta_colorspace_24bipp$superpixel$inline = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const fpx_area_recip = 1 / (dest_to_source_ratio[0] * dest_to_source_ratio[1]);\r\n    const source_edge_distances = new Float32Array(4);\r\n    const edge_distances_proportions_of_total = new Float32Array(4);\r\n    const corner_areas_proportions_of_total = new Float32Array(4);\r\n    const fpx_area = dest_to_source_ratio[0] * dest_to_source_ratio[1];\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const source_bipp = source_colorspace[4];\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], source_bypp, source_bypp * dest_size[0], source_bipp, source_bipp * dest_size[0]]);\r\n    const source_fbounds = new Float32Array(4);\r\n    const source_ibounds = new Int16Array(4);\r\n    const source_i_any_coverage_size = new Int16Array(2);\r\n    const source_total_coverage_ibounds = new Int16Array(4);\r\n    let byi_read;\r\n    let dest_byi = 0;\r\n    const width = dest_colorspace[0], height = dest_colorspace[1];\r\n    let x, y;\r\n    for (y = 0; y < height; y++) {\r\n        source_fbounds[1] = y * dest_to_source_ratio[1];\r\n        source_fbounds[3] = source_fbounds[1] + dest_to_source_ratio[1];\r\n        source_ibounds[1] = source_fbounds[1];\r\n        source_ibounds[3] = Math.ceil(source_fbounds[3]);\r\n        source_i_any_coverage_size[1] = source_ibounds[3] - source_ibounds[1];\r\n        source_total_coverage_ibounds[1] = Math.ceil(source_fbounds[1]);\r\n        source_total_coverage_ibounds[3] = source_fbounds[3];\r\n        source_edge_distances[1] = source_total_coverage_ibounds[1] - source_fbounds[1];\r\n        source_edge_distances[3] = source_fbounds[3] - source_total_coverage_ibounds[3];\r\n        if (source_edge_distances[1] === 0) source_edge_distances[1] = 1;\r\n        if (source_edge_distances[3] === 0) source_edge_distances[3] = 1;\r\n        edge_distances_proportions_of_total[1] = source_edge_distances[1] / fpx_area;\r\n        edge_distances_proportions_of_total[3] = source_edge_distances[3] / fpx_area;\r\n        for (x = 0; x < width; x++) {\r\n            source_fbounds[0] = x * dest_to_source_ratio[0];\r\n            source_fbounds[2] = source_fbounds[0] + dest_to_source_ratio[0];\r\n            source_ibounds[0] = source_fbounds[0];\r\n            source_ibounds[2] = Math.ceil(source_fbounds[2]);\r\n            source_i_any_coverage_size[0] = source_ibounds[2] - source_ibounds[0];\r\n            byi_read = source_ibounds[0] * source_bypp + source_ibounds[1] * source_bypr;\r\n            source_total_coverage_ibounds[0] = Math.ceil(source_fbounds[0]); \r\n            source_total_coverage_ibounds[2] = Math.floor(source_fbounds[2]);\r\n            source_edge_distances[0] = source_total_coverage_ibounds[0] - source_fbounds[0];\r\n            source_edge_distances[2] = source_fbounds[2] - source_total_coverage_ibounds[2];\r\n            if (source_edge_distances[0] === 0) source_edge_distances[0] = 1;\r\n            if (source_edge_distances[2] === 0) source_edge_distances[2] = 1;\r\n            corner_areas_proportions_of_total[0] = source_edge_distances[0] * source_edge_distances[1] / fpx_area;\r\n            corner_areas_proportions_of_total[1] = source_edge_distances[2] * source_edge_distances[1] / fpx_area;\r\n            corner_areas_proportions_of_total[2] = source_edge_distances[0] * source_edge_distances[3] / fpx_area;\r\n            corner_areas_proportions_of_total[3] = source_edge_distances[2] * source_edge_distances[3] / fpx_area;\r\n            if (source_i_any_coverage_size[0] > 3 ||  source_i_any_coverage_size[1] > 3) {\r\n                edge_distances_proportions_of_total[0] = source_edge_distances[0] / fpx_area;\r\n                edge_distances_proportions_of_total[2] = source_edge_distances[2] / fpx_area;\r\n                read_gt3x3_weight_write_24bipp(ta_source, source_bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n            } else {\r\n                if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 2) {\r\n                    read_2x2_weight_write_24bipp(ta_source, source_bypr, byi_read, opt_ta_dest, dest_byi, corner_areas_proportions_of_total);\r\n                } else {\r\n                    edge_distances_proportions_of_total[0] = source_edge_distances[0] / fpx_area;\r\n                    edge_distances_proportions_of_total[2] = source_edge_distances[2] / fpx_area;\r\n                    if (source_i_any_coverage_size[0] === 2 && source_i_any_coverage_size[1] === 3) {\r\n                        read_2x3_weight_write_24bipp(ta_source, source_bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n                    } else if (source_i_any_coverage_size[0] === 3 && source_i_any_coverage_size[1] === 2) {\r\n                        read_3x2_weight_write_24bipp(ta_source, source_bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n                    } else if (source_i_any_coverage_size[0] === 3 && source_i_any_coverage_size[1] === 3) {\r\n                        read_3x3_weight_write_24bipp(ta_source, source_bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n                    } else {\r\n                        console.trace();\r\n                        throw 'stop';\r\n                    }\r\n                }\r\n            }\r\n            dest_byi += source_bypp;\r\n        }\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$superpixel$inline$locals = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const fpx_area_recip = 1 / (dest_to_source_ratio[0] * dest_to_source_ratio[1]);\r\n    const [fpxw, fpxh] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let edge_l, edge_t, edge_r, edge_b;\r\n    let edge_p_l, edge_p_t, edge_p_r, edge_p_b;\r\n    let corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br;\r\n    const fpx_area = dest_to_source_ratio[0] * dest_to_source_ratio[1];\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const source_bipp = source_colorspace[4];\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], source_bypp, source_bypp * dest_size[0], source_bipp, source_bipp * dest_size[0]]);\r\n    let fbounds_l, fbounds_t, fbounds_r, fbounds_b;\r\n    let ibounds_l, ibounds_t, ibounds_r, ibounds_b;\r\n    let any_coverage_w, any_coverage_h;\r\n    let total_coverage_l, total_coverage_t, total_coverage_r, total_coverage_b;\r\n    let byi_read;\r\n    let dest_byi = 0;\r\n    const width = dest_colorspace[0], height = dest_colorspace[1];\r\n    let x, y;\r\n    for (y = 0; y < height; y++) {\r\n        fbounds_t = y * fpxh;\r\n        fbounds_b = fbounds_t + fpxh;\r\n        ibounds_t = Math.floor(fbounds_t);\r\n        ibounds_b = Math.ceil(fbounds_b);\r\n        any_coverage_h = ibounds_b - ibounds_t;\r\n        total_coverage_t = Math.ceil(fbounds_t);\r\n        total_coverage_b = Math.floor(fbounds_b);\r\n        edge_t = total_coverage_t - fbounds_t;\r\n        edge_b = fbounds_b - total_coverage_b;\r\n        if (edge_t === 0) edge_t = 1;\r\n        if (edge_b === 0) edge_b = 1;\r\n        edge_p_t = edge_t / fpx_area;\r\n        edge_p_b = edge_b / fpx_area;\r\n        fbounds_l = 0;\r\n        fbounds_r = fpxw;\r\n        for (x = 0; x < width; x++) {\r\n            fbounds_l = x * fpxw;\r\n            fbounds_r = (x + 1) * fpxw;\r\n            ibounds_l = Math.floor(fbounds_l);\r\n            ibounds_r = Math.ceil(fbounds_r);\r\n            any_coverage_w = ibounds_r - ibounds_l;\r\n            byi_read = ibounds_l * source_bypp + ibounds_t * source_bypr;\r\n            total_coverage_l = Math.ceil(fbounds_l);\r\n            total_coverage_r = Math.floor(fbounds_r);\r\n            edge_l = total_coverage_l - fbounds_l;\r\n            edge_r = fbounds_r - total_coverage_r;\r\n            if (edge_l === 0) edge_l = 1;\r\n            if (edge_r === 0) edge_r = 1;\r\n            corner_p_tl = edge_l * edge_p_t;\r\n            corner_p_tr = edge_r * edge_p_t;\r\n            corner_p_bl = edge_l * edge_p_b;\r\n            corner_p_br = edge_r * edge_p_b;\r\n            if (any_coverage_w > 3 ||  any_coverage_h > 3) {\r\n                edge_p_l = edge_l / fpx_area;\r\n                edge_p_r = edge_r / fpx_area;\r\n                read_gt3x3_weight_write_24bipp$locals(ta_source, source_bypr, byi_read,\r\n                    any_coverage_w, any_coverage_h,\r\n                    edge_p_l, edge_p_t, edge_p_r, edge_p_b,\r\n                    corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n                    fpx_area_recip,\r\n                    opt_ta_dest, dest_byi\r\n                    )\r\n            } else {\r\n                if (any_coverage_w === 2 && any_coverage_h === 2) {\r\n                    read_2x2_weight_write_24bipp$locals(ta_source, source_bypr, byi_read, \r\n                        corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n                        opt_ta_dest, dest_byi);\r\n                } else {\r\n                    edge_p_l = edge_l / fpx_area;\r\n                    edge_p_r = edge_r / fpx_area;\r\n                    if (any_coverage_w === 2 && any_coverage_h === 3) {\r\n                        read_2x3_weight_write_24bipp$locals(ta_source, source_bypr, byi_read,\r\n                            edge_p_l, edge_p_t, edge_p_r, edge_p_b,\r\n                            corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n                            opt_ta_dest, dest_byi);\r\n                    } else if (any_coverage_w === 3 && any_coverage_h === 2) {\r\n                        read_3x2_weight_write_24bipp$locals(ta_source, source_bypr, byi_read,\r\n                            edge_p_l, edge_p_t, edge_p_r, edge_p_b,\r\n                            corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n                            opt_ta_dest, dest_byi);\r\n                    } else if (any_coverage_w === 3 && any_coverage_h === 3) {\r\n                        read_3x3_weight_write_24bipp$locals(ta_source, source_bypr, byi_read,\r\n                            edge_p_l, edge_p_t, edge_p_r, edge_p_b,\r\n                            corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br,\r\n                            fpx_area_recip,\r\n                            opt_ta_dest, dest_byi);\r\n                    } else {\r\n                        console.trace();\r\n                        throw 'stop';\r\n                    }\r\n                }\r\n            }\r\n            dest_byi += source_bypp;\r\n        }\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$superpixel$inline$locals$inline = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const ta_dest = opt_ta_dest;\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const fpx_area_recip = 1 / (dest_to_source_ratio[0] * dest_to_source_ratio[1]);\r\n    const [fpxw, fpxh] = [source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]];\r\n    let edge_l, edge_t, edge_r, edge_b;\r\n    let edge_p_l, edge_p_t, edge_p_r, edge_p_b;\r\n    let corner_p_tl, corner_p_tr, corner_p_bl, corner_p_br;\r\n    const fpx_area = dest_to_source_ratio[0] * dest_to_source_ratio[1];\r\n    const source_bypp = source_colorspace[2];\r\n    const source_bypr = source_colorspace[3];\r\n    const source_bipp = source_colorspace[4];\r\n    const dest_colorspace = new Int32Array([dest_size[0], dest_size[1], source_bypp, source_bypp * dest_size[0], source_bipp, source_bipp * dest_size[0]]);\r\n    let fbounds_l, fbounds_t, fbounds_r, fbounds_b;\r\n    let ibounds_l, ibounds_t, ibounds_r, ibounds_b;\r\n    let any_coverage_w, any_coverage_h;\r\n    let total_coverage_l, total_coverage_t, total_coverage_r, total_coverage_b;\r\n    let byi_read;\r\n    let dest_byi = 0;\r\n    const width = dest_colorspace[0], height = dest_colorspace[1];\r\n    let x, y;\r\n    let r = 0, g = 0, b = 0;\r\n    let x_inner, y_inner;\r\n    let byi_read_right, byi_read_below, byi_read_below_right;\r\n    let byi_tl, byi_tm, byi_tr;\r\n    let byi_ml, byi_mm, byi_mr;\r\n    let byi_bl, byi_bm, byi_br;\r\n    let end_hmiddle, end_vmiddle;\r\n    for (y = 0; y < height; y++) {\r\n        fbounds_t = y * fpxh;\r\n        fbounds_b = fbounds_t + fpxh;\r\n        ibounds_t = Math.floor(fbounds_t);\r\n        ibounds_b = Math.ceil(fbounds_b);\r\n        any_coverage_h = ibounds_b - ibounds_t;\r\n        total_coverage_t = Math.ceil(fbounds_t);\r\n        total_coverage_b = Math.floor(fbounds_b);\r\n        edge_t = total_coverage_t - fbounds_t;\r\n        edge_b = fbounds_b - total_coverage_b;\r\n        if (edge_t === 0) edge_t = 1;\r\n        if (edge_b === 0) edge_b = 1;\r\n        edge_p_t = edge_t / fpx_area;\r\n        edge_p_b = edge_b / fpx_area;\r\n        fbounds_l = 0;\r\n        fbounds_r = fpxw;\r\n        for (x = 0; x < width; x++) {\r\n            fbounds_l = x * fpxw;\r\n            fbounds_r = (x + 1) * fpxw;\r\n            ibounds_l = Math.floor(fbounds_l);\r\n            ibounds_r = Math.ceil(fbounds_r);\r\n            any_coverage_w = ibounds_r - ibounds_l;\r\n            byi_read = ibounds_l * source_bypp + ibounds_t * source_bypr;\r\n            total_coverage_l = Math.ceil(fbounds_l);\r\n            total_coverage_r = Math.floor(fbounds_r);\r\n            edge_l = total_coverage_l - fbounds_l;\r\n            edge_r = fbounds_r - total_coverage_r;\r\n            if (edge_l === 0) edge_l = 1;\r\n            if (edge_r === 0) edge_r = 1;\r\n            corner_p_tl = edge_l * edge_p_t;\r\n            corner_p_tr = edge_r * edge_p_t;\r\n            corner_p_bl = edge_l * edge_p_b;\r\n            corner_p_br = edge_r * edge_p_b;\r\n            if (any_coverage_w > 3 ||  any_coverage_h > 3) {\r\n                edge_p_l = edge_l / fpx_area;\r\n                edge_p_r = edge_r / fpx_area;\r\n                byi_tl = byi_read;\r\n                end_hmiddle = any_coverage_w - 1; end_vmiddle = any_coverage_h - 1;\r\n                r = g = b = 0;\r\n                r += ta_source[byi_read++] * corner_p_tl;\r\n                g += ta_source[byi_read++] * corner_p_tl;\r\n                b += ta_source[byi_read++] * corner_p_tl;\r\n                for (x_inner = 1; x_inner < end_hmiddle; x_inner++) {\r\n                    r += ta_source[byi_read++] * edge_p_t;\r\n                    g += ta_source[byi_read++] * edge_p_t;\r\n                    b += ta_source[byi_read++] * edge_p_t;\r\n                }\r\n                r += ta_source[byi_read++] * corner_p_tr;\r\n                g += ta_source[byi_read++] * corner_p_tr;\r\n                b += ta_source[byi_read++] * corner_p_tr;\r\n                for (y_inner = 1; y_inner < end_vmiddle; y_inner++) {\r\n                    byi_read = byi_tl + y_inner * source_bypr;\r\n                    r += ta_source[byi_read++] * edge_p_l;\r\n                    g += ta_source[byi_read++] * edge_p_l;\r\n                    b += ta_source[byi_read++] * edge_p_l;\r\n                    for (x_inner = 1; x_inner < end_hmiddle; x_inner++) {\r\n                        r += ta_source[byi_read++] * fpx_area_recip;\r\n                        g += ta_source[byi_read++] * fpx_area_recip;\r\n                        b += ta_source[byi_read++] * fpx_area_recip;\r\n                    }\r\n                    r += ta_source[byi_read++] * edge_p_r;\r\n                    g += ta_source[byi_read++] * edge_p_r;\r\n                    b += ta_source[byi_read++] * edge_p_r;\r\n                }\r\n                byi_read = byi_tl + end_vmiddle * source_bypr;\r\n                r += ta_source[byi_read++] * corner_p_bl;\r\n                g += ta_source[byi_read++] * corner_p_bl;\r\n                b += ta_source[byi_read++] * corner_p_bl;\r\n                for (x_inner = 1; x_inner < end_hmiddle; x_inner++) {\r\n                    r += ta_source[byi_read++] * edge_p_b;\r\n                    g += ta_source[byi_read++] * edge_p_b;\r\n                    b += ta_source[byi_read++] * edge_p_b;\r\n                }\r\n                r += ta_source[byi_read++] * corner_p_br;\r\n                g += ta_source[byi_read++] * corner_p_br;\r\n                b += ta_source[byi_read++] * corner_p_br;\r\n                ta_dest[dest_byi] = Math.round(r);\r\n                ta_dest[dest_byi + 1] = Math.round(g);\r\n                ta_dest[dest_byi + 2] = Math.round(b);\r\n            } else {\r\n                if (any_coverage_w === 2 && any_coverage_h === 2) {\r\n                    byi_read_right = byi_read + 3;\r\n                    byi_read_below = byi_read + source_bypr;\r\n                    byi_read_below_right = byi_read_below + 3;\r\n                    ta_dest[dest_byi] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[dest_byi + 1] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n                    ta_dest[dest_byi + 2] = corner_p_tl * ta_source[byi_read++] + corner_p_tr * ta_source[byi_read_right++] + corner_p_bl * ta_source[byi_read_below++] + corner_p_br * ta_source[byi_read_below_right++];\r\n                } else {\r\n                    edge_p_l = edge_l / fpx_area;\r\n                    edge_p_r = edge_r / fpx_area;\r\n                    if (any_coverage_w === 2 && any_coverage_h === 3) {\r\n                        byi_tl = byi_read; byi_tr = byi_tl + 3;\r\n                        byi_ml = byi_tl + source_bypr; byi_mr = byi_ml + 3;\r\n                        byi_bl = byi_ml + source_bypr; byi_br = byi_bl + 3;\r\n                        ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n                        ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n                        ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_br++] * corner_p_br\r\n                    } else if (any_coverage_w === 3 && any_coverage_h === 2) {\r\n                        byi_tl = byi_read;\r\n                        byi_tm = byi_tl + 3; byi_tr = byi_tm + 3;\r\n                        byi_bl = byi_tm + source_bypr; byi_bm = byi_bl + 3; byi_br = byi_bm + 3;\r\n                        ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n                        ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n                        ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                            ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br;\r\n                    } else if (any_coverage_w === 3 && any_coverage_h === 3) {\r\n                        byi_tl = byi_read; byi_tm = byi_tl + source_bypp; byi_tr = byi_tm + source_bypp;\r\n                        byi_ml = byi_tl + source_bypr; byi_mm = byi_ml + source_bypp; byi_mr = byi_mm + source_bypp;\r\n                        byi_bl = byi_ml + source_bypr; byi_bm = byi_bl + source_bypp; byi_br = byi_bm + source_bypp;\r\n                        ta_dest[dest_byi] =     ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n                        ta_dest[dest_byi + 1] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n                        ta_dest[dest_byi + 2] = ta_source[byi_tl++] * corner_p_tl + ta_source[byi_tm++] * edge_p_t + ta_source[byi_tr++] * corner_p_tr +\r\n                                                ta_source[byi_ml++] * edge_p_l + ta_source[byi_mm++] * fpx_area_recip + ta_source[byi_mr++] * edge_p_r +\r\n                                                ta_source[byi_bl++] * corner_p_bl + ta_source[byi_bm++] * edge_p_b + ta_source[byi_br++] * corner_p_br\r\n                    } else {\r\n                        console.trace();\r\n                        throw 'stop';\r\n                    }\r\n                }\r\n            }\r\n            dest_byi += source_bypp;\r\n        }\r\n    }\r\n}\r\nconst resize_ta_colorspace_24bipp$superpixel = resize_ta_colorspace_24bipp$superpixel$inline$locals$inline;\r\nconst resize_ta_colorspace_24bipp$general = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    const [width, height, bypp, bypr, bipp, bipr] = source_colorspace;\r\n    const fpx_area_recip = 1 / (dest_to_source_ratio[0] * dest_to_source_ratio[1]);\r\n    each_source_dest_pixels_resized_limited_further_info(source_colorspace, dest_size, (dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, byi_read) => {\r\n        if (source_i_any_coverage_size[0] === 1) {\r\n            if (source_i_any_coverage_size[1] === 1) {\r\n                copy_px_24bipp(ta_source, byi_read, opt_ta_dest, dest_byi);\r\n            } else if (source_i_any_coverage_size[1] === 2) {\r\n                read_1x2_weight_write_24bipp(ta_source, bypr, byi_read, opt_ta_dest, dest_byi, edge_distances_proportions_of_total[1], edge_distances_proportions_of_total[3]);\r\n            } else {\r\n                console.log('source_i_any_coverage_size', source_i_any_coverage_size);\r\n                console.trace();\r\n                throw 'NYI';\r\n            }\r\n        } else if (source_i_any_coverage_size[0] === 2) {\r\n            if (source_i_any_coverage_size[1] === 1) {\r\n                read_2x1_weight_write_24bipp(ta_source, byi_read, opt_ta_dest, dest_byi, edge_distances_proportions_of_total[0], edge_distances_proportions_of_total[2]);\r\n            } else if (source_i_any_coverage_size[1] === 2) {\r\n                read_2x2_weight_write_24bipp(ta_source, bypr, byi_read, opt_ta_dest, dest_byi, corner_areas_proportions_of_total);\r\n            } else {\r\n                read_2x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n            }\r\n        } else if (source_i_any_coverage_size[0] === 3) {\r\n            if (source_i_any_coverage_size[1] === 1) {\r\n                console.log('source_i_any_coverage_size', source_i_any_coverage_size);\r\n                console.trace();\r\n                throw 'NYI';\r\n            } else if (source_i_any_coverage_size[1] === 2) {\r\n                read_3x2_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n            } else if (source_i_any_coverage_size[1] === 3) {\r\n                read_3x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n            } else {\r\n                read_gt3x3_weight_write_24bipp(ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n            }\r\n        } else {\r\n            read_gt3x3_weight_write_24bipp(ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n        }\r\n    });\r\n}\r\nconst resize_ta_colorspace_24bipp = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const dest_to_source_ratio = new Float32Array([source_colorspace[0] / dest_size[0], source_colorspace[1] / dest_size[1]]);\r\n    if (dest_to_source_ratio[0] < 1 && dest_to_source_ratio[1] < 1) {\r\n        return resize_ta_colorspace_24bipp$subpixel(ta_source, source_colorspace, dest_size, opt_ta_dest);\r\n    } else if (dest_to_source_ratio[0] > 1 && dest_to_source_ratio[1] > 1) {\r\n        return resize_ta_colorspace_24bipp$superpixel(ta_source, source_colorspace, dest_size, opt_ta_dest);\r\n    } else {\r\n        return resize_ta_colorspace_24bipp$general(ta_source, source_colorspace, dest_size, opt_ta_dest);\r\n    }\r\n}\r\nconst read_fpx_weight_write_24bipp = (dest_byi, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, byi_read) => {\r\n    if (source_i_any_coverage_size[0] === 1) {\r\n        if (source_i_any_coverage_size[1] === 1) {\r\n            opt_ta_dest[dest_byi] = ta_source[byi_read++];\r\n            opt_ta_dest[dest_byi + 1] = ta_source[byi_read++];\r\n            opt_ta_dest[dest_byi + 2] = ta_source[byi_read++];\r\n        } else if (source_i_any_coverage_size[1] === 2) {\r\n            byi_read_below = byi_read + bypr;\r\n            opt_ta_dest[dest_byi] = edge_distances_proportions_of_total[1] * ta_source[byi_read++] + edge_distances_proportions_of_total[3] * ta_source[byi_read_below++];\r\n            opt_ta_dest[dest_byi + 1] = edge_distances_proportions_of_total[1] * ta_source[byi_read++] + edge_distances_proportions_of_total[3] * ta_source[byi_read_below++];\r\n            opt_ta_dest[dest_byi + 2] = edge_distances_proportions_of_total[1] * ta_source[byi_read++] + edge_distances_proportions_of_total[3] * ta_source[byi_read_below++];\r\n        } else {\r\n            console.log('source_i_any_coverage_size', source_i_any_coverage_size);\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    } else if (source_i_any_coverage_size[0] === 2) {\r\n        if (source_i_any_coverage_size[1] === 1) {\r\n            byi_read_right = byi_read + bypp;\r\n            opt_ta_dest[dest_byi] = edge_distances_proportions_of_total[0] * ta_source[byi_read++] + edge_distances_proportions_of_total[2] * ta_source[byi_read_right++];\r\n            opt_ta_dest[dest_byi + 1] = edge_distances_proportions_of_total[0] * ta_source[byi_read++] + edge_distances_proportions_of_total[2] * ta_source[byi_read_right++];\r\n            opt_ta_dest[dest_byi + 2] = edge_distances_proportions_of_total[0] * ta_source[byi_read++] + edge_distances_proportions_of_total[2] * ta_source[byi_read_right++];\r\n        } else if (source_i_any_coverage_size[1] === 2) {\r\n            byi_read_right = byi_read + bypp;\r\n            byi_read_below = byi_read + bypr;\r\n            byi_read_below_right = byi_read_below + bypp;\r\n            opt_ta_dest[dest_byi] = corner_areas_proportions_of_total[0] * ta_source[byi_read++] + corner_areas_proportions_of_total[1] * ta_source[byi_read_right++] + corner_areas_proportions_of_total[2] * ta_source[byi_read_below++] + corner_areas_proportions_of_total[3] * ta_source[byi_read_below_right++];\r\n            opt_ta_dest[dest_byi + 1] = corner_areas_proportions_of_total[0] * ta_source[byi_read++] + corner_areas_proportions_of_total[1] * ta_source[byi_read_right++] + corner_areas_proportions_of_total[2] * ta_source[byi_read_below++] + corner_areas_proportions_of_total[3] * ta_source[byi_read_below_right++];\r\n            opt_ta_dest[dest_byi + 2] = corner_areas_proportions_of_total[0] * ta_source[byi_read++] + corner_areas_proportions_of_total[1] * ta_source[byi_read_right++] + corner_areas_proportions_of_total[2] * ta_source[byi_read_below++] + corner_areas_proportions_of_total[3] * ta_source[byi_read_below_right++];\r\n        } else {\r\n            read_2x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n        }\r\n    } else if (source_i_any_coverage_size[0] === 3) {\r\n        if (source_i_any_coverage_size[1] === 1) {\r\n            console.log('source_i_any_coverage_size', source_i_any_coverage_size);\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (source_i_any_coverage_size[1] === 2) {\r\n            read_3x2_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, opt_ta_dest, dest_byi);\r\n        } else if (source_i_any_coverage_size[1] === 3) {\r\n            read_3x3_weight_write_24bipp(ta_source, bypr, byi_read, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n        } else {\r\n            read_gt3x3_weight_write_24bipp(ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n        }\r\n    } else {\r\n        read_gt3x3_weight_write_24bipp(ta_source, bypr, byi_read, source_i_any_coverage_size, edge_distances_proportions_of_total, corner_areas_proportions_of_total, fpx_area_recip, opt_ta_dest, dest_byi);\r\n    }\r\n}\r\nconst resize_ta_colorspace = (ta_source, source_colorspace, dest_size, opt_ta_dest) => {\r\n    const bipp = source_colorspace[4];\r\n    if (bipp === 1) {\r\n        console.trace(); throw 'NYI';\r\n    } else if (bipp === 8) {\r\n        console.trace(); throw 'NYI';\r\n    } else if (bipp === 24) {\r\n        return resize_ta_colorspace_24bipp(ta_source, source_colorspace, dest_size, opt_ta_dest);\r\n    } else if (bipp === 32) {\r\n        console.trace(); throw 'NYI';\r\n    } else {\r\n        console.trace();\r\n        throw 'unsupported bipp: ' + bipp;\r\n    }\r\n}\r\nmodule.exports = {\r\n    resize_ta_colorspace: resize_ta_colorspace,\r\n    resize_ta_colorspace_24bipp: resize_ta_colorspace_24bipp,\r\n    resize_ta_colorspace_24bipp$subpixel: resize_ta_colorspace_24bipp$subpixel\r\n}\r\n", "\r\nconst get_instance = () => {\r\n\r\n    // Write, not paint?\r\n\r\n\r\n\r\n    const fill_solid_rect_by_bounds_8bipp = (ta_dest, bypr_dest, ta_bounds, ui8_color) => {\r\n        // create a row filled with that color.\r\n\r\n        // need the bypr of dest.\r\n\r\n        const row_width = ta_bounds[2] - ta_bounds[0];\r\n        const bytes_per_row = row_width;\r\n        const ta_write_row = (new Uint8ClampedArray(bytes_per_row)).fill(ui8_color);\r\n        // iterate through you values...\r\n\r\n        const byi_dest_start = (ta_bounds[0]) + (ta_bounds[1] * bypr_dest);\r\n        let byi_write = byi_dest_start;\r\n\r\n        for (let y = ta_bounds[1]; y < ta_bounds[3]; y++) {\r\n            //console.log('byi_read, byi_write', [byi_read, byi_write]);\r\n            ta_dest.set(ta_write_row, byi_write);\r\n            //byi_read += bytes_source_row_jump;\r\n            byi_write += bypr_dest;\r\n        }\r\n    }\r\n\r\n    // And make the 24 bipp version.\r\n    //  Setting up the initial row would take longer.\r\n    //   Worth having the function written in a ta-access more purely mathematical way.\r\n    //    May make more functions for the pb classes that wrap these in a cool / efficient way.\r\n\r\n\r\n    const fill_solid_rect_by_bounds_24bipp = (ta_dest, bypr_dest, ta_bounds, ta_rgb) => {\r\n        // create a row filled with that color.\r\n\r\n        // need the bypr of dest.\r\n\r\n        const row_width = ta_bounds[2] - ta_bounds[0];\r\n        const bytes_per_row = row_width * 3;\r\n        const ta_write_row = (new Uint8ClampedArray(bytes_per_row));\r\n\r\n        //const l = \r\n\r\n        let cc = 0, c = 0;\r\n        while (c < bytes_per_row) {\r\n            ta_write_row[c++] = ta_rgb[cc++];\r\n            //cc++;\r\n            if (cc === 3) cc = 0;\r\n            //c++;\r\n        }\r\n        // iterate through you values...\r\n\r\n        const byi_dest_start = (ta_bounds[0] * 3) + (ta_bounds[1] * bypr_dest);\r\n        let byi_write = byi_dest_start;\r\n\r\n        for (let y = ta_bounds[1]; y < ta_bounds[3]; y++) {\r\n            //console.log('byi_read, byi_write', [byi_read, byi_write]);\r\n            ta_dest.set(ta_write_row, byi_write);\r\n            //byi_read += bytes_source_row_jump;\r\n            byi_write += bypr_dest;\r\n        }\r\n    }\r\n\r\n\r\n    // A ta-math directory may be better.\r\n    //  directories:\r\n    //  read\r\n    //  copy\r\n    //  write / paint\r\n\r\n\r\n\r\n\r\n    // paint_rect\r\n    //  maybe have paint functions separate\r\n    //  copy functions separate\r\n\r\n\r\n\r\n\r\n    const fill_solid_rect_by_bounds = (ta_dest, bypr_dest, ta_bounds, bipp, color) => {\r\n        // Polymorphism with color being a number or a typed array?\r\n        \r\n\r\n        // Call a different specific function depending on curcumstances?\r\n\r\n        if (bipp === 8) {\r\n            return fill_solid_rect_by_bounds_8bipp(ta_dest, bypr_dest, ta_bounds, color);\r\n        } else if (bipp === 24) {\r\n            return fill_solid_rect_by_bounds_24bipp(ta_dest, bypr_dest, ta_bounds, color);\r\n        } else if (bipp === 32) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else {\r\n            console.trace();\r\n            \r\n            throw 'Unsupported bipp: ' + bipp;\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    return {\r\n        fill_solid_rect_by_bounds: fill_solid_rect_by_bounds,\r\n        fill_solid_rect_by_bounds_24bipp: fill_solid_rect_by_bounds_24bipp,\r\n        fill_solid_rect_by_bounds_8bipp: fill_solid_rect_by_bounds_8bipp,\r\n\r\n        get_instance: get_instance\r\n    }\r\n}\r\n\r\nmodule.exports = get_instance();\r\n", "// Convert a Uint8Array to a continuous binary string (for debugging purposes)\r\nconst to_binary_string = (uint8Array) => {\r\n    return Array.from(uint8Array)\r\n        .map(byte => byte.toString(2).padStart(8, '0')) // Convert each byte to an 8-bit binary string\r\n        .join(''); // Join all binary strings into one continuous string\r\n};\r\n\r\n/**\r\n * Right-shift a Uint8Array by 1 bit with carry propagation between 32-bit chunks.\r\n * @param {Uint8Array} image - The input image as a Uint8Array.\r\n * @returns {Uint8Array} - The resulting shifted image.\r\n */\r\nconst right_shift_32bit_with_carry = (image) => {\r\n    const length = image.length;\r\n    const shifted_result = new Uint8Array(length); // To hold the shifted image\r\n    \r\n    const dataView = new DataView(image.buffer);\r\n    const resultView = new DataView(shifted_result.buffer);\r\n    \r\n    const chunks = length >> 2; // Number of 32-bit chunks (4 bytes per chunk)\r\n    const remainder = length & 3; // Remainder bytes (length % 4)\r\n    let carry = 0; // Carry bit from previous 32-bit chunk\r\n    \r\n    for (let i = 0; i < chunks; i++) {\r\n        const original = dataView.getUint32(i * 4); // Read original 32-bit chunk in little-endian\r\n        \r\n        // Right-shift 32-bit chunk and add carry from previous chunk\r\n        const shifted = (carry << 31) | (original >>> 1); // Carry into MSB\r\n        \r\n        // Store the shifted result in little-endian\r\n        resultView.setUint32(i * 4, shifted);\r\n        \r\n        // Capture the least significant bit to carry into the next chunk\r\n        carry = original & 1; // Get the LSB of the original chunk\r\n    }\r\n\r\n    // Handle the remaining bytes (if any)\r\n    if (remainder > 0) {\r\n        const lastIndex = chunks * 4; // Start index for the remaining bytes\r\n        const lastChunk = new Uint8Array(4); // To hold the last 32-bit chunk\r\n        \r\n        // Copy the remaining bytes into the lastChunk\r\n        lastChunk.set(image.slice(lastIndex));\r\n\r\n        // Right-shift the last chunk and add carry\r\n        const lastOriginal = new DataView(lastChunk.buffer).getUint32(0);\r\n        const lastShifted = (carry << 31) | (lastOriginal >>> 1);\r\n        \r\n        // Store the last shifted result, considering the actual length\r\n        for (let j = 0; j < remainder; j++) {\r\n            resultView.setUint8(lastIndex + j, (lastShifted >>> (8 * (3 - j))) & 0xFF);\r\n        }\r\n    }\r\n    \r\n    return shifted_result;\r\n};\r\n\r\n/**\r\n * XOR two TypedArrays. Both arrays must be of the same length.\r\n * If a result array is not provided, a new array will be created.\r\n * @param {Uint8Array | TypedArray} original_image - The first TypedArray.\r\n * @param {Uint8Array | TypedArray} shifted_image - The second TypedArray.\r\n * @param {TypedArray} [res] - Optional TypedArray to store the result. If not provided, a new one will be created.\r\n * @returns {TypedArray} - The XOR result array.\r\n */\r\nconst xor_typed_arrays = (original_image, shifted_image, res) => {\r\n    const length = original_image.length;\r\n    if (length !== shifted_image.length) {\r\n        throw new Error('Typed arrays must be of the same length.');\r\n    }\r\n\r\n    const xor_result = res || new Uint8Array(length); // Create result array if not provided\r\n\r\n    const originalView = new DataView(original_image.buffer);\r\n    const shiftedView = new DataView(shifted_image.buffer);\r\n    const resultView = new DataView(xor_result.buffer);\r\n    \r\n    const chunks = length >>> 2; // Number of 32-bit chunks (length / 4)\r\n    const remaining_start_index = chunks << 2; // Calculate start index for remaining bytes\r\n\r\n    // XOR each 32-bit chunk\r\n    for (let i = 0; i < chunks; i++) {\r\n        const byteOffset = i << 2; // Calculate byte offset (i * 4) using left shift\r\n        const original = originalView.getUint32(byteOffset, false); // Read in big-endian\r\n        const shifted = shiftedView.getUint32(byteOffset, false); // Read in big-endian\r\n        const xor_result_chunk = original ^ shifted; // Perform XOR\r\n        resultView.setUint32(byteOffset, xor_result_chunk, false); // Store result in big-endian\r\n    }\r\n\r\n    // Handle remaining bytes using DataView\r\n    for (let i = remaining_start_index; i < length; i++) {\r\n        const originalByte = originalView.getUint8(i); // Read remaining byte from original\r\n        const shiftedByte = shiftedView.getUint8(i); // Read remaining byte from shifted\r\n        resultView.setUint8(i, originalByte ^ shiftedByte); // Store XOR of remaining bytes\r\n    }\r\n\r\n    return xor_result;\r\n};\r\nconst copy_row_beginning_bits = (ta_source, row_width, ta_dest) => {\r\n    // source and dest must be the same lengths.\r\n    if (ta_source.length !== ta_dest.length) {\r\n        throw new Error(\"Source and destination arrays must be the same length.\");\r\n    }\r\n\r\n    const total_bits = ta_source.length * 8; // Total number of bits in the source and destination arrays\r\n    const dataViewSource = new DataView(ta_source.buffer, ta_source.byteOffset);\r\n    const dataViewDest = new DataView(ta_dest.buffer, ta_dest.byteOffset);\r\n\r\n    // Calculate the number of rows based on row width in bits\r\n    const height = Math.floor(total_bits / row_width); // Number of rows\r\n\r\n    let bit_index = 0; // Bit-level index\r\n\r\n    for (let y = 0; y < height; y++) {\r\n        const byte_index = Math.floor(bit_index / 8); // Determine which byte the bit is in\r\n        const bit_in_byte = bit_index % 8;            // Determine the bit position within the byte\r\n\r\n        // Read the byte from the source where the row starts\r\n        const source_byte = dataViewSource.getUint8(byte_index);\r\n\r\n        // Extract the first bit of the row (most significant bit at the beginning of each row)\r\n        const first_bit = (source_byte >> (7 - bit_in_byte)) & 1; // Extract the specific bit\r\n\r\n        // Read the destination byte and modify its first bit\r\n        const dest_byte = dataViewDest.getUint8(byte_index);\r\n        const updated_dest_byte = (dest_byte & ~(1 << (7 - bit_in_byte))) | (first_bit << (7 - bit_in_byte));\r\n\r\n        // Write the updated byte back into the destination\r\n        dataViewDest.setUint8(byte_index, updated_dest_byte);\r\n\r\n        bit_index += row_width; // Move to the next row (row_width is in bits, so move by that many bits)\r\n    }\r\n};\r\n\r\n/**\r\n * Sets the beginning bit of each row to 0 in a binary grid represented by a typed array.\r\n * @param {Uint8Array} ta - The typed array representing the binary grid.\r\n * @param {number} row_width - The width of each row in bits.\r\n */\r\nconst set_row_beginning_bits_to_0 = (ta, row_width) => {\r\n    const total_bits = ta.length * 8; // Total number of bits in the array\r\n    const dataView = new DataView(ta.buffer, ta.byteOffset);\r\n    const height = Math.floor(total_bits / row_width); // Number of rows\r\n\r\n    let bit_index = 0; // Bit-level index\r\n\r\n    for (let y = 0; y < height; y++) {\r\n        const byte_index = Math.floor(bit_index / 8); // Determine which byte the bit is in\r\n        const bit_in_byte = bit_index % 8;            // Determine the bit position within the byte\r\n\r\n        // Read the current byte from the DataView\r\n        const byte = dataView.getUint8(byte_index);\r\n\r\n        // Clear the bit at the specific position (set it to 0)\r\n        const updated_byte = byte & ~(1 << (7 - bit_in_byte));\r\n\r\n        // Write the updated byte back into the DataView\r\n        dataView.setUint8(byte_index, updated_byte);\r\n\r\n        // Move to the start of the next row (row_width is in bits, so move by that many bits)\r\n        bit_index += row_width;\r\n    }\r\n};\r\n\r\nconst _copy_row_beginning_bits = (ta_source, row_width, ta_dest) => {\r\n    // source and dest must be the same lengths.\r\n\r\n    if (ta_source.length === ta_dest.length) {\r\n\r\n        const l = ta_source.length;\r\n        // calculate the number or rows.... (height)\r\n\r\n        const height = l / row_width;\r\n\r\n        let bit_index = 0;\r\n        for (let y = 0; y < height; y++) {\r\n            // Copy \r\n\r\n\r\n            bit_index += row_width;\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n/**\r\n * Fast method to find the index of the next set bit in a 32-bit integer.\r\n * @param {number} num - The number to search within.\r\n * @param {number} start_index - The starting index to search from.\r\n * @returns {number|boolean} - The index of the next set bit, or false if none found.\r\n */\r\nconst fast_find_next_set_bit = (num, start_index) => {\r\n    // Check if start_index is out of range\r\n    if (start_index < -1 || start_index > 31) return false; // Ensure start_index is within valid range\r\n\r\n    // Handle case where start_index is 31 (no more bits after that)\r\n    if (start_index === 31) return false;\r\n\r\n    // Mask out all bits up to and including the start_index\r\n    if (start_index >= 0) {\r\n        // Shift bits to the left to clear bits up to start_index\r\n        num = num & ((1 << (31 - start_index)) - 1);\r\n    }\r\n\r\n    // Use clz32 to find the number of leading zeros\r\n    if (num === 0) return false; // No bits set after start_index\r\n    \r\n    const next_set_bit = Math.clz32(num); // Number of leading zeros in remaining bits\r\n    return next_set_bit < 32 ? next_set_bit : false; // Return the index of the next set bit\r\n};\r\n/**\r\n * Finds the index of the next set bit in a typed array, processing in 32-bit chunks where possible.\r\n *\r\n * @param {Uint8Array | Uint16Array | Uint32Array} ta - The typed array to search within.\r\n * @param {number} start_index - The starting bit index to search from.\r\n * @param {number} limit - The maximum number of bits to search.\r\n * @returns {number|boolean} - The index of the next set bit or false if none found.\r\n *//**\r\n * Finds the index of the next set bit in a typed array, processing in 32-bit chunks where possible.\r\n *\r\n * @param {Uint8Array | Uint16Array | Uint32Array} ta - The typed array to search within.\r\n * @param {number} start_index - The starting bit index to search from.\r\n * @param {number} limit - The maximum number of bits to search.\r\n * @returns {number|boolean} - The index of the next set bit or false if none found.\r\n */\r\nconst _____fast_find_next_set_ta_bit = (ta, start_index = 0, limit = ta.length * 8) => {\r\n    const total_bits = ta.length * 8;\r\n    if (start_index >= total_bits || limit <= 0) return false;\r\n\r\n    const end_index = Math.min(start_index + limit, total_bits);\r\n    const dv = new DataView(ta.buffer, ta.byteOffset, ta.byteLength);\r\n\r\n    let bit_index = start_index;\r\n\r\n    // Process each bit, leveraging 32-bit chunk processing where possible\r\n    while (bit_index < end_index) {\r\n        const byte_offset = bit_index >>> 3; // Convert bit index to byte index\r\n        const bit_offset_in_byte = bit_index & 7; // Position of bit within byte\r\n\r\n        // If aligned to 32-bit boundary and at least 32 bits left, read a full 32-bit word\r\n        if (bit_offset_in_byte === 0 && bit_index + 32 <= end_index) {\r\n            const chunk = dv.getUint32(byte_offset, false); // Read 32 bits in big-endian\r\n            const chunk_start_index = bit_index & 31; // Offset within the chunk\r\n\r\n            let relative_bit_index = fast_find_next_set_bit(chunk, chunk_start_index);\r\n\r\n            if (relative_bit_index !== false) {\r\n                return bit_index + relative_bit_index; // Return absolute bit index\r\n            }\r\n\r\n            // Move by 32 bits if no set bit found in this chunk\r\n            bit_index += 32;\r\n        } else {\r\n            // Check single bits for any remaining positions\r\n            const byte = dv.getUint8(byte_offset);\r\n            const bit_pos_in_byte = 7 - (bit_index & 7);\r\n\r\n            if ((byte & (1 << bit_pos_in_byte)) !== 0) {\r\n                return bit_index;\r\n            }\r\n\r\n            bit_index++;\r\n        }\r\n    }\r\n\r\n    return false; // No set bit found\r\n};\r\n\r\n/**\r\n * Finds the index of the next set bit in a typed array within a specified limit, ensuring it moves forward from the start_index.\r\n * @param {Uint8Array | Uint16Array | Uint32Array} ta - The typed array to search within.\r\n * @param {number} start_index - The starting bit index to search from.\r\n * @param {number} limit - The maximum number of bits to search.\r\n * @returns {number|boolean} - The index of the next set bit within the typed array, or false if none found.\r\n */\r\nconst fast_find_next_set_ta_bit = (ta, start_index = 0, limit = ta.length * 8) => {\r\n    const total_bits = ta.length * 8;\r\n    const end_index = Math.min(start_index + limit, total_bits);\r\n\r\n    // Start searching from the bit after start_index\r\n    for (let bit_index = start_index + 1; bit_index < end_index; bit_index++) {\r\n        const byte_index = bit_index >>> 3;\r\n        const bit_in_byte = bit_index & 7;\r\n        \r\n        // Check if the specific bit is set (1)\r\n        if ((ta[byte_index] & (1 << (7 - bit_in_byte))) !== 0) {\r\n            return bit_index; // Return the first found set bit index\r\n        }\r\n    }\r\n    return false; // No set bit found within the range\r\n};\r\n\r\n/**\r\n * Iterate through a TypedArray and call a callback for each index where the bit is '1'.\r\n * @param {TypedArray} ta - The TypedArray to iterate over.\r\n * @param {function} cb - The callback to invoke for each index with a bit of '1'.\r\n */\r\nconst each_1_index = (ta, cb) => {\r\n    const length = ta.length;\r\n\r\n    // Check if the TypedArray is empty\r\n    if (length === 0) return;\r\n\r\n    const view = new DataView(ta.buffer, ta.byteOffset); // Ensure DataView respects byteOffset\r\n    const chunks = length >>> 2; // Number of 32-bit chunks\r\n    const remaining_start_index = chunks << 2; // Start index for remaining bytes\r\n    const remaining_length = length % 4; // Length of remaining bytes\r\n\r\n    // Iterate through each 32-bit chunk\r\n    for (let i = 0; i < chunks; i++) {\r\n        const value = view.getUint32(i << 2, false); // Read 32-bit chunk in big-endian\r\n        let bit_index = fast_find_next_set_bit(value, -1); // Start searching from the beginning\r\n\r\n        // While there are set bits in this chunk\r\n        while (bit_index !== false) {\r\n            cb((i << 5) + bit_index); // `i << 5` accounts for 32 bits (not bytes) in the chunk\r\n            bit_index = fast_find_next_set_bit(value, bit_index); // Find the next set bit\r\n        }\r\n    }\r\n\r\n    // Handle remaining bytes if any\r\n    for (let i = 0; i < remaining_length; i++) {\r\n        const byte = view.getUint8(remaining_start_index + i); // Read the remaining byte\r\n        // Check each bit in the byte\r\n        for (let bit = 0; bit < 8; bit++) {\r\n            if (byte & (1 << (7 - bit))) { // Check if the bit is '1' (start from MSB)\r\n                // Calculate the absolute index in the original TypedArray\r\n                const absolute_index = (remaining_start_index * 8) + (i * 8) + bit;\r\n                cb(absolute_index); // Call the callback with the bit index\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n\r\n/*\r\nconst pop_cnt = (n) => {\r\n    n = n - ((n >> 1) & 0x55555555);             // Put count of each 2 bits into those 2 bits\r\n    n = (n & 0x33333333) + ((n >> 2) & 0x33333333); // Put count of each 4 bits into those 4 bits\r\n    n = (n + (n >> 4)) & 0x0F0F0F0F;             // Put count of each 8 bits into those 8 bits\r\n    n = n + (n >> 8);                            // Put count of each 16 bits into those 16 bits\r\n    n = n + (n >> 16);                           // Put count of each 32 bits into those 32 bits\r\n    return n & 0x3F;                             // Mask to get the last 6 bits (which is enough to store the result)\r\n  };\r\n\r\nconst count_1s = ta => {\r\n    const length = ta.length;\r\n    let res = 0;\r\n\r\n    // Check if the TypedArray is empty\r\n    if (length === 0) return;\r\n\r\n    const view = new DataView(ta.buffer);\r\n    const chunks = length >>> 2; // Number of 32-bit chunks\r\n    const remaining_start_index = chunks << 2; // Start index for remaining bytes\r\n    const remaining_length = length % 4; // Length of remaining bytes\r\n\r\n    // Iterate through each 32-bit chunk\r\n    for (let i = 0; i < chunks; i++) {\r\n\r\n\r\n        \r\n       res += pop_cnt(value);\r\n    }\r\n\r\n    // Handle remaining bytes if any\r\n    for (let i = 0; i < remaining_length; i++) {\r\n        const byte = view.getUint8(remaining_start_index + i); // Read the remaining byte\r\n        // Check each bit in the byte\r\n        for (let bit = 0; bit < 8; bit++) {\r\n            if (byte & (1 << bit)) { // If the bit is '1'\r\n                // Calculate the absolute index in the original TypedArray\r\n                //const absolute_index = remaining_start_index + (i * 8) + bit; // Index within the TypedArray\r\n                //cb(absolute_index); // Call the callback with the bit index\r\n                res++;\r\n            }\r\n        }\r\n    }\r\n\r\n    return res;\r\n\r\n}\r\n    */\r\n\r\n\r\nconst pop_cnt = (n) => {\r\n    n = n - ((n >> 1) & 0x55555555);             // Put count of each 2 bits into those 2 bits\r\n    n = (n & 0x33333333) + ((n >> 2) & 0x33333333); // Put count of each 4 bits into those 4 bits\r\n    n = (n + (n >> 4)) & 0x0F0F0F0F;             // Put count of each 8 bits into those 8 bits\r\n    n = n + (n >> 8);                            // Put count of each 16 bits into those 16 bits\r\n    n = n + (n >> 16);                           // Put count of each 32 bits into those 32 bits\r\n    return n & 0x3F;                             // Mask to get the last 6 bits (which is enough to store the result)\r\n};\r\n\r\n// Count the number of 1 bits in a whole TypedArray\r\nconst pop_cnt_typed_array = (typedArray, is_little_endian = true) => {\r\n    let total_count = 0;\r\n    const length = typedArray.length;\r\n    if (length === 0) return total_count; // Edge case: Empty array\r\n    const view = new DataView(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength);\r\n    // Process full 32-bit (4-byte) chunks\r\n    const chunks = length >>> 2; // Integer division by 4\r\n    for (let i = 0; i < chunks; i++) {\r\n        const value = view.getUint32(i << 2, is_little_endian); // Read each 32-bit chunk\r\n        total_count += pop_cnt(value); // Count the '1' bits in this chunk\r\n    }\r\n    // Handle any remaining bytes (less than 32 bits)\r\n    const remaining_start_index = chunks << 2; // Start index for remaining bytes\r\n    const remaining_length = length - remaining_start_index; // Remaining bytes count\r\n    for (let i = 0; i < remaining_length; i++) {\r\n        const byte = view.getUint8(remaining_start_index + i); // Read each remaining byte\r\n        // Count '1' bits manually for each byte\r\n        total_count += (byte & 1) + ((byte >> 1) & 1) + ((byte >> 2) & 1) + ((byte >> 3) & 1) +\r\n                        ((byte >> 4) & 1) + ((byte >> 5) & 1) + ((byte >> 6) & 1) + ((byte >> 7) & 1);\r\n    }\r\n    return total_count;\r\n};\r\n\r\nconst count_1s = pop_cnt_typed_array;\r\n\r\n\r\n// const iterate 1 positions.\r\n\r\n// each_1_index\r\n\r\n\r\nclass BitwiseTester {\r\n    constructor(ta = null) {\r\n        // Create a default TypedArray if none is provided.\r\n        if (ta) {\r\n            this.ta = ta;\r\n        } else {\r\n            // Create a default TypedArray with Fibonacci-influenced pattern\r\n            this.ta = new Uint8Array([0, 1, 1, 2, 3, 5, 8, 13]);\r\n        }\r\n    }\r\n\r\n    // Testing shift_typed_array_right using string representation\r\n    test_shift_typed_array_right() {\r\n        const result = right_shift_32bit_with_carry(this.ta);\r\n    \r\n        // Convert the original TypedArray to a binary string representation\r\n        const binary_ta1 = to_binary_string(this.ta);\r\n        // Convert the result TypedArray to a binary string representation\r\n        const binary_ta2 = to_binary_string(result);\r\n    \r\n        // Remove the first bit from ta1 and add a 0 to the end to simulate the right shift by 1\r\n        const expected_shift = '0' + binary_ta1.slice(0, -1);\r\n    \r\n        // Check if the expected shifted binary string matches the actual result\r\n        if (expected_shift === binary_ta2) {\r\n            return {\r\n                passed: true,\r\n                messages: [\"Test Passed: The shift operation works correctly.\"]\r\n            };\r\n        } else {\r\n            return {\r\n                passed: false,\r\n                messages: [`Test Failed: The shifted result does not match the expected output. Expected: ${expected_shift}, Got: ${binary_ta2}`]\r\n            };\r\n        }\r\n    }\r\n\r\n    // Testing xor_typed_arrays (unchanged for context)\r\n    test_xor_typed_arrays() {\r\n        const ta2 = new Uint8Array(this.ta.length).fill(1); // Example second array for XOR\r\n        const result = xor_typed_arrays(this.ta, ta2);\r\n        \r\n        // Create string representations\r\n        let resultBinary = '';\r\n        for (const byte of result) {\r\n            resultBinary += byte.toString(2).padStart(8, '0');\r\n        }\r\n        \r\n        let expectedBinary = '';\r\n        for (let i = 0; i < this.ta.length; i++) {\r\n            expectedBinary += (this.ta[i] ^ ta2[i]).toString(2).padStart(8, '0');\r\n        }\r\n\r\n        const passed = resultBinary === expectedBinary;\r\n        const messages = [];\r\n        \r\n        if (!passed) {\r\n            messages.push('XOR test failed. Expected: ' + expectedBinary + ', Got: ' + resultBinary);\r\n        } else {\r\n\r\n        }\r\n\r\n        return {\r\n            passed,\r\n            messages,\r\n        };\r\n    }\r\n\r\n    // Method to run all tests (unchanged for context)\r\n    test() {\r\n        const results = [];\r\n        let count_passed = 0;\r\n        let count_failed = 0;\r\n\r\n        const shift_test_result = this.test_shift_typed_array_right();\r\n        results.push(shift_test_result);\r\n        if (shift_test_result.passed) count_passed++;\r\n        else count_failed++;\r\n\r\n        const xor_test_result = this.test_xor_typed_arrays();\r\n        results.push(xor_test_result);\r\n        if (xor_test_result.passed) count_passed++;\r\n        else count_failed++;\r\n\r\n        return {\r\n            passed: count_failed === 0,\r\n            count_passed,\r\n            count_failed,\r\n            results,\r\n        };\r\n    }\r\n}\r\n\r\n\r\nif (require.main === module) {\r\n    const tester = new BitwiseTester();\r\n    const test_res = tester.test();\r\n    console.log('test_res', JSON.stringify(test_res, null, 2));\r\n\r\n\r\n}\r\n\r\nconst get_ta_bits_that_differ_from_previous_as_1s = (ta_source, bits_per_row, ta_dest = new ta_source.constructor(ta_source.length), copy_original_x0_values = false) => {\r\n    // no wrapping\r\n\r\n    const rshifted = right_shift_32bit_with_carry(ta_source);\r\n    xor_typed_arrays(ta_source, rshifted, ta_dest);\r\n\r\n\r\n    if (copy_original_x0_values) {\r\n        copy_row_beginning_bits(ta_source, bits_per_row, ta_dest);\r\n    } else {\r\n        // Set row beginning bits to 0 as they do not differ from the (theoretical) pixel before them that is not a pixel with a different color because it is a virtual pixel without a different color.\r\n\r\n        set_row_beginning_bits_to_0(ta_dest);\r\n\r\n    }\r\n    \r\n    return ta_dest;\r\n\r\n}\r\n\r\nconst get_bit = (ta, i) => (ta[i >> 3] >> (7 - (i & 0b111))) & 1;\r\n\r\n// Exports\r\nmodule.exports = {\r\n    right_shift_32bit_with_carry,\r\n    xor_typed_arrays,\r\n    each_1_index,\r\n    count_1s,\r\n    pop_cnt,\r\n    pop_cnt_typed_array,\r\n    copy_row_beginning_bits,\r\n    get_ta_bits_that_differ_from_previous_as_1s,\r\n    get_bit,\r\n    fast_find_next_set_ta_bit\r\n};\r\n", "\r\n\r\n\r\nconst is_integer_typed_array = (obj) => {\r\n    if (ArrayBuffer.isView(obj)) {\r\n        return (\r\n            obj instanceof Int8Array ||\r\n            obj instanceof Uint8Array ||\r\n            obj instanceof Int16Array ||\r\n            obj instanceof Uint16Array ||\r\n            obj instanceof Int32Array ||\r\n            obj instanceof Uint32Array ||\r\n            obj instanceof BigInt64Array ||\r\n            obj instanceof BigUint64Array\r\n        );\r\n    }\r\n    return false;\r\n};\r\n\r\n\r\nconst ensure_polygon_is_ta = polygon => {\r\n    if (is_integer_typed_array(polygon)) {\r\n        // Length must be divisible by 2.\r\n\r\n        if (polygon.length % 2 === 0) {\r\n            return polygon;\r\n        } else {\r\n            throw 'ta must have even number length, being [x, y] pairs';\r\n        }\r\n    } else {\r\n        return new Uint32Array(polygon.flat());\r\n    }\r\n}\r\n\r\n\r\n// Polygon really should be as a ta.\r\n\r\nconst draw_polygon_outline_to_ta_1bipp = (ta, img_width, polygon) => {\r\n    polygon = ensure_polygon_is_ta(polygon);\r\n\r\n\r\n    // Then go through the points of the polygon....\r\n    //   Connect the dots.\r\n\r\n    const num_points = polygon.length >>> 1;\r\n    //console.log('num_points', num_points);\r\n    // then go from point 1 (not 0), looking back at the prev.\r\n\r\n    let r = 0, x = polygon[r++], y = polygon[r++], next_x, next_y;\r\n    let dx, dy, sx, sy, err, e2;\r\n\r\n    //throw 'stop';\r\n\r\n    // set_pixel_on function.....\r\n\r\n    const set_pixel_on = (x, y) => {\r\n        const idx_bit = (y * img_width) + x;\r\n        const byte = idx_bit >> 3;\r\n        const bit = (idx_bit & 0b111);\r\n        ta[byte] |= (128 >> bit);\r\n    }\r\n\r\n\r\n\r\n    for (let p = 1; p < num_points; p++) {\r\n        // And compare with the previous....\r\n\r\n        next_x = polygon[r++]; next_y = polygon[r++];\r\n\r\n        dx = Math.abs(next_x - x);\r\n        dy = Math.abs(next_y - y);\r\n        sx = (x < next_x) ? 1 : -1;\r\n        sy = (y < next_y) ? 1 : -1;\r\n        err = dx - dy;\r\n\r\n        while (true) {\r\n            //this.set_pixel_1bipp([x, y], 1);\r\n            set_pixel_on(x, y);\r\n\r\n            if (x === next_x && y === next_y) {\r\n                break;\r\n            }\r\n\r\n            e2 = 2 * err;\r\n            if (e2 > -dy) {\r\n                err -= dy;\r\n                x += sx;\r\n            }\r\n\r\n            if (e2 < dx) {\r\n                err += dx;\r\n                y += sy;\r\n            }\r\n        }\r\n        // Draw the line between them....\r\n\r\n        x = next_x; y = next_y;\r\n    }\r\n\r\n    next_x = polygon[0]; next_y = polygon[1];\r\n\r\n    dx = Math.abs(next_x - x);\r\n    dy = Math.abs(next_y - y);\r\n    sx = (x < next_x) ? 1 : -1;\r\n    sy = (y < next_y) ? 1 : -1;\r\n    err = dx - dy;\r\n\r\n    while (true) {\r\n        //this.set_pixel_1bipp([x, y], 1);\r\n        set_pixel_on(x, y);\r\n\r\n        if (x === next_x && y === next_y) {\r\n            break;\r\n        }\r\n\r\n        e2 = 2 * err;\r\n        if (e2 > -dy) {\r\n            err -= dy;\r\n            x += sx;\r\n        }\r\n\r\n        if (e2 < dx) {\r\n            err += dx;\r\n            y += sy;\r\n        }\r\n    }\r\n\r\n    return ta;\r\n\r\n\r\n\r\n    // And have an inline drawing function here?\r\n    //   Or at least re-expressing the set_pixel_on function.\r\n\r\n    // converting [x, y] <=> pixel_index\r\n\r\n    // draw line function....\r\n    //   copy from before.\r\n\r\n\r\n\r\n\r\n}\r\n\r\nconst remove_duplicates = (ta) => {\r\n    // Step 1: Sort the array by y-values, then by x-values if y's are the same\r\n    quicksort_points(ta); // Assumes quicksort_points is defined as in the previous response\r\n\r\n    const numRecords = ta.length >>> 1;\r\n\r\n    // Step 2: Count unique entries\r\n    let uniqueCount = 0;\r\n    let prev_x, prev_y;\r\n\r\n    for (let i = 0; i < numRecords; i++) {\r\n        const x = ta[i * 2];\r\n        const y = ta[i * 2 + 1];\r\n\r\n        if (i === 0 || x !== prev_x || y !== prev_y) {\r\n            uniqueCount++;\r\n            prev_x = x;\r\n            prev_y = y;\r\n        }\r\n    }\r\n\r\n    // Step 3: Create a new array with the size of unique entries\r\n    const result = new ta.constructor(uniqueCount * 2);\r\n\r\n    // Step 4: Copy unique entries to the result array\r\n    let index = 0;\r\n    prev_x = prev_y = undefined; // Reset previous values for copying loop\r\n\r\n    for (let i = 0; i < numRecords; i++) {\r\n        const x = ta[i * 2];\r\n        const y = ta[i * 2 + 1];\r\n\r\n        if (i === 0 || x !== prev_x || y !== prev_y) {\r\n            result[index * 2] = x;\r\n            result[index * 2 + 1] = y;\r\n            index++;\r\n\r\n            prev_x = x;\r\n            prev_y = y;\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nconst quicksort_points = (ta) => {\r\n    const partition = (left, right, pivotIndex) => {\r\n        const pivotY = ta[pivotIndex * 2 + 1]; // Pivot y value\r\n        const pivotX = ta[pivotIndex * 2]; // Pivot x value\r\n\r\n        // Swap pivot with the rightmost element\r\n        swap(pivotIndex, right);\r\n\r\n        let storeIndex = left;\r\n\r\n        for (let i = left; i < right; i++) {\r\n            const currentY = ta[i * 2 + 1];\r\n            const currentX = ta[i * 2];\r\n            \r\n            // Compare y-values first, then x-values if y-values are the same\r\n            if (currentY < pivotY || (currentY === pivotY && currentX < pivotX)) {\r\n                swap(i, storeIndex);\r\n                storeIndex++;\r\n            }\r\n        }\r\n\r\n        // Move pivot to its final place\r\n        swap(storeIndex, right);\r\n\r\n        return storeIndex;\r\n    };\r\n\r\n    const quicksort_recursive = (left, right) => {\r\n        if (left < right) {\r\n            const pivotIndex = Math.floor((left + right) / 2); // Choose a middle pivot\r\n            const newPivot = partition(left, right, pivotIndex);\r\n\r\n            // Recursively sort the subarrays\r\n            quicksort_recursive(left, newPivot - 1);\r\n            quicksort_recursive(newPivot + 1, right);\r\n        }\r\n    };\r\n\r\n    const swap = (i, j) => {\r\n        if (i === j) return;\r\n\r\n        // Swap x values\r\n        const tempX = ta[i * 2];\r\n        ta[i * 2] = ta[j * 2];\r\n        ta[j * 2] = tempX;\r\n\r\n        // Swap y values\r\n        const tempY = ta[i * 2 + 1];\r\n        ta[i * 2 + 1] = ta[j * 2 + 1];\r\n        ta[j * 2 + 1] = tempY;\r\n    };\r\n\r\n    const numRecords = ta.length >>> 1; // Number of records (each record has two values)\r\n\r\n    quicksort_recursive(0, numRecords - 1);\r\n    return ta;\r\n};\r\n\r\nconst calc_polygon_stroke_points_x_y = polygon => {\r\n    polygon = ensure_polygon_is_ta(polygon);\r\n\r\n    const arr_stroke_points = [];\r\n\r\n    const num_points = polygon.length >>> 1;\r\n    //console.log('num_points', num_points);\r\n    // then go from point 1 (not 0), looking back at the prev.\r\n\r\n    let r = 0, x = polygon[r++], y = polygon[r++], next_x, next_y;\r\n    let dx, dy, sx, sy, err, e2;\r\n\r\n    //throw 'stop';\r\n\r\n    // set_pixel_on function.....\r\n\r\n    // and go back further in previousness checks?\r\n    let prev_x, prev_y;\r\n\r\n    const set_pixel_on = (x, y) => {\r\n        if (!(prev_x === x && prev_y === y)) {\r\n            arr_stroke_points.push(x, y);\r\n        }\r\n        // But not if it is repeated from previous????\r\n        prev_x = x; prev_y = y;\r\n        \r\n    }\r\n\r\n\r\n\r\n    for (let p = 1; p < num_points; p++) {\r\n        // And compare with the previous....\r\n\r\n        next_x = polygon[r++]; next_y = polygon[r++];\r\n\r\n        dx = Math.abs(next_x - x);\r\n        dy = Math.abs(next_y - y);\r\n        sx = (x < next_x) ? 1 : -1;\r\n        sy = (y < next_y) ? 1 : -1;\r\n        err = dx - dy;\r\n\r\n        while (true) {\r\n            //this.set_pixel_1bipp([x, y], 1);\r\n            set_pixel_on(x, y);\r\n\r\n            if (x === next_x && y === next_y) {\r\n                break;\r\n            }\r\n\r\n            e2 = 2 * err;\r\n            if (e2 > -dy) {\r\n                err -= dy;\r\n                x += sx;\r\n            }\r\n\r\n            if (e2 < dx) {\r\n                err += dx;\r\n                y += sy;\r\n            }\r\n        }\r\n        // Draw the line between them....\r\n\r\n        x = next_x; y = next_y;\r\n\r\n    }\r\n\r\n    next_x = polygon[0]; next_y = polygon[1];\r\n\r\n    dx = Math.abs(next_x - x);\r\n    dy = Math.abs(next_y - y);\r\n    sx = (x < next_x) ? 1 : -1;\r\n    sy = (y < next_y) ? 1 : -1;\r\n    err = dx - dy;\r\n\r\n    while (true) {\r\n        //this.set_pixel_1bipp([x, y], 1);\r\n        set_pixel_on(x, y);\r\n\r\n        if (x === next_x && y === next_y) {\r\n            break;\r\n        }\r\n\r\n        e2 = 2 * err;\r\n        if (e2 > -dy) {\r\n            err -= dy;\r\n            x += sx;\r\n        }\r\n\r\n        if (e2 < dx) {\r\n            err += dx;\r\n            y += sy;\r\n        }\r\n    }\r\n\r\n    const res = remove_duplicates(quicksort_points(new Uint16Array(arr_stroke_points)));\r\n    return res;\r\n\r\n\r\n}\r\n\r\n\r\nmodule.exports = {\r\n    ensure_polygon_is_ta,\r\n    draw_polygon_outline_to_ta_1bipp,\r\n    calc_polygon_stroke_points_x_y\r\n}", "\r\n\r\nconst copy = require('./ta-math/copy');\r\nconst info = require('./ta-math/info');\r\nconst read = require('./ta-math/read');\r\nconst transform = require('./ta-math/transform');\r\nconst write = require('./ta-math/write');\r\n\r\nconst bitwise = require('./ta-math/bitwise');\r\n\r\nconst {\r\n    right_shift_32bit_with_carry,\r\n    xor_typed_arrays,\r\n    each_1_index,\r\n    count_1s,\r\n    get_ta_bits_that_differ_from_previous_as_1s,\r\n    get_bit,\r\n    fast_find_next_set_ta_bit\r\n} = bitwise;\r\n\r\n\r\nconst draw = require('./ta-math/draw');\r\n\r\nconst {draw_polygon_outline_to_ta_1bipp, ensure_polygon_is_ta, calc_polygon_stroke_points_x_y} = draw;\r\n    \r\nconst {copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, copy_ta_byte_range, unaligned_copy_rect_1to4bypp,\r\n    dest_aligned_copy_rect_1to4bypp} = copy;\r\n\r\nconst {overlapping_bounds} = info;\r\n\r\nconst {fill_solid_rect_by_bounds} = write;\r\n\r\nconst {read_1x2_rect, read_2x1_rect, read_2x2_rect, read_px} = read;\r\nconst {resize_ta_colorspace} = transform;\r\n\r\n\r\nmodule.exports = {\r\n\r\n    draw_polygon_outline_to_ta_1bipp,\r\n    ensure_polygon_is_ta,\r\n\r\n    right_shift_32bit_with_carry,\r\n    xor_typed_arrays,\r\n    each_1_index,\r\n    count_1s,\r\n    get_ta_bits_that_differ_from_previous_as_1s,\r\n    calc_polygon_stroke_points_x_y,\r\n    get_bit,\r\n    fast_find_next_set_ta_bit,\r\n\r\n\r\n\r\n    draw,\r\n    copy: copy,\r\n    info: info,\r\n    read: read,\r\n    transform: transform,\r\n    write: write,\r\n    bitwise,\r\n\r\n\r\n    overlapping_bounds: overlapping_bounds,\r\n    copy_rect_to_same_size_8bipp: copy_rect_to_same_size_8bipp,\r\n    copy_rect_to_same_size_24bipp: copy_rect_to_same_size_24bipp,\r\n    copy_ta_byte_range: copy_ta_byte_range,\r\n    unaligned_copy_rect_1to4bypp: unaligned_copy_rect_1to4bypp,\r\n    dest_aligned_copy_rect_1to4bypp: dest_aligned_copy_rect_1to4bypp,\r\n    fill_solid_rect_by_bounds: fill_solid_rect_by_bounds,\r\n    read_1x2_rect: read_1x2_rect,\r\n    read_2x1_rect: read_2x1_rect,\r\n    read_2x2_rect: read_2x2_rect,\r\n    read_px: read_px,\r\n    read_pixel: read_px,\r\n\r\n    resize_ta_colorspace: resize_ta_colorspace//,\r\n    //override: override,\r\n\r\n    //get_instance: get_instance\r\n}", "\r\nconst ta_math = require('./ta-math');\r\n\r\n\r\nconst {fill_solid_rect_by_bounds} = ta_math;\r\n\r\n\r\n// May want a simpler / more general method of composing polygons / shapes on a 1bipp pixelbuffer - and then writing that 1bipp image to the\r\n// destination in the correct color.\r\n\r\n// 3bipp and 4bipp would definitely be useful for a variety of uses.\r\n// 8 color, 16 color.\r\n\r\n// Painting polygons and the logic for polygons could help.\r\n//  As in, which pixels are inside or outside a polygon.\r\n//   Rendering the edges and doing flood fill could work well.\r\n\r\n//   Flood fill within 1 bipp should be powerful in many situations.\r\n\r\n\r\n// Polygon drawing:\r\n//  Filled polygon composition:\r\n//  Need to render the edges, and flood fill the inside.\r\n\r\n// Maybe 2bipp would be more convenient in some ways?\r\n\r\n// Render the edges.\r\n//  Copy that image\r\n//  Flood fill from the outside\r\n//   Invert that image\r\n//  Copy the edges image onto that inverted image (showing the inner area?)\r\n\r\n// Or better to geometrically get points inside the image?\r\n//  Flood fill is fast though.\r\n\r\n// Fast 1bipp polygon ops should be useful overall.\r\n//  Like equation masks.\r\n\r\n// Maybe better to do ops more focused on countries to start with?\r\n//  Though generalised polygon algorithms will help too.\r\n\r\n//  And could specify them with pixel deltas too.\r\n\r\n\r\n\r\n// core.draw_polygon(points, options)\r\n//  Drawing a filled polygon could mean compositing it in its own new pixelbuffer\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Pixel_Buffer_Painter {\r\n    constructor(spec) {\r\n        const pb = this.pb = spec.pb || spec.pixel_buffer\r\n\r\n\r\n\r\n        /*\r\n        // Draw line\r\n        // pos1, pos2, color\r\n\r\n        // And weight???\r\n        this.line = (pos1, pos2, color) => {\r\n\r\n        }\r\n        */\r\n\r\n        this.rect = (pos, size, color) => {\r\n            // call the lower level ta_math function.\r\n\r\n            // bounds_from_pos_and_size?\r\n            //  calc_bounds(pos, size);\r\n\r\n            //console.log('paint rect [pos, size, color]', [pos, size, color]);\r\n            \r\n\r\n            const ta_bounds = new Int16Array(4);\r\n            ta_bounds[0] = pos[0];\r\n            ta_bounds[1] = pos[1];\r\n            ta_bounds[2] = pos[0] + size[0];\r\n            ta_bounds[3] = pos[1] + size[1];\r\n\r\n            // const fill_solid_rect_by_bounds = (ta_dest, bypr_dest, ta_bounds, bipp, color)\r\n\r\n            fill_solid_rect_by_bounds(pb.ta, pb.bypr, ta_bounds, pb.bipp, color);\r\n\r\n\r\n\r\n            return this;  // return the painter.   paint.rect(...).rect(...) etc.\r\n\r\n\r\n\r\n        }\r\n    }\r\n    //rect()\r\n}\r\n\r\n\r\nmodule.exports = Pixel_Buffer_Painter;", "\r\nconst lang = require('lang-mini');\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\nconst maxui64 = ~0n;\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst oext = require('obext');\r\nconst {ro, prop} = oext;\r\nconst Typed_Array_Binary_Read_Write = require('./Typed_Array_Binary_Read_Write');\r\nlet ta_math = require('./ta-math')\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp} = ta_math;\r\n\r\n// Core structures first?\r\n\r\n// inner core\r\n\r\n\r\n\r\nclass Pixel_Buffer_Core_Inner_Structures {\r\n    constructor(spec) {\r\n        if (spec instanceof Pixel_Buffer_Core_Inner_Structures) {\r\n            spec = {\r\n                bits_per_pixel: spec.bits_per_pixel,\r\n                size: spec.size,\r\n                ta: spec.ta\r\n            }\r\n        }\r\n        if (spec.window_to) {\r\n            spec.bits_per_pixel = spec.window_to.bits_per_pixel;\r\n        }\r\n        const pos = new Int16Array(2);\r\n        const size = new Int16Array(2);\r\n        let ta; // flexible, can be redefined? Can still make read-only in userland.\r\n        ro(this, 'ta', () => {\r\n            return ta;\r\n        });\r\n        ro(this, 'buffer', () => {\r\n            return ta;\r\n        });\r\n        const ta_bpp = new Uint8Array(2);\r\n        ta_bpp[1] = 8; // byte to bit multiplier. will stay as 8.\r\n        const _24bipp_to_8bipp = () => {\r\n            const old_ta = ta;\r\n            const new_ta = ta = new Uint8Array(this.num_px);\r\n            const l_read = old_ta.length;\r\n            let iby_read = 0, iby_write = 0;\r\n            while (iby_read < l_read) {\r\n                new_ta[iby_write++] = Math.round((old_ta[iby_read++] + old_ta[iby_read++] + old_ta[iby_read++]) / 3);\r\n            }\r\n        }\r\n        const _change_bipp_inner_update = (old_bipp, new_bipp) => {\r\n            if (old_bipp === 24) {\r\n                if (new_bipp === 8) {\r\n                    _24bipp_to_8bipp();\r\n                } else {\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                }\r\n            } else {\r\n                console.trace();\r\n                throw 'NYI';\r\n            }\r\n        }\r\n        const def_bipp = {\r\n            get() { return ta_bpp[0]; },\r\n            set(value) { \r\n                console.log('value', value);\r\n                const old_bipp = ta_bpp[0];\r\n                ta_bpp[0] = value;\r\n                _change_bipp_inner_update(old_bipp, ta_bpp[0]);\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        }\r\n        Object.defineProperty(this, 'bits_per_pixel', def_bipp);\r\n        Object.defineProperty(this, 'bipp', def_bipp);\r\n        const def_bypp = {\r\n            get() { return ta_bpp[0] / 8; },\r\n            set(value) { \r\n                const old_bipp = ta_bpp[0];\r\n                ta_bpp[0] = value * 8;\r\n                _change_bipp_inner_update(old_bipp, ta_bpp[0]);\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        }\r\n        Object.defineProperty(this, 'bytes_per_pixel', def_bypp);\r\n        Object.defineProperty(this, 'bypp', def_bypp);\r\n        const def_bypr = {\r\n            get() {\r\n                return size[0] * ta_bpp[0] / 8;\r\n            }\r\n        }\r\n        Object.defineProperty(this, 'bytes_per_row', def_bypr);\r\n        Object.defineProperty(this, 'bypr', def_bypr);\r\n        Object.defineProperty(this, 'pos', {\r\n            get() { return pos; },\r\n            set(value) {\r\n                if (value instanceof Int16Array) {\r\n                    if (value.length === 2) {\r\n                        pos[0] = value[0];\r\n                        pos[1] = value[1];\r\n                    }\r\n                }\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        const pos_bounds = new Int16Array(4);\r\n        const pos_center = new Int16Array(2);\r\n        const edge_offsets_from_center = new Int16Array(4);\r\n        ro(this, 'pos_center', () => pos_center);\r\n        ro(this, 'edge_offsets_from_center', () => edge_offsets_from_center);\r\n        Object.defineProperty(this, 'pos_bounds', {\r\n            get() {\r\n                return pos_bounds; \r\n            },\r\n            set(value) {\r\n                const tv = tf(value);\r\n                if (tv === 'a') {\r\n                    if (value.length === 4) {\r\n                        pos_bounds.set(value);\r\n                    } else {\r\n                        throw 'Expected Array with .length 4, value.length: ' + value.length;\r\n                    }\r\n                } else {\r\n                    console.trace();\r\n                    console.log('pos_bounds set tv', tv);\r\n                    throw 'Expected Array';\r\n                }\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        const minus_pos = new Int16Array(2);\r\n        Object.defineProperty(this, 'minus_pos', {\r\n            get() {\r\n                if (pos) {\r\n                    minus_pos[0] = pos[0] * -1;\r\n                    minus_pos[1] = pos[1] * -1;\r\n                    return minus_pos;\r\n                }\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        Object.defineProperty(this, 'size', {\r\n            get() { return size; },\r\n            set(value) {\r\n                if (value instanceof Int16Array) {\r\n                    if (value.length === 2) {\r\n                        size[0] = value[0];\r\n                        size[1] = value[1];\r\n                    }\r\n                } else {\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                }\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        if (spec instanceof Pixel_Pos_List) {\r\n            throw 'NYI - change to 1bipp';\r\n            const ppl = spec;\r\n            const bounds = ppl.bounds;\r\n            const ppl_size = new Uint16Array(2);\r\n            ppl_size[0] = bounds[2] - bounds[0];\r\n            ppl_size[1] = bounds[3] - bounds[1];\r\n            this.bits_per_pixel = 8;\r\n            const bpp = this.bytes_per_pixel = 1;\r\n            this.size = new Uint16Array([ppl_size[0] + 4, ppl_size[1] + 4]);\r\n            this.pos = new Int16Array([bounds[0], bounds[1]]);\r\n            const bpr = this.bytes_per_row = bpp * this.size[0];\r\n            const buf = this.ta = this.buffer = new Uint8ClampedArray(this.size[0] * this.size[1]);\r\n            const l = buf.length;\r\n            for (var c = 0; c < l; c++) buf[c] = 255;\r\n            ppl.each_pixel(pixel_pos => {\r\n                buf[(bpr * (pixel_pos[1] - bounds[1])) + (pixel_pos[0] - bounds[0])] = 0;\r\n            });\r\n        } else {\r\n            if (spec.buffer) {\r\n                if (spec.buffer instanceof Buffer) {\r\n                    ta = new Uint8ClampedArray(spec.buffer.buffer);\r\n                } else {\r\n                    ta = spec.buffer;\r\n                }\r\n            }\r\n            if (spec.ta) {\r\n                ta = spec.ta;\r\n            }\r\n            if (spec.size) {\r\n                size[0] = spec.size[0];\r\n                size[1] = spec.size[1];\r\n            } else {\r\n                throw 'Expected: size [x, y] property in the Pixel_Buffer_Core specification';\r\n            }\r\n            if (spec.bytes_per_pixel && !spec.bits_per_pixel) spec.bits_per_pixel = spec.bytes_per_pixel * 8;\r\n            spec.bits_per_pixel = spec.bits_per_pixel || 32;\r\n            if (spec.bits_per_pixel) {\r\n                if (spec.bits_per_pixel != 1 && spec.bits_per_pixel != 8 && spec.bits_per_pixel != 24 && spec.bits_per_pixel != 32) {\r\n                    console.log('spec.bits_per_pixel', spec.bits_per_pixel);\r\n                    console.trace();\r\n                    throw 'Invalid bits_per_pixel value of ' + spec.bits_per_pixel + ', must be 8, 24 or 32, default is 32.';\r\n                } else {\r\n                    // bits per row...\r\n\r\n\r\n                    //   but there could be some kind of round to 64 bit row alignment for 1bipp.\r\n\r\n                    \r\n\r\n\r\n                    ta_bpp[0] = spec.bits_per_pixel;\r\n                }\r\n            }\r\n            /*\r\n            const bytes_per_pixel = this.bytes_per_pixel = this.bits_per_pixel / 8;\r\n            this.bytes_per_row = bytes_per_pixel * this.size[0];\r\n            */\r\n\r\n            let auto_adjust_ta_length_to_multiple_of_8 = true;\r\n            //    if it would be tiny anyway, don't.\r\n\r\n\r\n\r\n            if (size && !this.buffer) {\r\n                //ta = new Uint8ClampedArray(Math.ceil((ta_bpp[0] / 8) * this.size[0] * this.size[1]));\r\n\r\n                this.bits_per_row = size[0] * this.bits_per_pixel;\r\n\r\n                let proposed_ta_length = Math.ceil((ta_bpp[0] / 8) * (size[0] * size[1]));\r\n\r\n                if (auto_adjust_ta_length_to_multiple_of_8) {\r\n                    const r8 = proposed_ta_length % 8;\r\n                    if (r8 > 0) {\r\n                        proposed_ta_length += (8 - r8);\r\n                    }\r\n                }\r\n                \r\n                ta = new Uint8Array(proposed_ta_length);\r\n            }\r\n            if (spec.color) {\r\n                this.color_whole(spec.color);\r\n            }\r\n        }\r\n        ro(this, 'meta', () => {\r\n            return {\r\n                size: this.size,\r\n                bits_per_pixel: this.bits_per_pixel,\r\n                bytes_per_pixel: this.bytes_per_pixel,\r\n                bytes_per_row: this.bytes_per_row\r\n            }\r\n        });\r\n        if (spec.window_to || spec.source || spec.window_to_source) {\r\n            pb_source = spec.window_to || spec.source || spec.window_to_source;\r\n            const log_info = () => {\r\n                console.log('Pixel_Buffer_Core (or subclass) needs to act as a window to another Pixel Buffer.')\r\n                console.log('pb_source', pb_source);\r\n                console.log('pb_source.size', pb_source.size);\r\n                console.log('spec.pos', spec.pos);\r\n                console.log('spec.pos_center', spec.pos_center);\r\n                console.log('this.pos', this.pos);\r\n                console.log('this.pos_my_center_within_source', this.pos_my_center_within_source);\r\n                console.log('spec', spec);\r\n            }\r\n        }\r\n        if (spec.pos_bounds) {\r\n            this.pos_bounds = spec.pos_bounds;\r\n        }\r\n        this.move = ta_2d_vector => {\r\n            pos[0] += ta_2d_vector[0];\r\n            pos[1] += ta_2d_vector[1];\r\n            if (this.source) {\r\n                this.copy_from_source();\r\n            }\r\n        }\r\n        this.each_pos_within_bounds = (callback) => {\r\n            const has_source = !!this.source;\r\n            for (pos[1] = pos_bounds[1]; pos[1] < pos_bounds[3]; pos[1] ++) {\r\n                for (pos[0] = pos_bounds[0]; pos[0] < pos_bounds[2]; pos[0] ++) {\r\n                    if (has_source) this.copy_from_source();\r\n                    callback();\r\n                }\r\n            }\r\n        }\r\n        this.move_next_px = () => {\r\n            const source_size = this.source.size;\r\n            if (pos[0] + size[0] < source_size[0]) {\r\n                pos[0]++;\r\n            } else {\r\n                if (pos[1] + size[1] < source_size[1]) {\r\n                    pos[0] = 0;\r\n                    pos[1]++;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n            if (this.source) {\r\n                this.copy_from_source();\r\n            }\r\n            return pos;\r\n        }\r\n        \r\n        /*\r\n        ro(this, 'bytes_per_row', () => {\r\n            return this.size[0] * this.bytes_per_pixel;\r\n        });\r\n        */\r\n        this.tabrw = new Typed_Array_Binary_Read_Write(ta);\r\n        this.dv = this.tabrw.dv;\r\n    }\r\n    \r\n    toString() {\r\n        /*\r\n        size: Uint32Array [ 1024, 576 ],\r\n        bits_per_pixel: 32,\r\n        bytes_per_pixel: 4,\r\n        bytes_per_row: 4096 }\r\n        */\r\n        return JSON.stringify({\r\n            buffer: 'Uint8ClampedArray length ' + this.buffer.length,\r\n            size: this.size,\r\n            bits_per_pixel: this.bits_per_pixel,\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            bytes_per_row: this.bytes_per_row\r\n        });\r\n    }\r\n    /*\r\n    [inspect]() {\r\n        return 'Pixel_Buffer_Core ' + this.toString();\r\n    }\r\n    */\r\n    \r\n    each_pixel_byte_index(cb) {\r\n        const {bipp} = this;\r\n        let ctu = true;\r\n        const stop = () => ctu = false;\r\n\r\n        // .num_pixels????\r\n\r\n        const [w, h] = this.size;\r\n        const num_pixels = w * h;\r\n\r\n        let bit_idx = 0, byte_idx = bit_idx >> 3;\r\n\r\n        for (let c = 0; c < num_pixels; c++) {\r\n\r\n            byte_idx = bit_idx >> 3;\r\n            bc(byte_idx);\r\n\r\n\r\n\r\n        }\r\n    }\r\n    each_px(callback) {\r\n\r\n\r\n        const ta_pos = new Int32Array(2);\r\n\r\n\r\n        const [w, h] = this.size;\r\n        //let x, y;\r\n\r\n        // (pos, color, index) would be good callback format.\r\n        let index = 0;\r\n\r\n        for (ta_pos[1] = 0; ta_pos[1] < h; ta_pos[1]++) {\r\n            for (ta_pos[0] = 0; ta_pos[0] < w; ta_pos[0]++) {\r\n                const color = this.get_pixel(ta_pos);\r\n                //ta_px_value[0] = px;\r\n                callback(ta_pos, color, index++);\r\n            }\r\n        }\r\n    }\r\n    paint_pixel_list(pixel_pos_list, color) {\r\n        pixel_pos_list.each_pixel(pos => {\r\n            this.set_pixel_ta(pos, color);\r\n        });\r\n    }\r\n\r\n    // Maybe a class level that has get and set pixel logic for the different bipps at this level.\r\n\r\n    \r\n\r\n\r\n    get num_px() {\r\n        return this.size[0] * this.size[1];\r\n    }\r\n    get split_rgb_channels() {\r\n        const [bipp, bypp] = [this.bits_per_pixel, this.bytes_per_pixel];\r\n        if (bipp === 24 || bipp === 32) {\r\n            const res = [new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            })]\r\n            const [r, g, b] = res;\r\n            let i_px = 0;\r\n            const num_px = this.num_px;\r\n            let i_byte = 0;\r\n            const [ta_r, ta_g, ta_b] = [r.ta, g.ta, b.ta];\r\n            const ta = this.ta;\r\n            while (i_px < num_px) {\r\n                ta_r[i_px] = ta[i_byte];\r\n                ta_g[i_px] = ta[i_byte + 1];\r\n                ta_b[i_px] = ta[i_byte + 2];\r\n                i_px++;\r\n                i_byte += bypp;\r\n            }\r\n            return res;\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    process(fn) {\r\n        let res = this.clone();\r\n        return fn(this, res);\r\n    }\r\n    /*\r\n    function typedArraysAreEqual(a, b) {\r\nif (a.byteLength !== b.byteLength) return false;\r\nreturn a.every((val, i) => val === b[i]);\r\n}\r\n    */\r\n    equals(other_pixel_buffer) {\r\n        let buf1 = this.ta;\r\n        let buf2 = other_pixel_buffer.ta;\r\n        const other_colorspace = other_pixel_buffer.ta_colorspace;\r\n        const my_colorspace = other_pixel_buffer.ta_colorspace;\r\n        if (my_colorspace.length === other_colorspace.length) {\r\n            if(my_colorspace.every((val, i) => val === other_colorspace[i])) {\r\n                if (buf1.length === buf2.length) {\r\n                    return buf1.every((val, i) => val === buf2[i]);\r\n                } else {\r\n                }\r\n            } else {\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    copy_pixel_pos_list_region(pixel_pos_list, bg_color) {\r\n        let bounds = pixel_pos_list.bounds;\r\n        let size = new Uint16Array([bounds[2] - bounds[0] + 1, bounds[3] - bounds[1] + 1]);\r\n        const res = new this.constructor({\r\n            size: size,\r\n            bytes_per_pixel: this.bytes_per_pixel\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        if (bg_color) {\r\n            res.color_whole(bg_color);\r\n        }\r\n        res.pos = new Int16Array([bounds[0], bounds[1]]);\r\n        pixel_pos_list.each_pixel((pos) => {\r\n            let color = this.get_pixel_ta(pos);\r\n            const target_pos = new Int16Array([(pos[0] - bounds[0]), (pos[1] - bounds[1])]);\r\n            res.set_pixel_ta(target_pos, color);\r\n        });\r\n        return res;\r\n    }\r\n    'blank_copy'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel\r\n        });\r\n        res.buffer.fill(0);\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'clone'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel,\r\n            'buffer': new this.buffer.constructor(this.buffer)\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'add_alpha_channel'() {\r\n        console.log('add_alpha_channel this.bytes_per_pixel', this.bytes_per_pixel);\r\n        if (this.bytes_per_pixel === 3) {\r\n            var res = new this.constructor({\r\n                'size': this.size,\r\n                'bytes_per_pixel': 4\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            /*\r\n            this.each_pixel((x, y, r, g, b) => {\r\n                res.set_pixel(x, y, r, g, b, 255);\r\n            });\r\n            */\r\n            const buf = this.buffer,\r\n                res_buf = res.buffer;\r\n            const px_count = this.size[0] * this.size[1];\r\n            let i = 0,\r\n                ir = 0;\r\n            for (let p = 0; p < px_count; p++) {\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = 255;\r\n            }\r\n            return res;\r\n        }\r\n        if (this.bytes_per_pixel === 4) {\r\n            return this;\r\n        }\r\n    }\r\n}\r\nmodule.exports = Pixel_Buffer_Core_Inner_Structures;\r\nif (require.main === module) {\r\n    const lg = console.log;\r\n    (async() => {\r\n        const run_examples = async() => {\r\n            lg('Begin run examples');\r\n            const examples = [\r\n                async() => {\r\n                    lg('Begin example 0');\r\n                    const pb = new Pixel_Buffer_Core_Reference_Implementations({\r\n                        bits_per_pixel: 1,\r\n                        size: [8, 8]\r\n                    });\r\n                    const ta_pos = new Int16Array(2);\r\n                    ta_pos[0] = 3;\r\n                    ta_pos[1] = 3;\r\n                    pb.set_pixel(ta_pos, 1);\r\n                    lg('End example 0');\r\n                    return pb;\r\n                }\r\n            ]\r\n            const l = examples.length;\r\n            for (var c = 0; c < l; c++) {\r\n                const res_eg = await examples[c]();\r\n                console.log('res_eg ' + c + ':', res_eg);\r\n            };\r\n            lg('End run examples');\r\n        }\r\n        await run_examples();\r\n    })();\r\n}\r\n", "\r\nconst lang = require('lang-mini');\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\nconst maxui64 = ~0n;\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst oext = require('obext');\r\nconst {ro, prop} = oext;\r\nconst Typed_Array_Binary_Read_Write = require('./Typed_Array_Binary_Read_Write');\r\nconst Pixel_Buffer_Painter = require('./pixel-buffer-painter');\r\nlet ta_math = require('./ta-math')\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp} = ta_math;\r\n\r\n// Core structures first?\r\n\r\n// inner core\r\nconst Pixel_Buffer_Core_Inner_Structures = require('./pixel-buffer-0-core-inner-structures');\r\n\r\n\r\nclass Pixel_Buffer_Core_Get_Set_Pixels extends Pixel_Buffer_Core_Inner_Structures{\r\n    constructor(spec) {\r\n        if (spec instanceof Pixel_Buffer_Core_Get_Set_Pixels) {\r\n            spec = {\r\n                bits_per_pixel: spec.bits_per_pixel,\r\n                size: spec.size,\r\n                ta: spec.ta\r\n            }\r\n        }\r\n\r\n        super(spec);\r\n        \r\n    }\r\n    \r\n    'get_pixel_byte_bit_1bipp'(pos) {\r\n        /*\r\n        */\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        return {byte, bit};\r\n    }\r\n    'get_pixel_byte_bit_BE_1bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        return {byte, bit};\r\n    }\r\n    set_pixel_on_1bipp_by_pixel_index(pixel_index) {\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n\r\n    'set_pixel_on_1bipp_xy'(x, y) {\r\n        const pixel_index = y * this.size[0] + x;\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n\r\n    'set_pixel_on_1bipp'(pos) {\r\n        const pixel_index = pos[1] * this.size[0] + pos[0];\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n    set_pixel_off_1bipp_by_pixel_index(pixel_index) {\r\n        this.ta[pixel_index >> 3] &= (~(128 >> (pixel_index & 0b111))) & 255;\r\n    }\r\n    'set_pixel_off_1bipp'(pos) {\r\n        const pixel_idx = pos[1] * this.size[0] + pos[0];\r\n        this.ta[pixel_idx >> 3] &= (~(128 >> (pixel_idx & 0b111))) & 255;\r\n    }\r\n    'set_pixel_1bipp'(pos, color) {\r\n        const idx_bit = (pos[1] * this.size[0]) + pos[0];\r\n        const byte = idx_bit >> 3;\r\n        const bit = (idx_bit & 0b111);\r\n        if (color === 1) {\r\n            this.ta[byte] |= (128 >> bit);\r\n        } else {\r\n            this.ta[byte] &= (~(128 >> bit)) & 255;\r\n        }\r\n    }\r\n    'set_pixel_8bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        this.ta[idx] = color;\r\n    }\r\n    'set_pixel_24bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        let byte = idx * 3;\r\n        this.ta[byte++] = color[0];\r\n        this.ta[byte++] = color[1];\r\n        this.ta[byte] = color[2];\r\n    }\r\n    'set_pixel_32bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        let byte = idx * 4;\r\n        this.ta[byte++] = color[0];\r\n        this.ta[byte++] = color[1];\r\n        this.ta[byte++] = color[2];\r\n        this.ta[byte] = color[3];\r\n    }\r\n    'set_pixel_by_idx_8bipp'(idx, color) {\r\n        const byte = idx;\r\n        this.ta[byte] = color;\r\n    }\r\n    'set_pixel_by_idx_24bipp'(idx, color) {\r\n        const byte = idx * 3;\r\n        this.ta[byte] = color[0];\r\n        this.ta[byte + 1] = color[1];\r\n        this.ta[byte + 2] = color[2];\r\n    }\r\n    'set_pixel_by_idx_32bipp'(idx, color) {\r\n        const byte = idx * 4;\r\n        this.ta[byte] = color[0];\r\n        this.ta[byte + 1] = color[1];\r\n        this.ta[byte + 2] = color[2];\r\n        this.ta[byte + 3] = color[3];\r\n    }\r\n    'set_pixel_by_idx'(idx, color) {\r\n        const a = arguments;\r\n        const l = a.length;\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            return this.set_pixel_by_idx_1bipp(a[0], a[1]);\r\n        } else if (bipp === 8) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_8bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 24) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_24bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 32) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_32bipp(a[0], a[1]));\r\n            }\r\n        }\r\n    }\r\n    'set_pixel'(pos, color) {\r\n        const a = arguments;\r\n        const l = a.length;\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            return(this.set_pixel_1bipp(a[0], a[1]));\r\n        } else if (bipp === 8) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_8bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 24) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_24bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 32) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_32bipp(a[0], a[1]));\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'unsupported bipp: ' + bipp;\r\n        }\r\n    }\r\n    'get_pixel_by_idx_1bipp'(idx) {\r\n        /*\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        */\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        const pow = 128 >> bit;\r\n        return ((this.ta[byte] & pow) === pow) ? 1 : 0;\r\n    }\r\n    'get_pixel_by_idx_8bipp'(idx) {\r\n        const byte = idx;\r\n        return this.ta[byte];\r\n    }\r\n    'get_pixel_by_idx_24bipp'(idx) {\r\n        const byte = idx * 3;\r\n        return this.ta.slice(byte, byte + 3);\r\n    }\r\n    'get_pixel_by_idx_32bipp'(idx) {\r\n        const byte = idx * 4;\r\n        return this.ta.slice(byte, byte + 4);\r\n    }\r\n    'get_pixel_by_idx'(idx) {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 1) {\r\n            return this.get_pixel_by_idx_1bipp(idx);\r\n        } else if (bipp === 8) {\r\n            return this.get_pixel_by_idx_8bipp(idx);\r\n        } else if (bipp === 24) {\r\n            return this.get_pixel_by_idx_24bipp(idx);\r\n        } else if (bipp === 32) {\r\n            return this.get_pixel_by_idx_32bipp(idx);\r\n        } else {\r\n            throw 'Unsupported bipp'\r\n        }\r\n    }\r\n    'get_pixel_1bipp'(pos) {\r\n        const idx = (pos[1] * this.size[0]) + pos[0];\r\n        const byte = idx >> 3;\r\n        return ((this.ta[byte] & 128 >> (idx & 0b111)) !== 0) ? 1 : 0;\r\n    }\r\n    'get_pixel_8bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx;\r\n        return this.ta[byte];\r\n    }\r\n    'get_pixel_24bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx * 3;\r\n        return this.ta.slice(byte, byte + 3);\r\n    }\r\n    'get_pixel_32bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx * 4;\r\n        return this.ta.slice(byte, byte + 4);\r\n    }\r\n    'get_pixel'(pos) {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 1) {\r\n            return this.get_pixel_1bipp(pos);\r\n        } else if (bipp === 8) {\r\n            return this.get_pixel_8bipp(pos);\r\n        } else if (bipp === 24) {\r\n            return this.get_pixel_24bipp(pos);\r\n        } else if (bipp === 32) {\r\n            return this.get_pixel_32bipp(pos);\r\n        } else {\r\n            console.trace();\r\n            throw 'bits per pixels error';\r\n        }\r\n    }\r\n\r\n    // Maybe a class level that has get and set pixel logic for the different bipps at this level.\r\n\r\n    \r\n    \r\n}\r\nmodule.exports = Pixel_Buffer_Core_Get_Set_Pixels;", "/*\r\n    Maybe want an Image class that internally uses both Pixel_Buffer as well as X_Spans.\r\n    Being able to handle multiple modes could be useful.\r\n    Some modes will be more optimal for some operations.\r\n    Drawing X_Spans will be sometimes a lot faster than drawing pixels.\r\n    Then could get the output as a pixel buffer.\r\n    Could keep one specific data structure up-to-date, and then when another representation is needed it renders the image into that\r\n    data structure.\r\n    May want to move some higher level algorithms upwards - ones that could work on top of either image type so long as there are\r\n    lower level functions that do things like set_pixel.\r\n    Could have optimised implementations for some things what work on those data structures.\r\n    Static_X_Spans - Would be a good format to represent a shape. Maybe good format for saving to disk.\r\n    Dynamic_X_Spans - Would be a good format for drawing a shape. Probably good for flood fills and other operations that modify the image.\r\n        Dynamic_X_Spans seems more useful for the moment.\r\n    Pixel_Buffer_Core could possibly use Dynamic_X_Spans when it does a draw_pollygon filled operation.\r\n        The X_Spans idea came about as a way to do faster flood fills.\r\n        A highly optimised Dynamic_X_Spans should be particularly useful for this.\r\n            Flood fills will remove / join together some X Spans.\r\n    Maybe Pixel_Buffer_Enh will use these Dynamic_X_Spans in order to do some things quicker (too)\r\n    Polygon shape drawing seems core in terms of API, but somewhat higher level compared to some other features and algorithms.\r\n    Possibly a Polygon that could draw itself to image data structures would work well.\r\n*/\r\n/*\r\n    1 Small / trivial change\r\n       2 mins going on 10 mins\r\n    2  Small change\r\n       5 mins going on 30 mins\r\n    3  Medium-Small task\r\n       15 mins going on 1.5h\r\n       could be an easier version of a 4 - needs an optimized algorithm to be written and tested, it doesnt require further R&D.\r\n    4\r\n       45 mins going on 4.5(+)h\r\n        as in could be an underestimated 5?\r\n        may require thinking about maths & optimization\r\n    5 Moderate - a few hours\r\n        2 hours if it turns out to be relatively easy\r\n        going on a day\r\n    6\r\n        0.5 days to 3 days\r\n    7   (some level of overhaul or new API design involved)\r\n        1.5 days to 1 week\r\n    8  \r\n        1 week to 3 weeks\r\n    9 Programming / API overhaul\r\n        3 weeks to 6 weeks\r\n    10 Huge overhaul / major rewrite / a medium-large project of its own\r\n        1 month to 3 months\r\n*/\r\n/*\r\nconst _roadmap = {\r\n    '0.0.22': [\r\n        ['pb.bypp = 1 convert to greyscale', 'done', 3, 'Medium small task requiring writing of optimized algorithm']\r\n    ],\r\n    '0.0.23': [\r\n        'Convolutions', \r\n        `\r\n        Task Size and Complexity Measure: 5 changed to 6.5\r\n            Going into a larger properties overhaul - new size 6 or 7\r\n        Rethinking and implementing pos_bounds\r\n            pos_within_source_bounds\r\n        Rename pos\r\n            pos_within_source\r\n            In this case, can't assume all positions are relative to the self pb, so need to be extra explicit in the variable names regarding what they relate to.\r\n        Consider other pos type variables. Explicit names for what they do.\r\n            pos_iteration_within_self\r\n            pos_cursor_within_self\r\n        Better to have more API-based centering, and adjust the central position?\r\n            Possibly not best for convolution, for perf reasons.\r\n            Don't want more calculations done during iteration...?\r\n            Maybe don't need to deal with centering as directly right now?\r\n                Seems useful for convolutions, centering the window of the px is a core part of the convolution logic. Worth having the platform support it as easily as possible.\r\n        new_window\r\n            implemented\r\n        new_centered_window() ???\r\n            NOT doing this for the moment. done new_window\r\n            centered on 0,0.\r\n            center of that window corresponds to a pixel in this window.\r\n            bounds determined...\r\n                does make sense for the moment.\r\n                implement this fn, makes sense for convs right now.\r\n            get_conv_window?\r\n        new_convolved(convolution) - using this.\r\n        `\r\n        ['window view into specific channel?'],\r\n        ['run convolution on 8bipp image?', 'maybe', 'not yet'],\r\n        ['Convolution Class', ],\r\n        ['Bug fix move_next_px, need to use boundary ranges for proper movement of the window within a source', 4, [\r\n            ['cancelled - doing pb.pos_bounds', 'pb.window_movement_bounds', `\r\n                Need to make / finish function\r\n                Considering different types of bounds\r\n            `],\r\n            ['pos_bounds', `\r\n                consider iterate_pos_within_bounds\r\n                just each_pos_px?\r\n                As well as positions, need to properly calculate iteration values and indexes.\r\n                Put these into a typed array, access them through use of a function\r\n            `]\r\n        ]]\r\n    ],\r\n    '0.0.24': [\r\n        'Moving of mathematical code to ta_math where possible and suitable.',\r\n        'Current size: >6000 lines. Can it be brought down to 1000? Still kept v performant?',\r\n        ['new_resized', 'clearly creates a new pb']\r\n    ],\r\n    '0.0.25': [\r\n        'Improvements / optimization to resize',\r\n        'Facilitate usage of C++ acceleration.'\r\n    ]\r\n}\r\n*/\r\nconst lang = require('lang-mini');\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\nconst maxui64 = ~0n;\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst oext = require('obext');\r\nconst {ro, prop} = oext;\r\nconst Typed_Array_Binary_Read_Write = require('./Typed_Array_Binary_Read_Write');\r\nconst Pixel_Buffer_Painter = require('./pixel-buffer-painter');\r\nlet ta_math = require('./ta-math')\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp} = ta_math;\r\n\r\nconst Pixel_Buffer_Core_Get_Set_Pixels = require('./pixel-buffer-1-core-get-set-pixel');\r\n\r\nclass Pixel_Buffer_Core_Draw_Lines extends Pixel_Buffer_Core_Get_Set_Pixels {\r\n    constructor(spec) {\r\n        \r\n        super(spec);\r\n\r\n        \r\n        \r\n        \r\n    }\r\n\r\n    'draw_line'(pos1, pos2, color) {\r\n\r\n        // options would help....\r\n        //  or it could just be color here.\r\n\r\n        // And maybe use different bipp options.\r\n\r\n\r\n        // yes, want to make an optimised 1bipp version. Will use a table of 8 movement offsets.\r\n\r\n        // Maybe a 2 pixel coords ta?\r\n        //   or a Pixel_Pair class????\r\n        //    that extends a typed array\r\n\r\n\r\n        if (this.bits_per_pixel === 1) {\r\n\r\n            // This thing with the array probably slows it down?\r\n            //   Though having such an array available could be better still?\r\n            //     Or array itself will be better with improved optimisation???\r\n\r\n\r\n            let x0 = pos1[0];\r\n            let y0 = pos1[1];\r\n            let x1 = pos2[0];\r\n            let y1 = pos2[1];\r\n\r\n            let dx = Math.abs(x1 - x0);\r\n            let dy = Math.abs(y1 - y0);\r\n            let sx = (x0 < x1) ? 1 : -1;\r\n            let sy = (y0 < y1) ? 1 : -1;\r\n            let err = dx - dy;\r\n\r\n            while (true) {\r\n                //console.log('[x0, y0]', [x0, y0]);\r\n                this.set_pixel_1bipp([x0, y0], color);\r\n\r\n                if (x0 === x1 && y0 === y1) {\r\n                    break;\r\n                }\r\n\r\n                let e2 = 2 * err;\r\n                if (e2 > -dy) {\r\n                    err -= dy;\r\n                    x0 += sx;\r\n                }\r\n\r\n                if (e2 < dx) {\r\n                    err += dx;\r\n                    y0 += sy;\r\n                }\r\n            }\r\n\r\n\r\n            //return this.draw_line_1bipp(new Uint32Array([pos1[0], pos1[1], pos2[0], pos2[1]]));\r\n        } else {\r\n            let x0 = pos1[0];\r\n            let y0 = pos1[1];\r\n            let x1 = pos2[0];\r\n            let y1 = pos2[1];\r\n\r\n            let dx = Math.abs(x1 - x0);\r\n            let dy = Math.abs(y1 - y0);\r\n            let sx = (x0 < x1) ? 1 : -1;\r\n            let sy = (y0 < y1) ? 1 : -1;\r\n            let err = dx - dy;\r\n\r\n            while (true) {\r\n                this.set_pixel([x0, y0], color);\r\n\r\n                if (x0 === x1 && y0 === y1) {\r\n                    break;\r\n                }\r\n\r\n                let e2 = 2 * err;\r\n                if (e2 > -dy) {\r\n                    err -= dy;\r\n                    x0 += sx;\r\n                }\r\n\r\n                if (e2 < dx) {\r\n                    err += dx;\r\n                    y0 += sy;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        \r\n    }\r\n\r\n    \r\n    draw_line_1bipp(ta_pixel_pair, color) {\r\n        const { ta } = this;  // Extract the typed array (ta) from the pixel buffer object\r\n\r\n        let [x0, y0, x1, y1] = ta_pixel_pair,     // Extract x0, y0, x1, y1 from ta_pixel_pair\r\n            bytes_per_row = this.bytes_per_row,   // Access bytes per row from the object\r\n            dx = Math.abs(x1 - x0),               // Calculate dx\r\n            dy = Math.abs(y1 - y0),               // Calculate dy\r\n            sx = (x0 < x1) ? 1 : -1,              // Set step direction for x\r\n            sy = (y0 < y1) ? 1 : -1,              // Set step direction for y\r\n            err = dx - dy, e2;                    // Initialize error value and temporary variable e2\r\n\r\n        while (true) {\r\n            // Calculate the byte index and bit position for (x0, y0)\r\n            const byte_index = (x0 >> 3) + (y0 * bytes_per_row), bit_position = x0 & 7;\r\n\r\n            if (color) {\r\n                ta[byte_index] |= (1 << (7 - bit_position)); // Set the pixel in the typed array\r\n            } else {\r\n                ta[byte_index] &= ~(1 << (7 - bit_position)); // Clear the pixel in the typed array\r\n            }\r\n\r\n            if (x0 === x1 && y0 === y1) break;  // Stop when we reach the end\r\n\r\n            e2 = err << 1;\r\n            if (e2 > -dy) err -= dy, x0 += sx;  // Adjust error and move x\r\n            if (e2 < dx) err += dx, y0 += sy;   // Adjust error and move y\r\n        }\r\n    }\r\n\r\n    'draw_horizontal_line_off_1bipp_inclusive'([x1, x2], y) {\r\n        const {size, ta} = this;\r\n        const number_of_pixels_to_draw = (x2 - x1) + 1;\r\n        if (number_of_pixels_to_draw === 1) {\r\n            const pixel_index = (y * size[0]) + x1;\r\n            ta[pixel_index >> 3] &= (~(128 >> (pixel_index & 0b111))) & 255;\r\n        } else if (number_of_pixels_to_draw === 2) {\r\n            let pixel_index = (y * size[0]) + x1;\r\n            ta[pixel_index >> 3] &= (~(128 >> ((pixel_index & 0b111)))) & 255\r\n            pixel_index++;\r\n            ta[pixel_index >> 3] &= (~(128 >> ((pixel_index & 0b111)))) & 255\r\n            pixel_index++;\r\n        } else {\r\n            const [w] = size;\r\n            const starting_pixel_index = ((y * w) + x1) | 0;\r\n            const ending_pixel_index = starting_pixel_index + (number_of_pixels_to_draw - 1);\r\n            const starting_byte_index = starting_pixel_index >> 3;\r\n            const starting_bit_within_byte_index = (starting_pixel_index & 7);\r\n            const ending_byte_index = ending_pixel_index >> 3;\r\n            const ending_bit_within_byte_index = (ending_pixel_index & 7);\r\n            const bits_from_end_of_byte = 7 - ending_bit_within_byte_index;\r\n            const number_of_bytes_with_any_coverage = (ending_byte_index - starting_byte_index) + 1;\r\n            if (starting_byte_index === ending_byte_index) {\r\n                ta[starting_byte_index] &= (~((((((255 << starting_bit_within_byte_index) & 255) >> starting_bit_within_byte_index)) >> bits_from_end_of_byte) << bits_from_end_of_byte))&255;\r\n            }  else if (number_of_bytes_with_any_coverage === 2) {\r\n                ta[starting_byte_index] &= (~(((255 << starting_bit_within_byte_index) & 255) >> starting_bit_within_byte_index))&255;\r\n                ta[ending_byte_index] &= (~((255 >> bits_from_end_of_byte) << bits_from_end_of_byte))&255;\r\n            } else {\r\n                ta[starting_byte_index] &= (~((((255 << starting_bit_within_byte_index) & 255) >> starting_bit_within_byte_index)))&255;\r\n                for (let x = starting_byte_index + 1; x < ending_byte_index; x++) {\r\n                    ta[x] = 0;\r\n                }\r\n                ta[ending_byte_index] &= (~((255 >> bits_from_end_of_byte) << bits_from_end_of_byte))&255;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    draw_x_span_on_1bipp(x, y, l) {\r\n        const x2 = x + l;\r\n\r\n        //console.log('[x, y, l]', [x, y, l]);\r\n\r\n        for (let ix = x; ix < x2; ix++) {\r\n            this.set_pixel_on_1bipp_xy(ix, y);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // May do more lower level / general purpose work on line drawing....\r\n\r\n    'draw_horizontal_line_on_1bipp_inclusive'([x1, x2], y) {\r\n        const {size, ta} = this;\r\n        const number_of_pixels_to_draw = (x2 - x1) + 1;\r\n        if (number_of_pixels_to_draw === 1) {\r\n            const pixel_index = (y * size[0]) + x1;\r\n            ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n        } else if (number_of_pixels_to_draw === 2) {\r\n            let pixel_index = (y * size[0]) + x1;\r\n            // Seems possibly wrong op....\r\n            //   Maybe this would really be best doing the 16 bit way.\r\n            ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n            pixel_index++;\r\n            ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n            pixel_index++;\r\n        } else {\r\n            const [w, h] = size;\r\n            const starting_pixel_index = ((y * w) + x1) | 0;\r\n            const ending_pixel_index = starting_pixel_index + (number_of_pixels_to_draw - 1);\r\n            //const ending_pixel_index = starting_pixel_index + (number_of_pixels_to_draw - 1);\r\n            const starting_byte_index = starting_pixel_index >> 3;\r\n            const starting_bit_within_byte_index = (starting_pixel_index & 7);\r\n            const ending_byte_index = ending_pixel_index >> 3;\r\n            const ending_bit_within_byte_index = (ending_pixel_index & 7);\r\n            const bits_from_end_of_byte = 7 - ending_bit_within_byte_index;\r\n            if (starting_byte_index === ending_byte_index) {\r\n                ta[starting_byte_index] |= (((((255 << starting_bit_within_byte_index) & 255) >> starting_bit_within_byte_index)) >> bits_from_end_of_byte) << bits_from_end_of_byte;\r\n            } else {\r\n                ta[starting_byte_index] |= ((255 << starting_bit_within_byte_index) & 255) >> starting_bit_within_byte_index;\r\n                for (let x = starting_byte_index + 1; x < ending_byte_index; x++) {\r\n                    ta[x] = 255;\r\n                }\r\n                ta[ending_byte_index] |= (255 >> bits_from_end_of_byte) << bits_from_end_of_byte;\r\n            }\r\n        }\r\n    }\r\n    \r\n    'draw_horizontal_line_8bipp'(xspan, y, color) {\r\n        const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        //const [r, g, b] = color;\r\n        let w = start_pixel_idx;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = color;\r\n        }\r\n    }\r\n    'draw_horizontal_line_24bipp'(xspan, y, color) {\r\n        const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        const [r, g, b] = color;\r\n        let w = start_pixel_idx * 3;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = r;\r\n            ta[w++] = g;\r\n            ta[w++] = b;\r\n        }\r\n    }\r\n    'draw_horizontal_line_32bipp'(xspan, y, color) {\r\n        const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        const [r, g, b, a] = color;\r\n        let w = start_pixel_idx * 4;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = r;\r\n            ta[w++] = g;\r\n            ta[w++] = b;\r\n            ta[w++] = a;\r\n        }\r\n    }\r\n    'draw_horizontal_line'(xspan, y, color) {\r\n        const {bipp} = this;\r\n        if (bipp === 1) {\r\n            if (color === 1) {\r\n                return this.draw_horizontal_line_on_1bipp_inclusive(xspan, y);\r\n            } else {\r\n                return this.draw_horizontal_line_off_1bipp_inclusive(xspan, y);\r\n            }\r\n        } else if (bipp === 8) {\r\n            return this.draw_horizontal_line_8bipp(xspan, y, color);\r\n        } else if (bipp === 24) {\r\n            return this.draw_horizontal_line_24bipp(xspan, y, color);\r\n        } else if (bipp === 32) {\r\n            return this.draw_horizontal_line_32bipp(xspan, y, color);\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n\r\n    'draw_horizontal_line_y_x1_x2'(y, x1, x2, color, pre_populated_array, populate_array) {\r\n        const {bipp} = this;\r\n        if (bipp === 1) {\r\n            if (color === 1) {\r\n                return this.draw_horizontal_line_on_1bipp_inclusive_y_x1_x2(y, x1, x2);\r\n            } else {\r\n                return this.draw_horizontal_line_off_1bipp_inclusive_y_x1_x2(y, x1, x2);\r\n            }\r\n        } else if (bipp === 8) {\r\n            return this.draw_horizontal_line_8bipp_y_x1_x2(y, x1, x2, color);\r\n        } else if (bipp === 24) {\r\n            return this.draw_horizontal_line_24bipp_y_x1_x2(y, x1, x2, color, pre_populated_array, populate_array);\r\n        } else if (bipp === 32) {\r\n            return this.draw_horizontal_line_32bipp_y_x1_x2(y, x1, x2, color);\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n\r\n    'draw_horizontal_line_8bipp_y_x1_x2'(y, x1, x2, color) {\r\n        //const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        //const [r, g, b] = color;\r\n        let w = start_pixel_idx;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = color;\r\n        }\r\n    }\r\n\r\n    '_draw_horizontal_line_24bipp_y_x1_x2'(y, x1, x2, color) {\r\n        //const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        const [r, g, b] = color;\r\n        let w = start_pixel_idx * 3;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = r;\r\n            ta[w++] = g;\r\n            ta[w++] = b;\r\n        }\r\n    }\r\n\r\n    'draw_horizontal_line_24bipp_y_x1_x2'(y, x1, x2, color, pre_populated_array = null, populate_array = true) {\r\n        const { ta } = this;\r\n        const [width, height] = this.size;\r\n\r\n        // Validate bounds\r\n        if (y < 0 || y >= height || x1 < 0 || x2 >= width || x1 > x2) {\r\n            throw new Error(\"Coordinates out of bounds\");\r\n        }\r\n\r\n        const start_pixel_idx = width * y + x1;\r\n        const [r, g, b] = color;\r\n        const pixel_count = x2 - x1 + 1;\r\n\r\n        if (pixel_count < 8) {\r\n            // For small spans, use the original per-pixel method\r\n            let w = start_pixel_idx * 3;\r\n            for (let x = x1; x <= x2; x++) {\r\n                ta[w++] = r;\r\n                ta[w++] = g;\r\n                ta[w++] = b;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Create and optionally populate the pre-populated array if needed\r\n        if (!pre_populated_array) {\r\n            pre_populated_array = new Uint8Array(96 * 3); // Default size of 96 pixels, 288 bytes\r\n        }\r\n\r\n        if (populate_array) {\r\n            for (let i = 0; i < pre_populated_array.length; i += 3) {\r\n                pre_populated_array[i] = r;\r\n                pre_populated_array[i + 1] = g;\r\n                pre_populated_array[i + 2] = b;\r\n            }\r\n        }\r\n\r\n        let w = start_pixel_idx * 3;\r\n        const ppal = pre_populated_array.length;\r\n        const chunk_size = ppal / 3; // Use the provided pre-populated array's actual size\r\n        let remaining_pixels = pixel_count;\r\n\r\n        while (remaining_pixels >= chunk_size) {\r\n            //const byte_count = chunk_size * 3;\r\n            ta.set(pre_populated_array, w);\r\n            w += ppal;\r\n            remaining_pixels -= chunk_size;\r\n        }\r\n\r\n\r\n        /*\r\n        // Use .set for remaining pixels if 16 or more remain\r\n        if (remaining_pixels >= 32) {\r\n            const byte_count = remaining_pixels * 3;\r\n            ta.set(pre_populated_array.subarray(0, byte_count), w);\r\n        } else if (remaining_pixels > 0) {\r\n            // Handle remaining pixels directly for fewer than 16\r\n            for (let i = 0; i < remaining_pixels * 3; i += 3) {\r\n                ta[w++] = r;\r\n                ta[w++] = g;\r\n                ta[w++] = b;\r\n            }\r\n        }\r\n\r\n        */\r\n\r\n        for (let i = 0; i < remaining_pixels; i ++) {\r\n            ta[w++] = r;\r\n            ta[w++] = g;\r\n            ta[w++] = b;\r\n        }\r\n    }\r\n\r\n    'draw_horizontal_line_32bipp_y_x1_x2'(y, x1, x2, color) {\r\n        //const [x1, x2] = xspan;\r\n        const {ta} = this;\r\n        const [width] = this.size;\r\n        const start_pixel_idx = width * y + x1;\r\n        const [r, g, b, a] = color;\r\n        let w = start_pixel_idx * 4;\r\n        for (let x = x1; x <= x2; x++) {\r\n            ta[w++] = r;\r\n            ta[w++] = g;\r\n            ta[w++] = b;\r\n            ta[w++] = a;\r\n        }\r\n    }\r\n    \r\n}\r\nmodule.exports = Pixel_Buffer_Core_Draw_Lines;", "module.exports = false;", "class TA_Table_8_Columns {\r\n    constructor(row_count) {\r\n        this.row_size = 8; // Fixed row size of 8\r\n        this.row_count = row_count;\r\n        this.ta = new Float32Array(this.row_size * this.row_count);\r\n        const sorted_indices = this.sorted_indices = new Uint32Array(this.row_count); // Sorted logical indices\r\n\r\n        for (let i = 0; i < row_count; i++) {\r\n            sorted_indices[i] = i;\r\n        }\r\n    }\r\n\r\n    get(row, col) {\r\n        return this.ta[(row << 3) + col];\r\n    }\r\n\r\n    set(row, col, value) {\r\n        this.ta[(row << 3) + col] = value;\r\n    }\r\n\r\n    sort_indices(comparator) {\r\n        this.sorted_indices.sort((a, b) => comparator(a, b, this));\r\n    }\r\n}\r\n\r\nmodule.exports = TA_Table_8_Columns;\r\n", "const DEBUG = require('./is_debug');\r\nconst TA_Table_8_Columns = require('./TA_Table_8_Columns');\r\n\r\nclass Polygon_Edges extends TA_Table_8_Columns {\r\n    constructor(polygon) {\r\n        const ptap = polygon.ta_points;\r\n        const num_points = ptap.length >> 1; // Divide length by 2 to get number of points\r\n\r\n        let num_edges = 0;\r\n\r\n        // Loop to determine the number of edges\r\n        for (let i = 0; i < num_points; i++) {\r\n            const y1 = ptap[(i << 1) + 1]; // i * 2 + 1 becomes (i << 1) + 1, efficient bitwise multiply\r\n            const y2 = ptap[(((i + 1) % num_points) << 1) + 1]; // Proper multiplication by 2 for the lookup\r\n\r\n            if (y1 !== y2 || y1 === y2) { // Count horizontal edges as well\r\n                num_edges++;\r\n            }\r\n        }\r\n\r\n        super(num_edges);\r\n        this.sorted_indices = new Uint32Array(num_edges);\r\n\r\n        this.populate_edges(polygon);\r\n        this.sort_by_y1_then_x1();\r\n    }\r\n\r\n    populate_edges(polygon) {\r\n        const ptap = polygon.ta_points;\r\n        const num_points = ptap.length >> 1;\r\n        const {sorted_indices} = this;\r\n\r\n        let row = 0;\r\n        for (let i = 0; i < num_points; i++) {\r\n\r\n            const ix2 = i << 1;\r\n\r\n            const indx2 = ((i + 1) % num_points) << 1;\r\n\r\n            const x1 = ptap[ix2];\r\n            const y1 = ptap[ix2 + 1];\r\n            const x2 = ptap[indx2];\r\n            const y2 = ptap[indx2 + 1];\r\n\r\n            if (y1 !== y2 || y1 === y2) { // Include horizontal edges\r\n                const is_horizontal = (y1 === y2) ? 1 : 0;\r\n                this.set(row, 0, y1 < y2 ? x1 : x2); // x1\r\n                this.set(row, 1, Math.min(y1, y2)); // y1\r\n                this.set(row, 2, y1 < y2 ? x2 : x1); // x2\r\n                this.set(row, 3, Math.max(y1, y2)); // y2\r\n                this.set(row, 4, (y1 !== y2) ? (x2 - x1) / (y2 - y1) : 0); // Slope (0 for horizontal)\r\n                this.set(row, 5, is_horizontal); // is_horizontal (1 for horizontal, 0 otherwise)\r\n                sorted_indices[row] = row;\r\n                row++;\r\n            }\r\n        }\r\n\r\n        if (DEBUG) {\r\n            console.log('Edges populated:', Array.from({ length: this.row_count }, (_, i) => ({\r\n                x1: this.get(i, 0),\r\n                y1: this.get(i, 1),\r\n                x2: this.get(i, 2),\r\n                y2: this.get(i, 3),\r\n                slope: this.get(i, 4),\r\n                is_horizontal: this.get(i, 5),\r\n            })));\r\n        }\r\n    }\r\n\r\n    sort_by_y1_then_x1() {\r\n        this.sorted_indices.sort((a, b) => {\r\n            const y1A = this.get(a, 1);\r\n            const y1B = this.get(b, 1);\r\n            if (y1A !== y1B) return y1A - y1B;\r\n            const x1A = this.get(a, 0);\r\n            const x1B = this.get(b, 0);\r\n            return x1A - x1B;\r\n        });\r\n\r\n        if (DEBUG) {\r\n            console.log(\r\n                'Sorted edges by y1, then x1:',\r\n                this.sorted_indices.map((index) => ({\r\n                    x1: this.get(index, 0),\r\n                    y1: this.get(index, 1),\r\n                    x2: this.get(index, 2),\r\n                    y2: this.get(index, 3),\r\n                    slope: this.get(index, 4),\r\n                    is_horizontal: this.get(index, 5),\r\n                }))\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Polygon_Edges;\r\n", "const DEBUG = require('./is_debug');\r\nconst Polygon_Edges = require('./Polygon_Edges');\r\n\r\nclass Scanline_Polygon_Edges extends Polygon_Edges {\r\n    constructor(polygon, options = {}) {\r\n        super(polygon);\r\n        this.active_edges = new Uint32Array(this.row_count); // Backed by typed array\r\n        this.num_active_edges = 0;\r\n        this.allow_horizontal_edges = options.allow_horizontal_edges || false;\r\n    }\r\n\r\n    update_active_edges(scanline_y) {\r\n        let write_index = 0;\r\n\r\n        const {active_edges, sorted_indices} = this;\r\n\r\n        // Remove inactive edges\r\n        for (let i = 0; i < this.num_active_edges; i++) {\r\n            const edge_index = active_edges[i];\r\n            const y2 = this.get(edge_index, 3); // y2 is the ending y-coordinate\r\n\r\n            if (scanline_y < y2 || (this.allow_horizontal_edges && scanline_y === y2)) {\r\n                active_edges[write_index++] = edge_index; // Keep active\r\n            } else if (DEBUG) {\r\n                console.log(`Edge ${edge_index} removed (scanline_y=${scanline_y}, y2=${y2})`);\r\n            }\r\n        }\r\n\r\n        this.num_active_edges = write_index;\r\n\r\n        const sil = sorted_indices.length;\r\n\r\n        // Add new edges that start at this scanline\r\n        for (let i = 0; i < sil; i++) {\r\n            const edge_index = sorted_indices[i];\r\n            const y1 = this.get(edge_index, 1); // y1 is the starting y-coordinate\r\n            const y2 = this.get(edge_index, 3);\r\n\r\n            if (y1 === scanline_y && (scanline_y < y2 || (this.allow_horizontal_edges && scanline_y === y2))) {\r\n                active_edges[this.num_active_edges++] = edge_index;\r\n                if (DEBUG) {\r\n                    console.log(\r\n                        `Edge ${edge_index} added (scanline_y=${scanline_y}, y1=${y1}, y2=${y2})`\r\n                    );\r\n                }\r\n            }\r\n        }\r\n\r\n        if (DEBUG) {\r\n            console.log(\r\n                `Updated active edges for scanline ${scanline_y}:`,\r\n                active_edges.slice(0, this.num_active_edges)\r\n            );\r\n        }\r\n    }\r\n\r\n    sort_active_edges_by_x() {\r\n        this.active_edges.set(\r\n            this.active_edges\r\n                .slice(0, this.num_active_edges)\r\n                .sort((edgeA, edgeB) => this.get(edgeA, 0) - this.get(edgeB, 0))\r\n        );\r\n\r\n        if (DEBUG) {\r\n            console.log(\r\n                `Sorted active edges by x:`,\r\n                this.active_edges.slice(0, this.num_active_edges)\r\n            );\r\n        }\r\n    }\r\n\r\n    get_active_edges() {\r\n        // Slice to return only the active edges\r\n        return this.active_edges.slice(0, this.num_active_edges);\r\n    }\r\n}\r\n\r\nmodule.exports = Scanline_Polygon_Edges;\r\n", "const Shape = require('./Shape');\r\n\r\n// new Rectangle([w, h], [x, y]); seems like the most standard format.\r\n//.  Does seem best when defining the rectangle.\r\n//.    Possibly have some default parameter order property? Or a bit of online explanation?\r\n\r\nconst {tof, is_array, get_item_sig, is_arr_of_t} = require('lang-mini');\r\n\r\nconst Rectangle = require('./Rectangle');\r\n\r\n//.  what it is, where it is???\r\n//.  or [pos, size]????\r\n// But it can exist without its position (usually / in theory at least).\r\n\r\nconst {draw_polygon_outline_to_ta_1bipp,\r\n    ensure_polygon_is_ta,\r\n\r\n    right_shift_32bit_with_carry,\r\n    xor_typed_arrays,\r\n    each_1_index,\r\n    count_1s,\r\n    fast_find_next_set_ta_bit,\r\n    get_ta_bits_that_differ_from_previous_as_1s,\r\n    get_bit,\r\n    calc_polygon_stroke_points_x_y} = require('../ta-math');\r\n\r\n\r\nconst is_integer_typed_array = (obj) => {\r\n    if (ArrayBuffer.isView(obj)) {\r\n        return (\r\n            obj instanceof Int8Array ||\r\n            obj instanceof Uint8Array ||\r\n            obj instanceof Int16Array ||\r\n            obj instanceof Uint16Array ||\r\n            obj instanceof Int32Array ||\r\n            obj instanceof Uint32Array ||\r\n            obj instanceof BigInt64Array ||\r\n            obj instanceof BigUint64Array\r\n        );\r\n    }\r\n    return false;\r\n};\r\n\r\n\r\n// Extend a TA_Table perhaps?\r\n//   Or it's just a Matrix?\r\n\r\n// TA_Matrix\r\n\r\n// A table is more about expressing it as a list of records.\r\n\r\n\r\nconst Polygon_Scanline_Edges = require('./Polygon_Scanline_Edges');\r\n\r\n\r\n\r\n\r\nclass Polygon extends Shape {\r\n    // Set the points but with an offset too????\r\n\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        // Give it the polygon points\r\n\r\n        // Functions to get various data derived from that polygon.\r\n        //   A typed array that expresses the x on spans may be most useful.\r\n\r\n        if (is_array(spec)) {\r\n            // Should be an array of pairs.\r\n\r\n            const l = spec.length;\r\n            const num_points = l;\r\n            // Determine what data structure to use for the ta points. Could use 16 bit numbers, maybe even 8 bit....\r\n            //   8 bit would be fine (or best) for the smallest polygons. \r\n            //   Or go strait ahead and use 32 bit??\r\n\r\n            // May want to downshift it?\r\n            //   Not to start with.\r\n            const ta_points = new Uint32Array(num_points << 1);\r\n            let i = 0;\r\n\r\n            // May as well determine the bounding box here? Maybe not?\r\n\r\n            for (const [x, y] of spec) {\r\n                ta_points[i++] = x;\r\n                ta_points[i++] = y;\r\n            }\r\n\r\n            this.ta_points = ta_points;\r\n        } else {\r\n\r\n            //console.log('spec', spec);\r\n\r\n            if (is_integer_typed_array(spec)) {\r\n                this.ta_points = spec;\r\n            } else {\r\n                console.trace();\r\n                throw 'NYI';\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // Or just as a normal array? Maybe that would be faster.\r\n\r\n    get ta_bounding_box() {\r\n        if (!this._ta_bounding_box) {\r\n            const {ta_points} = this, l = ta_points.length;\r\n            let min_x = Infinity, min_y = Infinity, max_x = -Infinity, max_y = -Infinity;\r\n\r\n            let i = 0;\r\n            let x, y;\r\n\r\n            while (i < l) {\r\n                x = ta_points[i++];\r\n                y = ta_points[i++];\r\n                min_x = Math.min(min_x, x);\r\n                min_y = Math.min(min_y, y);\r\n                max_x = Math.max(max_x, x);\r\n                max_y = Math.max(max_y, y);\r\n            }\r\n\r\n            return this._ta_bounding_box = new Uint32Array([min_x, min_y, max_x, max_y]);\r\n        } else {\r\n            return this._ta_bounding_box;\r\n        }\r\n    }\r\n    \r\n    get ta_xylc_x_spans() {\r\n\r\n        // count x spans?\r\n\r\n        // Count them first with its own count algorithm????\r\n\r\n        const downshifted = this.downshifted();\r\n        const tabb = downshifted.ta_bounding_box;\r\n\r\n        const offset = this.ta_bounding_box;\r\n\r\n        const draw_size = [tabb[2], tabb[3]];\r\n        const [w, h] = draw_size;\r\n\r\n        const draw_size_num_pixels = draw_size[0] * draw_size[1];\r\n\r\n        // Then see about getting it into an 8 bit aligned ta.\r\n        const r_from_8 = draw_size_num_pixels % 8;\r\n        const has_remainder_byte = r_from_8 !== 0;\r\n        const ta_draw_num_bytes = (draw_size_num_pixels >>> 3) + (has_remainder_byte ? 1 : 0);\r\n        const ta_draw = new Uint8Array(ta_draw_num_bytes);\r\n\r\n        // Then draw the downshifted polygon to that ta....\r\n\r\n        draw_polygon_outline_to_ta_1bipp(ta_draw, draw_size[0], downshifted.ta_points);\r\n        const ta_x_span_toggles = get_ta_bits_that_differ_from_previous_as_1s(ta_draw, draw_size[0]);\r\n\r\n\r\n        // Count the number of rows that begin with 1s?\r\n        const num_toggle_bits = count_1s(ta_x_span_toggles);\r\n        const iterate_to_count_x_spans = () => {\r\n            //let i_w_res = 0;\r\n            //let res = 0;\r\n            let i_row_start = 0, i_row_end = w + 1;\r\n            let cx = 0;\r\n            const found_x_span = (x, y, l, c) => {\r\n                cx++;\r\n            }\r\n\r\n            for (let y = 0; y < h; y++) {\r\n                let i_next_set_bit = fast_find_next_set_ta_bit(ta_x_span_toggles, i_row_start, i_row_end - i_row_start - 1);\r\n                //console.log('y, i_next_set_bit', y, i_next_set_bit);\r\n\r\n\r\n                if (i_next_set_bit === false) {\r\n                    // Then the row's only span is of the start color.\r\n                    found_x_span(0, y, i_row_end);\r\n\r\n\r\n                } else {\r\n                    found_x_span(0, y, i_next_set_bit - i_row_start);\r\n                    //color = (~color)&1;\r\n                    let i_last_set_bit = i_next_set_bit;\r\n\r\n                    while (i_next_set_bit !== false && i_next_set_bit < i_row_end) {\r\n\r\n                        // That fn seems broken for now.\r\n                        i_next_set_bit = fast_find_next_set_ta_bit(ta_x_span_toggles, i_next_set_bit, i_row_end - i_next_set_bit - 1);\r\n                        //console.log('y, i_next_set_bit', y, i_next_set_bit);\r\n\r\n                        if (i_next_set_bit === false) {\r\n                            // Then the row's only span is of the start color.\r\n                            found_x_span(i_last_set_bit - i_row_start, y, i_row_end - i_last_set_bit);\r\n                        } else {\r\n                            found_x_span(i_last_set_bit - i_row_start, y, i_next_set_bit - i_last_set_bit);\r\n                            i_last_set_bit = i_next_set_bit;\r\n                        }\r\n                    }\r\n                }\r\n                i_row_start += w;\r\n                i_row_end += w;\r\n            }\r\n            return cx;\r\n        }\r\n\r\n        const num_x_spans = iterate_to_count_x_spans();\r\n\r\n        const num_fields_per_result_item = 4;\r\n        const l_res = num_x_spans * num_fields_per_result_item;\r\n\r\n        const res = new Uint32Array(l_res);\r\n        \r\n\r\n        const iterate_to_write_result = () => {\r\n            let i_w_res = 0;\r\n            //let res = 0;\r\n            let i_row_start = 0, i_row_end = w + 1;\r\n            let cx = 0;\r\n            const found_x_span = (x, y, l, c) => {\r\n                res[i_w_res++] = x;\r\n                res[i_w_res++] = y;\r\n                res[i_w_res++] = l;\r\n                res[i_w_res++] = c;\r\n                cx++;\r\n                //console.log('cx', cx);\r\n            }\r\n\r\n            for (let y = 0; y < h; y++) {\r\n                const row_x0_value = get_bit(ta_x_span_toggles, i_row_start);\r\n                let color = row_x0_value;\r\n\r\n                /*\r\n                if (row_x0_value !== 0) {\r\n                    console.log([y, row_x0_value]);\r\n                }\r\n\r\n                */\r\n                // And rather than a limit, have an absolute boundary of the end of that row?\r\n\r\n                // And limit it up to the row end?\r\n                let i_next_set_bit = fast_find_next_set_ta_bit(ta_x_span_toggles, i_row_start, i_row_end - i_row_start - 1);\r\n                //console.log('y, i_next_set_bit', y, i_next_set_bit);\r\n\r\n\r\n                if (i_next_set_bit === false) {\r\n                    // Then the row's only span is of the start color.\r\n                    found_x_span(0, y, i_row_end, color);\r\n\r\n\r\n                } else {\r\n                    found_x_span(0, y, i_next_set_bit - i_row_start, color);\r\n                    color = (~color)&1;\r\n                    let i_last_set_bit = i_next_set_bit;\r\n\r\n                    while (i_next_set_bit !== false && i_next_set_bit < i_row_end) {\r\n\r\n                        // That fn seems broken for now.\r\n                        i_next_set_bit = fast_find_next_set_ta_bit(ta_x_span_toggles, i_next_set_bit, i_row_end - i_next_set_bit - 1);\r\n                        //console.log('y, i_next_set_bit', y, i_next_set_bit);\r\n\r\n                        if (i_next_set_bit === false) {\r\n                            // Then the row's only span is of the start color.\r\n                            found_x_span(i_last_set_bit - i_row_start, y, i_row_end - i_last_set_bit, color);\r\n                        } else {\r\n                            found_x_span(i_last_set_bit - i_row_start, y, i_next_set_bit - i_last_set_bit, color);\r\n                            i_last_set_bit = i_next_set_bit;\r\n                            //found_x_span(0, y, i_next_set_bit - i_row_start, color);\r\n                            color = (~color)&1;\r\n                        }\r\n\r\n\r\n                        //console.log('[y, i_next_set_bit]', [y, i_next_set_bit]);\r\n\r\n                        //i_last_set_bit = i_next_set_bit;\r\n                    }\r\n                }\r\n                i_row_start += w;\r\n                i_row_end += w;\r\n            }\r\n        }\r\n\r\n        iterate_to_write_result();\r\n        return res;\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // x, y, l makes the most sense\r\n\r\n    get ta_x_spans_filled() {\r\n\r\n\r\n        const calling_other_fns_attempt = () => {\r\n\r\n            const bb = this.ta_bounding_box;\r\n\r\n            const offset_width = bb[2] - bb[0];\r\n\r\n            const offset_height = bb[3] - bb[1];\r\n            const ohm1 = offset_height - 1;\r\n\r\n            // Maybe need to break this down into OO classes to get it working properly.\r\n\r\n            const ta_xylc_x_spans = this.ta_xylc_x_spans;\r\n\r\n            //console.log('ta_xylc_x_spans', ta_xylc_x_spans + '');\r\n            //console.trace();\r\n            //throw 'stop';\r\n\r\n\r\n            const iterate_to_count_x_spans_touching_image_border = () => {\r\n                const ta_l = ta_xylc_x_spans.length;\r\n                const num_x_spans = ta_l / 4;\r\n\r\n                //let i_x_span = 0;\r\n                let i_r = 0;\r\n                let c_touching_image_border = 0;\r\n\r\n                for (let i_x_span = 0; i_x_span < num_x_spans; i_x_span++) {\r\n                    const x = ta_xylc_x_spans[i_r++], y = ta_xylc_x_spans[i_r++], l = ta_xylc_x_spans[i_r++], c = ta_xylc_x_spans[i_r++];\r\n                    if (x === 0) {\r\n                        c_touching_image_border++\r\n                    } else if (x + l === offset_width) {\r\n                        c_touching_image_border++\r\n                    } else if (y === 0) {\r\n                        c_touching_image_border++\r\n                    } else if (y === ohm1) {\r\n                        c_touching_image_border++\r\n                    }\r\n                }\r\n                return c_touching_image_border;\r\n            }\r\n\r\n            const c_touching_image_border = iterate_to_count_x_spans_touching_image_border();\r\n\r\n            // Iterate to get the indexes of the x spans touching the border.\r\n            //   Not setting them as a group bitfield for the moment.\r\n\r\n            const indexes_of_x_spans_touching_image_border = new Uint32Array(c_touching_image_border);\r\n\r\n            const iterate_to_populate_indexes_of_x_spans_touching_image_border = () => {\r\n                let i_r = 0, i_w = 0;\r\n\r\n                const ta_l = ta_xylc_x_spans.length;\r\n                const num_x_spans = ta_l / 4;\r\n\r\n                //let i_x_span = 0;\r\n\r\n                for (let i_x_span = 0; i_x_span < num_x_spans; i_x_span++) {\r\n                    const x = ta_xylc_x_spans[i_r++], y = ta_xylc_x_spans[i_r++], l = ta_xylc_x_spans[i_r++], c = ta_xylc_x_spans[i_r++];\r\n                    if (x === 0) {\r\n                        indexes_of_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                    } else if (x + l === offset_width) {\r\n                        indexes_of_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                    } else if (y === 0) {\r\n                        indexes_of_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                    } else if (y === ohm1) {\r\n                        indexes_of_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                    }\r\n                }\r\n            }\r\n            iterate_to_populate_indexes_of_x_spans_touching_image_border();\r\n\r\n            \r\n            const iterate_to_count_color_0_x_spans_touching_image_border = () => {\r\n                const ta_l = ta_xylc_x_spans.length;\r\n                const num_x_spans = ta_l / 4;\r\n\r\n                //let i_x_span = 0;\r\n                let i_r = 0;\r\n                let c_touching_image_border = 0;\r\n\r\n                for (let i_x_span = 0; i_x_span < num_x_spans; i_x_span++) {\r\n                    const x = ta_xylc_x_spans[i_r++], y = ta_xylc_x_spans[i_r++], l = ta_xylc_x_spans[i_r++], c = ta_xylc_x_spans[i_r++];\r\n                    if (c === 0) {\r\n                        if (x === 0) {\r\n                            c_touching_image_border++;\r\n                        } else if (x + l === offset_width) {\r\n                            c_touching_image_border++;\r\n                        } else if (y === 0) {\r\n                            c_touching_image_border++;\r\n                        } else if (y === ohm1) {\r\n                            c_touching_image_border++;\r\n                        }\r\n                    }\r\n                    \r\n                }\r\n                return c_touching_image_border;\r\n            }\r\n\r\n            const c_color_0_touching_image_border = iterate_to_count_color_0_x_spans_touching_image_border();\r\n            //console.log('c_color_0_touching_image_border', c_color_0_touching_image_border);\r\n\r\n            const indexes_of_color_0_x_spans_touching_image_border = new Uint32Array(c_color_0_touching_image_border);\r\n\r\n            const iterate_to_populate_indexes_of_color_0_x_spans_touching_image_border = () => {\r\n                let i_r = 0, i_w = 0;\r\n\r\n                const ta_l = ta_xylc_x_spans.length;\r\n                const num_x_spans = ta_l / 4;\r\n\r\n                //let i_x_span = 0;\r\n\r\n                for (let i_x_span = 0; i_x_span < num_x_spans; i_x_span++) {\r\n                    const x = ta_xylc_x_spans[i_r++], y = ta_xylc_x_spans[i_r++], l = ta_xylc_x_spans[i_r++], c = ta_xylc_x_spans[i_r++];\r\n                    if (c === 0) {\r\n                        if (x === 0) {\r\n                            indexes_of_color_0_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                        } else if (x + l === offset_width) {\r\n                            indexes_of_color_0_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                        } else if (y === 0) {\r\n                            indexes_of_color_0_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                        } else if (y === ohm1) {\r\n                            indexes_of_color_0_x_spans_touching_image_border[i_w++] = i_x_span;\r\n                        }\r\n                    }\r\n                    \r\n                }\r\n            }\r\n            iterate_to_populate_indexes_of_color_0_x_spans_touching_image_border();\r\n\r\n\r\n            const invert_indexes = (indexes) => {\r\n                const ta_l = ta_xylc_x_spans.length;\r\n                const num_x_spans = ta_l / 4;\r\n            \r\n                let i_idx = 0; // pointer for indexes array\r\n                let res_idx = 0; // pointer for result array\r\n            \r\n                const res = new Uint32Array(num_x_spans - indexes.length);\r\n            \r\n                // Iterate over each span index\r\n                for (let i_x_span = 0; i_x_span < num_x_spans; i_x_span++) {\r\n                    // Check if the current span index is in the indexes array\r\n                    if (i_idx < indexes.length && indexes[i_idx] === i_x_span) {\r\n                        // If i_x_span matches current index, skip it and move to the next index in indexes\r\n                        i_idx++;\r\n                    } else {\r\n                        // If i_x_span is not in indexes, add it to result array\r\n                        res[res_idx++] = i_x_span;\r\n                    }\r\n                }\r\n            \r\n                return res;\r\n            };\r\n            \r\n\r\n            const assemble_res_from_indexes = indexes => {\r\n                //console.log('indexes', indexes);\r\n                const l = indexes.length;\r\n                let i_r = 0, i_w = 0;\r\n\r\n                const l_res = l * 3;\r\n                const res = new Uint32Array(l_res);\r\n                //console.log('ta_xylc_x_spans', ta_xylc_x_spans);\r\n\r\n                for (let i_index = 0; i_index < l; i_index++) {\r\n                    const i_in_main = indexes[i_index];\r\n                    //console.log('i_index, i_in_main', i_index, i_in_main);\r\n                    const pos_in_main = i_in_main * 4;\r\n                    const x = ta_xylc_x_spans[pos_in_main];\r\n                    const y = ta_xylc_x_spans[pos_in_main + 1];\r\n                    const l = ta_xylc_x_spans[pos_in_main + 2];\r\n                    //console.log('[x, y, l]', [x, y, l]);\r\n                    res[i_w++] = x;\r\n                    res[i_w++] = y;\r\n                    res[i_w++] = l;\r\n\r\n                }\r\n\r\n                return res;\r\n\r\n            }\r\n\r\n            const res = assemble_res_from_indexes(invert_indexes(indexes_of_color_0_x_spans_touching_image_border));\r\n\r\n\r\n            return res;\r\n\r\n        }\r\n\r\n        return calling_other_fns_attempt();\r\n\r\n\r\n\r\n    }\r\n\r\n    set offset(value) {\r\n        if (!this._offset) {\r\n            this._offset = new Uint32Array(2);\r\n        }\r\n        if (is_array(value)) {\r\n            this._offset[0] = value[0];\r\n            this._offset[1] = value[1];\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n\r\n    get offset() {\r\n        if (!this._offset) {\r\n            this._offset = new Uint32Array(2);\r\n        }\r\n        return this._offset;\r\n    }\r\n\r\n    downshifted() {\r\n\r\n        // Determine the offset from the bounding box mins.\r\n\r\n        const [x, y] = this.ta_bounding_box;\r\n        const dx = -x, dy = -y;\r\n\r\n        const {ta_points} = this, l = ta_points.length;\r\n\r\n        const ta_downshifted_points = new Uint32Array(l);\r\n        let i = 0;\r\n        while (i < l) {\r\n            ta_downshifted_points[i] = ta_points[i++] + dx;\r\n            ta_downshifted_points[i] = ta_points[i++] + dy;\r\n        }\r\n\r\n        const res = new Polygon(ta_downshifted_points);\r\n        res.offset = [x, y];\r\n        return res;\r\n\r\n\r\n    }\r\n\r\n    get scanline_edges() {\r\n        const res = new Polygon_Scanline_Edges(this);\r\n        return res;\r\n\r\n    }\r\n\r\n}\r\n\r\nPolygon.Polygon_Scanline_Edges = Polygon_Scanline_Edges;\r\n\r\nPolygon.ensure_is = obj => {\r\n    if (obj instanceof Polygon) {\r\n        return obj;\r\n    } else {\r\n        return new Polygon(obj);\r\n    }\r\n}\r\n\r\nmodule.exports = Polygon;\r\n\r\nif (require.main === module) {\r\n\r\n    const t0 = process.hrtime();\r\n\r\n    //const polygon = new Polygon([[4, 4,], [28, 4], [28, 28], [4, 28]]);\r\n\r\n\r\n    const polygon = new Polygon([[900, 900,], [200, 200], [1000, 900], [1600, 200], [1000, 1000], [1000, 1100], [1000, 1600], [900, 1600]]);\r\n\r\n\r\n\r\n    const ta_l = polygon.ta_points.length;\r\n    const tabb = polygon.ta_bounding_box;\r\n\r\n    const ds_pg = polygon.downshifted();\r\n\r\n\r\n    // May be able to get that with a fill algorithm that looks into the edges.\r\n    const xsf = polygon.ta_x_spans_filled;\r\n\r\n    const l_xsf = xsf.length;\r\n    \r\n    const num_x_spans = l / 3;\r\n\r\n    let i = 0;\r\n\r\n    for (let c = 0; c < num_x_spans; c++) {\r\n        const x = xsf[i++], y = xsf[i++], l = xsf[i++], x2 = x + l;\r\n\r\n    }\r\n\r\n    const tt0 = process.hrtime(t0);\r\n    const ms0 = tt0[0] * 1000 + tt0[1] / 1000000\r\n\r\n    //console.log('tt0', tt0);\r\n    console.log('ms0', ms0);\r\n    console.log('ta_l', ta_l);\r\n    console.log('tabb', tabb);\r\n    console.log('polygon', polygon);\r\n    console.log('ds_pg', ds_pg);\r\n    console.log('ds_pg.ta_bounding_box', ds_pg.ta_bounding_box);\r\n    console.log('xsf', xsf);\r\n\r\n\r\n\r\n    // Then can this be drawn to a pixel buffer????\r\n    //   Rapid draw of x-span in the [x, y, l] format.\r\n\r\n\r\n\r\n\r\n\r\n    // Getting the filled polygon x-spans....\r\n    //   Is a somewhat complex procedure, but want to get it running very quick. Some OO will help keep it consistent in terms of usage.\r\n\r\n    // Get these x-spans as a typed array?\r\n    //   [x, y, l] ???\r\n\r\n\r\n\r\n\r\n\r\n    // ta_bounding_box\r\n}", "const DEBUG = require('./is_debug');\r\n\r\nclass ScanlineProcessor {\r\n    constructor(polygon_scanline_edges, width, height, bitmap, options = {}) {\r\n        this.edges = polygon_scanline_edges;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.bitmap = bitmap;\r\n        this.dataView = new DataView(bitmap.buffer, bitmap.byteOffset, bitmap.byteLength);\r\n        this.draw_edges = options.draw_edges || false; // Option to draw edges\r\n    }\r\n\r\n    process_1bipp() {\r\n        if (DEBUG) {\r\n            console.log(`Processing polygon fill: width=${this.width}, height=${this.height}`);\r\n        }\r\n\r\n        const h = this.height, edges = this.edges;\r\n\r\n        for (let y = 0; y < h; y++) {\r\n            edges.update_active_edges(y);\r\n            edges.sort_active_edges_by_x();\r\n\r\n            if (DEBUG) {\r\n                console.log(`Scanline ${y}: Active Edges`, edges.active_edges.slice(0, edges.num_active_edges));\r\n            }\r\n\r\n            if (this.draw_edges) {\r\n                this.fill_scanline_with_edges_1bipp(y);\r\n            } else {\r\n                this.fill_scanline_no_edges_1bipp(y);\r\n            }\r\n            this._update_x_intercepts();\r\n        }\r\n    }\r\n\r\n    _set_pixels_span_1bipp(bitmap, row_offset, x_start, x_end) {\r\n        const total_pixels = x_end - x_start + 1;\r\n        const start_index = row_offset + x_start;\r\n        \r\n        const end_index = row_offset + x_end;\r\n        let pixel_index = start_index;\r\n\r\n        if (total_pixels < 12) {\r\n            // Default behavior for fewer than 16 pixels\r\n            \r\n            for (; pixel_index <= end_index; pixel_index++) {\r\n                const byte_offset = pixel_index >> 3;\r\n                bitmap[byte_offset] |= (128 >> (pixel_index & 7));\r\n            }\r\n\r\n            \r\n        } else {\r\n            const start_byte = start_index >> 3;\r\n            const start_bit_offset = pixel_index & 7;\r\n            let num_pixels_remaining = total_pixels;\r\n            if (total_pixels < 90) {\r\n                //let pixel_index = row_offset + x_start;\r\n                //const start_byte = pixel_index >> 3;\r\n                \r\n                \r\n\r\n                // Handle first byte if not aligned\r\n                if (start_bit_offset !== 0) {\r\n                    const bits_to_set = Math.min(8 - start_bit_offset, num_pixels_remaining);\r\n                    bitmap[start_byte] |= ((0xFF >> (8 - bits_to_set)) << (8 - start_bit_offset - bits_to_set));\r\n                    pixel_index += bits_to_set;\r\n                    num_pixels_remaining -= bits_to_set;\r\n                }\r\n\r\n                // Handle remaining whole bytes\r\n                while (num_pixels_remaining >= 8) {\r\n                    const byte_offset = pixel_index >> 3;\r\n                    bitmap[byte_offset] |= 0xFF;\r\n                    pixel_index += 8;\r\n                    num_pixels_remaining -= 8;\r\n                }\r\n\r\n                // Handle remaining bits\r\n                if (num_pixels_remaining > 0) {\r\n                    const byte_offset = pixel_index >> 3;\r\n                    bitmap[byte_offset] |= (0xFF << (8 - num_pixels_remaining));\r\n                }\r\n            } else {\r\n                const dataView = this.dataView;\r\n                //let pixel_index = row_offset + x_start;\r\n                //const start_byte = pixel_index >> 3;\r\n                //const start_bit_offset = pixel_index & 7;\r\n                //let num_pixels_remaining = total_pixels;\r\n\r\n                // Handle first byte if not aligned\r\n                if (start_bit_offset !== 0) {\r\n                    const bits_to_set = Math.min(8 - start_bit_offset, num_pixels_remaining);\r\n                    bitmap[start_byte] |= ((0xFF >> (8 - bits_to_set)) << (8 - start_bit_offset - bits_to_set));\r\n                    pixel_index += bits_to_set;\r\n                    num_pixels_remaining -= bits_to_set;\r\n                }\r\n\r\n                // Handle 64-bit chunks\r\n                while (num_pixels_remaining >= 64) {\r\n                    const byte_offset = pixel_index >> 3;\r\n                    dataView.setBigUint64(byte_offset, 0xFFFFFFFFFFFFFFFFn, false);\r\n                    pixel_index += 64;\r\n                    num_pixels_remaining -= 64;\r\n                }\r\n\r\n                // Handle remaining whole bytes\r\n                while (num_pixels_remaining >= 8) {\r\n                    const byte_offset = pixel_index >> 3;\r\n                    bitmap[byte_offset] |= 0xFF;\r\n                    pixel_index += 8;\r\n                    num_pixels_remaining -= 8;\r\n                }\r\n\r\n                // Handle remaining bits\r\n                if (num_pixels_remaining > 0) {\r\n                    const byte_offset = pixel_index >> 3;\r\n                    bitmap[byte_offset] |= (0xFF << (8 - num_pixels_remaining));\r\n                }\r\n            }\r\n        } \r\n        \r\n        \r\n        \r\n\r\n       \r\n    }\r\n\r\n    \r\n\r\n    fill_scanline_with_edges_1bipp(scanline_y) {\r\n        const { edges } = this;\r\n        const { active_edges, num_active_edges } = this.edges;\r\n\r\n        if (num_active_edges < 2) {\r\n            if (DEBUG) console.log(`Scanline ${scanline_y}: Not enough active edges to form spans.`);\r\n            return;\r\n        }\r\n\r\n        const bitmap = this.bitmap;\r\n        const row_offset = scanline_y * this.width;\r\n        const naem1 = num_active_edges - 1;\r\n\r\n        for (let i = 0; i < naem1; i += 2) {\r\n            const x_start = Math.round(edges.get(active_edges[i], 0));\r\n            const x_end = Math.round(edges.get(active_edges[i + 1], 0));\r\n\r\n            this._set_pixels_span_1bipp(bitmap, row_offset, x_start, x_end);\r\n\r\n            //const is_horizontal = edges.get(active_edges[i], 5) === 1; // Check if edge is horizontal\r\n\r\n            // Draw the left edge pixel\r\n            //const left_edge_pixel_index = row_offset + x_start;\r\n            //const left_byte_offset = left_edge_pixel_index >> 3;\r\n            //bitmap[left_byte_offset] |= (128 >> (left_edge_pixel_index & 7));\r\n\r\n            //if (is_horizontal) {\r\n                // Draw the entire horizontal edge as a span\r\n                \r\n                //continue; // Horizontal edge fully handled here\r\n            //} else {\r\n                // Fill the span between edges\r\n            //    this._set_pixels_span_1bipp(bitmap, row_offset, x_start, x_end);\r\n\r\n                // Draw the right edge pixel\r\n                //const right_edge_pixel_index = row_offset + x_end;\r\n                //const right_byte_offset = right_edge_pixel_index >> 3;\r\n                //bitmap[right_byte_offset] |= (128 >> (right_edge_pixel_index & 7));\r\n            //}\r\n\r\n            \r\n\r\n            if (DEBUG) {\r\n                console.log(`Scanline ${scanline_y}: Processed span from x=${x_start} to x=${x_end}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    fill_scanline_no_edges_1bipp(scanline_y) {\r\n        const { edges } = this;\r\n        const { active_edges, num_active_edges } = this.edges;\r\n\r\n        if (num_active_edges < 2) {\r\n            if (DEBUG) console.log(`Scanline ${scanline_y}: Not enough active edges to form spans.`);\r\n            return;\r\n        }\r\n\r\n        const bitmap = this.bitmap;\r\n        const row_offset = scanline_y * this.width;\r\n        const naem1 = num_active_edges - 1;\r\n\r\n        for (let i = 0; i < naem1; i += 2) {\r\n            const x_start = Math.ceil(edges.get(active_edges[i], 0));\r\n            const x_end = Math.floor(edges.get(active_edges[i + 1], 0));\r\n\r\n            // Fill the span between edges\r\n            this._set_pixels_span_1bipp(bitmap, row_offset, x_start, x_end);\r\n\r\n            if (DEBUG) {\r\n                console.log(`Scanline ${scanline_y}: Filling span from x=${x_start} to x=${x_end}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    *iterate_process() {\r\n        const h = this.height, edges = this.edges;\r\n\r\n        for (let y = 0; y < h; y++) {\r\n            edges.update_active_edges(y);\r\n            edges.sort_active_edges_by_x();\r\n\r\n            if (DEBUG) {\r\n                console.log(`Scanline ${y}: Active Edges`, edges.active_edges.slice(0, edges.num_active_edges));\r\n            }\r\n\r\n            yield* this.iterate_scanline(y);\r\n            this._update_x_intercepts();\r\n        }\r\n    }\r\n\r\n    *iterate_scanline(scanline_y) {\r\n        const { edges } = this;\r\n        const { active_edges, num_active_edges } = this.edges;\r\n\r\n        if (num_active_edges < 2) {\r\n            if (DEBUG) console.log(`Scanline ${scanline_y}: Not enough active edges to form spans.`);\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < num_active_edges - 1; i += 2) {\r\n            const x_start = Math.ceil(edges.get(active_edges[i], 0));\r\n            const x_end = Math.floor(edges.get(active_edges[i + 1], 0));\r\n\r\n            if (x_start <= x_end) {\r\n                yield [scanline_y, x_start, x_end];\r\n            }\r\n        }\r\n    }\r\n\r\n    _update_x_intercepts() {\r\n        const edges = this.edges;\r\n        const { active_edges, num_active_edges } = edges;\r\n\r\n        for (let i = 0; i < num_active_edges; i++) {\r\n            const edge_index = active_edges[i];\r\n            edges.set(edge_index, 0, edges.get(edge_index, 0) + edges.get(edge_index, 4));\r\n\r\n            if (DEBUG) {\r\n                console.log(`Edge ${edge_index}: Updated x=${edges.get(edge_index, 0)} using slope=${edges.get(edge_index, 4)}`);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = ScanlineProcessor;\r\n", "const Pixel_Buffer_Core_Draw_Lines = require('./pixel-buffer-1.1-core-draw-line');\r\n\r\nconst Polygon_Scanline_Edges = require('./shapes/Polygon_Scanline_Edges');\r\n\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp,\r\n\r\n    get_ta_bits_that_differ_from_previous_as_1s, right_shift_32bit_with_carry,\r\n    xor_typed_arrays, each_1_index, count_1s,\r\n\r\n    draw_polygon_outline_to_ta_1bipp, ensure_polygon_is_ta, calc_polygon_stroke_points_x_y\r\n\r\n\r\n} = require('./ta-math');\r\n\r\n\r\nconst Polygon = require('./shapes/Polygon');\r\nconst ScanlineProcessor = require('./shapes/ScanlineProcessor');\r\nclass Pixel_Buffer_Core_Draw_Polygons extends Pixel_Buffer_Core_Draw_Lines {\r\n    constructor(spec) {\r\n        \r\n        super(spec);\r\n        \r\n    }\r\n\r\n    gpt_draw_polygon_filling(polygon) {\r\n        const edges = [];\r\n        const num_points = polygon.length / 2;\r\n\r\n        const [w, h] = this.size;\r\n    \r\n        // Create edges for the polygon, connecting the last point to the first\r\n        for (let i = 0; i < num_points; i++) {\r\n            const x1 = polygon[i * 2];\r\n            const y1 = polygon[i * 2 + 1];\r\n            const x2 = polygon[((i + 1) % num_points) * 2];\r\n            const y2 = polygon[((i + 1) % num_points) * 2 + 1];\r\n    \r\n            // Skip degenerate edges with the same start and end points\r\n            if (x1 === x2 && y1 === y2) continue;\r\n    \r\n            // Only add non-horizontal edges\r\n            if (y1 !== y2) {\r\n                // Standardize edge creation to ensure consistent ordering\r\n                const is_y1_lower = y1 < y2;\r\n                edges.push({\r\n                    x1: is_y1_lower ? x1 : x2,\r\n                    y1: Math.min(y1, y2),\r\n                    x2: is_y1_lower ? x2 : x1,\r\n                    y2: Math.max(y1, y2),\r\n                    slope: (x2 - x1) / (y2 - y1)\r\n                });\r\n            }\r\n        }\r\n    \r\n        // Sort edges by y1, then by x1 for ties\r\n        edges.sort((a, b) => a.y1 - b.y1 || a.x1 - b.x1);\r\n    \r\n        let active_edges = [];\r\n        let edge_index = 0;\r\n    \r\n        // Process scanlines from top to bottom within the image bounds\r\n        for (let y = 0; y < h; y++) {\r\n            // Add edges that start at this y to the active edge list\r\n            while (edge_index < edges.length && edges[edge_index].y1 === y) {\r\n                active_edges.push(edges[edge_index]);\r\n                edge_index++;\r\n            }\r\n    \r\n            // Remove edges that end before this y\r\n            active_edges = active_edges.filter(e => e.y2 > y);\r\n    \r\n            // Sort active edges by the current x-intercept for the scanline\r\n            active_edges.sort((a, b) => a.x1 - b.x1);\r\n\r\n            const aelm1 = active_edges.length - 1;\r\n\r\n            //console.log('active_edges', active_edges);\r\n    \r\n            // Fill pixels between pairs of intersections\r\n            for (let i = 0; i < aelm1; i += 2) {\r\n                const x_start = Math.ceil(active_edges[i].x1);\r\n                const x_end = Math.floor(active_edges[i + 1].x1);\r\n    \r\n                for (let x = x_start; x <= x_end; x++) {\r\n\r\n                    const pixel_index = y * w + x;\r\n                    this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n\r\n                    //this.set_pixel_on_1bipp_xy(x, y); // Fill with a color of 1 (binary for bitmask)\r\n                }\r\n            }\r\n    \r\n            // Update x-intercepts for active edges for the next scanline\r\n            for (let edge of active_edges) {\r\n                edge.x1 += edge.slope;\r\n            }\r\n        }\r\n    }\r\n\r\n    class_enh_gpt_draw_polygon_filling(polygon) {\r\n        const [w, h] = this.size;\r\n        polygon = Polygon.ensure_is(polygon);\r\n        const polygon_scanline_edges = new Polygon_Scanline_Edges(polygon);\r\n        const processor = new ScanlineProcessor(polygon_scanline_edges, w, h, this.ta);\r\n        processor.process();\r\n    }\r\n\r\n    gpt_draw_filled_polygon_1bipp(polygon) {\r\n        polygon = Polygon.ensure_is(ensure_polygon_is_ta(polygon));\r\n        const scanline_processor = new ScanlineProcessor(\r\n            polygon.scanline_edges, \r\n            this.size[0], \r\n            this.size[1], \r\n            this.ta, \r\n            { draw_edges: true } // Enable edge drawing\r\n        );\r\n        scanline_processor.process_1bipp();\r\n    }\r\n\r\n    \r\n\r\n    draw_color_1_filled_polygon_1bipp(polygon) {\r\n        return this.gpt_draw_filled_polygon_1bipp(polygon);\r\n    }\r\n\r\n    draw_polygon_1bipp(polygon, stroke_color, fill_color = false) {\r\n\r\n        polygon = ensure_polygon_is_ta(polygon);\r\n        if (fill_color === undefined || fill_color === false) {\r\n            let x, y;\r\n            let prev_x, prev_y;\r\n            let is_first = true;\r\n\r\n            const num_points = polygon.length >>> 1;\r\n            let r = 0;\r\n            //console.log('polygon outline pre draw. num_points: ', num_points);\r\n            //console.log('stroke_color', stroke_color);\r\n            for (let c = 0; c < num_points; c++) {\r\n                x = polygon[r++];\r\n                y = polygon[r++];\r\n                if (!is_first) {\r\n                    this.draw_line([prev_x, prev_y], [x, y], stroke_color);\r\n                }\r\n                [prev_x, prev_y] = [x, y];\r\n                is_first = false;\r\n\r\n            }\r\n            //x = polygon[r++];\r\n            //y = polygon[r++];\r\n            this.draw_line([prev_x, prev_y], [polygon[0], polygon[1]], stroke_color);\r\n        } else {\r\n            if (stroke_color === 1) {\r\n                if (fill_color === 1) {\r\n                    // A filled polygon\r\n\r\n                    // Get filled polygon x-spans\r\n                    //   Draw those x-spans.\r\n                    return this.draw_color_1_filled_polygon_1bipp(polygon);\r\n\r\n\r\n                    \r\n                } else if (fill_color === 0) {\r\n                    // Needs to be filled with the color 0.\r\n                    //   So basically need to get the outline and the inner shapes, draw them separately.\r\n\r\n                    // Need to get the inner part x-spans.\r\n\r\n                    console.trace();\r\n                    throw 'NYI';\r\n\r\n\r\n\r\n                }\r\n\r\n            } else {\r\n\r\n                if (fill_color === 1) {\r\n\r\n                    // Only want the internal part of it.\r\n                    console.trace();\r\n                    throw 'NYI';\r\n\r\n                } else if (fill_color === 0) {\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                    \r\n                }\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    'draw_polygon'(arr_points, color, fill = false, stroke_color) {\r\n\r\n        const {bits_per_pixel} = this;\r\n\r\n        if (bits_per_pixel === 1) {\r\n\r\n            if (fill === true) {\r\n                if (stroke_color === undefined) {\r\n                    return this.draw_polygon_1bipp(arr_points, color, color);\r\n                } else {\r\n\r\n                    console.trace();\r\n                    throw 'NYI';\r\n\r\n                    if (stroke_color === 1) {\r\n                        //draw_polygon_outline_to_ta_1bipp(this.ta, this.size[0], polygon);\r\n                    } else {\r\n                        \r\n                    }\r\n\r\n                    //\r\n                    \r\n                }\r\n            } else {\r\n                return this.draw_polygon_1bipp(arr_points, color);\r\n\r\n            }\r\n        } else {\r\n            if (fill === true) {\r\n\r\n                // Let's have a faster way to draw these.\r\n                //   Likely will use ta.set to set some larger number of pixels all at once, with 24bipp would need to do a num both divisible by 4 and by 3, so use a factor of 12.\r\n                //     Like 144 bytes at once, ie 48 pixels at once.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n                // Want to try the different 'flood fill inner pixels' for this polygon drawing.\r\n                //  Will before long try on larger images. Maybe much larger too.\r\n\r\n\r\n\r\n                // Iterate scanline spans????\r\n\r\n                const iterate_class_polygon_scanline_spans_implementation = () => {\r\n\r\n                    /*\r\n                    const draw_stroke = () => {\r\n                        //let x, y;\r\n                        let prev_x, prev_y;\r\n                        let is_first = true;\r\n                        for (const [x, y] of arr_points) {\r\n                            //console.log('[x, y]', [x, y]);\r\n                            if (!is_first) {\r\n                                this.draw_line([prev_x, prev_y], [x, y], color);\r\n                            }\r\n                            [prev_x, prev_y] = [x, y];\r\n                            is_first = false;\r\n                        }\r\n                        this.draw_line([prev_x, prev_y], arr_points[0], color);\r\n                    }\r\n                    */\r\n\r\n\r\n                    const draw_filling = () => {\r\n                        const polygon = Polygon.ensure_is(ensure_polygon_is_ta(arr_points));\r\n                        //polygon = polygon);\r\n                    \r\n                        // Create a Polygon_Scanline_Edges instance for the polygon\r\n                        const polygon_scanline_edges = new Polygon_Scanline_Edges(polygon);\r\n                    \r\n                        // Get the size of the target bitmap (e.g., width and height)\r\n                        const [w, h] = this.size;\r\n                    \r\n                        // Create a ScanlineProcessor instance to handle the rendering logic\r\n                        const processor = new ScanlineProcessor(polygon_scanline_edges, w, h, this.ta, { draw_edges: true });\r\n\r\n                        // Create the pre-populated array???\r\n\r\n                        if (bits_per_pixel === 24) {\r\n                            //const ppal = 96 * 3;\r\n                            const ppal = 64 * 3;\r\n                            const pre_populated_array = new Uint8Array(ppal); // 96 pixels, 288 bytes\r\n                \r\n                            for (let i = 0; i < ppal;) {\r\n                                pre_populated_array[i++] = color[0];\r\n                                pre_populated_array[i++] = color[1];\r\n                                pre_populated_array[i++] = color[2];\r\n                            }\r\n\r\n                            for (const [y, x1, x2] of processor.iterate_process()) {\r\n                                this.draw_horizontal_line_24bipp_y_x1_x2(y, x1, x2, color, pre_populated_array, false);\r\n\r\n                            }\r\n                        } else {\r\n                            for (const [y, x1, x2] of processor.iterate_process()) {\r\n                                //console.log('[y, x1, x2]', [y, x1, x2]);\r\n\r\n                                //this.draw_horizontal_line([x1, x2], y, color);\r\n                                this.draw_horizontal_line_y_x1_x2(y, x1, x2, color);\r\n\r\n                                // draw_horizontal_line_y_x1_x2\r\n\r\n                            }\r\n                        }\r\n\r\n                        \r\n                    }\r\n                    //draw_stroke();\r\n                    draw_filling();\r\n                }\r\n\r\n                iterate_class_polygon_scanline_spans_implementation();\r\n            } else {\r\n\r\n                // Should make a much faster implementation.\r\n                //   Will not use set_pixel, but will track the pixel index, work out the offset for whichever move (could look it up from ta of 8) and adjust the pixel index, then do an inline set pixel on the ta.\r\n\r\n\r\n                //let x, y;\r\n                let prev_x, prev_y;\r\n                let is_first = true;\r\n                for (const [x, y] of arr_points) {\r\n                    //console.log('[x, y]', [x, y]);\r\n                    if (!is_first) {\r\n                        this.draw_line([prev_x, prev_y], [x, y], color);\r\n                    }\r\n                    [prev_x, prev_y] = [x, y];\r\n                    is_first = false;\r\n                }\r\n                this.draw_line([prev_x, prev_y], arr_points[0], color);\r\n            }\r\n        }\r\n        \r\n\r\n        // But a filled polygon is more complex to draw.\r\n\r\n\r\n        // go through the points doing draw_line.\r\n\r\n\r\n        // then back to the start.\r\n    }\r\n\r\n    \r\n    \r\n}\r\nmodule.exports = Pixel_Buffer_Core_Draw_Polygons;", "const Pixel_Buffer_Core_Draw_Polygons = require('./pixel-buffer-1.2-core-draw-polygon');\r\nconst Polygon_Scanline_Edges = require('./shapes/Polygon_Scanline_Edges');\r\nconst ScanlineProcessor = require('./shapes/ScanlineProcessor');\r\nclass Pixel_Buffer_Core_Masks extends Pixel_Buffer_Core_Draw_Polygons {\r\n    constructor(spec) {\r\n        super(spec);\r\n    }\r\n    'draw_1bipp_pixel_buffer_mask_1bipp'(pb_1bipp_mask, dest_pos, color) {\r\n        const arr_on_xspans_implementation = () => {\r\n            const arr_rows_arr_on_xspans = pb_1bipp_mask.calculate_arr_rows_arr_x_on_spans_1bipp();\r\n            const [width, height] = pb_1bipp_mask.size;\r\n            const [dest_x, dest_y] = dest_pos;\r\n            if (color === 1) {\r\n                for (let y = 0; y < height; y++) {\r\n                    const target_y = y + dest_y;\r\n                    for (const xonspan of arr_rows_arr_on_xspans[y]) {\r\n                        xonspan[0] += dest_x;\r\n                        xonspan[1] += dest_x;\r\n                        this.draw_horizontal_line_on_1bipp_inclusive(xonspan, target_y);\r\n                    }\r\n                }\r\n            } else {\r\n                for (let y = 0; y < height; y++) {\r\n                    const target_y = y + dest_y;\r\n                    for (const xonspan of arr_rows_arr_on_xspans[y]) {\r\n                        xonspan[0] += dest_x;\r\n                        xonspan[1] += dest_x;\r\n                        this.draw_horizontal_line_off_1bipp_inclusive(xonspan, target_y);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        const bit_realigned_64_bit_implementation = () => {\r\n            const pb_source = pb_1bipp_mask;\r\n            const pb_dest = this;\r\n            const size_source = pb_source.size;\r\n            const w_source = size_source[0];\r\n            const h_source = size_source[1];\r\n            const size_dest = pb_dest.size;\r\n            const w_dest = size_dest[0];\r\n            const iterate_dest_shift_reads = () => {\r\n                const dest_start_pxi = (dest_pos[1] * pb_dest.size[0]) + dest_pos[0];\r\n                const dest_start_row_end_pxi = dest_start_pxi + pb_source.size[0];\r\n                const num_px_from_dest_row_start_to_draw_box_start = dest_pos[0];\r\n                const num_px_from_draw_box_end_to_dest_row_end = pb_dest.size[0] - pb_source.size[0] - num_px_from_dest_row_start_to_draw_box_start;\r\n                const num_px_line_jump = num_px_from_draw_box_end_to_dest_row_end + dest_pos[0];\r\n                const num_ui64_line_jump = (num_px_line_jump >>> 6) - 1; \r\n                const dest_start_i64 = dest_start_pxi >>> 6;\r\n                const dest_start_i64_rb = dest_start_pxi % 64;\r\n                const dest_start_row_end_i64 = dest_start_row_end_pxi >>> 6;\r\n                const num_64_bit_at_least_partial_parts_per_row = (dest_start_row_end_i64 - dest_start_i64) + 1;\r\n                let i64_dest = dest_start_i64;\r\n                let i64_source = 0;\r\n                const y_top = dest_pos[1], y_bottom = y_top + h_source;\r\n                const sta64 = new BigUint64Array(pb_source.ta.buffer, pb_source.ta.byteOffset, pb_source.ta.byteLength / 8);\r\n                const dta64 = new BigUint64Array(pb_dest.ta.buffer, pb_dest.ta.byteOffset, pb_dest.ta.byteLength / 8); \r\n                const bi_dest_start_i64_rb = BigInt(dest_start_i64_rb);\r\n                const bi_right_right_shift_bits = 64n - bi_dest_start_i64_rb;\r\n                const dest_row_middle_ui64_count = num_64_bit_at_least_partial_parts_per_row - 2;\r\n                for (let y = y_top; y < y_bottom; y++) {\r\n                    const process_0th_64bit_part = () => {\r\n                        dta64[i64_dest] = ((dta64[i64_dest] << bi_right_right_shift_bits) >> bi_right_right_shift_bits) | (sta64[i64_source] << bi_dest_start_i64_rb);\r\n                        i64_dest++;\r\n                    }\r\n                    const process_middle_64bit_parts = () => {\r\n                        for (let i_mid = 0; i_mid < dest_row_middle_ui64_count; i_mid++) {\r\n                            dta64[i64_dest++] = (sta64[i64_source] >> bi_right_right_shift_bits) | (sta64[i64_source + 1] << bi_dest_start_i64_rb);\r\n                            i64_source++;\r\n                        }\r\n                    }\r\n                    const process_last_64bit_part = () => {\r\n                        dta64[i64_dest] = (dta64[i64_dest]) | (sta64[i64_source] >> bi_right_right_shift_bits);\r\n                        i64_dest++;\r\n                        i64_source++;\r\n                    }\r\n                    process_0th_64bit_part();\r\n                    process_middle_64bit_parts();\r\n                    process_last_64bit_part();\r\n                    i64_dest += num_ui64_line_jump;\r\n                }\r\n            }\r\n            iterate_dest_shift_reads();\r\n        }\r\n        const test_can_do_aligned_64_bit = () => (this.bits_per_row % 64 === 0 && this.bits_per_row >= 64) && \r\n            (dest_pos[1] * pb_1bipp_mask.size[0] + dest_pos[0]) % 64 === 0 &&\r\n            pb_1bipp_mask.bits_per_row % 64 === 0 && pb_1bipp_mask.bits_per_row >= 64;\r\n        const test_can_do_bit_realigned_64_bit = () => (this.bits_per_row % 64 === 0 && this.bits_per_row >= 64) && \r\n        pb_1bipp_mask.bits_per_row % 64 === 0 && pb_1bipp_mask.bits_per_row >= 64;\r\n        const approach_selecting = () => {\r\n            {\r\n                const can_do_bit_realigned_64_bit = test_can_do_bit_realigned_64_bit();\r\n                if (can_do_bit_realigned_64_bit) {\r\n                    return arr_on_xspans_implementation();\r\n                } else {\r\n                    return arr_on_xspans_implementation();\r\n                }\r\n            }\r\n        }\r\n        return approach_selecting();\r\n    }\r\n    'draw_1bipp_pixel_buffer_mask'(pb_1bipp_mask, dest_pos, color) {\r\n        const {bipp} = this;\r\n        if (bipp === 1) {\r\n            return this.draw_1bipp_pixel_buffer_mask_1bipp(pb_1bipp_mask, dest_pos, color);\r\n        } else {\r\n            const arr_on_xspans_implementation = () => {\r\n                //let arr_rows_arr_on_xspans;\r\n                /*\r\n                if (pb_1bipp_mask.arr_rows_arr_on_xspans) {\r\n\r\n                } else {\r\n                    pb_1bipp_mask.arr_rows_arr_on_xspans = pb_1bipp_mask.calculate_arr_rows_arr_x_on_spans_1bipp();\r\n                }\r\n\r\n                const arr_rows_arr_on_xspans = pb_1bipp_mask.arr_rows_arr_on_xspans;\r\n                */\r\n\r\n                const arr_rows_arr_on_xspans = pb_1bipp_mask.calculate_arr_rows_arr_x_on_spans_1bipp();\r\n                const [width, height] = pb_1bipp_mask.size;\r\n                let y = 0;\r\n                let [dest_x, dest_y] = dest_pos;\r\n                for (y = 0; y < height; y++) {\r\n                    const arr_row_xspans_on = arr_rows_arr_on_xspans[y];\r\n                    if (arr_row_xspans_on.length > 0) {\r\n                        for (const xonspan of arr_row_xspans_on) {\r\n                            xonspan[0] += dest_x;\r\n                            xonspan[1] += dest_x;\r\n                            this.draw_horizontal_line(xonspan, y + dest_y, color);\r\n                        }\r\n                    }\r\n                }\r\n                //pb_1bipp_mask.arr_rows_arr_on_xspans = undefined;\r\n            }\r\n            return arr_on_xspans_implementation();\r\n        }\r\n    }\r\n    mask_each_pixel(cb_pixel) {\r\n        const bipp = this.bits_per_pixel;\r\n        let i_byte = 0;\r\n        let i_px = 0;\r\n        const bypp = this.bytes_per_pixel;\r\n        const ta = this.ta;\r\n        const l = ta.length;\r\n        const res_mask = new this.constructor({\r\n            size: this.size,\r\n            bits_per_pixel: 1\r\n        });\r\n        if (bipp === 1) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 24 || bipp === 32) {\r\n            while (i_byte < l) {\r\n                const ta_sub = ta.slice(i_byte, i_byte + bypp);\r\n                const px_on = cb_pixel(ta_sub) ? 1 : 0;\r\n                res_mask.set_pixel_by_idx(i_px, px_on);\r\n                i_byte += bypp;\r\n                i_px++;\r\n            }\r\n        }\r\n        return res_mask;\r\n    }\r\n    apply_mask(pb_mask, mr, mg, mb, ma) {\r\n        let res = this.blank_copy();\r\n        res.flood_fill(0, 0, 255, 255, 255, 255);\r\n        let px;\r\n        pb_mask.each_pixel((x, y, r, g, b, a) => {\r\n            if (r === mr && g === mg && b === mb && a === ma) {\r\n                px = this.get_pixel(x, y);\r\n                res.set_pixel(x, y, px[0], px[1], px[2], px[3])\r\n            }\r\n        })\r\n        return res;\r\n    }\r\n    'get_mask_each_px'(fn_mask) {\r\n        const bipp = this.bipp;\r\n        console.log('get_mask_each_px bipp', bipp);\r\n        const res_mask = new this.constructor({\r\n            size: this.size,\r\n            bits_per_pixel: 1\r\n        })\r\n        if (bipp === 1) {\r\n            let byte = 0,\r\n                bit = 0; \r\n            console.trace();\r\n            throw 'NYI'\r\n            const ta = this.ta,\r\n                l = ta.length;\r\n            while (byte < l) {\r\n            }\r\n        } else if (bipp === 8) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 24) {\r\n            let byte_pos = 0,\r\n                i_px = 0;\r\n            const l = this.ta.length;\r\n            while (byte_pos < l) {\r\n                const ta_px = this.ta.slice(byte_pos, byte_pos + 3);\r\n                const mask_res = fn_mask(ta_px);\r\n                byte_pos += 3;\r\n            }\r\n        } else if (bipp === 32) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n        return res_mask;\r\n    }\r\n}\r\nmodule.exports = Pixel_Buffer_Core_Masks;", "/*\r\n    Maybe want an Image class that internally uses both Pixel_Buffer as well as X_Spans.\r\n    Being able to handle multiple modes could be useful.\r\n    Some modes will be more optimal for some operations.\r\n    Drawing X_Spans will be sometimes a lot faster than drawing pixels.\r\n    Then could get the output as a pixel buffer.\r\n    Could keep one specific data structure up-to-date, and then when another representation is needed it renders the image into that\r\n    data structure.\r\n    May want to move some higher level algorithms upwards - ones that could work on top of either image type so long as there are\r\n    lower level functions that do things like set_pixel.\r\n    Could have optimised implementations for some things what work on those data structures.\r\n    Static_X_Spans - Would be a good format to represent a shape. Maybe good format for saving to disk.\r\n    Dynamic_X_Spans - Would be a good format for drawing a shape. Probably good for flood fills and other operations that modify the image.\r\n        Dynamic_X_Spans seems more useful for the moment.\r\n    Pixel_Buffer_Core could possibly use Dynamic_X_Spans when it does a draw_pollygon filled operation.\r\n        The X_Spans idea came about as a way to do faster flood fills.\r\n        A highly optimised Dynamic_X_Spans should be particularly useful for this.\r\n            Flood fills will remove / join together some X Spans.\r\n    Maybe Pixel_Buffer_Enh will use these Dynamic_X_Spans in order to do some things quicker (too)\r\n    Polygon shape drawing seems core in terms of API, but somewhat higher level compared to some other features and algorithms.\r\n    Possibly a Polygon that could draw itself to image data structures would work well.\r\n*/\r\n/*\r\n    1 Small / trivial change\r\n       2 mins going on 10 mins\r\n    2  Small change\r\n       5 mins going on 30 mins\r\n    3  Medium-Small task\r\n       15 mins going on 1.5h\r\n       could be an easier version of a 4 - needs an optimized algorithm to be written and tested, it doesnt require further R&D.\r\n    4\r\n       45 mins going on 4.5(+)h\r\n        as in could be an underestimated 5?\r\n        may require thinking about maths & optimization\r\n    5 Moderate - a few hours\r\n        2 hours if it turns out to be relatively easy\r\n        going on a day\r\n    6\r\n        0.5 days to 3 days\r\n    7   (some level of overhaul or new API design involved)\r\n        1.5 days to 1 week\r\n    8  \r\n        1 week to 3 weeks\r\n    9 Programming / API overhaul\r\n        3 weeks to 6 weeks\r\n    10 Huge overhaul / major rewrite / a medium-large project of its own\r\n        1 month to 3 months\r\n*/\r\n/*\r\nconst _roadmap = {\r\n    '0.0.22': [\r\n        ['pb.bypp = 1 convert to greyscale', 'done', 3, 'Medium small task requiring writing of optimized algorithm']\r\n    ],\r\n    '0.0.23': [\r\n        'Convolutions', \r\n        `\r\n        Task Size and Complexity Measure: 5 changed to 6.5\r\n            Going into a larger properties overhaul - new size 6 or 7\r\n        Rethinking and implementing pos_bounds\r\n            pos_within_source_bounds\r\n        Rename pos\r\n            pos_within_source\r\n            In this case, can't assume all positions are relative to the self pb, so need to be extra explicit in the variable names regarding what they relate to.\r\n        Consider other pos type variables. Explicit names for what they do.\r\n            pos_iteration_within_self\r\n            pos_cursor_within_self\r\n        Better to have more API-based centering, and adjust the central position?\r\n            Possibly not best for convolution, for perf reasons.\r\n            Don't want more calculations done during iteration...?\r\n            Maybe don't need to deal with centering as directly right now?\r\n                Seems useful for convolutions, centering the window of the px is a core part of the convolution logic. Worth having the platform support it as easily as possible.\r\n        new_window\r\n            implemented\r\n        new_centered_window() ???\r\n            NOT doing this for the moment. done new_window\r\n            centered on 0,0.\r\n            center of that window corresponds to a pixel in this window.\r\n            bounds determined...\r\n                does make sense for the moment.\r\n                implement this fn, makes sense for convs right now.\r\n            get_conv_window?\r\n        new_convolved(convolution) - using this.\r\n        `\r\n        ['window view into specific channel?'],\r\n        ['run convolution on 8bipp image?', 'maybe', 'not yet'],\r\n        ['Convolution Class', ],\r\n        ['Bug fix move_next_px, need to use boundary ranges for proper movement of the window within a source', 4, [\r\n            ['cancelled - doing pb.pos_bounds', 'pb.window_movement_bounds', `\r\n                Need to make / finish function\r\n                Considering different types of bounds\r\n            `],\r\n            ['pos_bounds', `\r\n                consider iterate_pos_within_bounds\r\n                just each_pos_px?\r\n                As well as positions, need to properly calculate iteration values and indexes.\r\n                Put these into a typed array, access them through use of a function\r\n            `]\r\n        ]]\r\n    ],\r\n    '0.0.24': [\r\n        'Moving of mathematical code to ta_math where possible and suitable.',\r\n        'Current size: >6000 lines. Can it be brought down to 1000? Still kept v performant?',\r\n        ['new_resized', 'clearly creates a new pb']\r\n    ],\r\n    '0.0.25': [\r\n        'Improvements / optimization to resize',\r\n        'Facilitate usage of C++ acceleration.'\r\n    ]\r\n}\r\n*/\r\nconst lang = require('lang-mini');\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\nconst maxui64 = ~0n;\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst oext = require('obext');\r\nconst {ro, prop} = oext;\r\nconst Typed_Array_Binary_Read_Write = require('./Typed_Array_Binary_Read_Write');\r\nconst Pixel_Buffer_Painter = require('./pixel-buffer-painter');\r\nlet ta_math = require('./ta-math')\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp} = ta_math;\r\n\r\nconst Pixel_Buffer_Core_Masks = require('./pixel-buffer-1.5-core-mask');\r\n\r\nclass Pixel_Buffer_Core_Reference_Implementations extends Pixel_Buffer_Core_Masks {\r\n    constructor(spec) {\r\n        if (spec instanceof Pixel_Buffer_Core_Reference_Implementations) {\r\n            spec = {\r\n                bits_per_pixel: spec.bits_per_pixel,\r\n                size: spec.size,\r\n                ta: spec.ta\r\n            }\r\n        }\r\n        let silent_update_bits_per_pixel;\r\n        let silent_update_bytes_per_pixel;\r\n        if (spec.window_to) {\r\n            spec.bits_per_pixel = spec.window_to.bits_per_pixel;\r\n        }\r\n        const pos = new Int16Array(2);\r\n        const size = new Int16Array(2);\r\n        let ta; // flexible, can be redefined? Can still make read-only in userland.\r\n\r\n        super(spec);\r\n\r\n        \r\n        \r\n        this.move = ta_2d_vector => {\r\n            pos[0] += ta_2d_vector[0];\r\n            pos[1] += ta_2d_vector[1];\r\n            if (this.source) {\r\n                this.copy_from_source();\r\n            }\r\n        }\r\n        this.each_pos_within_bounds = (callback) => {\r\n            const has_source = !!this.source;\r\n            for (pos[1] = pos_bounds[1]; pos[1] < pos_bounds[3]; pos[1] ++) {\r\n                for (pos[0] = pos_bounds[0]; pos[0] < pos_bounds[2]; pos[0] ++) {\r\n                    if (has_source) this.copy_from_source();\r\n                    callback();\r\n                }\r\n            }\r\n        }\r\n        this.move_next_px = () => {\r\n            const source_size = this.source.size;\r\n            if (pos[0] + size[0] < source_size[0]) {\r\n                pos[0]++;\r\n            } else {\r\n                if (pos[1] + size[1] < source_size[1]) {\r\n                    pos[0] = 0;\r\n                    pos[1]++;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n            if (this.source) {\r\n                this.copy_from_source();\r\n            }\r\n            return pos;\r\n        }\r\n        this.paint = new Pixel_Buffer_Painter({\r\n            pb: this\r\n        });\r\n    }\r\n\r\n    // Some will need to be a bit more optimised for perf rather than readability. Do want clear code though.\r\n\r\n    // Not quite sure why this is failing on 1 bipp right now....\r\n\r\n    each_pixel(callback) {\r\n        // Want optimised but still idiomatic\r\n        const {ta_pos_scratch, bipp, bypp, size, ta} = this;\r\n\r\n        // And a ta_color_scratch perhaps?\r\n        //   ta_24bipp_color_scratch maybe...\r\n        //   ta_rgb or ta_rgba?\r\n        //    number of bits makes more sense. more flexible.\r\n\r\n        // Could call each_pixel_pos, and increment a byte index.\r\n\r\n        // read_bit_from_byte\r\n\r\n        //const bfb = (byte, bit_index) => (byte >> bit_index) & 1;\r\n\r\n        if (bipp === 1) {\r\n\r\n            // Should not be too hard to implement....\r\n\r\n            //let i_pixel = 0;\r\n            // and the number of pixels....\r\n            const [w, h] = size;\r\n\r\n            let i_byte = 0, i_bit = 0;\r\n            //let input_byte = ta[0];\r\n\r\n            const ta_cb_pos = new Uint32Array(2);\r\n\r\n            for (let y = 0; y < h; y++) {\r\n                ta_cb_pos[1] = y;\r\n                for (let x = 0; x < w; x++) {\r\n                    ta_cb_pos[0] = x;\r\n                    //const px_color = (input_byte >> i_bit) & 1;\r\n                    // not sure why this is not working right.\r\n\r\n                    const got_px_color = this.get_pixel_1bipp(ta_cb_pos);\r\n\r\n                    \r\n                    callback(ta_cb_pos, got_px_color);\r\n\r\n                    //i_bit++;\r\n                    if (i_bit === 8) {\r\n                        //i_byte++;\r\n                        //i_bit = 0;\r\n                        //input_byte = ta[i_byte];\r\n                    }\r\n                    //i_pixel++;\r\n                }\r\n\r\n            }\r\n\r\n\r\n            \r\n\r\n\r\n\r\n            //console.trace();\r\n            //throw 'NYI';\r\n        } else if (bipp === 8) {\r\n            // Function to iterate through positions could work.\r\n            // Nested for loops seems a bit simpler...\r\n            //ta_pos_scratch[0] = 0;\r\n            //ta_pos_scratch[1] = 0;\r\n            let pixel_idx = 0;\r\n            this.each_pixel_pos((pos, stop) => {\r\n                callback(pos, ta[pixel_idx++], stop);\r\n            });\r\n            //\r\n\r\n\r\n        } else if (bipp === 24) {\r\n            // Provide direct access with a subarray?\r\n            //  Could be better for idiomatic writing.\r\n            //  Though setting values would maybe / likely be quicker and mean less allocations.\r\n\r\n            const {ta_24bit_color} = this;\r\n            let byte_idx = 0;\r\n            this.each_pixel_pos((pos, stop) => {\r\n                ta_24bit_color[0] = ta[byte_idx++];\r\n                ta_24bit_color[1] = ta[byte_idx++];\r\n                ta_24bit_color[2] = ta[byte_idx++];\r\n                callback(pos, ta_24bit_color, stop);\r\n            });\r\n\r\n        } else if (bipp === 32) {\r\n            const {ta_32bit_color} = this;\r\n            let byte_idx = 0;\r\n            this.each_pixel_pos((pos, stop) => {\r\n                ta_32bit_color[0] = ta[byte_idx++];\r\n                ta_32bit_color[1] = ta[byte_idx++];\r\n                ta_32bit_color[2] = ta[byte_idx++];\r\n                ta_32bit_color[3] = ta[byte_idx++];\r\n                callback(pos, ta_32bit_color, stop);\r\n            });\r\n        }\r\n\r\n        // Could advance through the positions?\r\n        // Advancing through bit indexes.\r\n\r\n    }\r\n\r\n    'to_8bit_greyscale'() {\r\n        if (this.bytes_per_pixel === 1) {\r\n            return this;\r\n        } else if (this.bytes_per_pixel === 3) {\r\n            const res = new this.constructor({\r\n                'size': this.size,\r\n                'bits_per_pixel': 8\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            const bres = res.buffer;\r\n            let i = 0;\r\n            this.each_pixel((pos, color) => {\r\n                bres[i++] = Math.round((color[0] + color[1] + color[2]) / 3);\r\n            });\r\n            return res;\r\n        } else if (this.bytes_per_pixel === 4) {\r\n            const res = new this.constructor({\r\n                'size': this.size,\r\n                'bits_per_pixel': 8\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            const bres = res.buffer;\r\n            let i = 0;\r\n            this.each_pixel((pos, color) => {\r\n                bres[i++] = Math.round((color[0] + color[1] + color[2]) / 3);\r\n            });\r\n            return res;\r\n        }\r\n    }\r\n    'to_32bit_rgba'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 32\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        const bres = res.buffer;\r\n        if (this.bytes_per_pixel === 1) {\r\n            let i = 0, new_v;\r\n            this.each_pixel((pos, v) => {\r\n                bres[i++] = v;\r\n                bres[i++] = v;\r\n                bres[i++] = v;\r\n                bres[i++] = 255;\r\n            });\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n        return res;\r\n    }\r\n    '__invert_greyscale_self'() {\r\n        const bres = this.buffer;\r\n        let i = 0;\r\n        this.each_pixel((x, y, v) => {\r\n            bres[i++] = 255 - v;\r\n        });\r\n        return this;\r\n    }\r\n    '__invert_greyscale'() {\r\n        let res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 8\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        const bres = res.buffer;\r\n        let i = 0;\r\n        this.each_pixel((x, y, v) => {\r\n            bres[i++] = 255 - v;\r\n        });\r\n        return res;\r\n    }\r\n\r\n    // Could have a 'paint' file / module.\r\n    'paint_solid_border'(thickness, color) {\r\n\r\n        // separate methods for different bipps, this fn chooses one?\r\n\r\n        return this.process((me, res) => {\r\n            let x, y;\r\n            const [w, h] = this.size;\r\n            if (this.bytes_per_pixel === 4) {\r\n                // top two rows\r\n                for (y = 0; y < thickness; y++) {\r\n                    for (x = 0; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2], color[3]);\r\n                    }\r\n                }\r\n                for (y = h - thickness; y < h; y++) {\r\n                    for (x = 0; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2], color[3]);\r\n                    }\r\n                }\r\n                for (y = 0; y < h; y++) {\r\n                    for (x = 0; x < thickness; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2], color[3]);\r\n                    }\r\n                }\r\n                for (y = 0; y < h; y++) {\r\n                    for (x = w - thickness; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2], color[3]);\r\n                    }\r\n                }\r\n            } else if (this.bytes_per_pixel === 3) {\r\n                // top two rows\r\n                for (y = 0; y < thickness; y++) {\r\n                    for (x = 0; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2]);\r\n                    }\r\n                }\r\n                for (y = h - thickness; y < h; y++) {\r\n                    for (x = 0; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2]);\r\n                    }\r\n                }\r\n                for (y = 0; y < h; y++) {\r\n                    for (x = 0; x < thickness; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2]);\r\n                    }\r\n                }\r\n                for (y = 0; y < h; y++) {\r\n                    for (x = w - thickness; x < w; x++) {\r\n                        res.set_pixel(x, y, color[0], color[1], color[2]);\r\n                    }\r\n                }\r\n            } else {\r\n                console.trace();\r\n                throw 'NYI';\r\n            }\r\n            return res;\r\n        })\r\n    }\r\n\r\n    new_convolved(convolution) {\r\n        const res = this.blank_copy();\r\n        const xy_conv_center = convolution.xy_center;\r\n        const edge_distances_from_center_px_edge = new Int16Array(4);\r\n        edge_distances_from_center_px_edge[0] = xy_conv_center[0] * -1;\r\n        edge_distances_from_center_px_edge[1] = xy_conv_center[1] * -1;\r\n        edge_distances_from_center_px_edge[2] = edge_distances_from_center_px_edge[0] + convolution.size[0] - 1;\r\n        edge_distances_from_center_px_edge[3] = edge_distances_from_center_px_edge[1] + convolution.size[1] - 1;\r\n        const pb_window = this.new_window({\r\n            size: convolution.size,\r\n            pos_bounds: [edge_distances_from_center_px_edge[0], edge_distances_from_center_px_edge[1], this.size[0] - edge_distances_from_center_px_edge[2], this.size[1] - edge_distances_from_center_px_edge[3]],\r\n            pos: [edge_distances_from_center_px_edge[0], edge_distances_from_center_px_edge[1]]\r\n        });\r\n        const pos_window = pb_window.pos;\r\n        const ta_window = pb_window.ta;\r\n        /*\r\n        const pb_conv_res = new Pixel_Buffer({\r\n            size: pb_8bipp_patch.size,\r\n            bits_per_pixel: 24\r\n        });\r\n        */\r\n        let i_write = 0;\r\n        const ta_conv_res = res.ta;\r\n        pb_window.each_pos_within_bounds(() => {\r\n            const rgb = convolution.calc_from_24bipp_ta(ta_window);\r\n            ta_conv_res[i_write++] = rgb[0];\r\n            ta_conv_res[i_write++] = rgb[1];\r\n            ta_conv_res[i_write++] = rgb[2];\r\n        });\r\n        return res;\r\n    }\r\n    new_resized(size) {\r\n        const dest = new this.constructor({\r\n            size: size,\r\n            bits_per_pixel: this.bipp\r\n        });\r\n        resize_ta_colorspace(this.ta, this.ta_colorspace, dest.size, dest.ta);\r\n        return dest;\r\n    }\r\n    copy_rect_by_bounds_to(ta_bounds, pb_target) {\r\n        console.log('pb.copy_rect_by_bounds_to');\r\n        const bipp = this.bipp;\r\n        if (bipp === 24) {\r\n            return this.copy_rect_by_bounds_to_24bipp(ta_bounds, pb_target)\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    each_px_convolution(ta_size, pb_conv_window, ta_pos, callback) {\r\n        console.trace();\r\n        throw 'NYI';\r\n        ta_pos[0] = 0;\r\n        ta_pos[1] = 0;\r\n        if (are_equal(pb_conv_window.size, ta_size)) {\r\n        } else {\r\n        }\r\n    }\r\n    \r\n    toString() {\r\n        /*\r\n        size: Uint32Array [ 1024, 576 ],\r\n        bits_per_pixel: 32,\r\n        bytes_per_pixel: 4,\r\n        bytes_per_row: 4096 }\r\n        */\r\n        return JSON.stringify({\r\n            buffer: 'Uint8ClampedArray length ' + this.buffer.length,\r\n            size: this.size,\r\n            bits_per_pixel: this.bits_per_pixel,\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            bytes_per_row: this.bytes_per_row\r\n        });\r\n    }\r\n    /*\r\n    [inspect]() {\r\n        return 'Pixel_Buffer_Core ' + this.toString();\r\n    }\r\n    */\r\n    color_whole(color) {\r\n        this.each_px(pos => {\r\n            this.set_pixel(pos, color);\r\n        })\r\n        return this;\r\n    }\r\n    crop(size) {\r\n        let new_size = new Uint16Array([this.size[0] - size * 2, this.size[1] - size * 2]);\r\n        let res = new this.constructor({\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            size: new_size\r\n        });\r\n        if (this.pos) {\r\n            res.pos = new Int16Array([this.pos[0] - size, this.pos[1] - size])\r\n        }\r\n        this.each_pixel_ta((pos, color) => {\r\n            const new_pos = new Int16Array([pos[0] - size, pos[1] - size]);\r\n            if (new_pos[0] >= 0 && new_pos[0] < new_size[0] && new_pos[1] >= 0 && new_pos[1] < new_size[1]) {\r\n                res.set_pixel_ta(new_pos, color);\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n    uncrop(size, color) {\r\n        let res = new this.constructor({\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            size: new Uint16Array([this.size[0] + size * 2, this.size[1] + size * 2])\r\n        })\r\n        if (this.pos) res.pos = this.pos;\r\n        if (this.pos) {\r\n        }\r\n        res.color_whole(color);\r\n        console.log('size', size);\r\n        this.each_pixel_ta((pos, color) => {\r\n            res.set_pixel_ta(new Uint16Array([pos[0] + size, pos[1] + size]), color);\r\n        })\r\n        return res;\r\n    }\r\n    color_rect(bounds, color) {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n    each_pixel_byte_index(cb) {\r\n        const {bipp} = this;\r\n        let ctu = true;\r\n        const stop = () => ctu = false;\r\n\r\n        // .num_pixels????\r\n\r\n        const [w, h] = this.size;\r\n        const num_pixels = w * h;\r\n\r\n        let bit_idx = 0, byte_idx = bit_idx >> 3;\r\n\r\n        for (let c = 0; c < num_pixels; c++) {\r\n\r\n            byte_idx = bit_idx >> 3;\r\n            cb(byte_idx);\r\n\r\n\r\n\r\n        }\r\n    }\r\n    each_px(callback) {\r\n\r\n\r\n        const ta_pos = new Int32Array(2);\r\n\r\n\r\n        const [w, h] = this.size;\r\n        //let x, y;\r\n\r\n        // (pos, color, index) would be good callback format.\r\n        let index = 0;\r\n\r\n        for (ta_pos[1] = 0; ta_pos[1] < h; ta_pos[1]++) {\r\n            for (ta_pos[0] = 0; ta_pos[0] < w; ta_pos[0]++) {\r\n                const color = this.get_pixel(ta_pos);\r\n                //ta_px_value[0] = px;\r\n                callback(ta_pos, color, index++);\r\n            }\r\n        }\r\n    }\r\n    paint_pixel_list(pixel_pos_list, color) {\r\n        pixel_pos_list.each_pixel(pos => {\r\n            this.set_pixel_ta(pos, color);\r\n        });\r\n    }\r\n    \r\n\r\n    // Maybe a class level that has get and set pixel logic for the different bipps at this level.\r\n\r\n\r\n\r\n\r\n    get num_px() {\r\n        return this.size[0] * this.size[1];\r\n    }\r\n    get split_rgb_channels() {\r\n        const [bipp, bypp] = [this.bits_per_pixel, this.bytes_per_pixel];\r\n        if (bipp === 24 || bipp === 32) {\r\n            const res = [new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            })]\r\n            const [r, g, b] = res;\r\n            let i_px = 0;\r\n            const num_px = this.num_px;\r\n            let i_byte = 0;\r\n            const [ta_r, ta_g, ta_b] = [r.ta, g.ta, b.ta];\r\n            const ta = this.ta;\r\n            while (i_px < num_px) {\r\n                ta_r[i_px] = ta[i_byte];\r\n                ta_g[i_px] = ta[i_byte + 1];\r\n                ta_b[i_px] = ta[i_byte + 2];\r\n                i_px++;\r\n                i_byte += bypp;\r\n            }\r\n            return res;\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    process(fn) {\r\n        let res = this.clone();\r\n        return fn(this, res);\r\n    }\r\n    /*\r\n    function typedArraysAreEqual(a, b) {\r\nif (a.byteLength !== b.byteLength) return false;\r\nreturn a.every((val, i) => val === b[i]);\r\n}\r\n    */\r\n    equals(other_pixel_buffer) {\r\n        let buf1 = this.ta;\r\n        let buf2 = other_pixel_buffer.ta;\r\n        const other_colorspace = other_pixel_buffer.ta_colorspace;\r\n        const my_colorspace = other_pixel_buffer.ta_colorspace;\r\n        if (my_colorspace.length === other_colorspace.length) {\r\n            if(my_colorspace.every((val, i) => val === other_colorspace[i])) {\r\n                if (buf1.length === buf2.length) {\r\n                    return buf1.every((val, i) => val === buf2[i]);\r\n                } else {\r\n                }\r\n            } else {\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    copy_pixel_pos_list_region(pixel_pos_list, bg_color) {\r\n        let bounds = pixel_pos_list.bounds;\r\n        let size = new Uint16Array([bounds[2] - bounds[0] + 1, bounds[3] - bounds[1] + 1]);\r\n        const res = new this.constructor({\r\n            size: size,\r\n            bytes_per_pixel: this.bytes_per_pixel\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        if (bg_color) {\r\n            res.color_whole(bg_color);\r\n        }\r\n        res.pos = new Int16Array([bounds[0], bounds[1]]);\r\n        pixel_pos_list.each_pixel((pos) => {\r\n            let color = this.get_pixel_ta(pos);\r\n            const target_pos = new Int16Array([(pos[0] - bounds[0]), (pos[1] - bounds[1])]);\r\n            res.set_pixel_ta(target_pos, color);\r\n        });\r\n        return res;\r\n    }\r\n\r\n\r\n    // Pixel_Buffer_Pair_Complex_Operation class possibly?\r\n    //   Or just Operation.\r\n\r\n\r\n\r\n    // get_pre_operation_alignment_info ....\r\n\r\n\r\n    \r\n    // And could define such a class which has got requirements / invarients to do with \r\n\r\n\r\n\r\n    // This is used when drawing filled polygons.\r\n\r\n    \r\n    'blank_copy'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel\r\n        });\r\n        res.buffer.fill(0);\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'clone'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel,\r\n            'buffer': new this.buffer.constructor(this.buffer)\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'add_alpha_channel'() {\r\n        //console.log('add_alpha_channel this.bytes_per_pixel', this.bytes_per_pixel);\r\n        if (this.bytes_per_pixel === 3) {\r\n            var res = new this.constructor({\r\n                'size': this.size,\r\n                'bytes_per_pixel': 4\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            /*\r\n            this.each_pixel((x, y, r, g, b) => {\r\n                res.set_pixel(x, y, r, g, b, 255);\r\n            });\r\n            */\r\n            const buf = this.buffer,\r\n                res_buf = res.buffer;\r\n            const px_count = this.size[0] * this.size[1];\r\n            let i = 0,\r\n                ir = 0;\r\n            for (let p = 0; p < px_count; p++) {\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = 255;\r\n            }\r\n            return res;\r\n        }\r\n        if (this.bytes_per_pixel === 4) {\r\n            return this;\r\n        }\r\n    }\r\n    \r\n    draw_rect(pos_corner, pos_other_corner, color) {\r\n        /*\r\n        const paint_bounds = new Int16Array([20, 300, 180, 320]);\r\n        const paint_color = new Uint8ClampedArray([255, 0, 0]);\r\n        ta_math.fill_solid_rect_by_bounds(pb_dest.ta, pb_dest.bytes_per_row, paint_bounds, 24, paint_color);\r\n        */\r\n        const l = Math.min(pos_corner[0], pos_other_corner[0]);\r\n        const t = Math.min(pos_corner[1], pos_other_corner[1]);\r\n        const r = Math.max(pos_corner[0], pos_other_corner[0]);\r\n        const b = Math.max(pos_corner[1], pos_other_corner[1]);\r\n        //const paint_bounds = new Int16Array([20, 300, 180, 320]);\r\n        //const paint_color = new Uint8ClampedArray([255, 0, 0]);\r\n        const xspan = [l, r];\r\n        for (let y = t; y <= b; y++) {\r\n            this.draw_horizontal_line(xspan, y, color);\r\n        }\r\n    }\r\n    * 'iterate_arr_row_x_on_spans_1bipp'(y) {\r\n    }\r\n    get xspans() {\r\n    }\r\n}\r\nmodule.exports = Pixel_Buffer_Core_Reference_Implementations;\r\nif (require.main === module) {\r\n    const lg = console.log;\r\n    (async() => {\r\n        const run_examples = async() => {\r\n            lg('Begin run examples');\r\n            const examples = [\r\n                async() => {\r\n                    lg('Begin example 0');\r\n                    const pb = new Pixel_Buffer_Core_Reference_Implementations({\r\n                        bits_per_pixel: 1,\r\n                        size: [8, 8]\r\n                    });\r\n                    const ta_pos = new Int16Array(2);\r\n                    ta_pos[0] = 3;\r\n                    ta_pos[1] = 3;\r\n                    pb.set_pixel(ta_pos, 1);\r\n                    lg('End example 0');\r\n                    return pb;\r\n                }\r\n            ]\r\n            const l = examples.length;\r\n            for (var c = 0; c < l; c++) {\r\n                const res_eg = await examples[c]();\r\n                console.log('res_eg ' + c + ':', res_eg);\r\n            };\r\n            lg('End run examples');\r\n        }\r\n        await run_examples();\r\n    })();\r\n}\r\n", "/*\r\n    Maybe want an Image class that internally uses both Pixel_Buffer as well as X_Spans.\r\n    Being able to handle multiple modes could be useful.\r\n    Some modes will be more optimal for some operations.\r\n    Drawing X_Spans will be sometimes a lot faster than drawing pixels.\r\n    Then could get the output as a pixel buffer.\r\n    Could keep one specific data structure up-to-date, and then when another representation is needed it renders the image into that\r\n    data structure.\r\n    May want to move some higher level algorithms upwards - ones that could work on top of either image type so long as there are\r\n    lower level functions that do things like set_pixel.\r\n    Could have optimised implementations for some things what work on those data structures.\r\n    Static_X_Spans - Would be a good format to represent a shape. Maybe good format for saving to disk.\r\n    Dynamic_X_Spans - Would be a good format for drawing a shape. Probably good for flood fills and other operations that modify the image.\r\n        Dynamic_X_Spans seems more useful for the moment.\r\n    Pixel_Buffer_Core could possibly use Dynamic_X_Spans when it does a draw_pollygon filled operation.\r\n        The X_Spans idea came about as a way to do faster flood fills.\r\n        A highly optimised Dynamic_X_Spans should be particularly useful for this.\r\n            Flood fills will remove / join together some X Spans.\r\n    Maybe Pixel_Buffer_Enh will use these Dynamic_X_Spans in order to do some things quicker (too)\r\n    Polygon shape drawing seems core in terms of API, but somewhat higher level compared to some other features and algorithms.\r\n    Possibly a Polygon that could draw itself to image data structures would work well.\r\n*/\r\n/*\r\n    1 Small / trivial change\r\n       2 mins going on 10 mins\r\n    2  Small change\r\n       5 mins going on 30 mins\r\n    3  Medium-Small task\r\n       15 mins going on 1.5h\r\n       could be an easier version of a 4 - needs an optimized algorithm to be written and tested, it doesnt require further R&D.\r\n    4\r\n       45 mins going on 4.5(+)h\r\n        as in could be an underestimated 5?\r\n        may require thinking about maths & optimization\r\n    5 Moderate - a few hours\r\n        2 hours if it turns out to be relatively easy\r\n        going on a day\r\n    6\r\n        0.5 days to 3 days\r\n    7   (some level of overhaul or new API design involved)\r\n        1.5 days to 1 week\r\n    8  \r\n        1 week to 3 weeks\r\n    9 Programming / API overhaul\r\n        3 weeks to 6 weeks\r\n    10 Huge overhaul / major rewrite / a medium-large project of its own\r\n        1 month to 3 months\r\n*/\r\n/*\r\nconst _roadmap = {\r\n    '0.0.22': [\r\n        ['pb.bypp = 1 convert to greyscale', 'done', 3, 'Medium small task requiring writing of optimized algorithm']\r\n    ],\r\n    '0.0.23': [\r\n        'Convolutions', \r\n        `\r\n        Task Size and Complexity Measure: 5 changed to 6.5\r\n            Going into a larger properties overhaul - new size 6 or 7\r\n        Rethinking and implementing pos_bounds\r\n            pos_within_source_bounds\r\n        Rename pos\r\n            pos_within_source\r\n            In this case, can't assume all positions are relative to the self pb, so need to be extra explicit in the variable names regarding what they relate to.\r\n        Consider other pos type variables. Explicit names for what they do.\r\n            pos_iteration_within_self\r\n            pos_cursor_within_self\r\n        Better to have more API-based centering, and adjust the central position?\r\n            Possibly not best for convolution, for perf reasons.\r\n            Don't want more calculations done during iteration...?\r\n            Maybe don't need to deal with centering as directly right now?\r\n                Seems useful for convolutions, centering the window of the px is a core part of the convolution logic. Worth having the platform support it as easily as possible.\r\n        new_window\r\n            implemented\r\n        new_centered_window() ???\r\n            NOT doing this for the moment. done new_window\r\n            centered on 0,0.\r\n            center of that window corresponds to a pixel in this window.\r\n            bounds determined...\r\n                does make sense for the moment.\r\n                implement this fn, makes sense for convs right now.\r\n            get_conv_window?\r\n        new_convolved(convolution) - using this.\r\n        `\r\n        ['window view into specific channel?'],\r\n        ['run convolution on 8bipp image?', 'maybe', 'not yet'],\r\n        ['Convolution Class', ],\r\n        ['Bug fix move_next_px, need to use boundary ranges for proper movement of the window within a source', 4, [\r\n            ['cancelled - doing pb.pos_bounds', 'pb.window_movement_bounds', `\r\n                Need to make / finish function\r\n                Considering different types of bounds\r\n            `],\r\n            ['pos_bounds', `\r\n                consider iterate_pos_within_bounds\r\n                just each_pos_px?\r\n                As well as positions, need to properly calculate iteration values and indexes.\r\n                Put these into a typed array, access them through use of a function\r\n            `]\r\n        ]]\r\n    ],\r\n    '0.0.24': [\r\n        'Moving of mathematical code to ta_math where possible and suitable.',\r\n        'Current size: >6000 lines. Can it be brought down to 1000? Still kept v performant?',\r\n        ['new_resized', 'clearly creates a new pb']\r\n    ],\r\n    '0.0.25': [\r\n        'Improvements / optimization to resize',\r\n        'Facilitate usage of C++ acceleration.'\r\n    ]\r\n}\r\n*/\r\nconst lang = require('lang-mini');\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\nconst maxui64 = ~0n;\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst oext = require('obext');\r\nconst {ro, prop} = oext;\r\nconst Typed_Array_Binary_Read_Write = require('./Typed_Array_Binary_Read_Write');\r\nconst Pixel_Buffer_Painter = require('./pixel-buffer-painter');\r\nlet ta_math = require('./ta-math')\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp} = ta_math;\r\n\r\nconst Pixel_Buffer_Core_Reference_Implementations = require('./pixel-buffer-2-core-reference-implementations');\r\n\r\nclass Pixel_Buffer_Core extends Pixel_Buffer_Core_Reference_Implementations {\r\n    constructor(spec) {\r\n        super(spec);\r\n        const pos = new Int16Array(2);\r\n        const size = new Int16Array(2);\r\n        \r\n        const ta_bpp = new Uint8Array(2);\r\n        ta_bpp[1] = 8; // byte to bit multiplier. will stay as 8.\r\n        const _24bipp_to_8bipp = () => {\r\n            const old_ta = ta;\r\n            const new_ta = ta = new Uint8Array(this.num_px);\r\n            const l_read = old_ta.length;\r\n            let iby_read = 0, iby_write = 0;\r\n            while (iby_read < l_read) {\r\n                new_ta[iby_write++] = Math.round((old_ta[iby_read++] + old_ta[iby_read++] + old_ta[iby_read++]) / 3);\r\n            }\r\n        }\r\n        const _change_bipp_inner_update = (old_bipp, new_bipp) => {\r\n            if (old_bipp === 24) {\r\n                if (new_bipp === 8) {\r\n                    _24bipp_to_8bipp();\r\n                } else {\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                }\r\n            } else {\r\n                console.trace();\r\n                throw 'NYI';\r\n            }\r\n        }\r\n        \r\n        if (spec instanceof Pixel_Pos_List) {\r\n            throw 'NYI - change to 1bipp';\r\n            const ppl = spec;\r\n            const bounds = ppl.bounds;\r\n            const ppl_size = new Uint16Array(2);\r\n            ppl_size[0] = bounds[2] - bounds[0];\r\n            ppl_size[1] = bounds[3] - bounds[1];\r\n            this.bits_per_pixel = 8;\r\n            const bpp = this.bytes_per_pixel = 1;\r\n            this.size = new Uint16Array([ppl_size[0] + 4, ppl_size[1] + 4]);\r\n            this.pos = new Int16Array([bounds[0], bounds[1]]);\r\n            const bpr = this.bytes_per_row = bpp * this.size[0];\r\n            const buf = this.ta = this.buffer = new Uint8ClampedArray(this.size[0] * this.size[1]);\r\n            const l = buf.length;\r\n            for (var c = 0; c < l; c++) buf[c] = 255;\r\n            ppl.each_pixel(pixel_pos => {\r\n                buf[(bpr * (pixel_pos[1] - bounds[1])) + (pixel_pos[0] - bounds[0])] = 0;\r\n            });\r\n        } else {\r\n            \r\n        }\r\n        \r\n    }\r\n    new_convolved(convolution) {\r\n        const res = this.blank_copy();\r\n        const xy_conv_center = convolution.xy_center;\r\n        const edge_distances_from_center_px_edge = new Int16Array(4);\r\n        edge_distances_from_center_px_edge[0] = xy_conv_center[0] * -1;\r\n        edge_distances_from_center_px_edge[1] = xy_conv_center[1] * -1;\r\n        edge_distances_from_center_px_edge[2] = edge_distances_from_center_px_edge[0] + convolution.size[0] - 1;\r\n        edge_distances_from_center_px_edge[3] = edge_distances_from_center_px_edge[1] + convolution.size[1] - 1;\r\n        const pb_window = this.new_window({\r\n            size: convolution.size,\r\n            pos_bounds: [edge_distances_from_center_px_edge[0], edge_distances_from_center_px_edge[1], this.size[0] - edge_distances_from_center_px_edge[2], this.size[1] - edge_distances_from_center_px_edge[3]],\r\n            pos: [edge_distances_from_center_px_edge[0], edge_distances_from_center_px_edge[1]]\r\n        });\r\n        const pos_window = pb_window.pos;\r\n        const ta_window = pb_window.ta;\r\n        /*\r\n        const pb_conv_res = new Pixel_Buffer({\r\n            size: pb_8bipp_patch.size,\r\n            bits_per_pixel: 24\r\n        });\r\n        */\r\n        let i_write = 0;\r\n        const ta_conv_res = res.ta;\r\n        pb_window.each_pos_within_bounds(() => {\r\n            const rgb = convolution.calc_from_24bipp_ta(ta_window);\r\n            ta_conv_res[i_write++] = rgb[0];\r\n            ta_conv_res[i_write++] = rgb[1];\r\n            ta_conv_res[i_write++] = rgb[2];\r\n        });\r\n        return res;\r\n    }\r\n    new_resized(size) {\r\n        const dest = new this.constructor({\r\n            size: size,\r\n            bits_per_pixel: this.bipp\r\n        });\r\n        resize_ta_colorspace(this.ta, this.ta_colorspace, dest.size, dest.ta);\r\n        return dest;\r\n    }\r\n    copy_rect_by_bounds_to(ta_bounds, pb_target) {\r\n        console.log('pb.copy_rect_by_bounds_to');\r\n        const bipp = this.bipp;\r\n        if (bipp === 24) {\r\n            return this.copy_rect_by_bounds_to_24bipp(ta_bounds, pb_target)\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    each_px_convolution(ta_size, pb_conv_window, ta_pos, callback) {\r\n        console.trace();\r\n        throw 'NYI';\r\n        ta_pos[0] = 0;\r\n        ta_pos[1] = 0;\r\n        if (are_equal(pb_conv_window.size, ta_size)) {\r\n        } else {\r\n        }\r\n    }\r\n    get_1bipp_threshold_8bipp(ui8_threshold) {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 8) {\r\n            const res = new this.constructor({\r\n                bits_per_pixel: 1,\r\n                size: this.size\r\n            });\r\n            const rta = res.ta;\r\n            const ta = this.ta;\r\n            const cpx = this.num_px;\r\n            let i_px = 0;\r\n            let i_dest_byte = 0, i_dest_bit = 7;\r\n            let meets_threshold = false;\r\n            let out_byte = 0;\r\n            while (i_px < cpx) {\r\n                meets_threshold = ta[i_px] >= ui8_threshold;\r\n                if (meets_threshold) {\r\n                    out_byte = out_byte | Math.pow(2, i_dest_bit)\r\n                } else {\r\n                }\r\n                i_px++;\r\n                i_dest_bit--;\r\n                if (i_dest_bit === -1) {\r\n                    rta[i_dest_byte] = out_byte;\r\n                    i_dest_bit = 7;\r\n                    i_dest_byte++;\r\n                    out_byte = 0;\r\n                }\r\n            }\r\n            return res;\r\n        } else {\r\n            console.trace();\r\n            throw 'get_1bipp_threshold_8bipp: Unsupported bits_per_pixel ' + bipp;\r\n        }\r\n    }\r\n    to_8bipp() {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 1) {\r\n            const res = new this.constructor({\r\n                size: this.size,\r\n                bits_per_pixel: 8\r\n            })\r\n            let i_px = 0;\r\n            let i_byte = 0;\r\n            const num_bytes = this.ta.length;\r\n            while (i_byte < num_bytes) {\r\n                for (var b = 0; b < 8; b++) {\r\n                    const color = this.get_pixel_by_idx_1bipp(i_px) === 1 ? 255 : 0;\r\n                    res.set_pixel_by_idx_8bipp(i_px++, color);\r\n                }\r\n                i_byte++;\r\n            }\r\n            return res;\r\n        } else if (bipp === 8) {\r\n            return this.clone();\r\n        } else if (bipp === 24) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 32) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    to_24bipp() {\r\n        const bipp = this.bits_per_pixel;\r\n        const bypp = this.bytes_per_pixel;\r\n        let i_px = 0;\r\n        const num_px = this.size[0] * this.size[1];\r\n        if (bipp === 1) {\r\n            const res = new this.constructor({\r\n                size: this.size,\r\n                bits_per_pixel: 24\r\n            })\r\n            let i_byte = 0;\r\n            const num_bytes = this.ta.length;\r\n            while (i_byte < num_bytes) {\r\n                for (var b = 0; b < 8; b++) {\r\n                    const color = this.get_pixel_by_idx_1bipp(i_px) === 1 ? new Uint8ClampedArray([255, 255, 255]) : new Uint8ClampedArray([0, 0, 0]);\r\n                    res.set_pixel_by_idx_24bipp(i_px++, color);\r\n                }\r\n                i_byte++;\r\n            }\r\n            return res;\r\n        } else if (bipp === 8) {\r\n            const res = new this.constructor({\r\n                size: this.size,\r\n                bits_per_pixel: 24\r\n            });\r\n            const ta_res = res.ta;\r\n            const ta = this.ta, l = ta.length;\r\n            let pos_w = 0, c = 0;\r\n            for (c = 0; c < l; c++) {\r\n                ta_res[pos_w++] = ta[c];\r\n                ta_res[pos_w++] = ta[c];\r\n                ta_res[pos_w++] = ta[c];\r\n            }\r\n            return res;\r\n        } else if (bipp === 24) {\r\n            return this.clone();\r\n        } else if (bipp === 32) {\r\n            const res = new this.constructor({\r\n                size: this.size,\r\n                bits_per_pixel: 24\r\n            })\r\n            console.trace();\r\n            throw 'NYI';\r\n            while (i_px < num_px) {\r\n                const col_32 = this.get_pixel_by_idx_32bipp(i_px)\r\n                i_px += bypp;\r\n            }\r\n            return res;\r\n        }\r\n    }\r\n    toString() {\r\n        /*\r\n        size: Uint32Array [ 1024, 576 ],\r\n        bits_per_pixel: 32,\r\n        bytes_per_pixel: 4,\r\n        bytes_per_row: 4096 }\r\n        */\r\n        return JSON.stringify({\r\n            buffer: 'Uint8ClampedArray length ' + this.buffer.length,\r\n            size: this.size,\r\n            bits_per_pixel: this.bits_per_pixel,\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            bytes_per_row: this.bytes_per_row\r\n        });\r\n    }\r\n    /*\r\n    [inspect]() {\r\n        return 'Pixel_Buffer_Core ' + this.toString();\r\n    }\r\n    */\r\n    color_whole(color) {\r\n        if (this.bytes_per_pixel === 1) {\r\n            const ta_32_scratch = new Uint32Array(12);\r\n            ta_32_scratch[0] = this.size[0] * this.size[1];\r\n            const buf = this.buffer;\r\n            let i;\r\n            for (i = 0; i < ta_32_scratch[0]; i++) {\r\n                buf[i] = color;\r\n            }\r\n        } else if (this.bytes_per_pixel === 3) {\r\n            const ta_32_scratch = new Uint32Array(12);\r\n            ta_32_scratch[0] = this.size[0] * this.size[1] * 3;\r\n            const buf = this.buffer;\r\n            let i, c = 0;\r\n            for (i = 0; i < ta_32_scratch[0]; i++) {\r\n                buf[c++] = color[0];\r\n                buf[c++] = color[1];\r\n                buf[c++] = color[2];\r\n            }\r\n        } else if (this.bytes_per_pixel === 4) {\r\n            const ta_32_scratch = new Uint32Array(12);\r\n            ta_32_scratch[0] = this.size[0] * this.size[1] * 4;\r\n            const buf = this.buffer;\r\n            let i, c = 0;\r\n            for (i = 0; i < ta_32_scratch[0]; i++) {\r\n                buf[c++] = color[0];\r\n                buf[c++] = color[1];\r\n                buf[c++] = color[2];\r\n                buf[c++] = color[3];\r\n            }\r\n        } else {\r\n            throw 'Unsupported this.bytes_per_pixel: ' + this.bytes_per_pixel;\r\n        }\r\n        return this;\r\n    }\r\n    crop(size) {\r\n        let new_size = new Uint16Array([this.size[0] - size * 2, this.size[1] - size * 2]);\r\n        let res = new this.constructor({\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            size: new_size\r\n        });\r\n        if (this.pos) {\r\n            res.pos = new Int16Array([this.pos[0] - size, this.pos[1] - size])\r\n        }\r\n        this.each_pixel_ta((pos, color) => {\r\n            const new_pos = new Int16Array([pos[0] - size, pos[1] - size]);\r\n            if (new_pos[0] >= 0 && new_pos[0] < new_size[0] && new_pos[1] >= 0 && new_pos[1] < new_size[1]) {\r\n                res.set_pixel_ta(new_pos, color);\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n    uncrop(size, color) {\r\n        let res = new this.constructor({\r\n            bytes_per_pixel: this.bytes_per_pixel,\r\n            size: new Uint16Array([this.size[0] + size * 2, this.size[1] + size * 2])\r\n        })\r\n        if (this.pos) res.pos = this.pos;\r\n        if (this.pos) {\r\n        }\r\n        res.color_whole(color);\r\n        console.log('size', size);\r\n        this.each_pixel_ta((pos, color) => {\r\n            res.set_pixel_ta(new Uint16Array([pos[0] + size, pos[1] + size]), color);\r\n        })\r\n        return res;\r\n    }\r\n    color_rect(bounds, color) {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n    each_pixel_byte_index(cb) {\r\n        const {bipp} = this;\r\n        let ctu = true;\r\n        const stop = () => ctu = false;\r\n        if (bipp === 8) {\r\n            const buf = this.buffer, l = buf.length, bpp = this.bytes_per_pixel;\r\n            for (let c = 0; ctu && c < l; c += bpp) {\r\n                cb(c, stop);\r\n            }\r\n        } else if (bipp === 24) {\r\n            const buf = this.buffer, l = buf.length, bpp = this.bytes_per_pixel;\r\n            for (let c = 0; ctu && c < l; c += bpp) {\r\n                cb(c, stop);\r\n            }\r\n        } else if (bipp === 32) {\r\n            const buf = this.buffer, l = buf.length, bpp = this.bytes_per_pixel;\r\n            for (let c = 0; ctu && c < l; c += bpp) {\r\n                cb(c, stop);\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    /*\r\n    each_pixel_pos(cb) {\r\n        const b = this.size;\r\n        const pos = new Int16Array(2);\r\n        for (pos[1] = 0; pos[1] < b[1]; pos[1]++) {\r\n            for (pos[0] = 0; pos[0] < b[0]; pos[0]++) {\r\n                cb(pos);\r\n            }\r\n        }\r\n    }\r\n    */\r\n    each_ta_24bipp(ta_pos, ta_px_value, ta_info, callback) {\r\n        const bipp = this.bipp;\r\n        if (bipp === 24) {\r\n            if (ta_pos instanceof Int16Array || ta_pos instanceof Int32Array && ta_pos.length >= 2) {\r\n                if (ta_px_value instanceof Uint8ClampedArray && ta_px_value.length >= 3) {\r\n                    if (ta_info instanceof Uint32Array && ta_info.length >= 4) {\r\n                        const ta = this.ta;\r\n                        ta_info[0] = this.size[0];\r\n                        ta_info[1] = this.size[1];\r\n                        ta_info[2] = 0;\r\n                        ta_info[3] = 24; // bipp;\r\n                        const update = () => {\r\n                            ta[ta_info[2] * 3] = ta_px_value[0];\r\n                            ta[ta_info[2] * 3 + 1] = ta_px_value[1];\r\n                            ta[ta_info[2] * 3 + 2] = ta_px_value[2];\r\n                        }\r\n                        for (ta_pos[1] = 0; ta_pos[1] < ta_info[1]; ta_pos[1]++) {\r\n                            for (ta_pos[0] = 0; ta_pos[0] < ta_info[0]; ta_pos[0]++) {\r\n                                ta_px_value[0] = ta[ta_info[2] * 3];\r\n                                ta_px_value[1] = ta[ta_info[2] * 3 + 1];\r\n                                ta_px_value[2] = ta[ta_info[2] * 3 + 2];\r\n                                callback(update);\r\n                                ta_info[2]++;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            throw 'each_ta_24bipp error: bipp must be 24, bipp: ' + bipp;\r\n        }\r\n    }\r\n    each_ta_1bipp(ta_pos, ta_px_value, ta_info, callback) {\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            const [w, h] = this.size;\r\n            for (ta_pos[1] = 0; ta_pos[1] < h; ta_pos[1]++) {\r\n                for (ta_pos[0] = 0; ta_pos[0] < w; ta_pos[0]++) {\r\n                    const px = this.get_pixel_1bipp(ta_pos);\r\n                    ta_px_value[0] = px;\r\n                    callback(px, ta_pos);\r\n                }\r\n            }\r\n        } else {\r\n            throw 'each_ta_1bipp error: bipp must be 1, bipp: ' + bipp;\r\n        }\r\n    }\r\n    each_px_on_1bipp(ta_pos, ta_px_value, ta_info, callback) {\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            const [w, h] = this.size;\r\n            for (ta_pos[1] = 0; ta_pos[1] < h; ta_pos[1]++) {\r\n                for (ta_pos[0] = 0; ta_pos[0] < w; ta_pos[0]++) {\r\n                    if (this.get_pixel_1bipp(ta_pos) === 1 | 0) {\r\n                        callback(1 | 0, ta_pos);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            throw 'each_ta_1bipp error: bipp must be 1, bipp: ' + bipp;\r\n        }\r\n    }\r\n    each_px(ta_pos, ta_px_value, ta_info, callback) {\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            return this.each_ta_1bipp(ta_pos, ta_px_value, ta_info, callback);\r\n        } else if (bipp === 8) {\r\n            return this.each_ta_8bipp(ta_pos, ta_px_value, ta_info, callback);\r\n        } else if (bipp === 24) {\r\n            return this.each_ta_24bipp(ta_pos, ta_px_value, ta_info, callback);\r\n        } else if (bipp === 32) {\r\n            return this.each_ta_32bipp(ta_pos, ta_px_value, ta_info, callback);\r\n        } else {\r\n            console.trace();\r\n            throw 'Unsupported bipp: ' + bipp;\r\n        }\r\n    }\r\n    paint_pixel_list(pixel_pos_list, color) {\r\n        pixel_pos_list.each_pixel(pos => {\r\n            this.set_pixel_ta(pos, color);\r\n        });\r\n    }\r\n    'get_pixel_byte_bit_1bipp'(pos) {\r\n        /*\r\n        */\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        return {byte, bit};\r\n    }\r\n    'get_pixel_byte_bit_BE_1bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        return {byte, bit};\r\n    }\r\n    set_pixel_on_1bipp_by_pixel_index(pixel_index) {\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n\r\n    'set_pixel_on_1bipp_xy'(x, y) {\r\n        const pixel_index = y * this.size[0] + x;\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n\r\n    'set_pixel_on_1bipp'(pos) {\r\n        const pixel_index = pos[1] * this.size[0] + pos[0];\r\n        this.ta[pixel_index >> 3] |= (128 >> (pixel_index & 0b111));\r\n    }\r\n    set_pixel_off_1bipp_by_pixel_index(pixel_index) {\r\n        this.ta[pixel_index >> 3] &= (~(128 >> (pixel_index & 0b111))) & 255;\r\n    }\r\n    'set_pixel_off_1bipp'(pos) {\r\n        const pixel_idx = pos[1] * this.size[0] + pos[0];\r\n        this.ta[pixel_idx >> 3] &= (~(128 >> (pixel_idx & 0b111))) & 255;\r\n    }\r\n    'set_pixel_1bipp'(pos, color) {\r\n        const idx_bit = (pos[1] * this.size[0]) + pos[0];\r\n        const byte = idx_bit >> 3;\r\n        const bit = (idx_bit & 0b111);\r\n        if (color === 1) {\r\n            this.ta[byte] |= (128 >> bit);\r\n        } else {\r\n            this.ta[byte] &= (~(128 >> bit)) & 255;\r\n        }\r\n    }\r\n    'set_pixel_8bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        this.ta[idx] = color;\r\n    }\r\n    'set_pixel_24bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        let byte = idx * 3;\r\n        this.ta[byte++] = color[0];\r\n        this.ta[byte++] = color[1];\r\n        this.ta[byte] = color[2];\r\n    }\r\n    'set_pixel_32bipp'(pos, color) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        let byte = idx * 4;\r\n        this.ta[byte++] = color[0];\r\n        this.ta[byte++] = color[1];\r\n        this.ta[byte++] = color[2];\r\n        this.ta[byte] = color[3];\r\n    }\r\n    'set_pixel_by_idx_8bipp'(idx, color) {\r\n        const byte = idx;\r\n        this.ta[byte] = color;\r\n    }\r\n    'set_pixel_by_idx_24bipp'(idx, color) {\r\n        const byte = idx * 3;\r\n        this.ta[byte] = color[0];\r\n        this.ta[byte + 1] = color[1];\r\n        this.ta[byte + 2] = color[2];\r\n    }\r\n    'set_pixel_by_idx_32bipp'(idx, color) {\r\n        const byte = idx * 4;\r\n        this.ta[byte] = color[0];\r\n        this.ta[byte + 1] = color[1];\r\n        this.ta[byte + 2] = color[2];\r\n        this.ta[byte + 3] = color[3];\r\n    }\r\n    'set_pixel_by_idx'(idx, color) {\r\n        const a = arguments;\r\n        const l = a.length;\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            return this.set_pixel_by_idx_1bipp(a[0], a[1]);\r\n        } else if (bipp === 8) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_8bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 24) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_24bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 32) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_by_idx_32bipp(a[0], a[1]));\r\n            }\r\n        }\r\n    }\r\n    'set_pixel'(pos, color) {\r\n        const a = arguments;\r\n        const l = a.length;\r\n        const bipp = this.bipp;\r\n        if (bipp === 1) {\r\n            return(this.set_pixel_1bipp(a[0], a[1]));\r\n        } else if (bipp === 8) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_8bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 24) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_24bipp(a[0], a[1]));\r\n            }\r\n        } else if (bipp === 32) {\r\n            if (l === 2) {\r\n                return(this.set_pixel_32bipp(a[0], a[1]));\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'unsupported bipp: ' + bipp;\r\n        }\r\n    }\r\n    'get_pixel_by_idx_1bipp'(idx) {\r\n        /*\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        */\r\n        const byte = idx >> 3;\r\n        const bit = (idx & 0b111);\r\n        const pow = 128 >> bit;\r\n        return ((this.ta[byte] & pow) === pow) ? 1 : 0;\r\n    }\r\n    'get_pixel_by_idx_8bipp'(idx) {\r\n        const byte = idx;\r\n        return this.ta[byte];\r\n    }\r\n    'get_pixel_by_idx_24bipp'(idx) {\r\n        const byte = idx * 3;\r\n        return this.ta.slice(byte, byte + 3);\r\n    }\r\n    'get_pixel_by_idx_32bipp'(idx) {\r\n        const byte = idx * 4;\r\n        return this.ta.slice(byte, byte + 4);\r\n    }\r\n    'get_pixel_by_idx'(idx) {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 1) {\r\n            return this.get_pixel_by_idx_1bipp(idx);\r\n        } else if (bipp === 8) {\r\n            return this.get_pixel_by_idx_8bipp(idx);\r\n        } else if (bipp === 24) {\r\n            return this.get_pixel_by_idx_24bipp(idx);\r\n        } else if (bipp === 32) {\r\n            return this.get_pixel_by_idx_32bipp(idx);\r\n        } else {\r\n            throw 'Unsupported bipp'\r\n        }\r\n    }\r\n    'get_pixel_1bipp'(pos) {\r\n        const idx = (pos[1] * this.size[0]) + pos[0];\r\n        const byte = idx >> 3;\r\n        return ((this.ta[byte] & 128 >> (idx & 0b111)) !== 0) ? 1 : 0;\r\n    }\r\n    'get_pixel_8bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx;\r\n        return this.ta[byte];\r\n    }\r\n    'get_pixel_24bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx * 3;\r\n        return this.ta.slice(byte, byte + 3);\r\n    }\r\n    'get_pixel_32bipp'(pos) {\r\n        const idx = pos[1] * this.size[0] + pos[0];\r\n        const byte = idx * 4;\r\n        return this.ta.slice(byte, byte + 4);\r\n    }\r\n    'get_pixel'(pos) {\r\n        const bipp = this.bits_per_pixel;\r\n        if (bipp === 1) {\r\n            return this.get_pixel_1bipp(pos);\r\n        } else if (bipp === 8) {\r\n            return this.get_pixel_8bipp(pos);\r\n        } else if (bipp === 24) {\r\n            return this.get_pixel_24bipp(pos);\r\n        } else if (bipp === 32) {\r\n            return this.get_pixel_32bipp(pos);\r\n        } else {\r\n            console.trace();\r\n            throw 'bits per pixels error';\r\n        }\r\n    }\r\n    get num_px() {\r\n        return this.size[0] * this.size[1];\r\n    }\r\n    get split_rgb_channels() {\r\n        const [bipp, bypp] = [this.bits_per_pixel, this.bytes_per_pixel];\r\n        if (bipp === 24 || bipp === 32) {\r\n            const res = [new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            }), new this.constructor({\r\n                bits_per_pixel: 8,\r\n                size: this.size\r\n            })]\r\n            const [r, g, b] = res;\r\n            let i_px = 0;\r\n            const num_px = this.num_px;\r\n            let i_byte = 0;\r\n            const [ta_r, ta_g, ta_b] = [r.ta, g.ta, b.ta];\r\n            const ta = this.ta;\r\n            while (i_px < num_px) {\r\n                ta_r[i_px] = ta[i_byte];\r\n                ta_g[i_px] = ta[i_byte + 1];\r\n                ta_b[i_px] = ta[i_byte + 2];\r\n                i_px++;\r\n                i_byte += bypp;\r\n            }\r\n            return res;\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    process(fn) {\r\n        let res = this.clone();\r\n        return fn(this, res);\r\n    }\r\n    /*\r\n    function typedArraysAreEqual(a, b) {\r\nif (a.byteLength !== b.byteLength) return false;\r\nreturn a.every((val, i) => val === b[i]);\r\n}\r\n    */\r\n    equals(other_pixel_buffer) {\r\n        let buf1 = this.ta;\r\n        let buf2 = other_pixel_buffer.ta;\r\n        const other_colorspace = other_pixel_buffer.ta_colorspace;\r\n        const my_colorspace = other_pixel_buffer.ta_colorspace;\r\n        if (my_colorspace.length === other_colorspace.length) {\r\n            if(my_colorspace.every((val, i) => val === other_colorspace[i])) {\r\n                if (buf1.length === buf2.length) {\r\n                    return buf1.every((val, i) => val === buf2[i]);\r\n                } else {\r\n                }\r\n            } else {\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    copy_pixel_pos_list_region(pixel_pos_list, bg_color) {\r\n        let bounds = pixel_pos_list.bounds;\r\n        let size = new Uint16Array([bounds[2] - bounds[0] + 1, bounds[3] - bounds[1] + 1]);\r\n        const res = new this.constructor({\r\n            size: size,\r\n            bytes_per_pixel: this.bytes_per_pixel\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        if (bg_color) {\r\n            res.color_whole(bg_color);\r\n        }\r\n        res.pos = new Int16Array([bounds[0], bounds[1]]);\r\n        pixel_pos_list.each_pixel((pos) => {\r\n            let color = this.get_pixel_ta(pos);\r\n            const target_pos = new Int16Array([(pos[0] - bounds[0]), (pos[1] - bounds[1])]);\r\n            res.set_pixel_ta(target_pos, color);\r\n        });\r\n        return res;\r\n    }\r\n\r\n\r\n    // Pixel_Buffer_Pair_Complex_Operation class possibly?\r\n    //   Or just Operation.\r\n\r\n\r\n\r\n    // get_pre_operation_alignment_info ....\r\n\r\n\r\n    \r\n    // And could define such a class which has got requirements / invarients to do with \r\n\r\n\r\n\r\n    // This is used when drawing filled polygons.\r\n\r\n    'draw_1bipp_pixel_buffer_mask_1bipp'(pb_1bipp_mask, dest_pos, color) {\r\n\r\n\r\n\r\n\r\n        // A direct iteration approach could work better.\r\n        // Though (shifting and?) applying the correct boolean operations could work best.\r\n\r\n\r\n\r\n        function draw_bitmap(target, target_width, source, source_width, source_height, target_x, target_y) {\r\n            // Compute bytes per row using bitwise math\r\n            const target_bytes_per_row = (target_width + 7) >> 3;\r\n            const source_bytes_per_row = (source_width + 7) >> 3;\r\n        \r\n            // Iterate over each row of the source bitmap\r\n            for (let row = 0; row < source_height; row++) {\r\n                // Source row offset in bytes\r\n                const source_row_start = row * source_bytes_per_row;\r\n        \r\n                // Target row offset in bytes\r\n                const target_row_start = (target_y + row) * target_bytes_per_row;\r\n        \r\n                // Bit offset within the target byte\r\n                const bit_offset = target_x & 7; // Faster alternative to target_x % 8\r\n        \r\n                // Start byte in the target where source will be drawn\r\n                let target_byte_index = target_row_start + (target_x >> 3); // Divide target_x by 8 using bitwise shift\r\n        \r\n                // Iterate over source bytes for this row\r\n                for (let col = 0; col < source_bytes_per_row; col++) {\r\n                    const source_byte = source[source_row_start + col];\r\n        \r\n                    if (bit_offset === 0) {\r\n                        // Direct copy if aligned with byte boundary\r\n                        target[target_byte_index] |= source_byte;\r\n                    } else {\r\n                        // Handle unaligned case\r\n                        const next_byte_index = target_byte_index + 1;\r\n        \r\n                        // Shift source byte into position\r\n                        const shifted_byte = source_byte << bit_offset;\r\n                        const carry_over = source_byte >> (8 - bit_offset);\r\n        \r\n                        // Merge with target\r\n                        target[target_byte_index] |= shifted_byte;\r\n                        if (next_byte_index < target.length) {\r\n                            target[next_byte_index] |= carry_over;\r\n                        }\r\n                    }\r\n        \r\n                    target_byte_index++;\r\n                }\r\n            }\r\n        }\r\n        \r\n\r\n        const chatgpto1_draw_bitmap_implementation = () => {\r\n            draw_bitmap(this.ta, this.size[0], pb_1bipp_mask.ta, pb_1bipp_mask.size[0], pb_1bipp_mask.size[1], dest_pos[0], dest_pos[1]);\r\n        }\r\n        \r\n\r\n        const arr_on_xspans_implementation = () => {\r\n\r\n            // Getting it as an arr_rows_arr_x_on_spans representation using a class could help.\r\n            //   Or the 'other representaion' type class.\r\n\r\n            // May be able to have a faster internal algorithm for that.\r\n            //   Maybe a typed array backed class? Maybe a typed array.\r\n\r\n            const arr_rows_arr_on_xspans = pb_1bipp_mask.calculate_arr_rows_arr_x_on_spans_1bipp();\r\n            const [width, height] = pb_1bipp_mask.size;\r\n\r\n            const [dest_x, dest_y] = dest_pos;\r\n\r\n            /*\r\n            for (const row of arr_rows_arr_on_xspans) {\r\n\r\n                for (const xonspan of row) {\r\n                    xonspan[0] += dest_x;\r\n                    xonspan[1] += dest_x;\r\n                }\r\n                \r\n                //this.draw_horizontal_line_on_1bipp_inclusive(xonspan, y + dest_y);\r\n            }\r\n                */\r\n            \r\n            // Not sure the spans are inclusive...\r\n\r\n            if (color === 1) {\r\n                //let y = 0;\r\n                //let [dest_x, dest_y] = dest_pos;\r\n                for (let y = 0; y < height; y++) {\r\n                    //const arr_row_xspans_on = arr_rows_arr_on_xspans[y];\r\n                    const target_y = y + dest_y;\r\n                    //if (arr_row_xspans_on.length > 0) {\r\n                    for (const xonspan of arr_rows_arr_on_xspans[y]) {\r\n                        xonspan[0] += dest_x;\r\n                        xonspan[1] += dest_x;\r\n                        this.draw_horizontal_line_on_1bipp_inclusive(xonspan, target_y);\r\n                    }\r\n                    //}\r\n                }\r\n            } else {\r\n                //let y = 0;\r\n                \r\n                for (let y = 0; y < height; y++) {\r\n                    //const arr_row_xspans_on = arr_rows_arr_on_xspans[y];\r\n                    const target_y = y + dest_y;\r\n                    //if (arr_row_xspans_on.length > 0) {\r\n                    for (const xonspan of arr_rows_arr_on_xspans[y]) {\r\n                        xonspan[0] += dest_x;\r\n                        xonspan[1] += dest_x;\r\n                        this.draw_horizontal_line_off_1bipp_inclusive(xonspan, target_y);\r\n                    }\r\n                    //}\r\n                }\r\n            }\r\n\r\n            // Get it as an other representation of a 1 bipp image\r\n            \r\n        }\r\n\r\n        \r\n\r\n        // approach_selecting\r\n\r\n        const approach_selecting = () => {\r\n\r\n            //let can_do_aligned_64_bit = test_can_do_aligned_64_bit();\r\n\r\n            //let can_do_aligned_64_bit = false;\r\n\r\n            // And the realigned version...\r\n            //   row width does have to be divisible by 64 on both source and dest\r\n            //   can realign left?right? however many pixels.\r\n\r\n            // Maybe create some kind of shifted / realigned pattern first?\r\n\r\n\r\n\r\n\r\n\r\n            /*\r\n\r\n            const res_64_bit_alignment_test = test_aligned_64bit();\r\n            //console.log('res_64_bit_alignment_test', res_64_bit_alignment_test);\r\n            if (res_64_bit_alignment_test.pass === true) {\r\n                can_do_aligned_64_bit = true;\r\n            }\r\n                */\r\n\r\n            // A test to see what is possible....\r\n\r\n\r\n            //if (can_do_aligned_64_bit) {\r\n\r\n                //console.log('doing aligned 64 bit assignement');\r\n            //    return aligned_64_bit_implementation();\r\n\r\n            //} else \r\n            {\r\n\r\n                // But it will only work in some cases.\r\n                //   May need to increase row lengths to make it possible.\r\n                //     Both for the source and the dest.\r\n\r\n\r\n\r\n\r\n\r\n                const can_do_bit_realigned_64_bit = test_can_do_bit_realigned_64_bit();\r\n                if (can_do_bit_realigned_64_bit) {\r\n\r\n                    // So do that realigned 64 bit operation...\r\n                    //   Need to work out how many bytes and in which direction things will need to shift.\r\n                    //     What is the pixel index?\r\n                    //     What is the byte index?\r\n                    //       What is the remainder?\r\n\r\n                    return arr_on_xspans_implementation();\r\n\r\n                    //return bit_realigned_64_bit_implementation();\r\n                    //console.log('should do byte realigned 64 bit assignment');\r\n                } else {\r\n                    return arr_on_xspans_implementation();\r\n                }\r\n                \r\n            }\r\n\r\n            // \r\n\r\n\r\n        }\r\n        //return approach_selecting();\r\n\r\n        //return arr_on_xspans_implementation();\r\n\r\n        return chatgpto1_draw_bitmap_implementation();\r\n    }\r\n\r\n    'draw_1bipp_pixel_buffer_mask'(pb_1bipp_mask, dest_pos, color) {\r\n\r\n        const {bipp} = this;\r\n\r\n        if (bipp === 1) {\r\n            return this.draw_1bipp_pixel_buffer_mask_1bipp(pb_1bipp_mask, dest_pos, color);\r\n        } else {\r\n            const arr_on_xspans_implementation = () => {\r\n\r\n                // Getting it as an arr_rows_arr_x_on_spans representation using a class could help.\r\n                //   Or the 'other representaion' type class.\r\n    \r\n    \r\n                const arr_rows_arr_on_xspans = pb_1bipp_mask.calculate_arr_rows_arr_x_on_spans_1bipp();\r\n                const [width, height] = pb_1bipp_mask.size;\r\n    \r\n                let y = 0;\r\n                let [dest_x, dest_y] = dest_pos;\r\n                for (y = 0; y < height; y++) {\r\n                    const arr_row_xspans_on = arr_rows_arr_on_xspans[y];\r\n                    if (arr_row_xspans_on.length > 0) {\r\n                        for (const xonspan of arr_row_xspans_on) {\r\n                            xonspan[0] += dest_x;\r\n                            xonspan[1] += dest_x;\r\n                            this.draw_horizontal_line(xonspan, y + dest_y, color);\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                \r\n                \r\n            }\r\n            return arr_on_xspans_implementation();\r\n        }\r\n        \r\n    }\r\n    'blank_copy'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel\r\n        });\r\n        res.buffer.fill(0);\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'clone'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': this.bits_per_pixel,\r\n            'buffer': new this.buffer.constructor(this.buffer)\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        return res;\r\n    }\r\n    'add_alpha_channel'() {\r\n        console.log('add_alpha_channel this.bytes_per_pixel', this.bytes_per_pixel);\r\n        if (this.bytes_per_pixel === 3) {\r\n            var res = new this.constructor({\r\n                'size': this.size,\r\n                'bytes_per_pixel': 4\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            /*\r\n            this.each_pixel((x, y, r, g, b) => {\r\n                res.set_pixel(x, y, r, g, b, 255);\r\n            });\r\n            */\r\n            const buf = this.buffer,\r\n                res_buf = res.buffer;\r\n            const px_count = this.size[0] * this.size[1];\r\n            let i = 0,\r\n                ir = 0;\r\n            for (let p = 0; p < px_count; p++) {\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = buf[i++];\r\n                res_buf[ir++] = 255;\r\n            }\r\n            return res;\r\n        }\r\n        if (this.bytes_per_pixel === 4) {\r\n            return this;\r\n        }\r\n    }\r\n    'to_8bit_greyscale'() {\r\n        if (this.bytes_per_pixel === 1) {\r\n            return this;\r\n        } else if (this.bytes_per_pixel === 3) {\r\n            const res = new this.constructor({\r\n                'size': this.size,\r\n                'bits_per_pixel': 8\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            const bres = res.buffer;\r\n            let i = 0;\r\n            this.each_pixel((pos, color) => {\r\n                bres[i++] = Math.round((color[0] + color[1] + color[2]) / 3);\r\n            });\r\n            return res;\r\n        } else if (this.bytes_per_pixel === 4) {\r\n            const res = new this.constructor({\r\n                'size': this.size,\r\n                'bits_per_pixel': 8\r\n            });\r\n            if (this.pos) res.pos = this.pos;\r\n            const bres = res.buffer;\r\n            let i = 0;\r\n            this.each_pixel((pos, color) => {\r\n                bres[i++] = Math.round((color[0] + color[1] + color[2]) / 3);\r\n            });\r\n            return res;\r\n        }\r\n    }\r\n    'to_32bit_rgba'() {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 32\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        const bres = res.buffer;\r\n        if (this.bytes_per_pixel === 1) {\r\n            let i = 0, new_v;\r\n            this.each_pixel((pos, v) => {\r\n                bres[i++] = v;\r\n                bres[i++] = v;\r\n                bres[i++] = v;\r\n                bres[i++] = 255;\r\n            });\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n        return res;\r\n    }\r\n    '__invert_greyscale_self'() {\r\n        const bres = this.buffer;\r\n        let i = 0;\r\n        this.each_pixel((x, y, v) => {\r\n            bres[i++] = 255 - v;\r\n        });\r\n        return this;\r\n    }\r\n    '__invert_greyscale'() {\r\n        let res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 8\r\n        });\r\n        if (this.pos) res.pos = this.pos;\r\n        const bres = res.buffer;\r\n        let i = 0;\r\n        this.each_pixel((x, y, v) => {\r\n            bres[i++] = 255 - v;\r\n        });\r\n        return res;\r\n    }\r\n    \r\n    draw_rect(pos_corner, pos_other_corner, color) {\r\n        /*\r\n        const paint_bounds = new Int16Array([20, 300, 180, 320]);\r\n        const paint_color = new Uint8ClampedArray([255, 0, 0]);\r\n        ta_math.fill_solid_rect_by_bounds(pb_dest.ta, pb_dest.bytes_per_row, paint_bounds, 24, paint_color);\r\n        */\r\n        const l = Math.min(pos_corner[0], pos_other_corner[0]);\r\n        const t = Math.min(pos_corner[1], pos_other_corner[1]);\r\n        const r = Math.max(pos_corner[0], pos_other_corner[0]);\r\n        const b = Math.max(pos_corner[1], pos_other_corner[1]);\r\n        //const paint_bounds = new Int16Array([20, 300, 180, 320]);\r\n        //const paint_color = new Uint8ClampedArray([255, 0, 0]);\r\n        const xspan = [l, r];\r\n        for (let y = t; y <= b; y++) {\r\n            this.draw_horizontal_line(xspan, y, color);\r\n        }\r\n    }\r\n    * 'iterate_arr_row_x_on_spans_1bipp'(y) {\r\n    }\r\n    get xspans() {\r\n    }\r\n}\r\nmodule.exports = Pixel_Buffer_Core;\r\nif (require.main === module) {\r\n    const lg = console.log;\r\n    (async() => {\r\n        const run_examples = async() => {\r\n            lg('Begin run examples');\r\n            const examples = [\r\n                async() => {\r\n                    lg('Begin example 0');\r\n                    const pb = new Pixel_Buffer_Core({\r\n                        bits_per_pixel: 1,\r\n                        size: [8, 8]\r\n                    });\r\n                    const ta_pos = new Int16Array(2);\r\n                    ta_pos[0] = 3;\r\n                    ta_pos[1] = 3;\r\n                    pb.set_pixel(ta_pos, 1);\r\n                    lg('End example 0');\r\n                    return pb;\r\n                }\r\n            ]\r\n            const l = examples.length;\r\n            for (var c = 0; c < l; c++) {\r\n                const res_eg = await examples[c]();\r\n                console.log('res_eg ' + c + ':', res_eg);\r\n            };\r\n            lg('End run examples');\r\n        }\r\n        await run_examples();\r\n    })();\r\n}\r\n", "\r\n\r\nconst lang = require('lang-mini');\r\n\r\nconst {\r\n    each,\r\n    fp,\r\n    tof,\r\n    get_a_sig,\r\n    are_equal,\r\n    tf\r\n} = lang;\r\n\r\n//const Pixel_Pos_List = require('./pixel-pos-list');\r\n\r\nconst oext = require('obext');\r\n\r\nconst {ro, prop} = oext;\r\n\r\nconst Pixel_Buffer_Core = require('./pixel-buffer-3-core');\r\n\r\nclass Pixel_Buffer_Advanced_TypedArray_Properties extends Pixel_Buffer_Core {\r\n\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n\r\n        let ta_scratch;\r\n        let ta_pos_scratch;        // Int16Array(2)\r\n        let ta_pos_iterator;        // Int16Array(2)\r\n        let ta_move_vector;\r\n        let ta_bounds;\r\n        let ta_24bit_color;\r\n        let ta_32bit_color;\r\n        //let ta_rgba;\r\n        let ta_row_scratch;\r\n\r\n        let ta_bounds_scratch;     // Int16Array(4);\r\n        let ta_bounds2_scratch;    // Int16Array(4);\r\n        let ta_bounds3_scratch;    // Int16Array(4);\r\n        let ta_bounds4_scratch;    // Int16Array(4);\r\n        let ta_size_scratch;       // Uint16Array(2);\r\n        let ta_size2_scratch;       // Uint16Array(2);\r\n        let ta_pointers_scratch;\r\n        let ta_pointers2_scratch;\r\n        let ta_pointerpair_scratch;\r\n        let ta_offsets_scratch;\r\n        let ta_offsets_info_scratch; \r\n\r\n\r\n        const setup_ta_ro_props = () => {\r\n\r\n\r\n            // See about using 'scratch' and other temporary tas.\r\n\r\n\r\n\r\n            ro(this, 'ta_scratch', () => {\r\n                if (!ta_scratch) {\r\n                    ta_scratch = new this.ta.constructor(this.ta);\r\n                } else {\r\n    \r\n                    // If it's not already an instance of the constructor of this.ta?\r\n    \r\n    \r\n    \r\n                    // check the size...? the types as well?\r\n                    if (ta_scratch.length !== this.ta.length) {\r\n                        ta_scratch = new this.ta.constructor(this.ta);\r\n                    } else {\r\n                        const l = this.ta.length;\r\n                        // Could use faster copy?\r\n                        //  Is typed array copy that fast compared to assignment operators?\r\n                        for (c = 0; c < l; c++) {\r\n                            ta_scratch[c] = this.ta[c];\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n    \r\n    \r\n            // ta_row_scratch\r\n            //  a typed array sized to hold pixel data for a single row.\r\n    \r\n            // (this.bypr)\r\n    \r\n            ro(this, 'ta_row_scratch', () => {\r\n                if (!ta_row_scratch) {\r\n                    ta_row_scratch = new Uint8ClampedArray(this.bypr);\r\n                } else {\r\n                    if (ta_row_scratch.length !== this.bypr) {\r\n                        ta_row_scratch = new Uint8ClampedArray(this.bypr);\r\n                    }\r\n                    return ta_row_scratch;\r\n                }\r\n            });\r\n            \r\n            ro(this, 'ta_pos_scratch', () => {\r\n                if (!ta_pos_scratch) {\r\n                    ta_pos_scratch = new Int16Array(2);\r\n                }\r\n                return ta_pos_scratch;\r\n            });\r\n\r\n            // and a 2nd pos scratch ta?\r\n    \r\n            ro(this, 'ta_pos_iterator', () => {\r\n                if (!ta_pos_iterator) {\r\n                    ta_pos_iterator = new Int16Array(2);\r\n                }\r\n                return ta_pos_iterator;\r\n            });\r\n    \r\n    \r\n            // ta_source_to_self_translate_vector ???\r\n            //  more properties could be stored and accessed in this form. tas particularly good for simple vectors.\r\n    \r\n            // maybe make some kind of optimized string indexed ta.\r\n            //  look up values to consts, use them...?\r\n            //  or have const declarations of the numbers, use them? May compile best. Macros for consts???\r\n    \r\n    \r\n    \r\n            // ta_move_vector\r\n\r\n            // Maybe all this is advanced/enhanced rather than core.\r\n            // Pixel_Buffer_Advanced_Typed_Array_Properties\r\n            //  So the code does not need to be in the core.\r\n\r\n\r\n            ro(this, 'ta_move_vector', () => {\r\n                if (!ta_move_vector) {\r\n                    ta_move_vector = new Int16Array(2);\r\n                }\r\n                return ta_move_vector;\r\n            });\r\n            ro(this, 'ta_bounds', () => {\r\n                if (!ta_bounds) {\r\n                    ta_bounds = new Int16Array(4);\r\n                }\r\n                return ta_bounds;\r\n            });\r\n\r\n            ro(this, 'ta_24bit_color', () => {\r\n                if (!ta_24bit_color) {\r\n                    ta_24bit_color = new Uint8ClampedArray(3);\r\n                }\r\n                return ta_24bit_color;\r\n            });\r\n\r\n\r\n            ro(this, 'ta_32bit_color', () => {\r\n                if (!ta_32bit_color) {\r\n                    ta_32bit_color = new Uint8ClampedArray(4);\r\n                }\r\n                return ta_32bit_color;\r\n            });\r\n    \r\n\r\n\r\n\r\n            /*\r\n\r\n            ro(this, 'ta_rgb', () => {\r\n                if (!ta_rgb) {\r\n                    ta_rgb = new Uint8ClampedArray(3);\r\n                }\r\n                return ta_rgb;\r\n            });\r\n            ro(this, 'ta_rgb2', () => {\r\n                if (!ta_rgb2) {\r\n                    ta_rgb2 = new Uint8ClampedArray(3);\r\n                }\r\n                return ta_rgb2;\r\n            });\r\n            */\r\n\r\n\r\n            ro(this, 'ta_bounds_scratch', () => {\r\n                if (!ta_bounds_scratch) {\r\n                    ta_bounds_scratch = new Int16Array(4);\r\n                }\r\n                return ta_bounds_scratch;\r\n            });\r\n            ro(this, 'ta_bounds2_scratch', () => {\r\n                if (!ta_bounds2_scratch) {\r\n                    ta_bounds2_scratch = new Int16Array(4);\r\n                }\r\n                return ta_bounds2_scratch;\r\n            });\r\n            ro(this, 'ta_bounds3_scratch', () => {\r\n                if (!ta_bounds3_scratch) {\r\n                    ta_bounds3_scratch = new Int16Array(4);\r\n                }\r\n                return ta_bounds3_scratch;\r\n            });\r\n            ro(this, 'ta_bounds4_scratch', () => {\r\n                if (!ta_bounds4_scratch) {\r\n                    ta_bounds4_scratch = new Int16Array(4);\r\n                }\r\n                return ta_bounds4_scratch;\r\n            });\r\n            ro(this, 'ta_size_scratch', () => {\r\n                if (!ta_size_scratch) {\r\n                    ta_size_scratch = new Uint16Array(2);\r\n                }\r\n                return ta_size_scratch;\r\n            });\r\n            ro(this, 'ta_size2_scratch', () => {\r\n                if (!ta_size2_scratch) {\r\n                    ta_size2_scratch = new Uint16Array(2);\r\n                }\r\n                return ta_size2_scratch;\r\n            });\r\n            ro(this, 'ta_pointers_scratch', () => {\r\n                if (!ta_pointers_scratch) {\r\n                    // Only allow 2 pointers? by default?\r\n                    ta_pointers_scratch = new Uint32Array(4);\r\n                }\r\n                return ta_pointers_scratch;\r\n            });\r\n            ro(this, 'ta_pointers2_scratch', () => {\r\n                if (!ta_pointers2_scratch) {\r\n                    // Only allow 2 pointers? by default?\r\n                    ta_pointers2_scratch = new Uint32Array(4);\r\n                }\r\n                return ta_pointers2_scratch;\r\n            });\r\n            ro(this, 'ta_pointerpair_scratch', () => {\r\n                if (!ta_pointerpair_scratch) {\r\n                    // Only allow 2 pointers? by default?\r\n                    ta_pointerpair_scratch = new Uint32Array(2);\r\n                }\r\n                return ta_pointerpair_scratch;\r\n            });\r\n            ro(this, 'ta_offsets_scratch', () => {\r\n                if (!ta_offsets_scratch) {\r\n                    // Only allow 2 pointers? by default?\r\n                    ta_offsets_scratch = new Int32Array(4);\r\n                }\r\n                return ta_offsets_scratch;\r\n            });\r\n            ro(this, 'ta_offsets_info_scratch', () => {\r\n                if (!ta_offsets_info_scratch) {\r\n                    // Only allow 2 pointers? by default?\r\n                    ta_offsets_info_scratch = new Int32Array(8);\r\n                }\r\n                return ta_offsets_info_scratch;\r\n            });\r\n\r\n\r\n        }\r\n        setup_ta_ro_props();\r\n\r\n\r\n        const ta_colorspace = new Int16Array(6);\r\n\r\n        // Seems more like an advanced typed array property.\r\n        \r\n\r\n        Object.defineProperty(this, 'ta_colorspace', {\r\n            // Using shorthand method names (ES2015 feature).\r\n            // This is equivalent to:\r\n            // get: function() { return bValue; },\r\n            // set: function(newValue) { bValue = newValue; },\r\n            get() {\r\n                // Defensive: handle undefined ta_bpp, fallback to bits_per_pixel or bytes_per_pixel\r\n                ta_colorspace[0] = this.size[0];\r\n                ta_colorspace[1] = this.size[1];\r\n                let bpp = 0;\r\n                if (this.ta_bpp && typeof this.ta_bpp[0] === 'number') {\r\n                    bpp = this.ta_bpp[0];\r\n                } else if (typeof this.bits_per_pixel === 'number') {\r\n                    bpp = this.bits_per_pixel;\r\n                } else if (typeof this.bytes_per_pixel === 'number') {\r\n                    bpp = this.bytes_per_pixel * 8;\r\n                }\r\n                ta_colorspace[2] = bpp % 8 === 0 ? bpp / 8 : 0;\r\n                ta_colorspace[3] = ta_colorspace[2] * ta_colorspace[0];\r\n                ta_colorspace[4] = bpp;\r\n                ta_colorspace[5] = ta_colorspace[4] * ta_colorspace[0];\r\n                return ta_colorspace;\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nmodule.exports = Pixel_Buffer_Advanced_TypedArray_Properties;", "//generateGaussianKernel = require('gaussian-convolution-kernel');\r\n\r\n\r\n/*\r\n * Generates a kernel used for the gaussian blur effect.\r\n *\r\n * @param dimension is an odd integer\r\n * @param sigma is the standard deviation used for our gaussian function.\r\n *\r\n * @returns an array with dimension^2 number of numbers, all less than or equal\r\n *   to 1. Represents our gaussian blur kernel.\r\n */\r\nfunction generateGaussianKernel(dimension, sigma) {\r\n\r\n    /*\r\n\r\n    Copyright (c) 2016, Andrey Sidorov\r\n\r\n    Permission to use, copy, modify, and/or distribute this software for any\r\n    purpose with or without fee is hereby granted, provided that the above\r\n    copyright notice and this permission notice appear in all copies.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n    WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n    MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n    ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n    WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n    ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n    OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n    */\r\n\r\n    function hypotenuse(x1, y1, x2, y2) {\r\n      var xSquare = Math.pow(x1 - x2, 2);\r\n      var ySquare = Math.pow(y1 - y2, 2);\r\n      return Math.sqrt(xSquare + ySquare);\r\n    }\r\n\r\n    if (!(dimension % 2) || Math.floor(dimension) !== dimension || dimension<3) {\r\n      throw new Error(\r\n        'The dimension must be an odd integer greater than or equal to 3'\r\n      );\r\n    }\r\n    var kernel = [];\r\n  \r\n    var twoSigmaSquare = 2 * sigma * sigma;\r\n    var centre = (dimension - 1) / 2;\r\n  \r\n    for (var i = 0; i < dimension; i++) {\r\n      for (var j = 0; j < dimension; j++) {\r\n        var distance = hypotenuse(i, j, centre, centre);\r\n  \r\n        // The following is an algorithm that came from the gaussian blur\r\n        // wikipedia page [1].\r\n        //\r\n        // http://en.wikipedia.org/w/index.php?title=Gaussian_blur&oldid=608793634#Mechanics\r\n        var gaussian = (1 / Math.sqrt(\r\n          Math.PI * twoSigmaSquare\r\n        )) * Math.exp((-1) * (Math.pow(distance, 2) / twoSigmaSquare));\r\n  \r\n        kernel.push(gaussian);\r\n      }\r\n    }\r\n  \r\n    // Returns the unit vector of the kernel array.\r\n    var sum = kernel.reduce(function (c, p) { return c + p; });\r\n    return kernel.map(function (e) { return e / sum; });\r\n  }\r\n\r\nmodule.exports = {\r\n    'edge': new Float32Array(\r\n        [\r\n            -1, -1, -1,\r\n            -1, 8, -1,\r\n            -1, -1, -1\r\n        ]\r\n    ),\r\n    'gauss_blur_5_2': generateGaussianKernel(5, 2),\r\n    'gauss_blur_5_5': generateGaussianKernel(5, 5),\r\n    'get_gauss': (d, sigma) => new Float32Array(generateGaussianKernel(d, sigma)),\r\n    'lap_gauss_5': new Int8Array([\r\n        0, 0, -1, 0, 0,\r\n        0, -1, -2, -1, 0,\r\n        -1, -2, 16, -2, -1,\r\n        0, -1, -2, -1, 0,\r\n        0, 0, -1, 0, 0\r\n    ]),\r\n    'sobel_x': new Int8Array([\r\n        -1, 0, 1,\r\n        -2, 0, 2,\r\n        -1, 0, 1\r\n    ]),\r\n    'sobel_y': new Int8Array([\r\n        1, 2, 1,\r\n        0, 0, 0,\r\n        -1, -2, -1\r\n    ]),\r\n    'sobel_diag_1': new Int8Array([\r\n        0, 1, 2,\r\n        -1, 0, 1,\r\n        -2, -1, 0\r\n    ]),\r\n    'sobel_diag_2': new Int8Array([\r\n        -2, -1, 0,\r\n        -1, 0, 1,\r\n        0, 1, 2\r\n    ])\r\n}", "//const Pixel_Buffer_Core = require('./pixel-buffer-core');\r\n\r\nconst Pixel_Buffer_Advanced_TypedArray_Properties = require('./pixel-buffer-4-advanced-typedarray-properties');\r\nconst kernels = require('./convolution-kernels/kernels');\r\n\r\nclass Pixel_Buffer_Idiomatic_Enh extends Pixel_Buffer_Advanced_TypedArray_Properties {\r\n    constructor(...a) {\r\n        super(...a);\r\n    }\r\n\r\n    each_pixel_pos(callback) {\r\n        const {ta_pos_scratch, size} = this;\r\n        let ctu = true;\r\n        const stop = () => {\r\n            ctu = false;\r\n        }\r\n\r\n        for (ta_pos_scratch[1] = 0; ctu === true && ta_pos_scratch[1] < size[1]; ta_pos_scratch[1]++) {\r\n            for (ta_pos_scratch[0] = 0; ctu === true && ta_pos_scratch[0] < size[0]; ta_pos_scratch[0]++) {\r\n                callback(ta_pos_scratch, stop);\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    count_colors() {\r\n        const map_colors = {};\r\n        let res = 0;\r\n        this.each_pixel_ta((pos, color) => {\r\n            const colstr = color.toString();\r\n            if (!map_colors[colstr]) {\r\n                map_colors[colstr] = true;\r\n                res++;\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n\r\n    \r\n\r\n    blur(size = 3, sigma = 2) {\r\n        let kernel = kernels.get_gauss(size, sigma);\r\n        return this.apply_square_convolution(kernel);\r\n    }\r\n\r\n\r\n\r\n    count_pixels_with_color(color) {\r\n        let res = 0;\r\n        // could find out here what format the color is...\r\n\r\n        console.log('idiomatic count_pixels_with_color');\r\n\r\n        const {bipp} = this;\r\n\r\n\r\n        if (bipp <= 8) {\r\n            this.each_pixel((pos, pixel_color) => {\r\n                //console.log('pixel_color', pixel_color);\r\n                //console.log('color', color);\r\n\r\n                if (pixel_color === color) res++;\r\n                //console.trace();\r\n                //throw 'NYI';\r\n            });\r\n        } else if (bipp === 24) {\r\n            this.each_pixel((pos, pixel_color) => {\r\n                //console.log('pixel_color', pixel_color);\r\n                //console.log('color', color);\r\n\r\n                if (pixel_color[0] === color[0] && pixel_color[1] === color[1] && pixel_color[2] === color[2]) {\r\n                    res++;\r\n                }\r\n    \r\n    \r\n    \r\n                //console.trace();\r\n                //throw 'NYI';\r\n            });\r\n        } else if (bipp === 32) {\r\n            this.each_pixel((pos, pixel_color) => {\r\n                //console.log('pixel_color', pixel_color);\r\n                //console.log('color', color);\r\n\r\n                if (pixel_color[0] === color[0] && pixel_color[1] === color[1] && pixel_color[2] === color[2] && pixel_color[3] === color[3]) {\r\n                    res++;\r\n                }\r\n    \r\n    \r\n    \r\n                //console.trace();\r\n                //throw 'NYI';\r\n            });\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n\r\n        //console.log('res', res);\r\n\r\n        return res;\r\n\r\n        \r\n    }\r\n}\r\n\r\nmodule.exports = Pixel_Buffer_Idiomatic_Enh;", "const Pixel_Buffer_Idiomatic_Enh = require('./pixel-buffer-5-idiomatic-enh');\r\n\r\nconst Pixel_Pos_List = require('./pixel-pos-list');\r\nconst get_idx_movement_vectors = (f32a_convolution, bpp, bpr) => {\r\n    const c_length = f32a_convolution.length;\r\n    const dimension_size = Math.sqrt(c_length);\r\n    const padding = (dimension_size - 1) / 2;\r\n    const movement_vectors = new Int8Array(c_length * 2);\r\n    let x, y, pos = 0;\r\n    const idx_movement_vectors = new Int16Array(c_length);\r\n    for (y = -1 * padding; y <= padding; y++) {\r\n        for (x = -1 * padding; x <= padding; x++) {\r\n            movement_vectors[pos++] = x;\r\n            movement_vectors[pos++] = y;\r\n        }\r\n    }\r\n    pos = 0;\r\n    let ii, i;\r\n    for (i = 0; i < c_length; i++) {\r\n        x = movement_vectors[pos++];\r\n        y = movement_vectors[pos++];\r\n        idx_movement_vectors[i] = x * bpp + y * bpr;\r\n    }\r\n    return idx_movement_vectors;\r\n}\r\nconst get_points_bounding_box = (points) => {\r\n    let min_x = Number.POSITIVE_INFINITY;\r\n    let min_y = Number.POSITIVE_INFINITY;\r\n    let max_x = Number.NEGATIVE_INFINITY;\r\n    let max_y = Number.NEGATIVE_INFINITY;\r\n    for (const [x, y] of points) {\r\n        if (x < min_x) min_x = x;\r\n        if (x > max_x) max_x = x;\r\n        if (y < min_y) min_y = y;\r\n        if (y > max_y) max_y = y;\r\n    }\r\n    return [\r\n        [min_x, min_y],\r\n        [max_x, max_y]\r\n    ];\r\n}\r\nclass Pixel_Buffer_Perf_Focus_Enh extends Pixel_Buffer_Idiomatic_Enh {\r\n    constructor(spec) {\r\n        super(spec);\r\n    }\r\n    get ta_is_64bit_divisible() {\r\n        return (this.ta.length & 63) === 0;\r\n    }\r\n    get ta_is_32bit_divisible() {\r\n        return (this.ta.length & 31) === 0;\r\n    }\r\n    get ta64() {\r\n        if (this._ta64) {\r\n            return this._ta64;\r\n        } else {\r\n        }\r\n        if (this.ta_is_64bit_divisible) {\r\n            if (this.ta.byteOffset % 8 === 0) {\r\n                this._ta64 = new BigUint64Array(this.ta.buffer, this.ta.byteOffset, this.ta.byteLength / 8);\r\n                return this._ta64;\r\n            } else {\r\n                console.error(\"The byte offset is not aligned to 8 bytes.\");\r\n            }\r\n        } else  {\r\n            return false;\r\n        }\r\n    }\r\n    get is_32bit_divisible_image() {\r\n        return (this.ta.length & 31) === 0;\r\n    }\r\n    get is_32_divisible_bits_per_row() {\r\n        return (this.bits_per_row & 31) === 0;\r\n    }\r\n    get number_of_32bit_segments_per_32bit_divisible_row() {\r\n        return this.bits_per_row >> 5;\r\n    }\r\n    get is_64bit_divisible_image() {\r\n        return (this.ta.length & 63) === 0;\r\n    }\r\n    get is_64_divisible_bits_per_row() {\r\n        return (this.bits_per_row & 63) === 0;\r\n    }\r\n    get number_of_64bit_segments_per_64bit_divisible_row() {\r\n        return this.bits_per_row >> 6;\r\n    }\r\n    get bits_per_image_1bipp() {\r\n        return this.size[0] * this.size[1];\r\n    }\r\n    get number_of_64bit_segments_per_64bit_divisible_image() {\r\n        return this.bits_per_image_1bipp >> 6;\r\n    }\r\n    iterate_all_ui32_locations_1bipp(cb) {\r\n        const ui32a_px_range = new Uint32Array(4);\r\n        if (this.ta_is_32bit_divisible) {\r\n            if (this.is_32_divisible_bits_per_row) {\r\n                const number_of_32bit_segments_per_32bit_divisible_row = this.number_of_32bit_segments_per_32bit_divisible_row;\r\n                if (number_of_32bit_segments_per_32bit_divisible_row === 1) {\r\n                    const height = this.size[1];\r\n                    const first_x = 0, last_x = 31;\r\n                    ui32a_px_range[0] = first_x;\r\n                    ui32a_px_range[2] = last_x;\r\n                    let y = 0;\r\n                    for (let i = 0; i < height; i++) {\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        y++;\r\n                    }\r\n                } else if (number_of_32bit_segments_per_32bit_divisible_row === 2) {\r\n                    const height = this.size[1];\r\n                    const number_of_32bit_segments = height * number_of_32bit_segments_per_32bit_divisible_row;\r\n                    let even = true;\r\n                    let y = 0;\r\n                    let first_x = 0, last_x = 63;\r\n                    for (let i = 0; i < number_of_32bit_segments; i++) {\r\n                        ui32a_px_range[0] = first_x;\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[2] = last_x;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        if (!even) {\r\n                            y++;\r\n                            first_x = 0; last_x = 31;\r\n                        } else {\r\n                            first_x = 32; last_x = 63;\r\n                        }\r\n                        even = !even;\r\n                    }\r\n                } else {\r\n                    const height = this.size[1];\r\n                    const number_of_32bit_segments = height * number_of_32bit_segments_per_32bit_divisible_row;\r\n                    let y = 0;\r\n                    let first_x = 0, last_x = 31;\r\n                    let i_row_segment = 0;\r\n                    for (let i = 0; i < number_of_32bit_segments; i++) {\r\n                        ui32a_px_range[0] = first_x;\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[2] = last_x;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        i_row_segment++;\r\n                        if (i_row_segment < number_of_32bit_segments_per_32bit_divisible_row) {\r\n                            first_x += 32;\r\n                            last_x += 32;\r\n                        } else {\r\n                            i_row_segment = 0;\r\n                            y++;\r\n                            first_x = 0; last_x = 31;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n            }\r\n        } else {\r\n        }\r\n    }\r\n    iterate_all_ui32_locations_values_prev_values_prev_shifted_values_toggle_locations_1bipp(cb) {\r\n        const ui32a_res = new Uint32Array(12);\r\n        if (this.ta_is_32bit_divisible) {\r\n            const {ta} = this;\r\n            const dv = new DataView(ta.buffer, ta.byteOffset, ta.byteLength);\r\n            if (this.is_32_divisible_bits_per_row) {\r\n                const number_of_32bit_segments_per_32bit_divisible_row = this.number_of_32bit_segments_per_32bit_divisible_row;\r\n                if (number_of_32bit_segments_per_32bit_divisible_row === 1) {\r\n                    const height = this.size[1];\r\n                    const first_x = 0, last_x = 31;\r\n                    ui32a_res[0] = first_x;\r\n                    ui32a_res[2] = last_x;\r\n                    let y = 0;\r\n                    let b = 0;\r\n                    for (let i = 0; i < height; i++) {\r\n                        ui32a_res[1] = y;\r\n                        ui32a_res[3] = y;\r\n                        const ui32_value = dv.getUint32(b);\r\n                        ui32a_res[5] = ui32_value;\r\n                        cb(ui32a_res);\r\n                        y++;\r\n                        b+=4;\r\n                    }\r\n                } else if (number_of_32bit_segments_per_32bit_divisible_row === 2) {\r\n                    const height = this.size[1];\r\n                    const number_of_32bit_segments = height * number_of_32bit_segments_per_32bit_divisible_row;\r\n                    let even = true;\r\n                    let y = 0;\r\n                    let b = 0;\r\n                    let first_x = 0, last_x = 63;\r\n                    let ui32_prev_value = 0;\r\n                    for (let i = 0; i < number_of_32bit_segments; i++) {\r\n                        ui32a_res[0] = first_x;\r\n                        ui32a_res[1] = y;\r\n                        ui32a_res[2] = last_x;\r\n                        ui32a_res[3] = y;\r\n                        const ui32_value = dv.getUint32(b);\r\n                        ui32a_res[4] = ui32_prev_value;\r\n                        ui32a_res[5] = ui32_value;\r\n                        cb(ui32a_res);\r\n                        if (!even) {\r\n                            y++;\r\n                            first_x = 0; last_x = 31;\r\n                        } else {\r\n                            first_x = 32; last_x = 63;\r\n                        }\r\n                        even = !even;\r\n                        b+=4;\r\n                        ui32_prev_value = ui32_value;\r\n                    }\r\n                } else {\r\n                    const height = this.size[1];\r\n                    const number_of_32bit_segments = height * number_of_32bit_segments_per_32bit_divisible_row;\r\n                    let y = 0;\r\n                    let first_x = 0, last_x = 31;\r\n                    let i_row_segment = 0;\r\n                    let b = 0;\r\n                    let ui32_prev_value = 0;\r\n                    for (let i = 0; i < number_of_32bit_segments; i++) {\r\n                        ui32a_res[0] = first_x;\r\n                        ui32a_res[1] = y;\r\n                        ui32a_res[2] = last_x;\r\n                        ui32a_res[3] = y;\r\n                        const ui32_value = dv.getUint32(b);\r\n                        ui32a_res[4] = ui32_prev_value;\r\n                        ui32a_res[5] = ui32_value;\r\n                        if (first_x === 0) {\r\n                            ui32a_res[6] = 0;\r\n                        } else {\r\n                            ui32a_res[6] = ui32_prev_value << 31;\r\n                        }\r\n                        ui32a_res[7] = ui32_value >>> 1;\r\n                        ui32a_res[8] = ui32a_res[6] | ui32a_res[7];\r\n                        ui32a_res[9] = ui32_value ^ ui32a_res[8];\r\n                        cb(ui32a_res);\r\n                        i_row_segment++;\r\n                        if (i_row_segment < number_of_32bit_segments_per_32bit_divisible_row) {\r\n                            first_x += 32;\r\n                            last_x += 32;\r\n                        } else {\r\n                            i_row_segment = 0;\r\n                            y++;\r\n                            first_x = 0; last_x = 31;\r\n                        }\r\n                        b+=4;\r\n                        ui32_prev_value = ui32_value;\r\n                    }\r\n                }\r\n            } else {\r\n            }\r\n        } else {\r\n        }\r\n    }\r\n    iterate_all_ui64_locations_1bipp(cb) {\r\n        const ui32a_px_range = new Uint32Array(4);\r\n        if (this.ta_is_64bit_divisible) {\r\n            if (this.is_64_divisible_bits_per_row) {\r\n                const number_of_64bit_segments_per_64bit_divisible_row = this.number_of_64bit_segments_per_64bit_divisible_row;\r\n                if (number_of_64bit_segments_per_64bit_divisible_row === 1) {\r\n                    const height = this.size[1];\r\n                    const first_x = 0, last_x = 63;\r\n                    ui32a_px_range[0] = first_x;\r\n                    ui32a_px_range[2] = last_x;\r\n                    let y = 0;\r\n                    for (let i = 0; i < height; i++) {\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        y++;\r\n                    }\r\n                } else if (number_of_64bit_segments_per_64bit_divisible_row === 2) {\r\n                    const height = this.size[1];\r\n                    const number_of_64bit_segments = height * number_of_64bit_segments_per_64bit_divisible_row;\r\n                    let even = true;\r\n                    let y = 0;\r\n                    let first_x = 0, last_x = 63;\r\n                    for (let i = 0; i < number_of_64bit_segments; i++) {\r\n                        ui32a_px_range[0] = first_x;\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[2] = last_x;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        if (!even) {\r\n                            y++;\r\n                            first_x = 0; last_x = 63;\r\n                        } else {\r\n                            first_x = 64; last_x = 127;\r\n                        }\r\n                        even = !even;\r\n                    }\r\n                } else {\r\n                    const height = this.size[1];\r\n                    const number_of_64bit_segments = height * number_of_64bit_segments_per_64bit_divisible_row;\r\n                    let y = 0;\r\n                    let first_x = 0, last_x = 63;\r\n                    let i_row_segment = 0;\r\n                    for (let i = 0; i < number_of_64bit_segments; i++) {\r\n                        ui32a_px_range[0] = first_x;\r\n                        ui32a_px_range[1] = y;\r\n                        ui32a_px_range[2] = last_x;\r\n                        ui32a_px_range[3] = y;\r\n                        cb(ui32a_px_range);\r\n                        i_row_segment++;\r\n                        if (i_row_segment < number_of_64bit_segments_per_64bit_divisible_row) {\r\n                            first_x += 64;\r\n                            last_x += 64;\r\n                        } else {\r\n                            i_row_segment = 0;\r\n                            y++;\r\n                            first_x = 0; last_x = 63;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n            }\r\n        } else {\r\n        }\r\n    }\r\n    iterate_all_ui64_values_1bipp() {\r\n    }\r\n    iterate_1bipp_wrapping_x_span_color_toggles(cb) {\r\n        const {ta} = this;\r\n        const r1shifted_ta = right_shift_32bit_with_carry(ta);\r\n        const xored_against_orig = xor_typed_arrays(ta, r1shifted_ta);\r\n        each_1_index(xored_against_orig, cb);\r\n    }\r\n    count_1bipp_wrapping_x_span_color_toggles() {\r\n        const {ta} = this;\r\n        const r1shifted_ta = right_shift_32bit_with_carry(ta);\r\n        const xored_against_orig = xor_typed_arrays(ta, r1shifted_ta);\r\n        return count_1s(xored_against_orig);\r\n    }\r\n    'place_image_from_pixel_buffer'(pixel_buffer, dest_pos, options = {}) {\r\n        const {bipp} = this;\r\n        const dest_buffer = this.buffer;\r\n        const source_buffer = pixel_buffer.buffer;\r\n        if (bipp === 32 && pixel_buffer.bits_per_pixel === 32) {\r\n            const dest_w = this.size[0];\r\n            const dest_h = this.size[1];\r\n            const dest_buffer_line_length = dest_w * 4;\r\n            const source_w = pixel_buffer.size[0];\r\n            const source_h = pixel_buffer.size[1];\r\n            const source_buffer_line_length = source_w * 4;\r\n            let source_buffer_line_start_pos, source_buffer_line_end_pos, dest_buffer_subline_start_pos, dest_buffer_start_offset;\r\n            dest_buffer_start_offset = dest_pos[0] * 4;\r\n            for (var y = 0; y < source_h; y++) {\r\n                source_buffer_line_start_pos = y * source_buffer_line_length;\r\n                source_buffer_line_end_pos = source_buffer_line_start_pos + source_buffer_line_length;\r\n                dest_buffer_subline_start_pos = (y + dest_pos[1]) * dest_buffer_line_length;\r\n                source_buffer.copy(dest_buffer, dest_buffer_subline_start_pos + dest_buffer_start_offset, source_buffer_line_start_pos, source_buffer_line_end_pos);\r\n            }\r\n        } else if (bipp === 1) {\r\n            if (pixel_buffer.bipp === 1) {\r\n                if (options.or === true) {\r\n                    return this.draw_1bipp_pixel_buffer_mask_1bipp(pixel_buffer, dest_pos);\r\n                } else {\r\n                    const pb_source = pixel_buffer;\r\n                    const ta_pos = new Int16Array(2);\r\n                    const ta_px_value = new Uint8ClampedArray(3);\r\n                    const ta_info = new Uint32Array(4);\r\n                    const px_dest_pos = new Uint16Array(2);\r\n                    pb_source.each_ta_1bipp(ta_pos, ta_px_value, ta_info, (color, pos) => {\r\n                        px_dest_pos[0] = pos[0] + dest_pos[0];\r\n                        px_dest_pos[1] = pos[1] + dest_pos[1];\r\n                        this.set_pixel(px_dest_pos, color);\r\n                    })\r\n                }\r\n            } else {\r\n                console.trace();\r\n                throw 'must have matching bipp values (expected: 1)';\r\n            }\r\n        } else {\r\n            console.trace();\r\n            console.log('[pixel_buffer, dest_pos, options]', [pixel_buffer, dest_pos, options]);\r\n            throw 'not currently supported';\r\n        }\r\n    }\r\n    draw_filled_polygon_to_1bipp_pixel_buffer_mask(arr_points) {\r\n        if (arr_points.length >= 2) {\r\n            const bb_points = get_points_bounding_box(arr_points);\r\n            const offset = bb_points[0];\r\n            const polygon_size = [\r\n                [bb_points[1][0] - bb_points[0][0] + 1],\r\n                [bb_points[1][1] - bb_points[0][1] + 1]\r\n            ];\r\n            if (polygon_size[0] === 1 && polygon_size[1] === 1 ) {\r\n                const pb_polygon = new this.constructor({\r\n                    'bits_per_pixel': 1,\r\n                    'size': polygon_size\r\n                });\r\n                pb_polygon.ta[0] = 128;\r\n                pb_polygon.__offset = offset;\r\n                return pb_polygon;\r\n            } else if (polygon_size[0] === 2 && polygon_size[1] === 1 || polygon_size[0] === 1 && polygon_size[1] === 2) {\r\n                const pb_polygon = new this.constructor({\r\n                    'bits_per_pixel': 1,\r\n                    'size': polygon_size\r\n                });\r\n                pb_polygon.ta[0] = 192;\r\n                pb_polygon.__offset = offset;\r\n                return pb_polygon;\r\n            } else {\r\n                const pb_polygon = new this.constructor({\r\n                    'bits_per_pixel': 1,\r\n                    'size': polygon_size\r\n                });\r\n                const down_offsetted_points = arr_points.map(point => [point[0] - offset[0], point[1] - offset[1]]);\r\n                pb_polygon.draw_polygon(down_offsetted_points, 1, false);\r\n                pb_polygon.flood_fill_inner_pixels_off_to_on_1bipp();\r\n                pb_polygon.__offset = offset;\r\n                return pb_polygon;\r\n            }\r\n        } else if (arr_points.length === 1) {\r\n            const pb_polygon = new this.constructor({\r\n                'bits_per_pixel': 1,\r\n                'size': polygon_size\r\n            });\r\n            pb_polygon.ta[0] = 128;\r\n            pb_polygon.__offset = offset;\r\n            return pb_polygon;\r\n        }\r\n    }\r\n    get ta2() {\r\n        if (!this._ta2) {\r\n            this._ta2 = new Uint8Array(this.ta.length);\r\n        }\r\n        return this._ta2;\r\n    }\r\n    apply_square_convolution(f32a_convolution) {\r\n        return this.process((orig, res) => {\r\n            const c_length = f32a_convolution.length;\r\n            const dimension_size = Math.sqrt(c_length);\r\n            const padding = (dimension_size - 1) / 2;\r\n            let x, y, pos = 0,\r\n                ii, i;\r\n            const bpp = this.bytes_per_pixel;\r\n            const bpr = this.bytes_per_row;\r\n            const idx_movement_vectors = get_idx_movement_vectors(f32a_convolution, bpp, bpr);\r\n            let cr, cg, cb, ca;\r\n            const buf = this.buffer;\r\n            const buf_res = res.buffer;\r\n            if (bpp === 3) {\r\n                this.padded_each_pixel_index(padding, (px_idx) => {\r\n                    cr = 0;\r\n                    cg = 0;\r\n                    cb = 0;\r\n                    for (ii = 0; ii < c_length; ii++) {\r\n                        i = px_idx + idx_movement_vectors[ii];\r\n                        cr += f32a_convolution[ii] * buf[i++];\r\n                        cg += f32a_convolution[ii] * buf[i++];\r\n                        cb += f32a_convolution[ii] * buf[i++];\r\n                    }\r\n                    if (cr < 0) cr = 0;\r\n                    if (cg < 0) cg = 0;\r\n                    if (cb < 0) cb = 0;\r\n                    if (cr > 255) cr = 255;\r\n                    if (cg > 255) cg = 255;\r\n                    if (cb > 255) cb = 255;\r\n                    buf_res[px_idx++] = Math.round(cr);\r\n                    buf_res[px_idx++] = Math.round(cg);\r\n                    buf_res[px_idx++] = Math.round(cb);\r\n                });\r\n            } else if (bpp === 4) {\r\n                this.padded_each_pixel_index(padding, (px_idx) => {\r\n                    cr = 0;\r\n                    cg = 0;\r\n                    cb = 0;\r\n                    for (ii = 0; ii < c_length; ii++) {\r\n                        i = px_idx + idx_movement_vectors[ii];\r\n                        cr += f32a_convolution[ii] * buf[i++];\r\n                        cg += f32a_convolution[ii] * buf[i++];\r\n                        cb += f32a_convolution[ii] * buf[i++];\r\n                    }\r\n                    ca = 255;\r\n                    if (cr < 0) cr = 0;\r\n                    if (cg < 0) cg = 0;\r\n                    if (cb < 0) cb = 0;\r\n                    if (cr > 255) cr = 255;\r\n                    if (cg > 255) cg = 255;\r\n                    if (cb > 255) cb = 255;\r\n                    buf_res[px_idx++] = Math.round(cr);\r\n                    buf_res[px_idx++] = Math.round(cg);\r\n                    buf_res[px_idx++] = Math.round(cb);\r\n                    buf_res[px_idx++] = Math.round(ca);\r\n                });\r\n            } else {\r\n                throw 'NYI';\r\n            }\r\n            return res;\r\n        })\r\n    }\r\n    extract_channel(i_channel) {\r\n        const bypp = this.bytes_per_pixel;\r\n        const ta = this.ta;\r\n        let i_byte = i_channel;\r\n        let i_px = 0;\r\n        const l = ta.length;\r\n        if (bypp === 3 || bypp === 4) {\r\n            const res_channel_ta = new this.constructor({\r\n                size: this.size,\r\n                bits_per_pixel: 8\r\n            })\r\n            while (i_byte < l) {\r\n                res_channel_ta.set_pixel_by_idx(i_px, ta[i_byte]);\r\n                i_byte += bypp;\r\n                i_px++;\r\n            }\r\n            return res_channel_ta;\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    _custom_convolve(dimension_size, cb) {\r\n        if (dimension_size % 2 !== 1) {\r\n            throw 'dimension_size must be an odd integer';\r\n        }\r\n        const px = new Uint16Array(2);\r\n        const ta16 = new Int16Array(12);\r\n        [ta16[2], ta16[3]] = this.size;\r\n        ta16[4] = this.bytes_per_pixel;\r\n        ta16[5] = ta16[2] * ta16[4] \r\n        ta16[8] = dimension_size;\r\n        ta16[9] = (ta16[8] - 1) / 2 \r\n        ta16[10] = 0; \r\n        ta16[11] = ta16[8] * ta16[4];\r\n        let ta32 = new Uint32Array(4);\r\n        ta32[0] = 0; \r\n        ta32[1] = 0; \r\n        ta32[2] = ta16[2] * ta16[3] * ta16[4] \r\n        let conv_pixels = new Uint8Array(ta16[8] * ta16[8] * ta16[8]);\r\n        const buffer = this.buffer;\r\n        for (px[1] = 0; px[1] < ta16[3]; px[1]++) {\r\n            for (px[0] = 0; px[0] < ta16[2]; px[0]++) {\r\n                ta16[6] = px[0] - ta16[8];\r\n                if (ta16[6] > 0 && ta16[6] < ta16[2] - ta16[8]) {\r\n                    ta16[7] = px[1] - ta16[8];\r\n                    if (ta16[7] > 0 && ta16[7] < ta16[3] - ta16[8]) {\r\n                        ta32[1] = ta32[0] -  ta16[9] * ta16[4] -  ta16[9] * ta16[5];\r\n                        ta16[10] = 0;\r\n                        for (ta16[7] = ta16[1]; ta16[7] < ta16[1] + ta16[8]; ta16[7]++) {\r\n                            let sl = buffer.slice(ta32[1], ta32[1] + ta16[11]);\r\n                            for (let c = 0; c < ta16[11]; c++) {\r\n                                conv_pixels[ta16[10] + c] = sl.readUInt8(c);\r\n                            }\r\n                            ta16[10] += ta16[11];\r\n                            ta32[1] += ta16[5];\r\n                        }\r\n                        cb(px, conv_pixels);\r\n                    }\r\n                }\r\n                ta32[0] += ta16[4];\r\n            }\r\n        }\r\n    }\r\n    get_first_pixel_matching_color(r, g, b, a) {\r\n        let px = 0,\r\n            py = 0;\r\n        let [w, h] = this.size;\r\n        let found = false;\r\n        let buf = this.buffer;\r\n        let pos_buf = 0;\r\n        for (py = 0; !found && py < h; py++) {\r\n            for (px = 0; !found && px < w; px++) {\r\n                if (buf[pos_buf] === r && buf[pos_buf + 1] === g && buf[pos_buf + 2] === b && buf[pos_buf + 3] === a) {\r\n                    found = true;\r\n                }\r\n                pos_buf += 4;\r\n            }\r\n        }\r\n        if (found) {\r\n            return [px, py];\r\n        }\r\n    }\r\n    'flood_fill_small_color_blocks'(max_size, r, g, b, a) {\r\n        this.each_pixel((x, y, pr, pg, pb, pa) => {\r\n            if ((r !== pr || g !== pg || b !== pb || a !== pa)) {\r\n                let s = this.measure_color_region_size(x, y, max_size);\r\n                if (s < max_size) {\r\n                    this.flood_fill(x, y, r, g, b, a);\r\n                }\r\n            }\r\n        })\r\n    }\r\n    self_replace_color(target_color, replacement_color) {\r\n        const bpp = this.bytes_per_pixel;\r\n        const buf = this.buffer;\r\n        const l = buf.length;\r\n        if (bpp === 1) {\r\n            for (let c = 0; c < l; c++) {\r\n                if (buf[c] === target_color) buf[c] = replacement_color;\r\n            }\r\n        } else {\r\n            throw 'NYI';\r\n        }\r\n        return this;\r\n    }\r\n    '_replace_color'(r, g, b, a, tr, tg, tb, ta) {\r\n        const buf_read = this.buffer;\r\n        let ta_u8 = new Uint8Array(8);\r\n        ta_u8[0] = r;\r\n        ta_u8[1] = g;\r\n        ta_u8[2] = b;\r\n        ta_u8[3] = a;\r\n        ta_u8[4] = tr;\r\n        ta_u8[5] = tg;\r\n        ta_u8[6] = tb;\r\n        ta_u8[7] = ta;\r\n        const ta_16_scratch = new Uint32Array(8);\r\n        ta_16_scratch[0] = 0; \r\n        ta_16_scratch[2] = buf_read.length;\r\n        while (ta_16_scratch[0] < ta_16_scratch[2]) {\r\n            if (buf_read[ta_16_scratch[0]] === ta_u8[0] && buf_read[ta_16_scratch[0] + 1] === ta_u8[1] && buf_read[ta_16_scratch[0] + 2] === ta_u8[2] && buf_read[ta_16_scratch[0] + 3] === ta_u8[3]) {\r\n                buf_read[ta_16_scratch[0]] = ta_u8[4];\r\n                buf_read[ta_16_scratch[0] + 1] = ta_u8[5];\r\n                buf_read[ta_16_scratch[0] + 2] = ta_u8[6];\r\n                buf_read[ta_16_scratch[0] + 3] = ta_u8[7];\r\n            } else {\r\n            }\r\n            ta_16_scratch[0] += 4;\r\n        }\r\n    }\r\n    '__get_single_color_mask_32'(r, g, b, a) {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 32\r\n        });\r\n        res.buffer.fill(0);\r\n        const buf_read = this.buffer;\r\n        const buf_write = res.buffer;\r\n        const ta_16_scratch = new Uint32Array(8);\r\n        ta_16_scratch[0] = 0; \r\n        ta_16_scratch[1] = 0; \r\n        ta_16_scratch[2] = buf_read.length;\r\n        ta_16_scratch[3] = buf_write.length;\r\n        let ta_u8 = new Uint8Array(4);\r\n        ta_u8[0] = r;\r\n        ta_u8[1] = g;\r\n        ta_u8[2] = b;\r\n        ta_u8[3] = a;\r\n        while (ta_16_scratch[0] < ta_16_scratch[2]) {\r\n            if (buf_read[ta_16_scratch[0]] === ta_u8[0] && buf_read[ta_16_scratch[0] + 1] === ta_u8[1] && buf_read[ta_16_scratch[0] + 2] === ta_u8[2] && buf_read[ta_16_scratch[0] + 3] === ta_u8[3]) {\r\n                buf_write[ta_16_scratch[1]++] = 0;\r\n                buf_write[ta_16_scratch[1]++] = 0;\r\n                buf_write[ta_16_scratch[1]++] = 0;\r\n                buf_write[ta_16_scratch[1]++] = 255;\r\n            } else {\r\n                buf_write[ta_16_scratch[1]++] = 255;\r\n                buf_write[ta_16_scratch[1]++] = 255;\r\n                buf_write[ta_16_scratch[1]++] = 255;\r\n                buf_write[ta_16_scratch[1]++] = 255;\r\n            }\r\n            ta_16_scratch[0] += 4;\r\n        }\r\n        return res;\r\n    }\r\n    count_pixels_with_color(...args) {\r\n        const {bipp} = this;\r\n        if (bipp === 32) {\r\n            const [r, g, b, a] = args;\r\n            const buf_read = this.buffer;\r\n            const scratch_32 = new Uint32Array(5);\r\n            scratch_32[0] = 0; \r\n            scratch_32[2] = buf_read.length;\r\n            scratch_32[4] = 0;\r\n            const ta_16_scratch = new Uint16Array(8);\r\n            let ta_u8 = new Uint8Array(4);\r\n            ta_u8[0] = r;\r\n            ta_u8[1] = g;\r\n            ta_u8[2] = b;\r\n            ta_u8[3] = a;\r\n            while (scratch_32[0] < scratch_32[2]) {\r\n                if (buf_read[scratch_32[0]++] === ta_u8[0] && buf_read[scratch_32[0]++] === ta_u8[1] && buf_read[scratch_32[0]++] === ta_u8[2] && buf_read[scratch_32[0]++] === ta_u8[3]) {\r\n                    scratch_32[4]++;\r\n                }\r\n            }\r\n            return scratch_32[4];\r\n        } else {\r\n            return super.count_pixels_with_color(...args);\r\n        }\r\n    }\r\n    '__get_single_color_mask'(r, g, b, a) {\r\n        var res = new this.constructor({\r\n            'size': this.size,\r\n            'bits_per_pixel': 8\r\n        });\r\n        res.buffer.fill(0);\r\n        const buf_read = this.buffer;\r\n        const buf_write = res.buffer;\r\n        const ta_16_scratch = new Uint16Array(8);\r\n        ta_16_scratch[0] = 0; \r\n        ta_16_scratch[1] = 0; \r\n        ta_16_scratch[2] = buf_read.length;\r\n        ta_16_scratch[3] = buf_write.length;\r\n        let ta_u8 = new Uint8Array(4);\r\n        ta_u8[0] = r;\r\n        ta_u8[1] = g;\r\n        ta_u8[2] = b;\r\n        ta_u8[3] = a;\r\n        while (ta_16_scratch[0] < ta_16_scratch[2]) {\r\n            if (buf_read[ta_16_scratch[0]++] === ta_u8[0] && buf_read[ta_16_scratch[0]++] === ta_u8[1] && buf_read[ta_16_scratch[0]++] === ta_u8[2] && buf_read[ta_16_scratch[0]++] === ta_u8[3]) {\r\n                buf_write[ta_16_scratch[1]] = 255;\r\n            }\r\n            ta_16_scratch[1]++;\r\n        }\r\n        return res;\r\n    }\r\n    'measure_color_region_size'(x, y, max) {\r\n        const buffer = this.buffer;\r\n        if (this.bytes_per_pixel === 4) {\r\n            const scratch_32 = new Uint32Array(16);\r\n            scratch_32[0] = this.size[0]; \r\n            scratch_32[1] = this.size[1]; \r\n            scratch_32[2] = scratch_32[0] * scratch_32[1];\r\n            scratch_32[3] = this.bytes_per_pixel;\r\n            scratch_32[6] = 0 \r\n            scratch_32[7] = 0 \r\n            scratch_32[8] = 0 \r\n            scratch_32[9] = max;\r\n            const ta8_pixels = new Uint8Array(12);\r\n            scratch_32[10] = 0 \r\n            const ta16_pixels = new Uint8Array(4);\r\n            const ta_pixels_visited = new Uint8Array(scratch_32[2]);\r\n            const ta_visiting_pixels = new Uint16Array(scratch_32[2] * 2);\r\n            scratch_32[8] = scratch_32[3] * (x + (y * scratch_32[0]));\r\n            ta8_pixels[0] = buffer[scratch_32[8]++];\r\n            ta8_pixels[1] = buffer[scratch_32[8]++];\r\n            ta8_pixels[2] = buffer[scratch_32[8]++];\r\n            ta8_pixels[3] = buffer[scratch_32[8]++];\r\n            ta_visiting_pixels[0] = x;\r\n            ta_visiting_pixels[1] = y;\r\n            scratch_32[7] = 2;\r\n            while (scratch_32[6] < scratch_32[7] && scratch_32[10] < scratch_32[9]) {\r\n                scratch_32[4] = ta_visiting_pixels[scratch_32[6]++]; \r\n                scratch_32[5] = ta_visiting_pixels[scratch_32[6]++]; \r\n                scratch_32[8] = scratch_32[3] * (scratch_32[4] + (scratch_32[5] * scratch_32[0]));\r\n                ta8_pixels[4] = buffer[scratch_32[8]++];\r\n                ta8_pixels[5] = buffer[scratch_32[8]++];\r\n                ta8_pixels[6] = buffer[scratch_32[8]++];\r\n                ta8_pixels[7] = buffer[scratch_32[8]++];\r\n                ta16_pixels[0] = ta8_pixels[4] - ta8_pixels[0];\r\n                ta16_pixels[1] = ta8_pixels[5] - ta8_pixels[1];\r\n                ta16_pixels[2] = ta8_pixels[6] - ta8_pixels[2];\r\n                ta16_pixels[3] = ta8_pixels[7] - ta8_pixels[3];\r\n                if (ta16_pixels[0] === 0 && ta16_pixels[1] === 0 && ta16_pixels[2] === 0 && ta16_pixels[3] === 0) {\r\n                    if (scratch_32[4] - 1 >= 0 && scratch_32[4] - 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] - 1;\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                        ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                    }\r\n                    if (scratch_32[5] - 1 >= 0 && scratch_32[5] - 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] === 0) {\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] - 1;\r\n                        ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] = 255;\r\n                    }\r\n                    if (scratch_32[4] + 1 >= 0 && scratch_32[4] + 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] + 1;\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                        ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] = 255\r\n                    }\r\n                    if (scratch_32[5] + 1 >= 0 && scratch_32[5] + 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] === 0) {\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                        ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] + 1;\r\n                        ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] = 255\r\n                    }\r\n                }\r\n                scratch_32[10]++;\r\n            }\r\n            return scratch_32[10];\r\n        } else if (this.bytes_per_pixel === 1) {\r\n            return (() => {\r\n                const scratch_32 = new Uint32Array(16);\r\n                scratch_32[0] = this.size[0]; \r\n                scratch_32[1] = this.size[1]; \r\n                scratch_32[2] = scratch_32[0] * scratch_32[1];\r\n                scratch_32[3] = this.bytes_per_pixel;\r\n                scratch_32[6] = 0 \r\n                scratch_32[7] = 0 \r\n                scratch_32[8] = 0 \r\n                scratch_32[9] = max;\r\n                const ta8_pixels = new Uint8Array(12);\r\n                scratch_32[10] = 0 \r\n                const ta16_pixels = new Uint8Array(4);\r\n                const ta_pixels_visited = new Uint8Array(scratch_32[2]);\r\n                const ta_visiting_pixels = new Uint16Array(scratch_32[2] * 2);\r\n                scratch_32[8] = scratch_32[3] * (x + (y * scratch_32[0]));\r\n                ta8_pixels[0] = buffer[scratch_32[8]++];\r\n                ta_visiting_pixels[0] = x;\r\n                ta_visiting_pixels[1] = y;\r\n                scratch_32[7] = 2;\r\n                while (scratch_32[6] < scratch_32[7] && scratch_32[10] < scratch_32[9]) {\r\n                    scratch_32[4] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[5] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[8] = scratch_32[3] * (scratch_32[4] + (scratch_32[5] * scratch_32[0]));\r\n                    ta8_pixels[4] = buffer[scratch_32[8]++];\r\n                    ta16_pixels[0] = ta8_pixels[4] - ta8_pixels[0];\r\n                    if (ta16_pixels[0] === 0) {\r\n                        if (scratch_32[4] - 1 >= 0 && scratch_32[4] - 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] - 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] - 1 >= 0 && scratch_32[5] - 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] - 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] = 255;\r\n                        }\r\n                        if (scratch_32[4] + 1 >= 0 && scratch_32[4] + 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] + 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] = 255\r\n                        }\r\n                        if (scratch_32[5] + 1 >= 0 && scratch_32[5] + 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] + 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] = 255\r\n                        }\r\n                    }\r\n                    scratch_32[10]++;\r\n                }\r\n                return scratch_32[10];\r\n            })();\r\n        } else {\r\n            throw 'unsuppored bytes_per_pixel ' + this.bytes_per_pixel\r\n        }\r\n    }\r\n    'get_pixel_pos_list_of_pixels_with_color'(color) {\r\n        let res = new Pixel_Pos_List();\r\n        if (this.pos) {\r\n            console.log('this.pos', this.pos);\r\n            this.each_pixel_ta((pos, px_color) => {\r\n                if (px_color === color) {\r\n                    res.add(new Uint16Array([pos[0] + this.pos[0], pos[1] + this.pos[1]]));\r\n                }\r\n            });\r\n            res.pos = this.pos;\r\n        } else {\r\n            this.each_pixel_ta((pos, px_color) => {\r\n                if (px_color === color) {\r\n                    res.add(pos);\r\n                }\r\n            });\r\n        }\r\n        res.fix();\r\n        return res;\r\n    }\r\n    'get_ppl_color_region'(pos) {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n    'flood_fill_self_get_pixel_pos_list'(pos, color) {\r\n        const size = this.size;\r\n        if (!(pos instanceof Uint16Array || pos instanceof Uint32Array)) {\r\n            throw 'Wrong pos data type, pos ' + pos;\r\n        }\r\n        if (this.bytes_per_pixel === 4) {\r\n            throw 'NYI'\r\n        } else if (this.bytes_per_pixel === 1) {\r\n            const using_ta_pixels_visited = () => {\r\n                const res = new Pixel_Pos_List();\r\n                const buffer = this.buffer;\r\n                const scratch_32 = new Uint32Array(10);\r\n                scratch_32[0] = this.size[0]; \r\n                scratch_32[1] = this.size[1]; \r\n                const size = scratch_32;\r\n                scratch_32[2] = size[0] * size[1];\r\n                scratch_32[3] = this.bytes_per_pixel;\r\n                let cpos = pos.slice();\r\n                scratch_32[6] = 0 \r\n                scratch_32[7] = 0 \r\n                scratch_32[8] = 0 \r\n                scratch_32[9] = 0 \r\n                const obj_pixels_visited = {};\r\n                const ppl_visiting_pixels = new Pixel_Pos_List();\r\n                const ta_visiting_pixels = ppl_visiting_pixels.ta;\r\n                let ccolor;\r\n                scratch_32[8] = scratch_32[3] * (cpos[0] + (cpos[1] * size[0]));\r\n                ccolor = buffer[scratch_32[8]++];\r\n                ppl_visiting_pixels.add(cpos);\r\n                scratch_32[7] = 2;\r\n                while (scratch_32[9] <= scratch_32[2]) {\r\n                    console.log('scratch_32[9]', scratch_32[9]);\r\n                    console.log('scratch_32[2]', scratch_32[2]);\r\n                    cpos[0] = ta_visiting_pixels[scratch_32[6]++];\r\n                    cpos[1] = ta_visiting_pixels[scratch_32[6]++];\r\n                    scratch_32[8] = scratch_32[3] * (cpos[0] + (cpos[1] * size[0]));\r\n                    if (buffer[scratch_32[8]++] - ccolor === 0) {\r\n                        buffer[scratch_32[8] - 1] = color;\r\n                        res.add(cpos);\r\n                        if (cpos[0] - 1 >= 0 && !obj_pixels_visited[cpos[0] - 1 + (size[0] * cpos[1])]) {\r\n                            ppl_visiting_pixels.add(new Uint16Array([cpos[0] - 1, cpos[1]]));\r\n                            scratch_32[7] += 2;\r\n                            obj_pixels_visited[cpos[0] - 1 + (size[0] * cpos[1])] = true;\r\n                        }\r\n                        if (cpos[1] - 1 >= 0 && !obj_pixels_visited[cpos[0] + (size[0] * (cpos[1] - 1))]) {\r\n                            ppl_visiting_pixels.add(new Uint16Array([cpos[0], cpos[1] - 1]));\r\n                            scratch_32[7] += 2;\r\n                            obj_pixels_visited[cpos[0] + (size[0] * (cpos[1] - 1))] = true;\r\n                        }\r\n                        if (cpos[0] + 1 < size[0] && !obj_pixels_visited[cpos[0] + 1 + (size[0] * cpos[1])]) {\r\n                            ppl_visiting_pixels.add(new Uint16Array([cpos[0] + 1, cpos[1]]));\r\n                            scratch_32[7] += 2;\r\n                            obj_pixels_visited[cpos[0] + 1 + (size[0] * cpos[1])] = true;\r\n                        }\r\n                        if (cpos[1] + 1 < size[1] && !obj_pixels_visited[cpos[0] + (size[0] * (cpos[1] + 1))]) {\r\n                            ppl_visiting_pixels.add(new Uint16Array([cpos[0], cpos[1] + 1]));\r\n                            scratch_32[7] += 2;\r\n                            obj_pixels_visited[cpos[0] + (size[0] * (cpos[1] + 1))] = true;\r\n                        }\r\n                    }\r\n                    scratch_32[9]++;\r\n                }\r\n                res.fix();\r\n                return res;\r\n            }\r\n            return using_ta_pixels_visited();\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    'flood_fill_c1_1bipp'(pos) {\r\n        const target_color = this.get_pixel_1bipp(pos);\r\n        let [x, y] = pos;\r\n        if (target_color === 1) {\r\n            return 0;\r\n        } else {\r\n            const ta_stack_fn_calls_inlined_8bipp_visited_matrix_implementation = () => {\r\n                let stack_capacity = 1024 * 1024 * 16; \r\n                let ta_stack = new Uint16Array(stack_capacity);\r\n                let i_stack_pos = 0;\r\n                let stack_length = 0;\r\n                let px_color;\r\n                let ta_pos = new Uint16Array(2);\r\n                let ta_pos2 = new Uint16Array(2);\r\n                ta_pos[0] = pos[0];\r\n                ta_pos[1] = pos[1];\r\n                if (i_stack_pos < stack_capacity) {\r\n                    ta_stack[i_stack_pos++] = ta_pos[0];\r\n                    ta_stack[i_stack_pos++] = ta_pos[1];\r\n                    stack_length++;\r\n                } else {\r\n                    console.log('stack_length', stack_length);\r\n                    console.log('i_stack_pos', i_stack_pos);\r\n                    console.trace();\r\n                    throw 'NYI - stack exceeded capacity';\r\n                }\r\n                const [width, height] = this.size;\r\n                const ta_already_visited = new Uint8Array(width * height);\r\n                while (stack_length > 0) {\r\n                    ta_pos[0] = ta_stack[i_stack_pos - 2];\r\n                    ta_pos[1] = ta_stack[i_stack_pos - 1];\r\n                    i_stack_pos -= 2;\r\n                    stack_length--;\r\n                    if (i_stack_pos >= stack_capacity - 8) {\r\n                        throw 'Not enough stack for positions yet to visit';\r\n                    }\r\n                    px_color = this.get_pixel_1bipp(ta_pos); \r\n                    if (px_color === target_color) {\r\n                        this.set_pixel_on_1bipp(ta_pos);\r\n                        if (ta_pos[0] > 0) {\r\n                            ta_pos2[0] = ta_pos[0] - 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                stack_length++;\r\n                            };\r\n                        }\r\n                        if (ta_pos[0] < width - 1) {\r\n                            ta_pos2[0] = ta_pos[0] + 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                stack_length++;\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] > 0) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] - 1;\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                stack_length++;\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] < height - 1) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] + 1;\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                stack_length++;\r\n                            };\r\n                        }\r\n                        ta_already_visited[width * ta_pos[1] + ta_pos[0]] = 255\r\n                    }\r\n                }\r\n            }\r\n            const horizontal_line_filling_stack_to_visit_store_already_visited_implementation = () => {\r\n                const {ta, size} = this;\r\n                const aa_x_off_spans = this.calculate_arr_rows_arr_x_off_spans_1bipp();\r\n                console.log('aa_x_off_spans', aa_x_off_spans);\r\n                const find_connected_x_off_spans_below = (y, idx_x_off_span) => {\r\n                    const res = [];\r\n                    if (y < aa_x_off_spans.length - 1) {\r\n                        const span1 = aa_x_off_spans[y][idx_x_off_span];\r\n                        console.log('');\r\n                        console.log('span1', span1);\r\n                        const y_below = aa_x_off_spans[y + 1];\r\n                        console.log('y_below', y_below);\r\n                        const l_y_below = y_below.length;\r\n                        for (let i_below = 0; i_below < l_y_below; i_below++) {\r\n                            const range_below = y_below[i_below];\r\n                            const has_overlap = range_below[0] >= span1[0] && range_below[0] <= span1[1] || range_below[1] >= span1[0] && range_below[1] <= span1[1];\r\n                            console.log('range_below', range_below);\r\n                            console.log('has_overlap', has_overlap);\r\n                            if (has_overlap) {\r\n                                res.push(range_below);\r\n                            }\r\n                        }\r\n                    }\r\n                    return res;\r\n                }\r\n                for (let y = 0; y < aa_x_off_spans.length; y++) {\r\n                    const arr_row_x_off_spans = aa_x_off_spans[y];\r\n                    for (let idx_x_off_span = 0; idx_x_off_span < arr_row_x_off_spans.length; idx_x_off_span++) {\r\n                        const x_off_span = arr_row_x_off_spans[idx_x_off_span];\r\n                        const path_xos = [y, idx_x_off_span];\r\n                        console.log('path_xos', path_xos);\r\n                        const spans_connected_below = find_connected_x_off_spans_below(y, idx_x_off_span);\r\n                        console.log('spans_connected_below', spans_connected_below);\r\n                    }\r\n                }\r\n                const old = () => {\r\n                    const calculate_1bipp_row_arr_x_spans_off = y => {\r\n                        const res = [];\r\n                        const width = this.size[0];\r\n                        let last_color = 0;\r\n                        let current_color;\r\n                        let ta_pos = new Uint16Array(2);\r\n                        ta_pos[1] = y;\r\n                        for (let x = 0; x < width; x++) {\r\n                            ta_pos[0] = x;\r\n                            current_color = this.get_pixel_1bipp(ta_pos);\r\n                            if (current_color === last_color) {\r\n                                if (res.length === 0) {\r\n                                    res.push([0, 1]);\r\n                                } else {\r\n                                    res[res.length - 1][1]++;\r\n                                }\r\n                            } else {\r\n                                if (res.length === 0) {\r\n                                    res.push([0, 0]); \r\n                                    res.push([0, 1]);\r\n                                } else {\r\n                                    res.push([x, x + 1]);\r\n                                }\r\n                            }\r\n                            last_color = current_color;\r\n                        }\r\n                        return res;\r\n                    }\r\n                    const row_x_off_spans = calculate_1bipp_row_arr_x_spans_off(y);\r\n                    console.log('----------------');\r\n                    console.log('row_x_off_spans', row_x_off_spans);\r\n                    if (y > 0) {\r\n                        const row_above_x_off_spans = calculate_1bipp_row_arr_x_spans_off(y - 1);\r\n                        console.log('row_above_x_off_spans', row_above_x_off_spans);\r\n                    }\r\n                    if (y < this.size[1] - 1) {\r\n                        const row_below_x_off_spans = calculate_1bipp_row_arr_x_spans_off(y + 1);\r\n                        console.log('row_below_x_off_spans', row_below_x_off_spans);\r\n                    }\r\n                    console.log('----------------');\r\n                }\r\n            }\r\n            return ta_stack_fn_calls_inlined_8bipp_visited_matrix_implementation();\r\n        }\r\n    }\r\n    'flood_fill_1bipp'(x, y, color) {\r\n        const new_color = color;\r\n        const target_color = this.get_pixel_1bipp([x, y]);\r\n        const [width, height] = this.size;\r\n        if (target_color === new_color) {\r\n            return 0;\r\n        } else {\r\n            const ta_stack_fn_calls_inlined_implementation = () => {\r\n                let stack_capacity = 1024 * 1024 * 8; \r\n                let ta_stack = new Uint16Array(stack_capacity);\r\n                let i_stack_pos = 0;\r\n                let stack_length = 0;\r\n                let px_color;\r\n                let ta_pos = new Uint16Array(2);\r\n                let ta_pos2 = new Uint16Array(2);\r\n                ta_pos[0] = x;\r\n                ta_pos[1] = y;\r\n                if (i_stack_pos < stack_capacity) {\r\n                    ta_stack[i_stack_pos++] = ta_pos[0];\r\n                    ta_stack[i_stack_pos++] = ta_pos[1];\r\n                    stack_length++;\r\n                } else {\r\n                    console.log('stack_length', stack_length);\r\n                    console.log('i_stack_pos', i_stack_pos);\r\n                    console.trace();\r\n                    throw 'NYI - stack exceeded capacity';\r\n                }\r\n                const pb_already_visited = new Core({\r\n                    size: this.size,\r\n                    bits_per_pixel: 1\r\n                })\r\n                while (stack_length > 0) {\r\n                        ta_pos[0] = ta_stack[i_stack_pos - 2];\r\n                        ta_pos[1] = ta_stack[i_stack_pos - 1];\r\n                        i_stack_pos -= 2;\r\n                        stack_length--;\r\n                    px_color = this.get_pixel_1bipp(ta_pos); \r\n                    if (px_color === target_color) {\r\n                        this.set_pixel_1bipp(ta_pos, new_color);\r\n                        if (ta_pos[0] > 0) {\r\n                            ta_pos2[0] = ta_pos[0] - 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (pb_already_visited.get_pixel_1bipp(ta_pos2) === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[0] < width - 1) {\r\n                            ta_pos2[0] = ta_pos[0] + 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (pb_already_visited.get_pixel_1bipp(ta_pos2) === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] > 0) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] - 1;\r\n                            if (pb_already_visited.get_pixel_1bipp(ta_pos2) === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] < height - 1) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] + 1;\r\n                            if (pb_already_visited.get_pixel_1bipp(ta_pos2) === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        pb_already_visited.set_pixel_1bipp(ta_pos, 1);\r\n                    }\r\n                }\r\n            }\r\n            const ta_stack_fn_calls_inlined_8bipp_visited_matrix_implementation = () => {\r\n                let stack_capacity = 1024 * 1024 * 8; \r\n                let ta_stack = new Uint16Array(stack_capacity);\r\n                let i_stack_pos = 0;\r\n                let stack_length = 0;\r\n                let px_color;\r\n                let ta_pos = new Uint16Array(2);\r\n                let ta_pos2 = new Uint16Array(2);\r\n                ta_pos[0] = x;\r\n                ta_pos[1] = y;\r\n                if (i_stack_pos < stack_capacity) {\r\n                    ta_stack[i_stack_pos++] = ta_pos[0];\r\n                    ta_stack[i_stack_pos++] = ta_pos[1];\r\n                    stack_length++;\r\n                } else {\r\n                    console.log('stack_length', stack_length);\r\n                    console.log('i_stack_pos', i_stack_pos);\r\n                    console.trace();\r\n                    throw 'NYI - stack exceeded capacity';\r\n                }\r\n                const [width, height] = this.size;\r\n                const ta_already_visited = new Uint8Array(width * height);\r\n                while (stack_length > 0) {\r\n                        ta_pos[0] = ta_stack[i_stack_pos - 2];\r\n                        ta_pos[1] = ta_stack[i_stack_pos - 1];\r\n                        i_stack_pos -= 2;\r\n                        stack_length--;\r\n                    px_color = this.get_pixel_1bipp(ta_pos); \r\n                    if (px_color === target_color) {\r\n                        this.set_pixel_1bipp(ta_pos, new_color);\r\n                        if (ta_pos[0] > 0) {\r\n                            ta_pos2[0] = ta_pos[0] - 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[0] < width - 1) {\r\n                            ta_pos2[0] = ta_pos[0] + 1;\r\n                            ta_pos2[1] = ta_pos[1];\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] > 0) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] - 1;\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        if (ta_pos[1] < height - 1) {\r\n                            ta_pos2[0] = ta_pos[0];\r\n                            ta_pos2[1] = ta_pos[1] + 1;\r\n                            if (ta_already_visited[width * ta_pos2[1] + ta_pos2[0]] === 0) {\r\n                                if (i_stack_pos < stack_capacity) {\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[0];\r\n                                    ta_stack[i_stack_pos++] = ta_pos2[1];\r\n                                    stack_length++;\r\n                                } else {\r\n                                    console.log('stack_length', stack_length);\r\n                                    console.log('i_stack_pos', i_stack_pos);\r\n                                    console.trace();\r\n                                    throw 'NYI - stack exceeded capacity';\r\n                                }\r\n                            };\r\n                        }\r\n                        ta_already_visited[width * ta_pos[1] + ta_pos[0]] = 255\r\n                    }\r\n                }\r\n            }\r\n            return ta_stack_fn_calls_inlined_8bipp_visited_matrix_implementation();\r\n        }\r\n    }\r\n    'flood_fill'(x, y, r, g, b, a) {\r\n        const {\r\n            bipp\r\n        } = this;\r\n        if (bipp === 24) {\r\n            const [w, h] = this.size;\r\n            let fast_stacked_mapped_flood_fill = () => {\r\n                const buffer = this.buffer;\r\n                const scratch_32 = new Uint32Array(16);\r\n                scratch_32[0] = this.size[0]; \r\n                scratch_32[1] = this.size[1]; \r\n                scratch_32[2] = scratch_32[0] * scratch_32[1];\r\n                scratch_32[3] = this.bytes_per_pixel;\r\n                scratch_32[6] = 0 \r\n                scratch_32[7] = 0 \r\n                scratch_32[8] = 0 \r\n                scratch_32[9] = 0 \r\n                const ta8_pixels = new Uint8Array(12);\r\n                ta8_pixels[8] = r;\r\n                ta8_pixels[9] = g;\r\n                ta8_pixels[10] = b;\r\n                const ta_pixels_visited = new Uint8Array(scratch_32[2]);\r\n                const ta_visiting_pixels = new Uint16Array(scratch_32[2] * 2);\r\n                scratch_32[8] = scratch_32[3] * (x + (y * scratch_32[0]));\r\n                ta8_pixels[0] = buffer[scratch_32[8]++];\r\n                ta8_pixels[1] = buffer[scratch_32[8]++];\r\n                ta8_pixels[2] = buffer[scratch_32[8]++];\r\n                ta_visiting_pixels[0] = x;\r\n                ta_visiting_pixels[1] = y;\r\n                scratch_32[7] = 2;\r\n                while (scratch_32[9] <= scratch_32[2]) {\r\n                    scratch_32[4] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[5] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[8] = scratch_32[3] * (scratch_32[4] + (scratch_32[5] * scratch_32[0]));\r\n                    if (buffer[scratch_32[8]++] - ta8_pixels[0] === 0 && buffer[scratch_32[8]++] - ta8_pixels[1] === 0 && buffer[scratch_32[8]++] - ta8_pixels[2] === 0) {\r\n                        scratch_32[8] -= 3;\r\n                        buffer[scratch_32[8]++] = ta8_pixels[8];\r\n                        buffer[scratch_32[8]++] = ta8_pixels[9];\r\n                        buffer[scratch_32[8]++] = ta8_pixels[10];\r\n                        if (scratch_32[4] - 1 >= 0 && ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] - 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] - 1 >= 0 && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] - 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] = 255;\r\n                        }\r\n                        if (scratch_32[4] + 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] + 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] + 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] + 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] = 255;\r\n                        }\r\n                    }\r\n                    scratch_32[9]++;\r\n                }\r\n                return this;\r\n            }\r\n            return fast_stacked_mapped_flood_fill();\r\n        } else if (bipp === 32) {\r\n            const [w, h] = this.size;\r\n            let fast_stacked_mapped_flood_fill = () => {\r\n                const buffer = this.buffer;\r\n                const scratch_32 = new Uint32Array(16);\r\n                scratch_32[0] = this.size[0]; \r\n                scratch_32[1] = this.size[1]; \r\n                scratch_32[2] = scratch_32[0] * scratch_32[1];\r\n                scratch_32[3] = this.bytes_per_pixel;\r\n                scratch_32[6] = 0 \r\n                scratch_32[7] = 0 \r\n                scratch_32[8] = 0 \r\n                scratch_32[9] = 0 \r\n                const ta8_pixels = new Uint8Array(12);\r\n                ta8_pixels[8] = r;\r\n                ta8_pixels[9] = g;\r\n                ta8_pixels[10] = b;\r\n                ta8_pixels[11] = a;\r\n                const ta_pixels_visited = new Uint8Array(scratch_32[2]);\r\n                const ta_visiting_pixels = new Uint16Array(scratch_32[2] * 2);\r\n                scratch_32[8] = scratch_32[3] * (x + (y * scratch_32[0]));\r\n                ta8_pixels[0] = buffer[scratch_32[8]++];\r\n                ta8_pixels[1] = buffer[scratch_32[8]++];\r\n                ta8_pixels[2] = buffer[scratch_32[8]++];\r\n                ta8_pixels[3] = buffer[scratch_32[8]++];\r\n                ta_visiting_pixels[0] = x;\r\n                ta_visiting_pixels[1] = y;\r\n                scratch_32[7] = 2;\r\n                while (scratch_32[9] <= scratch_32[2]) {\r\n                    scratch_32[4] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[5] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[8] = scratch_32[3] * (scratch_32[4] + (scratch_32[5] * scratch_32[0]));\r\n                    if (buffer[scratch_32[8]++] - ta8_pixels[0] === 0 && buffer[scratch_32[8]++] - ta8_pixels[1] === 0 && buffer[scratch_32[8]++] - ta8_pixels[2] === 0 && buffer[scratch_32[8]++] - ta8_pixels[3] === 0) {\r\n                        scratch_32[8] -= 4;\r\n                        buffer[scratch_32[8]++] = ta8_pixels[8];\r\n                        buffer[scratch_32[8]++] = ta8_pixels[9];\r\n                        buffer[scratch_32[8]++] = ta8_pixels[10];\r\n                        buffer[scratch_32[8]++] = ta8_pixels[11];\r\n                        if (scratch_32[4] - 1 >= 0 && ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] - 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] - 1 >= 0 && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] - 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] = 255;\r\n                        }\r\n                        if (scratch_32[4] + 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] + 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] + 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] + 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] = 255;\r\n                        }\r\n                    }\r\n                    scratch_32[9]++;\r\n                }\r\n                return this;\r\n            }\r\n            return fast_stacked_mapped_flood_fill();\r\n        } else if (bipp === 8) {\r\n            const [w, h] = this.size;\r\n            let fast_stacked_mapped_flood_fill = () => {\r\n                const v = r;\r\n                const buffer = this.buffer;\r\n                const scratch_32 = new Uint32Array(16);\r\n                scratch_32[0] = this.size[0]; \r\n                scratch_32[1] = this.size[1]; \r\n                scratch_32[2] = scratch_32[0] * scratch_32[1];\r\n                scratch_32[3] = this.bytes_per_pixel;\r\n                scratch_32[6] = 0 \r\n                scratch_32[7] = 0 \r\n                scratch_32[8] = 0 \r\n                scratch_32[9] = 0 \r\n                const ta8_pixels = new Uint8Array(12);\r\n                ta8_pixels[8] = v;\r\n                const ta_pixels_visited = new Uint8Array(scratch_32[2]);\r\n                const ta_visiting_pixels = new Uint16Array(scratch_32[2] * 2);\r\n                scratch_32[8] = scratch_32[3] * (x + (y * scratch_32[0]));\r\n                ta8_pixels[0] = buffer[scratch_32[8]++];\r\n                ta_visiting_pixels[0] = x;\r\n                ta_visiting_pixels[1] = y;\r\n                scratch_32[7] = 2;\r\n                while (scratch_32[9] <= scratch_32[2]) {\r\n                    scratch_32[4] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[5] = ta_visiting_pixels[scratch_32[6]++]; \r\n                    scratch_32[8] = scratch_32[3] * (scratch_32[4] + (scratch_32[5] * scratch_32[0]));\r\n                    if (buffer[scratch_32[8]++] - ta8_pixels[0] === 0) {\r\n                        scratch_32[8] -= 1;\r\n                        buffer[scratch_32[8]++] = ta8_pixels[8];\r\n                        if (scratch_32[4] - 1 >= 0 && ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] - 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] - 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] - 1 >= 0 && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] - 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] - 1))] = 255;\r\n                        }\r\n                        if (scratch_32[4] + 1 < scratch_32[0] && ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4] + 1;\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5];\r\n                            ta_pixels_visited[scratch_32[4] + 1 + (scratch_32[0] * scratch_32[5])] = 255;\r\n                        }\r\n                        if (scratch_32[5] + 1 < scratch_32[1] && ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] === 0) {\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[4];\r\n                            ta_visiting_pixels[scratch_32[7]++] = scratch_32[5] + 1;\r\n                            ta_pixels_visited[scratch_32[4] + (scratch_32[0] * (scratch_32[5] + 1))] = 255;\r\n                        }\r\n                    }\r\n                    scratch_32[9]++;\r\n                }\r\n                return this;\r\n            }\r\n            return fast_stacked_mapped_flood_fill();\r\n        } else if (bipp === 1) {\r\n            return this.flood_fill_1bipp(x, y, r);\r\n        } else {\r\n            console.trace();\r\n            throw 'Unsupported bipp: ' + bipp;\r\n        }\r\n    }\r\n    'invert'() {\r\n        const {\r\n            bipp\r\n        } = this;\r\n        if (bipp === 1) {\r\n            const {\r\n                ta\r\n            } = this;\r\n            const l = ta.length;\r\n            for (let i = 0; i < l; i++) {\r\n                ta[i] = ~ta[i] & 255;\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI (unsupported bipp) ' + bipp;\r\n        }\r\n    }\r\n    'or'(other_pb) {\r\n        const {\r\n            bipp\r\n        } = this;\r\n        if (bipp === 1) {\r\n            const other_bipp = other_pb.bipp;\r\n            if (other_bipp === 1) {\r\n                const {\r\n                    ta\r\n                } = this;\r\n                const l_my_ta = ta.length;\r\n                const other_ta = other_pb.ta;\r\n                const l_other_ta = other_ta.length;\r\n                if (l_other_ta === l_my_ta) {\r\n                    for (let i = 0; i < l_my_ta; i++) {\r\n                        ta[i] = ta[i] | other_ta[i];\r\n                    }\r\n                } else {\r\n                    console.trace();\r\n                    throw 'lengths of pixel buffer typed arrays must match';\r\n                }\r\n            } else {\r\n                console.trace();\r\n                throw 'bipp values must match (other_pb expected to have bipp: 1)'\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI (unsupported bipp) ' + bipp;\r\n        }\r\n    }\r\n    each_outer_boundary_pixel(callback) {\r\n        let ta_pos = new Uint16Array(2);\r\n        const {size} = this;\r\n        const [w, h] = size;\r\n        ta_pos[0] = 0;\r\n        ta_pos[1] = 0;\r\n        for (ta_pos[0] = 0; ta_pos[0] < w; ta_pos[0]++) {\r\n            const px = this.get_pixel(ta_pos);\r\n            callback(px, ta_pos);\r\n        }\r\n        ta_pos[0]--;\r\n        for (ta_pos[1] = 0; ta_pos[1] < h; ta_pos[1]++) {\r\n            const px = this.get_pixel(ta_pos);\r\n            callback(px, ta_pos);\r\n        }\r\n        ta_pos[1]--;\r\n        for (ta_pos[0] = w - 1; ta_pos[0] > 0; ta_pos[0]--) {\r\n            const px = this.get_pixel(ta_pos);\r\n            callback(px, ta_pos);\r\n        }\r\n        let px = this.get_pixel(ta_pos);\r\n        callback(px, ta_pos);\r\n        for (ta_pos[1] = h - 1; ta_pos[1] > 0; ta_pos[1]--) {\r\n            const px = this.get_pixel(ta_pos);\r\n            callback(px, ta_pos);\r\n        }\r\n        px = this.get_pixel(ta_pos);\r\n        callback(px, ta_pos);\r\n    }\r\n    flood_fill_off_pixels_from_outer_boundary_on_1bipp() {\r\n        this.each_outer_boundary_pixel((b_color, pos) => {\r\n            if (b_color === 0) {\r\n                this.flood_fill_c1_1bipp(pos);\r\n            }\r\n        });\r\n    }\r\n    flood_fill_given_color_pixels_from_outer_boundary(given_color, fill_color) {\r\n        const {\r\n            bits_per_pixel\r\n        } = this;\r\n        if (bits_per_pixel === 24) {\r\n            this.each_outer_boundary_pixel((b_color, pos) => {\r\n                const [r, g, b] = b_color;\r\n                if (r === given_color[0] && g === given_color[1] && b === given_color[2]) {\r\n                    this.flood_fill(pos[0], pos[1], fill_color[0], fill_color[1], fill_color[2]);\r\n                }\r\n            });\r\n        } else if (bits_per_pixel === 1) {\r\n            this.each_outer_boundary_pixel((b_color, pos) => {\r\n                if (b_color === given_color) {\r\n                    this.flood_fill(pos[0], pos[1], fill_color);\r\n                }\r\n            });\r\n        } else {\r\n            console.log('not flood filling');\r\n            console.log('bits_per_pixel', bits_per_pixel);\r\n            throw 'NYI';\r\n            console.trace();\r\n        }\r\n    }\r\n    each_x_span(cb) {\r\n        const [w, h] = this.size;\r\n        const ta_x_span_toggle_bits = get_ta_bits_that_differ_from_previous_as_1s(this.ta);\r\n        let prev_x, prev_y;\r\n        let x_delta, y_delta;\r\n        let color_leading_on_from_current_x_toggle_position;\r\n        const found_empty_rows = (y0, y1_inclusive) => {\r\n        }\r\n        const found_x_span = (x0, x1, y, color) => {\r\n            cb(x0, x1, y, color);\r\n        }\r\n        const complete_previous_row_x_span = () => {\r\n        }\r\n        const complete_any_empty_in_between_rows = () => {\r\n        }\r\n        const complete_current_x_span = (x, y) => {\r\n            found_x_span(prev_x, x - 1, y, color_leading_on_from_current_x_toggle_position);\r\n            color_leading_on_from_current_x_toggle_position^=1;\r\n        }\r\n        const found_row_beginning_color_0_x_span = (x_span_end, y) => {\r\n            found_x_span(0, x_span_end, y, 0);\r\n            color_leading_on_from_current_x_toggle_position = 1;\r\n        }\r\n        const found_row_beginning_color_1_x_span_beginning = (y) => {\r\n            color_leading_on_from_current_x_toggle_position = 1;\r\n        }\r\n        const handle_xy_toggle_position = (x, y) => {\r\n            if (prev_x === undefined) {\r\n                if (y > 0) {\r\n                    found_empty_rows(0, y - 1);\r\n                }\r\n                if (x > 0) {\r\n                    found_row_beginning_color_0_x_span(x, y);\r\n                } else {\r\n                    found_row_beginning_color_1_x_span_beginning(y);\r\n                }\r\n            } else {\r\n                if (y > prev_y) {\r\n                    complete_previous_row_x_span();\r\n                    complete_any_empty_in_between_rows();\r\n                    if (x === 0) {\r\n                        found_row_beginning_color_1_x_span_beginning(y);\r\n                    } else {\r\n                        found_row_beginning_color_0_x_span(x - 1, y);\r\n                    }\r\n                } else {\r\n                    complete_current_x_span(x, y);\r\n                }\r\n            }\r\n            prev_x = x; prev_y = y;\r\n        }\r\n        each_1_index(ta_x_span_toggle_bits, i => {\r\n            const y = Math.floor(i / w);\r\n            const x = i % w;\r\n            handle_xy_toggle_position(x, y);\r\n        });\r\n    }\r\n    not_very_fast_flood_fill_inner_pixels_off_to_on_1bipp() {\r\n        const identify_overlaps = (higher_row_x_spans, lower_row_x_spans) => {\r\n            let i = 0, j = 0;\r\n            const m = higher_row_x_spans.length, n = lower_row_x_spans.length;\r\n            while (i < m && j < n) {\r\n                const a = higher_row_x_spans[i], b = lower_row_x_spans[j];\r\n                if (a.x0_span[1] < b.x0_span[0]) {\r\n                    i++;\r\n                } else if (b.x0_span[1] < a.x0_span[0]) {\r\n                    j++;\r\n                } else {\r\n                    a.connected_below.push(b.idx);\r\n                    b.connected_above.push(a.idx);\r\n                    if (a.x0_span[1] <= b.x0_span[1]) {\r\n                        i++;\r\n                    }\r\n                    if (b.x0_span[1] <= a.x0_span[1]) {\r\n                        j++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        const rows_x0spans = this.calculate_arr_rows_arr_x_off_spans_1bipp();\r\n        const arr_all_x_spans = [];\r\n        const arr_y_indexed = new Array(this.size[1]);\r\n        let i2;\r\n        let idx = 0;\r\n        for (let i = 0; i < rows_x0spans.length; i++) {\r\n            const single_row_x0spans = rows_x0spans[i];\r\n            arr_y_indexed[i] = [];\r\n            for (i2 = 0; i2 < single_row_x0spans.length; i2++) {\r\n                const x0_span = single_row_x0spans[i2];\r\n                const o_x0span = {\r\n                    idx: idx++,\r\n                    y: i,\r\n                    x0_span: x0_span,\r\n                    connected_above: [],\r\n                    connected_below: [],\r\n                }\r\n                arr_all_x_spans.push(o_x0span);\r\n                arr_y_indexed[i].push(o_x0span);\r\n            }\r\n        }\r\n        let higher_row_y, lower_row_y;\r\n        let span_above, span_below;\r\n        for (higher_row_y = 0; higher_row_y < this.size[1] - 1; higher_row_y++) {\r\n            identify_overlaps(arr_y_indexed[higher_row_y], arr_y_indexed[higher_row_y + 1]);\r\n        }\r\n        const l = arr_all_x_spans.length;\r\n        let arr_stack_yet_to_visit = [];\r\n        let ui8a_visited_already = new Uint8Array(l);\r\n        let i_group = 0;\r\n        let i_current_group;\r\n        const arr_groups = [];\r\n        const arr_o_groups = [];\r\n        let arr_current_group = [];\r\n        let o_current_group;\r\n        let i_xspan_visiting, xspan_visiting;\r\n        const [width, height] = this.size;\r\n        const hm1 = height - 1, wm1 = width - 1;\r\n        const is_xspan_image_boundary_adjacent = xspan => {\r\n            const {x0_span} = xspan;\r\n            if (xspan.y === 0) return true;\r\n            if (x0_span[0] === 0) return true;\r\n            if (xspan.y === hm1) return true;\r\n            if (x0_span[1] === wm1) return true;\r\n            return false;\r\n        }\r\n        let xspan;\r\n        let idx_span_above, idx_span_below;\r\n        for (let c = 0; c < l; c++) {\r\n            if (ui8a_visited_already[c] === 0) {\r\n                ui8a_visited_already = new Uint8Array(l);\r\n                xspan = arr_all_x_spans[c];\r\n                ui8a_visited_already[c] = 255;\r\n                if (xspan.group === undefined) {\r\n                    i_current_group = i_group++;\r\n                    arr_current_group = [];\r\n                    o_current_group = {\r\n                        index: i_current_group,\r\n                        xspan_indexes: arr_current_group\r\n                    }\r\n                    arr_o_groups.push(o_current_group);\r\n                    arr_groups.push(arr_current_group);\r\n                    if (is_xspan_image_boundary_adjacent(xspan)) {\r\n                        o_current_group.is_boundary_adjacent = true;\r\n                    }\r\n                    xspan.group = i_current_group;\r\n                    arr_current_group.push(c);\r\n                    for (idx_span_above of xspan.connected_above) {\r\n                        if (ui8a_visited_already[idx_span_above] === 0) arr_stack_yet_to_visit.push(idx_span_above);\r\n                    }\r\n                    for (idx_span_below of xspan.connected_below) {\r\n                        if (ui8a_visited_already[idx_span_below] === 0) arr_stack_yet_to_visit.push(idx_span_below);\r\n                    }\r\n                    while (arr_stack_yet_to_visit.length > 0) {\r\n                        i_xspan_visiting = arr_stack_yet_to_visit.pop();\r\n                        if (ui8a_visited_already[i_xspan_visiting] === 0) {\r\n                            xspan_visiting = arr_all_x_spans[i_xspan_visiting];\r\n                            if (is_xspan_image_boundary_adjacent(xspan_visiting)) {\r\n                                o_current_group.is_boundary_adjacent = true;\r\n                            }\r\n                            xspan_visiting.group = i_current_group;\r\n                            arr_current_group.push(i_xspan_visiting);\r\n                            ui8a_visited_already[i_xspan_visiting] = 255;\r\n                            for (idx_span_above of xspan_visiting.connected_above) {\r\n                                if (ui8a_visited_already[idx_span_above] === 0) arr_stack_yet_to_visit.push(idx_span_above);\r\n                            }\r\n                            for (idx_span_below of xspan_visiting.connected_below) {\r\n                                if (ui8a_visited_already[idx_span_below] === 0) arr_stack_yet_to_visit.push(idx_span_below);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        const non_boundary_group_indexes = [];\r\n        for (const g of arr_o_groups) {\r\n            if (!g.is_boundary_adjacent) {\r\n                for (const idx of g.xspan_indexes) {\r\n                    non_boundary_group_indexes.push(idx);\r\n                }\r\n            }\r\n        }\r\n        const write_direct = () => {\r\n            let xspan;\r\n            for (const idx of non_boundary_group_indexes) {\r\n                xspan = arr_all_x_spans[idx];\r\n                this.draw_horizontal_line_on_1bipp_inclusive(xspan.x0_span, xspan.y);\r\n            }\r\n        }\r\n        write_direct();\r\n    }\r\n    flood_fill_inner_pixels_off_to_on_1bipp() {\r\n        return this.not_very_fast_flood_fill_inner_pixels_off_to_on_1bipp();\r\n    }\r\n}\r\nmodule.exports = Pixel_Buffer_Perf_Focus_Enh;\r\n", "const Pixel_Buffer_Perf_Focus_Enh = require('./pixel-buffer-6-perf-focus-enh');\r\nlet {resize_ta_colorspace, copy_rect_to_same_size_8bipp, copy_rect_to_same_size_24bipp, dest_aligned_copy_rect_1to4bypp,\r\n\r\n    get_ta_bits_that_differ_from_previous_as_1s, each_1_index\r\n\r\n\r\n} = require('./ta-math');\r\nclass Pixel_Buffer_Specialised_Enh extends Pixel_Buffer_Perf_Focus_Enh {\r\n    constructor(...a) {\r\n        super(...a);\r\n        const bounds_within_source = new Int16Array(4);\r\n        Object.defineProperty(this, 'bounds_within_source', {\r\n            get() {\r\n                const size = this.size;\r\n                const pos = this.pos;\r\n                bounds_within_source[0] = pos[0];\r\n                bounds_within_source[1] = pos[1];\r\n                bounds_within_source[2] = pos[0] + size[0];\r\n                bounds_within_source[3] = pos[1] + size[1];\r\n                return bounds_within_source;\r\n            },\r\n            /*\r\n            set(value) {\r\n            },*/\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        const size_bounds = new Int16Array(4);\r\n        Object.defineProperty(this, 'size_bounds', {\r\n            get() {\r\n                const size = this.size;\r\n                size_bounds[0] = 0;\r\n                size_bounds[1] = 0;\r\n                size_bounds[2] = size[0];\r\n                size_bounds[3] = size[1];\r\n                return size_bounds;\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n        let pb_source;\r\n        Object.defineProperty(this, 'source', {\r\n            get() { return pb_source; },\r\n            set(value) {\r\n                pb_source = value;\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n    }\r\n    copy_from_source() {\r\n        const bipp = this.bipp;\r\n        const pb_source = this.source;\r\n        const ta_source = pb_source.ta;\r\n        const ta = this.ta;\r\n        const my_bounds = this.bounds_within_source;\r\n        const source_size_bounds = pb_source.size_bounds;\r\n        if (bipp === 1) {\r\n            console.trace();\r\n            throw 'NYI';\r\n        } else if (bipp === 8 || bipp === 24 || bipp === 32) {\r\n            dest_aligned_copy_rect_1to4bypp(ta_source, ta, pb_source.bytes_per_row, this.bytes_per_pixel, ta_math.overlapping_bounds(my_bounds, source_size_bounds));\r\n        } else {\r\n            console.trace();\r\n            throw 'stop';\r\n        }\r\n    }\r\n    threshold_gs(value) {\r\n        let res = this.clone();\r\n        if (this.bytes_per_pixel === 1) {\r\n            /*\r\n            this.each_pixel((x, y, v, i) => {\r\n                if (v >= value) {\r\n                    res.set_pixel(x, y, 255);\r\n                } else {\r\n                    res.set_pixel(x, y, 0);\r\n                }\r\n            });\r\n            */\r\n            this.each_pixel((pos, color) => {\r\n                if (color >= value) {\r\n                    res.set_pixel(pos[0], pos[1], 255);\r\n                } else {\r\n                    res.set_pixel(pos[0], pos[1], 0);\r\n                }\r\n            });\r\n        }\r\n        return res;\r\n    }\r\n    padded_each_pixel_index(padding, cb) {\r\n        const ta_32_scratch = new Uint32Array(9);\r\n        ta_32_scratch[0] = this.bytes_per_pixel;\r\n        ta_32_scratch[1] = 0; // i\r\n        ta_32_scratch[2] = this.size[0] - padding;\r\n        ta_32_scratch[3] = this.size[1] - padding;\r\n        ta_32_scratch[7] = this.size[0];\r\n        const bpp = this.bits_per_pixel;\r\n        if (bpp === 32) {\r\n            ((cb) => {\r\n                for (ta_32_scratch[5] = padding; ta_32_scratch[5] < ta_32_scratch[3]; ta_32_scratch[5]++) {\r\n                    for (ta_32_scratch[4] = 0; ta_32_scratch[4] < ta_32_scratch[2]; ta_32_scratch[4]++) {\r\n                        cb((ta_32_scratch[5] * ta_32_scratch[7] + ta_32_scratch[4]) * ta_32_scratch[0]);\r\n                    }\r\n                }\r\n            })(cb);\r\n        } else if (bpp === 24) {\r\n            ((cb) => {\r\n                for (ta_32_scratch[5] = padding; ta_32_scratch[5] < ta_32_scratch[3]; ta_32_scratch[5]++) {\r\n                    for (ta_32_scratch[4] = 0; ta_32_scratch[4] < ta_32_scratch[2]; ta_32_scratch[4]++) {\r\n                        cb((ta_32_scratch[5] * ta_32_scratch[7] + ta_32_scratch[4]) * ta_32_scratch[0]);\r\n                    }\r\n                }\r\n            })(cb);\r\n        } else if (bpp === 8) {\r\n            ((cb) => {\r\n                for (ta_32_scratch[5] = padding; ta_32_scratch[5] < ta_32_scratch[3]; ta_32_scratch[5]++) {\r\n                    for (ta_32_scratch[4] = 0; ta_32_scratch[4] < ta_32_scratch[2]; ta_32_scratch[4]++) {\r\n                        cb((ta_32_scratch[5] * ta_32_scratch[7] + ta_32_scratch[4]) * ta_32_scratch[0]);\r\n                    }\r\n                }\r\n            })(cb);\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    new_window(options) {\r\n        options.window_to = this;\r\n        const res = new this.constructor(options);\r\n        res.copy_from_source();\r\n        return res;\r\n    }\r\n    new_centered_window(size_or_options) {\r\n        console.trace();\r\n        throw 'NYI';\r\n        const t1 = tf(size_or_options);\r\n        console.log('t1', t1);\r\n        let size;\r\n        if (t1 === 'a') {\r\n            if (size_or_options.length === 2) {\r\n                size = new Int16Array([size_or_options, size_or_options]);\r\n            } else {\r\n                console.log('size_or_options', size_or_options);\r\n                console.trace();\r\n                throw 'Size array expected length: 2';\r\n            }\r\n        } else if (t1 === 'n') {\r\n            size = new Int16Array([size_or_options, size_or_options]);\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n        const res_pb = new this.constructor({\r\n            size: size,\r\n            bits_per_pixel: this.bits_per_pixel,\r\n            window_to: this\r\n        });\r\n    }\r\n    fill_solid_rect_by_bounds() {\r\n        const bounds = this.ta_bounds;\r\n        const bipp = this.bipp;\r\n        if (bipp === 24) {\r\n            const rgb = this.ta_rgb;\r\n            const bytes_per_bounds_row = (bounds[2] - bounds[0]) * this.bypp;\r\n            const solid_row = new Uint8ClampedArray(bytes_per_bounds_row);\r\n            let cc = 0;\r\n            for (let c = 0; c < bytes_per_bounds_row; c++) {\r\n                solid_row[c] = rgb[cc];\r\n                cc++;\r\n                if (cc === 3) cc = 0;\r\n            }\r\n            let write_byte_idx = bounds[0] * this.bypp + bounds[1] * this.bypr;\r\n            for (let i_row = bounds[1]; i_row < bounds[3]; i_row++) {\r\n                this.ta.set(solid_row, write_byte_idx);\r\n                write_byte_idx += this.bypr;\r\n            }\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n    calc_source_target_valid_bounds_overlap() {\r\n        const source = this.source;\r\n        const my_bounds = this.bounds_within_source;\r\n        const source_size_bounds = source.size_bounds;\r\n        const res = this.ta_bounds_scratch;\r\n        if (my_bounds[0] < source_size_bounds[0]) {\r\n            res[0] = source_size_bounds[0];\r\n        } else {\r\n            res[0] = my_bounds[0];\r\n        }\r\n        if (my_bounds[1] < source_size_bounds[1]) {\r\n            res[1] = source_size_bounds[1];\r\n        } else {\r\n            res[1] = my_bounds[1];\r\n        }\r\n        if (my_bounds[2] > source_size_bounds[2]) {\r\n            res[2] = source_size_bounds[2];\r\n        } else {\r\n            res[2] = my_bounds[2];\r\n        }\r\n        if (my_bounds[3] > source_size_bounds[3]) {\r\n            res[3] = source_size_bounds[3];\r\n        } else {\r\n            res[3] = my_bounds[3];\r\n        }\r\n        return res;\r\n    }\r\n    copy_rect_by_bounds_to_24bipp(ta_bounds, pb_target) {\r\n        console.trace();\r\n        throw 'NYI';\r\n        const pos = this.ta_pos_scratch;\r\n        const rect_size = this.ta_size_scratch;\r\n        rect_size[0] = ta_bounds[2] - ta_bounds[0];\r\n        rect_size[1] = ta_bounds[3] - ta_bounds[1];\r\n        console.log('rect_size', rect_size);\r\n        const ta_pointers = this.ta_pointers_scratch;\r\n        const ta_target_pointers = pb_target.ta_pointers_scratch;\r\n        console.log('ta_pointers', ta_pointers);\r\n        console.log('ta_target_pointers', ta_target_pointers);\r\n        console.log('pos', pos);\r\n        console.log('ta_bounds', ta_bounds);\r\n        const ta = this.ta;\r\n        const ta_target = pb_target.ta;\r\n        console.log('pb_target.pos', pb_target.pos);\r\n        const ta_safe_bounds_limits = this.ta_bounds_scratch;\r\n        ta_safe_bounds_limits[0] = 0;\r\n        ta_safe_bounds_limits[1] = 0;\r\n        ta_safe_bounds_limits[2] = this.size[0];\r\n        ta_safe_bounds_limits[3] = this.size[1];\r\n        const ta_safe_adjusted_bounds = this.ta_bounds2_scratch;\r\n        const ta_bounds_adjustments = this.ta_bounds3_scratch;\r\n        const ta_bounds_byte_offsets = this.ta_bounds3_scratch;\r\n        if (ta_bounds[0] >= ta_safe_bounds_limits[0]) {\r\n            ta_safe_adjusted_bounds[0] = ta_bounds[0];\r\n            ta_bounds_adjustments[0] = 0;\r\n        } else {\r\n            ta_bounds_adjustments[0] = ta_safe_bounds_limits[0] - ta_bounds[0];\r\n            ta_safe_adjusted_bounds[0] = ta_safe_bounds_limits[0];\r\n        }\r\n        if (ta_bounds[1] >= ta_safe_bounds_limits[1]) {\r\n            ta_safe_adjusted_bounds[1] = ta_bounds[1];\r\n            ta_bounds_adjustments[1] = 0;\r\n        } else {\r\n            ta_bounds_adjustments[1] = ta_safe_bounds_limits[1] - ta_bounds[1];\r\n            ta_safe_adjusted_bounds[1] = ta_safe_bounds_limits[1];\r\n        }\r\n        if (ta_bounds[2] <= ta_safe_bounds_limits[2]) {\r\n            ta_safe_adjusted_bounds[2] = ta_bounds[2];\r\n            ta_bounds_adjustments[2] = 0;\r\n        } else {\r\n            ta_bounds_adjustments[2] = ta_safe_bounds_limits[2] - ta_bounds[2];\r\n            ta_safe_adjusted_bounds[2] = ta_safe_bounds_limits[2];\r\n        }\r\n        if (ta_bounds[3] <= ta_safe_bounds_limits[3]) {\r\n            ta_safe_adjusted_bounds[3] = ta_bounds[3];\r\n            ta_bounds_adjustments[3] = 0;\r\n        } else {\r\n            ta_bounds_adjustments[3] = ta_safe_bounds_limits[3] - ta_bounds[3];\r\n            ta_safe_adjusted_bounds[3] = ta_safe_bounds_limits[3];\r\n        }\r\n        console.log('ta_safe_adjusted_bounds', ta_safe_adjusted_bounds);\r\n        console.log('ta_bounds_adjustments', ta_bounds_adjustments);\r\n        console.log('this.bytes_per_row', this.bytes_per_row);\r\n        const source_bytes_per_row = this.bytes_per_row;\r\n        const bypp = this.bypp;\r\n        const adjusted_safe_bounds_source_read_byte_offsets = this.ta_offsets_scratch;\r\n        adjusted_safe_bounds_source_read_byte_offsets[0] = ta_bounds_adjustments[0] * bypp;\r\n        adjusted_safe_bounds_source_read_byte_offsets[1] = ta_bounds_adjustments[1] * source_bytes_per_row;\r\n        adjusted_safe_bounds_source_read_byte_offsets[2] = ta_bounds_adjustments[2] * bypp;\r\n        adjusted_safe_bounds_source_read_byte_offsets[3] = ta_bounds_adjustments[3] * source_bytes_per_row;\r\n        console.log('adjusted_safe_bounds_source_read_byte_offsets', adjusted_safe_bounds_source_read_byte_offsets);\r\n        const adjusted_safe_bounds_target_write_byte_offsets = pb_target.ta_offsets_scratch;\r\n        const ta_pp_source_read = this.ta_pointerpair_scratch;\r\n        const ta_pp_target_write = pb_target.ta_pointerpair_scratch;\r\n        const bytes_per_row_of_safe_bounds = (ta_safe_adjusted_bounds[2] - ta_safe_adjusted_bounds[0]) * bypp;\r\n        console.log('bytes_per_row_of_safe_bounds', bytes_per_row_of_safe_bounds);\r\n        ta_pp_source_read[0] = adjusted_safe_bounds_source_read_byte_offsets[0] + adjusted_safe_bounds_source_read_byte_offsets[1];\r\n        ta_pp_source_read[1] = ta_pp_source_read[0] + bytes_per_row_of_safe_bounds;\r\n        ta_pp_target_write[0] = 0; // no, it's the left indent of the safe bounds.\r\n        ta_pp_target_write[1] = ta_pp_target_write[0] + bytes_per_row_of_safe_bounds;\r\n        console.log('ta_pp_source_read', ta_pp_source_read);\r\n        console.log('ta_pp_target_write', ta_pp_target_write);\r\n        console.log('pb_target.bytes_per_row', pb_target.bytes_per_row);\r\n        const num_rows_to_copy = ta_safe_adjusted_bounds[3] - ta_safe_adjusted_bounds[1];\r\n        console.log('num_rows_to_copy', num_rows_to_copy);\r\n        for (let c = 0; c < num_rows_to_copy; c++) {\r\n            const sa_source_row = ta.subarray(ta_pp_source_read[0], ta_pp_source_read[1]);\r\n            console.log('sa_source_row', sa_source_row);\r\n        }\r\n        for (pos[1] = ta_bounds[1]; pos[1] < ta_bounds[3]; pos[1]++) {\r\n        }\r\n        if (rect_size[0] === pb_target.size[0] && rect_size[1] === pb_target.size[1]) {\r\n            console.log('rect_size matches target size.')\r\n        }\r\n    }\r\n\r\n\r\n    // And this could be done in a more optimised bitwise way.\r\n\r\n    'get_ta_contiguous_spans_1bipp_toggle'() {\r\n        const get_count = () => {\r\n            const initial_color = 0;\r\n            let color = initial_color;\r\n            let count_color_changes = 0;\r\n            this.each_pixel(([x, y], px_color) => {\r\n                if (px_color !== color) {\r\n                    count_color_changes++;\r\n                }\r\n                color = px_color;\r\n            });\r\n            count_color_changes++;\r\n            return count_color_changes;\r\n        }\r\n        const get_max_span_length = () => {\r\n            const initial_color = 0;\r\n            let color = initial_color;\r\n            let l = 0;\r\n            let max_l = 0;\r\n            this.each_pixel(([x, y], px_color) => {\r\n                if (px_color !== color) {\r\n                    l = 0;\r\n                } else {\r\n                    l++;\r\n                    if (l > max_l) max_l = l;\r\n                }\r\n                color = px_color;\r\n            });\r\n            return max_l + 1;\r\n        }\r\n        const nccs = get_count();\r\n        const max_xpan_l = get_max_span_length();\r\n        if (max_xpan_l <= 255) {\r\n            const res = new Uint8Array(nccs);\r\n            const initial_color = 0;\r\n            let color = initial_color;\r\n            let count_color_changes = 0;\r\n            let l = -1;\r\n            this.each_pixel(([x, y], px_color) => {\r\n                if (px_color !== color) {\r\n                    res[count_color_changes] = l + 1;\r\n                    count_color_changes++;\r\n                    l = 0;\r\n                } else {\r\n                    l++;\r\n                }\r\n                color = px_color;\r\n            });\r\n            res[count_color_changes] = l + 1;\r\n            return res;\r\n        } else {\r\n            console.trace();\r\n            throw 'stop';\r\n        }\r\n    }\r\n    'count_row_on_xspans_1bipp'(y) {\r\n        let res = 0;\r\n        const width = this.size[0];\r\n        let last_color = 1;\r\n        let current_color;\r\n        let ta_pos = new Uint16Array(2);\r\n        ta_pos[1] = y;\r\n        for (let x = 0; x < width; x++) {\r\n            ta_pos[0] = x;\r\n            current_color = this.get_pixel_1bipp(ta_pos);\r\n            if (current_color === 1) {\r\n                if (current_color === last_color) {\r\n                    if (res === 0) {\r\n                        res++;\r\n                    } else {\r\n                    }\r\n                } else {\r\n                    res++;\r\n                }\r\n            }\r\n            last_color = current_color;\r\n        }\r\n        return res;\r\n    }\r\n    'calculate_ta_row_x_off_x2ygbspans_1bipp'(y) {\r\n        const count_xoffspans = this.count_row_off_xspans_1bipp(y);\r\n        const res = new Uint16Array(count_xoffspans * 5);\r\n        let i_w = 0;\r\n        const width = this.size[0];\r\n        let last_color = 0;\r\n        let current_color;\r\n        let ta_pos = new Uint16Array(2);\r\n        ta_pos[1] = y;\r\n        for (let x = 0; x < width; x++) {\r\n            ta_pos[0] = x;\r\n            current_color = this.get_pixel_1bipp(ta_pos);\r\n            if (current_color === 0) {\r\n                if (current_color === last_color) {\r\n                    if (res.length === 0) {\r\n                        res[i_w++] = x;\r\n                        res[i_w++] = x;\r\n                        res[i_w++] = y;\r\n                        res[i_w++] = 0; // 0 for undefined group here....\r\n                        res[i_w++] = 0; // 0 for undefined border status here\r\n                    } else {\r\n                        res[i_w - 4]++;\r\n                    }\r\n                } else {\r\n                    res[i_w++] = x;\r\n                    res[i_w++] = x;\r\n                    res[i_w++] = y;\r\n                    res[i_w++] = 0; // 0 for undefined group here....\r\n                    res[i_w++] = 0; // 0 for undefined border status here\r\n                }\r\n            }\r\n            last_color = current_color;\r\n        }\r\n        return res;\r\n    }\r\n    'calculate_arr_row_x_off_spans_1bipp'(y) {\r\n            const res = [];\r\n            const width = this.size[0];\r\n            const {ta} = this;\r\n            let last_color = 0;\r\n            let current_color;\r\n            const x_start = 0;\r\n            let idx_bit_overall = ((y * this.size[0]) + x_start) | 0, idx_bit_within_byte = 0 | 0;\r\n            let arr_last;\r\n            let num_bits_remaining = width;\r\n            let x = 0; // an x local value is fine - will update it as necessary\r\n            let has_just_done_multi_read = false;\r\n            let byte_val = 0 | 0;\r\n            while (num_bits_remaining > 0) {\r\n                idx_bit_within_byte = idx_bit_overall & 0b111;\r\n                has_just_done_multi_read = false;\r\n                if (idx_bit_within_byte === 0 && num_bits_remaining >= 8) {\r\n                    byte_val = ta[idx_bit_overall >> 3];\r\n                    if (byte_val === 255) {\r\n                        last_color = 1;\r\n                        has_just_done_multi_read = true;\r\n                        idx_bit_overall += 8;\r\n                        x += 8;\r\n                        num_bits_remaining -= 8;\r\n                    } else if (byte_val === 0) {\r\n                        if (last_color === 0) {\r\n                            if (res.length === 0) {\r\n                                if (arr_last) res.push(arr_last);\r\n                                arr_last = [x, x + 7];\r\n                            } else {\r\n                                arr_last[1] += 8;\r\n                            }\r\n                        } else {\r\n                            if (arr_last) res.push(arr_last);\r\n                            arr_last = [x, x + 7];\r\n                        }\r\n                        x += 8;\r\n                        last_color = 0;\r\n                        num_bits_remaining -= 8;\r\n                        idx_bit_overall += 8;\r\n                        has_just_done_multi_read = true;\r\n                    } else {\r\n                    }\r\n                }\r\n                if (!has_just_done_multi_read) {\r\n                    current_color = ((ta[idx_bit_overall >> 3] & 128 >> (idx_bit_within_byte)) !== 0) ? 1 : 0;\r\n                    if (current_color === 0) {\r\n                        if (current_color === last_color) {\r\n                            if (res.length === 0) {\r\n                                if (arr_last) res.push(arr_last);\r\n                                arr_last = [x, x];\r\n                            } else {\r\n                                arr_last[1]++;\r\n                            }\r\n                        } else {\r\n                            if (arr_last) res.push(arr_last);\r\n                            arr_last = [x, x];\r\n                        }\r\n                    }\r\n                    last_color = current_color;\r\n                    idx_bit_overall++;\r\n                    x++;\r\n                    num_bits_remaining--;\r\n                }\r\n            }\r\n            if (arr_last) res.push(arr_last);\r\n            return res;\r\n    }\r\n\r\n    // Could see about a more optimised way to do it that does not go row-by-row.\r\n\r\n\r\n    // Do want a simpler way....\r\n\r\n    // Want something with a callback for each y value.....\r\n\r\n\r\n\r\n    // Does seem a bit tricky for the moment.\r\n\r\n    // Want to streamline it more!\r\n\r\n\r\n\r\n\r\n\r\n    'opt_calculate_arr_rows_arr_x_off_spans_1bipp'() {\r\n\r\n        // Think we need to redo this.....\r\n        // Have a handle_y_change function.\r\n\r\n        \r\n\r\n\r\n        const ta_x_span_toggle_bits = get_ta_bits_that_differ_from_previous_as_1s(this.ta);\r\n\r\n        // Or get a typed array of the 1 indexes.\r\n\r\n\r\n\r\n        // Then an interator of that, by rows....?\r\n        // says which row each of these is?\r\n        // provides an array of x positions for each row?\r\n\r\n        // Or other type of iteration, go through the values, track the rows. Got a bit stuck with that way though.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        //const c_all = count_1s(ta_x_span_toggle_bits);\r\n\r\n        const [w, h] = this.size;\r\n\r\n\r\n        const get_arr_arr_toggle_positions = () => {\r\n            let prev_y = -1;\r\n            let prev_x = -1;\r\n\r\n            let arr_positions_in_row;\r\n            const res = new Array(h);\r\n\r\n            // complete a row...\r\n\r\n            // complete it...?\r\n            \r\n\r\n            const handle_row_complete = (y, arr_x_toggle_positions) => {\r\n                res[y] = arr_x_toggle_positions;\r\n            }\r\n\r\n            // Where it iterates through the rows, and for each row it runs a 'catch up and complete' function?\r\n            //   Or read until we have one that is not in that row?\r\n\r\n            // Row by row iteration does seem best.\r\n\r\n            // .row_bitindex_ranges????\r\n\r\n            // And an algorithm that checks and groups with rows above too?\r\n            \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n            each_1_index(ta_x_span_toggle_bits, i => {\r\n            \r\n                // Should probably iterate them (better) by rows.\r\n\r\n                // And when it's the first in a row?\r\n\r\n                //console.log('i', i);\r\n\r\n\r\n\r\n                const y = Math.floor(i / w);\r\n                const x = i % w;\r\n\r\n                //current_y = y;\r\n\r\n                if (y !== prev_y) {\r\n                    \r\n                    //console.log('y', y);\r\n\r\n                    const y_diff = y - prev_y;\r\n\r\n                    // complete it...????\r\n                    if (arr_positions_in_row) {\r\n                        arr_positions_in_row.push(prev_x);\r\n                        handle_row_complete(prev_y, arr_positions_in_row);\r\n\r\n                    }\r\n\r\n                    if (y_diff > 1) {\r\n                        // then the empty rows....\r\n\r\n                        //const num_empty_rows = y_diff - 1;\r\n                        for (let y2 = prev_y + 1; y2 < y; y2++) {\r\n                            handle_row_complete(y2, []);\r\n                        }\r\n\r\n                    }\r\n\r\n                    arr_positions_in_row = [x];\r\n\r\n                    // then begin the new row.\r\n                    //  do we have a toggle position already????\r\n\r\n\r\n                    \r\n\r\n                    // then write the previous line????\r\n                    //   Let's just track the values for that row.\r\n\r\n\r\n\r\n                    \r\n                    //handle_y_change_from_new_toggle_position(prev_y, y, x);\r\n\r\n                    \r\n\r\n                    // then recognise the first span of the row.\r\n                    \r\n                } else {\r\n                    arr_positions_in_row.push(x);\r\n                }\r\n\r\n                prev_x = x;\r\n                prev_y = y;\r\n\r\n                //current_i++;\r\n\r\n            });\r\n\r\n            return res;\r\n        }\r\n\r\n        const arr_arr_toggle_positions = get_arr_arr_toggle_positions();\r\n        console.log('arr_arr_toggle_positions.length', arr_arr_toggle_positions.length);\r\n        console.log('h', h);\r\n\r\n        throw 'stop'\r\n\r\n\r\n        \r\n\r\n\r\n        const _second_attempt = () => {\r\n\r\n            let prev_y = -1;\r\n            //let current_y = -1;\r\n            let current_i = 0;\r\n            let current_color = 0;\r\n            let arr_current_row_arr_off_spans;\r\n            let current_span_start_x, current_span_end_x;\r\n\r\n            let is_first_span_in_row = true;\r\n\r\n            // current span end x\r\n\r\n            let res = [];\r\n            \r\n            \r\n            const handle_row_complete = (arr_row, prev_y, new_y) => {\r\n                if (arr_row) {\r\n                    res.push(arr_row);\r\n                    \r\n                }\r\n                arr_current_row_arr_off_spans = [];\r\n                \r\n                //current_y\r\n            }\r\n\r\n            const handle_span_off_start = (x, y) => {\r\n                current_span_start_x = x;\r\n            }\r\n            const handle_span_off_end = (x, y) => {\r\n                current_span_end_x = x;\r\n                arr_current_row_arr_off_spans.push([current_span_start_x, current_span_end_x]);\r\n            }\r\n\r\n            const place_empty_row = () => {\r\n                res.push([0, w - 1]);\r\n            }\r\n\r\n            const handle_y_change_from_new_toggle_position = (prev_y, y, x) => {\r\n\r\n\r\n                // finish current row.\r\n                // write any empty rows in between.\r\n                // start the span in the current row.\r\n                handle_row_complete(arr_current_row_arr_off_spans, prev_y, y);\r\n                prev_y++;\r\n\r\n                while (prev_y < y) {\r\n                    // empty row....\r\n                    place_empty_row();\r\n                    prev_y++;\r\n                }\r\n\r\n                is_first_span_in_row = true;\r\n                if (x === 0) {\r\n                    current_color = 1;\r\n                } else {\r\n\r\n                    if (current_color === 1) {\r\n                        handle_span_off_start(x, y);\r\n                        current_color = 0;\r\n                    } else {\r\n                        handle_span_off_start(0, y);\r\n                        handle_span_off_end(x - 1, y);\r\n                        current_color = 1;\r\n                    }\r\n\r\n\r\n                    //current_color = 0;\r\n                    \r\n                }\r\n\r\n            }\r\n\r\n            // Need simpler toggle position logic.\r\n            //   Grouping them by their rows could help.\r\n\r\n\r\n\r\n            \r\n\r\n            each_1_index(ta_x_span_toggle_bits, i => {\r\n        \r\n                // Should probably iterate them (better) by rows.\r\n\r\n                // And when it's the first in a row?\r\n\r\n                //console.log('i', i);\r\n\r\n\r\n\r\n                const y = Math.floor(i / w);\r\n                const x = i % w;\r\n\r\n                //current_y = y;\r\n\r\n                if (y !== prev_y) {\r\n                    handle_y_change_from_new_toggle_position(prev_y, y, x);\r\n\r\n                    \r\n\r\n                    // then recognise the first span of the row.\r\n                }\r\n\r\n\r\n                current_i++;\r\n\r\n            });\r\n\r\n            return res;\r\n\r\n        }\r\n\r\n        \r\n\r\n\r\n\r\n        \r\n\r\n\r\n        // But the size will be offset somehow.....\r\n\r\n        //console.log('this._offset', this._offset);\r\n\r\n        //console.log('this.size', this.size);\r\n\r\n        //console.log('[w, h]', [w, h]);\r\n\r\n        //console.log('this.ta[0]', this.ta[0]);\r\n\r\n        //console.log('this.ta', this.ta);\r\n\r\n        //throw 'stop';\r\n\r\n        \r\n\r\n\r\n\r\n        const old_attempt = () => {\r\n                // Iterate those toggle bits....\r\n\r\n                let prev_x = 0, prev_y = 0;\r\n\r\n                const arr_rows_arr_x_off_spans_1bipp = [];\r\n    \r\n                let current_row = [];\r\n    \r\n                //let prev_i;\r\n    \r\n                // All spans?\r\n    \r\n                // Maybe better by far to operate on the rows explicitly.\r\n    \r\n                let current_color = 0;\r\n    \r\n                // See about upgrading the flood fill function / find x off spans.\r\n    \r\n                // Probably need to redo this.\r\n                //   Have an iterator that provides an array of all the rows.\r\n    \r\n                // each_row_x_span_toggle_bits perhaps.\r\n    \r\n                // or a handle new row inner function?\r\n    \r\n                each_1_index(ta_x_span_toggle_bits, i => {\r\n    \r\n                    // Should probably iterate them (better) by rows.\r\n    \r\n                    // And when it's the first in a row?\r\n    \r\n                    //console.log('i', i);\r\n    \r\n    \r\n    \r\n                    const y = Math.floor(i / w);\r\n                    const x = i % w;\r\n    \r\n                    //console.log('[x, y]', [x, y]);\r\n    \r\n                    //throw 'stop';\r\n    \r\n                    // detect the row starting color being 1????\r\n                    //   so an absence of it means there is an x span.\r\n    \r\n                    // a callback with the points even?\r\n    \r\n    \r\n    \r\n                    if (y > prev_y) {\r\n    \r\n                        // End the row we were on.\r\n    \r\n    \r\n    \r\n                        // it's another row.\r\n                        //   write the prev row.\r\n    \r\n                        // and the previous index...???\r\n                        //   what is the distance????\r\n    \r\n                        // finish the current_row row....\r\n    \r\n                        //const span_length = x - prev_x;\r\n                        //const span_color = current_color;\r\n    \r\n    \r\n                        \r\n    \r\n                        if (current_color === 0) {\r\n                            //const span_pair = [[prev_x, prev_y], [w, prev_y]];\r\n                            //console.log('span_pair', span_pair);\r\n                            //current_row.push([[prev_x, prev_y], [w - 1, prev_y]]);\r\n    \r\n                            current_row.push([prev_x, w - 1]);\r\n                        }\r\n                        // span until the end of the row.\r\n    \r\n    \r\n    \r\n                        //console.log('current_row', current_row);\r\n    \r\n    \r\n    \r\n                        // May differ by more than one.\r\n                        arr_rows_arr_x_off_spans_1bipp.push(current_row);\r\n                        current_row = [];\r\n                        prev_y++;\r\n                        prev_x = 0;\r\n                        \r\n    \r\n                        while (y > prev_y) {\r\n                            // it's another row.\r\n                            //   write the prev row.\r\n            \r\n                            // May differ by more than one.\r\n            \r\n                            // it's an off x span.\r\n                            current_row.push([0, w - 1]);\r\n            \r\n                            arr_rows_arr_x_off_spans_1bipp.push(current_row);\r\n                            current_row = [];\r\n                            prev_y++;\r\n                            prev_x = 0;\r\n                        }\r\n    \r\n                        current_color = 0;\r\n                        current_row = [[0, x]];\r\n                        \r\n                        prev_x = x;\r\n    \r\n                    }\r\n                    \r\n    \r\n                    // Start a span.\r\n    \r\n                    if (x === 0) {  \r\n                        current_color = 1;\r\n                    } else {\r\n                        \r\n                        // and how many since the prev x\r\n    \r\n                        //const span_length = x - prev_x;\r\n                        //const span_color = current_color;\r\n    \r\n    \r\n                        \r\n    \r\n                        if (current_color === 0) {\r\n                            //const span_pair = [[prev_x, y], [x, y]];\r\n                            //console.log('span_pair', span_pair);\r\n                            current_row.push([prev_x + 1, x]);\r\n                        }\r\n    \r\n                        current_color ^= 1;\r\n                        \r\n                        //current_color = current_color === 0 ? 1 : 0;\r\n    \r\n                    }\r\n    \r\n                    //console.log('[x, y]', [x, y]);\r\n                    //console.log('w', w);\r\n                    //console.log('i / w', i / w);\r\n    \r\n                    prev_y = y;\r\n                    //prev_i = i;\r\n                    prev_x = x;\r\n                });\r\n    \r\n                // finish the current row\r\n    \r\n                if (current_color === 0) {\r\n                    //const span_pair = [[prev_x, prev_y], [w, prev_y]];\r\n                    //console.log('span_pair', span_pair);\r\n                    current_row.push([prev_x, w - 1]);\r\n                    arr_rows_arr_x_off_spans_1bipp.push(current_row);\r\n                }\r\n    \r\n    \r\n                const last_row_y = (h - 1);\r\n    \r\n                let y = prev_y;\r\n    \r\n                //console.log('prev_y', prev_y);\r\n                //throw 'stop';\r\n    \r\n                y++;\r\n    \r\n                if (y < h) {\r\n    \r\n                    \r\n                    //current_row.push([[prev_x, prev_y], [w, prev_y]]);\r\n                    \r\n    \r\n                    //for (let y = prev_y + 1; y < h; y++) {\r\n                        //arr_rows_arr_x_off_spans_1bipp.push([[[0, y], [w, y]]]);\r\n                    //}\r\n    \r\n                    while (y < h) {\r\n                        arr_rows_arr_x_off_spans_1bipp.push([[0, w - 1]]);\r\n                        y++;\r\n                    }\r\n                    arr_rows_arr_x_off_spans_1bipp.push([[0, w - 1]]);\r\n                    //arr_rows_arr_x_off_spans_1bipp.push([[[0, y], [w, y]]]);\r\n                }\r\n    \r\n                //console.log(JSON.stringify(arr_rows_arr_x_off_spans_1bipp, null, 4));\r\n    \r\n                //console.log('h', h);\r\n    \r\n                //console.log('arr_rows_arr_x_off_spans_1bipp.length', arr_rows_arr_x_off_spans_1bipp.length);\r\n    \r\n                //throw 'stop';\r\n    \r\n                return arr_rows_arr_x_off_spans_1bipp;\r\n        }\r\n\r\n        \r\n\r\n    }\r\n    'simpler_calculate_arr_rows_arr_x_off_spans_1bipp'() {\r\n        const [width, height] = this.size;\r\n        const res = new Array(height);\r\n        for (let y = 0; y < height; y++) {\r\n            res[y] = this.calculate_arr_row_x_off_spans_1bipp(y);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    'calculate_arr_rows_arr_x_off_spans_1bipp'() {\r\n\r\n        // Will have a more optimised way to do this....\r\n        //   Bitwise ops involved.\r\n        return this.simpler_calculate_arr_rows_arr_x_off_spans_1bipp();\r\n        \r\n\r\n        const scalc = this.simpler_calculate_arr_rows_arr_x_off_spans_1bipp();\r\n\r\n        console.log(JSON.stringify(scalc).slice(0, 2000).replaceAll(',', ', '));\r\n\r\n        //return this.opt_calculate_arr_rows_arr_x_off_spans_1bipp();\r\n\r\n        const ocalc = this.opt_calculate_arr_rows_arr_x_off_spans_1bipp();\r\n\r\n\r\n        console.log('\\n\\n');\r\n\r\n        console.log(JSON.stringify(ocalc).slice(0, 2000).replaceAll(',', ', '));\r\n        \r\n\r\n        return ocalc;\r\n        /*\r\n\r\n        \r\n\r\n        */\r\n    }\r\n\r\n\r\n    'calculate_arr_rows_arr_x_on_spans_1bipp'() {\r\n        const [width, height] = this.size;\r\n        const res = new Array(height);\r\n        for (let y = 0; y < height; y++) {\r\n            res[y] = this.calculate_arr_row_x_on_spans_1bipp(y);\r\n        }\r\n        return res;\r\n    }\r\n    'count_row_off_xspans_1bipp'(y) {\r\n        let res = 0;\r\n        const width = this.size[0];\r\n        let last_color = 0;\r\n        let current_color;\r\n        let ta_pos = new Uint16Array(2);\r\n        ta_pos[1] = y;\r\n        for (let x = 0; x < width; x++) {\r\n            ta_pos[0] = x;\r\n            current_color = this.get_pixel_1bipp(ta_pos);\r\n            if (current_color === 0) {\r\n                if (current_color === last_color) {\r\n                    if (res.length === 0) {\r\n                        res++;\r\n                    } else {\r\n                    }\r\n                } else {\r\n                    res++;\r\n                    if (res.length === 0) {\r\n                    } else {\r\n                    }\r\n                }\r\n            }\r\n            last_color = current_color;\r\n        }\r\n        return res;\r\n    }\r\n    'calculate_ta_row_x_on_x2ygbspans_1bipp'(y) {\r\n        const count_xonspans = this.count_row_on_xspans_1bipp(y);\r\n        const res = new Uint16Array(count_xonspans * 5);\r\n        console.log('y, count_xonspans', y, count_xonspans);\r\n        let i_w = 0;\r\n        const width = this.size[0];\r\n        let last_color = 1;\r\n        let current_color;\r\n        let ta_pos = new Uint16Array(2);\r\n        ta_pos[1] = y;\r\n        for (let x = 0; x < width; x++) {\r\n            ta_pos[0] = x;\r\n            current_color = this.get_pixel_1bipp(ta_pos);\r\n            if (current_color === 1) {\r\n                if (current_color === last_color) {\r\n                    if (res.length === 0) {\r\n                        res[i_w++] = x;\r\n                        res[i_w++] = x;\r\n                        res[i_w++] = y;\r\n                        res[i_w++] = 0; // 0 for undefined group here....\r\n                        res[i_w++] = 0; // 0 for undefined border status here\r\n                    } else {\r\n                        res[i_w - 4]++;\r\n                    }\r\n                } else {\r\n                    res[i_w++] = x;\r\n                    res[i_w++] = x;\r\n                    res[i_w++] = y;\r\n                    res[i_w++] = 0; // 0 for undefined group here....\r\n                    res[i_w++] = 0; // 0 for undefined border status here\r\n                }\r\n            }\r\n            last_color = current_color;\r\n        }\r\n        return res;\r\n    }\r\n    'calculate_arr_rows_ta_x_off_x2ygbspans_1bipp'() {\r\n        const [width, height] = this.size;\r\n        const res = new Array(height);\r\n        for (let y = 0; y < height; y++) {\r\n            res[y] = this.calculate_ta_row_x_off_x2ygbspans_1bipp(y);\r\n        }\r\n        return res;\r\n    }\r\n    'calculate_arr_rows_ta_x_on_x2ygbspans_1bipp'() {\r\n        const [width, height] = this.size;\r\n        const res = new Array(height);\r\n        for (let y = 0; y < height; y++) {\r\n            res[y] = this.calculate_ta_row_x_on_x2ygbspans_1bipp(y);\r\n        }\r\n        console.log('* this.ta', this.ta);\r\n        console.log('this.size', this.size);\r\n        return res;\r\n    }\r\n    'calculate_arr_row_x_on_spans_1bipp'(y) {\r\n        const initial_implementation = () => {\r\n                const res = [];\r\n            const width = this.size[0];\r\n            let last_color = 1;\r\n            let current_color;\r\n            let ta_pos = new Uint16Array(2);\r\n            ta_pos[1] = y;\r\n            for (let x = 0; x < width; x++) {\r\n                ta_pos[0] = x;\r\n                current_color = this.get_pixel_1bipp(ta_pos);\r\n                if (current_color === 1) {\r\n                    if (current_color === last_color) {\r\n                        if (res.length === 0) {\r\n                            res.push([x, x]);\r\n                        } else {\r\n                            res[res.length - 1][1]++;\r\n                        }\r\n                    } else {\r\n                        res.push([x, x]);\r\n                    }\r\n                }\r\n                last_color = current_color;\r\n            }\r\n            return res;\r\n        }\r\n        const _64x0 = BigInt(0);\r\n        const _64x1 = ~_64x0;\r\n        const broken_64bit_optimisation_attempt_inlined_consecutive_value_checking_no_x_loop_implementation = () => {\r\n            const COLOR_LOOKING_FOR = 1;\r\n            const COLOR_NOT_LOOKING_FOR = 0;\r\n            const res = [];\r\n            const width = this.size[0];\r\n            const {ta} = this;\r\n            const ab = ta.buffer;\r\n            const dv = new DataView(ab);\r\n            let last_color = 1; // Try keeping it for the moment.\r\n            let current_color;\r\n            const x_start = 0;\r\n            let idx_bit_overall = ((y * this.size[0]) + x_start) | 0, idx_bit_within_byte = 0 | 0;\r\n            let arr_last;\r\n            let num_bits_remaining = width;\r\n            let x = 0; // an x local value is fine - will update it as necessary\r\n            let has_just_done_multi_read = false;\r\n            let byte_val = 0 | 0;\r\n            let _8_byte_val = BigInt(0);\r\n            while (num_bits_remaining > 0) {\r\n                idx_bit_within_byte = idx_bit_overall & 0b111;\r\n                has_just_done_multi_read = false;\r\n                if (idx_bit_within_byte === 0 && num_bits_remaining >= 8) {\r\n                    if (num_bits_remaining >= 64) {\r\n                        _8_byte_val = dv.getBigInt64(idx_bit_overall >> 3);\r\n                        if (_8_byte_val === _64x0) {\r\n                            last_color = 0;\r\n                            has_just_done_multi_read = true;\r\n                            idx_bit_overall += 64;\r\n                            x += 64;\r\n                            num_bits_remaining -= 64;\r\n                        } else if (_8_byte_val === _64x1) {\r\n                            if (last_color === 1) {\r\n                                if (res.length === 0) {\r\n                                    arr_last = [x, x + 63];\r\n                                    res.push(arr_last);\r\n                                } else {\r\n                                    arr_last[1] += 64;\r\n                                }\r\n                            } else {\r\n                                arr_last = [x, x + 63];\r\n                                res.push(arr_last);\r\n                            }\r\n                            x += 8;\r\n                            last_color = 1;\r\n                            num_bits_remaining -= 64;\r\n                            idx_bit_overall += 64;\r\n                            has_just_done_multi_read = true;\r\n                        }\r\n                    } else {\r\n                    }\r\n                    if (!has_just_done_multi_read) {\r\n                        byte_val = ta[idx_bit_overall >> 3];\r\n                        if (byte_val === 255) {\r\n                            if (last_color === 1) {\r\n                                if (res.length === 0) {\r\n                                    arr_last = [x, x + 7];\r\n                                    res.push(arr_last);\r\n                                } else {\r\n                                    arr_last[1] += 8;\r\n                                }\r\n                            } else {\r\n                                arr_last = [x, x + 7];\r\n                                res.push(arr_last);\r\n                            }\r\n                            x += 8;\r\n                            last_color = 1;\r\n                            num_bits_remaining -= 8;\r\n                            idx_bit_overall += 8;\r\n                            has_just_done_multi_read = true;\r\n                        } else if (byte_val === 0) {\r\n                            last_color = 0;\r\n                            has_just_done_multi_read = true;\r\n                            idx_bit_overall += 8;\r\n                            x += 8;\r\n                            num_bits_remaining -= 8;\r\n                        } else {\r\n                        }\r\n                    }\r\n                }\r\n                if (!has_just_done_multi_read) {\r\n                    current_color = ((ta[idx_bit_overall >> 3] & 128 >> (idx_bit_within_byte)) !== 0) ? 1 : 0;\r\n                    if (current_color === 1) {\r\n                        if (current_color === last_color) {\r\n                            if (res.length === 0) {\r\n                                arr_last = [x, x];\r\n                                res.push(arr_last);\r\n                            } else {\r\n                                arr_last[1]++;\r\n                            }\r\n                        } else {\r\n                            arr_last = [x, x];\r\n                            res.push(arr_last);\r\n                        }\r\n                    }\r\n                    last_color = current_color;\r\n                    idx_bit_overall++;\r\n                    x++;\r\n                    num_bits_remaining--;\r\n                }\r\n            }\r\n            return res;\r\n        }\r\n        const inlined_consecutive_value_checking_no_x_loop_implementation = () => {\r\n            const COLOR_LOOKING_FOR = 1;\r\n            const COLOR_NOT_LOOKING_FOR = 0;\r\n            const res = [];\r\n            const width = this.size[0];\r\n            const {ta} = this;\r\n            const ab = ta.buffer;\r\n            const dv = new DataView(ab);\r\n            let last_color = 1; // Try keeping it for the moment.\r\n            let current_color;\r\n            const x_start = 0;\r\n            let idx_bit_overall = ((y * this.size[0]) + x_start) | 0, idx_bit_within_byte = 0 | 0;\r\n            let arr_last;\r\n            let num_bits_remaining = width;\r\n            let x = 0; // an x local value is fine - will update it as necessary\r\n            let has_just_done_multi_read = false;\r\n            let byte_val = 0 | 0;\r\n            while (num_bits_remaining > 0) {\r\n                idx_bit_within_byte = idx_bit_overall & 0b111;\r\n                has_just_done_multi_read = false;\r\n                if (idx_bit_within_byte === 0 && num_bits_remaining >= 8) {\r\n                    /*\r\n                    if (num_bits_remaining >= 64) {\r\n                    } else {\r\n                    }\r\n                    */\r\n                    byte_val = ta[idx_bit_overall >> 3];\r\n                    if (byte_val === 255) {\r\n                        if (last_color === 1) {\r\n                            if (res.length === 0) {\r\n                                arr_last = [x, x + 7];\r\n                                res.push(arr_last);\r\n                            } else {\r\n                                arr_last[1] += 8;\r\n                            }\r\n                        } else {\r\n                            arr_last = [x, x + 7];\r\n                            res.push(arr_last);\r\n                        }\r\n                        x += 8;\r\n                        last_color = 1;\r\n                        num_bits_remaining -= 8;\r\n                        idx_bit_overall += 8;\r\n                        has_just_done_multi_read = true;\r\n                    } else if (byte_val === 0) {\r\n                        last_color = 0;\r\n                        has_just_done_multi_read = true;\r\n                        idx_bit_overall += 8;\r\n                        x += 8;\r\n                        num_bits_remaining -= 8;\r\n                    } else {\r\n                    }\r\n                }\r\n                if (!has_just_done_multi_read) {\r\n                    current_color = ((ta[idx_bit_overall >> 3] & 128 >> (idx_bit_within_byte)) !== 0) ? 1 : 0;\r\n                    if (current_color === 1) {\r\n                        if (current_color === last_color) {\r\n                            if (res.length === 0) {\r\n                                arr_last = [x, x];\r\n                                res.push(arr_last);\r\n                            } else {\r\n                                arr_last[1]++;\r\n                            }\r\n                        } else {\r\n                            arr_last = [x, x];\r\n                            res.push(arr_last);\r\n                        }\r\n                    }\r\n                    last_color = current_color;\r\n                    idx_bit_overall++;\r\n                    x++;\r\n                    num_bits_remaining--;\r\n                }\r\n            }\r\n            return res;\r\n        }\r\n        const inlined_consecutive_value_checking_no_x_loop_delayed_push_implementation = () => {\r\n            const COLOR_LOOKING_FOR = 1;\r\n            const COLOR_NOT_LOOKING_FOR = 0;\r\n            const res = [];\r\n            const width = this.size[0];\r\n            const {ta} = this;\r\n            const ab = ta.buffer;\r\n            const dv = new DataView(ab);\r\n            let last_color = 1; // Try keeping it for the moment.\r\n            let current_color;\r\n            const x_start = 0;\r\n            let idx_bit_overall = ((y * this.size[0]) + x_start) | 0, idx_bit_within_byte = 0 | 0;\r\n            let arr_last;\r\n            let num_bits_remaining = width;\r\n            let x = 0; // an x local value is fine - will update it as necessary\r\n            let has_just_done_multi_read = false;\r\n            let byte_val = 0 | 0;\r\n            while (num_bits_remaining > 0) {\r\n                idx_bit_within_byte = idx_bit_overall & 0b111;\r\n                has_just_done_multi_read = false;\r\n                if (idx_bit_within_byte === 0 && num_bits_remaining >= 8) {\r\n                    /*\r\n                    if (num_bits_remaining >= 64) {\r\n                    } else {\r\n                    }\r\n                    */\r\n                    byte_val = ta[idx_bit_overall >> 3];\r\n                    if (byte_val === 255) {\r\n                        if (last_color === 1) {\r\n                            if (res.length === 0) {\r\n                                if (arr_last) {\r\n                                    res.push(arr_last);\r\n                                }\r\n                                arr_last = [x, x + 7];\r\n                            } else {\r\n                                arr_last[1] += 8;\r\n                            }\r\n                        } else {\r\n                            if (arr_last) {\r\n                                res.push(arr_last);\r\n                            }\r\n                            arr_last = [x, x + 7];\r\n                        }\r\n                        x += 8;\r\n                        last_color = 1;\r\n                        num_bits_remaining -= 8;\r\n                        idx_bit_overall += 8;\r\n                        has_just_done_multi_read = true;\r\n                    } else if (byte_val === 0) {\r\n                        last_color = 0;\r\n                        has_just_done_multi_read = true;\r\n                        idx_bit_overall += 8;\r\n                        x += 8;\r\n                        num_bits_remaining -= 8;\r\n                    } else {\r\n                    }\r\n                }\r\n                if (!has_just_done_multi_read) {\r\n                    current_color = ((ta[idx_bit_overall >> 3] & 128 >> (idx_bit_within_byte)) !== 0) ? 1 : 0;\r\n                    if (current_color === 1) {\r\n                        if (current_color === last_color) {\r\n                            if (res.length === 0) {\r\n                                if (arr_last) {\r\n                                    res.push(arr_last);\r\n                                }\r\n                                arr_last = [x, x];\r\n                            } else {\r\n                                arr_last[1]++;\r\n                            }\r\n                        } else {\r\n                            if (arr_last) {\r\n                                res.push(arr_last);\r\n                            }\r\n                            arr_last = [x, x];\r\n                        }\r\n                    }\r\n                    last_color = current_color;\r\n                    idx_bit_overall++;\r\n                    x++;\r\n                    num_bits_remaining--;\r\n                }\r\n            }\r\n            if (arr_last) {\r\n                res.push(arr_last);\r\n            }\r\n            return res;\r\n        }\r\n        return inlined_consecutive_value_checking_no_x_loop_delayed_push_implementation();\r\n    }\r\n}\r\nconst get_contig_x_spans_AND = (ta_contig_x_spans_1, ta_contig_x_spans_2) => {\r\n    if (true || ta_contig_x_spans_1.length === ta_contig_x_spans_2.length) {\r\n        const parallel_iterate_inputs = () => {\r\n            const starting_color = 0;\r\n            const l1 = ta_contig_x_spans_1.length, l2 = ta_contig_x_spans_2.length;\r\n            let r_pos_in_1 = 0, r_pos_in_2 = 0;\r\n            let px_idx_in_1 = 0, px_idx_in_2 = 0;\r\n            let color_in_1 = starting_color, color_in_2 = starting_color;\r\n            let color_in_output = starting_color;\r\n            let pos_idx_in_output = 0;\r\n            let are_in_sync = true;\r\n            let i_read_step = 0;\r\n            const arr_res = [];\r\n            const read_step = () => {\r\n                const span_length_from_1 = ta_contig_x_spans_1[r_pos_in_1], span_length_from_2 = ta_contig_x_spans_2[r_pos_in_2];\r\n                console.log('');\r\n                console.log('i_read_step', i_read_step);\r\n                console.log('are_in_sync', are_in_sync);\r\n                console.log('span_length_from_1', span_length_from_1);\r\n                console.log('span_length_from_2', span_length_from_2);\r\n                if (are_in_sync) {\r\n                    if (px_idx_in_1 === px_idx_in_2) {\r\n                        if (span_length_from_1 === span_length_from_2) {\r\n                            if (are_in_sync) {\r\n                                const same_length_in_sync = span_length_from_1;\r\n                                console.log('same_length_in_sync', same_length_in_sync);\r\n                                px_idx_in_1 += same_length_in_sync;\r\n                                px_idx_in_2 += same_length_in_sync;\r\n                                pos_idx_in_output += same_length_in_sync;\r\n                                r_pos_in_1++;\r\n                                r_pos_in_2++;\r\n                                arr_res.push(same_length_in_sync);\r\n                                color_in_1 = color_in_1 === 1 ? 0 : 1;\r\n                                color_in_2 = color_in_2 === 1 ? 0 : 1;\r\n                                color_in_output = color_in_output === 1 ? 0 : 1;\r\n                            } else {\r\n                                console.trace();\r\n                                throw 'NYI';\r\n                            }\r\n                        } else if (span_length_from_1 > span_length_from_2) {\r\n                            if (are_in_sync) {\r\n                                const num_remaining_in_sync = span_length_from_2;\r\n                                arr_res.push(num_remaining_in_sync);\r\n                                console.trace();\r\n                                throw 'NYI';\r\n                            } else {\r\n                                console.trace();\r\n                                throw 'NYI';\r\n                            }\r\n                        } else {\r\n                            console.trace();\r\n                            throw 'NYI';\r\n                        }\r\n                    } else {\r\n                        console.trace();\r\n                        throw 'NYI';\r\n                    }\r\n                } else {\r\n                    console.trace();\r\n                    throw 'NYI';\r\n                }\r\n                i_read_step++;\r\n            }\r\n            read_step();\r\n            console.log('arr_res', arr_res);\r\n            read_step();\r\n        }\r\n        parallel_iterate_inputs();\r\n    } else {\r\n        console.trace();\r\n        throw 'Length Mismatch';\r\n    }\r\n}\r\nPixel_Buffer_Specialised_Enh.get_contig_x_spans_AND = get_contig_x_spans_AND;\r\nmodule.exports = Pixel_Buffer_Specialised_Enh;", "const Pixel_Buffer_Enh = require('./pixel-buffer-7-specialised-enh');\r\n\r\nmodule.exports = Pixel_Buffer_Enh;", "module.exports = require('./pixel-buffer-8-enh');", "\r\n// Later may separate into jsgui3-geometry and have gfx require that???\r\n//.  jsgui3-shapes ???\r\n\r\n// \r\n\r\n\r\n\r\n//const gm = require('gm');\r\n// That would mean server side only\r\n// gfx is both for client and server.\r\n\r\n// 2023 - Considering making jsgui3-html depend on this.\r\n//.  It could be of use for some collision-detection like features, and with canvas.\r\n\r\n// Want some more graphics primitives as classes. Would help with expressing some geometric operations.\r\n//.  Such as check a box that extends to the left of a control (80 pixels) to detect whether and where it intersects any of a control's siblings.\r\n\r\n// A geometry core looks like it would be useful.\r\n//.  Maybe call it 'shapes' for the moment???\r\n\r\n// Shape_Group ????\r\n\r\n// Object_Group???\r\n// Class_Group???\r\n// Instance_Group???\r\n\r\n// Collective ???\r\n//.  Address it collectively, ie it acts as a proxy for calling all of them.\r\n//.  Seems like a lang-mini or lang-tools feature.\r\n\r\n// Typed_Collective ??? Where each item in there must be an instanceOf the type_class\r\n\r\n// Would be useful for addressing a bunch of shapes at once.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//.  Shape\r\n//     Rectangle\r\n//.      .extend('left', 80) for example.\r\n\r\n// shape.render_to_pixel_buffer(pixel_buffer, pos) ???\r\n//.  generate pixel buffers (such as a 1/0 mask, or an opacity mask) to represent a shape.\r\n\r\n// Being able to express how to detect intersections between shapes.\r\n//.  Being able to get the shapes including sizes and positions of rectangular divs, and then use geometry operations to do things like\r\n//.    detect distances between them.\r\n//.  Get the geometry processing lower level functions working well and efficiently, with convenient syntax, and \r\n\r\n\r\n\r\n\r\n// pixel_buffer.paint_shape ???\r\n\r\n\r\n\r\n// jsgui3-html control.bcr could be changed to return a graphics shape class.\r\n\r\n\r\n\r\n\r\nconst Rectangle = require('./shapes/Rectangle');\r\n\r\n\r\n\r\nconst gfx_core = {\r\n    Pixel_Pos_List: require('./pixel-pos-list'),\r\n    Pixel_Buffer: require('./pixel-buffer'),\r\n    Pixel_Buffer_Painter: require('./pixel-buffer-painter'),\r\n    convolution_kernels: require('./convolution-kernels/kernels'),\r\n    ta_math: require('./ta-math'),\r\n    Rectangle,\r\n    Rect: Rectangle\r\n}\r\n\r\nmodule.exports = gfx_core;", "const {field, Data_Object, Data_Value, Data_Model, Evented_Class} = require('lang-tools');\r\nclass Data extends Evented_Class {\r\n    constructor(...a) {\r\n        super(...a);\r\n        const [spec] = a;\r\n        if (spec.context) this.context = spec.context;\r\n        if (spec.model) {\r\n            if (spec.model instanceof Data_Model) {\r\n                this._model = spec.model;\r\n            } else {\r\n                console.trace();\r\n                throw 'stop';\r\n            }\r\n        }\r\n        if (spec.model_constructor) {\r\n            this.model_constructor = spec.model_constructor;\r\n        }\r\n    }\r\n    get model() {\r\n        if (this._model === undefined) {\r\n            if (this.model_constructor) {\r\n                this._model = new this.model_constructor({context: this.context});\r\n            } else {\r\n                this._model = new Data_Value({context: this.context});\r\n            }\r\n        }\r\n        return this._model;\r\n    }\r\n    set model(value) {\r\n        if (value !== this._model) {\r\n            const old = this._model;\r\n            this._model = value;\r\n            this.raise('change', {\r\n                name: 'model',\r\n                old,\r\n                value\r\n            })\r\n        }\r\n    }\r\n}\r\nmodule.exports = Data;", "// And maybe should have the context too?\r\n//   Not unless necessary.\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\n\nconst Data = require('./Data');\n\r\n// Probably worth getting deep into making code that uses both view model and data model to run the GUI.\r\n//     View model can include multiple ways to display something.\r\n\r\n\r\n// The model needs to share context....\r\n\r\n// Or extend Data_Object here even???\r\n\r\n// The model could possibly be a single value (Data_Value).\r\n\r\n\r\n// data.model ????\r\n// data.value ????\r\n// data.model.value ????\r\n\r\n\r\n\r\n// Could maybe make non-server examples / tests that just render it to HTML and list info on what events are attached to the\r\n//   dom and control.\r\n\r\n// Having further ways to develop and test controls not on the server could help a little.\r\n//   Could help a lot with unit / regression tests.\r\n//   Eg what HTML do they render?\r\n\r\n// Is the data coordinated with the data model(s)?\r\n\r\n// Make it extend Data\r\n\r\nclass Control_Data extends Data {\n    constructor(spec = {}) {\n        const enriched_spec = Object.assign(\n            {\n                model_constructor: Data_Object\n            },\n            spec\n        );\n        super(enriched_spec);\n    }\n\r\n    \r\n\r\n    // but will have a model on change system of some sort(s).\r\n    \r\n    // Reassigning events (change event handlers).\r\n    //   So anything listening for change events on the old model instead listens to change events on the new model.\r\n\r\n    // so the Control_Data would raise a 'change' event with name 'model'.\r\n    //   maybe worth being clearer about what kinds of changes there are, ie if something's value changes, or of it gets\r\n    //   replaced with another item.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\n// Maybe this will be 'DMVM' rather than 'MVVM'.\r\n// Data-Model-View-Model.\r\n// Data_Model_View_Model.\r\n// Data_Model_View_Model_View_Data_Model even ???\r\n//   Could generally always support those three model layers (and use them?) but not need to be explicit about them in the high level API.\r\n\r\n// The View_Data_Model will be specifically to mirror the Data_Model, while the View_Model would include things like zoom level of the\r\n//   viewer or editor.\r\n\r\n// Could look into a nice mid-level API to facilitate model mirroring / syncing.\r\n//   Data_Object syncing.\r\n//     And could have it support async patterns (though may be better to retrofit that a little later)\r\n//   That could help make other code more explicit and compact.\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = Control_Data;\n", "\r\n\r\nconst Control_Data = require('./Control_Data');\r\n\r\nclass Control_View_UI_Low_Level_Data extends Control_Data {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        // And would have .model as well....\r\n\r\n        // To start with, need to get this set up in the right control(s).\r\n        //   Text_Input to start with.\r\n\r\n        \r\n\r\n\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Control_View_UI_Low_Level_Data;", "\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\r\n\r\nconst Control_View_UI_Low_Level_Data = require('./Control_View_UI_Low_Level_Data');\r\n\r\nclass Control_View_UI_Low_Level extends Data_Object {\r\n    constructor(spec = {}) {\r\n        super(spec)\r\n\r\n        const {context} = this;\r\n\r\n        // And it needs its own .data\r\n\r\n        // then that needs its own .model\r\n\r\n        // just set .data???\r\n        //  from spec???\r\n\r\n        if (spec.data) {\r\n            this.data = spec.data;\r\n        } else {\r\n            this.data = new Control_View_UI_Low_Level_Data({context});\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Control_View_UI_Low_Level;", "const {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\r\n\r\n\r\nconst Control_View_UI_Low_Level = require('./Control_View_UI_Low_Level');\r\n\r\n// Have a Data class?\r\n//  Data_Model_Data even???\r\n//  Just call it Data for the moment.\r\n\r\n// jsgui3-data for now.\r\n\r\n// And the Data class has a .model\r\n\r\n// Control_View_UI_Compositional\r\n\r\n// Compositional system is a bit complex....\r\n\r\n\r\n\r\n\r\nclass Control_View_UI_Compositional extends Data_Object {\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        // Models....\r\n        //   Data_Model_List???\r\n        //   Is getting on to Collection.\r\n\r\n        // But just an array for the moment.\r\n\r\n        \r\n        this.models = [];\r\n\r\n\r\n        field(this, 'model', new Data_Value());\r\n\r\n        // A Data_Value that is set up to store an array?\r\n        //  Later... just use js array here.\r\n\r\n\r\n    }\r\n}\r\n\r\nclass Control_View_UI_Active_Compositional extends Control_View_UI_Compositional {\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        // And this has a .model, a Data_Value (possibly???)\r\n        //  That Data_Value would need to store control constructors.\r\n        //  That should be OK, can get that better supported if needed.\r\n\r\n        // .model of course.\r\n\r\n        // a .model property.\r\n\r\n\r\n        // maybe just a field for model so it can change and updates known about???\r\n\r\n        // should respond to changes....\r\n        //   at least raise the event.\r\n\r\n        //field(this, 'model', new Data_Value());\r\n\r\n        // Will need to listen to changes to recompose, as well as being able to use this compositional model to compose for the first time.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nclass Control_View_UI_Active extends Data_Object {\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        const compositional = new Control_View_UI_Active_Compositional();\r\n        Object.defineProperty(this, 'compositional', {get: () => compositional});\r\n\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nclass Control_View_UI extends Data_Object {\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        // context????\r\n\r\n\r\n        // .data.model\r\n\r\n        const active = new Control_View_UI_Active();\r\n        // and a read-only property to access it....\r\n        Object.defineProperty(this, 'active', {get: () => active});\r\n\r\n        // .compositional\r\n\r\n        const compositional = new Control_View_UI_Compositional();\r\n        Object.defineProperty(this, 'compositional', {get: () => compositional});\r\n\r\n        // compositional.model property is needed.\r\n        //   And need to be able to set and make use of compositional models.\r\n\r\n        //const ll = new Control_View_UI_Low_Level();\r\n        //Object.defineProperty(this, 'll', {get: () => ll});\r\n\r\n\r\n\r\n\r\n        // ui.compositional.active.model\r\n        // ui.active.compositional.model\r\n\r\n        // view.presentational???\r\n\r\n\r\n        // view.ui.presentational.data.model perhaps???\r\n\r\n\r\n        // view.ui.ll.data.model makes sense.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // Does make for very clear syntax, and clarity that there can be inactive compositional models too.\r\n\r\n\r\n\r\n        // ui.compositional.models too\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Control_View_UI;", "\r\n\r\nconst Control_Data = require('./Control_Data');\r\n\r\nclass Control_View_Data extends Control_Data {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n\r\n\r\n        \r\n        \r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Control_View_Data;", "\r\n\r\nconst Control_Data = require('./Control_Data');\r\n\r\nclass Control_View_Low_Level_Data extends Control_Data {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        // And would have .model as well....\r\n\r\n        // To start with, need to get this set up in the right control(s).\r\n        //   Text_Input to start with.\r\n\r\n        \r\n\r\n\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Control_View_Low_Level_Data;", "\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\r\n\r\nconst Control_View_Low_Level_Data = require('./Control_View_Low_Level_Data');\r\n\r\nclass Control_View_Low_Level extends Data_Object {\r\n    constructor(spec = {}) {\r\n        super(spec)\r\n\r\n        const {context} = this;\r\n\r\n        // And it needs its own .data\r\n\r\n        // then that needs its own .model\r\n\r\n        // just set .data???\r\n        //  from spec???\r\n\r\n        /*\r\n\r\n        if (spec.data) {\r\n            //this.data = spec.data;\r\n        } else {\r\n            this.data = new Control_View_UI_Low_Level_Data({context});\r\n        }\r\n        */\r\n\r\n        const data = (() => {\r\n            if (spec.data) {\r\n                return spec.data;\r\n            } else {\r\n                return new Control_View_Low_Level_Data({context});\r\n            }\r\n        })();\r\n        Object.defineProperty(this, 'data', {get: () => data});\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Control_View_Low_Level;", "\r\n\r\nconst {field, Data_Object, Evented_Class} = require('lang-tools');\r\n\r\n// And the View Data as well...\r\n\r\nconst Data = require('./Data');\r\nconst Control_View_UI = require('./Control_View_UI');\r\nconst Control_View_Data = require('./Control_View_Data');\r\nconst Control_View_Low_Level = require('./Control_View_Low_Level');\r\n\r\n\r\nclass Control_View extends Evented_Class {\r\n    // .data.model\r\n    // .ui.data.model\r\n\r\n    constructor(spec = {}) {\r\n        super();\r\n        if (spec.context) this.context = spec.context;\r\n        const {context} = this;\r\n\r\n        // view.data.model\r\n\r\n        // Allow specifying different inner constructors...???\r\n        //   Dependency injection basically.\r\n\r\n\r\n        // .data being a Data_Object?\r\n        //   Could make sense when responding to models being changed or updated.\r\n\r\n        //const o_data = {context};\r\n        const o_data = {};\r\n        // Maybe create a specific 'view data model'.\r\n        //   Though not sure how different it should be to other sorts.\r\n        if (spec.data) {\r\n            if (spec.data.model) {\r\n                //this.data.model = spec.data.model;\r\n                o_data.model = spec.data.model;\r\n            } else {\r\n                \r\n            }\r\n        }\r\n\r\n        this.data = new Control_View_Data(o_data);\r\n        //field(this.data, 'model');\r\n\r\n        // Data: is the control selected\r\n\r\n        // No, make it a Control_UI object. Or Control_View_UI.\r\n        /*\r\n\r\n        this.ui = {\r\n            data: new Data_Object({context})\r\n        }\r\n        */\r\n\r\n        const o_ui = {context};\r\n        if (spec.ui && spec.ui.data) {\r\n            o_ui.data = spec.ui.data;\r\n        }\r\n\r\n        this.ui = new Control_View_UI(o_ui);\r\n\r\n        // UI - if the control is selected, how is that displayed?\r\n\r\n        \r\n\r\n\r\n        // Not to sure we need the low level control view object.\r\n        //   May be worth making a directory where the systems can be grouped together?\r\n        //   Though really want to set a standard for all controls.\r\n        //   Does seem better to add another level to the view when needed.\r\n        //     As an option rather than to the Control.\r\n\r\n\r\n\r\n\r\n        /*\r\n\r\n        const ll = new Control_View_Low_Level();\r\n        Object.defineProperty(this, 'll', {get: () => ll});\r\n\r\n        */\r\n\r\n\r\n        // and .ll of course...\r\n\r\n\r\n\r\n\r\n        // Set up the view data model.\r\n\r\n\r\n\r\n        \r\n\r\n\r\n        // And the UI will have a compositional model.\r\n        //   Could even have multiple compositional models.\r\n        //   But focus on supporting one to start with...?\r\n\r\n        // but set .compositional.model = ... should be fine for now....\r\n\r\n        //    .active.compositional.model and .compositional.models ????\r\n\r\n        // .active.compositional.model does make sense of course.\r\n        //   Support a friendly API with possibly strange objects and classes.\r\n\r\n        // Control_View_UI_Active perhaps....?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // .ui.compositional.data.model....\r\n\r\n        // Does seem sensible to store various properties deeper within structures.\r\n        \r\n\r\n\r\n\r\n\r\n        //field(this.ui.data, 'model');\r\n        //  Because it now already has that 'model' field\r\n\r\n        if (spec.data) {\r\n\r\n\r\n            \r\n        }\r\n        if (!this.data.model) {\r\n\r\n            // Or create a Data_Value for the moment???\r\n\r\n            //this.data.model = new Data_Object({context});\r\n        }\r\n\r\n\r\n        // Improve this somewhat....\r\n\r\n        /*\r\n\r\n        if (spec.ui && spec.ui.data) {\r\n\r\n            if (spec.ui.data.model) {\r\n\r\n\r\n                this.ui.data.model = spec.ui.data.model;\r\n            } else {\r\n                this.ui.data.model = new Data_Object({context});\r\n            }\r\n        }\r\n        */\r\n\r\n        // \r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Control_View;", "// And maybe should have the context too?\r\n//   Not unless necessary.\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\r\n\r\nconst Data = require('./Data');\r\n\r\nclass Control_Validation_Data extends Data {\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\nmodule.exports = Control_Validation_Data;", "\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class, tof} = require('lang-tools');\r\n\r\n\r\nclass Validation_State extends Evented_Class {\r\n\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n\r\n        // Which properties????\r\n\r\n        \r\n\r\n        // .value property????\r\n        // .valid property?\r\n\r\n        // .valid for the moment.\r\n\r\n    }\r\n\r\n    // a set() function????\r\n    //   because a few things at once get set.\r\n\r\n    set(value) {\r\n        if (value === true) {\r\n            this._valid = true;\r\n        } else if (value === false) {\r\n            this._valid = false;\r\n        } else {\r\n            console.trace();\r\n            throw 'NYI';\r\n        }\r\n    }\r\n\r\n    get valid() {\r\n        return this._valid;\r\n    }\r\n\r\n\r\n\r\n\r\n}\r\n\r\nmodule.exports = Validation_State;", "\r\nconst {Evented_Class} = require('lang-tools');\r\n\r\n\r\nclass Control_Validation_Target {\r\n\r\n    // will target 'data'.\r\n    //  and that will have a .model of course.\r\n\r\n    // this.data.model.on change etc.\r\n    \r\n\r\n\r\n}\r\n\r\nmodule.exports = Control_Validation_Target;", "\r\nconst {Evented_Class} = require('lang-tools');\r\n\r\n// view.enhance???\r\n\r\nclass Control_Validation_Validator extends Evented_Class {\r\n\r\n    constructor(spec) {\r\n        super();\r\n    }\r\n    // needs a 'data' property / field.\r\n\r\n    // getter and setter in the class may be simplest for the moment....\r\n\r\n    \r\n    \r\n\r\n}\r\n\r\nmodule.exports = Control_Validation_Validator;", "\r\n\r\n\r\nconst {field, Data_Object, Data_Value, Evented_Class} = require('lang-tools');\r\n\r\nconst Control_Validation_Data = require('./Control_Validation_Data');\r\nconst Validation_State = require('./Validation_State');\r\n\r\n// Let's just have it a Validation class????\r\n\r\nconst Control_Validation_Target = require('./Control_Validation_Target');\r\nconst Control_Validation_Validator = require('./Control_Validation_Validator');\r\n\r\n// Control_Validation_Validator\r\n\r\n// Should not automatically be there for every control...??\r\n//   Or create it when it's accessed the first time???\r\n\r\n// Or a mixin that sets up the Control_Validation on the control.\r\n\r\n\r\nclass Control_Validation extends Evented_Class {\r\n    // Or set up validation on data model states?\r\n\r\n    // Control validation will be about if the view.data.model.value is valid according to the data.model.valdate_value\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n\r\n        // and will have .data too.\r\n        //   that would itself have .data\r\n\r\n        // The validation data model is important.\r\n        \r\n        if (spec.data) {\r\n            if (spec.data.model) {\r\n                this.data.model = spec.data.model;\r\n            }\r\n        }\r\n\r\n        // validation target too....\r\n        //   a field of some sort.\r\n        //   will need to be able to listen to target change.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // .validation.state.valid for the moment.\r\n        // .validation.state.valid === true???\r\n\r\n        // And need to change that automatically according to what validation needs to be done.\r\n\r\n        // Make it so that validation status indicators can be very clear in purpose and accurate in what they show.\r\n        //   Easy to define and use.\r\n\r\n        // Should continue working on particularly mid level code that makes the high-level code more succinct.\r\n        //   There is quite a lot of existing low level code that can improve the mid level to make the high level\r\n        //   very capable.\r\n\r\n\r\n        // ctrl.validation.target = ...\r\n        // ctrl.validation.validator = ...\r\n        // ctrl.validation = {target, validator}\r\n\r\n        // ctrl.validation.state.on('change', e => {...})\r\n        //   Does seem like it would be a convenient API for watching state changes.\r\n\r\n        // .onchange('valid')\r\n\r\n        // ctrl.view.data.validation seems like maybe the best / clearest syntax.\r\n        // ctrl.validation is not as clear / explicit.\r\n        //   it's really about validating the data in the view.\r\n        //   maybe that would be assumed.\r\n        // ctrl.data.validation too ???\r\n        //   that would be about validating the underlying (currently accepted) data rather than the data represented in the view.\r\n\r\n\r\n        // Maybe best to focus on Control_View_Data_Validation for the moment.\r\n        //   Either would not have a .target, or better its .target is the .view.data.model as read-only.\r\n\r\n        \r\n\r\n\r\n\r\n\r\n\r\n        //\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    // and validator too....\r\n\r\n\r\n\r\n    get validator() {\r\n        //console.log('get model');\r\n        //console.log('this._model', this._model);\r\n\r\n        if (this._validator === undefined) {\r\n\r\n            //if (this.model_constructor) {\r\n            //    this._model = new this.model_constructor({context: this.context});\r\n            //} else {\r\n            //    this._validator = new Data_Value({context: this.context});\r\n            //}\r\n\r\n            this._validator = new Control_Validation_Validator({context: this.context});\r\n\r\n            \r\n        }\r\n        return this._validator;\r\n    }\r\n    set validator(value) {\r\n        // \r\n\r\n        if (value !== this._validator) {\r\n            const old = this._validator;\r\n            this._validator = value;\r\n\r\n            this.raise('change', {\r\n                name: 'validator',\r\n                old,\r\n                value\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    get target() {\r\n        //console.log('get model');\r\n        //console.log('this._model', this._model);\r\n\r\n        if (this._target === undefined) {\r\n\r\n            //if (this.model_constructor) {\r\n            //    this._model = new this.model_constructor({context: this.context});\r\n            //} else {\r\n            //    this._target = new Data_Value({context: this.context});\r\n            //}\r\n\r\n            this._target = new Control_Validation_Target({context: this.context});\r\n\r\n            \r\n        }\r\n        return this._target;\r\n    }\r\n    set target(value) {\r\n        // \r\n\r\n        if (value !== this._target) {\r\n            const old = this._target;\r\n            this._target = value;\r\n\r\n            this.raise('change', {\r\n                name: 'target',\r\n                old,\r\n                value\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    get state() {\r\n        if (this._state === undefined) {\r\n            this._state = new Validation_State();\r\n        }\r\n        return this._state;\r\n    }\r\n\r\n    // Need both .data and .view.data\r\n    //   It may validate between them...?\r\n\r\n\r\n    // validation.validator = ....?\r\n    // validation.validatior.data.model = ...???\r\n    //   Does seem logical!!!\r\n\r\n    // Control_Validation_Target\r\n\r\n    // validation.target.data.model = ....?\r\n\r\n    // Control_Validation_Validator even!!!!\r\n\r\n    // A very explicit API would help, will be a bit fiddly to code all the parts.\r\n\r\n\r\n    // Validator and Target would be explicit names, and will be clear when a view data model is being validated according to the (backing) data model\r\n\r\n\r\n\r\n\r\n\r\n\r\n    get data() {\r\n        if (this._data === undefined) {\r\n            this._data = new Control_Validation_Data({context: this.context});\r\n        }\r\n        return this._data;\r\n    }\r\n\r\n    // And a view property too.\r\n\r\n    // Seems somewhat easy to set up like this....\r\n\r\n    // Though it's Control_Validation_View\r\n\r\n    // Validation View???\r\n\r\n    // ctrl.validation.view.data.model = ctrl.view.data.model\r\n\r\n\r\n\r\n    // Validate view agasint non-view.\r\n\r\n\r\n\r\n\r\n\r\n    set data(value) {\r\n        if (value !== this._data) {\r\n            const old = this._data;\r\n            this._data = value;\r\n            this.raise('change', {\r\n                name: 'data',\r\n                old,\r\n                value\r\n            })\r\n        }\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Control_Validation;", "const { Data_Object } = require('lang-tools');\nconst Control_Data = require('./Control_Data');\nconst Control_View = require('./Control_View');\nconst Control_View_Data = require('./Control_View_Data');\nconst Control_View_UI = require('./Control_View_UI');\n\n/**\n * Ensure a control exposes fully initialized data/view/view.ui stacks.\n * @param {Control} ctrl - target control instance\n * @param {Object} spec - optional data/view overrides from constructor spec\n */\nconst ensure_control_models = (ctrl, spec = {}) => {\n    const context = ctrl.context;\n\n    // ---- Data ----\n    if (!ctrl.data) {\n        ctrl.data = new Control_Data({\n            context,\n            model: spec.data && spec.data.model ? spec.data.model : undefined,\n            model_constructor: Data_Object\n        });\n    } else if (!ctrl.data.model) {\n        ctrl.data.model = spec.data && spec.data.model ? spec.data.model : new Data_Object({context});\n    }\n\n    // ---- View ----\n    if (!ctrl.view) {\n        ctrl.view = new Control_View({\n            context,\n            data: spec.view && spec.view.data ? spec.view.data : undefined\n        });\n    } else {\n        if (!ctrl.view.data) {\n            ctrl.view.data = new Control_View_Data({\n                context,\n                model: spec.view && spec.view.data ? spec.view.data.model : undefined\n            });\n        } else if (!ctrl.view.data.model) {\n            ctrl.view.data.model = spec.view && spec.view.data && spec.view.data.model\n                ? spec.view.data.model\n                : new Data_Object({context});\n        }\n\n        if (!ctrl.view.ui) {\n            ctrl.view.ui = new Control_View_UI({context});\n        }\n    }\n\n    return ctrl;\n};\n\nmodule.exports = {\n    ensure_control_models\n};\n", "const {\r\n    tof,\r\n    each,\r\n    Data_Model,\r\n    Data_Value,\r\n    Immutable_Data_Model,\r\n    Immutable_Data_Value,\r\n    Collection\r\n} = require('lang-tools');\r\nconst Control_Data = require('../html-core/Control_Data');\nconst Control_View = require('../html-core/Control_View');\nconst Control_Validation = require('../html-core/Control_Validation');\nconst {ensure_control_models} = require('../html-core/control_model_factory');\n\r\n// Want to handle server to client persistance here too. Maybe not in this function - possibly control.view.data.model\r\n//   handle that.\r\n\r\n// pfield function for a persistant field?\r\n//  or a persistant field mixin?\r\n\r\n// A 'pre-server-render' event would help with persisting some things.\r\n//   Would persist them as ._fields or ._.\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst model_data_view_compositional_representation = (ctrl, options = {}) => {\r\n    const {data} = options;\r\n    ctrl.using_model_data_view_compositional_representation = true;\r\n    const verify_ctrl_conditions = (ctrl) => {\r\n        if (ctrl.data !== undefined) return false;\r\n        if (ctrl.view !== undefined) return false;\r\n        if (ctrl.validation !== undefined) return false;\r\n        return true;\r\n    }\r\n    const can_proceed = verify_ctrl_conditions(ctrl);\r\n    if (can_proceed) {\n        const {context} = ctrl;\n        ensure_control_models(ctrl, {data});\n        ctrl.validation = new Control_Validation();\n        ctrl.view = ctrl.view || new Control_View({\n            context\n        });\n        ctrl.view.data.model.mixins = ctrl.view.data.model.mixins || new Collection();\r\n        ctrl.view.data.model.mixins.on('change', e_change => {\r\n            const {name, value} = e_change;\r\n            if (name === 'insert') {\r\n                const o_mxs = {};\r\n                ctrl.view.data.model.mixins.each(mx => {\r\n                    o_mxs[mx.name] = mx;\r\n                    if (ctrl.context.mixins) {\r\n                        const my_mx = ctrl.context.mixins[mx.name];\r\n                        my_mx(ctrl);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    } else {\r\n        console.trace();\r\n        console.log('ctrl', ctrl);\r\n        throw 'model_data_view_compositional_representation(ctrl) - ctrl must not have .data or .view properties';\r\n    }\r\n}\r\nmodule.exports = model_data_view_compositional_representation;\n", "var jsgui = require('lang-tools');\r\nconst {\r\n\tget_a_sig,\r\n\teach,\r\n\ttof,\r\n\tdef\r\n} = jsgui;\r\nconst v_subtract = jsgui.util.v_subtract;\r\nconst {\r\n\tprom_or_cb\r\n} = require('fnl');\r\nconst Text_Node = require('./text-node');\r\nvar Control_Core = require('./control-core');\r\nconst has_window = typeof window !== 'undefined';\r\nconst gfx = require('jsgui3-gfx-core');\r\nconst {Rect} = gfx;\r\n\r\n\r\n// Or can't load them at the very start?\r\n\r\n//const mixins = require('../control_mixins/mx');\r\n//const {model_data_view_compositional_representation} = mixins;\r\n\r\nconst model_data_view_compositional_representation = require('../control_mixins/model_data_view_compositional_representation');\r\n\r\n// Need to be able to load / access the mixins here.\r\n//   Need to avoid circular references. Therefore mixins can't use this module.\r\n//     Or not directly?\r\n//       Mixins do seem to need to be able to do things such as create controls.\r\n\r\n\r\n//console.trace();\r\n//throw 'stop';\r\n\r\n// Maybe have a 'mixins available' event somewhere.\r\n\r\n\r\n\r\n\r\n\r\nconst desc = (ctrl, callback) => {\r\n\tif (ctrl.get) {\r\n\t\tvar content = ctrl.get('content');\r\n\t\tif (content) {\r\n\t\t\tvar t_content = typeof content;\r\n\t\t\tif (t_content === 'string' || t_content === 'number') {} else {\r\n\t\t\t\tvar arr = content._arr;\r\n\t\t\t\tvar c, l = arr.length;\r\n\t\t\t\tvar item, t_item;\r\n\t\t\t\tfor (c = 0; c < l; c++) {\r\n\t\t\t\t\titem = arr[c];\r\n\t\t\t\t\tt_item = typeof item;\r\n\t\t\t\t\tif (t_item === 'string' || t_item === 'numbers') {} else {\r\n\t\t\t\t\t\tcallback(arr[c]);\r\n\t\t\t\t\t\tdesc(arr[c], callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nvar dom_desc = (el, callback) => {\r\n\tcallback(el);\r\n\tvar cns = el.childNodes;\r\n\tvar l = cns.length;\r\n\tfor (var c = 0; c < l; c++) {\r\n\t\tdom_desc(cns[c], callback);\r\n\t}\r\n}\r\nconst mapDomEventNames = {\r\n\t'change': true,\r\n\t'click': true,\r\n\t'dblclick': true,\r\n\t'mousedown': true,\r\n\t'mouseup': true,\r\n\t'mousemove': true,\r\n\t'mouseover': true,\r\n\t'mouseout': true,\r\n\t'blur': true,\r\n\t'focus': true,\r\n\t'keydown': true,\r\n\t'keyup': true,\r\n\t'keypress': true,\r\n\t'contextmenu': true,\r\n\t'touchstart': true,\r\n\t'touchmove': true,\r\n\t'touchend': true,\r\n\t'touchcancel': true,\r\n\t'touchforcechange': true,\r\n\t'transitionend': true,\r\n\t'abort': true,\r\n\t'canplay': true,\r\n\t'canplaythrough': true,\r\n\t'durationchange': true,\r\n\t'emptied': true,\r\n\t'ended': true,\r\n\t'error': true,\r\n\t'loadeddata': true,\r\n\t'loadedmetadata': true,\r\n\t'loadstart': true,\r\n\t'pause': true,\r\n\t'play': true,\r\n\t'playing': true,\r\n\t'progress': true,\r\n\t'ratechange': true,\r\n\t'seeked': true,\r\n\t'seeking': true,\r\n\t'submit': true,\r\n\t'stalled': true,\r\n\t'suspend': true,\r\n\t'timeupdate': true,\r\n\t'volumechange': true,\r\n\t'waiting': true\r\n};\r\nclass Control extends Control_Core {\r\n\tconstructor(spec, fields) {\r\n\t\tspec = spec || {};\r\n\t\tsuper(spec, fields);\r\n\t\tconst o_repr = {};\r\n\t\tif (spec.data) o_repr.data = spec.data;\r\n\t\tmodel_data_view_compositional_representation(this, o_repr);\r\n\t\tif (spec.id) {\r\n\t\t\tthis.__id = spec.id;\r\n\t\t}\r\n\t\tif (spec.__id) {\r\n\t\t\tthis.__id = spec.__id;\r\n\t\t}\r\n\t\tif (spec.__type_name) {\r\n\t\t\tthis.__type_name = spec.__type_name;\r\n\t\t}\r\n\t\tthis.map_raises_dom_events = {};\r\n\t\tif (spec.el) {\r\n\r\n\t\t\t// Not so sure about putting it in the spec rather than applying it to the control.\r\n\t\t\t//   Or keeping these persisted properties to apply later?\r\n\r\n\t\t\t// ctrl._persisted_fields perhaps?\r\n\t\t\t//   then can assign those persisted fields once the mixins have been initialised.\r\n\r\n\r\n\r\n\r\n\t\t\tvar jgf = spec.el.getAttribute('data-jsgui-fields');\r\n\t\t\tif (jgf) {\r\n\t\t\t\t//console.log('jgf', jgf);\r\n\t\t\t\tthis._persisted_fields = this._persisted_fields || {};\r\n\t\t\t\tvar s_pre_parse = jgf.replace(/\\[DBL_QT\\]/g, '\"').replace(/\\[SNG_QT\\]/g, '\\'');\r\n\t\t\t\ts_pre_parse = s_pre_parse.replace(/\\'/g, '\"');\r\n\t\t\t\tvar props = JSON.parse(s_pre_parse);\r\n\t\t\t\t//console.log('props', props);\r\n\t\t\t\tlet exempt_prop_names = {}\r\n\t\t\t\teach(props, (v, i) => {\r\n\t\t\t\t\tif (exempt_prop_names[i]) {} else {\r\n\t\t\t\t\t\t//spec[i] = v;\r\n\t\t\t\t\t\tthis._persisted_fields[i] = v;\r\n\r\n\t\t\t\t\t\t// maybe apply those fields after the mixins have been set up.\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (spec.el) {\r\n\t\t\tif (def(this.selection_scope)) {\r\n\t\t\t\tthis.selection_scope = this.context.new_selection_scope(this);\r\n\t\t\t}\r\n\t\t\tvar tn = spec.el.getAttribute('data-jsgui-type');\r\n\t\t\tif (tn) this.__type_name = tn;\r\n\t\t\tvar id = spec.el.getAttribute('data-jsgui-id');\r\n\t\t\tif (id) this.__id = id;\r\n\t\t}\r\n\t\tif (!spec.el) {\r\n\t\t\tthis.compose_using_compositional_model();\r\n\t\t}\r\n\t\tthis.view.ui.compositional.on('change', e => {\r\n\t\t\tconst {name} = e;\r\n\t\t\tif (name === 'model') {\r\n\t\t\t\tthis.recompose_using_compositional_model();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (spec.size) {\r\n\t\t\tthis.size = spec.size;\r\n\t\t}\r\n\t\tif (spec.background) {\r\n\t\t\tif (spec.background.color) {\r\n\t\t\t\tthis.background.color = spec.background.color;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst set_view_ui_composition_model_from_spec = () => {\r\n\t\t\tif (spec.comp) {\r\n\t\t\t\tthis.view.ui.compositional.model = spec.comp;\r\n\t\t\t} else if (spec.composition) {\r\n\t\t\t\tthis.view.ui.compositional.model = spec.composition;\r\n\t\t\t} else if (spec.view) {\r\n\t\t\t\tif (spec.view.ui) {\r\n\t\t\t\t\tif (spec.view.ui.compositional) {\r\n\t\t\t\t\t\tif (spec.view.ui.compositional.model) {\r\n\t\t\t\t\t\t\tthis.view.ui.compositional.model = spec.view.ui.compositional.model;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tset_view_ui_composition_model_from_spec();\r\n\t}\r\n\trecompose_using_compositional_model() {\r\n\t\tthis.content.clear();\r\n\t\tthis.compose_using_compositional_model();\r\n\t}\r\n\tcompose_using_compositional_model() {\r\n\t\tlet cm;\r\n\t\tconst {context} = this;\r\n\t\tif (this.view.ui.compositional.model) {\r\n\t\t\tcm = this.view.ui.compositional.model;\r\n\t\t}\r\n\t\tconst tcm = tof(cm);\r\n\t\tconst compose_from_compositional_model_array = (arr_cm) => {\r\n\t\t\tconst l = arr_cm.length;\r\n\t\t\tif (l > 0) {\r\n\t\t\t\tfor (let c = 0; c < l; c++) {\r\n\t\t\t\t\tconst composition_item = arr_cm[c];\r\n\t\t\t\t\tconst tci = tof(composition_item);\r\n\t\t\t\t\tif (tci === 'function' || tci === 'control') {\r\n\t\t\t\t\t\tconst ctrl = new composition_item({context});\r\n\t\t\t\t\t\tthis.add(ctrl);\r\n\t\t\t\t\t} else if (tci === 'array') { \r\n\t\t\t\t\t\tif (composition_item.length === 2) {\r\n\t\t\t\t\t\t\tconst [t0, t1] = [tof(composition_item[0]), tof(composition_item[1])];\r\n\t\t\t\t\t\t\tif ((t0 === 'function' || t0 === 'control') && t1 === 'object') {\r\n\t\t\t\t\t\t\t\tcomposition_item[1].context = context;\r\n\t\t\t\t\t\t\t\tconst ctrl = new composition_item[0](composition_item[1]);\r\n\t\t\t\t\t\t\t\tthis.add(ctrl);\r\n\t\t\t\t\t\t\t} else if (t0 === 'string' && (t1 === 'function' || t1 === 'control')) {\r\n\t\t\t\t\t\t\t\tconst ctrl = new composition_item[1]({context});\r\n\t\t\t\t\t\t\t\tthis.add(ctrl);\r\n\t\t\t\t\t\t\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\t\t\t\t\t\t\tthis._ctrl_fields[composition_item[0]] = ctrl;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('[t0, t1]', [t0, t1]);\r\n\t\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\t\tthrow 'stop / nyi';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (composition_item.length === 3) {\r\n\t\t\t\t\t\t\tconst [t0, t1, t2] = [tof(composition_item[0]), tof(composition_item[1]), tof(composition_item[2])];\r\n\t\t\t\t\t\t\tif ((t0 === 'string') && (t1 === 'function' || t1 === 'control') && t2 === 'object') {\r\n\t\t\t\t\t\t\t\tcomposition_item[2].context = context;\r\n\t\t\t\t\t\t\t\tconst ctrl = new composition_item[1](composition_item[2]);\r\n\t\t\t\t\t\t\t\tthis.add(ctrl);\r\n\t\t\t\t\t\t\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\t\t\t\t\t\t\tthis._ctrl_fields[composition_item[0]] = ctrl;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('[t0, t1, t2]', [t0, t1, t2]);\r\n\t\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\t\tthrow 'stop / nyi';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.trace();\r\n\t\t\t\t\t\t\tthrow 'stop / nyi';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tcm === 'array') {\r\n\t\t\tcompose_from_compositional_model_array(cm);\r\n\t\t}\r\n\t}\r\n\t'ctrls' (obj_ctrls) {\r\n\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\tlet cf = this._ctrl_fields;\r\n\t\teach(obj_ctrls, (ctrl, name) => {\r\n\t\t\tcf[name] = this[name] = ctrl;\r\n\t\t\tthis.add(ctrl);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t'bcr' () {\r\n\t\tvar a = arguments;\r\n\t\ta.l = a.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\t\tif (sig === '[]') {\r\n\t\t\tvar el = this.dom.el;\r\n\t\t\tvar bcr = el.getBoundingClientRect();\r\n\t\t\tconst res_rect = new Rect([bcr.width, bcr.height], [bcr.left, bcr.top]);\r\n\t\t\treturn res_rect;\r\n\t\t} else if (sig === '[a]') {\r\n\t\t\tlet [pos, br_pos, size] = a[0];\r\n\t\t\tthis.style({\r\n\t\t\t\t'position': 'absolute',\r\n\t\t\t\t'left': pos[0] + 'px',\r\n\t\t\t\t'top': pos[1] + 'px',\r\n\t\t\t\t'width': size[0] + 'px',\r\n\t\t\t\t'height': size[1] + 'px'\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tget size() {\r\n\t\tif (this._size) {\r\n\t\t\treturn this._size;\r\n\t\t} else {\r\n\t\t\tif (this.dom.el) {\r\n\t\t\t\tvar bcr = this.dom.el.getBoundingClientRect();\r\n\t\t\t\treturn [bcr.width, bcr.height];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'add_text' (value) {\r\n\t\tvar tn = new Text_Node({\r\n\t\t\t'context': this.context,\r\n\t\t\t'text': value + ''\r\n\t\t})\r\n\t\tthis.add(tn);\r\n\t\treturn tn;\r\n\t}\r\n\t'computed_style' () {\r\n\t\tvar a = arguments;\r\n\t\ta.l = a.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\t\tvar y;\r\n\t\tif (sig == '[s]') {\r\n\t\t\tvar property_name = a[0];\r\n\t\t\tvar el = this.dom.el;\r\n\t\t\tif (el.currentStyle)\r\n\t\t\t\ty = el.currentStyle[styleProp];\r\n\t\t\telse if (window.getComputedStyle)\r\n\t\t\t\ty = document.defaultView.getComputedStyle(el, null).getPropertyValue(property_name);\r\n\t\t\treturn y;\r\n\t\t}\r\n\t}\r\n\t'padding' () {\r\n\t\tvar a = arguments;\r\n\t\ta.l = a.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\t\tif (sig == '[]') {\r\n\t\t\tvar left, top, right, bottom;\r\n\t\t\tvar c_padding = this.computed_style('padding');\r\n\t\t\tvar s_c_padding = c_padding.split(' ');\r\n\t\t\tif (s_c_padding.length == 3) {\r\n\t\t\t\ttop = parseInt(s_c_padding[0], 10);\r\n\t\t\t\tright = parseInt(s_c_padding[1], 10);\r\n\t\t\t\tbottom = parseInt(s_c_padding[2], 10);\r\n\t\t\t\treturn [0, top, right, bottom];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Required argument: (array)'\r\n\t\t}\r\n\t}\r\n\t'border' () {\r\n\t\tvar a = arguments;\r\n\t\ta.l = arguments.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\t\tif (sig == '[]') {\r\n\t\t\tvar left, top, right, bottom;\r\n\t\t\tvar c_border = this.computed_style('border');\r\n\t\t\tconsole.log('c_border', c_border);\r\n\t\t\tthrow 'stop';\r\n\t\t} else {\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Required argument: (array)'\r\n\t\t}\r\n\t}\r\n\t'border_thickness' () {\r\n\t\tvar a = arguments;\r\n\t\ta.l = arguments.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\t\tif (sig == '[]') {\r\n\t\t\tvar left, top, right, bottom;\r\n\t\t\tvar c_border = this.computed_style('border');\r\n\t\t\tvar b2 = c_border.split(', ').join('');\r\n\t\t\tvar s_c_border = b2.split(' ');\r\n\t\t\tvar thickness = parseInt(s_c_border[0], 10);\r\n\t\t\treturn thickness;\r\n\t\t}\r\n\t}\r\n\t'activate_recursive' () {\r\n\t\tvar el = this.dom.el;\r\n\t\tvar context = this.context;\r\n\t\tvar map_controls = context.map_controls;\r\n\t\tvar parent_control;\r\n\t\trecursive_dom_iterate_depth(el, el2 => {\r\n\t\t\tconst nt = el2.nodeType;\r\n\t\t\tif (nt == 1) {\r\n\t\t\t\tvar jsgui_id = el2.getAttribute('data-jsgui-id');\r\n\t\t\t\tif (jsgui_id) {\r\n\t\t\t\t\tvar ctrl = map_controls[jsgui_id];\r\n\t\t\t\t\tif (!ctrl.__active) ctrl.activate(el2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t'add_dom_event_listener' (event_name, fn_handler) {\r\n\t\tif (has_window) {\r\n\t\t\tconst {\r\n\t\t\t\tcontext\r\n\t\t\t} = this;\r\n\t\t\tconst el = this.dom.el;\r\n\t\t\tconst m = this.map_handlers_to_outer_handlers = this.map_handlers_to_outer_handlers || new Map();\r\n\t\t\tlet outer_handler;\r\n\t\t\tif (m.has(fn_handler)) {\r\n\t\t\t\touter_handler = m.get(fn_handler);\r\n\t\t\t} else {\r\n\t\t\t\touter_handler = e => {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\ttarget\r\n\t\t\t\t\t} = e;\r\n\t\t\t\t\tconst jid = target.getAttribute('data-jsgui-id');\r\n\t\t\t\t\tif (jid) {\r\n\t\t\t\t\t\te.ctrl_target = context.map_controls[jid];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfn_handler(e);\r\n\t\t\t\t};\r\n\t\t\t\tm.set(fn_handler, outer_handler);\r\n\t\t\t}\r\n\t\t\tif (el) {\r\n\t\t\t\tel.addEventListener(event_name, outer_handler, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'remove_dom_event_listener' (event_name, fn_handler) {\r\n\t\tif (has_window) {\r\n\t\t\tconst m = this.map_handlers_to_outer_handlers;\r\n\t\t\tlet outer_handler;\r\n\t\t\tif (m) {\r\n\t\t\t\tif (m.has(fn_handler)) {\r\n\t\t\t\t\touter_handler = m.get(fn_handler);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\touter_handler = outer_handler || fn_handler;\r\n\t\t\tconst el = this.dom.el;\r\n\t\t\tif (el) {\r\n\t\t\t\tel.removeEventListener(event_name, outer_handler, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'remove_event_listener' () {\r\n\t\tconst a = arguments;\r\n\t\tconst sig = get_a_sig(a, 1);\r\n\t\tif (sig === '[s,f]') {\r\n\t\t\tlet [event_name, fn_handler] = a;\r\n\t\t\tif (mapDomEventNames[event_name]) {\r\n\t\t\t\tthis.remove_dom_event_listener(event_name, fn_handler);\r\n\t\t\t}\r\n\t\t\tControl_Core.prototype.remove_event_listener.apply(this, a);\r\n\t\t} else if (sig === '[o]') {\r\n\t\t\teach(a[0], (v, i) => {\r\n\t\t\t\tthis.remove_event_listener(i, v);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t'add_event_listener' () {\r\n\t\tconst a = arguments;\r\n\t\tconst l = a.length;\r\n\t\tconst sig = get_a_sig(a, 1);\r\n\t\tif (l === 1) {\r\n\t\t\teach(a[0], (v, i) => {\r\n\t\t\t\tthis.add_event_listener(i, v);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (l === 2) {\r\n\t\t\tsuper.add_event_listener(a[0], a[1]);\r\n\t\t}\r\n\t\tif (l === 3) {\r\n\t\t\tsuper.add_event_listener(a[0], a[2]);\r\n\t\t}\r\n\t\tif (sig === '[s,f]' || sig === '[s,b,f]') {\r\n\t\t\tlet event_name = a[0];\r\n\t\t\tlet using_dom = true;\r\n\t\t\tif (l === 3 && a[1] === false) using_dom = false;\r\n\t\t\tlet fn_handler;\r\n\t\t\tif (l === 2) fn_handler = a[1];\r\n\t\t\tif (l === 3) fn_handler = a[2];\r\n\t\t\tif (mapDomEventNames[a[0]] && using_dom) {\r\n\t\t\t\tthis.add_dom_event_listener(event_name, fn_handler);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'once_active' (cb) {\r\n\t\tif (typeof document !== 'undefined') {\r\n\t\t\treturn prom_or_cb((solve, jettison) => {\r\n\t\t\t\tif (this.__active) {\r\n\t\t\t\t\tsolve();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet fn_activate = () => {\r\n\t\t\t\t\t\tsolve();\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis.off('activate', fn_activate);\r\n\t\t\t\t\t\t}, 0)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.on('activate', fn_activate);\r\n\t\t\t\t}\r\n\t\t\t}, cb);\r\n\t\t}\r\n\t}\r\n\t'pre_activate'() {\r\n\t\tif (typeof document !== 'undefined') {\r\n\t\t\tif (!this.dom.el) {\r\n\t\t\t\tlet found_el = this.context.get_ctrl_el(this) || this.context.map_els[this._id()] || document.querySelectorAll('[data-jsgui-id=\"' + this._id() + '\"]')[0];\r\n\t\t\t\tif (found_el) {\r\n\t\t\t\t\tthis.dom.el = found_el;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.dom.el) {} else {\r\n\t\t\t\tthis.load_dom_attributes_from_dom();\r\n\r\n\t\t\t\t//  reconstruct a special .view.data.model.mixins collection from the dom attributes.\r\n\t\t\t\t//    collection seems logically best - though collection may be redone soon.\r\n\r\n\t\t\t\tif (this.dom.attributes[\"data-jsgui-mixins\"] !== undefined) {\r\n\t\t\t\t\tconst str_mixins = this.dom.attributes[\"data-jsgui-mixins\"]?.replace(/'/g, '\"');\r\n\t\t\t\t\tif(str_mixins) {\r\n\t\t\t\t\t\tconst o_mixins = JSON.parse(str_mixins);\r\n\t\t\t\t\t\t//this.view.data.model.mixins.clear();\r\n\t\t\t\t\t\t//each(mixins, mixin => {\r\n\t\t\t\t\t\t//\tthis.view.data.model.mixins.push(mixin);\r\n\r\n\t\t\t\t\t\t//console.log('o_mixins', o_mixins);\r\n\r\n\t\t\t\t\t\tconst old_silent = this.view.data.model.mixins.silent;\r\n\r\n\t\t\t\t\t\t// .silently(cb) function could be one way to do these things.\r\n\r\n\t\t\t\t\t\tthis.view.data.model.mixins.silent = true;\r\n\t\t\t\t\t\t//});\r\n\t\t\t\t\t\t//console.log('o_mixins', o_mixins);\r\n\r\n\t\t\t\t\t\teach(o_mixins, (mixin) => {\r\n\t\t\t\t\t\t\tconst {name, options} = mixin;\r\n\r\n\t\t\t\t\t\t\tconst converted_name = name.replace(/-/g, '_');\r\n\r\n\t\t\t\t\t\t\t//console.log('mixin', mixin);\r\n\r\n\t\t\t\t\t\t\t//console.log('mixin converted_name', converted_name);\r\n\r\n\t\t\t\t\t\t\t// and run the mixin here???\r\n\r\n\t\t\t\t\t\t\tthis.view.data.model.mixins.push(mixin);\r\n\r\n\t\t\t\t\t\t\tconst the_mixin = this.context.mixins[converted_name];\r\n\r\n\t\t\t\t\t\t\t//console.log('!!the_mixin', !!the_mixin);\r\n\r\n\t\t\t\t\t\t\tif (the_mixin) {\r\n\t\t\t\t\t\t\t\tthe_mixin(this);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// And add this back to the view data model??\r\n\r\n\r\n\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tthis.view.data.model.mixins.silent = old_silent;\r\n\r\n\t\t\t\t\t\t// Set it back up in the view.data.model.mixins collection.\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._persisted_fields) {\r\n\t\t\t\t\teach(this._persisted_fields, (v, i) => {\r\n\t\t\t\t\t\tthis[i] = v;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.dom.attributes[\"data-jsgui-data-model-id\"] !== undefined) {\r\n\t\t\t\t\tconst context_referenced_data_model = this.context.map_data_models[this.dom.attributes[\"data-jsgui-data-model-id\"]];\r\n\t\t\t\t\tif (context_referenced_data_model) {\r\n\t\t\t\t\t\tthis.data.model = context_referenced_data_model;\r\n\t\t\t\t\t\tconsole.log('have used data.model referenced from context: ' + context_referenced_data_model.__id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.pre_activate_content_controls();\r\n\t\t\t\tthis.add_content_change_event_listener();\r\n\t\t\t\tthis.add_dom_attributes_changes_listener();\r\n\t\t\t}\r\n\t\t} else {}\r\n\t}\r\n\t'activate' (el) {\r\n\t\tif (typeof document !== 'undefined' && !this.__active) {\r\n\t\t\tthis.__active = true;\r\n\t\t\tif (!this.dom.el) {\r\n\t\t\t\tlet found_el = this.context.get_ctrl_el(this) || this.context.map_els[this._id()] || document.querySelectorAll('[data-jsgui-id=\"' + this._id() + '\"]')[0];\r\n\t\t\t\tif (found_el) {\r\n\t\t\t\t\tthis.dom.el = found_el;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.dom.el) {} else {\r\n\t\t\t\tthis.activate_content_controls();\r\n\r\n\t\t\t\t// activate / load the mixins from the view model of them...???\r\n\r\n\t\t\t\tthis.raise('activate');\r\n\t\t\t}\r\n\t\t} else {}\r\n\t}\r\n\t'add_dom_attributes_changes_listener' () {\r\n\t\tvar dom_attributes = this.dom.attributes;\r\n\t\tvar el = this.dom.el;\r\n\t\tdom_attributes.on('change', (e_change) => {\r\n\t\t\tvar property_name = e_change.name || e_change.key,\r\n\t\t\t\tval = e_change.value || e_change.new;\r\n\t\t\tif (el && el.nodeType === 1) {\r\n\t\t\t\tel.setAttribute(property_name, val);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'activate_this_and_subcontrols' () {\r\n\t\tthis.iterate_this_and_subcontrols((ctrl) => {\r\n\t\t\tif (ctrl.dom.el) {\r\n\t\t\t\tctrl.activate();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'add_content_change_event_listener' () {\r\n\t\tconst {\r\n\t\t\tcontext\r\n\t\t} = this;\r\n\t\tvar map_controls = context.map_controls;\r\n\t\tlet el = this.dom.el;\r\n\t\tthis.content.on('change', (e_change) => {\r\n\t\t\tlet itemDomEl;\r\n\t\t\tvar type = e_change.name;\r\n\t\t\tif (type === 'insert') {\r\n\t\t\t\tvar item = e_change.value;\r\n\t\t\t\tvar retrieved_item_dom_el = item.dom.el;\r\n\t\t\t\tvar t_ret = tof(retrieved_item_dom_el);\r\n\t\t\t\tif (t_ret === 'string') {\r\n\t\t\t\t\titemDomEl = retrieved_item_dom_el;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (retrieved_item_dom_el) {\r\n\t\t\t\t\t\titemDomEl = retrieved_item_dom_el;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!itemDomEl) {\r\n\t\t\t\t\t\tif (context.map_els[item._id()]) {\r\n\t\t\t\t\t\t\titemDomEl = context.map_els[item._id()];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!itemDomEl) {\r\n\t\t\t\t\t\tvar item_tag_name = 'div';\r\n\t\t\t\t\t\tvar dv_tag_name = item.dom.tagName;\r\n\t\t\t\t\t\tif (dv_tag_name) {\r\n\t\t\t\t\t\t\titem_tag_name = dv_tag_name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar temp_el;\r\n\t\t\t\t\t\tif (item_tag_name === 'circle' || item_tag_name === 'line' || item_tag_name === 'polyline') {\r\n\t\t\t\t\t\t\tvar temp_svg_container = e_change.item.context.document.createElement('div');\r\n\t\t\t\t\t\t\ttemp_svg_container.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">' + e_change.item.all_html_render() + '</svg>';\r\n\t\t\t\t\t\t\titemDomEl = temp_svg_container.childNodes[0].childNodes[0];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttemp_el = e_change.item.context.document.createElement('div');\r\n\t\t\t\t\t\t\ttemp_el.innerHTML = e_change.item.all_html_render();\r\n\t\t\t\t\t\t\titemDomEl = temp_el.childNodes[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem.dom.el = itemDomEl;\r\n\t\t\t\t\t\tcontext.map_els[item._id()] = itemDomEl;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tvar t_item_dom_el = tof(itemDomEl);\r\n\t\t\t\tif (t_item_dom_el === 'string') {\r\n\t\t\t\t\titemDomEl = document.createTextNode(itemDomEl);\r\n\t\t\t\t}\r\n\t\t\t\tif (!itemDomEl) {}\r\n\t\t\t\tif (itemDomEl) {\r\n\t\t\t\t\tel.appendChild(itemDomEl);\r\n\t\t\t\t\te_change.item.register_this_and_subcontrols();\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'clear') {\r\n\t\t\t\tif (el) {\r\n\t\t\t\t\tel.innerHTML = '';\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'remove') {\r\n\t\t\t\tif (e_change.value.dom.el) {\r\n\t\t\t\t\te_change.value.dom.el.parentNode.removeChild(e_change.value.dom.el);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t\tthrow 'NYI - Unexpected change type. e_change: ' + e_change;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'rec_desc_ensure_ctrl_el_refs' (el) {\r\n\t\tel = el || this.dom.el;\r\n\t\tvar context = this.context;\r\n\t\tif (el) {\r\n\t\t\tvar c, l, cns;\r\n\t\t\tvar jsgui_id;\r\n\t\t\tvar map_els = {};\r\n\t\t\tdom_desc(el, el => {\r\n\t\t\t\tif (el.getAttribute) {\r\n\t\t\t\t\tjsgui_id = el.getAttribute('data-jsgui-id');\r\n\t\t\t\t\tif (jsgui_id) {\r\n\t\t\t\t\t\tmap_els[jsgui_id] = el;\r\n\t\t\t\t\t\tcontext.map_els[jsgui_id] = el;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdesc(this, (ctrl) => {\r\n\t\t\t\tvar t_ctrl = tof(ctrl);\r\n\t\t\t\tif (ctrl !== this && t_ctrl === 'control') {\r\n\t\t\t\t\tvar id = ctrl._id();\r\n\t\t\t\t\tif (map_els[id]) {\r\n\t\t\t\t\t\tif (ctrl.dom.el !== map_els[id]) {\r\n\t\t\t\t\t\t\tctrl.dom.el = map_els[id];\r\n\t\t\t\t\t\t} else {}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctrl.activate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t'rec_desc_activate' () {\r\n\t\tdesc(this, ctrl => {\r\n\t\t\tconst t_ctrl = tof(ctrl);\r\n\t\t\tif (t_ctrl === 'control') {\r\n\t\t\t\tctrl.activate();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'activate_content_controls' () {\r\n\t\tconst do_activation = () => {\r\n\t\t\tif (!this.dom.el) {\r\n\t\t\t\tlet found_el = this.context.get_ctrl_el(this);\r\n\t\t\t\tif (found_el) {\r\n\t\t\t\t\tthis.dom.el = found_el;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst el = this.dom.el;\r\n\t\t\tif (el) {\r\n\t\t\t\tconst context = this.context;\r\n\t\t\t\tlet ctrl_fields = {},\r\n\t\t\t\t\tc, l;\r\n\t\t\t\tif (el.getAttribute) {\r\n\t\t\t\t\tlet cns = el.childNodes;\r\n\t\t\t\t\tlet content = this.content;\r\n\t\t\t\t\tfor (c = 0, l = cns.length; c < l; c++) {\r\n\t\t\t\t\t\tlet cn = cns[c];\r\n\t\t\t\t\t\tif (cn) {\r\n\t\t\t\t\t\t\tlet nt = cn.nodeType;\r\n\t\t\t\t\t\t\tif (nt === 1) {\r\n\t\t\t\t\t\t\t\tlet cn_jsgui_id = cn.getAttribute('data-jsgui-id');\r\n\t\t\t\t\t\t\t\tlet cctrl = context.map_controls[cn_jsgui_id];\r\n\t\t\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\t\t\tif (cctrl) {\r\n\t\t\t\t\t\t\t\t\tcctrl.activate();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo_activation();\r\n\t}\r\n\t'pre_activate_content_controls' () {\r\n\t\tconst do_pre_activation = () => {\r\n\t\t\tif (!this.dom.el) {\r\n\t\t\t\tlet found_el = this.context.get_ctrl_el(this);\r\n\t\t\t\tif (found_el) {\r\n\t\t\t\t\tthis.dom.el = found_el;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst el = this.dom.el;\r\n\t\t\tif (el) {\r\n\t\t\t\tconst context = this.context;\r\n\t\t\t\tlet ctrl_fields = {},\r\n\t\t\t\t\tc, l;\r\n\t\t\t\tif (el.getAttribute) {\r\n\t\t\t\t\tlet str_ctrl_fields = el.getAttribute('data-jsgui-ctrl-fields');\r\n\t\t\t\t\tif (str_ctrl_fields) {\r\n\t\t\t\t\t\tctrl_fields = JSON.parse(str_ctrl_fields.replace(/'/g, '\"'));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet ctrl_fields_keys = Object.keys(ctrl_fields);\r\n\t\t\t\t\tlet l_ctrl_fields_keys = ctrl_fields_keys.length;\r\n\t\t\t\t\tlet key, value;\r\n\t\t\t\t\tfor (c = 0; c < l_ctrl_fields_keys; c++) {\r\n\t\t\t\t\t\tkey = ctrl_fields_keys[c];\r\n\t\t\t\t\t\tvalue = ctrl_fields[key];\r\n\t\t\t\t\t\tthis[key] = context.map_controls[value];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet cns = el.childNodes;\r\n\t\t\t\t\tlet content = this.content;\r\n\t\t\t\t\tfor (c = 0, l = cns.length; c < l; c++) {\r\n\t\t\t\t\t\tlet cn = cns[c];\r\n\t\t\t\t\t\tif (cn) {\r\n\t\t\t\t\t\t\tlet nt = cn.nodeType;\r\n\t\t\t\t\t\t\tif (nt === 1) {\r\n\t\t\t\t\t\t\t\tlet cn_jsgui_id = cn.getAttribute('data-jsgui-id');\r\n\t\t\t\t\t\t\t\tlet cctrl = context.map_controls[cn_jsgui_id];\r\n\t\t\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\t\t\tif (cctrl) {\r\n\t\t\t\t\t\t\t\t\tlet ctrl_id = cctrl.__id;\r\n\t\t\t\t\t\t\t\t\tif (ctrl_id) {\r\n\t\t\t\t\t\t\t\t\t\tcontent.each((v, i) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (v.__id) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (v.__id === ctrl_id) found = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (!found) {\r\n\t\t\t\t\t\t\t\t\t\tcontent._arr.push(cctrl);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tcctrl.parent = this;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (nt === 3) {\r\n\t\t\t\t\t\t\t\tconst i_sibling = c;\r\n\t\t\t\t\t\t\t\tconst corresponding_ctrl = content._arr[i_sibling];\r\n\t\t\t\t\t\t\t\tif (corresponding_ctrl) {\r\n\t\t\t\t\t\t\t\t\tif (corresponding_ctrl.text === cn.nodeValue) {\r\n\t\t\t\t\t\t\t\t\t\tcorresponding_ctrl.dom.el = cn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconsole.log('&&& no corresponding control');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconst do_add = () => {\r\n\t\t\t\t\t\t\t\t\tlet val = cn.nodeValue;\r\n\t\t\t\t\t\t\t\t\tconsole.log('adding Text_Node control', val);\r\n\t\t\t\t\t\t\t\t\tconst tn = new Text_Node({\r\n\t\t\t\t\t\t\t\t\t\tcontext: this.context,\r\n\t\t\t\t\t\t\t\t\t\ttext: val,\r\n\t\t\t\t\t\t\t\t\t\tel: cn\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\tcontent.add(tn);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo_pre_activation();\r\n\t}\r\n\t'load_dom_attributes_from_dom' () {\r\n\t\tconst el = this.dom.el;\r\n\t\tconst dom_attributes = this.dom.attributes;\r\n\t\tlet item, name, value, i;\r\n\t\tif (el) {\r\n\t\t\tconst attrs = el.attributes;\r\n\t\t\tif (attrs) {\r\n\t\t\t\tconst l = attrs.length\r\n\t\t\t\tfor (i = 0; i < l; i++) {\r\n\t\t\t\t\titem = attrs.item(i);\r\n\t\t\t\t\tname = item.name;\r\n\t\t\t\t\tvalue = item.value;\r\n\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tif (name === 'data-jsgui-id') {} else if (name === 'data-jsgui-type') {} else if (name === 'style') {\r\n\t\t\t\t\t\tdom_attributes[name] = value;\r\n\t\t\t\t\t} else if (name === 'class') {\r\n\t\t\t\t\t\tdom_attributes[name] = value;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdom_attributes[name] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\tdom_attributes[name] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'_search_descendents' (search) {\r\n\t\tconst recursive_iterate = (ctrl, item_callback) => {\r\n\t\t\tconst content = ctrl.content,\r\n\t\t\t\tt_content = tof(content);\r\n\t\t\tif (t_content === 'collection') {\r\n\t\t\t\tif (content.length() > 0) {\r\n\t\t\t\t\tcontent.each((item, i) => {\r\n\t\t\t\t\t\titem_callback(item);\r\n\t\t\t\t\t\trecursive_iterate(item, item_callback);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst arr_matching = [];\r\n\t\trecursive_iterate(this, (item) => {\r\n\t\t\tconst item_type = item.__type_name;\r\n\t\t\tif (item_type === search) {\r\n\t\t\t\tarr_matching.push(item);\r\n\t\t\t} else {}\r\n\t\t});\r\n\t\treturn arr_matching;\r\n\t}\r\n\t'_search_ancestor' (search) {\r\n\t\tconst parent = this.parent;\r\n\t\tif (parent) {\r\n\t\t\tif (parent === search) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof parent.ancestor === 'function') {\r\n\t\t\t\t\treturn parent.ancestor(search);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t'add' (new_content) {\r\n\t\tconst {\r\n\t\t\tcontext\r\n\t\t} = this;\r\n\t\tif (context) {\r\n\t\t\tconst m = context.map_controls_being_added_in_frame = context.map_controls_being_added_in_frame || {};\r\n\t\t\tconst tnc = tof(new_content);\r\n\t\t\tif (tnc === 'array') {\r\n\t\t\t\teach(new_content, (v) => {\r\n\t\t\t\t\tconst candd = v.this_and_descendents;\r\n\t\t\t\t\tif (candd) {\r\n\t\t\t\t\t\teach(candd, ctrl => {\r\n\t\t\t\t\t\t\tif (ctrl._id) {\r\n\t\t\t\t\t\t\t\tm[ctrl._id()] = ctrl;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (new_content) {\r\n\t\t\t\t\tconst candd = new_content.this_and_descendents;\r\n\t\t\t\t\tif (candd) {\r\n\t\t\t\t\t\teach(candd, ctrl => {\r\n\t\t\t\t\t\t\tif (ctrl._id) {\r\n\t\t\t\t\t\t\t\tm[ctrl._id()] = ctrl;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn super.add(new_content);\r\n\t}\r\n\t'clear' () {\r\n\t\tconst {\r\n\t\t\tcontext\r\n\t\t} = this;\r\n\t\tcontext.map_controls_being_removed_in_frame = context.map_controls_being_removed_in_frame || {};\r\n\t\teach(this.descendents, ctrl => {\r\n\t\t\tif (ctrl._id) context.map_controls_being_removed_in_frame[ctrl._id()] = ctrl;\r\n\t\t});\r\n\t\tsuper.clear();\r\n\t}\r\n};\r\nlet p = Control.prototype;\r\np.on = p.add_event_listener;\r\np.off = p.remove_event_listener;\r\nmodule.exports = Control;", "const { Data_Object, Data_Value, tof, each } = require('lang-tools');\r\n\r\n/**\r\n * ModelBinder - Provides declarative two-way data binding between models\r\n * \r\n * Key Features:\r\n * - Bidirectional binding between data model and view model\r\n * - Transformation functions for data conversion\r\n * - Support for computed properties\r\n * - Automatic cleanup of event listeners\r\n * - Debugging and inspection capabilities\r\n * \r\n * @example\r\n * const binder = new ModelBinder(dataModel, viewModel, {\r\n *     'date': {\r\n *         to: 'formattedDate',\r\n *         transform: (date) => formatDate(date),\r\n *         reverse: (str) => parseDate(str)\r\n *     }\r\n * });\r\n */\r\nclass ModelBinder {\n    constructor(sourceModel, targetModel, bindings = {}, options = {}) {\n        if (typeof targetModel === 'string') {\n            const [\n                sourceProp,\n                legacyTargetModel,\n                targetProp,\n                legacyOptions = {}\n            ] = Array.prototype.slice.call(arguments, 1);\n            const normalizedBindings = {\n                [sourceProp]: Object.assign(\n                    {to: targetProp},\n                    legacyOptions.transform ? {transform: legacyOptions.transform} : {},\n                    legacyOptions.reverse ? {reverse: legacyOptions.reverse} : {}\n                )\n            };\n            const normalizedOptions = Object.assign({\n                bidirectional: legacyOptions.twoWay || legacyOptions.bidirectional || !!legacyOptions.reverse,\n                immediate: legacyOptions.immediate !== false,\n                debug: legacyOptions.debug || false\n            }, legacyOptions);\n            return new ModelBinder(sourceModel, legacyTargetModel, normalizedBindings, normalizedOptions);\n        }\n\n        this.sourceModel = sourceModel;\n        this.targetModel = targetModel;\n        this.bindings = bindings;\n        this.options = Object.assign({\n            bidirectional: true,\n            immediate: true,\n            debug: false\n        }, options);\n        \n        this._listeners = [];\n        this._locks = new Set();\n        this._active = false;\n        \n        if (this.options.immediate) {\n            this.activate();\n        }\n    }\n    \r\n    /**\r\n     * Activate all bindings\r\n     */\r\n    activate() {\r\n        if (this._active) return;\r\n        this._active = true;\r\n        \r\n        each(this.bindings, (binding, sourceProp) => {\r\n            this._setupBinding(sourceProp, binding);\r\n        });\r\n        \r\n        if (this.options.debug) {\r\n            console.log('[ModelBinder] Activated bindings:', Object.keys(this.bindings));\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Deactivate all bindings and cleanup listeners\r\n     */\r\n    deactivate() {\r\n        if (!this._active) return;\r\n        this._active = false;\r\n        \r\n        this._listeners.forEach(({ model, event, handler }) => {\r\n            if (model && model.off) {\r\n                model.off(event, handler);\r\n            }\r\n        });\r\n        \r\n        this._listeners = [];\r\n        \r\n        if (this.options.debug) {\r\n            console.log('[ModelBinder] Deactivated bindings');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Setup a single binding between source and target properties\r\n     * @private\r\n     */\r\n    _setupBinding(sourceProp, binding) {\r\n        const targetProp = typeof binding === 'string' ? binding : binding.to;\r\n        const transform = binding.transform;\r\n        const reverse = binding.reverse;\r\n        const condition = binding.condition;\r\n        \r\n        // Initial sync from source to target\r\n        if (this.sourceModel[sourceProp] !== undefined) {\r\n            const value = this.sourceModel[sourceProp];\r\n            const transformedValue = transform ? transform(value) : value;\r\n            \r\n            if (!condition || condition(value)) {\r\n                this.targetModel[targetProp] = transformedValue;\r\n            }\r\n        }\r\n        \r\n        // Setup source \u2192 target binding\n        const sourceHandler = (e) => {\n            if (e.name === sourceProp) {\n                const value = e.value;\n                const transformedValue = transform ? transform(value) : value;\n                \n                if (!condition || condition(value)) {\n                    const lock_key = `${sourceProp}->${targetProp}`;\n                    if (this._acquire(lock_key)) {\n                        this.targetModel[targetProp] = transformedValue;\n                        \n                        if (this.options.debug) {\n                            console.log(`[ModelBinder] ${sourceProp} \u2192 ${targetProp}:`, value, '\u2192', transformedValue);\n                        }\n                        this._release(lock_key);\n                    }\n                }\n            }\n        };\n        \r\n        this.sourceModel.on('change', sourceHandler);\r\n        this._listeners.push({\r\n            model: this.sourceModel,\r\n            event: 'change',\r\n            handler: sourceHandler\r\n        });\r\n        \r\n        // Setup target \u2192 source binding (if bidirectional)\r\n        if (this.options.bidirectional && reverse) {\n            const targetHandler = (e) => {\n                if (e.name === targetProp) {\n                    const value = e.value;\n                    const reversedValue = reverse(value);\n                    \n                    if (!condition || condition(reversedValue)) {\n                        const lock_key = `${targetProp}->${sourceProp}`;\n                        if (this._acquire(lock_key)) {\n                            this.sourceModel[sourceProp] = reversedValue;\n                            \n                            if (this.options.debug) {\n                                console.log(`[ModelBinder] ${targetProp} \u2192 ${sourceProp}:`, value, '\u2192', reversedValue);\n                            }\n                            this._release(lock_key);\n                        }\n                    }\n                }\n            };\n            \r\n            this.targetModel.on('change', targetHandler);\r\n            this._listeners.push({\r\n                model: this.targetModel,\r\n                event: 'change',\r\n                handler: targetHandler\r\n            });\r\n        }\n    }\n    \n    _acquire(key) {\n        if (!key) return true;\n        if (this._locks.has(key)) {\n            if (this.options.debug) {\n                console.warn('[ModelBinder] Loop suppressed for', key);\n            }\n            return false;\n        }\n        this._locks.add(key);\n        return true;\n    }\n\n    _release(key) {\n        if (key) {\n            this._locks.delete(key);\n        }\n    }\n\n    unbind() {\n        this.deactivate();\n    }\n    \n    /**\n     * Update a specific binding manually\n     */\n    updateBinding(sourceProp) {\r\n        const binding = this.bindings[sourceProp];\r\n        if (!binding) return;\r\n        \r\n        const targetProp = typeof binding === 'string' ? binding : binding.to;\r\n        const transform = binding.transform;\r\n        \r\n        const value = this.sourceModel[sourceProp];\r\n        const transformedValue = transform ? transform(value) : value;\r\n        this.targetModel[targetProp] = transformedValue;\r\n    }\r\n    \r\n    /**\r\n     * Get current binding state for inspection\r\n     */\r\n    inspect() {\r\n        const state = {};\r\n        \r\n        each(this.bindings, (binding, sourceProp) => {\r\n            const targetProp = typeof binding === 'string' ? binding : binding.to;\r\n            state[sourceProp] = {\r\n                target: targetProp,\r\n                sourceValue: this.sourceModel[sourceProp],\r\n                targetValue: this.targetModel[targetProp],\r\n                hasTransform: !!binding.transform,\r\n                hasReverse: !!binding.reverse,\r\n                bidirectional: this.options.bidirectional && !!binding.reverse\r\n            };\r\n        });\r\n        \r\n        return state;\r\n    }\r\n}\r\n\r\n/**\r\n * ComputedProperty - A property that automatically updates based on dependencies\r\n * \r\n * @example\r\n * const fullName = new ComputedProperty(\r\n *     model,\r\n *     ['firstName', 'lastName'],\r\n *     (first, last) => `${first} ${last}`\r\n * );\r\n */\r\nclass ComputedProperty {\n    constructor(model, dependencies, computeFn, options = {}) {\n        this.model = model;\n        this.dependencies = Array.isArray(dependencies) ? dependencies : [dependencies];\n        this.computeFn = computeFn;\n        this.options = Object.assign({\r\n            propertyName: 'computed',\r\n            immediate: true,\r\n            debug: false\r\n        }, options);\r\n        \r\n        this._listeners = [];\r\n        this._active = false;\r\n        this._lastValue = undefined;\r\n        \r\n        if (this.options.immediate) {\r\n            this.activate();\r\n        }\r\n    }\r\n    \r\n    activate() {\r\n        if (this._active) return;\r\n        this._active = true;\r\n        \r\n        // Compute initial value\r\n        this.compute();\r\n        \r\n        // Setup listeners for dependencies\r\n        const handler = (e) => {\r\n            if (this.dependencies.includes(e.name)) {\r\n                this.compute();\r\n            }\r\n        };\r\n        \r\n        this.model.on('change', handler);\r\n        this._listeners.push({ model: this.model, event: 'change', handler });\r\n        \r\n        if (this.options.debug) {\r\n            console.log('[ComputedProperty] Activated for dependencies:', this.dependencies);\r\n        }\r\n    }\r\n    \r\n    deactivate() {\r\n        if (!this._active) return;\r\n        this._active = false;\r\n        \r\n        this._listeners.forEach(({ model, event, handler }) => {\r\n            if (model && model.off) {\r\n                model.off(event, handler);\r\n            }\r\n        });\r\n        \r\n        this._listeners = [];\r\n    }\r\n    \r\n    compute() {\r\n        const args = this.dependencies.map(dep => this.model[dep]);\r\n        const newValue = this.computeFn(...args);\r\n        \r\n        if (newValue !== this._lastValue) {\r\n            this._lastValue = newValue;\r\n            this.model[this.options.propertyName] = newValue;\r\n            \r\n            if (this.options.debug) {\r\n                console.log('[ComputedProperty] Updated:', this.options.propertyName, '=', newValue);\r\n            }\r\n        }\r\n        \r\n        return newValue;\r\n    }\r\n    \r\n    get value() {\n        return this._lastValue;\n    }\n\n    destroy() {\n        this.deactivate();\n    }\n}\n\r\n/**\r\n * PropertyWatcher - Watch for changes to specific properties\r\n * \r\n * @example\r\n * const watcher = new PropertyWatcher(model, 'selectedItem', (newVal, oldVal) => {\r\n *     console.log('Selection changed:', oldVal, '\u2192', newVal);\r\n * });\r\n */\r\nclass PropertyWatcher {\n    constructor(model, property, callback, options = {}) {\n        this.model = model;\n        this.properties = Array.isArray(property) ? property : [property];\n        this.callback = callback;\n        this.options = Object.assign({\n            immediate: false,\n            deep: false,\n            debug: false\n        }, options);\n        \n        this._handler = null;\n        this._active = false;\n        \n        this.activate();\n    }\n    \n    activate() {\n        if (this._active) return;\n        this._active = true;\n        \n        // Call immediately if requested\n        if (this.options.immediate && this.properties.length > 0) {\n            const prop = this.properties[0];\n            this.callback(this.model[prop], undefined, prop);\n        }\n        \n        // Setup change listener\n        this._handler = (e) => {\n            if (this.properties.includes(e.name)) {\n                this.callback(e.value, e.old, e.name);\n                \n                if (this.options.debug) {\n                    console.log('[PropertyWatcher] Property changed:', e.name, e.old, '\u2192', e.value);\n                }\n            }\n        };\n        \r\n        this.model.on('change', this._handler);\r\n    }\r\n    \r\n    deactivate() {\r\n        if (!this._active) return;\r\n        this._active = false;\r\n        \r\n        if (this._handler && this.model.off) {\r\n            this.model.off('change', this._handler);\r\n        }\r\n        \r\n        this._handler = null;\n    }\n\n    unwatch() {\n        this.deactivate();\n    }\n}\n\r\n/**\r\n * BindingManager - Manages multiple bindings for a control\r\n */\r\nclass BindingManager {\r\n    constructor(control) {\r\n        this.control = control;\r\n        this.binders = [];\r\n        this.computed = [];\r\n        this.watchers = [];\r\n    }\n    \n    /**\n     * Create a new binding between models\n     */\n    bind(sourceModel, targetModel, bindings, options) {\n        const binder = new ModelBinder(sourceModel, targetModel, bindings, options);\n        this.binders.push(binder);\n        return binder;\n    }\n\n    bind_value(sourceModel, sourceProp, targetModel, targetProp = sourceProp, options = {}) {\n        const bindings = {\n            [sourceProp]: Object.assign(\n                {to: targetProp},\n                options.transform ? {transform: options.transform} : {},\n                options.reverse ? {reverse: options.reverse} : {},\n                options.condition ? {condition: options.condition} : {}\n            )\n        };\n        const binder_options = {\n            bidirectional: options.bidirectional !== undefined ? options.bidirectional : !!options.reverse,\n            immediate: options.immediate !== undefined ? options.immediate : true,\n            debug: options.debug || false\n        };\n        return this.bind(sourceModel, targetModel, bindings, binder_options);\n    }\n\n    bind_collection(sourceModel, sourceProp, targetModel, targetProp = sourceProp, options = {}) {\n        const map_fn = options.map;\n        const clone = options.clone !== false;\n        const transform = (collection = []) => {\n            const arr = Array.isArray(collection) ? collection : [];\n            const mapped = map_fn ? arr.map(map_fn) : arr.slice();\n            return clone ? mapped.slice() : mapped;\n        };\n        const reverse = options.reverse_map\n            ? (collection = []) => {\n                const arr = Array.isArray(collection) ? collection : [];\n                return arr.map(options.reverse_map);\n            }\n            : undefined;\n\n        return this.bind_value(sourceModel, sourceProp, targetModel, targetProp, Object.assign({}, options, {\n            transform,\n            reverse,\n            bidirectional: options.bidirectional && !!reverse\n        }));\n    }\n    \r\n    /**\r\n     * Create a computed property\r\n     */\r\n    createComputed(model, dependencies, computeFn, options) {\r\n        const computed = new ComputedProperty(model, dependencies, computeFn, options);\r\n        this.computed.push(computed);\r\n        return computed;\r\n    }\r\n    \r\n    /**\r\n     * Watch a property for changes\r\n     */\r\n    watch(model, property, callback, options) {\r\n        const watcher = new PropertyWatcher(model, property, callback, options);\r\n        this.watchers.push(watcher);\r\n        return watcher;\r\n    }\r\n    \r\n    /**\r\n     * Cleanup all bindings\r\n     */\r\n    cleanup() {\r\n        this.binders.forEach(b => b.deactivate());\r\n        this.computed.forEach(c => c.deactivate());\r\n        this.watchers.forEach(w => w.deactivate());\r\n        \r\n        this.binders = [];\r\n        this.computed = [];\r\n        this.watchers = [];\r\n    }\r\n    \r\n    /**\r\n     * Get inspection data for all bindings\r\n     */\r\n    inspect() {\r\n        return {\r\n            binders: this.binders.map(b => b.inspect()),\r\n            computed: this.computed.map(c => ({\r\n                propertyName: c.options.propertyName,\r\n                dependencies: c.dependencies,\r\n                value: c.value\r\n            })),\r\n            watchers: this.watchers.map(w => ({\r\n                property: w.property,\r\n                active: w._active\r\n            }))\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    ModelBinder,\r\n    ComputedProperty,\r\n    PropertyWatcher,\r\n    BindingManager\r\n};\r\n", "const { tof } = require('lang-tools');\r\n\r\n/**\r\n * Transformation utilities for data binding\r\n * Provides common formatters, parsers, and validators for use in ModelBinder\r\n */\r\n\r\nconst Transformations = {\r\n    /**\r\n     * Date transformations\r\n     */\r\n    date: {\r\n        /**\r\n         * Format a Date object to ISO string\r\n         */\r\n        toISO: (date) => {\r\n            if (!date) return '';\r\n            if (date instanceof Date) return date.toISOString();\r\n            return new Date(date).toISOString();\r\n        },\r\n        \r\n        /**\r\n         * Format a Date object to locale string\r\n         */\r\n        toLocale: (date, locale = 'en-US', options = {}) => {\r\n            if (!date) return '';\r\n            if (date instanceof Date) return date.toLocaleDateString(locale, options);\r\n            return new Date(date).toLocaleDateString(locale, options);\r\n        },\r\n        \r\n        /**\r\n         * Format a Date object to custom format\r\n         */\r\n        format: (date, format = 'YYYY-MM-DD') => {\r\n            if (!date) return '';\r\n            const d = date instanceof Date ? date : new Date(date);\r\n            \r\n            const map = {\r\n                YYYY: d.getFullYear(),\r\n                MM: String(d.getMonth() + 1).padStart(2, '0'),\r\n                DD: String(d.getDate()).padStart(2, '0'),\r\n                HH: String(d.getHours()).padStart(2, '0'),\r\n                mm: String(d.getMinutes()).padStart(2, '0'),\r\n                ss: String(d.getSeconds()).padStart(2, '0')\r\n            };\r\n            \r\n            return format.replace(/YYYY|MM|DD|HH|mm|ss/g, matched => map[matched]);\r\n        },\r\n        \r\n        /**\r\n         * Parse a date string\r\n         */\r\n        parse: (str) => {\r\n            if (!str) return null;\r\n            const date = new Date(str);\r\n            return isNaN(date.getTime()) ? null : date;\r\n        },\r\n        \r\n        /**\r\n         * Parse a date from custom format\r\n         */\r\n        parseFormat: (str, format = 'YYYY-MM-DD') => {\r\n            if (!str) return null;\r\n            \r\n            const parts = {\r\n                YYYY: { start: format.indexOf('YYYY'), length: 4 },\r\n                MM: { start: format.indexOf('MM'), length: 2 },\r\n                DD: { start: format.indexOf('DD'), length: 2 }\r\n            };\r\n            \r\n            const year = parseInt(str.substr(parts.YYYY.start, parts.YYYY.length));\r\n            const month = parseInt(str.substr(parts.MM.start, parts.MM.length)) - 1;\r\n            const day = parseInt(str.substr(parts.DD.start, parts.DD.length));\r\n            \r\n            return new Date(year, month, day);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Number transformations\r\n     */\r\n    number: {\r\n        /**\r\n         * Format number to string with decimals\r\n         */\r\n        toFixed: (num, decimals = 2) => {\r\n            if (num === null || num === undefined) return '';\r\n            return Number(num).toFixed(decimals);\r\n        },\r\n        \r\n        /**\r\n         * Format number with thousands separator\r\n         */\r\n        toLocale: (num, locale = 'en-US', options = {}) => {\r\n            if (num === null || num === undefined) return '';\r\n            return Number(num).toLocaleString(locale, options);\r\n        },\r\n        \r\n        /**\r\n         * Format number as currency\r\n         */\r\n        toCurrency: (num, currency = 'USD', locale = 'en-US') => {\r\n            if (num === null || num === undefined) return '';\r\n            return Number(num).toLocaleString(locale, {\r\n                style: 'currency',\r\n                currency: currency\r\n            });\r\n        },\r\n        \r\n        /**\r\n         * Format number as percentage\r\n         */\r\n        toPercent: (num, decimals = 0) => {\r\n            if (num === null || num === undefined) return '';\r\n            return (Number(num) * 100).toFixed(decimals) + '%';\r\n        },\r\n        \r\n        /**\r\n         * Parse number from string\r\n         */\r\n        parse: (str) => {\r\n            if (str === null || str === undefined || str === '') return null;\r\n            const num = parseFloat(String(str).replace(/[^0-9.-]/g, ''));\r\n            return isNaN(num) ? null : num;\r\n        },\r\n        \r\n        /**\r\n         * Parse integer from string\r\n         */\r\n        parseInt: (str) => {\r\n            if (str === null || str === undefined || str === '') return null;\r\n            const num = parseInt(String(str).replace(/[^0-9-]/g, ''));\r\n            return isNaN(num) ? null : num;\r\n        },\r\n        \r\n        /**\r\n         * Clamp number between min and max\r\n         */\r\n        clamp: (min, max) => (num) => {\r\n            return Math.max(min, Math.min(max, Number(num)));\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * String transformations\r\n     */\r\n    string: {\r\n        /**\r\n         * Convert to uppercase\r\n         */\r\n        toUpper: (str) => {\r\n            return str ? String(str).toUpperCase() : '';\r\n        },\r\n        \r\n        /**\r\n         * Convert to lowercase\r\n         */\r\n        toLower: (str) => {\r\n            return str ? String(str).toLowerCase() : '';\r\n        },\r\n        \r\n        /**\r\n         * Capitalize first letter\r\n         */\r\n        capitalize: (str) => {\r\n            if (!str) return '';\r\n            const s = String(str);\r\n            return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();\r\n        },\r\n        \r\n        /**\r\n         * Capitalize each word\r\n         */\r\n        titleCase: (str) => {\r\n            if (!str) return '';\r\n            return String(str).split(' ')\r\n                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\r\n                .join(' ');\r\n        },\r\n        \r\n        /**\r\n         * Trim whitespace\r\n         */\r\n        trim: (str) => {\r\n            return str ? String(str).trim() : '';\r\n        },\r\n        \r\n        /**\r\n         * Truncate string to length\r\n         */\r\n        truncate: (maxLength, suffix = '...') => (str) => {\r\n            if (!str) return '';\r\n            const s = String(str);\r\n            if (s.length <= maxLength) return s;\r\n            return s.substr(0, maxLength - suffix.length) + suffix;\r\n        },\r\n        \r\n        /**\r\n         * Default value if empty\r\n         */\r\n        default: (defaultValue) => (str) => {\r\n            return str ? String(str) : defaultValue;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Boolean transformations\r\n     */\r\n    boolean: {\r\n        /**\r\n         * Convert to boolean\r\n         */\r\n        toBool: (value) => {\r\n            if (value === null || value === undefined) return false;\r\n            if (typeof value === 'boolean') return value;\r\n            if (typeof value === 'number') return value !== 0;\r\n            const str = String(value).toLowerCase();\r\n            return str === 'true' || str === '1' || str === 'yes';\r\n        },\r\n        \r\n        /**\r\n         * Convert to yes/no string\r\n         */\r\n        toYesNo: (value) => {\r\n            return Transformations.boolean.toBool(value) ? 'Yes' : 'No';\r\n        },\r\n        \r\n        /**\r\n         * Convert to on/off string\r\n         */\r\n        toOnOff: (value) => {\r\n            return Transformations.boolean.toBool(value) ? 'On' : 'Off';\r\n        },\r\n        \r\n        /**\r\n         * Invert boolean\r\n         */\r\n        not: (value) => {\r\n            return !Transformations.boolean.toBool(value);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Array transformations\r\n     */\r\n    array: {\r\n        /**\r\n         * Join array to string\r\n         */\r\n        join: (separator = ', ') => (arr) => {\r\n            if (!Array.isArray(arr)) return '';\r\n            return arr.join(separator);\r\n        },\r\n        \r\n        /**\r\n         * Get array length\r\n         */\r\n        length: (arr) => {\r\n            return Array.isArray(arr) ? arr.length : 0;\r\n        },\r\n        \r\n        /**\r\n         * Filter array\r\n         */\r\n        filter: (predicate) => (arr) => {\r\n            if (!Array.isArray(arr)) return [];\r\n            return arr.filter(predicate);\r\n        },\r\n        \r\n        /**\r\n         * Map array\r\n         */\r\n        map: (mapper) => (arr) => {\r\n            if (!Array.isArray(arr)) return [];\r\n            return arr.map(mapper);\r\n        },\r\n        \r\n        /**\r\n         * Get first element\r\n         */\r\n        first: (arr) => {\r\n            return Array.isArray(arr) && arr.length > 0 ? arr[0] : null;\r\n        },\r\n        \r\n        /**\r\n         * Get last element\r\n         */\r\n        last: (arr) => {\r\n            return Array.isArray(arr) && arr.length > 0 ? arr[arr.length - 1] : null;\r\n        },\r\n        \r\n        /**\r\n         * Sort array\r\n         */\r\n        sort: (compareFn) => (arr) => {\r\n            if (!Array.isArray(arr)) return [];\r\n            return [...arr].sort(compareFn);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Object transformations\r\n     */\r\n    object: {\r\n        /**\r\n         * Get property value\r\n         */\r\n        get: (propertyPath) => (obj) => {\r\n            if (!obj) return null;\r\n            const parts = propertyPath.split('.');\r\n            let value = obj;\r\n            for (const part of parts) {\r\n                if (value === null || value === undefined) return null;\r\n                value = value[part];\r\n            }\r\n            return value;\r\n        },\r\n        \r\n        /**\r\n         * Check if object has property\r\n         */\r\n        has: (property) => (obj) => {\r\n            return obj && obj.hasOwnProperty(property);\r\n        },\r\n        \r\n        /**\r\n         * Get object keys\r\n         */\r\n        keys: (obj) => {\r\n            return obj ? Object.keys(obj) : [];\r\n        },\r\n        \r\n        /**\r\n         * Get object values\r\n         */\r\n        values: (obj) => {\r\n            return obj ? Object.values(obj) : [];\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Compose multiple transformations\r\n     */\r\n    compose: (...fns) => {\r\n        return (value) => {\r\n            return fns.reduce((acc, fn) => fn(acc), value);\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Identity transformation (returns input unchanged)\r\n     */\r\n    identity: (value) => value,\r\n    \r\n    /**\r\n     * Default value transformation\r\n     */\r\n    defaultTo: (defaultValue) => (value) => {\r\n        return value !== null && value !== undefined ? value : defaultValue;\r\n    },\r\n    \r\n    /**\r\n     * Conditional transformation\r\n     */\r\n    when: (condition, thenTransform, elseTransform = Transformations.identity) => {\r\n        return (value) => {\r\n            return condition(value) ? thenTransform(value) : elseTransform(value);\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Create a bidirectional transformation pair\r\n     */\r\n    bidirectional: (forward, reverse) => {\r\n        return {\r\n            transform: forward,\r\n            reverse: reverse\r\n        };\r\n    }\r\n};\r\n\r\n/**\r\n * Validators - Common validation functions\r\n */\r\nconst Validators = {\r\n    /**\r\n     * Required field validator\r\n     */\r\n    required: (value) => {\r\n        if (value === null || value === undefined) return false;\r\n        if (typeof value === 'string' && value.trim() === '') return false;\r\n        if (Array.isArray(value) && value.length === 0) return false;\r\n        return true;\r\n    },\r\n    \r\n    /**\r\n     * Email validator\r\n     */\r\n    email: (value) => {\r\n        if (!value) return true; // Empty is valid, use required for mandatory\r\n        const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        return re.test(String(value));\r\n    },\r\n    \r\n    /**\r\n     * URL validator\r\n     */\r\n    url: (value) => {\r\n        if (!value) return true;\r\n        try {\r\n            new URL(value);\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Number range validator\r\n     */\r\n    range: (min, max) => (value) => {\r\n        const num = Number(value);\r\n        if (isNaN(num)) return false;\r\n        return num >= min && num <= max;\r\n    },\r\n    \r\n    /**\r\n     * String length validator\r\n     */\r\n    length: (min, max) => (value) => {\r\n        if (!value) return true;\r\n        const len = String(value).length;\r\n        return len >= min && len <= max;\r\n    },\r\n    \r\n    /**\r\n     * Pattern validator\r\n     */\r\n    pattern: (regex) => (value) => {\r\n        if (!value) return true;\r\n        return regex.test(String(value));\r\n    },\r\n    \r\n    /**\r\n     * Custom validator\r\n     */\r\n    custom: (fn) => fn\r\n};\r\n\r\nmodule.exports = {\r\n    Transformations,\r\n    Validators\r\n};\r\n", "\r\nconst Ctrl_Enh = require('./control-enh');\r\n\r\nconst {Data_Object} = require('lang-tools');\r\nconst {ModelBinder, ComputedProperty, PropertyWatcher, BindingManager} = require('./ModelBinder');\r\nconst {Transformations, Validators} = require('./Transformations');\r\n\r\n// Quite a lot of the standard controls should become this.\r\n//   It should provide mechanisms for the app to efficiently process and pass on updates at the various different stages.\r\n//   Want to work both with well defined app data models, as well has having them created simply / automatically to \r\n//     facilitate easy (to code) sharing of data between different parts of the app, and easy to code data persistance and update\r\n//     operations.\r\n\r\n// A server side data model could replay changes and then update the DB as necessary.\r\n//   Could undo changes too (if history is stored).\r\n\r\n// These two models would help a lot when it comes to the app state history.\r\n//   eg don't undo maximising and minimising windows within the app, but also have a good way to save the state (automatically essentially).\r\n\r\n\r\n// Can have fairly complex code on lower and especially mid levels, but the high level code should be simple and cleary express what's being done\r\n//   though also allowing for shorthands that would not be as readable but would be more compact.\r\n// Could maybe search and replace on building to use the shorthand forms instead, maybe even replace the functions with the\r\n//   long form names (though that would likely be a day or two's work at least)\r\n\r\nconst Control_Data = require('./Control_Data');\r\nconst Control_View = require('./Control_View');\r\nconst {ensure_control_models} = require('./control_model_factory');\r\n\r\n// Possibly not so much to do here right now???\r\n\r\n// Maybe will use this to make some other controls more concise.\r\n\r\n// Maybe make both Data_Model_View_Model_Control_Single_Value\r\n//   and Data_Model_View_Model_Control_Multi_Value_Data_Object\r\n//         so it would have properties available with string keys.\r\n//   maybe also make some kind(s) of Collection or Array holding data models.\r\n\r\n\r\n\r\n// Not totally sure what interface / conventions this should be using and expressing for the moment.\r\n//   Would like to make it really easy to base controls that have both a data model and view model on this.\r\n\r\n// May also be important sending or properly recreating the data / view model on the client-side.\r\n//   Having them made in the constructor from lang-tools classes could be effective.\r\n//     Then would be recreated automatically and identically on the client-side.\r\n\r\n// Likely do want a Data_Value subclass that represents the application's Data_Model.\r\n//   And this Data_Value subclass for the moment could just set up the functional data type as a validator.\r\n\r\n// new Data_Value(value_to_wrap, data_type);\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Both want to get this Data base type control working, as well as get the pattern well finessed to implement\r\n//   directly into a control.\r\n// Then will be able to use either.\r\n//   May then work on improved abstractions.\r\n\r\n\r\n// Will make some kind of multi-model mixin.\r\n\r\n// Data, View Data, Composition, Data Representation\r\n\r\n// Maybe there are 5 different models there.\r\n\r\n\r\n\r\n// Likely will deprecate this, and use the more complicated mixin, which currently is called in the ctrl-enh constructor.\r\n//   Will try making it available and useful at a low level, but may later restrict when it gets used / set up for perf reasons.\r\n//   However, the more complex system of multiple models may help controls to be specified and used much more easily.\r\n//     Lower and mid levels will handle complexity, high level code can be really clear and concise about the data and its\r\n//       representation using controls in the GUI.\r\n\r\n\r\n\r\n// Likely want to retire this soon...?\r\n// Possibly redo the Text_Field control or whichever controls use this for the moment.\r\n//   Though making use of the compositional model makes a lot more sense for the moment.\r\n\r\n\r\n\r\n\r\n\r\nclass Data_Model_View_Model_Control extends Ctrl_Enh {\r\n    constructor(...a) {\r\n        super(...a);\r\n\r\n        const spec = a[0] || {};\r\n        \r\n        // Initialize binding manager\r\n        this._binding_manager = new BindingManager(this);\r\n        // Possibly set up both models here, but should look out for data and view models in the spec.\r\n\r\n        // Also, look out for it in pre_activate I think. Would be good to reconnect those models here.\r\n\r\n        // Would also need to add the appropriate .dom.attributes['data-jsgui-view-model']\r\n        //                                        .dom.attributes['data-jsgui-data-model']\r\n\r\n        // \r\n        //console.log('');\r\n        //console.log('construct Data_Model_View_Model_Control');\r\n\r\n\r\n        const {context} = this;\r\n\r\n        // spec.view\r\n        // spec.data\r\n\r\n        // and would both need 'model' properties???\r\n        //   does seem best for the moment to make it really explicit.\r\n\r\n        // But then recognising and passing on changes...?\r\n        //   Should work when not activated if possible.\r\n\r\n        // Though seems like it would need a bit more code in the higher level classes.\r\n        // Possibly more in intialisation, telling it what property names to use.\r\n        //   Though could default to 'value' to allow easy sharing between 2 or more objects where it's just one\r\n        //     value that gets shared.\r\n\r\n\r\n        // Probably need to set up fields / change events on the model objects.\r\n\r\n        // Could try it with 'value' hardcoded here???\r\n\r\n        //  Or take the 'fields' in the spec???\r\n\r\n        // With the Text_Field (and Text_Input) will need to have it change the Data Model appropriately.\r\n        //   Maybe could have a decent default for it, but explicitly set it as well with a short string eg 'onexit' or 'exit' or 'leave'\r\n        // But would more likely want an 'cancel | confirm' non-modal popup, and control the positioning of that popup.\r\n        //   Likely to want it just below in this example.\r\n\r\n        // This can likely be very effective....\r\n\r\n\r\n        ensure_control_models(this, spec);\r\n\r\n        if (this.data && this.data.model) {\r\n            this.data.model.on('change', e => {\r\n                console.log('Data_Model_View_Model_Control this.data.model change e:', e);\r\n            });\r\n\r\n            if (this.dom && this.dom.attributes) {\r\n                this.dom.attributes['data-jsgui-data-model'] = this.data.model._id();\r\n            }\r\n        }\r\n\r\n        if (this.view && this.view.data && this.view.data.model) {\r\n            this.view.data.model.on('change', e => {\r\n                console.log('Data_Model_View_Model_Control this.view.data.model change e:', e);\r\n            });\r\n            if (this.dom && this.dom.attributes) {\r\n                this.dom.attributes['data-jsgui-view-data-model'] = this.view.data.model._id();\r\n            }\r\n        }\r\n\r\n        if (spec.view && spec.view.model) {\r\n            this.view.model = spec.view.model;\r\n            this.view.model.on('change', e => {\r\n                console.log('Data_Model_View_Model_Control this.view.model change e:', e);\r\n            });\r\n            if (this.dom && this.dom.attributes) {\r\n                this.dom.attributes['data-jsgui-view-model'] = this.view.model._id();\r\n            }\r\n        }\r\n\r\n        //console.log('Data_Model_View_Model_Control !!this.dom.el', !!this.dom.el);\r\n\r\n        if (this.dom.el) {\r\n\r\n            const context_keys = Array.from(Object.keys(this.context));\r\n            //console.log('context_keys', context_keys);\r\n\r\n            const context_map_controls_keys = Array.from(Object.keys(this.context.map_controls));\r\n            //console.log('context_map_controls_keys', context_map_controls_keys);\r\n\r\n            if (this.dom.el.hasAttribute('data-jsgui-data-model')) {\r\n                const data_model_jsgui_id = this.dom.el.getAttribute('data-jsgui-data-model');\r\n\r\n                //console.log('Data_Model_View_Model_Control data_model_jsgui_id:', data_model_jsgui_id);\r\n\r\n                const data_model = this.context.map_controls[data_model_jsgui_id];\r\n\r\n                //console.log('Data_Model_View_Model_Control !!data_model', !!data_model);\r\n\r\n                if (data_model) {\r\n                    this.data = this.data || new Control_Data({context});\r\n\r\n                    //console.log('Data_Model_View_Model_Control pre assign this.data.model');\r\n                    //console.log('data_model', data_model);\r\n                    this.data.model = data_model;\r\n                    //console.log('post assign this.data.model\\n');\r\n\r\n                    // Then set up the syncing here????\r\n\r\n                    //   If the data model changes, set the .value field....?\r\n\r\n\r\n                    data_model.on('change', e => {\r\n                        //console.log('Data_Model_View_Model_Control data_model change', e);\r\n                    })\r\n                }\r\n            }\r\n\r\n\r\n            // And if it does not have that attribute, create its own internal view model.\r\n\r\n\r\n\r\n\r\n            if (this.dom.el.hasAttribute('data-jsgui-view-model')) {\r\n                this.view = this.view || new Control_View({context});\r\n                const view_model_jsgui_id = this.dom.el.getAttribute('data-jsgui-view-model');\r\n\r\n                //console.log('Data_Model_View_Model_Control view_model_jsgui_id:', view_model_jsgui_id);\r\n\r\n                // then get it from the context.\r\n\r\n                const view_model = this.context.map_controls[view_model_jsgui_id];\r\n\r\n                if (!!view_model) {\r\n                    this.view.model = view_model;\r\n\r\n                    view_model.on('change', e => {\r\n                        //console.log('Data_Model_View_Model_Control view_model change', e);\r\n                    });\r\n                } else {\r\n                    //console.log('Data_Model_View_Model_Control missing view_model (not found at this.context.map_controls[view_model_jsgui_id])');\r\n                }\r\n\r\n                \r\n                \r\n\r\n                // Load the view model at the very beginning???\r\n\r\n\r\n                // But in the activated part it would need to change the model???\r\n                //   Not necessarily.\r\n                //   It could change that in respond to the field changing.\r\n                //     Then would change the view model in response to the that data model change.\r\n                //     Then would update the DOM in response to the view model change (would have to be the responsibility of the\r\n                //       specific control I think???)\r\n\r\n                \r\n\r\n\r\n            } else {\r\n                //console.log('Data_Model_View_Model_Control with el lacks view model, need to make one');\r\n                this.view = this.view || {};\r\n                this.view.model = new Data_Object({\r\n                    context\r\n                });\r\n\r\n\r\n\r\n            }\r\n        }\r\n    }\r\n    pre_activate() {\r\n        super.pre_activate();\r\n\r\n\r\n        // re-assign the .data.model and .view.model if they are available....\r\n\r\n        // These models would need to exist within the Page_Context.\r\n        //   That probably should be the case, working isomorphically.\r\n        //     Model creation would be within the Page_Context.\r\n\r\n\r\n\r\n\r\n\r\n        console.log('Data_Model_View_Model_Control pre_activate complete');\r\n\r\n        // should be able to access own data_model???\r\n\r\n\r\n    }\r\n    \r\n    /**\r\n     * Create a binding between data model and view model\r\n     * @param {Object} bindings - Property binding definitions\r\n     * @param {Object} options - Binding options\r\n     * @example\r\n     * this.bind({\r\n     *     'date': {\r\n     *         to: 'formattedDate',\r\n     *         transform: (date) => formatDate(date, 'YYYY-MM-DD'),\r\n     *         reverse: (str) => parseDate(str)\r\n     *     }\r\n     * });\r\n     */\r\n    bind(bindings, options = {}) {\r\n        if (!this.data || !this.data.model) {\r\n            console.warn('Data_Model_View_Model_Control.bind: No data.model available');\r\n            return null;\r\n        }\r\n        \r\n        if (!this.view || !this.view.data || !this.view.data.model) {\r\n            console.warn('Data_Model_View_Model_Control.bind: No view.data.model available');\r\n            return null;\r\n        }\r\n        \r\n        return this._binding_manager.bind(\r\n            this.data.model,\r\n            this.view.data.model,\r\n            bindings,\r\n            options\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Create a computed property on a model\r\n     * @param {Object} model - Target model (data.model or view.data.model)\r\n     * @param {Array|string} dependencies - Property names to watch\r\n     * @param {Function} computeFn - Function to compute the value\r\n     * @param {Object} options - Options including propertyName\r\n     * @example\r\n     * this.computed(this.view.data.model, ['firstName', 'lastName'], \r\n     *     (first, last) => `${first} ${last}`,\r\n     *     { propertyName: 'fullName' }\r\n     * );\r\n     */\r\n    computed(model, dependencies, computeFn, options = {}) {\r\n        return this._binding_manager.createComputed(model, dependencies, computeFn, options);\r\n    }\r\n    \r\n    /**\r\n     * Watch a property for changes\r\n     * @param {Object} model - Model to watch\r\n     * @param {string} property - Property name to watch\r\n     * @param {Function} callback - Callback function (newVal, oldVal) => void\r\n     * @param {Object} options - Watch options\r\n     * @example\r\n     * this.watch(this.data.model, 'selectedItem', (newVal, oldVal) => {\r\n     *     console.log('Selection changed:', oldVal, '\u2192', newVal);\r\n     * });\r\n     */\r\n    watch(model, property, callback, options = {}) {\r\n        return this._binding_manager.watch(model, property, callback, options);\r\n    }\r\n    \r\n    /**\r\n     * Get transformations library\r\n     */\r\n    get transforms() {\r\n        return Transformations;\r\n    }\r\n    \r\n    /**\r\n     * Get validators library\r\n     */\r\n    get validators() {\r\n        return Validators;\r\n    }\r\n    \r\n    /**\r\n     * Inspect all bindings for debugging\r\n     */\r\n    inspectBindings() {\r\n        return this._binding_manager.inspect();\r\n    }\r\n    \r\n    /**\r\n     * Cleanup bindings when control is destroyed\r\n     */\r\n    destroy() {\r\n        if (this._binding_manager) {\r\n            this._binding_manager.cleanup();\r\n        }\r\n        if (super.destroy) {\r\n            super.destroy();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Data_Model_View_Model_Control;\r\n", "//var Control = require('./control-enh');\r\n\r\n\r\nconst Control = require('./Data_Model_View_Model_Control');\r\n\r\nmodule.exports = Control;", "var jsgui = require('lang-tools');\r\nvar each = jsgui.each;\r\nvar tof = jsgui.tof;\r\nconst Control = require('./control');\r\n\r\n// Selection takes place within a view of a document.\r\n//   At least this code does not look too HTML specific.\r\n\r\nclass Selection_Scope extends jsgui.Data_Object {\r\n\t//var Selection_Scope = jsgui.Class.extend({\r\n\tconstructor(spec) {\r\n\t\tsuper(spec);\r\n\t\tif (spec.context) this.context = spec.context;\r\n\t\tif (typeof spec.id !== 'undefined') this.id = spec.id;\r\n\t\tif (spec.ctrl) this.control = spec.ctrl;\r\n\t\tif (spec.control) this.control = spec.control;\r\n\t\t// Needs to be a list / map of all controls that are selected.\r\n\t\t// map of selected controls by id?\r\n\t\t//  also need to be able to go through the list of controls.\r\n\t\tthis.map_selected_controls = {};\r\n\t\t// set the items by their id to point to the control.\r\n\t\t//  the control will know its index within its parent, can look up more info there.\r\n\t}\r\n\t'select_only'(ctrl, silent = false) {\r\n\t\tvar currently_selected;\r\n\t\tvar count_deselected = 0;\r\n\t\tvar selected;\r\n\t\t//console.log('select_only this.map_selected_controls', this.map_selected_controls);\r\n\t\teach(this.map_selected_controls, (v, i) => {\r\n\t\t\t// Don't want to select the selection scope itself.\r\n\t\t\tif (v && v !== ctrl && v !== this.control) {\r\n\t\t\t\tif (v.selected) {\r\n\t\t\t\t\tv.selected = false;\r\n\t\t\t\t\t//v.remove_class('selected');\r\n\t\t\t\t\tcount_deselected++;\r\n\t\t\t\t}\r\n\t\t\t\t//console.log('should have deselcted ' + v._id())\r\n\t\t\t}\r\n\t\t\t//console.log('v !== this.control', v !== this.control);\r\n\t\t\tif (v === ctrl && v !== this.control) {\r\n\t\t\t\tcurrently_selected = v.selected;\r\n\t\t\t\t//v.add_class('selected');\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.map_selected_controls = {};\r\n\t\tif (typeof ctrl._id === 'function') {\r\n\t\t\tthis.map_selected_controls[ctrl._id()] = ctrl;\r\n\t\t} else {\r\n\t\t\t//console.log('typeof ctrl._id', typeof ctrl._id);\r\n\t\t}\r\n\t\t// and then tell the control that it's selected.\r\n\t\t// could possibly set a CSS flag.\r\n\t\t//console.log('currently_selected', currently_selected);\r\n\r\n\t\tif (!currently_selected) {\r\n\t\t\tctrl.selected = true;\r\n\t\t\tif (!silent) {\r\n\t\t\t\tthis.raise('change', {\r\n\t\t\t\t\tname: 'selected',\r\n\t\t\t\t\tvalue: ctrl\r\n\t\t\t\t});\r\n\t\t\t\tctrl.raise('select');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (count_deselected > 0 & !currently_selected) {\r\n\t\t\t//this.raise('change');\r\n\t\t}\r\n\t}\r\n\t'deselect_all'(silent = false) {\r\n\t\t//console.log('this.map_selected_controls', this.map_selected_controls);\r\n\t\teach(this.map_selected_controls, (v, i) => {\r\n\t\t\t// Don't want to select the selection scope itself.\r\n\t\t\tif (v) {\r\n\t\t\t\tif (v.selected) {\r\n\t\t\t\t\tv.selected = false;\r\n\t\t\t\t\t//count_deselected++;\r\n\t\t\t\t\tv.raise('deselect');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (!silent) {\r\n\t\t\tthis.raise('change', {\r\n\t\t\t\tname: 'selected',\r\n\t\t\t\tvalue: undefined\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tthis.map_selected_controls = {};\r\n\t}\r\n\t'deselect'(ctrl, silent = false) {\r\n\t\tif (ctrl.selected === true) {\r\n\t\t\tctrl.selected = false;\r\n\t\t\t\r\n\t\t}\r\n\t\tif (!silent) {\r\n\t\t\tctrl.raise('deselected');\r\n\t\t\tthis.raise('change', {\r\n\t\t\t\tname: 'selected',\r\n\t\t\t\tmap_selected_controls: this.map_selected_controls\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t'select'(ctrl, silent = false) {\r\n\t\tif (!ctrl.selected) {\r\n\t\t\tctrl.selected = true;\r\n\t\t\t\r\n\t\t}\r\n\t\tif (!silent) {\r\n\t\t\tctrl.raise('selected');\r\n\t\t\tthis.raise('change', {\r\n\t\t\t\tname: 'selected',\r\n\t\t\t\tmap_selected_controls: this.map_selected_controls\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// deselect controls internal to a control.\r\n\r\n\t// When selecting a control, we want to make it so that controls inside it, in the same selection context are not selected.\r\n\t//  The Selection Scope does a fair bit of the management of the selections.\r\n\r\n\t'deselect_ctrl_content'(ctrl, silent = false) {\r\n\t\t//var cs = ctrl.get('selection_scope');\r\n\t\tvar cs = ctrl.selection_scope;\r\n\t\tvar msc = this.map_selected_controls;\r\n\t\t//var that = this;\r\n\t\tctrl.content.each(v => {\r\n\t\t\t//var tv = tof(v);\r\n\t\t\tif (v instanceof Control) {\r\n\t\t\t\tv.selected = false;\r\n\t\t\t\tvar id = v._id();\r\n\t\t\t\tif (msc[id]) msc[id] = false;\r\n\t\t\t\tthis.deselect_ctrl_content(v);\r\n\t\t\t\tif (!silent) v.raise('deselected');\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (!silent) {\r\n\t\t\tthis.raise('change', {\r\n\t\t\t\tname: 'selected',\r\n\t\t\t\tmap_selected_controls: this.map_selected_controls\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t//throw 'stop';\r\n\t}\r\n\t'select_toggle'(ctrl, silent = false) {\r\n\t\tvar sel = ctrl.selected;\r\n\t\t//console.log('tof(sel) ' + tof(sel));\r\n\t\tvar msc = this.map_selected_controls;\r\n\t\tvar id = ctrl._id();\r\n\t\tif (!sel) {\r\n\t\t\tvar sel_anc = ctrl.find_selected_ancestor_in_scope();\r\n\t\t\tif (sel_anc) {\r\n\t\t\t\tconsole.log('1) not selecting because a selected ancestor in the selection scope has been found.');\r\n\t\t\t} else {\r\n\t\t\t\tctrl.selected = true;\r\n\t\t\t\t// Check for a selected ancestor control in the scope.\r\n\t\t\t\tthis.deselect_ctrl_content(ctrl, silent);\r\n\t\t\t\tmsc[id] = ctrl;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar tsel = tof(sel);\r\n\t\t\t//console.log('tsel ' + (tsel))\r\n\t\t\t/*\r\n\t\t\tif (tsel == 'data_value') {\r\n\t\t\t\tvar val = sel.get();\r\n\t\t\t\t//console.log('val ' + val);\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tctrl.selected = false;\r\n\t\t\t\t\tmsc[id] = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar sel_anc = ctrl.find_selected_ancestor_in_scope();\r\n\t\t\t\t\tif (sel_anc) {\r\n\t\t\t\t\t\tconsole.log('2) not selecting because a selected ancestor in the selection scope has been found.');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctrl.selected = true;\r\n\t\t\t\t\t\tthis.deselect_ctrl_content(ctrl, silent);\r\n\t\t\t\t\t\tmsc[id] = ctrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tif (tsel === 'boolean') {\r\n\t\t\t\tif (sel) {\r\n\t\t\t\t\t//ctrl.remove_class('selected');\r\n\t\t\t\t\tctrl.selected = false;\r\n\t\t\t\t\tmsc[id] = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar sel_anc = ctrl.find_selected_ancestor_in_scope();\r\n\t\t\t\t\tif (sel_anc) {\r\n\t\t\t\t\t\tconsole.log('2) not selecting because a selected ancestor in the selection scope has been found.');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.deselect_ctrl_content(ctrl, silent);\r\n\t\t\t\t\t\tctrl.selected = true;\r\n\t\t\t\t\t\tmsc[id] = ctrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!silent) {\r\n\t\t\tthis.raise('change');\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports = Selection_Scope;", "const jsgui = require('lang-tools');\r\nconst {each, tof, is_defined, get_a_sig, Evented_Class, Data_Model} = jsgui;\r\nconst Selection_Scope = require('./selection-scope');\r\nclass Page_Context extends Evented_Class {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        super(spec);\r\n        if (spec.browser_info) {\r\n            this.browser_info = spec.browser_info;\r\n        };\r\n        if (spec.resource_pool) {\r\n            this.resource_pool = spec.resource_pool;\r\n        }\r\n        this.get_vector_methodology = function () {\r\n            if (this.browser_info.ie) {\r\n                return 'vml';\r\n            } else {\r\n                return 'svg';\r\n            }\r\n        };\r\n        this.selection_scopes = {};\r\n        this.selection_scope_id_counter = 0;\r\n        var map_new_ids = {};\r\n        var map_objects = {};\r\n        var _get_new_typed_object_id = (type_name) => {\r\n            if (!is_defined(map_new_ids[type_name])) {\r\n                map_new_ids[type_name] = 0;\r\n            }\r\n            var res = type_name + '_' + map_new_ids[type_name];\r\n            map_new_ids[type_name]++;\r\n            return res;\r\n        }\r\n        this.new_id = _get_new_typed_object_id;\r\n        this.set_max_ids = (map_max_ids) => {\r\n            each(map_max_ids, (v, i) => {\r\n                map_new_ids[i] = v + 1;\r\n            })\r\n        }\r\n        var map_Controls = this.map_Controls = {};\r\n        var map_controls = this.map_controls = {};\r\n        this.map_data_models = this.map_data_models || {};\r\n        this.map_data_model_iids = this.map_data_model_iids || {};\r\n        this.map_control_iids = {};\r\n        this.next_iid = 1;\r\n    }\r\n    'new_selection_scope'(ctrl) {\r\n        var res = new Selection_Scope({\r\n            'context': this,\r\n            'id': this.selection_scope_id_counter++,\r\n            'ctrl': ctrl\r\n        })\r\n        this.selection_scopes[res.id] = res;\r\n        if (ctrl) {\r\n            ctrl.selection_scope = res;\r\n            if (typeof document === 'undefined') {\r\n                ctrl._fields = ctrl._fields || {};\r\n                ctrl._fields.selection_scope = res.id;\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n    'make' (source) {\r\n        let t_source = tof(source);\r\n        if (t_source === 'string') {\r\n            let parsed = jsgui.parse_and_mount(source, this);\r\n        }\r\n    }\r\n    'update_Controls' () {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        if (sig === '[o]') {\r\n            var o = a[0];\r\n            var map_Controls = this.map_Controls;\r\n            each(o, (name, Constructor) => {\r\n                name = name.toLowerCase();\r\n                map_Controls[name] = Constructor;\r\n            });\r\n        }\r\n        if (sig === '[s,f]') {\r\n            var name = a[0];\r\n            var Constructor = a[1];\r\n            name = name.toLowerCase();\r\n            this.map_Controls[name] = Constructor;\r\n        }\r\n    }\r\n    'register_control' (control) {\r\n        control.context = this;\r\n        var id = control._id();\r\n        this.map_controls[id] = control;\r\n        control.iid = this.next_iid;\r\n        this.map_control_iids[id] = this.next_iid++;\r\n    }\r\n    register_data_model(data_model) {\r\n        if (data_model instanceof Data_Model) {\r\n            const id = data_model._id();\r\n            this.map_data_models[id] = data_model;\r\n            data_model.iid = this.next_iid;\r\n            this.map_data_model_iids[id] = this.next_iid++;\r\n        } else {\r\n            console.trace();\r\n            throw 'Expected Data_Model instance';\r\n        }\r\n    }\r\n    'first_ctrl_matching_type' (type_name) {\r\n        var res;\r\n        each(this.map_controls, (ctrl, ctrl_id, fn_stop) => {\r\n            if (ctrl.__type_name === type_name) {\r\n                fn_stop();\r\n                res = ctrl;\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n}\r\nmodule.exports = Page_Context;", "/***********************************************\nCopyright 2010, 2011, Chris Winberry <chris@winberry.net>. All rights reserved.\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to\ndeal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or\nsell copies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\nIN THE SOFTWARE.\n***********************************************/\n/* v1.7.6 */\n\n(function () {\n\nfunction runningInNode () {\n\treturn(\n\t\t(typeof require) == \"function\"\n\t\t&&\n\t\t(typeof exports) == \"object\"\n\t\t&&\n\t\t(typeof module) == \"object\"\n\t\t&&\n\t\t(typeof __filename) == \"string\"\n\t\t&&\n\t\t(typeof __dirname) == \"string\"\n\t\t);\n}\n\nif (!runningInNode()) {\n\tif (!this.Tautologistics)\n\t\tthis.Tautologistics = {};\n\telse if (this.Tautologistics.NodeHtmlParser)\n\t\treturn; //NodeHtmlParser already defined!\n\tthis.Tautologistics.NodeHtmlParser = {};\n\texports = this.Tautologistics.NodeHtmlParser;\n}\n\n//Types of elements found in the DOM\nvar ElementType = {\n\t  Text: \"text\" //Plain text\n\t, Directive: \"directive\" //Special tag <!...>\n\t, Comment: \"comment\" //Special tag <!--...-->\n\t, Script: \"script\" //Special tag <script>...</script>\n\t, Style: \"style\" //Special tag <style>...</style>\n\t, Tag: \"tag\" //Any tag that isn't special\n}\n\nfunction Parser (handler, options) {\n\tthis._options = options ? options : { };\n\tif (this._options.includeLocation == undefined) {\n\t\tthis._options.includeLocation = false; //Do not track element position in document by default\n\t}\n\n\tthis.validateHandler(handler);\n\tthis._handler = handler;\n\tthis.reset();\n}\n\n\t//**\"Static\"**//\n\t//Regular expressions used for cleaning up and parsing (stateless)\n\tParser._reTrim = /(^\\s+|\\s+$)/g; //Trim leading/trailing whitespace\n\tParser._reTrimComment = /(^\\!--|--$)/g; //Remove comment tag markup from comment contents\n\tParser._reWhitespace = /\\s/g; //Used to find any whitespace to split on\n\tParser._reTagName = /^\\s*(\\/?)\\s*([^\\s\\/]+)/; //Used to find the tag name for an element\n\n\t//Regular expressions used for parsing (stateful)\n\tParser._reAttrib = //Find attributes in a tag\n\t\t/([^=<>\\\"\\'\\s]+)\\s*=\\s*\"([^\"]*)\"|([^=<>\\\"\\'\\s]+)\\s*=\\s*'([^']*)'|([^=<>\\\"\\'\\s]+)\\s*=\\s*([^'\"\\s]+)|([^=<>\\\"\\'\\s\\/]+)/g;\n\tParser._reTags = /[\\<\\>]/g; //Find tag markers\n\n\t//**Public**//\n\t//Methods//\n\t//Parses a complete HTML and pushes it to the handler\n\tParser.prototype.parseComplete = function Parser$parseComplete (data) {\n\t\tthis.reset();\n\t\tthis.parseChunk(data);\n\t\tthis.done();\n\t}\n\n\t//Parses a piece of an HTML document\n\tParser.prototype.parseChunk = function Parser$parseChunk (data) {\n\t\tif (this._done)\n\t\t\tthis.handleError(new Error(\"Attempted to parse chunk after parsing already done\"));\n\t\tthis._buffer += data; //FIXME: this can be a bottleneck\n\t\tthis.parseTags();\n\t}\n\n\t//Tells the parser that the HTML being parsed is complete\n\tParser.prototype.done = function Parser$done () {\n\t\tif (this._done)\n\t\t\treturn;\n\t\tthis._done = true;\n\t\n\t\t//Push any unparsed text into a final element in the element list\n\t\tif (this._buffer.length) {\n\t\t\tvar rawData = this._buffer;\n\t\t\tthis._buffer = \"\";\n\t\t\tvar element = {\n\t\t\t\t  raw: rawData\n\t\t\t\t, data: (this._parseState == ElementType.Text) ? rawData : rawData.replace(Parser._reTrim, \"\")\n\t\t\t\t, type: this._parseState\n\t\t\t\t};\n\t\t\tif (this._parseState == ElementType.Tag || this._parseState == ElementType.Script || this._parseState == ElementType.Style)\n\t\t\t\telement.name = this.parseTagName(element.data);\n\t\t\tthis.parseAttribs(element);\n\t\t\tthis._elements.push(element);\n\t\t}\n\t\n\t\tthis.writeHandler();\n\t\tthis._handler.done();\n\t}\n\n\t//Resets the parser to a blank state, ready to parse a new HTML document\n\tParser.prototype.reset = function Parser$reset () {\n\t\tthis._buffer = \"\";\n\t\tthis._done = false;\n\t\tthis._elements = [];\n\t\tthis._elementsCurrent = 0;\n\t\tthis._current = 0;\n\t\tthis._next = 0;\n\t\tthis._location = {\n\t\t\t  row: 0\n\t\t\t, col: 0\n\t\t\t, charOffset: 0\n\t\t\t, inBuffer: 0\n\t\t};\n\t\tthis._parseState = ElementType.Text;\n\t\tthis._prevTagSep = '';\n\t\tthis._tagStack = [];\n\t\tthis._handler.reset();\n\t}\n\t\n\t//**Private**//\n\t//Properties//\n\tParser.prototype._options = null; //Parser options for how to behave\n\tParser.prototype._handler = null; //Handler for parsed elements\n\tParser.prototype._buffer = null; //Buffer of unparsed data\n\tParser.prototype._done = false; //Flag indicating whether parsing is done\n\tParser.prototype._elements =  null; //Array of parsed elements\n\tParser.prototype._elementsCurrent = 0; //Pointer to last element in _elements that has been processed\n\tParser.prototype._current = 0; //Position in data that has already been parsed\n\tParser.prototype._next = 0; //Position in data of the next tag marker (<>)\n\tParser.prototype._location = null; //Position tracking for elements in a stream\n\tParser.prototype._parseState = ElementType.Text; //Current type of element being parsed\n\tParser.prototype._prevTagSep = ''; //Previous tag marker found\n\t//Stack of element types previously encountered; keeps track of when\n\t//parsing occurs inside a script/comment/style tag\n\tParser.prototype._tagStack = null;\n\n\t//Methods//\n\t//Takes an array of elements and parses any found attributes\n\tParser.prototype.parseTagAttribs = function Parser$parseTagAttribs (elements) {\n\t\tvar idxEnd = elements.length;\n\t\tvar idx = 0;\n\t\n\t\twhile (idx < idxEnd) {\n\t\t\tvar element = elements[idx++];\n\t\t\tif (element.type == ElementType.Tag || element.type == ElementType.Script || element.type == ElementType.style)\n\t\t\t\tthis.parseAttribs(element);\n\t\t}\n\t\n\t\treturn(elements);\n\t}\n\n\t//Takes an element and adds an \"attribs\" property for any element attributes found \n\tParser.prototype.parseAttribs = function Parser$parseAttribs (element) {\n\t\t//Only parse attributes for tags\n\t\tif (element.type != ElementType.Script && element.type != ElementType.Style && element.type != ElementType.Tag)\n\t\t\treturn;\n\t\n\t\tvar tagName = element.data.split(Parser._reWhitespace, 1)[0];\n\t\tvar attribRaw = element.data.substring(tagName.length);\n\t\tif (attribRaw.length < 1)\n\t\t\treturn;\n\t\n\t\tvar match;\n\t\tParser._reAttrib.lastIndex = 0;\n\t\twhile (match = Parser._reAttrib.exec(attribRaw)) {\n\t\t\tif (element.attribs == undefined)\n\t\t\t\telement.attribs = {};\n\t\n\t\t\tif (typeof match[1] == \"string\" && match[1].length) {\n\t\t\t\telement.attribs[match[1]] = match[2];\n\t\t\t} else if (typeof match[3] == \"string\" && match[3].length) {\n\t\t\t\telement.attribs[match[3].toString()] = match[4].toString();\n\t\t\t} else if (typeof match[5] == \"string\" && match[5].length) {\n\t\t\t\telement.attribs[match[5]] = match[6];\n\t\t\t} else if (typeof match[7] == \"string\" && match[7].length) {\n\t\t\t\telement.attribs[match[7]] = match[7];\n\t\t\t}\n\t\t}\n\t}\n\n\t//Extracts the base tag name from the data value of an element\n\tParser.prototype.parseTagName = function Parser$parseTagName (data) {\n\t\tif (data == null || data == \"\")\n\t\t\treturn(\"\");\n\t\tvar match = Parser._reTagName.exec(data);\n\t\tif (!match)\n\t\t\treturn(\"\");\n\t\treturn((match[1] ? \"/\" : \"\") + match[2]);\n\t}\n\n\t//Parses through HTML text and returns an array of found elements\n\t//I admit, this function is rather large but splitting up had an noticeable impact on speed\n\tParser.prototype.parseTags = function Parser$parseTags () {\n\t\tvar bufferEnd = this._buffer.length - 1;\n\t\twhile (Parser._reTags.test(this._buffer)) {\n\t\t\tthis._next = Parser._reTags.lastIndex - 1;\n\t\t\tvar tagSep = this._buffer.charAt(this._next); //The currently found tag marker\n\t\t\tvar rawData = this._buffer.substring(this._current, this._next); //The next chunk of data to parse\n\t\n\t\t\t//A new element to eventually be appended to the element list\n\t\t\tvar element = {\n\t\t\t\t  raw: rawData\n\t\t\t\t, data: (this._parseState == ElementType.Text) ? rawData : rawData.replace(Parser._reTrim, \"\")\n\t\t\t\t, type: this._parseState\n\t\t\t};\n\t\n\t\t\tvar elementName = this.parseTagName(element.data);\n\t\n\t\t\t//This section inspects the current tag stack and modifies the current\n\t\t\t//element if we're actually parsing a special area (script/comment/style tag)\n\t\t\tif (this._tagStack.length) { //We're parsing inside a script/comment/style tag\n\t\t\t\tif (this._tagStack[this._tagStack.length - 1] == ElementType.Script) { //We're currently in a script tag\n\t\t\t\t\tif (elementName.toLowerCase() == \"/script\") //Actually, we're no longer in a script tag, so pop it off the stack\n\t\t\t\t\t\tthis._tagStack.pop();\n\t\t\t\t\telse { //Not a closing script tag\n\t\t\t\t\t\tif (element.raw.indexOf(\"!--\") != 0) { //Make sure we're not in a comment\n\t\t\t\t\t\t\t//All data from here to script close is now a text element\n\t\t\t\t\t\t\telement.type = ElementType.Text;\n\t\t\t\t\t\t\t//If the previous element is text, append the current text to it\n\t\t\t\t\t\t\tif (this._elements.length && this._elements[this._elements.length - 1].type == ElementType.Text) {\n\t\t\t\t\t\t\t\tvar prevElement = this._elements[this._elements.length - 1];\n\t\t\t\t\t\t\t\tprevElement.raw = prevElement.data = prevElement.raw + this._prevTagSep + element.raw;\n\t\t\t\t\t\t\t\telement.raw = element.data = \"\"; //This causes the current element to not be added to the element list\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this._tagStack[this._tagStack.length - 1] == ElementType.Style) { //We're currently in a style tag\n\t\t\t\t\tif (elementName.toLowerCase() == \"/style\") //Actually, we're no longer in a style tag, so pop it off the stack\n\t\t\t\t\t\tthis._tagStack.pop();\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (element.raw.indexOf(\"!--\") != 0) { //Make sure we're not in a comment\n\t\t\t\t\t\t\t//All data from here to style close is now a text element\n\t\t\t\t\t\t\telement.type = ElementType.Text;\n\t\t\t\t\t\t\t//If the previous element is text, append the current text to it\n\t\t\t\t\t\t\tif (this._elements.length && this._elements[this._elements.length - 1].type == ElementType.Text) {\n\t\t\t\t\t\t\t\tvar prevElement = this._elements[this._elements.length - 1];\n\t\t\t\t\t\t\t\tif (element.raw != \"\") {\n\t\t\t\t\t\t\t\t\tprevElement.raw = prevElement.data = prevElement.raw + this._prevTagSep + element.raw;\n\t\t\t\t\t\t\t\t\telement.raw = element.data = \"\"; //This causes the current element to not be added to the element list\n\t\t\t\t\t\t\t\t} else { //Element is empty, so just append the last tag marker found\n\t\t\t\t\t\t\t\t\tprevElement.raw = prevElement.data = prevElement.raw + this._prevTagSep;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else { //The previous element was not text\n\t\t\t\t\t\t\t\tif (element.raw != \"\") {\n\t\t\t\t\t\t\t\t\telement.raw = element.data = element.raw;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this._tagStack[this._tagStack.length - 1] == ElementType.Comment) { //We're currently in a comment tag\n\t\t\t\t\tvar rawLen = element.raw.length;\n\t\t\t\t\tif (element.raw.charAt(rawLen - 2) == \"-\" && element.raw.charAt(rawLen - 1) == \"-\" && tagSep == \">\") {\n\t\t\t\t\t\t//Actually, we're no longer in a style tag, so pop it off the stack\n\t\t\t\t\t\tthis._tagStack.pop();\n\t\t\t\t\t\t//If the previous element is a comment, append the current text to it\n\t\t\t\t\t\tif (this._elements.length && this._elements[this._elements.length - 1].type == ElementType.Comment) {\n\t\t\t\t\t\t\tvar prevElement = this._elements[this._elements.length - 1];\n\t\t\t\t\t\t\tprevElement.raw = prevElement.data = (prevElement.raw + element.raw).replace(Parser._reTrimComment, \"\");\n\t\t\t\t\t\t\telement.raw = element.data = \"\"; //This causes the current element to not be added to the element list\n\t\t\t\t\t\t\telement.type = ElementType.Text;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse //Previous element not a comment\n\t\t\t\t\t\t\telement.type = ElementType.Comment; //Change the current element's type to a comment\n\t\t\t\t\t}\n\t\t\t\t\telse { //Still in a comment tag\n\t\t\t\t\t\telement.type = ElementType.Comment;\n\t\t\t\t\t\t//If the previous element is a comment, append the current text to it\n\t\t\t\t\t\tif (this._elements.length && this._elements[this._elements.length - 1].type == ElementType.Comment) {\n\t\t\t\t\t\t\tvar prevElement = this._elements[this._elements.length - 1];\n\t\t\t\t\t\t\tprevElement.raw = prevElement.data = prevElement.raw + element.raw + tagSep;\n\t\t\t\t\t\t\telement.raw = element.data = \"\"; //This causes the current element to not be added to the element list\n\t\t\t\t\t\t\telement.type = ElementType.Text;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\telement.raw = element.data = element.raw + tagSep;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t//Processing of non-special tags\n\t\t\tif (element.type == ElementType.Tag) {\n\t\t\t\telement.name = elementName;\n\t\t\t\tvar elementNameCI = elementName.toLowerCase();\n\t\t\t\t\n\t\t\t\tif (element.raw.indexOf(\"!--\") == 0) { //This tag is really comment\n\t\t\t\t\telement.type = ElementType.Comment;\n\t\t\t\t\tdelete element[\"name\"];\n\t\t\t\t\tvar rawLen = element.raw.length;\n\t\t\t\t\t//Check if the comment is terminated in the current element\n\t\t\t\t\tif (element.raw.charAt(rawLen - 1) == \"-\" && element.raw.charAt(rawLen - 2) == \"-\" && tagSep == \">\")\n\t\t\t\t\t\telement.raw = element.data = element.raw.replace(Parser._reTrimComment, \"\");\n\t\t\t\t\telse { //It's not so push the comment onto the tag stack\n\t\t\t\t\t\telement.raw += tagSep;\n\t\t\t\t\t\tthis._tagStack.push(ElementType.Comment);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (element.raw.indexOf(\"!\") == 0 || element.raw.indexOf(\"?\") == 0) {\n\t\t\t\t\telement.type = ElementType.Directive;\n\t\t\t\t\t//TODO: what about CDATA?\n\t\t\t\t}\n\t\t\t\telse if (elementNameCI == \"script\") {\n\t\t\t\t\telement.type = ElementType.Script;\n\t\t\t\t\t//Special tag, push onto the tag stack if not terminated\n\t\t\t\t\tif (element.data.charAt(element.data.length - 1) != \"/\")\n\t\t\t\t\t\tthis._tagStack.push(ElementType.Script);\n\t\t\t\t}\n\t\t\t\telse if (elementNameCI == \"/script\")\n\t\t\t\t\telement.type = ElementType.Script;\n\t\t\t\telse if (elementNameCI == \"style\") {\n\t\t\t\t\telement.type = ElementType.Style;\n\t\t\t\t\t//Special tag, push onto the tag stack if not terminated\n\t\t\t\t\tif (element.data.charAt(element.data.length - 1) != \"/\")\n\t\t\t\t\t\tthis._tagStack.push(ElementType.Style);\n\t\t\t\t}\n\t\t\t\telse if (elementNameCI == \"/style\")\n\t\t\t\t\telement.type = ElementType.Style;\n\t\t\t\tif (element.name && element.name.charAt(0) == \"/\")\n\t\t\t\t\telement.data = element.name;\n\t\t\t}\n\t\n\t\t\t//Add all tags and non-empty text elements to the element list\n\t\t\tif (element.raw != \"\" || element.type != ElementType.Text) {\n\t\t\t\tif (this._options.includeLocation && !element.location) {\n\t\t\t\t\telement.location = this.getLocation(element.type == ElementType.Tag);\n\t\t\t\t}\n\t\t\t\tthis.parseAttribs(element);\n\t\t\t\tthis._elements.push(element);\n\t\t\t\t//If tag self-terminates, add an explicit, separate closing tag\n\t\t\t\tif (\n\t\t\t\t\telement.type != ElementType.Text\n\t\t\t\t\t&&\n\t\t\t\t\telement.type != ElementType.Comment\n\t\t\t\t\t&&\n\t\t\t\t\telement.type != ElementType.Directive\n\t\t\t\t\t&&\n\t\t\t\t\telement.data.charAt(element.data.length - 1) == \"/\"\n\t\t\t\t\t)\n\t\t\t\t\tthis._elements.push({\n\t\t\t\t\t\t  raw: \"/\" + element.name\n\t\t\t\t\t\t, data: \"/\" + element.name\n\t\t\t\t\t\t, name: \"/\" + element.name\n\t\t\t\t\t\t, type: element.type\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tthis._parseState = (tagSep == \"<\") ? ElementType.Tag : ElementType.Text;\n\t\t\tthis._current = this._next + 1;\n\t\t\tthis._prevTagSep = tagSep;\n\t\t}\n\n\t\tif (this._options.includeLocation) {\n\t\t\tthis.getLocation();\n\t\t\tthis._location.row += this._location.inBuffer;\n\t\t\tthis._location.inBuffer = 0;\n\t\t\tthis._location.charOffset = 0;\n\t\t}\n\t\tthis._buffer = (this._current <= bufferEnd) ? this._buffer.substring(this._current) : \"\";\n\t\tthis._current = 0;\n\t\n\t\tthis.writeHandler();\n\t}\n\n\tParser.prototype.getLocation = function Parser$getLocation (startTag) {\n\t\tvar c,\n\t\t\tl = this._location,\n\t\t\tend = this._current - (startTag ? 1 : 0),\n\t\t\tchunk = startTag && l.charOffset == 0 && this._current == 0;\n\t\t\n\t\tfor (; l.charOffset < end; l.charOffset++) {\n\t\t\tc = this._buffer.charAt(l.charOffset);\n\t\t\tif (c == '\\n') {\n\t\t\t\tl.inBuffer++;\n\t\t\t\tl.col = 0;\n\t\t\t} else if (c != '\\r') {\n\t\t\t\tl.col++;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\t  line: l.row + l.inBuffer + 1\n\t\t\t, col: l.col + (chunk ? 0: 1)\n\t\t};\n\t}\n\n\t//Checks the handler to make it is an object with the right \"interface\"\n\tParser.prototype.validateHandler = function Parser$validateHandler (handler) {\n\t\tif ((typeof handler) != \"object\")\n\t\t\tthrow new Error(\"Handler is not an object\");\n\t\tif ((typeof handler.reset) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'reset' is invalid\");\n\t\tif ((typeof handler.done) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'done' is invalid\");\n\t\tif ((typeof handler.writeTag) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'writeTag' is invalid\");\n\t\tif ((typeof handler.writeText) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'writeText' is invalid\");\n\t\tif ((typeof handler.writeComment) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'writeComment' is invalid\");\n\t\tif ((typeof handler.writeDirective) != \"function\")\n\t\t\tthrow new Error(\"Handler method 'writeDirective' is invalid\");\n\t}\n\n\t//Writes parsed elements out to the handler\n\tParser.prototype.writeHandler = function Parser$writeHandler (forceFlush) {\n\t\tforceFlush = !!forceFlush;\n\t\tif (this._tagStack.length && !forceFlush)\n\t\t\treturn;\n\t\twhile (this._elements.length) {\n\t\t\tvar element = this._elements.shift();\n\t\t\tswitch (element.type) {\n\t\t\t\tcase ElementType.Comment:\n\t\t\t\t\tthis._handler.writeComment(element);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ElementType.Directive:\n\t\t\t\t\tthis._handler.writeDirective(element);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ElementType.Text:\n\t\t\t\t\tthis._handler.writeText(element);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis._handler.writeTag(element);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tParser.prototype.handleError = function Parser$handleError (error) {\n\t\tif ((typeof this._handler.error) == \"function\")\n\t\t\tthis._handler.error(error);\n\t\telse\n\t\t\tthrow error;\n\t}\n\n//TODO: make this a trully streamable handler\nfunction RssHandler (callback) {\n\tRssHandler.super_.call(this, callback, { ignoreWhitespace: true, verbose: false, enforceEmptyTags: false });\n}\ninherits(RssHandler, DefaultHandler);\n\n\tRssHandler.prototype.done = function RssHandler$done () {\n\t\tvar feed = { };\n\t\tvar feedRoot;\n\n\t\tvar found = DomUtils.getElementsByTagName(function (value) { return(value == \"rss\" || value == \"feed\"); }, this.dom, false);\n\t\tif (found.length) {\n\t\t\tfeedRoot = found[0];\n\t\t}\n\t\tif (feedRoot) {\n\t\t\tif (feedRoot.name == \"rss\") {\n\t\t\t\tfeed.type = \"rss\";\n\t\t\t\tfeedRoot = feedRoot.children[0]; //<channel/>\n\t\t\t\tfeed.id = \"\";\n\t\t\t\ttry {\n\t\t\t\t\tfeed.title = DomUtils.getElementsByTagName(\"title\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.link = DomUtils.getElementsByTagName(\"link\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.description = DomUtils.getElementsByTagName(\"description\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.updated = new Date(DomUtils.getElementsByTagName(\"lastBuildDate\", feedRoot.children, false)[0].children[0].data);\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.author = DomUtils.getElementsByTagName(\"managingEditor\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\tfeed.items = [];\n\t\t\t\tDomUtils.getElementsByTagName(\"item\", feedRoot.children).forEach(function (item, index, list) {\n\t\t\t\t\tvar entry = {};\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.id = DomUtils.getElementsByTagName(\"guid\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.title = DomUtils.getElementsByTagName(\"title\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.link = DomUtils.getElementsByTagName(\"link\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.description = DomUtils.getElementsByTagName(\"description\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.pubDate = new Date(DomUtils.getElementsByTagName(\"pubDate\", item.children, false)[0].children[0].data);\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\tfeed.items.push(entry);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfeed.type = \"atom\";\n\t\t\t\ttry {\n\t\t\t\t\tfeed.id = DomUtils.getElementsByTagName(\"id\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.title = DomUtils.getElementsByTagName(\"title\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.link = DomUtils.getElementsByTagName(\"link\", feedRoot.children, false)[0].attribs.href;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.description = DomUtils.getElementsByTagName(\"subtitle\", feedRoot.children, false)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.updated = new Date(DomUtils.getElementsByTagName(\"updated\", feedRoot.children, false)[0].children[0].data);\n\t\t\t\t} catch (ex) { }\n\t\t\t\ttry {\n\t\t\t\t\tfeed.author = DomUtils.getElementsByTagName(\"email\", feedRoot.children, true)[0].children[0].data;\n\t\t\t\t} catch (ex) { }\n\t\t\t\tfeed.items = [];\n\t\t\t\tDomUtils.getElementsByTagName(\"entry\", feedRoot.children).forEach(function (item, index, list) {\n\t\t\t\t\tvar entry = {};\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.id = DomUtils.getElementsByTagName(\"id\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.title = DomUtils.getElementsByTagName(\"title\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.link = DomUtils.getElementsByTagName(\"link\", item.children, false)[0].attribs.href;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.description = DomUtils.getElementsByTagName(\"summary\", item.children, false)[0].children[0].data;\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\ttry {\n\t\t\t\t\t\tentry.pubDate = new Date(DomUtils.getElementsByTagName(\"updated\", item.children, false)[0].children[0].data);\n\t\t\t\t\t} catch (ex) { }\n\t\t\t\t\tfeed.items.push(entry);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.dom = feed;\n\t\t}\n\t\tRssHandler.super_.prototype.done.call(this);\n\t}\n\n///////////////////////////////////////////////////\n\nfunction DefaultHandler (callback, options) {\n\tthis.reset();\n\tthis._options = options ? options : { };\n\tif (this._options.ignoreWhitespace == undefined)\n\t\tthis._options.ignoreWhitespace = false; //Keep whitespace-only text nodes\n\tif (this._options.verbose == undefined)\n\t\tthis._options.verbose = true; //Keep data property for tags and raw property for all\n\tif (this._options.enforceEmptyTags == undefined)\n\t\tthis._options.enforceEmptyTags = true; //Don't allow children for HTML tags defined as empty in spec\n\tif ((typeof callback) == \"function\")\n\t\tthis._callback = callback;\n}\n\n\t//**\"Static\"**//\n\t//HTML Tags that shouldn't contain child nodes\n\tDefaultHandler._emptyTags = {\n\t\t  area: 1\n\t\t, base: 1\n\t\t, basefont: 1\n\t\t, br: 1\n\t\t, col: 1\n\t\t, frame: 1\n\t\t, hr: 1\n\t\t, img: 1\n\t\t, input: 1\n\t\t, isindex: 1\n\t\t, link: 1\n\t\t, meta: 1\n\t\t, param: 1\n\t\t, embed: 1\n\t}\n\t//Regex to detect whitespace only text nodes\n\tDefaultHandler.reWhitespace = /^\\s*$/;\n\n\t//**Public**//\n\t//Properties//\n\tDefaultHandler.prototype.dom = null; //The hierarchical object containing the parsed HTML\n\t//Methods//\n\t//Resets the handler back to starting state\n\tDefaultHandler.prototype.reset = function DefaultHandler$reset() {\n\t\tthis.dom = [];\n\t\tthis._done = false;\n\t\tthis._tagStack = [];\n\t\tthis._tagStack.last = function DefaultHandler$_tagStack$last () {\n\t\t\treturn(this.length ? this[this.length - 1] : null);\n\t\t}\n\t}\n\t//Signals the handler that parsing is done\n\tDefaultHandler.prototype.done = function DefaultHandler$done () {\n\t\tthis._done = true;\n\t\tthis.handleCallback(null);\n\t}\n\tDefaultHandler.prototype.writeTag = function DefaultHandler$writeTag (element) {\n\t\tthis.handleElement(element);\n\t} \n\tDefaultHandler.prototype.writeText = function DefaultHandler$writeText (element) {\n\t\tif (this._options.ignoreWhitespace)\n\t\t\tif (DefaultHandler.reWhitespace.test(element.data))\n\t\t\t\treturn;\n\t\tthis.handleElement(element);\n\t} \n\tDefaultHandler.prototype.writeComment = function DefaultHandler$writeComment (element) {\n\t\tthis.handleElement(element);\n\t} \n\tDefaultHandler.prototype.writeDirective = function DefaultHandler$writeDirective (element) {\n\t\tthis.handleElement(element);\n\t}\n\tDefaultHandler.prototype.error = function DefaultHandler$error (error) {\n\t\tthis.handleCallback(error);\n\t}\n\n\t//**Private**//\n\t//Properties//\n\tDefaultHandler.prototype._options = null; //Handler options for how to behave\n\tDefaultHandler.prototype._callback = null; //Callback to respond to when parsing done\n\tDefaultHandler.prototype._done = false; //Flag indicating whether handler has been notified of parsing completed\n\tDefaultHandler.prototype._tagStack = null; //List of parents to the currently element being processed\n\t//Methods//\n\tDefaultHandler.prototype.handleCallback = function DefaultHandler$handleCallback (error) {\n\t\t\tif ((typeof this._callback) != \"function\")\n\t\t\t\tif (error)\n\t\t\t\t\tthrow error;\n\t\t\t\telse\n\t\t\t\t\treturn;\n\t\t\tthis._callback(error, this.dom);\n\t}\n\t\n\tDefaultHandler.prototype.isEmptyTag = function(element) {\n\t\tvar name = element.name.toLowerCase();\n\t\tif (name.charAt(0) == '/') {\n\t\t\tname = name.substring(1);\n\t\t}\n\t\treturn this._options.enforceEmptyTags && !!DefaultHandler._emptyTags[name];\n\t};\n\t\n\tDefaultHandler.prototype.handleElement = function DefaultHandler$handleElement (element) {\n\t\tif (this._done)\n\t\t\tthis.handleCallback(new Error(\"Writing to the handler after done() called is not allowed without a reset()\"));\n\t\tif (!this._options.verbose) {\n//\t\t\telement.raw = null; //FIXME: Not clean\n\t\t\t//FIXME: Serious performance problem using delete\n\t\t\tdelete element.raw;\n\t\t\tif (element.type == \"tag\" || element.type == \"script\" || element.type == \"style\")\n\t\t\t\tdelete element.data;\n\t\t}\n\t\tif (!this._tagStack.last()) { //There are no parent elements\n\t\t\t//If the element can be a container, add it to the tag stack and the top level list\n\t\t\tif (element.type != ElementType.Text && element.type != ElementType.Comment && element.type != ElementType.Directive) {\n\t\t\t\tif (element.name.charAt(0) != \"/\") { //Ignore closing tags that obviously don't have an opening tag\n\t\t\t\t\tthis.dom.push(element);\n\t\t\t\t\tif (!this.isEmptyTag(element)) { //Don't add tags to the tag stack that can't have children\n\t\t\t\t\t\tthis._tagStack.push(element);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse //Otherwise just add to the top level list\n\t\t\t\tthis.dom.push(element);\n\t\t}\n\t\telse { //There are parent elements\n\t\t\t//If the element can be a container, add it as a child of the element\n\t\t\t//on top of the tag stack and then add it to the tag stack\n\t\t\tif (element.type != ElementType.Text && element.type != ElementType.Comment && element.type != ElementType.Directive) {\n\t\t\t\tif (element.name.charAt(0) == \"/\") {\n\t\t\t\t\t//This is a closing tag, scan the tagStack to find the matching opening tag\n\t\t\t\t\t//and pop the stack up to the opening tag's parent\n\t\t\t\t\tvar baseName = element.name.substring(1);\n\t\t\t\t\tif (!this.isEmptyTag(element)) {\n\t\t\t\t\t\tvar pos = this._tagStack.length - 1;\n\t\t\t\t\t\twhile (pos > -1 && this._tagStack[pos--].name != baseName) { }\n\t\t\t\t\t\tif (pos > -1 || this._tagStack[0].name == baseName)\n\t\t\t\t\t\t\twhile (pos < this._tagStack.length - 1)\n\t\t\t\t\t\t\t\tthis._tagStack.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse { //This is not a closing tag\n\t\t\t\t\tif (!this._tagStack.last().children)\n\t\t\t\t\t\tthis._tagStack.last().children = [];\n\t\t\t\t\tthis._tagStack.last().children.push(element);\n\t\t\t\t\tif (!this.isEmptyTag(element)) //Don't add tags to the tag stack that can't have children\n\t\t\t\t\t\tthis._tagStack.push(element);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse { //This is not a container element\n\t\t\t\tif (!this._tagStack.last().children)\n\t\t\t\t\tthis._tagStack.last().children = [];\n\t\t\t\tthis._tagStack.last().children.push(element);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar DomUtils = {\n\t\t  testElement: function DomUtils$testElement (options, element) {\n\t\t\tif (!element) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\n\t\t\tfor (var key in options) {\n\t\t\t\tif (key == \"tag_name\") {\n\t\t\t\t\tif (element.type != \"tag\" && element.type != \"script\" && element.type != \"style\") {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!options[\"tag_name\"](element.name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (key == \"tag_type\") {\n\t\t\t\t\tif (!options[\"tag_type\"](element.type)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (key == \"tag_contains\") {\n\t\t\t\t\tif (element.type != \"text\" && element.type != \"comment\" && element.type != \"directive\") {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!options[\"tag_contains\"](element.data)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!element.attribs || !options[key](element.attribs[key])) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\treturn true;\n\t\t}\n\t\n\t\t, getElements: function DomUtils$getElements (options, currentElement, recurse, limit) {\n\t\t\trecurse = (recurse === undefined || recurse === null) || !!recurse;\n\t\t\tlimit = isNaN(parseInt(limit)) ? -1 : parseInt(limit);\n\n\t\t\tif (!currentElement) {\n\t\t\t\treturn([]);\n\t\t\t}\n\t\n\t\t\tvar found = [];\n\t\t\tvar elementList;\n\n\t\t\tfunction getTest (checkVal) {\n\t\t\t\treturn(function (value) { return(value == checkVal); });\n\t\t\t}\n\t\t\tfor (var key in options) {\n\t\t\t\tif ((typeof options[key]) != \"function\") {\n\t\t\t\t\toptions[key] = getTest(options[key]);\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tif (DomUtils.testElement(options, currentElement)) {\n\t\t\t\tfound.push(currentElement);\n\t\t\t}\n\n\t\t\tif (limit >= 0 && found.length >= limit) {\n\t\t\t\treturn(found);\n\t\t\t}\n\n\t\t\tif (recurse && currentElement.children) {\n\t\t\t\telementList = currentElement.children;\n\t\t\t} else if (currentElement instanceof Array) {\n\t\t\t\telementList = currentElement;\n\t\t\t} else {\n\t\t\t\treturn(found);\n\t\t\t}\n\t\n\t\t\tfor (var i = 0; i < elementList.length; i++) {\n\t\t\t\tfound = found.concat(DomUtils.getElements(options, elementList[i], recurse, limit));\n\t\t\t\tif (limit >= 0 && found.length >= limit) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\treturn(found);\n\t\t}\n\t\t\n\t\t, getElementById: function DomUtils$getElementById (id, currentElement, recurse) {\n\t\t\tvar result = DomUtils.getElements({ id: id }, currentElement, recurse, 1);\n\t\t\treturn(result.length ? result[0] : null);\n\t\t}\n\t\t\n\t\t, getElementsByTagName: function DomUtils$getElementsByTagName (name, currentElement, recurse, limit) {\n\t\t\treturn(DomUtils.getElements({ tag_name: name }, currentElement, recurse, limit));\n\t\t}\n\t\t\n\t\t, getElementsByTagType: function DomUtils$getElementsByTagType (type, currentElement, recurse, limit) {\n\t\t\treturn(DomUtils.getElements({ tag_type: type }, currentElement, recurse, limit));\n\t\t}\n\t}\n\n\tfunction inherits (ctor, superCtor) {\n\t\tvar tempCtor = function(){};\n\t\ttempCtor.prototype = superCtor.prototype;\n\t\tctor.super_ = superCtor;\n\t\tctor.prototype = new tempCtor();\n\t\tctor.prototype.constructor = ctor;\n\t}\n\nexports.Parser = Parser;\n\nexports.DefaultHandler = DefaultHandler;\n\nexports.RssHandler = RssHandler;\n\nexports.ElementType = ElementType;\n\nexports.DomUtils = DomUtils;\n\n})();\n", "//const htmlparser = require('htmlparser');\r\n\r\n// htmlparser2\r\n//  faster? used in cheerio (like jQuery)\r\n\r\n// page_context.map_Ctrls\r\n//  then it will create the controls using the appropriate constructors.\r\n\r\n// It's appropriate to make this before making the Business Suite controls.\r\n\r\n// Mount content into a control - meaning the control itself would need to be changed.\r\n\r\n// parse_mount function will just create the controls.\r\n//  they could then be put into a DOM.\r\n\r\nvar htmlparser = require(\"htmlparser\");\r\nconst {tof, each} = require('lang-tools');\r\n\r\nconst map_jsgui_attr_names = {\r\n    'name': true,\r\n    'class': true,\r\n    'content': true,\r\n    '__type_name': true,\r\n    'context': true,\r\n    'key': true,\r\n    'size': true\r\n}\r\n\r\n// Maybe redo this, making use of a recursion function.\r\n\r\n// Just parse and add?\r\n// Parse and instantiate?\r\n// Parse and construct?\r\n\r\nconst log = () => {}\r\nconst parse = function(str_content, context, control_set, callback) {\r\n    //console.log('Parsing');\r\n    //console.log('-------');\r\n    //console.log('');\r\n    str_content = str_content.trim();\r\n\r\n    const handler = new htmlparser.DefaultHandler(function (error, dom) {\r\n        if (error) {\r\n            log('parse error', error);\r\n        }\r\n            //[...do something for errors...]\r\n        else {\r\n            log('dom', dom);\r\n            \r\n            let recurse = (dom, depth, callback) => {\r\n                let tdom = tof(dom);\r\n                let res;\r\n                log('tdom', tdom);\r\n                log('dom item', dom);\r\n\r\n                if (tdom === 'array') {\r\n                    //res = [];\r\n                    each(dom, (v, i) => {\r\n                        //res.push(recurse)\r\n                        recurse(v, depth + 1, callback);\r\n                        // then later (depth first) callback\r\n                        callback(v, depth, i);\r\n\r\n                    })\r\n                } else if (tdom === 'object') {\r\n                    if (dom.children) {\r\n                        each(dom.children, (child, i) => {\r\n                            recurse(child, depth + 1, callback);\r\n\r\n                            callback(child, depth, i);\r\n                        })\r\n                    }\r\n                } else {\r\n                    log('dom', dom);\r\n                }\r\n            }\r\n            let last_depth = 0;\r\n            let map_siblings_at_depth = {};\r\n            let res_controls = {};\r\n            const handle_text = (text, depth, sibling_index) => {\r\n                // Not so sure we can give it the parent right here.\r\n                //  Can only reconnect it once it's been put into the DOM.\r\n\r\n                let tn = new control_set.Text_Node({\r\n                    text: text,\r\n                    context: context,\r\n                    sibling_index: sibling_index\r\n                });\r\n                res_controls.unnamed = res_controls.unnamed || [];\r\n                res_controls.unnamed.push(tn);\r\n                map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n                map_siblings_at_depth[depth].push(tn);\r\n                last_depth = depth;\r\n\r\n                // Any way of reconnecting the text node back with the DOM element?\r\n                //  sibling_index property could help them to be reconnected later on, once its in the DOM.\r\n\r\n                // Does seem like work on reconnecting text content / nodes with the activation of controls will be useful.\r\n                //  Want the jsgui text node controls to have a reference to the DOM node.\r\n\r\n                // Will look them up using the sibling index.\r\n\r\n            }\r\n\r\n            const handle_tag = (tag, depth, sibling_index) => {\r\n                //console.log('handle_tag tag', tag);\r\n                //console.log('depth', depth);\r\n                //console.log('last_depth', last_depth);\r\n                const tag_with_no_children = {};\r\n                if (tag.raw) tag_with_no_children.raw = tag.raw;\r\n                if (tag.data) tag_with_no_children.data = tag.data;\r\n                if (tag.type) tag_with_no_children.type = tag.type;\r\n                if (tag.name) tag_with_no_children.name = tag.name;\r\n                if (tag.attribs) tag_with_no_children.attribs = tag.attribs;\r\n\r\n                // Probably only worth giving the sibling index for text nodes, as that's where its needed to reconnect them.\r\n                //  Need to make sure things work right with non-parse-mount too.\r\n\r\n                const create_ctrl = (tag, content) => {\r\n\r\n                    //console.log('tag.name', tag.name);\r\n                    //console.log('!!control_set[tag.name]', !!control_set[tag.name]);\r\n\r\n                    if (control_set[tag.name]) {\r\n                        let Ctrl = control_set[tag.name];\r\n                        log('tag', tag);\r\n                        let a = tag.attribs || {};\r\n                        if (content) a.content = content;\r\n                        each(content, item => {\r\n                            //log('content item', item);\r\n                            //log('Object.keys(content item)', Object.keys(item));\r\n                            //log('(content item.__type_name)', (item.__type_name));\r\n                            //log('(content item._text)', (item._text));\r\n                            //log('(content item.text)', (item.text));\r\n                        })\r\n                        // want an easier way to view the content.\r\n                        //  don't want large printouts of the jsgui controls.\r\n                        log('attribs a', a);\r\n                        log('\\n\\n');\r\n                        //log('!!target', !!target);\r\n                        //log('!!target.context', !!target.context);\r\n                        a.context = context;\r\n                        let ctrl = new Ctrl(a);\r\n                        if (a.name) {\r\n                            res_controls.named = res_controls.named || {};\r\n                            res_controls.named[a.name] = ctrl;\r\n                        } else {\r\n                            res_controls.unnamed = res_controls.unnamed || [];\r\n                            res_controls.unnamed.push(ctrl);\r\n                        }\r\n                        \r\n                        const arr_dom_attrs = [];\r\n                        each(a, (a_value, a_name) => {\r\n                            if (!map_jsgui_attr_names[a_name]) {\r\n                                arr_dom_attrs.push([a_name, a_value])\r\n                            }\r\n                        })\r\n                        each(arr_dom_attrs, attr => {\r\n                            const [name, value] = attr;\r\n                            ctrl.dom.attributes[name] = value;\r\n                        });\r\n                        return ctrl;\r\n                    } else {\r\n                        // The app's controls need to be loaded / registered previous to this.\r\n                        //log('lacking jsgui control for ' + tag.name);\r\n                        // The server app should register it?\r\n                        //console.log('tag', tag);\r\n                        console.trace();\r\n                        throw 'lacking jsgui control for ' + tag.name;\r\n                    }\r\n                }\r\n                let my_children;\r\n                let ctrl;\r\n\r\n                if (depth > last_depth) {\r\n                    ctrl = create_ctrl(tag_with_no_children);\r\n                    map_siblings_at_depth[depth] = []; // because its a new depth?\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n\r\n                } else if (depth < last_depth) {\r\n                    //console.log('depth decrease');\r\n                    my_children = map_siblings_at_depth[last_depth];\r\n                    if (my_children) {\r\n                        ctrl = create_ctrl(tag_with_no_children, my_children);\r\n                    } else {\r\n                        ctrl = create_ctrl(tag_with_no_children);\r\n                    }\r\n                    map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n                    map_siblings_at_depth[last_depth] = null;\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n                } else {\r\n                    ctrl = create_ctrl(tag_with_no_children);\r\n                    map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n                }\r\n                // Create a control out of the tag\r\n                last_depth = depth;\r\n            }\r\n            // goes depth-first.\r\n            //  want the item's sibling index too.\r\n            recurse(dom, 0, (item, depth, sibling_index) => {\r\n                if (item.type === 'text') {\r\n                    let trimmed = item.data.trim();\r\n                    //log('trimmed', trimmed);\r\n                    //log('trimmed.length', trimmed.length);\r\n                    if (trimmed.length > 0) {\r\n                        handle_text(item.raw, depth, sibling_index);\r\n                    }\r\n                    // Need to rapidly \r\n                } else if (item.type === 'tag') {\r\n                    // does it have children?\r\n                    // if not, create a control from the children.\r\n                    // then if it does, what are its control children?\r\n                    //log('tag item', item);\r\n                    //log('item.children.length', item.children.length);\r\n                    handle_tag(item, depth, sibling_index);\r\n                }\r\n            });\r\n            const depth_0_ctrls = map_siblings_at_depth[0];\r\n            callback(null, [depth_0_ctrls, res_controls]);\r\n        }\r\n            //[...parsing done, do something...]\r\n    });\r\n    var parser = new htmlparser.Parser(handler);\r\n    parser.parseComplete(str_content);\r\n}\r\n\r\n// Not sure why this separation breaks things.\r\n//  Timing - cant be async, needs to be immediate with callback. Cant await the parsing promise and have it work.\r\n\r\n\r\n// Maybe change back to old parse_mount and fix tomorrow?\r\n//  Or parse function will always / just use a callback?\r\n\r\nconst parse_mount = function(str_content, target, control_set) {\r\n    // And this should be a promise too, it seems.\r\n    //  Not so sure though.\r\n    //  Promise puts in some kind of a delay.\r\n\r\n    // Maybe this fn would be better with a callback too.\r\n    return new Promise(async(solve, jettison) => {\r\n        let container;\r\n        let a = arguments;\r\n        let l = a.length;\r\n        if (l === 4) {\r\n            container = a[2];\r\n            control_set = a[3];\r\n        } else {\r\n            container = target;\r\n        }\r\n        const {context} = target;\r\n        // And make it async to announce when it's complete?\r\n        //  Won't take long though.\r\n\r\n        //const [depth_0_ctrls, res_controls] = await parse(str_content, context, control_set);\r\n\r\n        parse(str_content, context, control_set, (err, res_parse) => {\r\n            if (err) {\r\n                jettison(err);\r\n            } else {\r\n\r\n                const [depth_0_ctrls, res_controls] = res_parse;\r\n\r\n                //console.log('depth_0_ctrls', depth_0_ctrls);\r\n                //console.log('res_controls', res_controls);\r\n\r\n                // Go through all named controls.\r\n                //  Set the name of target[a.name] = ctrl;\r\n                each(res_controls.named, (ctrl, name) => {\r\n                    //console.log('name', name);\r\n                    target[name] = ctrl;\r\n                });\r\n                const is_active_context = context.__is_active;\r\n\r\n                //console.log('is_active_context', is_active_context);\r\n                //console.log('depth_0_ctrls.length', depth_0_ctrls.length);\r\n                each(depth_0_ctrls, new_ctrl => {\r\n                    //console.log('pre add new_ctrl');\r\n\r\n                    // how many children within this control?\r\n                    //console.log('');\r\n                    //console.log('new_ctrl._id()', new_ctrl._id());\r\n                    //console.log('new_ctrl', new_ctrl);\r\n\r\n                    // parse does not add content (correctly) to the first level 0.\r\n\r\n                    container.add(new_ctrl);\r\n                    // activate it here?\r\n                    //  test to see if it's in an active context?\r\n                    //console.log('is_active_context', is_active_context);\r\n                    // Wait...?\r\n                    //  May be better to integrate auto activation at a lower level.\r\n\r\n                    if (is_active_context) {\r\n                        setTimeout(() => {\r\n                            new_ctrl.activate();\r\n                        }, 0);\r\n                    }\r\n                });\r\n                \r\n                //log('res_controls', res_controls);\r\n                //log('Object.keys(res_controls)', Object.keys(res_controls));\r\n                //console.log('Object.keys(res_controls.named)', Object.keys(res_controls.named));\r\n\r\n                // Go through the named controls.\r\n                // should have both .named and .unnamed\r\n\r\n                // Maybe don't bother with this?\r\n                //  Are they all named?\r\n                //   Or reconstruct it?\r\n\r\n                //console.log('!!res_controls.named', !!res_controls.named);\r\n\r\n                if (res_controls.named) {\r\n                    target._ctrl_fields = target._ctrl_fields || {};\r\n                    Object.assign(target._ctrl_fields, res_controls.named);\r\n                }\r\n\r\n                solve(depth_0_ctrls);\r\n\r\n            }\r\n        })\r\n\r\n\r\n\r\n        \r\n\r\n\r\n    })\r\n\r\n\r\n    \r\n    \r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// with 4 params - have a target, and a container\r\n\r\nconst ____old_parse_mount = function(str_content, target, control_set) {\r\n\r\n    let container;\r\n    let a = arguments;\r\n    let l = a.length;\r\n    if (l === 4) {\r\n        container = a[2];\r\n        control_set = a[3];\r\n    } else {\r\n        container = target;\r\n    }\r\n    // Add it to the container (may be subcontrol). Mount it to the target.\r\n    // A promise would probably do for the moment.\r\n    //  could use var DOMParser = require('xmldom').DOMParser;\r\n\r\n    // May need to make some nice isomorphic code for browser and node.\r\n\r\n    console.log('parse_mount str_content', str_content);\r\n    // Unfortunately seems like it will be async when using htmlparser?\r\n    //  Or need a callback?\r\n    //  Make a new parser, find one, use integrated parser somehow?\r\n\r\n    // Parse the str_content into a DOM.\r\n    //  parse-mounts into the target\r\n\r\n    // Comes up with a spec for each of the items parsed.\r\n\r\n    // remove white space first\r\n\r\n    str_content = str_content.trim();\r\n\r\n    const {context} = target;\r\n\r\n    //log('parse_mount str_content', str_content);\r\n    //log('target._id()', target._id());\r\n\r\n    // Recursively go through the html-like, creating jsgui controls.\r\n    //  This will enable much more concise expression of jgsui controls.\r\n\r\n    //var rawHtml = \"Xyz <script language= javascript>var foo = '<<bar>>';< /  script><!--<!-- Waah! -- -->\";\r\n    var handler = new htmlparser.DefaultHandler(function (error, dom) {\r\n        if (error) {\r\n            log('parse error', error);\r\n        }\r\n            //[...do something for errors...]\r\n        else {\r\n            log('dom', dom);\r\n            // Then can recurse through the dom object.\r\n            //  Nice that it parses non-standard elements.\r\n\r\n            // depth-first recursion for creation of the elements.\r\n            //  Then will add them to the parents as they get created.\r\n            // replace the children with controls?\r\n\r\n            // when doing \r\n\r\n            let recurse = (dom, depth, callback) => {\r\n                let tdom = tof(dom);\r\n                let res;\r\n                log('tdom', tdom);\r\n                log('dom item', dom);\r\n\r\n                if (tdom === 'array') {\r\n                    //res = [];\r\n                    each(dom, v => {\r\n                        //res.push(recurse)\r\n                        recurse(v, depth + 1, callback);\r\n\r\n                        // then later (depth first) callback\r\n                        callback(v, depth);\r\n\r\n                    })\r\n                } else if (tdom === 'object') {\r\n                    if (dom.children) {\r\n                        each(dom.children, child => {\r\n                            recurse(child, depth + 1, callback);\r\n\r\n                            callback(child, depth);\r\n                        })\r\n                    }\r\n                } else {\r\n                    log('dom', dom);\r\n                }\r\n            }\r\n            // want to create the items as well.\r\n            //  start with innermost, adding the child controls to the outer ones.\r\n            //   need to be able to run controls from these strings which come as templates.\r\n            //   eliminate the need for much of the control construction code, at least make it much more concise.\r\n\r\n\r\n            /*\r\n            const new_ctrl_made = (ctrl) => {\r\n                // this will need to assemble to controls into a heirachy.\r\n                //  May need to know the depth so to know which to join together.\r\n\r\n                // includes text controls\r\n            }\r\n            */\r\n\r\n            // handle text\r\n            //  should know what level the text is at\r\n            //   needs to know when the level decreases so we can put the children in the parent.\r\n\r\n            let last_depth = 0;\r\n\r\n            // maybe need a map of siblings at depth\r\n            //let child_nodes = [];\r\n            // siblings in a list, children in a list?\r\n            //  or only need one list with depth-first?\r\n            // can build it up within the closure.\r\n\r\n            // sounds like we need it as we add to the tree at different depths.\r\n            // map of open arrays at different depths?\r\n\r\n            // need to push the text node at the depth.\r\n\r\n            let map_siblings_at_depth = {};\r\n            // Then when moving up a depth we nullify the array\r\n            //  Then moving down the depth we create a new array.\r\n            //  Do this for controls.\r\n            //  Including text controls.\r\n\r\n            let res_controls = {};\r\n\r\n            const handle_text = (text, depth) => {\r\n\r\n                //child_nodes.push(text);\r\n\r\n                // Maybe don't need the text node control here.\r\n                //  When we have the text as a single child, we can declare it as a property.\r\n                //  However, the full text node instantiation makes sense for not taking shortcuts.\r\n\r\n                let tn = new control_set.Text_Node({\r\n                    text: text,\r\n                    context: context\r\n                });\r\n\r\n                //log('tn', tn);\r\n                //log('text', text);\r\n                //log('tn instanceof Text_Node', tn instanceof control_set.Text_Node);\r\n                //log('tn.text', tn.text);\r\n                //log('tn._text', tn._text);\r\n                //throw 'stop';\r\n                res_controls.unnamed = res_controls.unnamed || [];\r\n                res_controls.unnamed.push(tn);\r\n                // push it into siblings at depth too.\r\n                map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n                map_siblings_at_depth[depth].push(tn);\r\n\r\n                // doesn't have a name though.\r\n                //  there will be other unnamed controls that should be returned in the results.\r\n                // The names maybe will not be so important.\r\n\r\n                last_depth = depth;\r\n            }\r\n\r\n            // an array of siblings at levels\r\n            //  then remove? the array when going up a level, use it as the children for a node?\r\n\r\n            // need to be able to start up a node while specifying its content?\r\n            //  including the content in the spec could work well.\r\n            //   \r\n\r\n            // Get rid of the span rendering shortcut?\r\n            //  Always use the textNode?\r\n            //  Have the .text property a shortcut to modifying that text node?\r\n\r\n            // Span .text is really convenient in many cases.\r\n            // Spans can contain other elements so it's worth being careful.\r\n\r\n            // The .text shortcut looks like its not carrying out the underlying dom functionality.\r\n            //  Better to have it do the underlying dom tasks properly, and then have sugar around that.\r\n\r\n            // So don't have special rendering for the span element.\r\n            // Divs / controls can take text nodes too.\r\n\r\n            // Maybe have .text read-only.\r\n            //  .set_text too?\r\n            //  .set_text for convenience in some situations.\r\n            //   In other situations, we use proper text nodes alongside whatever else goes inside a span.\r\n\r\n            // the .text set and get property could stay for convienience.\r\n            //  It needs to deal with textNode object underneith though.\r\n\r\n            // General route is to handle things in the conventional DOM way on a lower level\r\n            //  Then on a higher level there will be systems of convenience for the programmer.\r\n\r\n            // So setting text will replace the content.\r\n            //  Get rid of the specialised span rendering.\r\n            //  Get rid of text property for the moment?\r\n            //   Or have it do its stuff on a lower level.\r\n\r\n\r\n            const handle_tag = (tag, depth) => {\r\n\r\n                console.log('handle_tag tag', tag);\r\n\r\n                const tag_with_no_children = {};\r\n                if (tag.raw) tag_with_no_children.raw = tag.raw;\r\n                if (tag.data) tag_with_no_children.data = tag.data;\r\n                if (tag.type) tag_with_no_children.type = tag.type;\r\n                if (tag.name) tag_with_no_children.name = tag.name;\r\n                if (tag.attribs) tag_with_no_children.attribs = tag.attribs;\r\n\r\n                // Then the name property - need to use these named controls to set the control's _ctrl_fields\r\n\r\n                //log('handle_tag tag_with_no_children', tag_with_no_children);\r\n                // maybe pass through the tag with no children. the children have been made into controls.\r\n\r\n                // will add to the collection of siblings.\r\n                // has the depth increased?\r\n                // create control...\r\n\r\n                // and the children? content\r\n                const create_ctrl = (tag, content) => {\r\n                    if (control_set[tag.name]) {\r\n                        //log('has jsgui control for ' + tag.name);\r\n    \r\n                        // need to look into if there are child jsgui controls within this.\r\n    \r\n                        let Ctrl = control_set[tag.name];\r\n                        // work out the spec as well.\r\n                        log('tag', tag);\r\n                        let a = tag.attribs || {};\r\n\r\n                        // Why isnt content working in the spec?\r\n                        //  Expecially with a Text_Node?\r\n                        if (content) a.content = content;\r\n                        //log('content.length', content.length);\r\n\r\n                        each(content, item => {\r\n                            //log('content item', item);\r\n                            //log('Object.keys(content item)', Object.keys(item));\r\n                            //log('(content item.__type_name)', (item.__type_name));\r\n                            //log('(content item._text)', (item._text));\r\n                            //log('(content item.text)', (item.text));\r\n                        })\r\n\r\n                        // want an easier way to view the content.\r\n                        //  don't want large printouts of the jsgui controls.\r\n\r\n\r\n\r\n                        log('attribs a', a);\r\n                        log('\\n\\n');\r\n                        //log('!!target', !!target);\r\n                        //log('!!target.context', !!target.context);\r\n                        a.context = context;\r\n    \r\n                        let ctrl = new Ctrl(a);\r\n                        if (a.name) {\r\n                            res_controls.named = res_controls.named || {};\r\n                            res_controls.named[a.name] = ctrl;\r\n\r\n                            // Expected behaviour to replace existing composition code.\r\n                            target[a.name] = ctrl;\r\n\r\n                            //res_controls[a.name] = ctrl;\r\n                        } else {\r\n                            res_controls.unnamed = res_controls.unnamed || [];\r\n                            res_controls.unnamed.push(ctrl);\r\n                        }\r\n                        // and unnamed controls\r\n                        //  an array of them...\r\n    \r\n                        // The name property - possibly name could be stored by the control itself.\r\n                        //  Different to its id.\r\n    \r\n                        //log('!!ctrl', !!ctrl);\r\n                        //log('depth', depth);\r\n\r\n                        return ctrl;\r\n                    } else {\r\n                        // The app's controls need to be loaded / registered previous to this.\r\n                        //log('lacking jsgui control for ' + tag.name);\r\n\r\n                        // The server app should register it?\r\n\r\n\r\n                        //console.log('tag', tag);\r\n                        console.trace();\r\n\r\n                        throw 'lacking jsgui control for ' + tag.name;\r\n                    }\r\n                }\r\n\r\n                // create the control at this stage?\r\n                //  having a 'content' or 'children' property could work well here.\r\n                //  setting .content would make sense well.\r\n\r\n                let my_children;\r\n                let ctrl;\r\n\r\n                if (depth > last_depth) {\r\n\r\n                    // Likely will happen.\r\n                    //  The fix I put in got lost before.\r\n                    //  It does not need to do that much where there are no child nodes.\r\n\r\n                    \r\n\r\n                    ctrl = create_ctrl(tag_with_no_children);\r\n                    //map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n\r\n                    map_siblings_at_depth[depth] = []; // because its a new depth?\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n\r\n                    console.log('depth > last_depth [depth, last_depth]', [depth, last_depth]);\r\n                    console.trace();\r\n                    //throw 'NYI';\r\n\r\n                    // Not sure how this will happen as the depth should move outwards?\r\n                    //  Will need to check / measure recursion order.\r\n\r\n                    // depth increase.\r\n                    //  means moving to new child.\r\n                    //   this does depth first, but starting from the first.\r\n                    //    not sure that makes sense, need to check that it works.\r\n\r\n                    // \r\n                    map_siblings_at_depth[depth] = [];\r\n\r\n                    // but need to add the item.\r\n                    //map_siblings_at_depth[depth].push();\r\n\r\n                    //log('child_nodes', child_nodes);\r\n\r\n                    //child_nodes = [];\r\n\r\n\r\n                } else if (depth < last_depth) {\r\n\r\n                    //log('child_nodes', child_nodes);\r\n                    // create the control.\r\n\r\n                    //child_nodes = [];\r\n                    // my children in array!!!\r\n                    //log('last_depth', last_depth);\r\n\r\n                    my_children = map_siblings_at_depth[last_depth];\r\n                    //log('my_children', my_children);\r\n\r\n                    //throw 'stop';\r\n\r\n                    if (my_children) {\r\n                        //log('my_children.length', my_children.length);\r\n                        ctrl = create_ctrl(tag_with_no_children, my_children);\r\n                    } else {\r\n                        ctrl = create_ctrl(tag_with_no_children);\r\n                    }\r\n                    //log('ctrl.content._arr.length', ctrl.content._arr.length);\r\n                    map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n\r\n                    // do we need to keep these child controls now?\r\n                    //  prob best not to.\r\n                    map_siblings_at_depth[last_depth] = null;\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n\r\n                    // create the ctrl including the content.\r\n\r\n                    // create the control with the children.\r\n                    //  maybe just say they are 'content'.\r\n\r\n                    // being able to choose content subcontrols at declaration seems very important here.\r\n\r\n\r\n                } else {\r\n                    ctrl = create_ctrl(tag_with_no_children);\r\n                    map_siblings_at_depth[depth] = map_siblings_at_depth[depth] || [];\r\n                    map_siblings_at_depth[depth].push(ctrl);\r\n\r\n                    // I think that means that this one doesn't have children either.\r\n                    // same depth - sibling\r\n                    //  create a new control.\r\n                    //   I think this means that the last control in the loop had no subcontrols.\r\n                    // Will need to observe the algo in operation to make sure it works correctly.\r\n                    //child_nodes.push(tag)\r\n\r\n                }\r\n                // Create a control out of the tag\r\n                last_depth = depth;\r\n            }\r\n\r\n            // goes depth-first.\r\n            recurse(dom, 0, (item, depth) => {\r\n                //log('item', item);\r\n                //log('depth', depth);\r\n\r\n                // analyse the item\r\n                //  is it an element (tag)?\r\n\r\n                if (item.type === 'text') {\r\n                    // These don't have children\r\n                    //  They are also the inner-most.\r\n                    // create a jsgui text node.\r\n                    //log('text item', item);\r\n                    // trim it\r\n\r\n                    let trimmed = item.data.trim();\r\n                    //log('trimmed', trimmed);\r\n                    //log('trimmed.length', trimmed.length);\r\n\r\n                    if (trimmed.length > 0) {\r\n                        handle_text(item.raw, depth);\r\n                    }\r\n                    // Need to rapidly \r\n                } else if (item.type === 'tag') {\r\n                    // does it have children?\r\n\r\n                    // if not, create a control from the children.\r\n\r\n                    // then if it does, what are its control children?\r\n\r\n                    //log('tag item', item);\r\n                    //log('item.children.length', item.children.length);\r\n\r\n                    handle_tag(item, depth);\r\n\r\n                    /*\r\n                    if (!item.children) {\r\n                        log('no children item', item);\r\n                        throw 'stop';\r\n                    }\r\n                    */\r\n\r\n                }\r\n            });\r\n            // Really not that good parse-mount being async.\r\n            //  May need to fix that for it to work.\r\n            //   Composition should be instant, but does not need to return a value.\r\n\r\n            // Would be best to separate out the parsing.\r\n            //\r\n            // the parse result is the depth 0 controls.\r\n\r\n            const depth_0_ctrls = map_siblings_at_depth[0];\r\n\r\n\r\n            // then once the recursion is done, see what's at level 0\r\n            //log('');\r\n            //log('map_siblings_at_depth[0]', map_siblings_at_depth[0]);\r\n\r\n            //log('map_siblings_at_depth[0].length', map_siblings_at_depth[0].length);\r\n\r\n            //log('map_siblings_at_depth', map_siblings_at_depth);\r\n            //throw 'stop';\r\n\r\n            // context.__is_active?\r\n            //  \r\n            //const context = target.context;\r\n            const is_active_context = context.__is_active;\r\n\r\n            each(depth_0_ctrls, new_ctrl => {\r\n                container.add(new_ctrl);\r\n\r\n                // activate it here?\r\n                //  test to see if it's in an active context?\r\n\r\n                //console.log('is_active_context', is_active_context);\r\n\r\n                // Wait...?\r\n                //  May be better to integrate auto activation at a lower level.\r\n\r\n                if (is_active_context) {\r\n                    setTimeout(() => {\r\n                        new_ctrl.activate();\r\n                    }, 0);\r\n                }\r\n\r\n            });\r\n\r\n            target._ctrl_fields = target._ctrl_fields || {};\r\n            //log('res_controls', res_controls);\r\n            //log('Object.keys(res_controls)', Object.keys(res_controls));\r\n            //console.log('Object.keys(res_controls.named)', Object.keys(res_controls.named));\r\n\r\n            // Go through the named controls.\r\n            // should have both .named and .unnamed\r\n\r\n            // Maybe don't bother with this?\r\n            //  Are they all named?\r\n            //   Or reconstruct it?\r\n\r\n            if (res_controls.named) {\r\n                Object.assign(target._ctrl_fields, res_controls.named);\r\n            }\r\n\r\n            //throw 'stop';\r\n\r\n            // and a callback?\r\n            // Seems like the async is not a problem - but its not adding the text.\r\n\r\n            // Handling async composition may be useful though.\r\n\r\n\r\n\r\n            //throw 'stop';\r\n        }\r\n            //[...parsing done, do something...]\r\n    });\r\n    var parser = new htmlparser.Parser(handler);\r\n    parser.parseComplete(str_content);\r\n}\r\n//\r\n\r\nconst res = {\r\n    parse: parse,\r\n    parse_mount: parse_mount\r\n}\r\n\r\nmodule.exports = res;", "const jsgui = require('lang-tools');\r\nconst Text_Node = require('./text-node');\r\nconst Page_Context = require('./page-context');\r\nconst Selection_Scope = require('./selection-scope');\r\nconst Control_Data = require('./Control_Data');\r\nconst Control_View = require('./Control_View');\r\nconst {parse_mount, parse} = require('./parse-mount');\r\nconst {str_arr_mapify, get_a_sig, each, prop} = jsgui;\r\n//const Control = jsgui.Control = require('./control-enh');\r\n\r\nconst Control = jsgui.Control = require('./Data_Model_View_Model_Control');\r\njsgui.load_type('control', 'C', item => (item instanceof Control));\r\nconst Evented_Class = jsgui.Evented_Class;\r\nvar tof = jsgui.tof;\r\nvar map_Controls = jsgui.map_Controls = {};\r\nconst def = jsgui.is_defined;\r\nvar core_extension = str_arr_mapify(function (tagName) {\r\n    jsgui.controls[tagName] = jsgui[tagName] = class extends Control {\r\n        constructor(spec) {\r\n            let str;\r\n            if (typeof spec === 'string') {\r\n                str = spec;\r\n                spec = {\r\n                    __type_name: tagName\r\n                } \r\n            } else {\r\n                if (typeof spec === 'object') {\r\n                    spec.__type_name = tagName;\r\n                }\r\n            }\r\n            super(spec);\r\n            this.dom.tagName = tagName;\r\n        }\r\n    };\r\n    jsgui[tagName].prototype._tag_name = tagName;\r\n    map_Controls[tagName] = jsgui[tagName];\r\n});\r\nvar core_extension_no_closing_tag = str_arr_mapify(function (tagName) {\r\n    jsgui[tagName] = class extends Control {\r\n        constructor(spec) {\r\n            spec.__type_name = tagName;\r\n            super(spec);\r\n            this.dom.tagName = tagName;\r\n            this.dom.noClosingTag = true;\r\n        }\r\n    };\r\n    jsgui[tagName].prototype._tag_name = tagName;\r\n    map_Controls[tagName] = jsgui[tagName];\r\n});\r\nvar recursive_dom_iterate = function (el, callback) {\r\n    callback(el);\r\n    var cns = el.childNodes;\r\n    for (var c = 0, l = cns.length; c < l; c++) {\r\n        recursive_dom_iterate(cns[c], callback);\r\n    }\r\n}\r\nvar recursive_dom_iterate_depth = function (el, callback) {\r\n    var cns = el.childNodes;\r\n    for (var c = 0, l = cns.length; c < l; c++) {\r\n        recursive_dom_iterate_depth(cns[c], callback);\r\n    }\r\n    callback(el);\r\n}\r\nconst pre_activate = (context) => {\r\n    console.log('jsgui html-core pre_activate');\r\n    if (!context) {\r\n        throw 'jsgui-html-enh pre_activate(context) - need to supply context parameter.';\r\n    }\r\n    const map_controls = context.map_controls || {};\r\n    var map_jsgui_els = {};\r\n    var map_jsgui_types = {};\r\n    var arr_controls = [];\r\n    var max_typed_ids = {};\r\n    const map_ctrl_parent_ids_by_ctrl_ids = {};\r\n    var id_before__ = function (id) {\r\n        var pos1 = id.lastIndexOf('_');\r\n        var res = id.substr(0, pos1);\r\n        return res;\r\n    }\r\n    var num_after = function (id) {\r\n        return parseInt(id.substr(id.lastIndexOf('_') + 1), 10);\r\n    }\r\n    let map_els = () => {\r\n        recursive_dom_iterate(document, el => {\r\n            const nt = el.nodeType;\r\n            if (nt === 1) {\r\n                const jsgui_id = el.getAttribute('data-jsgui-id');\r\n                if (jsgui_id) {\r\n                    if (el.parentNode) {\r\n                        if (el.parentNode.nodeType === 1) {\r\n                            const parent_jsgui_id = el.parentNode.getAttribute('data-jsgui-id');\r\n                            if (parent_jsgui_id) {\r\n                                map_ctrl_parent_ids_by_ctrl_ids[jsgui_id] = parent_jsgui_id;\r\n                            }\r\n                        }\r\n                    }\r\n                    const ib = id_before__(jsgui_id), num = num_after(jsgui_id);\r\n                    if (!def(max_typed_ids[ib])) {\r\n                        max_typed_ids[ib] = num;\r\n                    } else {\r\n                        if (num > max_typed_ids[ib]) max_typed_ids[ib] = num;\r\n                    }\r\n                    map_jsgui_els[jsgui_id] = el;\r\n                    var jsgui_type = el.getAttribute('data-jsgui-type');\r\n                    if (jsgui_type) map_jsgui_types[jsgui_id] = jsgui_type;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    map_els();\r\n    context.set_max_ids(max_typed_ids);\r\n    each(map_jsgui_els, (el, jsgui_id) => {\r\n        const l_tag_name = el.tagName.toLowerCase();\r\n        if (jsgui_id) {\r\n            var type = map_jsgui_types[jsgui_id];\r\n            if (!map_controls[jsgui_id]) {\r\n                var Cstr = context.map_Controls[type];\r\n                if (Cstr) {\r\n                    const parent_jsgui_id = map_ctrl_parent_ids_by_ctrl_ids[jsgui_id];\r\n                    const ctrl_spec = {\r\n                        'context': context,\r\n                        '__type_name': type,\r\n                        'id': jsgui_id,\r\n                        'el': el\r\n                    }\r\n                    if (parent_jsgui_id) {\r\n                        if (map_controls[parent_jsgui_id]) {\r\n                        }\r\n                    }\r\n                    var ctrl = new Cstr(ctrl_spec);\r\n                    if (parent_jsgui_id) {\r\n                        if (map_controls[parent_jsgui_id]) {\r\n                        }\r\n                    }\r\n                    arr_controls.push(ctrl);\r\n                    if (l_tag_name === 'html') {\r\n                        context.ctrl_document = ctrl;\r\n                    }\r\n                    map_controls[jsgui_id] = ctrl;\r\n                } else {\r\n                    console.log('Missing context.map_Controls for type ' + type + ', using generic Control');\r\n                    var ctrl = new Control({\r\n                        'context': context,\r\n                        '__type_name': type,\r\n                        'id': jsgui_id,\r\n                        'el': el\r\n                    });\r\n                    arr_controls.push(ctrl);\r\n                    map_controls[jsgui_id] = ctrl;\r\n                }\r\n            } else {\r\n                var ctrl = map_controls[jsgui_id];\r\n                ctrl.dom.el = el;\r\n                if (ctrl.attach_dom_events) ctrl.attach_dom_events();\r\n            }\r\n        }\r\n    });\r\n    recursive_dom_iterate_depth(document, (el) => {\r\n        var nt = el.nodeType;\r\n        if (nt === 1) {\r\n            var jsgui_id = el.getAttribute('data-jsgui-id');\r\n            if (jsgui_id) {\r\n                const ctrl = map_controls[jsgui_id];\r\n                ctrl.pre_activate(ctrl.dom.el);\r\n            }\r\n        }\r\n    });\r\n}\r\nconst activate = function (context) {\r\n    const map_controls = context.map_controls;\r\n    console.log('jsgui html-core activate');\r\n    console.log('jsgui.def_server_resources', jsgui.def_server_resources);\r\n    if (!context) {\r\n        throw 'jsgui-html-enh activate(context) - need to supply context parameter.';\r\n    }\r\n    recursive_dom_iterate_depth(document, (el) => {\r\n        var nt = el.nodeType;\r\n        if (nt === 1) {\r\n            var jsgui_id = el.getAttribute('data-jsgui-id');\r\n            if (jsgui_id) {\r\n                const ctrl = map_controls[jsgui_id];\r\n                ctrl.activate(ctrl.dom.el);\r\n            }\r\n        }\r\n    });\r\n};\r\njsgui.controls = jsgui.controls || {\r\n    Control\r\n};\r\n\r\n// Maybe get rid of this, should work in abstract anyway.\r\njsgui.controls.span = jsgui.span = class span extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = 'span';\r\n        super(spec);\r\n        this.dom.tagName = 'span';\r\n        spec = spec || {};\r\n        prop(this, 'text', spec.text || '');\r\n        this.on('change', e_change => {\r\n            const {name} = e_change;\r\n            if (name === 'text') {\r\n                if (this.content._arr.length === 1) {\r\n                    if (this.content._arr[0] instanceof Text_Node) {\r\n                        this.content._arr[0].text = e_change.value;\r\n                    }\r\n                } else {\r\n                    if (this.content._arr.length === 0) {\r\n                    } else {\r\n                        console.log('this.content._arr', this.content._arr);\r\n                        console.trace();\r\n                        throw 'NYI';\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        if (!spec.el) {\r\n            this.compose_span();\r\n        }\r\n    }\r\n    compose_span() {\r\n        if (this.text && this.text.length > 0) {\r\n            this.add(this.tn = this.text_node = new Text_Node({\r\n                context: this.context,\r\n                text: this.text\r\n            }));\r\n        }\r\n    }\r\n}\r\nclass String_Control extends Control {\r\n    constructor(spec = {}) {\r\n        spec.__type_name = 'string_control';\r\n        super(spec);\r\n        this.dom.tagName = undefined;\r\n        spec = spec || {};\r\n        if (typeof spec.text !== 'undefined') {\r\n            this._text = spec.text;\r\n        } else {\r\n            this._text = '';\r\n        }\r\n        if (!spec.el) {\r\n        }\r\n    }\r\n    get text() {\r\n        return this._text;\r\n    }\r\n    set text(value) {\r\n        this._text = value;\r\n        this.raise('change', {\r\n            'name': 'text',\r\n            'value': value\r\n        });\r\n    }\r\n    all_html_render() {\r\n        return this._text;\r\n    }\r\n    activate() {\r\n    }\r\n}\r\njsgui.pre_activate = pre_activate;\r\njsgui.activate = activate;\r\ncore_extension('html head title body div select option h1 h2 h3 h4 h5 h6 label p a script link button form textarea img ul li audio video table tr td caption thead colgroup col svg defs marker polygon line section code samp canvas');\r\ncore_extension_no_closing_tag('link input meta');\r\nclass HTML_Document extends jsgui.Control {\r\n    constructor(spec = {}) {\r\n        spec.tag_name = 'html';\r\n        super(spec);\r\n    }\r\n}\r\nclass Blank_HTML_Document extends HTML_Document {\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        var context = this.context;\r\n        if (!spec.el) {\r\n            var head = new jsgui.head({\r\n                'context': context\r\n            });\r\n            this.content.add(head);\r\n            var title = new jsgui.title({\r\n                'context': context\r\n            });\r\n            head.content.add(title);\r\n            var body = new jsgui.body({\r\n                'context': context\r\n            });\r\n            this.content.add(body);\r\n            this.head = head;\r\n            this.title = title;\r\n            this.body = body;\r\n        }\r\n    }\r\n    'body'() {\r\n        var a = arguments;\r\n        a.l = arguments.length;\r\n        var sig = get_a_sig(a, 1);\r\n        if (sig == '[]') {\r\n            var content = this.content;\r\n            var body = content.get(1);\r\n            return body;\r\n        }\r\n    }\r\n};\r\nclass Intersection_Finder extends Evented_Class {\r\n    constructor(spec) {\r\n        super(spec);\r\n        let coords_ctrls;\r\n        let update_ctrl_coords = () => {\r\n            coords_ctrls = [];\r\n            each(spec.controls || spec.ctrls, ctrl => {\r\n                coords_ctrls.push([ctrl.bcr(), ctrl]);\r\n            });\r\n        }\r\n        let map_selected = new Map();\r\n        let find_intersections = (coords) => {\r\n            update_ctrl_coords();\r\n            let intersecting = [],\r\n                newly_intersecting = [],\r\n                previously_intersecting = [];;\r\n            let [btl, bbr] = coords;\r\n            each(coords_ctrls, cc => {\r\n                let [ccoords, ctrl] = cc;\r\n                let [cpos, cbr, csize] = ccoords;\r\n                let intersect = (cpos[0] <= bbr[0] &&\r\n                    btl[0] <= cbr[0] &&\r\n                    cpos[1] <= bbr[1] &&\r\n                    btl[1] <= cbr[1])\r\n                if (intersect) {\r\n                    if (map_selected.get(ctrl) !== true) {\r\n                        newly_intersecting.push(ctrl);\r\n                        map_selected.set(ctrl, true);\r\n                    }\r\n                    intersecting.push(ctrl);\r\n                } else {\r\n                    if (map_selected.get(ctrl) === true) {\r\n                        previously_intersecting.push(ctrl);\r\n                        map_selected.set(ctrl, false);\r\n                    }\r\n                }\r\n            });\r\n            return [intersecting, newly_intersecting, previously_intersecting];\r\n        }\r\n        prop(this, 'coords', (transform_coords) => {\r\n            if (transform_coords[0][1] > transform_coords[1][1]) {\r\n                let [a, b] = transform_coords;\r\n                transform_coords = [b, a];\r\n            }\r\n            if (transform_coords[0][0] > transform_coords[1][0]) {\r\n                let a = transform_coords[1][0];\r\n                transform_coords[1][0] = transform_coords[0][0];\r\n                transform_coords[0][0] = a;\r\n            }\r\n            return transform_coords;\r\n        }, (change_coords) => {\r\n            let intersections = find_intersections(change_coords[0]);\r\n            if (intersections[1].length > 0 || intersections[2].length > 0) {\r\n                this.raise('change', {\r\n                    'name': 'intersections',\r\n                    'value': intersections\r\n                });\r\n            }\r\n        });\r\n        this.find_intersections = find_intersections;\r\n    }\r\n}\r\nclass Relative extends Control {\r\n    constructor(spec) {\r\n        spec.class = 'relative';\r\n        super(spec);\r\n    }\r\n}\r\n\r\n//jsgui.Active_HTML_Document = require('./Active_HTML_Document');\r\n\r\njsgui.Control_Data = Control_Data;\r\njsgui.Control_View = Control_View;\r\njsgui.Relative = Relative;\r\njsgui.String_Control = jsgui.controls.String_Control = String_Control;\r\njsgui.HTML_Document = HTML_Document;\r\njsgui.Blank_HTML_Document = Blank_HTML_Document;\r\njsgui.Text_Node = jsgui.controls.Text_Node = jsgui.Text_Node = jsgui.controls.Text_Node = Text_Node;\r\njsgui.Page_Context = Page_Context;\r\njsgui.Selection_Scope = Selection_Scope\r\njsgui.Intersection_Finder = Intersection_Finder;\r\njsgui.parse_mount = parse_mount;\r\njsgui.parse = parse;\r\nmodule.exports = jsgui;", "'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n", "'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , undef;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String|Null} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  try {\n    return decodeURIComponent(input.replace(/\\+/g, ' '));\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Attempts to encode a given input.\n *\n * @param {String} input The string that needs to be encoded.\n * @returns {String|Null} The encoded string.\n * @api private\n */\nfunction encode(input) {\n  try {\n    return encodeURIComponent(input);\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?#&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  while (part = parser.exec(query)) {\n    var key = decode(part[1])\n      , value = decode(part[2]);\n\n    //\n    // Prevent overriding of existing properties. This ensures that build-in\n    // methods like `toString` or __proto__ are not overriden by malicious\n    // querystrings.\n    //\n    // In the case if failed decoding, we want to omit the key/value pairs\n    // from the result.\n    //\n    if (key === null || value === null || key in result) continue;\n    result[key] = value;\n  }\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = []\n    , value\n    , key;\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (key in obj) {\n    if (has.call(obj, key)) {\n      value = obj[key];\n\n      //\n      // Edge cases where we actually want to encode the value to an empty\n      // string instead of the stringified value.\n      //\n      if (!value && (value === null || value === undef || isNaN(value))) {\n        value = '';\n      }\n\n      key = encode(key);\n      value = encode(value);\n\n      //\n      // If we failed to encode the strings, we should bail out as we don't\n      // want to add invalid strings to the query.\n      //\n      if (key === null || value === null) continue;\n      pairs.push(key +'='+ value);\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n", "'use strict';\n\nvar required = require('requires-port')\n  , qs = require('querystringify')\n  , controlOrWhitespace = /^[\\x00-\\x20\\u00a0\\u1680\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]+/\n  , CRHTLF = /[\\n\\r\\t]/g\n  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//\n  , port = /:\\d+$/\n  , protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\\\/]+)?([\\S\\s]*)/i\n  , windowsDriveLetter = /^[a-zA-Z]:/;\n\n/**\n * Remove control characters and whitespace from the beginning of a string.\n *\n * @param {Object|String} str String to trim.\n * @returns {String} A new string representing `str` stripped of control\n *     characters and whitespace from its beginning.\n * @public\n */\nfunction trimLeft(str) {\n  return (str ? str : '').toString().replace(controlOrWhitespace, '');\n}\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  function sanitize(address, url) {     // Sanitize what is left of the address\n    return isSpecial(url.protocol) ? address.replace(/\\\\/g, '/') : address;\n  },\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d*)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @public\n */\nfunction lolcation(loc) {\n  var globalVar;\n\n  if (typeof window !== 'undefined') globalVar = window;\n  else if (typeof global !== 'undefined') globalVar = global;\n  else if (typeof self !== 'undefined') globalVar = self;\n  else globalVar = {};\n\n  var location = globalVar.location || {};\n  loc = loc || location;\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new Url(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new Url(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) continue;\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * Check whether a protocol scheme is special.\n *\n * @param {String} The protocol scheme of the URL\n * @return {Boolean} `true` if the protocol scheme is special, else `false`\n * @private\n */\nfunction isSpecial(scheme) {\n  return (\n    scheme === 'file:' ||\n    scheme === 'ftp:' ||\n    scheme === 'http:' ||\n    scheme === 'https:' ||\n    scheme === 'ws:' ||\n    scheme === 'wss:'\n  );\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @param {Object} location\n * @return {ProtocolExtract} Extracted information.\n * @private\n */\nfunction extractProtocol(address, location) {\n  address = trimLeft(address);\n  address = address.replace(CRHTLF, '');\n  location = location || {};\n\n  var match = protocolre.exec(address);\n  var protocol = match[1] ? match[1].toLowerCase() : '';\n  var forwardSlashes = !!match[2];\n  var otherSlashes = !!match[3];\n  var slashesCount = 0;\n  var rest;\n\n  if (forwardSlashes) {\n    if (otherSlashes) {\n      rest = match[2] + match[3] + match[4];\n      slashesCount = match[2].length + match[3].length;\n    } else {\n      rest = match[2] + match[4];\n      slashesCount = match[2].length;\n    }\n  } else {\n    if (otherSlashes) {\n      rest = match[3] + match[4];\n      slashesCount = match[3].length;\n    } else {\n      rest = match[4]\n    }\n  }\n\n  if (protocol === 'file:') {\n    if (slashesCount >= 2) {\n      rest = rest.slice(2);\n    }\n  } else if (isSpecial(protocol)) {\n    rest = match[4];\n  } else if (protocol) {\n    if (forwardSlashes) {\n      rest = rest.slice(2);\n    }\n  } else if (slashesCount >= 2 && isSpecial(location.protocol)) {\n    rest = match[4];\n  }\n\n  return {\n    protocol: protocol,\n    slashes: forwardSlashes || isSpecial(protocol),\n    slashesCount: slashesCount,\n    rest: rest\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @private\n */\nfunction resolve(relative, base) {\n  if (relative === '') return base;\n\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) unshift = true;\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) path.unshift('');\n  if (last === '.' || last === '..') path.push('');\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * It is worth noting that we should not use `URL` as class name to prevent\n * clashes with the global URL instance that got introduced in browsers.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} [location] Location defaults for relative paths.\n * @param {Boolean|Function} [parser] Parser for the query string.\n * @private\n */\nfunction Url(address, location, parser) {\n  address = trimLeft(address);\n  address = address.replace(CRHTLF, '');\n\n  if (!(this instanceof Url)) {\n    return new Url(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) parser = qs.parse;\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '', location);\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (\n    extracted.protocol === 'file:' && (\n      extracted.slashesCount !== 2 || windowsDriveLetter.test(address)) ||\n    (!extracted.slashes &&\n      (extracted.protocol ||\n        extracted.slashesCount < 2 ||\n        !isSpecial(url.protocol)))\n  ) {\n    instructions[3] = [/(.*)/, 'pathname'];\n  }\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n\n    if (typeof instruction === 'function') {\n      address = instruction(address, url);\n      continue;\n    }\n\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      index = parse === '@'\n        ? address.lastIndexOf(parse)\n        : address.indexOf(parse);\n\n      if (~index) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) url[key] = url[key].toLowerCase();\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // Default to a / for pathname if none exists. This normalizes the URL\n  // to always have a /\n  //\n  if (url.pathname.charAt(0) !== '/' && isSpecial(url.protocol)) {\n    url.pathname = '/' + url.pathname;\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n\n  if (url.auth) {\n    index = url.auth.indexOf(':');\n\n    if (~index) {\n      url.username = url.auth.slice(0, index);\n      url.username = encodeURIComponent(decodeURIComponent(url.username));\n\n      url.password = url.auth.slice(index + 1);\n      url.password = encodeURIComponent(decodeURIComponent(url.password))\n    } else {\n      url.username = encodeURIComponent(decodeURIComponent(url.auth));\n    }\n\n    url.auth = url.password ? url.username +':'+ url.password : url.username;\n  }\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL} URL instance for chaining.\n * @public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || qs.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!required(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) value += ':'+ url.port;\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (port.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    case 'username':\n    case 'password':\n      url[part] = encodeURIComponent(value);\n      break;\n\n    case 'auth':\n      var index = value.indexOf(':');\n\n      if (~index) {\n        url.username = value.slice(0, index);\n        url.username = encodeURIComponent(decodeURIComponent(url.username));\n\n        url.password = value.slice(index + 1);\n        url.password = encodeURIComponent(decodeURIComponent(url.password));\n      } else {\n        url.username = encodeURIComponent(decodeURIComponent(value));\n      }\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();\n  }\n\n  url.auth = url.password ? url.username +':'+ url.password : url.username;\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String} Compiled version of the URL.\n * @public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , host = url.host\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';\n\n  var result =\n    protocol +\n    ((url.protocol && url.slashes) || isSpecial(url.protocol) ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  } else if (url.password) {\n    result += ':'+ url.password;\n    result += '@';\n  } else if (\n    url.protocol !== 'file:' &&\n    isSpecial(url.protocol) &&\n    !host &&\n    url.pathname !== '/'\n  ) {\n    //\n    // Add back the empty userinfo, otherwise the original invalid URL\n    // might be transformed into a valid one with `url.pathname` as host.\n    //\n    result += '@';\n  }\n\n  //\n  // Trailing colon is removed from `url.host` when it is parsed. If it still\n  // ends with a colon, then add back the trailing colon that was removed. This\n  // prevents an invalid URL from being transformed into a valid one.\n  //\n  if (host[host.length - 1] === ':' || (port.test(url.hostname) && !url.port)) {\n    host += ':';\n  }\n\n  result += host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n}\n\nUrl.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nUrl.extractProtocol = extractProtocol;\nUrl.location = lolcation;\nUrl.trimLeft = trimLeft;\nUrl.qs = qs;\n\nmodule.exports = Url;\n", "\r\n\r\n// May need some general purpose traversal functions?\r\nclass Routing_Tree_Node {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        if (spec.handler) this.handler = spec.handler;\r\n        this.mapNormalPathChildren = {};\r\n    }\r\n}\r\nclass Variable_Routing_Tree_Node {\r\n    constructor(spec) {\r\n        this.name = spec.name;\r\n        if (spec.handler) this.handler = spec.handler;\r\n        this.mapNormalPathChildren = {};\r\n    }\r\n}\r\nclass Wildcard_Routing_Tree_Node {\r\n    constructor(spec) {\r\n\r\n    }\r\n}\r\n\r\n// Wildcards having names?\r\n//  Or it just processes the wildcard info as one variable?\r\n\r\n// Want to be able to get the Routing_Tree_Node corresponding with a path\r\n\r\n// Could make this a tree-router\r\n\r\n// Could make this an Evented_Class / observable\r\n//  Evented_Class that raises its own log events.\r\n\r\n\r\n\r\nclass Routing_Tree {\r\n    constructor(spec) {\r\n        this.root = new Routing_Tree_Node();\r\n    }\r\n    get arr_paths() {\r\n        const res = [];\r\n        const iterate = (node) => {\r\n\r\n\r\n            if (node.mapNormalPathChildren) {\r\n                // Object.entries()\r\n                console.log('node.name', node.name);\r\n                const children = Object.entries(node.mapNormalPathChildren);\r\n\r\n                if (children.length > 0) {\r\n                    for (let c = 0; c < children.length; c++) {\r\n                        iterate(children[c]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n    'setRoot404'(handler) {\r\n        this.root404Handler = handler;\r\n    }\r\n    'set'(strRoute, context, handler) {\r\n\r\n        if (!handler) {\r\n            handler = context;\r\n            context = undefined;\r\n        }\r\n        if (strRoute == '/') {\r\n            //console.log('setting root handler');\r\n            //throw 'stop';\r\n            if (context) this.root.context = context;\r\n            this.root.handler = handler;\r\n        } else {\r\n\r\n\r\n            // Maybe make some options / classes to hold options / option sets for URL modification.\r\n\r\n\r\n            // \r\n            // Maybe best not to remove this initial '/'???\r\n\r\n            //if (strRoute.substr(0, 1) == '/') strRoute = strRoute.substr(1);\r\n            // remove any beginning or trailing '/' from the route\r\n\r\n            //if (strRoute.substr(strRoute.length - 1) == '/') strRoute = strRoute.substr(0, strRoute.length - 1);\r\n            //console.log('strRoute ' + strRoute);\r\n            var splitRoute = strRoute.split('/');\r\n\r\n            //console.log('splitRoute', splitRoute);\r\n\r\n            var currentNode = this.root;\r\n\r\n            // traverse through to find the place.\r\n            //  need to deal with creating variable nodes too if needed.\r\n\r\n            var c = 0;\r\n            while (c < splitRoute.length) {\r\n                var strLevel = splitRoute[c];\r\n                var isVariable = strLevel.substr(0, 1) == ':';\r\n                var isWildcard = strLevel == '*';\r\n                if (isVariable) {\r\n                    var variableName = strLevel.substr(1);\r\n                    //console.log('variableName', variableName);\r\n                    if (!currentNode.variableChild) {\r\n                        currentNode.variableChild = new Variable_Routing_Tree_Node({\r\n                            'name': variableName\r\n                        });\r\n                        if (c == splitRoute.length - 1) {\r\n                            currentNode.variableChild.handler = handler;\r\n                            if (context) currentNode.variableChild.context = context;\r\n                        }\r\n                        currentNode = currentNode.variableChild;\r\n                    } else {\r\n                        currentNode = currentNode.variableChild;\r\n                    }\r\n                    //throw '8) stop';\r\n                } else {\r\n                    if (isWildcard) {\r\n                        currentNode.wildcardChild = new Wildcard_Routing_Tree_Node();\r\n                        currentNode.wildcardChild.handler = handler;\r\n                        if (context) currentNode.wildcardChild.context = context;\r\n                    } else {\r\n                        var next_level_node = currentNode.mapNormalPathChildren[strLevel];\r\n                        //console.log('next_level_node', next_level_node);\r\n                        if (!next_level_node) {\r\n                            currentNode.mapNormalPathChildren[strLevel] = new Routing_Tree_Node();\r\n                            next_level_node = currentNode.mapNormalPathChildren[strLevel];\r\n                            // \r\n                            //console.log('should have made node');\r\n                        }\r\n\r\n                        if (c === splitRoute.length - 1) {\r\n                            //console.log('c === splitRoute.length - 1');\r\n                            //console.log('currentNode', currentNode);\r\n                            currentNode.mapNormalPathChildren[strLevel].handler = handler;\r\n                            if (context) currentNode.mapNormalPathChildren[strLevel].context = context;\r\n                        }\r\n                        currentNode = next_level_node;\r\n                        //console.log('new currentNode ' + currentNode);\r\n                    }\r\n                }\r\n                c++;\r\n            }\r\n        }\r\n    }\r\n    'get'(url) {\r\n        // routes the URL through the tree\r\n\r\n        //console.log('router get url: ', url);\r\n        var params;\r\n        if (url == '/') {\r\n            var root = this.root;\r\n            //console.log('root.context', root.context);\r\n            if (root.context) {\r\n                return [root.context, this.root.handler, {}];\r\n            } else {\r\n                var res;\r\n                if (this.root.handler) {\r\n                    res = this.root.handler;\r\n                } else {\r\n                    if (this.root.wildcardChild) {\r\n                        if (this.root.wildcardChild.handler) {\r\n                            if (this.root.wildcardChild.context) {\r\n                                return [this.root.wildcardChild.context, this.root.wildcardChild.handler, {}];\r\n                            } else {\r\n                                return this.root.wildcardChild.handler;\r\n                            }\r\n                            throw 'stop';\r\n                        }\r\n                    }\r\n                }\r\n                return res;\r\n            }\r\n        } else {\r\n            // remove any beginning or trailing '/' from the route???\r\n\r\n\r\n            //if (url.substr(url.length - 1) == '/') url = url.substr(0, url.length - 1);\r\n\r\n            //if (url.substr(0, 1) == '/') url = url.substr(1);\r\n            // process the url to remove the querystring.\r\n            var posQM = url.indexOf('?');\r\n            if (posQM > -1) {\r\n                url = url.substr(0, posQM);\r\n            }\r\n            //console.log('url ' + url);\r\n            var splitUrl = url.split('/');\r\n            var currentNode = this.root;\r\n            // traverse through to find the place.\r\n            var c = 0;\r\n            while (c < splitUrl.length) {\r\n                var strLevel = splitUrl[c];\r\n                if (currentNode) {\r\n                    var next_level_node = currentNode.mapNormalPathChildren[strLevel];\r\n                    if (next_level_node) {\r\n                        //console.log('no next level node'); //???\r\n                    } else {\r\n                        if (currentNode.variableChild) {\r\n                            next_level_node = currentNode.variableChild;\r\n                            //console.log('next_level_node', next_level_node);\r\n                            params = params || {};\r\n                            params[currentNode.variableChild.name] = decodeURI(strLevel);\r\n                        } else {\r\n                            if (currentNode.wildcardChild) {\r\n                                var arr_the_rest = splitUrl.slice(c);\r\n                                //console.log('arr_the_rest', arr_the_rest);\r\n                                var str_wildcard_value = arr_the_rest.join('/');\r\n                                if (url.endsWith('/')) str_wildcard_value += '/';\r\n\r\n                                //console.log('url', url);\r\n                                //console.log(`url.endsWith('/')`, url.endsWith('/'));\r\n                                //console.log('a) str_wildcard_value', str_wildcard_value);\r\n\r\n                                if (currentNode.wildcardChild.context) {\r\n                                    return [currentNode.wildcardChild.context, currentNode.wildcardChild.handler, {\r\n                                        'wildcard_value': str_wildcard_value\r\n                                    }];\r\n                                } else {\r\n                                    return [currentNode.wildcardChild.handler, {\r\n                                        'wildcard_value': str_wildcard_value\r\n                                    }];\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (c === splitUrl.length - 1) {\r\n                    //console.log('the last');\r\n                    //console.log('!!next_level_node', !!next_level_node);\r\n                    if (next_level_node) {\r\n                        //console.log('next_level_node', next_level_node);\r\n                        //console.log('next_level_node.handler ' + next_level_node.handler);\r\n                        if (next_level_node.handler) {\r\n                            if (params) {\r\n                                if (next_level_node.context) {\r\n                                    return [next_level_node.context, next_level_node.handler, params];\r\n                                } else {\r\n                                    return [next_level_node.handler, params];\r\n                                }\r\n                            } else {\r\n                                if (next_level_node.context) {\r\n                                    return [next_level_node.context, next_level_node.handler];\r\n                                } else {\r\n                                    return next_level_node.handler;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            if (next_level_node.wildcardChild) {\r\n                                var arr_the_rest = splitUrl.slice(c);\r\n                                //console.log('arr_the_rest', arr_the_rest);\r\n                                var str_wildcard_value = arr_the_rest.join('/');\r\n                                //console.log('str_wildcard_value', str_wildcard_value);\r\n                                if (params) {\r\n                                    params.wildcard_value = decodeURI(str_wildcard_value);\r\n\r\n                                    if (next_level_node.wildcardChild.context) {\r\n                                        return [next_level_node.wildcardChild.context, next_level_node.wildcardChild.handler, params];\r\n                                    } else {\r\n                                        return [next_level_node.wildcardChild.handler, params];\r\n                                    }\r\n                                } else {\r\n                                    if (next_level_node.wildcardChild.context) {\r\n\r\n                                        return [next_level_node.wildcardChild.context, next_level_node.wildcardChild.handler, params];\r\n                                    } else {\r\n                                        return [next_level_node.wildcardChild.handler, {\r\n                                            'wildcard_value': str_wildcard_value\r\n                                        }];\r\n                                    }\r\n                                }\r\n                            }\r\n                            // Could handle a variable handler here?\r\n                        }\r\n                    } else {\r\n                        if (currentNode) {\r\n                            return [currentNode.handler, params];\r\n                        }\r\n\r\n                    }\r\n                }\r\n                currentNode = next_level_node;\r\n                c++;\r\n            }\r\n            return this.root404Handler;\r\n            // having 404 within websocket connection? why not, when using an internal path.\r\n            //throw '5) stop';\r\n        }\r\n    }\r\n}\r\n\r\nRouting_Tree.Node = Routing_Tree_Node;\r\nRouting_Tree.Variable_Node = Variable_Routing_Tree_Node;\r\nRouting_Tree.Wildcard_Node = Wildcard_Routing_Tree_Node;\r\n\r\nmodule.exports = Routing_Tree;", "// Tree_Router?\r\n\r\n// Somewhat substantial changes with it not removing the first '/'.\r\n\r\nvar url = require('url-parse'),\r\n    //jsgui = require('lang-tools'),\r\n    jsgui = require('lang-tools'),\r\n    //os = require('os'),\r\n    //http = require('http');\r\n    //stringify = jsgui.stringify,\r\n    //each = jsgui.each,\r\n    //arrayify = jsgui.arrayify,\r\n    tof = jsgui.tof;\r\n//var filter_map_by_regex = jsgui.filter_map_by_regex;\r\n//var Class = jsgui.Class,\r\n//    Data_Object = jsgui.Data_Object;\r\n//var fp = jsgui.fp,\r\n//    is_defined = jsgui.is_defined;\r\n//var Collection = jsgui.Collection;\r\nvar get_item_sig = jsgui.get_item_sig;\r\n\r\n// Not a Data_Object.\r\n//  Adding this to a Collection should not put it inside a Data_Object layer.\r\n\r\n// Should make this able to deal with routing to different 'host' value servers.\r\n\r\nconst Routing_Tree = require('./routing-tree');\r\n\r\nconst default_logger = (level, message, meta) => {\r\n    const log_meta = meta && Object.keys(meta).length ? meta : undefined;\r\n    if (level === 'error' && console.error) {\r\n        console.error('[router]', message, log_meta || '');\r\n    } else if (level === 'warn' && console.warn) {\r\n        console.warn('[router]', message, log_meta || '');\r\n    } else if (console.log) {\r\n        console.log('[router]', message, log_meta || '');\r\n    }\r\n};\r\n\r\nconst default_not_found_handler = (req, res) => {\r\n    if (res) {\r\n        if (typeof res.statusCode === 'number') {\r\n            res.statusCode = res.statusCode && res.statusCode !== 200 ? res.statusCode : 404;\r\n        }\r\n        if (typeof res.setHeader === 'function' && !res.headersSent) {\r\n            res.setHeader('Content-Type', 'text/plain; charset=utf-8');\r\n        }\r\n        if (typeof res.end === 'function' && !res.writableEnded) {\r\n            res.end('Not Found');\r\n        }\r\n    }\r\n};\r\n\r\nclass Router {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        //this.set('type_levels', ['router']);\r\n        if (spec.name) {\r\n            this.name = spec.name;\r\n        } else {\r\n            this.name = 'Router';\r\n        }\r\n        this.routing_tree = new Routing_Tree();\r\n        this.logger = spec.logger || default_logger;\r\n        this.handle_not_found_fn = spec.handle_not_found || default_not_found_handler;\r\n        this.handle_error_fn = spec.handle_error;\r\n        this._listeners = new Map();\r\n    }\r\n    on(event_name, handler) {\r\n        if (!handler) return this;\r\n        let set_listeners = this._listeners.get(event_name);\r\n        if (!set_listeners) {\r\n            set_listeners = new Set();\r\n            this._listeners.set(event_name, set_listeners);\r\n        }\r\n        set_listeners.add(handler);\r\n        return this;\r\n    }\r\n    off(event_name, handler) {\r\n        if (!handler) return this;\r\n        const set_listeners = this._listeners.get(event_name);\r\n        if (set_listeners) {\r\n            set_listeners.delete(handler);\r\n            if (set_listeners.size === 0) {\r\n                this._listeners.delete(event_name);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    emit(event_name, ...args) {\r\n        const set_listeners = this._listeners.get(event_name);\r\n        if (!set_listeners || set_listeners.size === 0) return false;\r\n        for (const listener of Array.from(set_listeners)) {\r\n            try {\r\n                listener(...args);\r\n            } catch (err) {\r\n                this._log('error', 'router_listener_error', {\r\n                    event: event_name,\r\n                    error: err\r\n                });\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    _log(level, message, meta) {\r\n        if (this.logger) {\r\n            try {\r\n                this.logger(level, message, meta || {});\r\n            } catch (err) {\r\n                if (console && console.error) {\r\n                    console.error('[router] logger error', err);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    set_logger(fn_logger) {\r\n        this.logger = fn_logger || default_logger;\r\n    }\r\n    set_not_found_handler(fn_handler) {\r\n        this.handle_not_found_fn = fn_handler || default_not_found_handler;\r\n    }\r\n    set_error_handler(fn_handler) {\r\n        this.handle_error_fn = fn_handler;\r\n    }\r\n    'start'(callback) {\r\n        callback(null, true);\r\n    }\r\n    'set_route'(str_route, context, fn_handler) {\r\n        //var rt = this.get('routing_tree');\r\n\r\n        // Routing tree not properly setting routes beginning with '/'?\r\n        this._log('debug', 'set_route', {\r\n            route: str_route\r\n        });\r\n        return this.routing_tree.set(str_route, context, fn_handler);\r\n    }\r\n    'meets_requirements'() {\r\n        return true;\r\n    }\r\n    _invoke_handler(handler, context, req, res, params, result) {\r\n        try {\r\n            if (params && typeof params === 'object') {\r\n                req.params = params;\r\n            }\r\n            if (context) {\r\n                handler.call(context, req, res);\r\n            } else {\r\n                handler(req, res);\r\n            }\r\n            result.handled = true;\r\n            result.params = params;\r\n        } catch (err) {\r\n            result.handled = true;\r\n            result.params = params;\r\n            result.handlerError = err;\r\n            this._log('error', 'handler_error', {\r\n                url: req && req.url,\r\n                error: err,\r\n                params\r\n            });\r\n            this.emit('error', err, {\r\n                req,\r\n                res,\r\n                params,\r\n                handler\r\n            });\r\n            if (this.handle_error_fn) {\r\n                try {\r\n                    this.handle_error_fn(err, req, res, params);\r\n                } catch (secondary_err) {\r\n                    this._log('error', 'error_handler_failure', {\r\n                        url: req && req.url,\r\n                        error: secondary_err\r\n                    });\r\n                    this.emit('error', secondary_err, {\r\n                        req,\r\n                        res,\r\n                        params,\r\n                        handler: this.handle_error_fn,\r\n                        stage: 'error-handler'\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _handle_not_found(req, res, meta, result) {\r\n        const details = Object.assign({\r\n            url: req && req.url\r\n        }, meta || {});\r\n        this._log('warn', 'route_not_found', details);\r\n        this.emit('not-found', {\r\n            req,\r\n            res,\r\n            meta: details\r\n        });\r\n        if (this.handle_not_found_fn) {\r\n            try {\r\n                this.handle_not_found_fn(req, res);\r\n            } catch (err) {\r\n                result.handlerError = err;\r\n                this._log('error', 'not_found_handler_error', {\r\n                    url: req && req.url,\r\n                    error: err\r\n                });\r\n                this.emit('error', err, {\r\n                    req,\r\n                    res,\r\n                    stage: 'not-found'\r\n                });\r\n            }\r\n        }\r\n    }\r\n    get arr_paths() {\r\n        return this.routing_tree.arr_paths;\r\n    }\r\n    'process'(req, res) {\r\n\r\n        const result = {\r\n            handled: false,\r\n            params: undefined,\r\n            handlerError: undefined\r\n        };\r\n\r\n        var rt = this.routing_tree;\r\n\r\n        let parsed_url;\r\n        try {\r\n            parsed_url = url(req.url, true);\r\n        } catch (err) {\r\n            this._log('error', 'url_parse_error', {\r\n                url: req && req.url,\r\n                error: err\r\n            });\r\n            result.handlerError = err;\r\n            this.emit('error', err, {\r\n                req,\r\n                res,\r\n                stage: 'url-parse'\r\n            });\r\n            return result;\r\n        }\r\n\r\n        if (!parsed_url) {\r\n            return result;\r\n        }\r\n\r\n        var route_res = rt.get(req.url);\r\n        var handler;\r\n        var context;\r\n        var params;\r\n\r\n        var route_type = tof(route_res);\r\n\r\n        if (route_type === 'array') {\r\n            var rr_sig = get_item_sig(route_res, 1);\r\n            if (route_res.length === 3) {\r\n                context = route_res[0];\r\n                handler = route_res[1];\r\n                params = route_res[2];\r\n            } else if (rr_sig == '[D,f]') {\r\n                context = route_res[0];\r\n                handler = route_res[1];\r\n            } else if (rr_sig == '[f,o]') {\r\n                handler = route_res[0];\r\n                params = route_res[1];\r\n            } else if (rr_sig == '[o,f]') {\r\n                context = route_res[0];\r\n                handler = route_res[1];\r\n            } else if (route_res.length === 2 && typeof route_res[0] === 'function' && tof(route_res[1]) === 'object') {\r\n                handler = route_res[0];\r\n                params = route_res[1];\r\n            }\r\n        } else if (route_type === 'function') {\r\n            handler = route_res;\r\n        } else if (route_type === 'object' && route_res) {\r\n            if (typeof route_res.handler === 'function') {\r\n                handler = route_res.handler;\r\n                context = route_res.context;\r\n                if (route_res.params) {\r\n                    params = route_res.params;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (handler && typeof handler === 'function') {\r\n            this._invoke_handler(handler, context, req, res, params, result);\r\n            return result;\r\n        }\r\n\r\n        this._handle_not_found(req, res, {\r\n            url: req && req.url\r\n        }, result);\r\n        return result;\r\n    }\r\n}\r\n//Router.prototype.type_levels = ['router'];\r\nRouter.Routing_Tree = Routing_Tree;\r\n\r\nmodule.exports = Router;", "var jsgui = require('lang-tools');\r\n//var Resource = require('./resource');\r\n\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\tarrayify = jsgui.arrayify,\r\n\ttof = jsgui.tof,\r\n\tget_a_sig = jsgui.get_a_sig;\r\nvar filter_map_by_regex = jsgui.filter_map_by_regex;\r\nvar Evented_Class = jsgui.Evented_Class,\r\n\tData_Object = jsgui.Data_Object;\r\nvar fp = jsgui.fp,\r\n\tis_defined = jsgui.is_defined;\r\nvar Collection = jsgui.Collection;\r\n\r\n\r\nclass Resource_Pool extends Evented_Class {\r\n\tconstructor(spec) {\r\n\t\tsuper(spec);\r\n\t\tthis.resources = new Collection({\r\n\t\t\t//'index_by': 'name'\r\n\t\t\t'fn_index': (item) => {\r\n\t\t\t\tvar key = item.name;\r\n\t\t\t\treturn key;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t'add'(obj) {\r\n\t\tvar obj_name = obj.name;\r\n\t\tlet log_trace = () => {\r\n\t\t\tconsole.log('');\r\n\t\t\tconsole.log('** obj_name ' + obj_name);\r\n\t\t\tconsole.trace();\r\n\t\t\tconsole.log('');\r\n\t\t}\r\n\t\t//log_trace();\r\n\t\t// Items able to name themselves?\r\n\r\n\t\tif (obj_name === undefined) {\r\n\t\t\tconsole.log('obj', obj);\r\n\t\t\tconsole.trace();\r\n\t\t\tthrow 'Resource_Pool.add(undefined) error';\r\n\t\t}\r\n\t\tif (this.has_resource(obj_name)) {\r\n\t\t\tthrow 'Resource pool already has resource with name ' + obj_name;\r\n\t\t} else {\r\n\t\t\tthis.resources.add(obj);\r\n\t\t\tobj.pool = this;\r\n\t\t\tif (obj.name !== undefined) {\r\n\t\t\t\tObject.defineProperty(this, obj.name, {\r\n\t\t\t\t\tget() {\r\n\t\t\t\t\t\treturn obj;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.raise_event('added', obj);\r\n\t\t}\r\n\t}\r\n\t'push'(obj) {\r\n\t\treturn this.add(obj);\r\n\t}\r\n\t'has_resource'() {\r\n\t\tconst a = arguments;\r\n\t\t//a.l = arguments.length;\r\n\t\tconst sig = get_a_sig(a, 1);\r\n\t\t//return is_defined(this._dict_resources[resource_name]);\r\n\t\t//return\r\n\t\tif (sig == '[s]') {\r\n\t\t\t// one string value, that will be the value of the unique primary index\r\n\t\t\tconst obj_lookup_val = a[0];\r\n\t\t\treturn this.resources.has(obj_lookup_val);\r\n\t\t}\r\n\t}\r\n\tget resource_names() {\r\n\t\tvar res = [];\r\n\t\teach(this.resources, (resource) => {\r\n\t\t\tres.push(resource.name);\r\n\t\t})\r\n\t\treturn res;\r\n\t}\r\n\t'get_resource'() {\r\n\t\tvar a = arguments;\r\n\t\ta.l = arguments.length;\r\n\t\tvar sig = get_a_sig(a, 1);\r\n\r\n\t\tif (sig === '[s]') {\r\n\t\t\tvar obj_lookup_val = a[0];\r\n\t\t\tvar find_result = this.resources.find(obj_lookup_val);\r\n\t\t\tif (find_result) {\r\n\t\t\t\tvar res = find_result;\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\t'count'() {\r\n\t\treturn this.resources.length;\r\n\t}\r\n\t// May be useful to have a callback parameter here rather than just publish / subscribe.\r\n\r\n\t'start'(callback) {\r\n\t\tvar arr_resources_meeting_requirements = [];\r\n\t\tthis.resources.each(function (v, i) {\r\n\t\t\tvar mr = v.meets_requirements();\r\n\t\t\tif (mr) {\r\n\t\t\t\tarr_resources_meeting_requirements.push(v);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar l_resources = this.resources.length();\r\n\t\tif (arr_resources_meeting_requirements.length === l_resources) {\r\n\t\t\tvar fns = [];\r\n\t\t\tvar num_to_start = arr_resources_meeting_requirements.length;\r\n\t\t\tvar num_starting = 0,\r\n\t\t\t\tnum_started = 0;\r\n\t\t\tvar cb = function (err, start_res) {\r\n\t\t\t\tnum_starting--;\r\n\t\t\t\tnum_started++;\r\n\t\t\t\t//console.log('cb');\r\n\t\t\t\t//console.log('num_started ' + num_started);\r\n\r\n\t\t\t\tif (num_started == num_to_start) {\r\n\t\t\t\t\tif (callback) callback(null, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\teach(arr_resources_meeting_requirements, resource_ready_to_start => {\r\n\t\t\t\tresource_ready_to_start.start(cb);\r\n\t\t\t\tnum_starting++;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports = Resource_Pool;", "    // Want to get the core resources working and tested.\r\n//  Want to run a clock website / service to start with.\r\n//  The server could have a clock, while clients could connect to it and share the information.\r\n//  Could also experiment with P2P distribution of the data.\r\n//  A clock is also useful because it contains time signals so we can see how long it takes for data to reach various machines.\r\n\r\n\r\n// Intersted in having a remote Linux computer.\r\n//  Ability to SSH into it and run commands.\r\n\r\n// Want to be able to remotely configure and access a Raspberry Pi as a Resource.\r\n\r\nvar jsgui = require('lang-tools');\r\n\r\n//const {Evented_Class} = jsgui;\r\n\r\nvar Pool = require('./pool');\r\n\r\nconst Evented_Class = jsgui.Evented_Class;\r\nvar Class = jsgui.Class, Collection = jsgui.Collection;\r\nvar is_defined = jsgui.is_defined, fp = jsgui.fp, stringify = jsgui.stringify, tof = jsgui.tof;\r\nvar call_multi = jsgui.call_multi, get_a_sig = jsgui.get_a_sig;\r\nvar each = jsgui.each;\r\n\r\n\r\n// Data_Resource extends Evented_Class\r\n//  or it's itself observable\r\n// Evented_Class with the observable events and API.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Could move this to its own module.\r\n\r\n// Make Resource extend Evented_Class\r\n\r\n// Then could move it outside of jsgui3\r\n\r\n\r\n// Status to see if a resource has started or not?\r\n//  I think resource status is important.\r\n//  However status may entail more things.\r\n//   status.phase\r\n//   phase\r\n\r\n// meta.phase\r\n\r\n// A resource's context matters.\r\n//  It will be the server rather than a page context.\r\n\r\n\r\n\r\n// Resources can have events as well.\r\n//  Look into how the publisher deals with them.\r\n\r\n// A Data_Resource? Data_KV_Resource?\r\n//  get, set?\r\n\r\n// Also want Data_Transform_Resource.\r\n//  And they should work both locally and remotely.\r\n\r\n\r\n\r\n// Data_Transform_Resource:\r\n//  .transform\r\n//  no .get no .set\r\n\r\n\r\nclass Resource extends Evented_Class {\r\n    // The link between the abstract resource and the resource on the internet / network / computer.\r\n    //'fields': {\r\n    //\t//'meta': Data_Object\r\n    //\t'meta': 'data_object'\r\n    //},\r\n\r\n    // Problem with how it sets the fields.\r\n\r\n    constructor(spec) {\r\n        //console.log('Resource init');\r\n        //\r\n        if (!is_defined(spec)) spec = {};\r\n\r\n        super(spec);\r\n\r\n        if (spec.name) this.name = spec.name;\r\n        if (spec.pool) this.pool = spec.pool;\r\n\r\n        if (is_defined(spec.startup_type)) {\r\n            //this.set('startup_type', spec.startup_type);\r\n            this.startup_type = spec.startup_type;\r\n        }\r\n\r\n        this.getters = {};\r\n        this.setters = {};\r\n\r\n    }\r\n\r\n    'start'(callback) {\r\n        // check the requirements\r\n\r\n        callback(null, true);\r\n\r\n        //  check requirements recursive - checks the requirements of everything required, and if they have the check_requirements function, it uses that.\r\n        //   I think using the system of names APIs will help here.\r\n\r\n        // I think the base class should raise the event.\r\n\r\n        //this.trigger('start');\r\n\r\n        //console.log(new Error().stack);\r\n        //throw 'no start function defined for resource (subclass)'\r\n    }\r\n\r\n    // meets_requirements\r\n    //  check if all the prerequisite resources are active\r\n    //  maybe check for login status if applicable.\r\n\r\n    'meets_requirements'() {\r\n        // Likely will be part of Status\r\n\r\n        //return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    // 'get' will be the function to use.\r\n\r\n    // may have toJson / to_json.\r\n    'get_abstract'() {\r\n\r\n        // Abstract_Resource - would be a description of a resource?\r\n        //  Perhaps we'll only need json and json schema.\r\n        //  Making the data_object and collection conform to json schema would be nice.\r\n        //  Would have something very nice to do with creating a gui for forms.\r\n        /*\r\n\r\n\r\n        var res = new AR.Abstract_Resource({\r\n\r\n        })\r\n        */\r\n    }\r\n\r\n    'authenticate'(token) {\r\n        //console.log('basic resource authenticate');\r\n        return true;\r\n    }\r\n\r\n    // Resources could also operate in connected mode.\r\n    //  How the connection gets handled will be outside of the scope of the resource itself.\r\n\r\n    // the last item in the signature is the callback\r\n\r\n    /*\r\n\r\n    'set'(name, value, callback) {\r\n        var al = arguments.length;\r\n\r\n        // self setter?\r\n\r\n        if (al === 3) {\r\n            if (this.setters[name]) {\r\n                this.setters[name](value, callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    'get'(name, callback) {\r\n        var al = arguments.length;\r\n        if (al === 2) {\r\n            if (this.getters[name]) {\r\n                this.getters[name](callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    */\r\n}\r\n\r\nResource.Pool = Pool;\r\n\r\n// Resource.Data_Transform etc...\r\n\r\n\r\n\r\nmodule.exports = Resource;\r\n\t//return Resource;\r\n//});\r\n\r\n", "    // Want to get the core resources working and tested.\r\n//  Want to run a clock website / service to start with.\r\n//  The server could have a clock, while clients could connect to it and share the information.\r\n//  Could also experiment with P2P distribution of the data.\r\n//  A clock is also useful because it contains time signals so we can see how long it takes for data to reach various machines.\r\n\r\n\r\n// Intersted in having a remote Linux computer.\r\n//  Ability to SSH into it and run commands.\r\n\r\n// Want to be able to remotely configure and access a Raspberry Pi as a Resource.\r\n\r\nvar jsgui = require('lang-tools');\r\n\r\n//const {Evented_Class} = jsgui;\r\n\r\nvar Pool = require('./pool');\r\n\r\nconst Evented_Class = jsgui.Evented_Class;\r\nvar Class = jsgui.Class, Collection = jsgui.Collection;\r\nvar is_defined = jsgui.is_defined, fp = jsgui.fp, stringify = jsgui.stringify, tof = jsgui.tof;\r\nvar call_multi = jsgui.call_multi, get_a_sig = jsgui.get_a_sig;\r\nvar each = jsgui.each;\r\n\r\nconst Resource = require('./resource');\r\n// Data_Resource extends Evented_Class\r\n//  or it's itself observable\r\n// Evented_Class with the observable events and API.\r\n\r\n\r\n\r\n\r\nclass Data_KV_Resource extends Resource {\r\n    // The link between the abstract resource and the resource on the internet / network / computer.\r\n    //'fields': {\r\n    //\t//'meta': Data_Object\r\n    //\t'meta': 'data_object'\r\n    //},\r\n\r\n    // Problem with how it sets the fields.\r\n\r\n    constructor(spec) {\r\n        //console.log('Resource init');\r\n        //\r\n        if (!is_defined(spec)) spec = {};\r\n\r\n        super(spec);\r\n\r\n        if (is_defined(spec.name)) {\r\n            // Need to deal with both resource properties and inner properties.\r\n            //  Not sure about having resource.set('name') naming the resource.\r\n            //   Sounds OK normally, but Resource needs to be flexible, eg a resource could provide\r\n            //   translations of a work to a different language, so get('name') needs to just be calling\r\n            //   the resource with that value.\r\n\r\n            // Perhaps some kind of inner get and set?\r\n            // Or inner is the normal.\r\n            //  An object to represent a resource's external properties?\r\n\r\n            // Could have .name for it's name\r\n            //  or .self for a Data_Object that refers to itself.\r\n            //  or .inner or .resource for the Data_Object that is the resource's inner data?\r\n            //  .data\r\n\r\n            // I like having .get and .set for dealing with the resource's data.\r\n            //  and different ways for indexing the resource.\r\n\r\n            // .metadata\r\n\r\n            // and name is part of the metadata.\r\n\r\n            // this.set('meta.name')\r\n\r\n            // This way there is a .meta object which holds the name\r\n\r\n\r\n\r\n\r\n            //this.set('meta.name', spec.name);\r\n        }\r\n\r\n        if (spec.name) this.name = spec.name;\r\n        if (spec.pool) this.pool = spec.pool;\r\n\r\n        /*\r\n        this.meta = new Data_Object({\r\n            'fields': {\r\n                name: 'string'\r\n            }\r\n        });\r\n        */\r\n\r\n        // But give the resource name in the spec?\r\n        //  That may be the best way of doing it, but it's not the API for now.\r\n\r\n        /*\r\n\r\n        if (spec.meta) {\r\n            var meta = spec.meta;\r\n            if (meta.name) this.meta.set('name', meta.name);\r\n            //console.log('meta.name ' + meta.name);\r\n        }\r\n        */\r\n        // Set the meta url in the client side resource.\r\n\r\n        if (is_defined(spec.startup_type)) {\r\n            //this.set('startup_type', spec.startup_type);\r\n            this.startup_type = spec.startup_type;\r\n        }\r\n\r\n        this.getters = {};\r\n        this.setters = {};\r\n\r\n    }\r\n\r\n    'start'(callback) {\r\n        // check the requirements\r\n\r\n        callback(null, true);\r\n\r\n        //  check requirements recursive - checks the requirements of everything required, and if they have the check_requirements function, it uses that.\r\n        //   I think using the system of names APIs will help here.\r\n\r\n        // I think the base class should raise the event.\r\n\r\n        //this.trigger('start');\r\n\r\n        //console.log(new Error().stack);\r\n        //throw 'no start function defined for resource (subclass)'\r\n    }\r\n\r\n    // meets_requirements\r\n    //  check if all the prerequisite resources are active\r\n    //  maybe check for login status if applicable.\r\n\r\n    'meets_requirements'() {\r\n        // Likely will be part of Status\r\n\r\n        //return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    // 'get' will be the function to use.\r\n\r\n    // may have toJson / to_json.\r\n    'get_abstract'() {\r\n\r\n        // Abstract_Resource - would be a description of a resource?\r\n        //  Perhaps we'll only need json and json schema.\r\n        //  Making the data_object and collection conform to json schema would be nice.\r\n        //  Would have something very nice to do with creating a gui for forms.\r\n        /*\r\n\r\n\r\n        var res = new AR.Abstract_Resource({\r\n\r\n        })\r\n        */\r\n    }\r\n\r\n    'authenticate'(token) {\r\n        //console.log('basic resource authenticate');\r\n        return true;\r\n    }\r\n\r\n    // Resources could also operate in connected mode.\r\n    //  How the connection gets handled will be outside of the scope of the resource itself.\r\n\r\n    // the last item in the signature is the callback\r\n\r\n    'set'(name, value, callback) {\r\n        var al = arguments.length;\r\n\r\n        // self setter?\r\n\r\n        if (al === 3) {\r\n            if (this.setters[name]) {\r\n                this.setters[name](value, callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    'get'(name, callback) {\r\n        var al = arguments.length;\r\n        if (al === 2) {\r\n            if (this.getters[name]) {\r\n                this.getters[name](callback);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nResource.Pool = Pool;\r\n\r\nmodule.exports = Data_KV_Resource;\r\n\t//return Resource;\r\n//});\r\n", "    // Want to get the core resources working and tested.\r\n//  Want to run a clock website / service to start with.\r\n//  The server could have a clock, while clients could connect to it and share the information.\r\n//  Could also experiment with P2P distribution of the data.\r\n//  A clock is also useful because it contains time signals so we can see how long it takes for data to reach various machines.\r\n\r\n\r\n// Intersted in having a remote Linux computer.\r\n//  Ability to SSH into it and run commands.\r\n\r\n// Want to be able to remotely configure and access a Raspberry Pi as a Resource.\r\n\r\nvar jsgui = require('lang-tools');\r\n\r\n//const {Evented_Class} = jsgui;\r\n\r\nvar Pool = require('./pool');\r\n\r\nconst Evented_Class = jsgui.Evented_Class;\r\nvar Class = jsgui.Class, Collection = jsgui.Collection;\r\nvar is_defined = jsgui.is_defined, fp = jsgui.fp, stringify = jsgui.stringify, tof = jsgui.tof;\r\nvar call_multi = jsgui.call_multi, get_a_sig = jsgui.get_a_sig;\r\nvar each = jsgui.each;\r\n\r\nconst Resource = require('./resource');\r\n// Data_Resource extends Evented_Class\r\n//  or it's itself observable\r\n// Evented_Class with the observable events and API.\r\n\r\n// A resource here to populate HTML templates?\r\n\r\n// Looks programatically like the right place for JSX compilation.\r\n//  Keep that on the server for the moment.\r\n\r\n// Compiling jsx to js?\r\n// data pipeline type work...? render data to an HTML template?\r\n\r\n\r\n\r\n\r\n\r\n// Could (in theory at least here) be a remote resource.\r\n\r\n// Could be a streaming codec, remote or local, even a codec suite.\r\nclass Data_Transform_Resource extends Resource {\r\n    // The link between the abstract resource and the resource on the internet / network / computer.\r\n    //'fields': {\r\n    //\t//'meta': Data_Object\r\n    //\t'meta': 'data_object'\r\n    //},\r\n\r\n    // Problem with how it sets the fields.\r\n\r\n    // JSON input data description info object\r\n    // JSON output data description info object\r\n    // JSON transformation data description info object.\r\n\r\n    // .info\r\n    // .meta.info\r\n\r\n    // Will be POJOs.???\r\n\r\n    // .i.i .i.o .i.t\r\n    //  input schema, output schema, transformation function\r\n    //  make it possible to express the algo here / in the constructor.\r\n    //  also should be able to work remotely when the resource is remote.\r\n\r\n    // .m.i.i\r\n\r\n\r\n    constructor(spec) {\r\n        //console.log('Resource init');\r\n        if (!is_defined(spec)) spec = {};\r\n\r\n        super(spec);\r\n\r\n        if (is_defined(spec.name)) {\r\n        }\r\n\r\n        if (spec.name) this.name = spec.name;\r\n        if (spec.pool) this.pool = spec.pool;\r\n\r\n        const meta = {\r\n            info: {},\r\n            fn: {}\r\n        };\r\n\r\n        Object.defineProperty(this, 'meta', {\r\n            get() {\r\n                return meta;\r\n            }\r\n        });\r\n        Object.defineProperty(this, 'm', {\r\n            get() {\r\n                return meta;\r\n            }\r\n        });\r\n        Object.defineProperty(meta, 'i', {\r\n            get() {\r\n                return meta.info;\r\n            }\r\n        });\r\n        Object.defineProperty(meta, 'fns', {\r\n            get() {\r\n                return meta.fn;\r\n            }\r\n        });\r\n\r\n        Object.defineProperty(meta, 'fn', {\r\n            get() {\r\n                return meta.fn;\r\n            }\r\n        });\r\n        Object.defineProperty(meta, 'f', {\r\n            get() {\r\n                return meta.fn;\r\n            }\r\n        });\r\n\r\n        if (spec.fn_transform) {\r\n            if (tof(spec.transform) === 'function') {\r\n                meta.fn.transform = spec.fn_transform;\r\n            } else {\r\n\r\n            }\r\n        }\r\n\r\n        // this.m.f\r\n\r\n        // setter for the meta function transform property?\r\n\r\n        // meta.fn_transform\r\n        // meta.fn_validate_input\r\n        // meta.fn_validate_output\r\n\r\n\r\n\r\n\r\n        /*\r\n        this.meta = new Data_Object({\r\n            'fields': {\r\n                name: 'string'\r\n            }\r\n        });\r\n        */\r\n\r\n        // But give the resource name in the spec?\r\n        //  That may be the best way of doing it, but it's not the API for now.\r\n\r\n        /*\r\n\r\n        if (spec.meta) {\r\n            var meta = spec.meta;\r\n            if (meta.name) this.meta.set('name', meta.name);\r\n            //console.log('meta.name ' + meta.name);\r\n        }\r\n        */\r\n        // Set the meta url in the client side resource.\r\n\r\n        if (is_defined(spec.startup_type)) {\r\n            //this.set('startup_type', spec.startup_type);\r\n            this.startup_type = spec.startup_type;\r\n        }\r\n\r\n        //this.getters = {};\r\n        //this.setters = {};\r\n\r\n    }\r\n\r\n    'start'(callback) {\r\n        // check the requirements\r\n\r\n        callback(null, true);\r\n\r\n        //  check requirements recursive - checks the requirements of everything required, and if they have the check_requirements function, it uses that.\r\n        //   I think using the system of names APIs will help here.\r\n\r\n        // I think the base class should raise the event.\r\n\r\n        //this.trigger('start');\r\n\r\n        //console.log(new Error().stack);\r\n        //throw 'no start function defined for resource (subclass)'\r\n    }\r\n\r\n    // meets_requirements\r\n    //  check if all the prerequisite resources are active\r\n    //  maybe check for login status if applicable.\r\n\r\n    'meets_requirements'() {\r\n        // Likely will be part of Status\r\n\r\n        //return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    // 'get' will be the function to use.\r\n\r\n    // may have toJson / to_json.\r\n    'get_abstract'() {\r\n        // Abstract_Resource - would be a description of a resource?\r\n        //  Perhaps we'll only need json and json schema.\r\n        //  Making the data_object and collection conform to json schema would be nice.\r\n        //  Would have something very nice to do with creating a gui for forms.\r\n        /*\r\n        var res = new AR.Abstract_Resource({\r\n\r\n        })\r\n        */\r\n    }\r\n\r\n    'authenticate'(token) {\r\n        //console.log('basic resource authenticate');\r\n        return true;\r\n    }\r\n\r\n    // Resources could also operate in connected mode.\r\n    //  How the connection gets handled will be outside of the scope of the resource itself.\r\n\r\n    // the last item in the signature is the callback\r\n\r\n    'transform'(value, options) {\r\n        // returning an observable seems best...?\r\n        //  or an easy to use stream?\r\n\r\n        // need specific transform implementation for that resource.\r\n        //  maybe filling in values within an HTML template.\r\n\r\n        throw 'Need specific implementation';\r\n\r\n    }\r\n}\r\n\r\nResource.Pool = Pool;\r\n\r\nmodule.exports = Data_Transform_Resource;\r\n\t//return Resource;\r\n//});\r\n", "\r\n\r\n\r\nconst Data_Transform_Resource = require('./data-transform-resource');\r\n\r\n// Could be the place for compilations...\r\n// Or land-tools, later lang-mini.\r\n\r\n// Multiple compilers...\r\n\r\n\r\n\r\nclass Compilation_Resource extends Data_Transform_Resource {\r\n    constructor(spec) {\r\n\r\n        // What types of code go in and out?\r\n\r\n        super(spec);\r\n\r\n\r\n        // Could hold multiple compilers.\r\n\r\n        // Needs to direct to the correct compiler.\r\n\r\n        // query_compiler_resources(input_lang, output_lang)\r\n        \r\n\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    // Which languages?\r\n    //  String names\r\n    //  Or objects describing the languages / formats....\r\n\r\n    // With templating, will need to provide it with various values as well....\r\n    //  A single values object should be OK.\r\n    //   Or a promise / observable that will return them.\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // Could be either remote or local....\r\n    // Call through web API, other means, or directly calling a function in the JS codebase.\r\n    \r\n\r\n\r\n\r\n}\r\n\r\nmodule.exports = Compilation_Resource;", "\r\n\r\n\r\nconst Data_Transform_Resource = require('./data-transform-resource');\r\n\r\n// Could be the place for compilations...\r\n// Or land-tools, later lang-mini.\r\n\r\n// Multiple compilers...\r\n\r\n// Could be accessible by function call, http api call, maybe path and fs based.\r\n\r\n// Actual Lang / Language objects may be of use for setting up and correctly referencing / logging compilations.\r\n\r\n// Language\r\n// Version\r\n// Language_Version\r\n\r\n\r\n// Maybe building into lang-tools would be better.\r\n\r\n// class Programming_Language\r\n//  Could get into detailed definitions / descriptions.\r\n//   Could wind up large and complex, a lot of info represented.\r\n\r\n// Bringing some compilation to the client side in the longer run may be very helpful.\r\n//  Or option of bringing compilation to client side.\r\n\r\n\r\n\r\n\r\n// An instance of this could be compiler_babel.\r\n\r\n\r\n\r\nclass Compiler_Resource extends Data_Transform_Resource {\r\n    constructor(spec) {\r\n\r\n        // What types of code go in and out?\r\n\r\n        // input.lang\r\n        // output.lang\r\n\r\n\r\n        super(spec);\r\n\r\n\r\n    }\r\n\r\n\r\n    // Which languages?\r\n    //  String names\r\n    //  Or objects describing the languages / formats....\r\n\r\n    // With templating, will need to provide it with various values as well....\r\n    //  A single values object should be OK.\r\n    //   Or a promise / observable that will return them.\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // Could be either remote or local....\r\n    // Call through web API, other means, or directly calling a function in the JS codebase.\r\n    \r\n\r\n\r\n\r\n}\r\n\r\nmodule.exports = Compiler_Resource;", "const jsgui = require('../../../../html-core/html-core');\r\n\r\nconst {Blank_HTML_Document} = jsgui;\r\n\r\n\r\n\r\nclass Active_HTML_Document extends Blank_HTML_Document {\r\n\r\n\r\n\r\n    constructor(spec = {}) {\r\n        //console.log('Client_HTML_Document');\r\n        super(spec);\r\n        //spec.context.ctrl_document = this;\r\n        this.active();\r\n    }\r\n\r\n    // Seems a bit like 'view features'.\r\n\r\n    'include_js'(url) {\r\n        /*\r\n        Add it to the end of the body instead.\r\n        */\r\n        //var head = this.get('head');\r\n        const body = this.get('body');\r\n        var script = new jsgui.script({\r\n            //<script type=\"text/JavaScript\" src=\"abc.js\"></script>\r\n            'context': this.context\r\n        });\r\n        var dom = script.dom;\r\n        var domAttributes = dom.attributes;\r\n        domAttributes.type = 'text/javascript';\r\n        domAttributes.src = url;\r\n        body.add(script);\r\n    }\r\n\r\n    'include_css'(url) {\r\n        var head = this.get('head');\r\n        var link = new jsgui.link({\r\n            //<script type=\"text/JavaScript\" src=\"abc.js\"></script>\r\n            'context': this.context\r\n        })\r\n        // <script data-main=\"scripts/main\" src=\"scripts/require.js\"></script>\r\n        var dom = link.dom;\r\n        var domAttributes = dom.attributes;\r\n        domAttributes['rel'] = 'stylesheet';\r\n        domAttributes['type'] = 'text/css';\r\n        //domAttributes.set('src', '/js/require.js');\r\n        domAttributes['href'] = url;\r\n        head.content.add(link);\r\n    }\r\n\r\n    'include_jsgui_client'(js_file_require_data_main) {\r\n        js_file_require_data_main = js_file_require_data_main || '/js/web/jsgui-html-client';\r\n        var head = this.head;\r\n        var body = this.body;\r\n        var script = new jsgui.script({\r\n            //<script type=\"text/JavaScript\" src=\"abc.js\"></script>\r\n            'context': this.context\r\n        })\r\n        var domAttributes = script.dom.attributes;\r\n        domAttributes.set({\r\n            'type': 'text/javascript',\r\n            'src': '/js/web/require.js',\r\n            'data-main': js_file_require_data_main\r\n        });\r\n        body.add(script);\r\n    }\r\n    'include_client_css'() {\r\n        var head = this.get('head');\r\n        var link = new jsgui.link({\r\n            //<script type=\"text/JavaScript\" src=\"abc.js\"></script>\r\n            'context': this.context\r\n        });\r\n        var domAttributes = link.dom.attributes;\r\n        domAttributes.rel = 'stylesheet';\r\n        domAttributes.type = 'text/css';\r\n        domAttributes.href = '/css/basic.css';\r\n        head.content.add(link);\r\n        // <link rel=\"stylesheet\" type=\"text/css\" href=\"theme.css\">\r\n    }\r\n    // also need to include jsgui client css\r\n}\r\n\r\nmodule.exports = Active_HTML_Document;", "const jsgui = require('../../../../../html-core/html-core');\r\n\r\n// This may be a simple one to include .view.model but no .data.model (perhaps???)\r\n\r\n// It does not really deal with / interact with data in a model itself, though it itself could do with a .view.ui.data.model.\r\n\r\n// no view.data.model though....\r\n\r\n// view.ui.data.model would be a decent place to hold an abstraction about what kind of presentation options the control has.\r\n\r\n// view.ui.data.model.size for example.\r\n//    could even be a string like 'x-small', 'micro', 'normal', 'compact', 'large', 'fully-expanded'???, 'very-large'.\r\n//      or an enumeration of strings / values like that.\r\n// That would be a level further abstracted from the DOM.\r\n//   Would want to listen to that property change to sync with other parts of the (inner control) system.\r\n\r\n// .view.ui.data.model.icon ????\r\n//    By putting things behind these various objects, can be as clear as possible about them, if it's found there is too much typing,\r\n//      could even make a higher level interface on top of this, could simplify access to it.\r\n\r\n// Eg setting ctrl.size automatically sets ctrl.view.ui.data.model.size.\r\n\r\n\r\n\r\nvar Control = jsgui.Control;\r\n\r\nclass Button extends Control {\r\n    constructor(spec = {}, add, make) {\r\n        spec.__type_name = spec.__type_name || 'button';\r\n        spec.tag_name = 'button';\r\n        super(spec);\r\n        this.add_class('button');\r\n        if (spec.text || spec.label) {\r\n            this.text = spec.text || spec.label;\r\n        }\r\n        if (!spec.el) {\r\n            this.compose_button();\r\n        }\r\n    }\r\n    'compose_button'() {\r\n        if (this.text) {\r\n            this.add(this.text);\r\n        }\r\n    }\r\n    'activate'() {\r\n        super.activate();\r\n    }\r\n}\r\nmodule.exports = Button;\r\n\r\nif (require.main === module) {\r\n    class London_Button extends Button {\r\n        constructor(spec = {}, add, make) {\r\n            // Call the superclass constructor with the spec, add, and make arguments.\r\n            spec.text = \"London, England\";\r\n            super(spec, add, make);\r\n    \r\n            // Set the text property of the London_Button to \"London, England\".\r\n            //this.text = \"London, England\";\r\n        }\r\n    }\r\n    const lbtn = new London_Button();\r\n    console.log(lbtn.all_html_render());\r\n}", "var jsgui = require('../../../../../html-core/html-core');\r\nvar Control = jsgui.Control;\r\nlet def = jsgui.is_defined;\r\nconst Button = require('../../0-basic/0-native-compositional/button');\r\n\r\nclass Arrow_Button extends Button {\r\n    constructor(spec, add, make) {\r\n        // Wont fields have been set?\r\n        //spec['class'] = spec['class'] || 'button';\r\n\r\n\r\n        spec.size = spec.size || [32, 32];\r\n\r\n        spec.text = undefined;\r\n        spec.__type_name = spec.__type_name || 'arrow_button';\r\n        super(spec);\r\n        //this.__type_name = 'button';\r\n\r\n\r\n        /*\r\n\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 350 100\">\r\n        <defs>\r\n            <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"7\" \r\n            refX=\"0\" refY=\"3.5\" orient=\"auto\">\r\n            <polygon points=\"0 0, 10 3.5, 0 7\" />\r\n            </marker>\r\n        </defs>\r\n        <line x1=\"0\" y1=\"50\" x2=\"250\" y2=\"50\" stroke=\"#000\" \r\n        stroke-width=\"8\" marker-end=\"url(#arrowhead)\" />\r\n        </svg>\r\n\r\n        */\r\n\r\n        // It's rotation.\r\n        //  .rotation property\r\n\r\n        // get and set?\r\n\r\n        // Could have an Angle class that handles both degrees, radians, and proportion of full rotation (meaning proportion of 2 pi radians)\r\n\r\n        // half radians being a useful angle measurement.\r\n        //  hr\r\n\r\n        //console.log('spec.direction', spec.direction);\r\n\r\n        let rotation = 0;\r\n        \r\n        Object.defineProperty(this, 'rotation', {\r\n            // Using shorthand method names (ES2015 feature).\r\n            // This is equivalent to:\r\n            // get: function() { return bValue; },\r\n            // set: function(newValue) { bValue = newValue; },\r\n            get() {\r\n                return rotation;\r\n            },\r\n            set(value) {\r\n                rotation = value;\r\n                this.raise('change', {\r\n                    'name': 'rotation',\r\n                    'value': value\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n\r\n        let direction;\r\n\r\n        this.on('change', e => {\r\n            if (e.name === 'rotation') {\r\n                this.line.dom.attributes.transform = 'rotate(' + e.value + ', 50, 50)';\r\n                this.polygon.dom.attributes.transform = 'rotate(' + e.value + ', 50, 50)';\r\n            }\r\n            if (e.name === 'direction') {\r\n                //console.log('e', e);\r\n                //line.dom.attributes.transform = 'rotate(' + e.value + ', 50, 50)';\r\n                if (e.value === 'left') this.rotation = 270;\r\n                if (e.value === 'up') this.rotation = 0;\r\n                if (e.value === 'right') this.rotation = 90;\r\n                if (e.value === 'down') this.rotation = 180;\r\n            }\r\n        });\r\n        \r\n        Object.defineProperty(this, 'direction', {\r\n            // Using shorthand method names (ES2015 feature).\r\n            // This is equivalent to:\r\n            // get: function() { return bValue; },\r\n            // set: function(newValue) { bValue = newValue; },\r\n            get() {\r\n                return direction;\r\n            },\r\n            set(value) {\r\n                direction = value;\r\n                //console.log('pre raise change - direction');\r\n                this.raise('change', {\r\n                    'name': 'direction',\r\n                    'value': value\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        if (def(spec.rotation)) {\r\n            rotation = spec.rotation;\r\n        }\r\n\r\n        //  || spec.no_compose === true\r\n        if (!spec.el) {\r\n            this.compose_arrow_button();\r\n\r\n        }\r\n        if (def(spec.direction)) {\r\n            //console.log('spec.direction', spec.direction);\r\n            // do want to change it\r\n            this.direction = spec.direction;\r\n            \r\n        }\r\n    }\r\n\r\n    'compose_arrow_button' () {\r\n        this.add_class('arrow');\r\n        //this.add_class('button');\r\n        // Want to have a system of accessing icons.\r\n        //  Will be possible to do using a Postgres website db resource\r\n        //   First want it working from disk though.\r\n\r\n        // A way not to add the text like this to start with?\r\n        //  Or just don't inherit from a button in some cases when we don't want this?\r\n\r\n        // direction...\r\n        //  left, l, r, right, u, ur, ru\r\n        //   possibly express with angles in degrees and radians.\r\n\r\n        // An arrow glyph with rotation would be cool.\r\n        //  For the moment, I think SVG rendering would work the best.\r\n\r\n        // Could give it an Arrow control as background.\r\n        //  Not ready for background controls yet though.\r\n\r\n        let svg = this.svg = new jsgui.svg({\r\n            'context': this.context\r\n        });\r\n        svg.dom.attributes.viewBox = \"0 0 100 100\";\r\n\r\n        // include all in a group\r\n\r\n\r\n\r\n        /*\r\n\r\n        let svgdefs = new jsgui.defs({\r\n            'context': this.context\r\n        });\r\n        this.svg.add(svgdefs);\r\n\r\n        let marker = new jsgui.marker({\r\n            'context': this.context\r\n        })\r\n        marker.dom.attributes.id = 'arrowhead';\r\n        marker.dom.attributes.markerWidth = 10;\r\n        marker.dom.attributes.markerHeight = 7;\r\n        marker.dom.attributes.refX = 2;\r\n        marker.dom.attributes.refY = 3.5;\r\n        marker.dom.attributes.orient = 'auto';\r\n        svgdefs.add(marker);\r\n\r\n        */\r\n\r\n\r\n        let polygon = this.polygon = new jsgui.polygon({\r\n            context: this.context\r\n        })\r\n        //polygon.dom.attributes.points = '0 0, 3 3.5, 0 7';\r\n        polygon.dom.attributes.points = '50 0, 70 20, 30 20';\r\n\r\n        // Polygon fill won't change with css\r\n        //polygon.dom.attributes.fill = '#FF0000';\r\n        //marker.add(polygon);\r\n\r\n        let line = this.line = new jsgui.line({\r\n            'context': this.context,\r\n\r\n        });\r\n\r\n        /*\r\n        line.dom.attributes.x1 = 96;\r\n        line.dom.attributes.y1 = 50;\r\n        line.dom.attributes.x2 = 10;\r\n        line.dom.attributes.y2 = 50;\r\n        */\r\n\r\n        // Could work these out based on rotation maths.\r\n\r\n        line.dom.attributes.x1 = 50;\r\n        line.dom.attributes.y1 = 96;\r\n        line.dom.attributes.x2 = 50;\r\n        line.dom.attributes.y2 = 10;\r\n\r\n        //  transform=\"rotate(100)\"\r\n\r\n        // then rotation angle.\r\n        //  could be given as a fraction of 2pi (full rotation radians).\r\n\r\n        // A 'rotation' mixin perhaps.\r\n\r\n        line.dom.attributes.transform = 'rotate(' + this.rotation + ', 50, 50)';\r\n        polygon.dom.attributes.transform = 'rotate(' + this.rotation + ', 50, 50)';\r\n        \r\n\r\n\r\n\r\n        //line.dom.attributes.stroke = '#000000';\r\n        //line.dom.attributes['marker-end'] = 'url(#arrowhead)';\r\n        line.dom.attributes['stroke-width'] = 8;\r\n\r\n        svg.add(line);\r\n        svg.add(polygon);\r\n\r\n\r\n        this.add(svg);\r\n    }\r\n    'activate' () {\r\n        super.activate();\r\n    }\r\n}\r\nmodule.exports = Arrow_Button;", "const {\r\n\tprop,\r\n\tfield\r\n} = require('obext');\r\nconst {\r\n\teach,\r\n\ttof\r\n} = require('lang-tools');\r\nlet dragable = (ctrl, opts = {}) => {\r\n\tlet {\r\n\t\tbounds,\r\n\t\thandle,\r\n\t\tmode,\r\n\t\tstart_action,\r\n\t\tcondition\r\n\t} = opts;\r\n\tstart_action = start_action || ['touchstart', 'mousedown'];\r\n\tif (tof(start_action) === 'string') start_action = [start_action];\r\n\tlet bounds_pos;\r\n\tlet bounds_is_parent = bounds && bounds === ctrl.parent;\r\n\tif (bounds === 'parent') {\r\n\t\tbounds = ctrl.parent;\r\n\t\tbounds_is_parent = true;\r\n\t}\r\n\tif (bounds) {\r\n\t\tbounds_pos = bounds.pos || [bounds.dom.el.offsetLeft, bounds.dom.el.offsetTop];\r\n\t}\r\n\thandle = handle || ctrl;\r\n\tconst old_dragable = ctrl.dragable;\r\n\r\n\tif (old_dragable) {\r\n\t\tconsole.trace();\r\n\t\tthrow 'NYI / Deprecated';\r\n\t}\r\n\r\n\tlet drag_mode = opts.drag_mode || opts.mode || 'translate';\r\n\tif (bounds_is_parent) {\r\n\t}\r\n\tlet pos_md, pos_mm, pos_mu, pos_md_within_ctrl;\r\n\r\n\r\n\tconst setup_isomorphic = () => {\r\n        const old_silent = ctrl.view.data.model.mixins.silent;\r\n        ctrl.view.data.model.mixins.silent = true;\r\n        ctrl.view.data.model.mixins.push({\r\n            name: 'dragable'\r\n        });\r\n        ctrl.view.data.model.mixins.silent = old_silent;\r\n        field(ctrl, 'dragable');\r\n    }\r\n    setup_isomorphic();\r\n\r\n    if (typeof document === 'undefined') {\r\n        ctrl.on('server-pre-render', e => {\r\n            //console.log('selectable server-pre-render');\r\n\r\n            if (ctrl.dragable === true) {\r\n                ctrl._fields = ctrl._fields || {};\r\n                //ctrl._fields.selected = ctrl.selected;\r\n\r\n                ctrl._fields.dragable = true;\r\n\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n\tif (ctrl.dom.el) {\r\n\t\tlet ctrl_body = ctrl.context.body();\r\n\t\tlet dragging = false;\r\n\t\tlet drag_offset_distance = opts.start_distance || 6;\r\n\t\tlet movement_offset;\r\n\t\tlet item_start_pos;\r\n\t\tlet bounds_size;\r\n\t\tlet bounds_offset;\r\n\t\tlet half_item_width, item_width;\r\n\t\tlet initial_bounds_bcr, initial_bcr;\r\n\t\tlet initial_bcr_offset_from_bounds;\r\n\t\tconst el = ctrl.dom.el;\r\n\t\tlet ctrl_translation3d = new Float32Array(3);   \r\n\t\tlet initial_ctrl_translation3d;\r\n\t\tlet initial_ctrl_translate;\r\n\t\tconst begin_drag = (pos) => {\r\n\t\t\tinitial_bcr = ctrl.bcr();\r\n\t\t\tif (bounds) {\r\n\t\t\t\tif (typeof bounds.bcr === 'function') {\r\n\t\t\t\t\tinitial_bounds_bcr = bounds.bcr();\r\n\t\t\t\t\tinitial_bcr_offset_from_bounds = [\r\n\t\t\t\t\t\t[initial_bcr[0][0] - initial_bounds_bcr[0][0], initial_bcr[0][1] - initial_bounds_bcr[0][1]],\r\n\t\t\t\t\t\t[initial_bcr[1][0] - initial_bounds_bcr[1][0], initial_bcr[1][1] - initial_bounds_bcr[1][1]],\r\n\t\t\t\t\t\t[initial_bcr[2][0] - initial_bounds_bcr[2][0], initial_bcr[2][1] - initial_bounds_bcr[2][1]]\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (drag_mode === 'within-parent') {\r\n\t\t\t\tdragging = true;\r\n\t\t\t\titem_start_pos = ctrl.pos;\r\n\t\t\t\tconst ctrl_pos_to_be = [item_start_pos[0] - movement_offset[0], item_start_pos[1] - movement_offset[1]];\r\n\t\t\t\tctrl.pos = ctrl_pos_to_be;\r\n\t\t\t} else if (drag_mode === 'translate') {\r\n\t\t\t\t// Capture current translate position at drag start to avoid jumping after resize\r\n\t\t\t\tinitial_ctrl_translate = ctrl.ta.slice(6, 8);\r\n\t\t\t\tdragging = true;\r\n\t\t\t} else {\r\n\t\t\t\tif (drag_mode === 'x') {\r\n\t\t\t\t\tdragging = true;\r\n\t\t\t\t\titem_start_pos = ctrl.pos || [ctrl.dom.el.offsetLeft, ctrl.dom.el.offsetTop];\r\n\t\t\t\t\thalf_item_width = Math.round(ctrl.dom.el.offsetWidth / 2);\r\n\t\t\t\t\titem_width = (ctrl.dom.el.offsetWidth);\r\n\t\t\t\t\tbounds_offset = [bounds.dom.el.offsetLeft, bounds.dom.el.offsetTop];\r\n\t\t\t\t\tctrl.pos = [item_start_pos[0] + movement_offset[0], item_start_pos[1]];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('drag_mode', drag_mode);\r\n\t\t\t\t\tthrow 'NYI';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctrl.raise('dragstart');\r\n\t\t}\r\n\t\tconst move_drag = (pos) => {\r\n\t\t\tlet ctrl_size = [ctrl.dom.el.offsetWidth, ctrl.dom.el.offsetHeight];\r\n\t\t\tif (drag_mode === 'translate') {\r\n\t\t\t\tlet tr_x = movement_offset[0] + initial_ctrl_translate[0];\r\n\t\t\t\tlet tr_y = movement_offset[1] + initial_ctrl_translate[1];\r\n\t\t\t\tif (bounds) {\r\n\t\t\t\t\t// Get current bounds BCR (allows for dynamic bounds updates if bounds move/resize)\r\n\t\t\t\t\tconst current_bounds_bcr = bounds.bcr();\r\n\t\t\t\t\t// Calculate absolute containment bounds within parent\r\n\t\t\t\t\tconst bounds_left = current_bounds_bcr[0][0];\r\n\t\t\t\t\tconst bounds_top = current_bounds_bcr[0][1];\r\n\t\t\t\t\tconst bounds_right = current_bounds_bcr[1][0] - ctrl_size[0];\r\n\t\t\t\t\tconst bounds_bottom = current_bounds_bcr[1][1] - ctrl_size[1];\r\n\t\t\t\t\t// Convert absolute bounds to movement offsets relative to initial translate position\r\n\t\t\t\t\tconst min_x_offset = bounds_left - initial_ctrl_translate[0];\r\n\t\t\t\t\tconst max_x_offset = bounds_right - initial_ctrl_translate[0];\r\n\t\t\t\t\tconst min_y_offset = bounds_top - initial_ctrl_translate[1];\r\n\t\t\t\t\tconst max_y_offset = bounds_bottom - initial_ctrl_translate[1];\r\n\t\t\t\t\t// Apply containment constraints\r\n\t\t\t\t\tif (tr_x < min_x_offset) tr_x = min_x_offset;\r\n\t\t\t\t\tif (tr_x > max_x_offset) tr_x = max_x_offset;\r\n\t\t\t\t\tif (tr_y < min_y_offset) tr_y = min_y_offset;\r\n\t\t\t\t\tif (tr_y > max_y_offset) tr_y = max_y_offset;\r\n\t\t\t\t}\r\n\t\t\t\tctrl.ta[6] = tr_x;\r\n\t\t\t\tctrl.ta[7] = tr_y;\r\n\t\t\t} else if (drag_mode === 'within-parent') {\r\n\t\t\t\tbounds = bounds || ctrl.parent;\r\n\t\t\t\tbounds_size = bounds.bcr()[2];\r\n\t\t\t\tlet new_pos = [item_start_pos[0] + movement_offset[0], item_start_pos[1] + movement_offset[1]];\r\n\t\t\t\tif (new_pos[0] < 0) new_pos[0] = 0;\r\n\t\t\t\tif (new_pos[1] < 0) new_pos[1] = 0;\r\n\t\t\t\tif (new_pos[0] > bounds_size[0] - ctrl_size[0]) new_pos[0] = bounds_size[0] - ctrl_size[0];\r\n\t\t\t\tif (new_pos[1] > bounds_size[1] - ctrl_size[1]) new_pos[1] = bounds_size[1] - ctrl_size[1];\r\n\t\t\t\tctrl.pos = new_pos;\r\n\t\t\t} else if (drag_mode === 'x') {\r\n\t\t\t\tbounds_size = [bounds.dom.el.offsetWidth, bounds.dom.el.offsetHeight];\r\n\t\t\t\tlet new_pos = [item_start_pos[0] + movement_offset[0], item_start_pos[1]];\r\n\t\t\t\tif (new_pos[0] < bounds_pos[0] - half_item_width) new_pos[0] = bounds_pos[0] - half_item_width;\r\n\t\t\t\tif (new_pos[0] > bounds_size[0] - ctrl_size[0] + bounds_offset[0] + half_item_width) new_pos[0] = bounds_size[0] - ctrl_size[0] + bounds_offset[0] + half_item_width;\r\n\t\t\t\tctrl.pos = new_pos;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst body_mm = e_mm => {\r\n\t\t\tlet touch_count = 0;\r\n\t\t\tif (e_mm.touches) touch_count = e_mm.touches.length;\r\n\t\t\tif (e_mm.touches) {\r\n\t\t\t\tpos_mm = [e_mm.pageX || e_mm.touches[0].pageX, e_mm.pageY || e_mm.touches[0].pageY];\r\n\t\t\t} else {\r\n\t\t\t\tpos_mm = [e_mm.pageX, e_mm.pageY];\r\n\t\t\t}\r\n\t\t\tif (touch_count === 0 || touch_count === 1) {\r\n\t\t\t\tif (e_mm.buttons === 0) {\r\n\t\t\t\t\tbody_mu();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (e_mm.pageX || e_mm.touches) {\r\n\t\t\t\t\t\tlet pos_mm;\r\n\t\t\t\t\t\tif (e_mm.touches) {\r\n\t\t\t\t\t\t\tpos_mm = [e_mm.pageX || e_mm.touches[0].pageX, e_mm.pageY || e_mm.touches[0].pageY];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpos_mm = [e_mm.pageX, e_mm.pageY];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (pos_mm[0] !== undefined && pos_mm[1] !== undefined) {\r\n\t\t\t\t\t\t\tmovement_offset = [pos_mm[0] - pos_md[0], pos_mm[1] - pos_md[1]];\r\n\t\t\t\t\t\t\tif (!dragging) {\r\n\t\t\t\t\t\t\t\tlet abs_offset = [Math.abs(movement_offset[0]), Math.abs(movement_offset[1])];\r\n\t\t\t\t\t\t\t\tlet abs_offset_dist = Math.sqrt(Math.pow(abs_offset[0], 2) + Math.pow(abs_offset[1], 2));\r\n\t\t\t\t\t\t\t\tif (abs_offset_dist >= drag_offset_distance) {\r\n\t\t\t\t\t\t\t\t\tbegin_drag(pos_mm);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmove_drag(pos_mm);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst end_drag = e_mu => {\r\n\t\t\tctrl_body.off('mousemove', body_mm);\r\n\t\t\tctrl_body.off('mouseup', body_mu);\r\n\t\t\tctrl_body.off('touchmove', body_mm);\r\n\t\t\tctrl_body.off('touchend', body_mu);\r\n\t\t\tif (dragging) {\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tctrl.raise('dragend', {\r\n\t\t\t\t\tmovement_offset: movement_offset\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst body_mu = e_mu => {\r\n\t\t\tend_drag(e_mu);\r\n\t\t}\r\n\t\tconst h_md = (e_md) => {\r\n\t\t\tif (!condition || condition()) {\r\n\t\t\t\tif (e_md.pageX) {\r\n\t\t\t\t\tpos_md_within_ctrl = [e_md.offsetX, e_md.offsetX];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos_md_within_ctrl = [0, 0];\r\n\t\t\t\t}\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tpos_md = [e_md.pageX || e_md.touches[0].pageX, e_md.pageY || e_md.touches[0].pageY];\r\n\t\t\t\tctrl_body.on('mousemove', body_mm);\r\n\t\t\t\tctrl_body.on('mouseup', body_mu);\r\n\t\t\t\tctrl_body.on('touchmove', body_mm);\r\n\t\t\t\tctrl_body.on('touchend', body_mu);\r\n\t\t\t}\r\n\t\t}\r\n\t\tctrl.on('change', e_change => {\r\n\t\t\tlet n = e_change.name,\r\n\t\t\t\tvalue = e_change.value;\r\n\t\t\tif (n === 'dragable') {\r\n\t\t\t\tif (value === true) {\r\n\t\t\t\t\tif (typeof document === 'undefined') {} else {\r\n\t\t\t\t\t\tlet apply_start_handlers = (start_action) => {\r\n\t\t\t\t\t\t\tif (!handle.has_drag_md_handler) {\r\n\t\t\t\t\t\t\t\thandle.has_drag_md_handler = true;\r\n\t\t\t\t\t\t\t\teach(start_action, sa => {\r\n\t\t\t\t\t\t\t\t\thandle.on(sa, h_md);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tctrl.once_active(() => {\r\n\t\t\t\t\t\t\tapply_start_handlers(start_action);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (typeof document === 'undefined') {} else {\r\n\t\t\t\t\t\t(start_action => {\r\n\t\t\t\t\t\t\teach(start_action, sa => {\r\n\t\t\t\t\t\t\t\thandle.off(sa, h_md);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})(start_action);\r\n\t\t\t\t\t\thandle.has_drag_md_handler = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t\r\n\tif (!old_dragable) {\r\n\t\t\r\n\t\t\r\n\t}\r\n\t//if (old_dragable !== undefined) {\r\n\t//\tctrl.dragable = old_dragable;\r\n\t//}\r\n}\r\nmodule.exports = dragable;", "const jsgui = require('./../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\ttof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\nvar v_subtract = jsgui.v_subtract;\r\n\r\n\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\n\r\n/*\r\n 'fields': [\r\n ['min', Number],\r\n ['max', Number],\r\n ['value', Number],\r\n ['drag_mode', String]\r\n ],\r\n */\r\n\r\nconst {\r\n\tprop,\r\n\tfield\r\n} = require('obext');\r\n\r\nconst mx_dragable = require('./../../../../control_mixins/dragable');\r\n\r\nclass Horizontal_Slider extends Control {\r\n\t// fields... text, value, type?\r\n\t//  type could specify some kind of validation, or also 'password'.\r\n\r\n\t// single field?\r\n\r\n\t//  and can have other fields possibly.\r\n\r\n\t// This should be customizable in which values it holds.\r\n\t//  For the moment, set up the value range on the server, and send that to the client as fields which we get back from the DOM when\r\n\t//  the Control gets activated.\r\n\r\n\t// I think this can take a min, a max, and a value.\r\n\t//  Perhaps operating in 'proportion' mode between 0 and 1 is easiest?\r\n\t//  Also having it handle time values - could use ms.\r\n\r\n\r\n\t// Basically, this needs to be told its min value, its max value, and its current value.\r\n\r\n\t// Also, want 'ghost' drag mode so that the handle can be dragged, and only changes position on release\r\n\t//  For different scrubber behaviour to what is in the iPod app.\r\n\r\n\tconstructor(spec, add, make) {\r\n\t\tspec.__type_name = spec.__type_name || 'horizontal_slider';\r\n\t\tsuper(spec);\r\n\r\n\t\t// Want a 'ghost' drag mode.\r\n\t\t//console.log('spec.min', spec.min);\r\n\t\t//console.log('spec.max', spec.max);\r\n\t\t//console.trace();\r\n\r\n\t\tfield(this, 'min', spec.min || 0);\r\n\t\tfield(this, 'value', spec.value || 0);\r\n\t\tfield(this, 'max', spec.max || 100);\r\n\r\n\t\tif (!spec.el) {\r\n\t\t\tthis.compose_horizontal_slider();\r\n\t\t}\r\n\t}\r\n\t'compose_horizontal_slider'() {\r\n\t\tlet h_bar, v_bar;\r\n\t\tconst context = this.context;\r\n\r\n\t\tlet div_relative = this.add(new Control({\r\n\t\t\t'class': 'relative',\r\n\t\t\t'context': context\r\n\t\t}));\r\n\t\tthis.add_class('horizontal slider');\r\n\r\n\t\t// Then we add the bar over the width.\r\n\t\t(h_bar = new Control({\r\n\t\t\t'class': 'h-bar',\r\n\t\t\t'context': context\r\n\t\t}));\r\n\t\t(v_bar = new Control({\r\n\t\t\t'class': 'v-bar',\r\n\t\t\t'context': context\r\n\t\t}));\r\n\r\n\t\tdiv_relative.add(h_bar);\r\n\t\tdiv_relative.add(v_bar);\r\n\r\n\t\tlet ctrl_fields = {\r\n\t\t\t'div_relative': div_relative,\r\n\t\t\t'h_bar': h_bar,\r\n\t\t\t'v_bar': v_bar\r\n\t\t}\r\n\r\n\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\tObject.assign(this._ctrl_fields, ctrl_fields);\r\n\t}\r\n\t'activate'() {\r\n\r\n\t\tif (!this.__active) {\r\n\t\t\tsuper.activate();\r\n\t\t\tconsole.log('Horizontal Slider activate');\r\n\t\t\t// Also need to deal with touch events.\r\n\t\t\t//  I think that touch tolerance would do the job.\r\n\t\t\t//  Need to find the right trick to use for this, if there is one.\r\n\t\t\t// Could probably work using a lower level touch API\r\n\t\t\t//  Detect if the touch is near the item we want to drag.\r\n\t\t\t// Perhaps touch tolerance could be done by using a larger touch overlay, or touch handle.\r\n\r\n\t\t\t//var that = this;\r\n\r\n\t\t\t//var div_relative = this.get('div_relative');\r\n\t\t\tvar h_bar = this.h_bar;\r\n\t\t\tvar v_bar = this.v_bar;\r\n\r\n\t\t\tmx_dragable(v_bar, {\r\n\t\t\t\tmode: 'x',\r\n\t\t\t\tbounds: h_bar,\r\n\t\t\t\tstart_distance: 1\r\n\t\t\t});\r\n\t\t\tv_bar.dragable = true;\r\n\r\n\t\t\t// drag complete event...\r\n\t\t\tv_bar.on('dragend', e_complete => {\r\n\t\t\t\t//console.log('v_bar e_complete', e_complete);\r\n\t\t\t\t//console.trace();\r\n\r\n\t\t\t\t//console.log('drag-complete');\r\n\r\n\t\t\t\tlet bar_left = v_bar.dom.el.offsetLeft;\r\n\t\t\t\t// Then subtract the left of the h bar.\r\n\t\t\t\tlet h_v_width = Math.round(v_bar.dom.el.offsetWidth / 2);\r\n\r\n\t\t\t\t//let bar_x = bar_left - (h_bar.dom.el.offsetLeft + h_v_width);\r\n\t\t\t\tlet bar_x = bar_left - (h_v_width);\r\n\r\n\t\t\t\tlet h_width = h_bar.dom.el.offsetWidth;\r\n\r\n\t\t\t\t//console.log('bar_x', bar_x);\r\n\t\t\t\t//console.log('h_width', h_width);\r\n\r\n\t\t\t\tlet prop = bar_x / h_width;\r\n\r\n\t\t\t\t//console.log('prop', prop);\r\n\r\n\t\t\t\t//console.log('[bar_x, prop]', [bar_x, prop]);\r\n\r\n\t\t\t\t// then work out the value out of the range\r\n\r\n\t\t\t\tlet range_diff = this.max - this.min;\r\n\t\t\t\t//console.log('range_diff', range_diff);\r\n\t\t\t\tlet v = (prop * range_diff) + this.min;\r\n\t\t\t\t//console.log('v', v);\r\n\t\t\t\tthis._.value = v;\r\n\r\n\t\t\t\tthis.raise('choose-value', v);\r\n\r\n\t\t\t\t//this.value = v;\r\n\r\n\r\n\r\n\t\t\t});\r\n\r\n\t\t\tthis.on('change', (e_change) => {\r\n\t\t\t\tvar name = e_change.name,\r\n\t\t\t\t\tvalue = e_change.value;\r\n\t\t\t\t//console.log('h slider change', e_change);\r\n\t\t\t\t//console.trace();\r\n\r\n\t\t\t\tif (name === 'value') {\r\n\t\t\t\t\t// h_bar\r\n\r\n\t\t\t\t\tthis.bar_value = value;\r\n\t\t\t\t}\r\n\t\t\t\t// \r\n\t\t\t});\r\n\r\n\r\n\t\t\tthis.on('resize', e => {\r\n\t\t\t\t// move the var to the point at given value\r\n\t\t\t\t//console.log('resize');\r\n\t\t\t\t//console.log('this.value', this.value);\r\n\r\n\t\t\t\tthis.bar_value = this._.value;\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t//var ghost_v_bar;\r\n\r\n\t\t\t//console.log('h_bar', h_bar);\r\n\t\t\t//console.log('v_bar', v_bar);\r\n\t\t\t/*\r\n\t\t\tvar size = this.bcr()[2];\r\n\t\t\tconsole.log('Horizontal Slider size', size);\r\n\r\n\t\t\tvar size_v_bar = this.v_bar.bcr()[2];\r\n\r\n\r\n\t\t\tvar w_v_bar = size_v_bar[0];\r\n\t\t\tvar h_w_v_bar = w_v_bar / 2;\r\n\r\n\r\n\t\t\tvar h_bar_width = this.v_bar.bcr()[2][0];\r\n\t\t\t*/\r\n\t\t\t/*\r\n\r\n\t\t\tvar h_padding = 5;\r\n\r\n\t\t\tvar h_bar_width = size[0] - h_padding * 2;\r\n\r\n\r\n\t\t\tthis.h_bar.style({\r\n\t\t\t\t'width': h_bar_width + 'px'\r\n\t\t\t});\r\n\r\n\t\t\t*/\r\n\r\n\t\t\t/*\r\n\r\n\t\t\tvar ctrl_html_root = this.context.ctrl_document;\r\n\r\n\t\t\t// have lower level drag working on the h_bar?\r\n\t\t\t//  want some kind of flexible drag, but that could be done while cutting out code.\r\n\t\t\t//  for the moment, will do the eventhandlers?\r\n\t\t\t//   generic drag handlers would be useful for touch interfaces as well.\r\n\r\n\t\t\tvar pos_down, pos_current, pos_offset;\r\n\r\n\t\t\tvar orig_v_bar_l = parseInt(this.v_bar.style('left'), 10);\r\n\t\t\tvar new_v_bar_l;\r\n\r\n\t\t\t//console.log('orig_v_bar_l', orig_v_bar_l);\r\n\r\n\t\t\tvar drag_mode;\r\n\r\n\t\t\tvar prop;\r\n\r\n\t\t\tvar ctrl_ghost_v_bar;\r\n\t\t\tvar context = this.context;\r\n\r\n\t\t\tvar v_bar_center_pos;\r\n\t\t\tvar v_bar_center_pos_when_pressed;\r\n\t\t\t*/\r\n\r\n\t\t\t\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\t}\r\n\r\n\tset bar_value(value) {\r\n\t\t//console.log('set bar_value', value);\r\n\t\tconst {\r\n\t\t\th_bar,\r\n\t\t\tv_bar\r\n\t\t} = this;\r\n\t\tvar min = this.min;\r\n\t\tvar max = this.max;\r\n\r\n\r\n\r\n\t\tlet prop = (value - min) / (max - min);\r\n\t\t//console.log('prop', prop);\r\n\t\tvar size_h_bar = h_bar.size || [h_bar.dom.el.offsetWidth, h_bar.dom.el.offsetHeight];\r\n\t\tlet v_bar_center_pos = Math.round((size_h_bar[0] * prop)) + h_bar.dom.el.offsetLeft;\r\n\t\tlet v_bar_left_pos = v_bar_center_pos - Math.round(v_bar.dom.el.offsetWidth / 2);\r\n\r\n\t\t// then the left pos\r\n\t\t//v_bar.style('left', v_bar_left_pos + 'px');\r\n\r\n\t\t// no, work out where the top should go.\r\n\r\n\t\tlet v_bar_top = v_bar.dom.el.offsetTop;\r\n\r\n\t\t//console.log('v_bar.pos', v_bar.pos);\r\n\t\tif (v_bar.pos) {\r\n\t\t\t\r\n\r\n\t\t\t//console.log('v_bar.pos', v_bar.pos);\r\n\t\t\t//console.log('v_bar.pos[1]', v_bar.pos[1]);\r\n\t\t\tv_bar.pos = [v_bar_left_pos, v_bar.pos[1]];\r\n\t\t} else {\r\n\t\t\tv_bar.dom.attributes.style.left = v_bar_left_pos;\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\t\r\n\r\n\t\t//console.log('set bar_value', value);\r\n\t\t//console.trace();\r\n\r\n\t\tthis._.value = value;\r\n\t}\r\n}\r\nmodule.exports = Horizontal_Slider;", "// Vertical_Expander\r\nconst jsgui = require('./../../../../html-core/html-core');\r\n\r\n\r\nvar Horizontal_Slider = require('./horizontal-slider');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\nvar v_subtract = jsgui.v_subtract;\r\n\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\nclass Audio_Volume extends Control {\r\n\t// fields... text, value, type?\r\n\t//  type could specify some kind of validation, or also 'password'.\r\n\r\n\t// single field?\r\n\t//'fields': [\r\n\t//\t['text', String]\r\n\t//],\r\n\t//  and can have other fields possibly.\r\n\r\n\tconstructor(spec, add, make) {\r\n\t\tsuper(spec);\r\n\t\tthis.__type_name = 'audio_volume';\r\n\r\n\t\tif (!spec.abstract && !spec.el) {\r\n\r\n\t\t\tthis.add_class('audio-volume');\r\n\t\t\t// the bar at the top.\r\n\r\n\t\t\t// It's going to act as a drag handle for this.\r\n\t\t\t//  The drag system will integrate with various bands / window positions.\r\n\t\t\t// Maybe a property to say that it's dockable.\r\n\r\n\t\t\t//var top_bar = new Control({\r\n\t\t\t//\t'context': this.context\r\n\t\t\t//})\r\n\t\t\t//top_bar.set('dom.attributes.class', 'title bar');\r\n\t\t\t//this.add(top_bar);\r\n\r\n\t\t\tvar h_slider = add(Horizontal_Slider({\r\n\t\t\t\t'min': 0,\r\n\t\t\t\t'max': 100,\r\n\t\t\t\t'value': 100\r\n\t\t\t}));\r\n\r\n\t\t\tvar ctrl_fields = {\r\n\t\t\t\t'h_slider': h_slider._id()\r\n\t\t\t}\r\n\r\n\t\t\t//this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n\t\t\tthis.active();\r\n\t\t}\r\n\t}\r\n\t'activate'() {\r\n\t\tsuper.activate();\r\n\t\tconsole.log('Audio Volume activate');\r\n\r\n\t\tvar h_slider = this.h_slider;\r\n\t}\r\n}\r\n\r\nmodule.exports = Audio_Volume;", "const {\r\n    prop,\r\n    field\r\n} = require('obext');\r\nconst {each, is_array, is_def} = require('lang-mini');\r\n\r\n// Listening to a pre-server-side-render or pre-ssr event would help with persisting some things.\r\n// Maybe want some more specific view data model persistance.\r\n\r\n// server-pre-render event I think.\r\n\r\n// Being able to say a grid is selectable or has selectableness, ie the grid cells can be selected.\r\n\r\nconst selectable = (ctrl, ctrl_handle, opts) => {\r\n    const setup_isomorphic = () => {\r\n        const old_silent = ctrl.view.data.model.mixins.silent;\r\n        ctrl.view.data.model.mixins.silent = true;\r\n        ctrl.view.data.model.mixins.push({\r\n            name: 'selectable'\r\n        });\r\n        ctrl.view.data.model.mixins.silent = old_silent;\r\n        ctrl.on('change', e_change => {\r\n            let {\r\n                name,\r\n                value\r\n            } = e_change;\r\n            if (name === 'selected') {\r\n                if (value) {\r\n                    ctrl.add_class('selected');\r\n                } else {\r\n                    ctrl.remove_class('selected');\r\n                }\r\n            };\r\n            return true;\r\n        });\r\n    }\r\n    setup_isomorphic();\r\n\r\n    if (typeof document === 'undefined') {\r\n        ctrl.on('server-pre-render', e => {\r\n            //console.log('selectable server-pre-render');\r\n\r\n            if (ctrl.selectable === true) {\r\n                ctrl._fields = ctrl._fields || {};\r\n                //ctrl._fields.selected = ctrl.selected;\r\n\r\n                ctrl._fields.selectable = true;\r\n\r\n                if (ctrl.selected === true) {\r\n                    ctrl._fields.selected = true;\r\n                }\r\n\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    if (ctrl.dom.el) {\r\n        let select_toggle = false;\r\n        let select_multi = false;\r\n        let condition;\r\n        let preventDefault = true;\r\n        let selection_action = ['mousedown', 'touchstart'];\r\n\r\n        const old_selectable = ctrl.selectable;\r\n\r\n\r\n        if (old_selectable) {\r\n            console.trace();\r\n            throw 'NYI / Deprecated';\r\n        } else {\r\n            if (!opts) {\r\n                if (ctrl_handle) {\r\n                    if (!ctrl_handle.activate) {\r\n                        opts = ctrl_handle;\r\n                        ctrl_handle = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (opts) {\r\n                if (opts.handle) {\r\n                    ctrl_handle = opts.handle;\r\n                }\r\n                if (opts.select_toggle || opts.toggle) {\r\n                    select_toggle = true;\r\n                }\r\n                if (opts.select_multi || opts.multi) {\r\n                    select_multi = true;\r\n                }\r\n                if (opts.single) {\r\n                    select_multi = false;\r\n                }\r\n                if (opts.selection_action) {\r\n                    selection_action = opts.selection_action;\r\n                }\r\n                if (opts.condition) {\r\n                    condition = opts.condition;\r\n                }\r\n                if (opts.preventDefault === false) {\r\n                    preventDefault = false;\r\n                }\r\n            }\r\n            ctrl_handle = ctrl_handle || ctrl;\r\n            \r\n            let click_handler = (e) => {\r\n                if (ctrl.selectable && !ctrl.selection_scope && !ctrl.disabled) {\r\n                    if (!condition || condition()) {\r\n                        var ctrl_key = e.ctrlKey;\r\n                        var meta_key = e.metaKey;\r\n                        if (select_multi) {\r\n                            if ((ctrl_key || meta_key)) {\r\n                                ctrl.action_select_toggle();\r\n                            } else {\r\n                                if (select_toggle) {\r\n                                    ctrl.action_select_toggle();\r\n                                } else {\r\n                                    ctrl.action_select_only();\r\n                                }\r\n                            }\r\n                        } else {\r\n                            if (select_toggle) {\r\n                                if (ctrl.selected) {\r\n                                    ctrl.deselect();\r\n                                } else {\r\n                                    ctrl.action_select_only();\r\n                                }\r\n                            } else {\r\n                                ctrl.action_select_only();\r\n                            }\r\n                        }\r\n                        if (preventDefault) {\r\n                            e.preventDefault();\r\n                        }\r\n                    } else {\r\n                        console.log('failed condition check');\r\n                    }\r\n                } else {\r\n                }\r\n            }\r\n            let ss;\r\n            const apply_all = ctrl => {\r\n                let id = ctrl._id();\r\n                ctrl.on('change', e_change => {\r\n                    let n = e_change.name,\r\n                        value = e_change.value;\r\n                    let ss = ctrl.find_selection_scope();\r\n                    if (n === 'selected') {\r\n                        if (value === true) {\r\n                            ctrl.add_class('selected');\r\n                            if (ss) ss.map_selected_controls[id] = ctrl;\r\n                        } else {\r\n                            ctrl.remove_class('selected');\r\n                            if (ss) ss.map_selected_controls[id] = null;\r\n                        }\r\n                    }\r\n                    if (n === 'selectable') {\r\n                        if (value === true) {\r\n                                apply_active_selectable(ctrl);\r\n                        } else {\r\n                            if (typeof document === 'undefined') {\r\n                            } else {\r\n                                if (is_array(selection_action)) {\r\n                                    selection_action.forEach(i => {\r\n                                        ctrl_handle.off(i, click_handler);\r\n                                    })\r\n                                } else {\r\n                                    ctrl_handle.off(selection_action, click_handler);\r\n                                }\r\n                                ctrl_handle.has_selection_click_handler = false;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            const apply_active_selectable = ctrl => {\r\n                ctrl.deselect = ctrl.deselect || (() => {\r\n                    ss = ss || ctrl.find_selection_scope();\r\n                    if (ss) ss.deselect(ctrl);\r\n                    ctrl.raise('deselect');\r\n                });\r\n                ctrl.select = ctrl.select || (() => {\r\n                    ss = ss || ctrl.find_selection_scope();\r\n                    if (ss) ss.select(ctrl);\r\n                    ctrl.raise('select');\r\n                });\r\n                ctrl.action_select_only = ctrl.action_select_only || (() => {\r\n                    ss = ss || ctrl.find_selection_scope();\r\n                    if (ss) {\r\n                        ss.select_only(ctrl);\r\n                    } else {\r\n                        each(ctrl.siblings, sibling => {\r\n                            sibling.selected = false;\r\n                        });\r\n                        ctrl.selected = true\r\n                    }\r\n                });\r\n                ctrl.action_select_toggle = ctrl.action_select_toggle || (() => {\r\n                    ss = ss || ctrl.find_selection_scope();\r\n                    ss.select_toggle(ctrl);\r\n                });\r\n                if (typeof document === 'undefined') {\r\n                } else {\r\n                    ctrl.once_active(() => {\r\n                        if (!ctrl_handle.has_selection_click_handler) {\r\n                            ctrl_handle.has_selection_click_handler = true;\r\n                            if (Array.isArray(selection_action)) {\r\n                                selection_action.forEach(i => {\r\n                                    ctrl_handle.on(i, click_handler);\r\n                                })\r\n                            } else {\r\n                                ctrl_handle.on(selection_action, click_handler);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            //if (!old_selectable) {\r\n                field(ctrl, 'selected');\r\n                field(ctrl, 'selectable');\r\n                apply_all(ctrl);\r\n            //};\r\n            ctrl.on('activate', e => {\r\n                if (ctrl.selectable) apply_all(ctrl);\r\n            })\r\n\r\n            //if (old_selectable !== undefined) {\r\n            //    ctrl.selectable = old_selectable;\r\n            //}\r\n        }\r\n\r\n        \r\n    }\r\n}\r\nmodule.exports = selectable;", "\r\n\r\n// Also see about more low / mid level support for compositional models modes.\r\n//   Supporting a wordy API (explicit but not rediculous), but with shortcuts, will be helpful.\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\n\r\n\r\nconst mx_selectable = require('../../../../../control_mixins/selectable');\r\nconst {field} = require('obext');\r\nvar Control = jsgui.Control;\r\n\r\n// Possible archetypes for control. Ie declarative definitions of what the control is and does. So a cell would have a similar\r\n//   archetype to text input, and would also be expected to be or likely to be within a grid.\r\n\r\n// Will separate out the view data model aspects of it.\r\n\r\n\r\nclass Cell extends Control {\r\n    constructor(spec) {\r\n        (spec = spec || {}).__type_name = 'cell';\r\n        super(spec);\r\n        this.add_class('cell');\r\n        field(this, 'x', spec.x);\r\n        field(this, 'y', spec.y);\r\n        field(this, 'data', spec.data);\r\n        if (!spec.el) {\r\n            this.compose_grid_cell();\r\n        }\r\n        mx_selectable(this);\r\n    }\r\n    compose_grid_cell() {\r\n        let o = {\r\n            context: this.context\r\n        };\r\n        if (this.data) o.text = this.data;\r\n        this.add(this.span = new jsgui.span(o));\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n        this._ctrl_fields.span = this.span;\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            //mx_selectable(this);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Cell;\r\n\r\n// And also want to integrate with data sources.\r\n// Possibly a Data_Grid subclass of Data_Model could help most with this.\r\n//   Especially with the data updating, and representing that on a grid.\r\n\r\n// Also, the Grid control was the control that was proving most difficult when it came to the .size property.\r\n//  Ambiguity over if it's the dimensions of the data, or the size in pixels in the UI.\r\n\r\n// .view.size may be a useful way to express it clearly.\r\n// .data.size or .data.model.value.size even....\r\n\r\n// Do want the unambiguous short(er) ways of expressing it.\r\n\r\n// .view.ui.data.model.size even???\r\n\r\n// a ui model or ui data model???\r\n// .view.ui.data.copy()\r\n// view.ui.data.toUInt8Array() ???\r\n\r\n// having .data be more general, then data.model being the data_model instance makes sense in terms of a flexible API.\r\n//   Writing this should be fairly concise because some high level code can use the very specific mid level code to do things that would\r\n//   otherwise take a few lines or be more complex than it otherwise would without the very specific mid level code.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n", "\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n\r\nconst {stringify, each, tof, Control} = jsgui;\r\n//var stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\n//var Control = jsgui.Control;\r\n\r\n// Maybe we can just use 'item'.\r\n\r\n\r\n// Could make this API the same as tree node where possible.\r\n\r\nclass Menu_Node extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n\r\n    // single field?\r\n\r\n    // Actually having a different content?\r\n    //  Or use inner_content.\r\n\r\n    // Menu node having expanded and contracted states.\r\n\r\n    // Menu Node has an image and some text, and a contrainer control for othe Menu nodes.\r\n    //  Can be collapsed so that the internal items don't show\r\n\r\n    //'fields': [\r\n    //['text', String]\r\n\r\n\r\n    //],\r\n\r\n    //'fields': {\r\n    //\t'img_src': 'string',\r\n    //\t'text': 'string'\r\n    //},\r\n\r\n    //  and can have other fields possibly.\r\n\r\n\r\n    constructor(spec, add, make) {\r\n        // Wont fields have been set?\r\n\r\n        super(spec);\r\n\r\n        // Can take an image\r\n        // Can take some text.\r\n        //  That's all I'll have in the Menu node for now.\r\n        this.__type_name = 'menu_node';\r\n        //var that = this;\r\n        if (!this._abstract) {\r\n            if (!spec.el) {\r\n                this.add_class('menu-node');\r\n                var spec_state = spec.state, state;\r\n\r\n                var main_control = make(Control({ 'class': 'main' }));\r\n                this.add(main_control);\r\n                //console.log('**** spec.img_src', spec.img_src);\r\n                if (spec.img_src) {\r\n                    //var img_src = this.get('img_src');\r\n                }\r\n                if (spec.text) {\r\n                    //this.set('text', spec.text);\r\n                    this.text = spec.text;\r\n\r\n                    var span = make(jsgui.span({}));\r\n\r\n                    //var text = this.get('text');\r\n                    //console.log('text', text);\r\n                    //console.log('tof text', tof(text));\r\n\r\n                    span.add(spec.text);\r\n                    main_control.add(span);\r\n                }\r\n                var menu = spec.menu;\r\n                if (menu) {\r\n                    this.set('menu', menu);\r\n                }\r\n\r\n                var inner_control = this.inner_control = make(Control({ 'class': 'inner hidden' }));\r\n                this.add(inner_control);\r\n\r\n                // Inner may not just be the title.\r\n\r\n                //this.set('inner_control', inner_control);\r\n\r\n                //inner_control.hide();\r\n\r\n                //var inner_control_content = inner_control.content;\r\n                // reference to a menu control.\r\n                // maybe take 'value' here\r\n                if (spec.value) {\r\n                    // depending on the type of obj, work differently.\r\n                    //  array of strings, just make those menu items.\r\n\r\n                    var obj_menu = spec.value;\r\n                    var t_obj_menu = tof(obj_menu);\r\n                    console.log('t_obj_menu', t_obj_menu);\r\n\r\n                    if (t_obj_menu == 'array') {\r\n                        each(obj_menu, function(v) {\r\n                            // make a new menu node with that as the value?\r\n\r\n                            var tv = tof(v);\r\n                            if (tv == 'string') {\r\n                                // new node with text, no inner nodes.\r\n\r\n                                var nested_menu_node = make(Menu_Node({\r\n                                    'text': v,\r\n                                    'menu': menu\r\n                                }));\r\n                                inner_control.add(nested_menu_node);\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n\r\n                var ctrl_fields = {\r\n                    'inner_control': inner_control._id(),\r\n                    'main_control': main_control._id(),\r\n                    'menu': spec.menu._id()\r\n                }\r\n\r\n                // use different quotes...\r\n\r\n                this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n\r\n                if (spec_state) {\r\n\r\n                    // open and closed\r\n                    if (spec_state == 'open' || spec_state == 'closed') {\r\n                        state = this.set('state', spec_state);\r\n                    } else {\r\n                        throw 'spec.state expects \"open\" or \"closed\".';\r\n                    }\r\n                } else {\r\n                    state = this.set('state', 'open');\r\n                }\r\n            }\r\n        }\r\n    }\r\n    'activate'() {\r\n\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            var inner_control = this.inner_control;\r\n            var main_control = this.main_control;\r\n            var menu = this.menu;\r\n\r\n            var that = this;\r\n\r\n        }\r\n    }\r\n    'close_all'() {\r\n        console.log('menu-node close_all');\r\n\r\n        // need to do this recursively I think.\r\n        //  could call this recursively on all nodes.\r\n        //\r\n\r\n        var inner_control = this.inner_control;\r\n\r\n        inner_control.content.each(function(v, i) {\r\n            //console.log('i', i);\r\n            //console.log('v', v);\r\n            var tn = v.__type_name;\r\n            //console.log('tn', tn);\r\n            if (tn == 'menu_node') {\r\n                v.close_all();\r\n            }\r\n            //v.close_all();\r\n        });\r\n\r\n        inner_control.hide();\r\n        // this.silent?\r\n        this.set('state', 'closed', true); // silent\r\n\r\n    }\r\n    'close'() {\r\n        var inner_control = this.inner_control;\r\n        inner_control.hide();\r\n        this.set('state', 'closed', true);\r\n    }\r\n    'open'() {\r\n        var inner_control = this.inner_control;\r\n        inner_control.show();\r\n        this.set('state', 'open', true);\r\n    }\r\n\r\n\r\n}\r\nmodule.exports = Menu_Node;\r\n", "const jsgui = require('../../../../../html-core/html-core');\r\nvar Menu_Node = require('./menu-node');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\n// More advanced, but still comes as standard, basic in that way.\r\n\r\n// May benefit from some kind of model overlay over the main part of the doc.\r\n\r\n// ctrl.context_menu?\r\n// ctrl.context.menu(ctrl) ???\r\n//   later, work on easy specification of the context menu.\r\n\r\n\r\nclass Context_Menu extends Control {\r\n\tconstructor(spec, add, make) {\r\n\t\tsuper(spec);\r\n\r\n\t\tthis.__type_name = 'context_menu';\r\n\t\t//this.add_class('context menu');\r\n\t\tthis.add_class('context menu');\r\n\r\n\t\t//console.log('Context_Menu init spec.el', spec.el);\r\n\t\tif (!spec.abstract) {\r\n\t\t\tconst obj = spec.value;\r\n\r\n\t\t\t//console.log('menu obj', obj);\r\n\r\n\t\t\t// Create the menu nodes from it.\r\n\t\t\t//var that = this;\r\n\r\n\t\t\tconst tobj = tof(obj);\r\n\t\t\t//console.log('tobj', tobj);\r\n\t\t\tif (tobj === 'object') {\r\n\t\t\t\teach(obj, (v, key) => {\r\n\t\t\t\t\tconst menu_node = make(Menu_Node({\r\n\t\t\t\t\t\t'text': key,\r\n\t\t\t\t\t\t'value': v,\r\n\t\t\t\t\t\t'menu': this\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tthis.add(menu_node);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\t// typed each\r\n\t\t\t//  would be useful with if statements and an item sig\r\n\t\t\t//  then also with mfp typed each!!! :)\r\n\r\n\t\t\tif (tobj === 'array') {\r\n\t\t\t\teach(obj, (v, index) => {\r\n\t\t\t\t\t//const tv = tof(v);\r\n\t\t\t\t\t//console.log('tv', tv);\r\n\t\t\t\t\t// then if it's string and function...\r\n\r\n\t\t\t\t\tvar vsig = jsgui.get_item_sig(v, 1);\r\n\t\t\t\t\t//console.log('vsig', vsig);\r\n\r\n\t\t\t\t\tif (vsig == '[s,f]') {\r\n\t\t\t\t\t\tvar text = v[0];\r\n\t\t\t\t\t\tvar item_callback = v[1];\r\n\r\n\t\t\t\t\t\tvar menu_node = make(Menu_Node({\r\n\t\t\t\t\t\t\t'text': text,\r\n\t\t\t\t\t\t\t'value': text,\r\n\t\t\t\t\t\t\t'menu': this\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t\tthis.add(menu_node);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._features = this._features || []; // an array is cool but map is better for testing for specific ones.\r\n        each(['menu'], this._features.push);\r\n\r\n\t}\r\n\t'activate'() {\r\n\t\t//console.log('pre super this._.content._arr.length ' + this._.content._arr.length);\r\n\t\t// So it seems the problem lies within the activate function.\r\n\t\tsuper.activate();\r\n\t\t//var body = this.context.body;\r\n\t\t//var that = this;\r\n\t\t//var nodes = this.descendents('menu_node');\r\n\r\n\t}\r\n\t'close_all'() {\r\n\t\tconsole.log('menu close_all');\r\n\t\t// need to do this recursively I think.\r\n\t\t//  could call this recursively on all nodes.\r\n\r\n\t\tthis.content.each(function (v, i) {\r\n\t\t\tv.close_all();\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports = Context_Menu;", "const jsgui = require('../../../../../html-core/html-core');\r\nconst {\r\n    stringify,\r\n    each,\r\n    tof,\r\n    def,\r\n    Control\r\n} = jsgui;\r\nconst mx_selectable = require('../../../../../control_mixins/selectable');\r\nconst {\r\n    prop,\r\n    field\r\n} = require('obext');\r\nconst Cell = require('./Cell');\r\nconst Grid_Cell = Cell;\r\n\r\n// Some kind of compositional spec being part of the view (data) model.\r\n// view.data.model.composition = ...\r\n\r\n\r\n\r\n\r\nclass Grid extends Control {\r\n    constructor(spec, add, make) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'grid';\r\n        super(spec);\r\n        if (spec.cell_selection) {\r\n            this.cell_selection = spec.cell_selection;\r\n        }\r\n        this.add_class('grid');\r\n        var spec_data = spec.data;\r\n        this._arr_rows = [];\r\n        field(this, 'composition_mode');\r\n        if (spec.composition_mode) {\r\n            this.composition_mode = spec.composition_mode\r\n        } else {\r\n            this.composition_mode = 'divs'\r\n        }\r\n\r\n        prop(this, 'grid_size', spec.grid_size || [12, 12]);\r\n\r\n        /*\r\n        let _grid_size;\r\n        Object.defineProperty(this, 'grid_size', {\r\n            get() {\r\n                return _grid_size;\r\n            },\r\n            set(value) {\r\n                if (Array.isArray(value) && value.length === 2) {\r\n                    let old = _grid_size\r\n                    _grid_size = value;\r\n                    console.log('set _grid_size', value);\r\n                    this.raise('change', {\r\n                        'name': 'grid_size',\r\n                        'old': old,\r\n                        'value': value\r\n                    });\r\n                } else {\r\n                    throw 'Invalid grid_size. Expected [x, y]';\r\n                }\r\n            }\r\n        });\r\n        if (spec.grid_size) _grid_size = spec.grid_size;\r\n        */\r\n        field(this, 'cell_size');\r\n        if (spec.cell_size) this.cell_size = spec.cell_size;\r\n        field(this, 'column_headers', false);\r\n        field(this, 'row_headers', false);\r\n        prop(this, 'data', false);\r\n        this.map_cells = {};\r\n        this.arr_cells = {};\r\n        if (spec.data) {\r\n            let t_data = tof(spec.data);\r\n            if (t_data === 'array') {\r\n                let max_x = -1;\r\n                let y, x, ly, lx, arr = spec.data,\r\n                    arr_row;\r\n                ly = arr.length; \r\n                for (y = 0; y < ly; y++) {\r\n                    arr_row = arr[y];\r\n                    lx = arr_row.length;\r\n                    if (lx > max_x) max_x = lx;\r\n                    for (x = 0; x < lx; x++) {\r\n                    }\r\n                }\r\n                _grid_size = [max_x, ly];\r\n            }\r\n        }\r\n        if (!spec.el) {\r\n            var data;\r\n            this.full_compose_as_divs();\r\n            this._fields = this._fields || {};\r\n            Object.assign(this._fields, {\r\n                'composition_mode': this.composition_mode,\r\n                'grid_size': this.grid_size\r\n            });\r\n            if (this.cell_size) {\r\n                this._fields.cell_size = this.cell_size;\r\n            }\r\n        }\r\n        this.changes({\r\n            grid_size: v => {\r\n                if (!spec.el) {\r\n                    this.clear();\r\n                    this.full_compose_as_divs();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    //  Have the size system set up within the 'view model'.\r\n\r\n\r\n    'refresh_size'() {\r\n        if (this.composition_mode === 'divs') {\r\n            let [num_columns, num_rows] = this.grid_size;\r\n            var cell_border_thickness = 1;\r\n            var _2_cell_border_thickness = cell_border_thickness * 2;\r\n            if (this.size) {\r\n                var cell_size = this.cell_size || [Math.floor(this.size[0] / num_columns) - _2_cell_border_thickness, Math.floor(this.size[1] / num_rows) - _2_cell_border_thickness];\r\n                var cell_v_border_thickness = 2;\r\n                this.each_row((row) => {\r\n                    row.size = [this.size[0], cell_size[1] + cell_v_border_thickness];\r\n                });\r\n                this.each_cell((cell) => {\r\n                    cell.size = cell_size;\r\n                });\r\n            } else {\r\n                console.log('.size was not available');\r\n            }\r\n        }\r\n    }\r\n    'each_row'(cb_row) {\r\n        each(this._arr_rows, cb_row);\r\n    }\r\n    'each_cell'(cb_cell) {\r\n        each(this._arr_rows, (row, i_row) => {\r\n            row.content.each((cell, i_cell) => {\r\n                cb_cell(cell, [i_cell, i_row]);\r\n            });\r\n        });\r\n    }\r\n    'get_cell'(x, y) {\r\n        console.trace();\r\n        throw 'NYI';\r\n    }\r\n    'add_cell'(content) {\r\n        var cell = new Grid_Cell({\r\n            context: this.context\r\n        });\r\n        if (this.cell_selection) {\r\n            cell.selectable = true;\r\n        } else {\r\n        }\r\n        if (content) {\r\n            cell.add(content);\r\n        }\r\n        cell.active();\r\n        this.main.add(cell);\r\n        return cell;\r\n    }\r\n    'full_compose_as_divs'() {\r\n        let main = this.main = new Control({\r\n            context: this.context,\r\n            class: 'main'\r\n        });\r\n        this.add(main);\r\n        let rows = this.main = new Control({\r\n            context: this.context,\r\n            class: 'rows'\r\n        });\r\n        main.add(rows);\r\n        let map_cells = this.map_cells,\r\n            arr_cells = this.arr_cells;\r\n        if (this.grid_size) {\r\n            let [num_columns, num_rows] = this.grid_size;\r\n            var cell_border_thickness = 0;\r\n            var _2_cell_border_thickness = cell_border_thickness * 2;\r\n            let cell_size;\r\n            if (this.size) {\r\n                cell_size = this.cell_size || [Math.floor(this.size[0] / num_columns) - _2_cell_border_thickness, Math.floor(this.size[1] / num_rows) - _2_cell_border_thickness];\r\n            } else {\r\n                cell_size = this.cell_size;\r\n            }\r\n            let row_width, row_height;\r\n            let row_header_width;\r\n            if (this.cell_size) {\r\n                if (this.row_headers) {\r\n                    row_header_width = this.row_headers.width || row_header_width;\r\n                    row_width = this.cell_size[0] * num_columns + row_header_width;\r\n                } else {\r\n                    row_width = this.cell_size[0] * num_columns;\r\n                }\r\n                row_height = this.cell_size[1];\r\n            } else {\r\n                if (this.size) row_height = Math.floor(this.size[1] / num_rows);\r\n            }\r\n            const data = this.data;\r\n            var x, y;\r\n            if (this.column_headers) {\r\n                let header_row = new Control({\r\n                    context: this.context \r\n                });\r\n                header_row.add_class('header');\r\n                header_row.add_class('row');\r\n                if (row_height) {\r\n                    header_row.style('height', row_height);\r\n                }\r\n                if (row_width) {\r\n                    header_row.style('width', row_width);\r\n                }\r\n                rows.add(header_row);\r\n                if (this.row_headers) {\r\n                    var cell = new Control({\r\n                        context: this.context,\r\n                        __type_name: 'grid_cell', \r\n                    });\r\n                    cell.add_class('grid-header');\r\n                    cell.add_class('cell');\r\n                    if (row_header_width) {\r\n                        cell.size = [row_header_width, cell_size[1]];\r\n                    } else {\r\n                        cell.size = cell_size;\r\n                    }\r\n                    header_row.add(cell);\r\n                }\r\n                for (x = 0; x < num_columns; x++) {\r\n                    var cell = new Control({\r\n                        context: this.context,\r\n                        __type_name: 'grid_cell', \r\n                    });\r\n                    cell.add_class('column-header');\r\n                    cell.add_class('cell');\r\n                    cell.size = cell_size;\r\n                    header_row.add(cell);\r\n                }\r\n            }\r\n            for (y = 0; y < num_rows; y++) {\r\n                var row_container = new Control({\r\n                    context: this.context \r\n                });\r\n                if (row_height) {\r\n                    row_container.style('height', row_height);\r\n                }\r\n                if (row_width) {\r\n                    row_container.style('width', row_width);\r\n                }\r\n                row_container.add_class('row');\r\n                this._arr_rows.push(row_container);\r\n                rows.add(row_container);\r\n                if (this.row_headers) {\r\n                    var cell = new Control({\r\n                        context: this.context,\r\n                        __type_name: 'grid_cell', \r\n                    });\r\n                    cell.add_class('row-header');\r\n                    cell.add_class('cell');\r\n                    if (row_header_width) {\r\n                        cell.size = [row_header_width, cell_size[1]];\r\n                    } else {\r\n                        cell.size = cell_size;\r\n                    }\r\n                    row_container.add(cell);\r\n                }\r\n                for (x = 0; x < num_columns; x++) {\r\n                    let o = {\r\n                        context: this.context,\r\n                        x: x,\r\n                        y: y\r\n                    }\r\n                    if (data) {\r\n                        o.data = data[y][x];\r\n                    }\r\n                    var cell = new Grid_Cell(o);\r\n                    cell.selectable = true;\r\n\r\n                    // saying the cells are selectable within this scope...?\r\n\r\n                    if (cell_size) cell.size = cell_size;\r\n                    row_container.add(cell);\r\n                    arr_cells[x] = arr_cells[x] || [];\r\n                    arr_cells[x][y] = cell;\r\n                    map_cells['[' + x + ',' + y + ']'] = cell;\r\n                }\r\n            }\r\n        }\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n        this._ctrl_fields.main = main;\r\n        this._ctrl_fields.rows = rows;\r\n    }\r\n    'full_compose_as_table'() {\r\n        this.dom.tagName = table;\r\n        var data = this.data;\r\n        var range = data.range;\r\n        var value;\r\n        if (tof(data) === 'data_grid') {\r\n            var x, y, max_x = range[0],\r\n                max_y = range[1];\r\n            var ctrl_cell, ctrl_row;\r\n            var size = this.size().value();\r\n            var tbody_params = {\r\n                'context': this.context,\r\n                'tagName': 'tbody'\r\n            }\r\n            if (size) {\r\n                tbody_params.size = [size[0][0], size[1][0]];\r\n            }\r\n            var tbody = new Control(tbody_params);\r\n            this.add(tbody);\r\n            for (y = 0; y <= max_y; y++) {\r\n                ctrl_row = new jsgui.tr({\r\n                    'context': this.context\r\n                });\r\n                tbody.add(ctrl_row);\r\n                for (x = 0; x <= max_x; x++) {\r\n                    ctrl_cell = new jsgui.td({\r\n                        'context': this.context\r\n                    });\r\n                    ctrl_row.add(ctrl_cell);\r\n                    value = data.get(x, y);\r\n                    ctrl_cell.add_text(value);\r\n                }\r\n            }\r\n        } else {\r\n            throw 'Unexpected data type. Expected data_grid, got ' + tof(data);\r\n        }\r\n    }\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            this.selection_scope = this.selection_scope || this.context.new_selection_scope(this);\r\n            var load_rows = () => {\r\n                var _arr_rows = this._arr_rows = [];\r\n                this.rows.content._arr.forEach((v) => {\r\n                    _arr_rows.push(v);\r\n                });\r\n            }\r\n            load_rows();\r\n            var load_cells = () => {\r\n                each(this._arr_rows, (row) => {\r\n                    each(row.content._arr, (cell) => {\r\n                    });\r\n                });\r\n            };\r\n\r\n            /*\r\n            this.each_cell(cell => {\r\n                cell.activate();\r\n            });\r\n            */\r\n\r\n\r\n        }\r\n    }\r\n}\r\nGrid.css = `\r\ntable.grid {\r\n    background-color: #eceff1;\r\n    border: 1px solid #546e7a;\r\n    padding: 2px;\r\n    cursor: default;\r\n}\r\ntable.grid tbody {\r\n    overflow: hidden;\r\n    display: block;\r\n}\r\ntable.grid td {\r\n    padding: 1px;\r\n}\r\n.data-row .data-item {\r\n    display: inline;\r\n    margin-left: 2px;\r\n    padding: 2px;\r\n}\r\n.mid-width {\r\n    width: 450px;\r\n}\r\ndiv.grid {\r\n    user-select: none;\r\n    clear: both;\r\n}\r\ndiv.grid .header.row .cell {\r\n    text-align: center\r\n}\r\ndiv.grid .row {\r\n    clear: both;\r\n}\r\ndiv.grid .header.row .cell span {\r\n    position: relative;\r\n    top: 4px;\r\n    left: 0px;\r\n    font-size: 11pt;\r\n}\r\ndiv.grid .row .cell {\r\n    float: left;\r\n    box-sizing: border-box;\r\n    border-right: 1px solid #AAAAAA;\r\n    border-bottom: 1px solid #999999;\r\n}\r\ndiv.grid .row .cell.selected {\r\n    float: left;\r\n    box-sizing: border-box;\r\n    border: 2px solid #2046df;\r\n    border-radius: 4px;\r\n}\r\ndiv.grid .row .cell.selected span {\r\n    position: relative;\r\n    left: 3px;\r\n    top: -1px;\r\n    font-size: 16pt;\r\n}\r\ndiv.grid .row .cell span {\r\n    position: relative;\r\n    left: 5px;\r\n    top: 1px;\r\n    font-size: 16pt;\r\n}\r\n`;\r\nGrid.Cell = Grid.Grid_Cell = Grid_Cell;\r\nmodule.exports = Grid;", "const jsgui = require('../../../../../html-core/html-core');\r\nvar Grid = require('./grid');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof,\r\n    is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\nvar v_subtract = jsgui.util.v_subtract;\r\nconst {\r\n    field,\r\n    prop\r\n} = require('obext');\r\nclass Color_Grid extends Grid {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'color_grid';\r\n        super(spec);\r\n        this.add_class('color-grid');\r\n        this.internal_relative_div = true;\r\n\r\n        // Will mainly be the 'view' model.\r\n\r\n        prop(this, 'palette', spec.palette);\r\n        //prop(this, 'grid_size', spec.grid_size || [12, 12]);\r\n\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            this.compose_color_palette_grid();\r\n        }\r\n        this.on('resize', (e_resize) => {\r\n            if (this.grid) {\r\n                var _2_padding = 12;\r\n                var new_grid_size = v_subtract(e_resize.value, [_2_padding, _2_padding]);\r\n                this.grid.size = new_grid_size;\r\n            }\r\n        });\r\n    }\r\n    activate() {\r\n        if (!this.activate.__active) {\r\n            super.activate();\r\n            this.grid.selection_scope.on('change', e => {\r\n                const {\r\n                    name,\r\n                    value\r\n                } = e;\r\n                if (name === 'selected') {\r\n                    const selected_ctrl = value;\r\n                    if (selected_ctrl) {\r\n                        let color = selected_ctrl._color;\r\n                        this.raise('choose-color', {\r\n                            value: color\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n            const old_make_grid_cells_selectable = () => {\r\n                this.grid.each_cell(cell => {\r\n                })\r\n            }\r\n        }\r\n    }\r\n    each_cell(cb) {\r\n        return this.grid.each_cell(cb);\r\n    }\r\n    add_grid_cells() {\r\n        if (this.palette) {\r\n            let c = 0;\r\n            this.grid.each_cell((cell) => {\r\n                var item = this.palette[c++];\r\n                if (item) {\r\n                    if (item.hex) {\r\n                        cell.color = item.hex;\r\n                    } else {\r\n                        if (typeof item === 'string') {\r\n                            cell.color = item;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    compose_color_palette_grid() {\r\n        var padding = 6;\r\n        const grid = this.grid = new Grid({\r\n            'context': this.context,\r\n            'grid_size': this.grid_size,\r\n            'size': this.size,\r\n            'cell_selection': 'single'\r\n        });\r\n        grid.each_cell((cell, [x, y]) => {\r\n        });\r\n        this.add(grid);\r\n        this.add_grid_cells();\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n\t\tthis._ctrl_fields.grid = grid;\r\n    }\r\n}\r\nif (require.main === module) {\r\n    console.log('pal_crayola.length', pal_crayola.length);\r\n} else {\r\n}\r\nmodule.exports = Color_Grid;", "const pal_crayola = [{\r\n    \"hex\": \"#EFDECD\",\r\n    \"name\": \"Almond\",\r\n    \"rgb\": \"(239, 222, 205)\"\r\n},\r\n{\r\n    \"hex\": \"#CD9575\",\r\n    \"name\": \"Antique Brass\",\r\n    \"rgb\": \"(205, 149, 117)\"\r\n},\r\n{\r\n    \"hex\": \"#FDD9B5\",\r\n    \"name\": \"Apricot\",\r\n    \"rgb\": \"(253, 217, 181)\"\r\n},\r\n{\r\n    \"hex\": \"#78DBE2\",\r\n    \"name\": \"Aquamarine\",\r\n    \"rgb\": \"(120, 219, 226)\"\r\n},\r\n{\r\n    \"hex\": \"#87A96B\",\r\n    \"name\": \"Asparagus\",\r\n    \"rgb\": \"(135, 169, 107)\"\r\n},\r\n{\r\n    \"hex\": \"#FFA474\",\r\n    \"name\": \"Atomic Tangerine\",\r\n    \"rgb\": \"(255, 164, 116)\"\r\n},\r\n{\r\n    \"hex\": \"#FAE7B5\",\r\n    \"name\": \"Banana Mania\",\r\n    \"rgb\": \"(250, 231, 181)\"\r\n},\r\n{\r\n    \"hex\": \"#9F8170\",\r\n    \"name\": \"Beaver\",\r\n    \"rgb\": \"(159, 129, 112)\"\r\n},\r\n{\r\n    \"hex\": \"#FD7C6E\",\r\n    \"name\": \"Bittersweet\",\r\n    \"rgb\": \"(253, 124, 110)\"\r\n},\r\n{\r\n    \"hex\": \"#000000\",\r\n    \"name\": \"Black\",\r\n    \"rgb\": \"(0,0,0)\"\r\n},\r\n{\r\n    \"hex\": \"#ACE5EE\",\r\n    \"name\": \"Blizzard Blue\",\r\n    \"rgb\": \"(172, 229, 238)\"\r\n},\r\n{\r\n    \"hex\": \"#1F75FE\",\r\n    \"name\": \"Blue\",\r\n    \"rgb\": \"(31, 117, 254)\"\r\n},\r\n{\r\n    \"hex\": \"#A2A2D0\",\r\n    \"name\": \"Blue Bell\",\r\n    \"rgb\": \"(162, 162, 208)\"\r\n},\r\n{\r\n    \"hex\": \"#6699CC\",\r\n    \"name\": \"Blue Gray\",\r\n    \"rgb\": \"(102, 153, 204)\"\r\n},\r\n{\r\n    \"hex\": \"#0D98BA\",\r\n    \"name\": \"Blue Green\",\r\n    \"rgb\": \"(13, 152, 186)\"\r\n},\r\n{\r\n    \"hex\": \"#7366BD\",\r\n    \"name\": \"Blue Violet\",\r\n    \"rgb\": \"(115, 102, 189)\"\r\n},\r\n{\r\n    \"hex\": \"#DE5D83\",\r\n    \"name\": \"Blush\",\r\n    \"rgb\": \"(222, 93, 131)\"\r\n},\r\n{\r\n    \"hex\": \"#CB4154\",\r\n    \"name\": \"Brick Red\",\r\n    \"rgb\": \"(203, 65, 84)\"\r\n},\r\n{\r\n    \"hex\": \"#B4674D\",\r\n    \"name\": \"Brown\",\r\n    \"rgb\": \"(180, 103, 77)\"\r\n},\r\n{\r\n    \"hex\": \"#FF7F49\",\r\n    \"name\": \"Burnt Orange\",\r\n    \"rgb\": \"(255, 127, 73)\"\r\n},\r\n{\r\n    \"hex\": \"#EA7E5D\",\r\n    \"name\": \"Burnt Sienna\",\r\n    \"rgb\": \"(234, 126, 93)\"\r\n},\r\n{\r\n    \"hex\": \"#B0B7C6\",\r\n    \"name\": \"Cadet Blue\",\r\n    \"rgb\": \"(176, 183, 198)\"\r\n},\r\n{\r\n    \"hex\": \"#FFFF99\",\r\n    \"name\": \"Canary\",\r\n    \"rgb\": \"(255, 255, 153)\"\r\n},\r\n{\r\n    \"hex\": \"#1CD3A2\",\r\n    \"name\": \"Caribbean Green\",\r\n    \"rgb\": \"(28, 211, 162)\"\r\n},\r\n{\r\n    \"hex\": \"#FFAACC\",\r\n    \"name\": \"Carnation Pink\",\r\n    \"rgb\": \"(255, 170, 204)\"\r\n},\r\n{\r\n    \"hex\": \"#DD4492\",\r\n    \"name\": \"Cerise\",\r\n    \"rgb\": \"(221, 68, 146)\"\r\n},\r\n{\r\n    \"hex\": \"#1DACD6\",\r\n    \"name\": \"Cerulean\",\r\n    \"rgb\": \"(29, 172, 214)\"\r\n},\r\n{\r\n    \"hex\": \"#BC5D58\",\r\n    \"name\": \"Chestnut\",\r\n    \"rgb\": \"(188, 93, 88)\"\r\n},\r\n{\r\n    \"hex\": \"#DD9475\",\r\n    \"name\": \"Copper\",\r\n    \"rgb\": \"(221, 148, 117)\"\r\n},\r\n{\r\n    \"hex\": \"#9ACEEB\",\r\n    \"name\": \"Cornflower\",\r\n    \"rgb\": \"(154, 206, 235)\"\r\n},\r\n{\r\n    \"hex\": \"#FFBCD9\",\r\n    \"name\": \"Cotton Candy\",\r\n    \"rgb\": \"(255, 188, 217)\"\r\n},\r\n{\r\n    \"hex\": \"#FDDB6D\",\r\n    \"name\": \"Dandelion\",\r\n    \"rgb\": \"(253, 219, 109)\"\r\n},\r\n{\r\n    \"hex\": \"#2B6CC4\",\r\n    \"name\": \"Denim\",\r\n    \"rgb\": \"(43, 108, 196)\"\r\n},\r\n{\r\n    \"hex\": \"#EFCDB8\",\r\n    \"name\": \"Desert Sand\",\r\n    \"rgb\": \"(239, 205, 184)\"\r\n},\r\n{\r\n    \"hex\": \"#6E5160\",\r\n    \"name\": \"Eggplant\",\r\n    \"rgb\": \"(110, 81, 96)\"\r\n},\r\n{\r\n    \"hex\": \"#CEFF1D\",\r\n    \"name\": \"Electric Lime\",\r\n    \"rgb\": \"(206, 255, 29)\"\r\n},\r\n{\r\n    \"hex\": \"#71BC78\",\r\n    \"name\": \"Fern\",\r\n    \"rgb\": \"(113, 188, 120)\"\r\n},\r\n{\r\n    \"hex\": \"#6DAE81\",\r\n    \"name\": \"Forest Green\",\r\n    \"rgb\": \"(109, 174, 129)\"\r\n},\r\n{\r\n    \"hex\": \"#C364C5\",\r\n    \"name\": \"Fuchsia\",\r\n    \"rgb\": \"(195, 100, 197)\"\r\n},\r\n{\r\n    \"hex\": \"#CC6666\",\r\n    \"name\": \"Fuzzy Wuzzy\",\r\n    \"rgb\": \"(204, 102, 102)\"\r\n},\r\n{\r\n    \"hex\": \"#E7C697\",\r\n    \"name\": \"Gold\",\r\n    \"rgb\": \"(231, 198, 151)\"\r\n},\r\n{\r\n    \"hex\": \"#FCD975\",\r\n    \"name\": \"Goldenrod\",\r\n    \"rgb\": \"(252, 217, 117)\"\r\n},\r\n{\r\n    \"hex\": \"#A8E4A0\",\r\n    \"name\": \"Granny Smith Apple\",\r\n    \"rgb\": \"(168, 228, 160)\"\r\n},\r\n{\r\n    \"hex\": \"#95918C\",\r\n    \"name\": \"Gray\",\r\n    \"rgb\": \"(149, 145, 140)\"\r\n},\r\n{\r\n    \"hex\": \"#1CAC78\",\r\n    \"name\": \"Green\",\r\n    \"rgb\": \"(28, 172, 120)\"\r\n},\r\n{\r\n    \"hex\": \"#1164B4\",\r\n    \"name\": \"Green Blue\",\r\n    \"rgb\": \"(17, 100, 180)\"\r\n},\r\n{\r\n    \"hex\": \"#F0E891\",\r\n    \"name\": \"Green Yellow\",\r\n    \"rgb\": \"(240, 232, 145)\"\r\n},\r\n{\r\n    \"hex\": \"#FF1DCE\",\r\n    \"name\": \"Hot Magenta\",\r\n    \"rgb\": \"(255, 29, 206)\"\r\n},\r\n{\r\n    \"hex\": \"#B2EC5D\",\r\n    \"name\": \"Inchworm\",\r\n    \"rgb\": \"(178, 236, 93)\"\r\n},\r\n{\r\n    \"hex\": \"#5D76CB\",\r\n    \"name\": \"Indigo\",\r\n    \"rgb\": \"(93, 118, 203)\"\r\n},\r\n{\r\n    \"hex\": \"#CA3767\",\r\n    \"name\": \"Jazzberry Jam\",\r\n    \"rgb\": \"(202, 55, 103)\"\r\n},\r\n{\r\n    \"hex\": \"#3BB08F\",\r\n    \"name\": \"Jungle Green\",\r\n    \"rgb\": \"(59, 176, 143)\"\r\n},\r\n{\r\n    \"hex\": \"#FEFE22\",\r\n    \"name\": \"Laser Lemon\",\r\n    \"rgb\": \"(254, 254, 34)\"\r\n},\r\n{\r\n    \"hex\": \"#FCB4D5\",\r\n    \"name\": \"Lavender\",\r\n    \"rgb\": \"(252, 180, 213)\"\r\n},\r\n{\r\n    \"hex\": \"#FFF44F\",\r\n    \"name\": \"Lemon Yellow\",\r\n    \"rgb\": \"(255, 244, 79)\"\r\n},\r\n{\r\n    \"hex\": \"#FFBD88\",\r\n    \"name\": \"Macaroni and Cheese\",\r\n    \"rgb\": \"(255, 189, 136)\"\r\n},\r\n{\r\n    \"hex\": \"#F664AF\",\r\n    \"name\": \"Magenta\",\r\n    \"rgb\": \"(246, 100, 175)\"\r\n},\r\n{\r\n    \"hex\": \"#AAF0D1\",\r\n    \"name\": \"Magic Mint\",\r\n    \"rgb\": \"(170, 240, 209)\"\r\n},\r\n{\r\n    \"hex\": \"#CD4A4C\",\r\n    \"name\": \"Mahogany\",\r\n    \"rgb\": \"(205, 74, 76)\"\r\n},\r\n{\r\n    \"hex\": \"#EDD19C\",\r\n    \"name\": \"Maize\",\r\n    \"rgb\": \"(237, 209, 156)\"\r\n},\r\n{\r\n    \"hex\": \"#979AAA\",\r\n    \"name\": \"Manatee\",\r\n    \"rgb\": \"(151, 154, 170)\"\r\n},\r\n{\r\n    \"hex\": \"#FF8243\",\r\n    \"name\": \"Mango Tango\",\r\n    \"rgb\": \"(255, 130, 67)\"\r\n},\r\n{\r\n    \"hex\": \"#C8385A\",\r\n    \"name\": \"Maroon\",\r\n    \"rgb\": \"(200, 56, 90)\"\r\n},\r\n{\r\n    \"hex\": \"#EF98AA\",\r\n    \"name\": \"Mauvelous\",\r\n    \"rgb\": \"(239, 152, 170)\"\r\n},\r\n{\r\n    \"hex\": \"#FDBCB4\",\r\n    \"name\": \"Melon\",\r\n    \"rgb\": \"(253, 188, 180)\"\r\n},\r\n{\r\n    \"hex\": \"#1A4876\",\r\n    \"name\": \"Midnight Blue\",\r\n    \"rgb\": \"(26, 72, 118)\"\r\n},\r\n{\r\n    \"hex\": \"#30BA8F\",\r\n    \"name\": \"Mountain Meadow\",\r\n    \"rgb\": \"(48, 186, 143)\"\r\n},\r\n{\r\n    \"hex\": \"#C54B8C\",\r\n    \"name\": \"Mulberry\",\r\n    \"rgb\": \"(197, 75, 140)\"\r\n},\r\n{\r\n    \"hex\": \"#1974D2\",\r\n    \"name\": \"Navy Blue\",\r\n    \"rgb\": \"(25, 116, 210)\"\r\n},\r\n{\r\n    \"hex\": \"#FFA343\",\r\n    \"name\": \"Neon Carrot\",\r\n    \"rgb\": \"(255, 163, 67)\"\r\n},\r\n{\r\n    \"hex\": \"#BAB86C\",\r\n    \"name\": \"Olive Green\",\r\n    \"rgb\": \"(186, 184, 108)\"\r\n},\r\n{\r\n    \"hex\": \"#FF7538\",\r\n    \"name\": \"Orange\",\r\n    \"rgb\": \"(255, 117, 56)\"\r\n},\r\n{\r\n    \"hex\": \"#FF2B2B\",\r\n    \"name\": \"Orange Red\",\r\n    \"rgb\": \"(255, 43, 43)\"\r\n},\r\n{\r\n    \"hex\": \"#F8D568\",\r\n    \"name\": \"Orange Yellow\",\r\n    \"rgb\": \"(248, 213, 104)\"\r\n},\r\n{\r\n    \"hex\": \"#E6A8D7\",\r\n    \"name\": \"Orchid\",\r\n    \"rgb\": \"(230, 168, 215)\"\r\n},\r\n{\r\n    \"hex\": \"#414A4C\",\r\n    \"name\": \"Outer Space\",\r\n    \"rgb\": \"(65, 74, 76)\"\r\n},\r\n{\r\n    \"hex\": \"#FF6E4A\",\r\n    \"name\": \"Outrageous Orange\",\r\n    \"rgb\": \"(255, 110, 74)\"\r\n},\r\n{\r\n    \"hex\": \"#1CA9C9\",\r\n    \"name\": \"Pacific Blue\",\r\n    \"rgb\": \"(28, 169, 201)\"\r\n},\r\n{\r\n    \"hex\": \"#FFCFAB\",\r\n    \"name\": \"Peach\",\r\n    \"rgb\": \"(255, 207, 171)\"\r\n},\r\n{\r\n    \"hex\": \"#C5D0E6\",\r\n    \"name\": \"Periwinkle\",\r\n    \"rgb\": \"(197, 208, 230)\"\r\n},\r\n{\r\n    \"hex\": \"#FDDDE6\",\r\n    \"name\": \"Piggy Pink\",\r\n    \"rgb\": \"(253, 221, 230)\"\r\n},\r\n{\r\n    \"hex\": \"#158078\",\r\n    \"name\": \"Pine Green\",\r\n    \"rgb\": \"(21, 128, 120)\"\r\n},\r\n{\r\n    \"hex\": \"#FC74FD\",\r\n    \"name\": \"Pink Flamingo\",\r\n    \"rgb\": \"(252, 116, 253)\"\r\n},\r\n{\r\n    \"hex\": \"#F78FA7\",\r\n    \"name\": \"Pink Sherbet\",\r\n    \"rgb\": \"(247, 143, 167)\"\r\n},\r\n{\r\n    \"hex\": \"#8E4585\",\r\n    \"name\": \"Plum\",\r\n    \"rgb\": \"(142, 69, 133)\"\r\n},\r\n{\r\n    \"hex\": \"#7442C8\",\r\n    \"name\": \"Purple Heart\",\r\n    \"rgb\": \"(116, 66, 200)\"\r\n},\r\n{\r\n    \"hex\": \"#9D81BA\",\r\n    \"name\": \"Purple Mountain's Majesty\",\r\n    \"rgb\": \"(157, 129, 186)\"\r\n},\r\n{\r\n    \"hex\": \"#FE4EDA\",\r\n    \"name\": \"Purple Pizzazz\",\r\n    \"rgb\": \"(254, 78, 218)\"\r\n},\r\n{\r\n    \"hex\": \"#FF496C\",\r\n    \"name\": \"Radical Red\",\r\n    \"rgb\": \"(255, 73, 108)\"\r\n},\r\n{\r\n    \"hex\": \"#D68A59\",\r\n    \"name\": \"Raw Sienna\",\r\n    \"rgb\": \"(214, 138, 89)\"\r\n},\r\n{\r\n    \"hex\": \"#714B23\",\r\n    \"name\": \"Raw Umber\",\r\n    \"rgb\": \"(113, 75, 35)\"\r\n},\r\n{\r\n    \"hex\": \"#FF48D0\",\r\n    \"name\": \"Razzle Dazzle Rose\",\r\n    \"rgb\": \"(255, 72, 208)\"\r\n},\r\n{\r\n    \"hex\": \"#E3256B\",\r\n    \"name\": \"Razzmatazz\",\r\n    \"rgb\": \"(227, 37, 107)\"\r\n},\r\n{\r\n    \"hex\": \"#EE204D\",\r\n    \"name\": \"Red\",\r\n    \"rgb\": \"(238,32 ,77 )\"\r\n},\r\n{\r\n    \"hex\": \"#FF5349\",\r\n    \"name\": \"Red Orange\",\r\n    \"rgb\": \"(255, 83, 73)\"\r\n},\r\n{\r\n    \"hex\": \"#C0448F\",\r\n    \"name\": \"Red Violet\",\r\n    \"rgb\": \"(192, 68, 143)\"\r\n},\r\n{\r\n    \"hex\": \"#1FCECB\",\r\n    \"name\": \"Robin's Egg Blue\",\r\n    \"rgb\": \"(31, 206, 203)\"\r\n},\r\n{\r\n    \"hex\": \"#7851A9\",\r\n    \"name\": \"Royal Purple\",\r\n    \"rgb\": \"(120, 81, 169)\"\r\n},\r\n{\r\n    \"hex\": \"#FF9BAA\",\r\n    \"name\": \"Salmon\",\r\n    \"rgb\": \"(255, 155, 170)\"\r\n},\r\n{\r\n    \"hex\": \"#FC2847\",\r\n    \"name\": \"Scarlet\",\r\n    \"rgb\": \"(252, 40, 71)\"\r\n},\r\n{\r\n    \"hex\": \"#76FF7A\",\r\n    \"name\": \"Screamin' Green\",\r\n    \"rgb\": \"(118, 255, 122)\"\r\n},\r\n{\r\n    \"hex\": \"#9FE2BF\",\r\n    \"name\": \"Sea Green\",\r\n    \"rgb\": \"(159, 226, 191)\"\r\n},\r\n{\r\n    \"hex\": \"#A5694F\",\r\n    \"name\": \"Sepia\",\r\n    \"rgb\": \"(165, 105, 79)\"\r\n},\r\n{\r\n    \"hex\": \"#8A795D\",\r\n    \"name\": \"Shadow\",\r\n    \"rgb\": \"(138, 121, 93)\"\r\n},\r\n{\r\n    \"hex\": \"#45CEA2\",\r\n    \"name\": \"Shamrock\",\r\n    \"rgb\": \"(69, 206, 162)\"\r\n},\r\n{\r\n    \"hex\": \"#FB7EFD\",\r\n    \"name\": \"Shocking Pink\",\r\n    \"rgb\": \"(251, 126, 253)\"\r\n},\r\n{\r\n    \"hex\": \"#CDC5C2\",\r\n    \"name\": \"Silver\",\r\n    \"rgb\": \"(205, 197, 194)\"\r\n},\r\n{\r\n    \"hex\": \"#80DAEB\",\r\n    \"name\": \"Sky Blue\",\r\n    \"rgb\": \"(128, 218, 235)\"\r\n},\r\n{\r\n    \"hex\": \"#ECEABE\",\r\n    \"name\": \"Spring Green\",\r\n    \"rgb\": \"(236, 234, 190)\"\r\n},\r\n{\r\n    \"hex\": \"#FFCF48\",\r\n    \"name\": \"Sunglow\",\r\n    \"rgb\": \"(255, 207, 72)\"\r\n},\r\n{\r\n    \"hex\": \"#FD5E53\",\r\n    \"name\": \"Sunset Orange\",\r\n    \"rgb\": \"(253, 94, 83)\"\r\n},\r\n{\r\n    \"hex\": \"#FAA76C\",\r\n    \"name\": \"Tan\",\r\n    \"rgb\": \"(250, 167, 108)\"\r\n},\r\n{\r\n    \"hex\": \"#18A7B5\",\r\n    \"name\": \"Teal Blue\",\r\n    \"rgb\": \"(24, 167, 181)\"\r\n},\r\n{\r\n    \"hex\": \"#EBC7DF\",\r\n    \"name\": \"Thistle\",\r\n    \"rgb\": \"(235, 199, 223)\"\r\n},\r\n{\r\n    \"hex\": \"#FC89AC\",\r\n    \"name\": \"Tickle Me Pink\",\r\n    \"rgb\": \"(252, 137, 172)\"\r\n},\r\n{\r\n    \"hex\": \"#DBD7D2\",\r\n    \"name\": \"Timberwolf\",\r\n    \"rgb\": \"(219, 215, 210)\"\r\n},\r\n{\r\n    \"hex\": \"#17806D\",\r\n    \"name\": \"Tropical Rain Forest\",\r\n    \"rgb\": \"(23, 128, 109)\"\r\n},\r\n{\r\n    \"hex\": \"#DEAA88\",\r\n    \"name\": \"Tumbleweed\",\r\n    \"rgb\": \"(222, 170, 136)\"\r\n},\r\n{\r\n    \"hex\": \"#77DDE7\",\r\n    \"name\": \"Turquoise Blue\",\r\n    \"rgb\": \"(119, 221, 231)\"\r\n},\r\n{\r\n    \"hex\": \"#FFFF66\",\r\n    \"name\": \"Unmellow Yellow\",\r\n    \"rgb\": \"(255, 255, 102)\"\r\n},\r\n{\r\n    \"hex\": \"#926EAE\",\r\n    \"name\": \"Violet (Purple)\",\r\n    \"rgb\": \"(146, 110, 174)\"\r\n},\r\n{\r\n    \"hex\": \"#324AB2\",\r\n    \"name\": \"Violet Blue\",\r\n    \"rgb\": \"(50, 74, 178)\"\r\n},\r\n{\r\n    \"hex\": \"#F75394\",\r\n    \"name\": \"Violet Red\",\r\n    \"rgb\": \"(247, 83, 148)\"\r\n},\r\n{\r\n    \"hex\": \"#FFA089\",\r\n    \"name\": \"Vivid Tangerine\",\r\n    \"rgb\": \"(255, 160, 137)\"\r\n},\r\n{\r\n    \"hex\": \"#8F509D\",\r\n    \"name\": \"Vivid Violet\",\r\n    \"rgb\": \"(143, 80, 157)\"\r\n},\r\n{\r\n    \"hex\": \"#FFFFFF\",\r\n    \"name\": \"White\",\r\n    \"rgb\": \"(255, 255, 255)\"\r\n},\r\n{\r\n    \"hex\": \"#A2ADD0\",\r\n    \"name\": \"Wild Blue Yonder\",\r\n    \"rgb\": \"(162, 173, 208)\"\r\n},\r\n{\r\n    \"hex\": \"#FF43A4\",\r\n    \"name\": \"Wild Strawberry\",\r\n    \"rgb\": \"(255, 67, 164)\"\r\n},\r\n{\r\n    \"hex\": \"#FC6C85\",\r\n    \"name\": \"Wild Watermelon\",\r\n    \"rgb\": \"(252, 108, 133)\"\r\n},\r\n{\r\n    \"hex\": \"#CDA4DE\",\r\n    \"name\": \"Wisteria\",\r\n    \"rgb\": \"(205, 164, 222)\"\r\n},\r\n{\r\n    \"hex\": \"#FCE883\",\r\n    \"name\": \"Yellow\",\r\n    \"rgb\": \"(252, 232, 131)\"\r\n},\r\n{\r\n    \"hex\": \"#C5E384\",\r\n    \"name\": \"Yellow Green\",\r\n    \"rgb\": \"(197, 227, 132)\"\r\n},\r\n{\r\n    \"hex\": \"#FFAE42\",\r\n    \"name\": \"Yellow Orange\",\r\n    \"rgb\": \"(255, 174, 66)\"\r\n}\r\n]\r\n\r\nmodule.exports = pal_crayola;", "const jsgui = require('../../../../../html-core/html-core');\r\nconst Color_Grid = require('./color-grid');\r\nconst {v_subtract} = jsgui;\r\nvar Control = jsgui.Control;\r\nconst {\r\n    field,\r\n    prop\r\n} = require('obext');\r\nconst pal_crayola = require('../../../../../html-core/arr_colors');\r\nclass Color_Palette extends Control {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'color_palette';\r\n        super(spec);\r\n        this.add_class('color-palette');\r\n        prop(this, 'palette', spec.palette || pal_crayola);\r\n\r\n\r\n        // Have this within the 'view model'.\r\n        //   The color palette itself would be in the data model, probably.\r\n\r\n\r\n        prop(this, 'grid_size', spec.grid_size || [12, 12]);\r\n        if (!spec.abstract && !spec.el) {\r\n            this.compose_color_grid();\r\n        }\r\n        this.on('resize', (e_resize) => {\r\n        });\r\n    }\r\n    activate() {\r\n        if (!this.activate.__active) {\r\n            super.activate();\r\n            const attach_on_change_named_property_handler = (obj, property_name, fn_handler) => {\r\n                obj.on('change', e => {\r\n                    if (property_name === e.name) {\r\n                        fn_handler(e);\r\n                    }\r\n                })\r\n            }\r\n            attach_on_change_named_property_handler(this, 'selected', e => {\r\n                const selected_ctrl = e.value;\r\n                if (selected_ctrl) {\r\n                    let color = selected_ctrl._color;\r\n                    this.raise('choose-color', {\r\n                        value: color\r\n                    });\r\n                }\r\n            })\r\n            const old_make_grid_cells_selectable = () => {\r\n                this.grid.each_cell(cell => {\r\n                })\r\n            }\r\n        }\r\n    }\r\n    compose_color_grid() {\r\n        console.log('compose_color_grid');\r\n        var padding = 6;\r\n        const fg_bg_color_grid = new Color_Grid({\r\n            'context': this.context,\r\n            'grid_size': [2, 1],\r\n            'size': [80, 40]\r\n        });\r\n        this.add(fg_bg_color_grid);\r\n        const color_grid_pxsize = v_subtract(this.size, [0, 46]);\r\n        const color_grid = this.grid = new Color_Grid({\r\n            'context': this.context,\r\n            'grid_size': this.grid_size,\r\n            'palette': this.palette,\r\n            'size': color_grid_pxsize,\r\n            'cell_selection': 'single'\r\n        });\r\n        this.add(color_grid);\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n\t\tthis._ctrl_fields.color_grid = color_grid;\r\n        this._ctrl_fields.fg_bg_color_grid = fg_bg_color_grid;\r\n    }\r\n}\r\nif (require.main === module) {\r\n    console.log('pal_crayola.length', pal_crayola.length);\r\n} else {\r\n}\r\nmodule.exports = Color_Palette;", "/**\r\n * Created by James on 04/08/2014.\r\n */\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\nvar group = jsgui.group;\r\n\r\n\r\nvar fields = {\r\n    'name': String,\r\n    'text': String,\r\n    'value': String,\r\n    'checked': Boolean\r\n};\r\n// Want better way(s) to hook up fields like this in controls / data objects.\r\n\r\n// Data objects should probably be able to handle fields.\r\n//   Though rendering should also render these fields as their own specific attribute data-jsgui-fields\r\n\r\n\r\n\r\nclass Checkbox extends Control {\r\n    constructor(spec, add, make) {\r\n\r\n        super(spec);\r\n        this.__type_name = 'checkbox';\r\n\r\n        this.add_class('checkbox');\r\n        const context = this.context;\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            const name = this.name;\r\n\r\n            // Will need to render its ID in the DOM.\r\n\r\n            const html_check = new Control({\r\n                'context': context\r\n            });\r\n\r\n            html_check.dom.tagName = 'input';\r\n            html_check.dom.attributes.type = 'checkbox';\r\n            html_check.dom.attributes.name = name;\r\n            html_check.dom.attributes.id = html_check._id();\r\n\r\n            //html_check.set('dom.tagName', 'input');\r\n            //html_check.set('dom.attributes.type', 'checkbox');\r\n            //html_check.set('dom.attributes.name', name);\r\n            //html_check.set('dom.attributes.id', html_radio._id());\r\n\r\n            var html_label = new Control({\r\n                'context': context,\r\n                \r\n            });\r\n            html_label.dom.tagName = 'label';\r\n\r\n            if (is_defined(spec.text)) {\r\n                html_label.add(spec.text);\r\n            } else {\r\n                if (is_defined(spec.label?.text)) html_label.add(spec.label.text);\r\n            }\r\n            \r\n\r\n            //html_label.set('dom.tagName', 'label');\r\n            //console.log('that._', that._);\r\n\r\n\r\n            //var text_value = this.get('text').value();\r\n\r\n            \r\n            html_label.dom.attributes.for = html_check._id();\r\n            //html_label.set('dom.attributes.for', html_check._id());\r\n\r\n            this.add(html_check);\r\n            this.add(html_label);\r\n\r\n\r\n\r\n            //this.set('check', html_check);\r\n            //this.set('label', html_label);\r\n\r\n\r\n            //html_radio.set('dom.attributes.type', 'radio');\r\n\r\n            this._ctrl_fields = this._ctrl_fields || {};\r\n\r\n\t\t\tthis._ctrl_fields.check = html_check;\r\n            this._ctrl_fields.label = html_label;\r\n\r\n            // ._fields perhaps....\r\n            \r\n            /*\r\n            this.set('dom.attributes.data-jsgui-fields', stringify({\r\n                'value': this.value\r\n            }).replace(/\"/g, \"[DBL_QT]\").replace(/'/g, \"[SNG_QT]\"));\r\n\r\n            */ \r\n\r\n            this._fields = this._fields || {};\r\n\r\n\t\t\tif (is_defined(this.value)) this._fields.value = this.value;\r\n\r\n\r\n        }\r\n\r\n    }\r\n    //'resizable': function() {\r\n    //},\r\n    'activate'() {\r\n\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            var html_check = this.check;\r\n            var el_checkbox = html_check.dom.el;//???\r\n            var label = this.label;\r\n            //var that = this;\r\n\r\n            //var el = this.dom.el;\r\n            //\r\n\r\n            // No, refer specifically to the radio button element's control.\r\n\r\n            // Changes upon becoming checked?\r\n            html_check.on('change', e_change => {\r\n                console.log('el_radio.checked', el_radio.checked);\r\n\r\n                // Track the old values here? Could help the 'change' event.\r\n\r\n                //if (el_radio.checked) {\r\n                    this.raise('change', {\r\n                        name: 'checked',\r\n                        value: el_checkbox.checked\r\n                    });\r\n                //}\r\n\r\n                // But have it updated in the data model...?\r\n\r\n                // Specification of the data model and the view model as a pair and have the system work out how to sync them properly.\r\n                //   Define the data, define how the data model can vary, define how those variations can be displayed.\r\n                //     Then use that to create the view model, use that to create the view.\r\n\r\n            });\r\n\r\n            // Need to listen for DOM change events. That will chage the value.\r\n            //  The checked value true or false.\r\n\r\n        }\r\n        //\r\n\r\n    }\r\n};\r\n\r\nCheckbox.css = `\r\n.checkbox input + label {\r\n    margin-left: 6px;\r\n}\r\n`\r\n\r\nmodule.exports = Checkbox;", "/**\r\n * Created by james on 18/12/2016.\r\n */\r\n\r\n// Could accept only some specific types of data eg numeric.\r\n//  May well want nicer / custom scrollbars.\r\n\r\n// It will be a text box but the selection list appears below.\r\n//  So we will use List with its own scrollbar.\r\n\r\n// Should be made out of component JSGUI controls as necessary. both option control as well as text box.\r\n\r\n// text-input\r\n//  drop-down-list (menu)\r\n\r\n// Have a need for combo box\r\n//  Choosing a month\r\n//  Clicking on the box should bring up the full range of options\r\n//   Could involve scrolling\r\n//    In this situation, we want something totally HTML styled.\r\n//    Not making use of native Options.\r\n//     Keep native scrollbars for the moment. More work on jsgui scrollbars would help though.\r\n\r\n\r\n// Hold a list of items\r\n//  Data rendered as controls\r\n//  \r\n\r\n// Interested in data coming in from the side\r\n\r\n// Item_Selector could be a good alternative.\r\n//  More varied than Combo_Box. Not a problem having non-combo-box functionality.\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n\r\n//var stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\n\r\n\r\n// Basic but then could be swapped.\r\n\r\n\r\n// Allow searching / choosing with text.\r\n\r\n\r\n// This should also allow flexibility in terms of how the items are displayed???\r\n\r\n\r\n// Just allow a single icon next to the items?\r\n\r\n// A text input part\r\n// A list part\r\n\r\n// A control suite would make sense\r\n//  But maybe as another module.\r\n\r\n// This in its default form uses a kind of popup-resizing.\r\n//  There would need to be room for it to be displayed. Possibly in a popup overlay layer.\r\n\r\n\r\n\r\n// Needs more work. Would be nice to make really simple implementation that does what is needed, while allowing extensions.\r\n\r\n// May need to see about server-side autocomplete.\r\n//   Maybe use a data resource or an autocomplete data (provider) resource on the client.\r\n//     Could implement such a data provider on the client with an array.\r\n\r\n// Websockets would probably be the fastest way to transfer the autocomplete suggestions data.\r\n//   Could even have that on a different server / in a different process.\r\n//     For the moment though, want to be able to easily hook up server-side data to client-side resources.\r\n\r\n// await get_suggestions(str)\r\n//   could access the server quite easily with things set up right on the client.\r\n//     Maybe want to assign the data source on the server, then the control on the client makes a request to the client-server resource\r\n//       access component, gets that to request the answer from the server, sends it to the client.\r\n\r\n// Though setting it up with a property could be nicer.\r\n//   It may automatically create the server-side resource that holds that data / responds to (authenticated and authorised?) client side\r\n//     requests with it.\r\n//   Generating a random 256 bit token to send to the client, then for the client to send back with every request could help.\r\n//     It would be a key that allows access to that resource.\r\n//       And the server-side resource publisher would need the key from the client to access the resource.\r\n\r\n// Do need to consider specific resources for specific clients.\r\n//   User-based.\r\n\r\n// Including user-based security into jsgui3 could be useful.\r\n\r\n\r\n\r\n// A countries selector could be a good example, both for server and client side implementations.\r\n\r\n\r\n// Maybe is worth focusing more of text fields?\r\n// Number Fields?\r\n// Integer Fields?\r\n// Typed Text Fields? eg integer?\r\n// Have TextBox Text_Box elsewhere?\r\n\r\n// Also want popup menus.\r\n//   They would help the UIs of some demos too.\r\n//   Menu bars (for the top generally?) \r\n//     see https://learn.microsoft.com/en-us/dotnet/api/system.windows.forms.toolstripitem.mergeaction?view=windowsdesktop-8.0\r\n\r\n// A Menu_Bar could help.\r\n//   Maybe assume horizontal?\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Autocomplete???\r\n\r\n\r\n\r\n\r\nclass Combo_Box extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'combo_box';\r\n        super(spec);\r\n\r\n        // Has various items.\r\n        // At the top is a control that either shows the item selected, or search text.\r\n\r\n        // spec.items\r\n\r\n        // create Item control from the spec items\r\n        //  They will be displayed in a vertical list\r\n        //  \r\n\r\n\r\n\r\n        //  \r\n        //  Could use Items_Container mixin.\r\n        //  Open_Closed mixin\r\n\r\n        // Run-time mixins for the moment.\r\n\r\n\r\n\r\n        // Maybe contain a single main area and a drop-down box\r\n\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = Combo_Box;", "//const {\r\n//    prop,\r\n//    field\r\n//} = require('obext');\r\n\r\nvar jsgui = require('../html-core/html-core');\r\nconst { prop, field, Control } = jsgui;\r\n\r\n// Want to make modal windows with this.\r\n\r\n// Different to the virtual frame. That could be used to cover a control too.\r\n//  suspended frame suspended_frame\r\n\r\n// Will also have overlays available too.\r\n//  coverable works differently.\r\n\r\n\r\nlet coverable = (ctrl, opts) => {\r\n    let select_toggle = false;\r\n\r\n    // select only...\r\n    let select_multi = false;\r\n    if (!opts) {\r\n\r\n    }\r\n\r\n    if (opts) {\r\n\r\n    }\r\n    let ctrl_cover;\r\n\r\n    // Respond to the covered property changing by adding or removing a cover control.\r\n    ctrl.cover = (content) => {\r\n        /// cover control will need to be absolutely positioned on top of this...\r\n        //   or within this...\r\n\r\n        ctrl_cover = new Control({\r\n            context: ctrl.context,\r\n            class: 'cover'\r\n        });\r\n        // then the cover has a background\r\n\r\n        let ctrl_cover_bg = new Control({\r\n            context: ctrl.context,\r\n            class: 'background'\r\n        });\r\n\r\n        let ctrl_cover_fg = new Control({\r\n            context: ctrl.context,\r\n            class: 'foreground'\r\n        });\r\n        \r\n        content.remove();\r\n        ctrl_cover.add(ctrl_cover_bg);\r\n        ctrl_cover.add(ctrl_cover_fg);\r\n        ctrl_cover_fg.add(content);\r\n        ctrl.add(ctrl_cover);\r\n\r\n        // and return an uncover function.\r\n        //  a reference to the cover would be easier\r\n        return ctrl_cover;\r\n\r\n    }\r\n\r\n    ctrl.uncover = () => {\r\n        ctrl_cover.remove();\r\n        ctrl_cover = null;\r\n    }\r\n\r\n\r\n    //if (!old_selectable) {\r\n    field(ctrl, 'covered');\r\n    //field(ctrl, 'coverable');\r\n    //field(ctrl, 'select_unique');\r\n\r\n    //};\r\n    /*\r\n    if (true) {\r\n        // but it won't be defined.\r\n        if (old_coveravle !== undefined) {\r\n            ctrl.coverable = old_coveravle;\r\n        }\r\n    }\r\n    */\r\n}\r\n\r\nmodule.exports = coverable;", "\r\n// data_prop_date?\r\n//  This sets up the 'date' property.\r\n//  Very much a 'model' mixin.\r\n//   Possibly will not be used. Will make .model and .view properties, likely through mixins.\r\n\r\n\r\n// Date properties.\r\n\r\n\r\nlet lang = require('lang-tools');\r\nlet is_defined = lang.is_defined;\r\n\r\n// obext instead.\r\n\r\n\r\n// Maybe this is just to do with the data type controlled by the control.\r\n\r\nlet date = (ctrl, spec) => {\r\n\r\n    // Respond to touch events.\r\n\r\n    // generally want a 'press' event too.\r\n    //  Could be a click, or a touch press.\r\n\r\n    // Could raise a press or click event.\r\n    //  Press could cover click and touch.\r\n    //  Click could specifically be a mouse event to make least confusion / ambiguity long term.\r\n\r\n    // Could have an emulate_clicks option.\r\n\r\n    let _date, _year, _month, _day;\r\n\r\n    let constructor = () => {\r\n        // define the year, month, day properties\r\n        // on activate, will respond to changes in them.\r\n\r\n        Object.defineProperty(ctrl, `date`, {\r\n            get() {\r\n                return _date;\r\n            },\r\n            set(value) {\r\n                let old = _date;\r\n                _date = value;\r\n                // Handling the change may be best here though.\r\n                if (typeof document === 'undefined') {\r\n                    ctrl._fields = ctrl._fields || {};\r\n                    ctrl._fields['date'] = value;\r\n                }\r\n                ctrl.raise('change', {\r\n                    'name': 'date',\r\n                    'old': old,\r\n                    //'new': _disabled,\r\n                    'value': _date\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        Object.defineProperty(ctrl, `year`, {\r\n            get() {\r\n                return _year;\r\n            },\r\n            set(value) {\r\n                let old = _year;\r\n                _year = value;\r\n                // Handling the change may be best here though.\r\n                if (typeof document === 'undefined') {\r\n                    ctrl._fields = ctrl._fields || {};\r\n                    ctrl._fields['year'] = value;\r\n                }\r\n                ctrl.raise('change', {\r\n                    'name': 'year',\r\n                    'old': old,\r\n                    //'new': _disabled,\r\n                    'value': _year\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        Object.defineProperty(ctrl, `month`, {\r\n            get() {\r\n                return _month;\r\n            },\r\n            set(value) {\r\n                let old = _month;\r\n                _month = value;\r\n                // Handling the change may be best here though.\r\n                if (typeof document === 'undefined') {\r\n                    ctrl._fields = ctrl._fields || {};\r\n                    ctrl._fields['month'] = value;\r\n                }\r\n                ctrl.raise('change', {\r\n                    'name': 'month',\r\n                    'old': old,\r\n                    //'new': _disabled,\r\n                    'value': _month\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n        Object.defineProperty(ctrl, `day`, {\r\n            get() {\r\n                return _day;\r\n            },\r\n            set(value) {\r\n                let old = _day;\r\n                _day = value;\r\n                // Handling the change may be best here though.\r\n                if (typeof document === 'undefined') {\r\n                    ctrl._fields = ctrl._fields || {};\r\n                    ctrl._fields['day'] = value;\r\n                }\r\n                ctrl.raise('change', {\r\n                    'name': 'day',\r\n                    'old': old,\r\n                    //'new': _disabled,\r\n                    'value': _day\r\n                });\r\n            },\r\n            enumerable: true,\r\n            configurable: false\r\n        });\r\n\r\n\r\n        if (is_defined(spec.year) && is_defined(spec.month)) {\r\n            //console.log('are defined');\r\n            ctrl.month = spec.month; // 0 indexed\r\n            ctrl.year = spec.year;\r\n        } else {\r\n            let now = new Date();\r\n            //console.log('now', now);\r\n            ctrl.month = now.getMonth(); // 0 indexed\r\n            ctrl.year = now.getFullYear();\r\n        }\r\n\r\n        Object.assign(ctrl, {\r\n            next_month: () => {\r\n                if (ctrl.month === 11) {\r\n                    ctrl.month = 0;\r\n                    ctrl.year = ctrl.year + 1;\r\n                } else {\r\n                    ctrl.month = ctrl.month + 1;\r\n                }\r\n                ctrl.refresh_month_view();\r\n            },\r\n            previous_month: () => {\r\n                if (ctrl.month === 0) {\r\n                    ctrl.month = 11;\r\n                    ctrl.year = ctrl.year - 1;\r\n                } else {\r\n                    ctrl.month = ctrl.month - 1;\r\n                }\r\n                ctrl.refresh_month_view();\r\n            },\r\n            next_year: () => {\r\n                ctrl.year = ctrl.year + 1;\r\n                ctrl.refresh_month_view();\r\n            },\r\n            previous_year: () => {\r\n                ctrl.year = ctrl.year - 1;\r\n                ctrl.refresh_month_view();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    let activate = () => {\r\n\r\n    }\r\n\r\n    if (spec) {\r\n        constructor();\r\n    } else {\r\n        activate();\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = date;", "\r\n// just display mixin perhaps?\r\n//  so a text box could display as a small box with intro text and '...', then expand when pressed.\r\n\r\n// to become 'view'.\r\n//  Likely won't be used in this form?\r\n\r\n\r\n// Or it is view.display\r\n//  Display is a property of view.\r\n\r\n// See about putting other Contol functionality within .view?\r\n//   That would be more comprehensive than just having .view on top of the existing control.\r\n\r\n// See about programming it both ways for the moment???\r\n\r\n// Both the .model and .view properties seem important...\r\n//  But creating a .view object maybe is not so easy.\r\n//   Could make current control functions more mixin-like?\r\n\r\n//   .content goes inside .view?\r\n//     could keep .view as a relatively simple object for the moment?\r\n//       could make HTML_Control_View which includes rendering.\r\n\r\n// want to solve view modes, and get a good standard for the more complicated controls that can appear in different ways.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// will also have 'model' mixin\r\n\r\n// more advanced controls will use both the 'model' and 'view' mixins.\r\n//  within the view section, they will specify / refer to views that are specifically for a data type as specified in the model.\r\n\r\n//  controls not themselves specifying the model?\r\n//    but the control is only handling the view.\r\n//      data model could be defined just above the control though.\r\n\r\n// .model and .view:\r\n//   Could have a Ctrl_Html_Element_View for example.\r\n//   Would be a possible abstraction where it did not need to be rendered to HTML (as an element) specifically.\r\n//     For example, could be rendered into a canvas or similar.\r\n\r\n\r\n\r\n\r\n\r\n\r\n// ctrl.display property.\r\n\r\n\r\n// Calendar seems like the perfect control and type of control to make use of this.\r\n// Could be full screen and interactive, or it could be a very simple component\r\n//  displaying events over upcoming days. Could be a date picker, possibly. Possibly abstract together the similar code.\r\n\r\n// Seems somewhat heavyweight, not sure it's right for many of the simpler controls.\r\n//  However may help coordination... small components of a control acting in coordination with the rest? Though that should prob be top-down?\r\n\r\n// Maybe I am creating too many classes that will be made for individual controls.\r\n\r\n// Possibly display modes can keep functions which then get executed according to which display mode option is selected.\r\n//  ie the composition functions still get called within their normal place and scope.\r\n\r\n// Seems like quite a large and complicated mixin...\r\n//  Also seems like a 'major version' feature.\r\n\r\n// This seems a lot like branching - conveniently arranging the branching for how a Control gets displayed.\r\n\r\n// Let's make this by making some examples work....\r\n//  May be better to have server as a dev dependency? Though it gets tricky if part of that breaks. Could help develop UI components.\r\n\r\n// Maybe jsgui3-html-core would help?\r\n//  Then a module such as jsgui3-html-controls? Both loaded into jsgui3-html?\r\n//  jsgui3-html-core-controls? jsgui3-html-mixins?\r\n\r\n// For the moment let's keep it simpler as one lib.\r\n\r\n\r\n// Load mx display onto the control.\r\n//  Access the .display property and its subproperties.\r\n//   displaye.size could be / return a Control_Display_Size object.\r\n//    could be quite specialised. Could also be simple to use.\r\n//  .display will link things together, and have the functionality provided in the mixin.\r\n//   or at least the structure of the functionality in the mixin.\r\n//   \r\n\r\n//  model, view and controller mixins may make sense here.\r\n//   view.context possibly???\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet lang = require('lang-tools');\r\n\r\n\r\n// and fnl code too?\r\nconst {Evented_Class, tof, each} = lang;\r\n\r\n// Rendering-time checks?\r\n//  Or will it be that items actually added to / removed from Controls?\r\n//   Probably best to integrate simply and safely with HTML rendering.\r\n//   Different rendering depending on options.\r\n//   Don't want to introduce low level changes if not important / greatly beneficial.\r\n//    Would be easy enough to make skip rendering flags.\r\n//    Or multiple collections of controls.\r\n\r\n// Composition-time checks\r\n//  And would have recomposition when necessary.\r\n\r\n// so the compose function would check the display mode\r\n// maybe the activate function would\r\n//  though it could check what is available.?\r\n//   better to make the content controls depending on the display mode.\r\n//   want to make them quick to specify / describe.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// ctrl.display.color could be solved too.\r\n//  may reasonably assume it refers to the background color.\r\n\r\n\r\n// And a Ctrl_Display_Mode class perhaps.\r\n\r\n// Ctrl_Display_Modes\r\n//   Makes sense for storing these modes.\r\n\r\n// Size modes\r\n// Other presentation modes (may influence size??)\r\n//  eg whether its in editing mode or not.\r\n\r\n\r\n// Any need for a Ctrl_Display_Mode class?\r\n//  Maybe it would need to store / be a place to hook some more advanced functionality.\r\n\r\n// eg a Ctrl_Display_Mode object called 'small'.\r\n\r\n\r\n\r\n// Ctrl_Display_Mode_Category\r\n//  Like interactivity or interactions, or size.\r\n//  Or color / colors.\r\n\r\n// display.colors.a_part_with_a_name\r\n\r\n// display.modes.colors (light and dark modes)\r\n// display.modes.languages possibly\r\n//  makes a lot of sense to have that kind of breakdown of display modes.\r\n\r\n// Could create a category object for each of them?\r\n\r\n// Want only a moderate amount of effort / boilerplate code needed in the controls.\r\n// Want it to be very easy to call upon the functionality when using the controls.\r\n\r\n\r\n\r\nclass Ctrl_Display_Mode_Category extends Evented_Class {\r\n    constructor(spec = {}) {\r\n\r\n        super(spec);\r\n\r\n        // spec.name should exist.\r\n\r\n        let name;\r\n        if (spec.name) {\r\n            name = spec.name;\r\n        } else {\r\n            throw 'Ctrl_Display_Mode_Category requires a name property';\r\n        }\r\n    }\r\n}\r\n\r\n\r\nclass Ctrl_Display_Modes_Categories extends Evented_Class {\r\n    constructor(spec = {}) {\r\n        \r\n        super(spec);\r\n\r\n        // spec.names for example.\r\n        const map_categories = {}, arr_categories = [];\r\n\r\n        if (spec.names) {\r\n            if (tof(spec.names) === 'array') {\r\n                each(spec.names, name => {\r\n                    const cat = new Ctrl_Display_Mode_Category({name: name});\r\n                    map_categories[name] = cat;\r\n                    arr_categories.push(cat);\r\n                })\r\n            } else {\r\n                throw 'NYI';\r\n            }\r\n        }\r\n        // then use proxy to get by index???\r\n\r\n        // What to do with them though?\r\n\r\n\r\n\r\n        // should probably have size, colors, interactivity, (other styling) / presentation.\r\n    }\r\n}\r\n\r\n\r\n\r\nclass Ctrl_Display_Modes extends Evented_Class {\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        // the Ctrl? Maybe dont need it :)\r\n        // small, medium, large for example.\r\n        // Would have multiple display mode categories.\r\n\r\n        // Layout or formatting.\r\n        //  Some layout options would be unavailable with really small sizes.\r\n        //  Then there may be only really basic layouts, such as image and text caption.\r\n        //   Want to make the same Control able to render relatively differently and have that easy to express in code.\r\n\r\n        // Such as in the constructor, putting the control together, easy programmatic definition.\r\n\r\n        // Also 2022 now that it all (lower level) basically works, can more more onto syntactic sugar.\r\n\r\n        const arr_category_names = ['size', 'layout', 'colors', 'interactivity'];\r\n        // theme as well? could be within colors too.\r\n        //  these will have control over lower level CSS properties.\r\n\r\n        // then create Ctrl_Display_Modes_Category object...\r\n        //  or a Categories object to handle them all?\r\n\r\n        const categories = new Ctrl_Display_Modes_Categories({names: arr_category_names});\r\n\r\n        Object.defineProperty(ctrl, 'categories', {\r\n            get() {\r\n                return categories;\r\n            },\r\n            set(value) {\r\n                throw 'NYI';\r\n            }\r\n        });\r\n\r\n        // .colors\r\n        // .\r\n\r\n        /*\r\n            {size: [['small', {}]]}\r\n\r\n        */\r\n\r\n\r\n        // size modes\r\n        // functionality modes (eg editable or not)\r\n\r\n\r\n        // And will raise events upon change.\r\n        //  May need to update control.\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nclass Ctrl_Display extends Evented_Class {\r\n    // so it can have on change events.\r\n\r\n    constructor(spec = {}) {\r\n        super(spec);\r\n        let ctrl;\r\n        if (spec.ctrl) ctrl = spec.ctrl;\r\n\r\n        // .modes seems to make sense as an object.\r\n        //   but then there can be different mode categories\r\n\r\n        // Setting this up with some reasonable defaults for the moment....\r\n\r\n\r\n\r\n        const modes = new Ctrl_Display_Modes({});\r\n\r\n        Object.defineProperty(this, 'modes', {\r\n            get() {\r\n                return modes;\r\n            },\r\n            set(value) {\r\n\r\n                // determine the type of the value\r\n\r\n                // ctrl_display.mode = ...\r\n\r\n                //  a string - is it one word? does it match a name of the defined or default display types.\r\n\r\n                // eg .display = 'mini', sets the display mode.\r\n\r\n                throw 'NYI';\r\n            }\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        // Which modes are supported?\r\n        //  Not all modes would need to be supported. Probably never want a full screen checkbox, though maybe want a fullscreen control\r\n        //  with a very prominent checkbox.\r\n\r\n\r\n        // Could get the preferred aspect ratio or shape through here.\r\n\r\n        // display.size property\r\n        //  more to do with size mode?\r\n\r\n        // mode properties for different things.\r\n\r\n        // display.mode.size makes sense for some things.\r\n        //  perhaps display size could shortcut to it.\r\n\r\n\r\n\r\n\r\n\r\n        // May make sense to set up the various default display modes.\r\n        //  Then could set them differently or intelligently calculate them for different controls.\r\n\r\n        // tinyicon 12x12\r\n        // icon 32x32\r\n        // small 128x128\r\n        // mid 512x512\r\n        // large 1024x768\r\n        // full ???\r\n\r\n\r\n        // are some display modes (only?) available as popups?\r\n        //  or would they be available through a 'details' section?\r\n\r\n        // Want to allow for flexibility, and the default case creating easy flexibility.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n// display.size = ...\r\n//  named preset, or [w, h].\r\n//  or even z 3d if we want shaped with 3d rendering.\r\n//   would be cool to render polygons within the dom.\r\n//   treat DOM as flat planes in z-index order.\r\n\r\n\r\nlet display = (ctrl, opts = {}) => {\r\n\r\n    // And send the control display options through?\r\n\r\n    // Should set up the modes here too?\r\n    //  mx display makes a lot of sense for the name of the functionality.\r\n\r\n    if (ctrl.display) {\r\n        throw 'ctrl already has .display property';\r\n    } else {\r\n        const ctrl_display = new Ctrl_Display({\r\n            ctrl: ctrl\r\n        });\r\n        Object.defineProperty(ctrl, 'display', {\r\n            get() {\r\n                return ctrl_display;\r\n            },\r\n            set(value) {\r\n\r\n                // determine the type of the value\r\n\r\n                // ctrl_display.mode = ...\r\n\r\n                //  a string - is it one word? does it match a name of the defined or default display types.\r\n\r\n                // eg .display = 'mini', sets the display mode.\r\n\r\n                throw 'NYI';\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n    // setup display modes on the control\r\n    //  could set up some intelligent default sizes...\r\n    //   eg 'icon' size is 32x32.\r\n    \r\n    // May get given info about the wanted shapes for the display modes (where possible).\r\n\r\n    // preferred_ratio perhaps?\r\n    // preferred_shape.ratio perhaps?\r\n    // preferred_shape.width = 100% perhaps?\r\n    // perferred_shape.available_width = true perhaps.\r\n\r\n\r\n    // Could have this set up display modes with default options to start with.\r\n\r\n    // Want it to be easy to call on and use display mode functionality.\r\n    //  May want nice (CSS) transitions between display modes.\r\n\r\n    // ctrl.display_mode = 'small' for example.\r\n    // ctrl.popup_active property?\r\n    // ctrl.display.popup ???\r\n\r\n    // .display property?\r\n    // .display.mode property perhaps?\r\n\r\n    // ctrl.display seems like it could make sense for handling higher level display properties.\r\n    //  above the CSS and DOM attributes.\r\n\r\n}\r\n\r\nmodule.exports = display;", "\r\n// just display mixin perhaps?\r\n//  so a text box could display as a small box with intro text and '...', then expand when pressed.\r\n\r\n// Just use display.js ???? May be a more user-friendly and simple name.\r\n//  Much of that is about modes and categories of modes.\r\n\r\n\r\nlet display_modes = (ctrl, opts = {}) => {\r\n\r\n\r\n    // setup display modes on the control\r\n    //  could set up some intelligent default sizes...\r\n    //   eg 'icon' size is 32x32.\r\n    \r\n    // May get given info about the wanted shapes for the display modes (where possible).\r\n\r\n    // preferred_ratio perhaps?\r\n    // preferred_shape.ratio perhaps?\r\n    // preferred_shape.width = 100% perhaps?\r\n    // perferred_shape.available_width = true perhaps.\r\n\r\n\r\n    // Could have this set up display modes with default options to start with.\r\n\r\n    // Want it to be easy to call on and use display mode functionality.\r\n    //  May want nice (CSS) transitions between display modes.\r\n\r\n    // ctrl.display_mode = 'small' for example.\r\n    // ctrl.popup_active property?\r\n    // ctrl.display.popup ???\r\n\r\n    // .display property?\r\n    // .display.mode property perhaps?\r\n\r\n    // ctrl.display seems like it could make sense for handling higher level display properties.\r\n    //  above the CSS and DOM attributes.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nmodule.exports = display_modes;", "let fast_touch_click = (ctrl) => {\r\n\r\n    // Respond to touch events.\r\n\r\n    // generally want a 'press' event too.\r\n    //  Could be a click, or a touch press.\r\n\r\n    // Could raise a press or click event.\r\n    //  Press could cover click and touch.\r\n    //  Click could specifically be a mouse event to make least confusion / ambiguity long term.\r\n\r\n    // Could have an emulate_clicks option.\r\n\r\n    let has_moved_away = false;\r\n    ctrl.on('touchstart', ets => {\r\n        //console.log('ets', ets);\r\n        // Then cancel the event.\r\n        //console.log('Object.keys(ets)', Object.keys(ets));\r\n        // Returning false from such a DOM event should cancel the event propagation.\r\n        ets.preventDefault();\r\n        //return false;\r\n    })\r\n    ctrl.on('touchend', ete => {\r\n        //console.log('ete', ete);\r\n        if (!has_moved_away) {\r\n            ctrl.raise('click', ete);\r\n        }\r\n        has_moved_away = false;\r\n    })\r\n    ctrl.on('touchmove', etm => {\r\n        has_moved_away = true;\r\n        //console.log('etm', etm);\r\n    })\r\n}\r\n\r\nmodule.exports = fast_touch_click;", "/*\r\n    Makes a control appear in place, but with absolute position, at the top of the DOM.\r\n    Outside the overflow of what was its container.\r\n\r\n    Measure current position\r\n    Offset / position within document\r\n        Move it to that location with absolute positioning.\r\n\r\n    Be able to return it to its original position.\r\n\r\n    // .popped_up = true\r\n    // Properties on init, not on activation.\r\n    // .popup\r\n    // Some content will be hidden until it shows through popup.\r\n\r\n    // \r\n\r\n    Interaction with Display / display.mode as well?\r\n    Some display modes will be in a popup?\r\n\r\n*/\r\n\r\n// The page context could give a floating layer if asked.\r\n\r\nconst jsgui = require('../html-core/html-core');\r\nconst stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nconst Control = jsgui.Control;\r\n\r\nconst context_ensure_popup_layer = (context) => {\r\n    let ctrl_document = context.ctrl_document;\r\n    // then body...\r\n    // .child_controls\r\n    // .content.length\r\n    // Can get the popup layer from the context now.\r\n\r\n    // context.overlay property\r\n\r\n    //console.log('ctrl_document', ctrl_document);\r\n\r\n    let body = context.map_controls['body_0'];\r\n\r\n    // May use overlay from the context.\r\n\r\n    if (!body.popup_layer) {\r\n        body.popup_layer = new Control({\r\n            'context': context,\r\n            '__type_name': 'popup_layer'\r\n        });\r\n        body.popup_layer.add_class('popup-layer');\r\n        //body.popup_layer.dom.attributes.style.position = 'absolute';\r\n\r\n        body.add(body.popup_layer);\r\n    }\r\n    return body.popup_layer;\r\n}\r\n\r\n\r\nconst popup = (ctrl) => {\r\n    let context = ctrl.context;\r\n    // ctrl_document\r\n    ctrl.popup = () => {\r\n        let popup_layer = context_ensure_popup_layer(context);\r\n        let parent, placeholder;\r\n        setTimeout(() => {\r\n\r\n            // make it transparent rather than see-through\r\n            // put a placeholder control in its original location.\r\n            // move the control over to the body.\r\n            //  the body could have a popup layer.\r\n            //  just a div ctrl where all / most of the popups go.\r\n\r\n            // ensure the page context's popup layer\r\n            // swap it in its current position with a placeholder, move the ctrl to the popup layer.\r\n\r\n            // ctrl measure.\r\n            // getBoundingClientRect\r\n           \r\n\r\n            \r\n\r\n            // Need to pay attention to moving content from one place to another.\r\n\r\n            // control.add(ctrl)\r\n            //  what if ctrl already has a parent\r\n            //  already is in the DOM.\r\n            //   need to remove the control from its previous parent.\r\n            //    (no dom update)\r\n            \r\n\r\n            placeholder = new Control({\r\n                'context': context,\r\n                '__type_name': 'placeholder'\r\n            });\r\n\r\n            parent = ctrl.parent;\r\n\r\n            let absolute_container = new Control({\r\n                'context': context\r\n            })\r\n\r\n            popup_layer.add(absolute_container);\r\n            absolute_container.add(placeholder);\r\n\r\n            parent.content.swap(ctrl, placeholder);\r\n            //ctrl.remove_class('hidden');\r\n            //ctrl.add_class('invisible');\r\n\r\n            let bcr = placeholder.dom.el.getBoundingClientRect();\r\n\r\n            \r\n            //console.log('bcr', bcr);\r\n            \r\n\r\n\r\n            // ctrl could have an absolute-container.\r\n            //  then the control can display (more) normally.\r\n\r\n            absolute_container.dom.attrs.style.position = 'absolute';\r\n            absolute_container.dom.attrs.style.left = bcr.left + 'px';\r\n            absolute_container.dom.attrs.style.top = bcr.top + 'px';\r\n\r\n            //setTimeout(() => {\r\n            //    ctrl.remove_class('hidden');\r\n            //}, 1000);\r\n\r\n            ctrl.remove_class('hidden');\r\n            \r\n            \r\n\r\n        }, 0);\r\n\r\n        // controls won't have 2 parents.\r\n\r\n        // moving but keeping a placeholder...\r\n        //  could change the reference in the parent element.\r\n\r\n        const replace = () => {\r\n            ctrl.add_class('hidden');\r\n            parent.content.swap(placeholder, ctrl);\r\n        }\r\n        return replace;\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = popup;", "const {\r\n\tprop,\r\n\tfield\r\n} = require('obext');\r\n\r\nconst {\r\n\teach,\r\n\ttof\r\n} = require('lang-tools');\r\n\r\n/*\r\n\tHandling mouseup outside of the document.\r\n        Is quite important.\r\n        'Virtual' mouseup events? Have it on by default.\r\n        It's working, but making it an option may work better still.\r\n\r\n\tShould have a mousemove handler (while dragging) to check to see if the button in question has been released.\r\n\tMaybe only applies with the mouse drag?\r\n\r\n\tOn mousemove, no buttons down means def not dragging???\r\n\r\n\tBut getting clarity on which mouse buttons are down would help at the beginning.\r\n\tA class that models the mouse may help.\r\n\r\n\tThough let's focus on getting some specific and basic GUI things working.\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n// control_helpers too perhaps.\r\n\r\n// A positioning helper.\r\n// A positioning info helper perhaps.\r\n\r\n// Positions will need to get dealt with in all sorts of different ways.\r\n//   To some extent it's worth modelling the CSS rules.\r\n\r\n// Want to specify what adjustments to make in some cases, though having them made automatically and well is the ideal.\r\n//   Automatically and out-of sync would be one of the worst behavioiurs.\r\n\r\n// Though may be worth doing a bit of specific code here for draggable behaviours --- though having code that specifically\r\n//   helps with all sorts of position calculations could work well here.\r\n\r\n// Maybe some more classes could help too, eg Position_Confiner\r\n//   And would apply to a Position object of some sort.\r\n\r\n// Position_Confiner perhaps even, if using it would make the code at the higher level very clear.\r\n\r\n// For the moment, see about handling variety of cases in the code here, see what is needed.\r\n\r\n// Things like calculating the expected clearance between the edges and the bounds before moving.\r\n\r\n// Ctrl_Pair_Positioning_Relationship_Info may be a useful class for some things.\r\n//   Could be a good API for dealing with a variety of positioning issues in different parts of the codebase.\r\n\r\n// May want to be specific about which positioning relationship info classes for for which overall setups.\r\n//   Eg only for an absolutely positioned control within a relative one.\r\n//     Would make sense for Ctrl_Pair_Positioning_Relationship_Info to have and use info on what CSS does.\r\n\r\n// However, want to get some simpler cases involving bounds working here.\r\n\r\n// A variety of very specific classes could help client-side, so long as the top level(s) of API are simple.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Want to make it simpler to create more specific behaviours like drag to grid position.\r\n//  Drop targets could be one way to do that.\r\n\r\n// Dynamic_Size could be an interesting one.\r\n//  Uses the space available or the space it's given as a property.\r\n\r\n// Maybe need drag-events mixin?\r\n// Or drag-within?\r\n//  the click-and-drag could be used for different things in different situations.\r\n//  eg box select too.\r\n// Want some kinds of specific handling, or mid-specificity handling.\r\n//  Meaning on the higher level there is not much code to write in order to use the functionality.\r\n//  Maybe it's a grid upgrade?\r\n//   Such as dragging on a grid?\r\n//   Or part of press-events?\r\n\r\n// Somewhat complex mixin, seems to work well with the transform-xy drag mode.\r\n//   Should make this a bit more general purpose, but where possible write idiomatic code.\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Get working with ghost drag too?\r\n//  Want to get features demo working soon.\r\n//  Probably separate pages will help to keep it simpler to begin with.\r\n//  Maybe CMS should be finished to power it.\r\n\r\n// disables console logging in this module.\r\n//const console = {log: () => {}};\r\n\r\n\r\n// Maybe a class may work better...?\r\n// Could be easier to make variations and subclasses.\r\n\r\n\r\n// Seems like we need a 'handle_to' ctrl option.\r\n//   So dragging the hansdle drags the control it's the handle to.\r\n\r\n// So here can specify a ctrl to use as the handle.\r\n\r\n\r\n// Also be able to specify controls which don't start the drag.\r\n//   Perhaps automatically make some kinds of controls, such as Buttons, not begin a drag or act as a drag handle.\r\n\r\n\r\n// Seems like there is still a problem identifying parent nodes upon activation.\r\n//   Looks like pre-activate needs to properly assign the parents.\r\n//     Maybe / probably needs to assign / add the children into the parents contents.\r\n//       maybe could shortcut that and assign .content._arr = [...]\r\n\r\n// Could make some of the more complex / unwieldy activation code clearer in purposes.\r\n\r\nconst drag_like_events = (ctrl, opts = {}) => {\r\n\r\n\tlet {\r\n\t\t\r\n\t\t//condition\r\n\t} = opts;\r\n\t// bounds could be a control.\r\n\r\n    let start_action;\r\n\r\n    if (!ctrl.__using_drag_like_events) {\r\n        start_action = start_action || ['touchstart', 'mousedown'];\r\n        if (tof(start_action) === 'string') start_action = [start_action];\r\n\r\n        //console.log('ctrl.parent', ctrl.parent);\r\n        //console.log('bounds', bounds);\r\n\r\n        // Maybe have Window bounded within its parent by default.\r\n\r\n        \r\n\r\n        let pos_md, pos_mm, pos_mu, pos_md_within_ctrl;\r\n\r\n        // pos_md_within_ctrl\r\n\r\n        //console.log('ctrl.context.body', ctrl.context.body);\r\n\r\n        let ctrl_body = ctrl.context.body();\r\n\r\n\r\n\r\n\r\n        let dragging = false;\r\n        let drag_offset_distance = opts.start_distance || 6;\r\n\r\n\r\n\r\n        let movement_offset;\r\n        let item_start_pos;\r\n\r\n        //let bounds_size;\r\n        //let bounds_offset;\r\n        let half_item_width, item_width, initial_bcr;\r\n\r\n\r\n\r\n        const el = ctrl.dom.el;\r\n\r\n\r\n        \r\n        let initial_ctrl_translate;\r\n\r\n\r\n        // No actual drag taking place.\r\n        //   Basically want to return the offsets.\r\n\r\n        // will be a bit wordy for the moment.\r\n\r\n        // .on('begin-drag-like-action')\r\n\r\n\r\n        const begin_drag = (pos) => {\r\n\r\n\r\n\r\n            //console.log('begin_drag like action', pos);\r\n\r\n            // initial_bcr\r\n            // initial_bounds_bcr\r\n            initial_bcr = ctrl.bcr();\r\n            dragging = true;\r\n            //console.log('initial_bcr', initial_bcr);\r\n\r\n            // These should help with the calculaton to keep it within the bounds, with different drag modes.\r\n\r\n            // initial ctrl bcr offset from initial bounds bcr.\r\n\r\n            const old_bounds_handling_code = () => {\r\n                if (bounds) {\r\n                    if (typeof bounds.bcr === 'function') {\r\n                        initial_bounds_bcr = bounds.bcr();\r\n                        //console.log('initial_bounds_bcr', initial_bounds_bcr);\r\n\r\n                        // and the initial client translate x and y that are applied?\r\n\r\n                        // And will have an estimated / computed new bcr when dragging???\r\n\r\n\r\n                        // easy way to do the subtraction???\r\n\r\n                        // pos offset from bcr???\r\n\r\n                        // Maybe not needed...\r\n\r\n                        // But a detailed / advanced Control_Positioning module or class could help.\r\n                        // Control_Positioning_Helper.\r\n\r\n                        // Helper almost being a mixin? Helper must have all functionality called from that helper.\r\n\r\n\r\n\r\n\r\n                        initial_bcr_offset_from_bounds = [\r\n                            [initial_bcr[0][0] - initial_bounds_bcr[0][0], initial_bcr[0][1] - initial_bounds_bcr[0][1]],\r\n                            [initial_bcr[1][0] - initial_bounds_bcr[1][0], initial_bcr[1][1] - initial_bounds_bcr[1][1]],\r\n                            [initial_bcr[2][0] - initial_bounds_bcr[2][0], initial_bcr[2][1] - initial_bounds_bcr[2][1]]\r\n                        ]\r\n\r\n                        //console.log('initial_bcr_offset_from_bounds', initial_bcr_offset_from_bounds);\r\n\r\n\r\n                        //initial_bcr_offset_from_bounds = [[initial_bounds_bcr[]], [], []]\r\n\r\n                    }\r\n                }\r\n            }\r\n    \r\n\r\n\r\n            ctrl.raise('drag-like-action-start');\r\n        }\r\n\r\n\r\n\r\n        const move_drag = (pos) => {\r\n            //let ctrl_size = ctrl.bcr()[2];\r\n            //let ctrl_size = [ctrl.dom.el.offsetWidth, ctrl.dom.el.offsetHeight];\r\n\r\n            //console.log('bounds_size', bounds_size);\r\n            //console.log('ctrl_size', ctrl_size);\r\n\r\n            //console.log('move_drag pos', pos);\r\n\r\n            // No such thing as drag_mode.\r\n\r\n            ctrl.raise('drag-like-action-move', {\r\n                offset: movement_offset\r\n            });\r\n\r\n            \r\n\r\n        }\r\n\r\n        const body_mm = e_mm => {\r\n            // So for mouse move....\r\n            //.  Detect if no button is down.\r\n\r\n            let touch_count = 0;\r\n\r\n            // The number of buttons though?\r\n            //. No buttons, touch_count of 0?\r\n\r\n            //console.log('e_mm.button', e_mm.button);\r\n            //console.log('e_mm.buttons', e_mm.buttons);\r\n\r\n\r\n            \r\n\r\n            if (e_mm.touches) touch_count = e_mm.touches.length;\r\n            if (e_mm.buttons === 0 && touch_count === 0) {\r\n\r\n                // The virtual mouseup or touch end.\r\n                body_mu();\r\n\r\n            } else {\r\n\r\n\r\n                if (e_mm.touches) {\r\n                    pos_mm = [e_mm.pageX || e_mm.touches[0].pageX, e_mm.pageY || e_mm.touches[0].pageY];\r\n                } else {\r\n                    pos_mm = [e_mm.pageX, e_mm.pageY];\r\n                }\r\n\r\n                \r\n\r\n                // could store a variable that tracks the last event.\r\n\r\n                //console.log('movement_offset', movement_offset);\r\n                //console.log('item_start_pos', item_start_pos);\r\n                //console.log('pos_md', pos_md);\r\n                //console.log('pos_mm', pos_mm);\r\n\r\n\r\n                if (touch_count === 0 || touch_count === 1) {\r\n\r\n                    if (e_mm.pageX || e_mm.touches) {\r\n\r\n                        let pos_mm;\r\n\r\n                        if (e_mm.touches) {\r\n                            pos_mm = [e_mm.pageX || e_mm.touches[0].pageX, e_mm.pageY || e_mm.touches[0].pageY];\r\n                        } else {\r\n                            pos_mm = [e_mm.pageX, e_mm.pageY];\r\n                        }\r\n\r\n                        if (pos_mm[0] !== undefined && pos_mm[1] !== undefined) {\r\n                            movement_offset = [pos_mm[0] - pos_md[0], pos_mm[1] - pos_md[1]];\r\n                            if (!dragging) {\r\n                                //movement_offset = [(offset_mm[0]), Math.abs(offset_mm[1])];\r\n                                let abs_offset = [Math.abs(movement_offset[0]), Math.abs(movement_offset[1])];\r\n                                let abs_offset_dist = Math.sqrt(Math.pow(abs_offset[0], 2) + Math.pow(abs_offset[1], 2));\r\n\r\n                                //console.log('drag_offset_distance', drag_offset_distance);\r\n\r\n                                //console.log('abs_offset_dist', abs_offset_dist);\r\n                                if (abs_offset_dist >= drag_offset_distance) {\r\n                                    begin_drag(pos_mm);\r\n                                }\r\n                            } else {\r\n                                move_drag(pos_mm);\r\n                            }\r\n                        }\r\n\r\n                        \r\n                        \r\n                    }\r\n\r\n\r\n                }\r\n\r\n            }\r\n\r\n            // \r\n\r\n            \r\n            // Looks like they are passive now by default.\r\n            //e_mm.preventDefault();\r\n        }\r\n\r\n        const end_drag = e_mu => {\r\n            // depending on if it is touch or mouse\r\n\r\n            ctrl_body.off('mousemove', body_mm);\r\n            ctrl_body.off('mouseup', body_mu);\r\n\r\n            ctrl_body.off('touchmove', body_mm);\r\n            ctrl_body.off('touchend', body_mu);\r\n\r\n            if (dragging) {\r\n                dragging = false;\r\n                //console.log('end_drag', end_drag);\r\n                //console.trace();\r\n                // Also end drag attempt...\r\n                //  Want it switched off on mouseup.\r\n                //console.log('pre raise drag complete');\r\n                //console.log('movement_offset', movement_offset);\r\n\r\n                //ctrl.raise();\r\n                ctrl.raise('drag-like-action-end', {\r\n                    offset: movement_offset\r\n                });\r\n            }\r\n        }\r\n\r\n        const body_mu = e_mu => {\r\n            // release\r\n            //console.log('body_mu', e_mu);\r\n            //console.trace();\r\n            end_drag(e_mu);\r\n        }\r\n\r\n\r\n\r\n        const h_md = (e_md) => {\r\n            //console.log('dragable e_md', e_md);\r\n\r\n            //console.log('e_md.pageX', e_md.pageX);\r\n\r\n            // Strange...\r\n            if (e_md.pageX) {\r\n                pos_md_within_ctrl = [e_md.offsetX, e_md.offsetX];\r\n            } else {\r\n                pos_md_within_ctrl = [0, 0];\r\n            }\r\n            dragging = false;\r\n\r\n            //pos_md_within_ctrl = [e_mm.pageX || e_mm.touches[0].pageX, e_mm.pageY || e_mm.touches[0].pageY];\r\n\r\n            //if (drag_mode === 'x') {\r\n            //pos_md = [e_md.layerX, e_md.layerY];\r\n\r\n            // Cancel move if there are multiple touches?\r\n            //  Want to recognise pinch / 2 finger rotate events.\r\n\r\n            pos_md = [e_md.pageX || e_md.touches[0].pageX, e_md.pageY || e_md.touches[0].pageY];\r\n\r\n            //console.log('pos_md', pos_md);\r\n\r\n            // get the 3d translation value...\r\n            //  possibly using the system of dims to set the translate value will help too.\r\n\r\n            // .t3d typed array\r\n            //  and can listen to changes in these values in between frames.\r\n\r\n\r\n\r\n\r\n\r\n            // need to mm pos like this too...\r\n\r\n            //} else {\r\n            //pos_md = [e_md.pageX || e_md.touches[0].pageX, e_md.pageY || e_md.touches[0].pageY];\r\n            //}\r\n            ctrl_body.on('mousemove', body_mm);\r\n            ctrl_body.on('mouseup', body_mu);\r\n            ctrl_body.on('touchmove', body_mm);\r\n            ctrl_body.on('touchend', body_mu);\r\n\r\n            //e_md.stopPropagation();\r\n            //e_md.preventDefault();\r\n        }\r\n\r\n        field(ctrl, 'drag_like_events');\r\n        //field(ctrl, 'select_unique');\r\n        //let id = ctrl._id();\r\n        ctrl.on('change', e_change => {\r\n            //console.log('e_change', e_change);\r\n\r\n\r\n            let n = e_change.name,\r\n                value = e_change.value;\r\n\r\n            // Maybe make an abstraction for switching mixins on and off (attaching and unattaching event handlers)\r\n\r\n\r\n\r\n            if (n === 'drag_like_events') {\r\n                if (value === true) {\r\n                    // ctrl.deselect();\r\n                    //console.trace();\r\n\r\n                    if (typeof document === 'undefined') {} else {\r\n                        // on activation of control.\r\n\r\n                        let apply_start_handlers = (start_action) => {\r\n\r\n                            // handle is the ctrl itself???\r\n\r\n                            //console.log('apply_start_handlers handle', handle);\r\n                            //console.trace();\r\n\r\n                            \r\n\r\n                            if (!ctrl.has_drag_like_md_handler) {\r\n                                ctrl.has_drag_like_md_handler = true;\r\n                                each(start_action, sa => {\r\n                                    ctrl.on(sa, h_md);\r\n                                });\r\n                                //handle.on('touchstart', h_md);\r\n                                //handle.on('mousedown', h_md);\r\n                            }\r\n                            \r\n                        }\r\n                        //console.log('handle.has_drag_md_handler', handle.has_drag_md_handler);\r\n                        ctrl.once_active(() => {\r\n                            //console.log('dragable once_active');\r\n                            apply_start_handlers(start_action);\r\n                        });\r\n                    }\r\n                } else {\r\n                    if (typeof document === 'undefined') {} else {\r\n\r\n                        \r\n                        (start_action => {\r\n                            each(start_action, sa => {\r\n                                ctrl.off(sa, h_md);\r\n                            });\r\n                        })(start_action);\r\n                        \r\n\r\n\r\n                        /*\r\n                        handle.off('touchstart', h_md);\r\n                        handle.off('mousedown', h_md);\r\n                        */\r\n                        ctrl.has_drag_md_handler = false;\r\n\r\n\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        ctrl.__using_drag_like_events = true;\r\n    }\r\n\r\n\t//control\r\n\r\n\t// And maybe same / similar for the resize handle.\r\n\t//   Maybe make the resize handle dragable???\r\n\t//     Prob don't need to in most cases, use more specific programming for it.\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n}\r\n\r\nmodule.exports = drag_like_events;", "\r\n\r\n/*\r\n\r\n\r\n1. That it can be resized\r\n2. How it can be resized\r\n\r\nThere may be a resizable type interface or set of expectations and functionality, but then different UIs to do the resizing.\r\n\r\n\r\nautosizing perhaps\r\nsmart-size?\r\nsize-options?\r\nsize?\r\nsizes?\r\ndisplay-modes? and sizes?\r\nnavigation modes too?\r\n  eg popup-explore interface\r\nneed to separate the abstractions of the content itself and the structure its displayed in\r\n  eg could show a tree as a tree component of through navigation of (virtual) pages.\r\n\r\nmaybe should have size-binding?\r\nbind-size mixin.\r\n\r\nbind mixin?\r\n  binds one control to another\r\n  so the size can depend on the amount of space it has available.\r\n  defining the amount of size available or finding it in some cases \r\n    change those cases so the size gets bound rather than set just once.\r\n\r\nbind-dimensions?\r\n\r\nUI to enable the user to resize it, by integrating handles?\r\n// Will use dimension and overlays in various ways to facilitate this.\r\n//  Maybe work on this a bit later.\r\n\r\nui-resizable? or assumed.\r\n\r\nWant really easy (top level) syntax for resizing and use of resize handles.\r\n\r\nMovement of the resize handle (drag-like operation) causes window to resize, resize handle does not need to move explicitly through code if\r\nit's positioned in the correct part of the window with existing CSS (or other position binding).\r\n\r\nKeep this code relativel simple if possible.\r\n\r\nCould have mode specifically for a BR fixed in the right place (part of / relative to the window) and respond to events on it.\r\n\r\nMaybe a drag_like_events mixin???\r\nSeems worth getting really explicit about what is being done and what is needed, where code can be common to various mixins\r\nand pieces of functionality.\r\n\r\nDrag_Like_Events or something like that drag_like_events mixin could provide the basis.\r\nHandles mouse downs and gives the offset(s) from starting positions.\r\n\r\nDoes seem best to solve and use general case code for things like this.\r\nGoing by offset with the mousedown position seems like the right approach to take.\r\n\r\nMaybe Drag_Offset_Events???\r\nReally we want to know the offsets.\r\n\r\n// want easy use of drag_like_events\r\n//   does not need to be actually dragging (moving) something, could use drag_like_events to power resize handles.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n// Seem like quite a lot of different potential ways to do UI for resize.\r\n//  This would be the place for them.\r\n\r\n// This will take some cues from dragable, which is fairly comprehensive, while also providing a really simple API\r\n//   to use it.\r\n\r\nconst Control = require('../html-core/control');\r\n\r\nconst drag_like_events = require('./drag_like_events');\r\n\r\nconst {tof} = require('lang-tools');\r\n\r\n\r\n// Will also allow resizing with a 'frame' surrounding it.\r\n\r\nconst resizable = (ctrl, options = {resize_mode: 'br_handle'}) => {\r\n\r\n\r\n  const extra_margin = options.extra_margin !== undefined ? options.extra_margin : 2;\r\n  // And specify a minimum size here?\r\n  //  Or size bounds? Could just specify lower size bounds.\r\n\r\n  // Bounds as array? Bounds as a ctrl?\r\n\r\n\r\n  // Size bounds as well as extent bounds.\r\n\r\n\r\n  const {bounds} = options;\r\n  const extent_bounds = options.extent_bounds || options.extent;\r\n\r\n  const t_extent_bounds = tof(extent_bounds);\r\n\r\n  // Default lower bounds of window size will help.\r\n\r\n\r\n  let min_bound, max_bound;\r\n\r\n  if (bounds) {\r\n    [min_bound, max_bound] = bounds;\r\n  }\r\n\r\n\r\n\r\n  // And secondary bounds too...?\r\n  // Such as not resizing so that it would extend (down or right or wherever) outside the bounds of a ctrl.\r\n  //   Probably its container control\r\n\r\n  // That is more like 'extent bounds' rather than size bounds.\r\n\r\n  // Extend bounds being the a control.\r\n\r\n\r\n\r\n\r\n  // if (extent_bounds instanceOf Control)....\r\n\r\n  // ???\r\n\r\n  // tof would be more foolproof for typing.\r\n  \r\n\r\n  // resize_method?\r\n  // method?\r\n\r\n  // resize_mode?\r\n  //   br_handle may be one of the simplest to get working.\r\n  //   may be all we need for Window right now.\r\n\r\n\r\n  // borders-all-directions perhaps?\r\n  //   maybe better with thicker borders, or accept 1, 2 or 3 pixels more, inside the borders?\r\n\r\n  const {resize_mode} = options;\r\n\r\n\r\n  const start_action = ['touchstart', 'mousedown'];\r\n\r\n  let initial_size, initial_measured_pos_within_ctrl_bounds;\r\n\r\n  // will disable css transitions for the duration of the drag_like_action\r\n\r\n\r\n\r\n  if (resize_mode === 'br_handle') {\r\n\r\n    if (ctrl.ctrl_relative) {\r\n\r\n\r\n\r\n\r\n      // Check if it's already installed???\r\n\r\n      if (ctrl.ctrl_br_resize_handle) {\r\n        console.log('ctrl.ctrl_br_resize_handle already detected');\r\n      } else {\r\n        const ctrl_br_resize_handle = new Control({\r\n          context: ctrl.context\r\n        })\r\n        ctrl_br_resize_handle.add_class('bottom-right');\r\n        ctrl_br_resize_handle.add_class('resize-handle');\r\n        ctrl_br_resize_handle.add('\u25E2');\r\n\r\n        // But does it have one already???\r\n        ctrl.ctrl_relative.add(ctrl_br_resize_handle);\r\n        ctrl_br_resize_handle.pre_activate();\r\n        ctrl_br_resize_handle.activate();\r\n\r\n        ctrl.ctrl_br_resize_handle = ctrl_br_resize_handle;\r\n\r\n        drag_like_events(ctrl_br_resize_handle);\r\n        ctrl_br_resize_handle.drag_like_events = true;\r\n\r\n        let css_transition;\r\n\r\n        ctrl_br_resize_handle.on('drag-like-action-start', () => {\r\n\r\n          \r\n\r\n          //console.log('e_drag_like_action_move', e_drag_like_action_move);\r\n          //initial_size = ctrl.size;\r\n          //css_transition = ctrl.dom.attributes.style.transition;\r\n\r\n          // Looks like we need to bug fix this... not getting the transition style properly.\r\n          //   Likely we want finer grain control over transitions.\r\n\r\n\r\n          //console.log('1) css_transition', css_transition);\r\n\r\n          // Would be worth setting the size bounds here...?\r\n\r\n          //   Doubt it would be a significant perf hit to measure and calculate it on move...?\r\n          //     Though that could be an option.\r\n\r\n          //console.log('t_extent_bounds', t_extent_bounds);\r\n          initial_size = ctrl.bcr()[2];\r\n\r\n          // initial_ctrl_bounds_size ???\r\n          // initial_measured_pos_within_ctrl_bounds perhaps....?\r\n\r\n\r\n\r\n\r\n          if (t_extent_bounds === 'control') {\r\n            // Determine what size the window is starting at....\r\n\r\n            const ctrl_bcr = ctrl.bcr();\r\n            const extent_bounds_ctrl_bcr = extent_bounds.bcr();\r\n\r\n            const pos_offset = [ctrl_bcr[0][0] - extent_bounds_ctrl_bcr[0][0], ctrl_bcr[0][1] - extent_bounds_ctrl_bcr[0][1]];\r\n            //console.log('pos_offset', pos_offset);\r\n\r\n            // Then will need to work out how much remaining size is available....?\r\n\r\n            //const ctrl_measured_size = ctrl_bcr[2];\r\n            const extent_bounds_ctrl_measured_size = extent_bounds_ctrl_bcr[2];\r\n\r\n            // work out amount of space remaining within the extent_bounds_ctrl\r\n\r\n            //console.log('ctrl_measured_size', ctrl_measured_size);\r\n            //console.log('extent_bounds_ctrl_measured_size', extent_bounds_ctrl_measured_size);\r\n\r\n            \r\n\r\n            const bounded_max_size = [extent_bounds_ctrl_measured_size[0] - pos_offset[0] - extra_margin, extent_bounds_ctrl_measured_size[1] - pos_offset[1] - extra_margin];\r\n\r\n            //console.log('bounded_max_size', bounded_max_size);\r\n\r\n            max_bound = bounded_max_size;\r\n\r\n\r\n          }\r\n\r\n\r\n\r\n          \r\n          ctrl.add_class('no-transitions');\r\n\r\n          // Strangely does not work.\r\n          //.  Possibly was not connected properly to the dom element.\r\n          //console.log('ctrl_br_resize_handle.dom.el', ctrl_br_resize_handle.dom.el);\r\n\r\n          ctrl_br_resize_handle.add_class('resizing');\r\n          //ctrl.dom.attributes.style.transition = 'none';\r\n\r\n          // Improving the size property would help.\r\n          //   Maybe could have and make use of a Control_Position_And_Size_Info_Helper ?\r\n\r\n\r\n\r\n\r\n          //console.log('initial_size', initial_size);\r\n\r\n\r\n\r\n\r\n        })\r\n\r\n\r\n        ctrl_br_resize_handle.on('drag-like-action-move', e_drag_like_action_move => {\r\n          //console.log('e_drag_like_action_move', e_drag_like_action_move);\r\n\r\n          const {offset} = e_drag_like_action_move;\r\n\r\n          // Then adjust the size....\r\n          const new_size = [initial_size[0] + offset[0], initial_size[1] + offset[1]];\r\n          //console.log('new_size', new_size);\r\n\r\n          if (min_bound) {\r\n            if (new_size[0] < min_bound[0]) new_size[0] = min_bound[0];\r\n            if (new_size[1] < min_bound[1]) new_size[1] = min_bound[1];\r\n          }\r\n          if (max_bound) {\r\n            if (new_size[0] > max_bound[0]) new_size[0] = max_bound[0];\r\n            if (new_size[1] > max_bound[1]) new_size[1] = max_bound[1];\r\n          }\r\n\r\n          //if (t_extent_bounds === 'control') {\r\n            // Check it's not extending past the extent_bounds bcr.\r\n            //   Need to take translation into account too???\r\n\r\n\r\n\r\n\r\n            \r\n          //}\r\n\r\n          ctrl.size = new_size;\r\n\r\n\r\n\r\n        })\r\n\r\n        ctrl_br_resize_handle.on('drag-like-action-end', e_drag_like_action_end => {\r\n          //console.log('e_drag_like_action_move', e_drag_like_action_move);\r\n          //ctrl.dom.attributes.style.transition = css_transition;\r\n          ctrl_br_resize_handle.remove_class('resizing');\r\n          ctrl.remove_class('no-transitions');\r\n\r\n          //console.log('2) css_transition', css_transition);\r\n          /*\r\n\r\n          \r\n\r\n          const {offset} = e_drag_like_action_move;\r\n\r\n          // Then adjust the size....\r\n          const new_size = [initial_size[0] + offset[0], initial_size[1] + offset[1]];\r\n          //console.log('new_size', new_size);\r\n          ctrl.size = new_size;\r\n\r\n          */\r\n\r\n\r\n\r\n\r\n\r\n        })\r\n\r\n        \r\n\r\n      }\r\n\r\n\r\n      // Create a new resize handle control in there.\r\n\r\n      \r\n\r\n\r\n\r\n    } else {\r\n      console.trace();\r\n      throw 'NYI';\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // Respond to touch events.\r\n\r\n    // generally want a 'press' event too.\r\n    //  Could be a click, or a touch press.\r\n\r\n    // Could raise a press or click event.\r\n    //  Press could cover click and touch.\r\n    //  Click could specifically be a mouse event to make least confusion / ambiguity long term.\r\n    // Could have an emulate_clicks option.\r\n    // Setting deletable to true or false...\r\n    \r\n    /*\r\n    console.log('ctrl.delete', ctrl.delete);\r\n\r\n    ctrl.delete = () => {\r\n\r\n        // remove it from the DOM\r\n        ctrl.remove();\r\n\r\n        // raise a delete event\r\n        \r\n        ctrl.raise('delete');\r\n        // Delete corresponding objects too.\r\n\r\n    }\r\n    */\r\n\r\n    // Controls already have resize functionaliy\r\n    //  Possibly move resizing here.\r\n\r\n    // Should do more setting other controls as resize handles.\r\n\r\n    \r\n}\r\n\r\nmodule.exports = resizable;", "// Other notifications within the framework?\r\n\r\n// Kind of seems like both model and view.\r\n//  Can be deleted from view... and when that happens maybe it will get deleted from the model as well.\r\n\r\n\r\n// Data_Object could be upgraded to be like this???\r\n//  The Control is based on Data_Object anyway.\r\n//   Kind of as though it is the model (and view) all in one.\r\n// May be best to iterate to make these data models work...\r\n\r\n// Making a simple API may be the best....\r\n//  a validate function\r\n//  a data_transform_in function\r\n//   being able to accept different types of data.\r\n\r\n// Representing a color or a date in a really simple way.\r\n// ['red', 'ui8']\r\n// ['day_of_month', 'num (1 to 31)']\r\n\r\n\r\n\r\n\r\n\r\nlet deletable = (ctrl) => {\r\n    // Respond to touch events.\r\n\r\n    // generally want a 'press' event too.\r\n    //  Could be a click, or a touch press.\r\n\r\n    // Could raise a press or click event.\r\n    //  Press could cover click and touch.\r\n    //  Click could specifically be a mouse event to make least confusion / ambiguity long term.\r\n\r\n    // Could have an emulate_clicks option.\r\n\r\n    // Setting deletable to true or false...\r\n\r\n    \r\n\r\n    //console.log('ctrl.delete', ctrl.delete);\r\n\r\n    ctrl.delete = () => {\r\n\r\n        // remove it from the DOM\r\n        ctrl.remove();\r\n\r\n        // raise a delete event\r\n        \r\n        ctrl.raise('delete');\r\n        // Delete corresponding objects too.\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = deletable;", "const {\r\n    prop,\r\n    field\r\n} = require('obext');\r\n\r\nconst deletable = require('./deletable');\r\nlet selected_deletable = (ctrl) => {\r\n    //let selection_action = 'mousedown';\r\n    // select on mousedown?\r\n    deletable(ctrl);\r\n\r\n    let old_selected_deletable = ctrl.selected_deletable;\r\n    let click_handler = (e) => {\r\n\r\n    }\r\n\r\n    let press_handler = (event) => {\r\n        const keyName = event.key;\r\n        //console.log('event', event);\r\n        // 46\r\n\r\n        if (keyName === 'Delete') {\r\n            //return;\r\n            ctrl.delete();\r\n            // \r\n        }\r\n    }\r\n\r\n\r\n    // once it's active.\r\n\r\n    //ctrl.once_active...\r\n\r\n\r\n\r\n    ctrl.on('change', e_change => {\r\n        let {\r\n            name,\r\n            value\r\n        } = e_change;\r\n        if (name === 'selected') {\r\n\r\n            // once it's activated.\r\n\r\n            //console.log('selected_deletable selected value', value);\r\n\r\n            ctrl.once_active(() => {\r\n                if (value) {\r\n                    //ctrl.add_class('selected');\r\n                    document.addEventListener('keydown', press_handler, false);\r\n                } else {\r\n                    //ctrl.remove_class('selected');\r\n                    document.removeEventListener('keydown', press_handler, false);\r\n                }\r\n            });\r\n\r\n        };\r\n        return true;\r\n\r\n    });\r\n    //});\r\n\r\n\r\n\r\n    if (true) {\r\n        // but it won't be defined.\r\n        if (old_selected_deletable !== undefined) {\r\n            ctrl.selected_deletable = old_selected_deletable;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = selected_deletable;", "const {\r\n    prop,\r\n    field\r\n} = require('obext');\r\n\r\nlet selected_resizable = (ctrl, ctrl_handle) => {\r\n    //let selection_action = 'mousedown';\r\n    // select on mousedown?\r\n\r\n    let old_selected_resizable = ctrl.old_selected_resizable;\r\n    let click_handler = (e) => {\r\n\r\n    }\r\n\r\n    let press_handler = (event) => {\r\n        const keyName = event.key;\r\n        console.log('event', event);\r\n\r\n        // 46\r\n\r\n        if (keyName === 'Control') {\r\n            // do not alert when only Control key is pressed.\r\n            return;\r\n        }\r\n\r\n        if (event.ctrlKey) {\r\n            // Even though event.key is not 'Control' (e.g., 'a' is pressed),\r\n            // event.ctrlKey may be true if Ctrl key is pressed at the same time.\r\n            //alert(`Combination of ctrlKey + ${keyName}`);\r\n        } else {\r\n            //alert(`Key pressed ${keyName}`);\r\n        }\r\n    }\r\n\r\n    ctrl.on('change', e_change => {\r\n        let {\r\n            name,\r\n            value\r\n        } = e_change;\r\n        if (name === 'selected') {\r\n            //console.log('selected value', value);\r\n\r\n\r\n            ctrl.once_active(() => {\r\n                if (value) {\r\n                    //ctrl.add_class('selected');\r\n                    document.addEventListener('keypress', press_handler, false);\r\n                } else {\r\n                    //ctrl.remove_class('selected');\r\n                    document.removeEventListener('keypress', press_handler, false);\r\n                }\r\n            });\r\n\r\n\r\n        };\r\n        return true;\r\n    });\r\n\r\n    if (true) {\r\n        // but it won't be defined.\r\n        if (old_selectable !== undefined) {\r\n            ctrl.selected_deletable = old_sselected_deletableelectable;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = selected_resizable;", "/*\r\n    Dragging creates a selection box.\r\n*/\r\nconst {\r\n    prop,\r\n    field\r\n} = require('obext');\r\n\r\nconst jsgui = require('../html-core/html-core');\r\n\r\n\r\nconst stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nconst Control = jsgui.Control;\r\n\r\n\r\n//const v_subtract = jsgui.util.v_subtract;\r\n//let ofs = e => [e.offsetX, e.offsetY];\r\n/*\r\nconst coords_to_lt_wh = (coords_pair) => {\r\n    //if ()\r\n    let l,t,r,b,w,h, min = Math.min, max = Math.max;\r\n    l = min(coords_pair[0][0], coords_pair[0][0]);\r\n    r = max(coords_pair[0][0], coords_pair[0][0]);\r\n    t = min(coords_pair[0][1], coords_pair[0][1]);\r\n    b = max(coords_pair[0][0], coords_pair[0][0]);\r\n\r\n    w = r - l;\r\n    h = b - t;\r\n\r\n    return [[l,t],[w,h]];\r\n}\r\n*/\r\nconst coords_to_lt_wh = coords_pair => {\r\n    //if ()\r\n    let l, t, r, b, w, h, min = Math.min,\r\n        max = Math.max;\r\n    //let h_pair = \r\n    l = min(coords_pair[0][0], coords_pair[1][0]);\r\n    r = max(coords_pair[0][0], coords_pair[1][0]);\r\n    t = min(coords_pair[0][1], coords_pair[1][1]);\r\n    b = max(coords_pair[0][1], coords_pair[1][1]);\r\n\r\n    w = r - l;\r\n    h = b - t;\r\n\r\n    return [\r\n        [l, t],\r\n        [w, h]\r\n    ];\r\n}\r\n\r\n// a selectable class / control?\r\nlet selection_box_host = (ctrl) => {\r\n    //console.log('selection_box_host', ctrl._id());\r\n    //console.log('ctrl.select_unique', ctrl.select_unique);\r\n    //console.trace();\r\n    let click_handler = (e) => {\r\n        //console.log('selectable click e', e);\r\n        if (ctrl.selectable && !ctrl.selection_scope) {\r\n            var ctrl_key = e.ctrlKey;\r\n            var meta_key = e.metaKey;\r\n            //if (ctrl.select_unique && (ctrl_key || meta_key)) {\r\n            if ((ctrl_key || meta_key)) {\r\n                ctrl.action_select_toggle();\r\n            } else {\r\n                ctrl.action_select_only();\r\n            }\r\n        }\r\n        //e.stopPropagation();\r\n    }\r\n    field(ctrl, 'selection_box_host');\r\n    ctrl.selection_box_host = true;\r\n    // ctrl drag events\r\n\r\n    // .wrap_activate\r\n    //  finds the old activate function.\r\n\r\n    // wraps it with a new one.\r\n\r\n\r\n\r\n    // Or better to respond to activate.\r\n\r\n\r\n\r\n\r\n    // wrap the activation function?\r\n    let old_activate = ctrl.activate;\r\n    ctrl.activate = function (spec) {\r\n        if (old_activate) {\r\n            old_activate.call(this, spec);\r\n        }\r\n        // and a selection scope?\r\n        // drag anywhere in the document?\r\n        // create box\r\n        // update box\r\n        // remove box\r\n        let selection_box;\r\n        let md_pos, mm_pos, md_offset_within_ctrl, mm_offset_within_ctrl;\r\n        // selection scope\r\n        //  get control positions...\r\n\r\n        let isf;\r\n        // ctrl all subcontrols.\r\n        //let that = this;\r\n        let nsb = this.new_selection_box = (pos) => {\r\n            //console.log('this._id()', this._id());\r\n            //console.log('ctrl', ctrl);\r\n            this.add(selection_box = new Control({\r\n                context: this.context,\r\n                css: {\r\n                    position: 'absolute'\r\n                },\r\n                'class': 'selection-box',\r\n                pos: pos\r\n            }));\r\n            selection_box.activate();\r\n            // need to be able to set coords.\r\n            //  give it the coords, it words out which is the top etc\r\n            // box from coords\r\n            // l,t,w,h box\r\n            // ltwh_from_coords\r\n            // coords_to_lt_wh\r\n            prop(selection_box, 'coords', e_change => {\r\n                //console.log('e_change', e_change);\r\n                let lt_wh = coords_to_lt_wh(e_change[0]);\r\n                //console.log('* lt_wh', lt_wh + '');\r\n                [selection_box.pos, selection_box.size] = lt_wh;\r\n            });\r\n            return selection_box;\r\n        }\r\n        //throw 'stop';\r\n        ctrl.drag_events(md => {\r\n            // md within uncovered control\r\n            // a way to cancel the event too...\r\n            console.log('md', md);\r\n            let main_boxes = ctrl.$('.main-box');\r\n            //console.log('main_boxes', main_boxes);\r\n            //console.log('main_boxes.length', main_boxes.length);\r\n            let do_begin_selection_box = true;\r\n\r\n            if (md.target.tagName.toLowerCase() === 'span') {\r\n                do_begin_selection_box = false;\r\n            }\r\n\r\n            if (do_begin_selection_box) {\r\n                md_pos = md.pos;\r\n                //console.log('***ctrl', ctrl);\r\n                ctrl.find_selection_scope().deselect_all();\r\n\r\n                //console.log('md', md);\r\n                //console.log('md.pos', md.pos);\r\n                //console.log('md.offset', md.offset);\r\n                // offset of ctrl...\r\n                // ctrl pos\r\n                //console.log('ctrl.pos', ctrl.pos);\r\n\r\n                // need the scroll position...\r\n                //console.log('ctrl.el.scrollTop', ctrl.dom.el.scrollTop);\r\n                //console.log('ctrl.el.parentNode.scrollTop', ctrl.dom.el.parentNode.scrollTop);\r\n                //console.log('window.scrollY', window.scrollY);\r\n                //console.log('ctrl.bcr()', ctrl.bcr());\r\n                let ctrl_pos = ctrl.bcr()[0];\r\n\r\n                // bcr plus window scroll\r\n                // mf pos within control\r\n                //console.log('ctrl_pos', ctrl_pos);\r\n                md_offset_within_ctrl = v_subtract(md.pos, ctrl_pos);\r\n                md_offset_within_ctrl[1] -= window.scrollY;\r\n                md_pos[1] -= window.scrollY;\r\n                //var el = ctrl.dom.el;\r\n                //var elpos2 = [el.offsetLeft, el.offsetTop];\r\n\r\n                // Search for the 'main-box' controls\r\n                // dot for the css class\r\n\r\n                isf = new jsgui.Intersection_Finder({\r\n                    controls: main_boxes\r\n                });\r\n\r\n                isf.on('change', e_change => {\r\n                    //console.log('isf e_change', e_change);\r\n                    if (e_change.name === 'intersections') {\r\n                        let [intersecting, newly_intersecting, previously_intersecting] = e_change.value;\r\n                        each(newly_intersecting, ctrl => {\r\n                            let sel = ctrl.closest(cmatch => {\r\n                                //console.log('cmatch', cmatch);\r\n                                return cmatch.selectable === true;\r\n                            });\r\n                            //console.log('sel', sel);\r\n                            if (sel) sel.selected = true;\r\n                        });\r\n                        each(previously_intersecting, ctrl => {\r\n                            let sel = ctrl.closest(match => match.selectable === true);\r\n                            //console.log('sel', sel);\r\n                            if (sel) sel.selected = false;\r\n                        });\r\n                        //each(previously_intersecting, ctrl => ctrl.selected = false);\r\n                    }\r\n                });\r\n                let selection_box = nsb(md.pos);\r\n                //console.log('selection_box', selection_box);\r\n                if (selection_box) {\r\n\r\n                }\r\n                //selection_box.pos()\r\n                // ctrl offset...\r\n            } else {\r\n                return false;\r\n            }\r\n\r\n        }, mm => {\r\n            if (selection_box) {\r\n                mm_pos = mm.pos;\r\n                mm_pos[1] -= window.scrollY;\r\n                let ctrl_pos = ctrl.bcr()[0];\r\n                // subtract the scroll position\r\n                // console.log('window.scrollY', window.scrollY);\r\n                //console.log('ctrl_pos', ctrl_pos);\r\n                //ctrl_pos[1] += window.scrollY;\r\n                //console.log('2) window.scrollY', window.scrollY);\r\n                mm_offset_within_ctrl = v_subtract(mm.pos, ctrl_pos);\r\n\r\n                //console.log('mm_offset_within_ctrl', mm_offset_within_ctrl);\r\n                //mm_offset_within_ctrl[1] -= window.scrollY;\r\n                //;\r\n                //let intersecting = isf.find_intersections(selection_box.coords = [md_offset_within_ctrl, mm_offset_within_ctrl]);\r\n                //console.log('intersecting', intersecting);\r\n                // could set a scroll offset...\r\n                selection_box.coords = [md_offset_within_ctrl, mm_offset_within_ctrl];\r\n                isf.coords = [md_pos, mm_pos];\r\n            }\r\n        }, mu => {\r\n            //console.log('mu', mu);\r\n            selection_box.remove();\r\n            isf = null;\r\n            //console.log('ofs(mu)', ofs(mu));\r\n        });\r\n    }\r\n}\r\n\r\nmodule.exports = selection_box_host;", "const {get_truth_map_from_arr, each} = require('lang-tools');\r\nlet press_events = (ctrl, options = {}) => {\r\n\r\n\r\n    //console.log('running press-events mixin');\r\n\r\n    ctrl.__mx = ctrl.__mx || {};\r\n    ctrl.__mx.press_events = true;\r\n    const press_event_names = ['press-start', 'press-move', 'press-end', 'press-hold', 'press-drag-start'];\r\n    const map_press_event_names = get_truth_map_from_arr(press_event_names);\r\n\r\n\r\n\r\n    const setup_isomorphic = () => {\r\n        const old_silent = ctrl.view.data.model.mixins.silent;\r\n        ctrl.view.data.model.mixins.silent = true;\r\n        ctrl.view.data.model.mixins.push({\r\n            name: 'press-events'\r\n        });\r\n        ctrl.view.data.model.mixins.silent = old_silent;\r\n        //field(ctrl, 'dragable');\r\n    }\r\n    setup_isomorphic();\r\n\r\n    if (ctrl.dom.el) {\r\n\r\n        ctrl.once_active(() => {\r\n\r\n\r\n            //console.log('once-active press-events');\r\n\r\n            //apply_start_handlers(start_action);\r\n            const body = ctrl.context.body();\r\n\r\n            //console.log('body', body);\r\n            const {css} = options;\r\n            let handling_is_setup = false;\r\n            let pos_start;\r\n            let movement_offsets;\r\n            let pos_move;\r\n            let movement_offset;\r\n            let timeout_hold;\r\n            let drag_started = false;\r\n            let el;\r\n            const hold_movement_threshold = 4;\r\n            let move_mag;\r\n            const ms_short = 500;\r\n            const ts = e => {\r\n                if (e.touches.length === 1) {\r\n                    e.pos = [e.pageX = e.touches[0].pageX, e.pageY = e.touches[0].pageY];\r\n                    el = e.el = e.touches[0].target;\r\n                    return ps(e);\r\n                }\r\n            }\r\n            const md = e => {\r\n                let path = e.path || e.composedPath();\r\n                el = e.el = path[0];\r\n                return ps(e);\r\n            }\r\n            const mm = e => {\r\n                e.pos = [e.pageX = e.pageX, e.pageY = e.pageY];\r\n                return pm(e);\r\n            }\r\n            const tm = e => {\r\n                e.pos = [e.pageX = e.touches[0].pageX, e.pageY = e.touches[0].pageY];\r\n                return pm(e);\r\n            }\r\n            const pm = e => {\r\n                pos_move = e.pos;\r\n                e.movement_offset = movement_offset = [e.pos[0] - pos_start[0], e.pos[1] - pos_start[1]];\r\n                movement_offsets.push(movement_offset);\r\n                e.movement_offsets = movement_offsets;\r\n                e.move_mag = move_mag = Math.sqrt(Math.pow(movement_offset[0], 2) + Math.pow(movement_offset[1], 2));\r\n                e.ctrl = ctrl;\r\n                ctrl.raise('press-move', e);\r\n                if (move_mag >= 4 && !drag_started) {\r\n                    ctrl.raise('press-drag-start', e);\r\n                    drag_started = true;\r\n                }\r\n            }\r\n            const pe = e => {\r\n                e.movement_offsets = movement_offsets;\r\n                e.move_mag = move_mag;\r\n                e.ctrl = ctrl;\r\n                e.el = el;\r\n                if (timeout_hold) clearTimeout(timeout_hold);\r\n                body.off({\r\n                    touchend: te,\r\n                    touchmove: tm,\r\n                    mouseup: mu,\r\n                    mousemove: mm\r\n                });\r\n                ctrl.raise('press-end', e);\r\n            }\r\n            const mu = e => {\r\n                body.off({\r\n                    mouseup: mu,\r\n                    mousemove: mm\r\n                });\r\n                e.pos = [e.pageX, e.pageY];\r\n                return pe(e);\r\n            }\r\n            const te = e => {\r\n                body.off({\r\n                    touchend: te,\r\n                    touchmove: tm\r\n                });\r\n                e.pos = pos_move || pos_start;\r\n                return pe(e);\r\n            }\r\n            const ps = e => {\r\n                movement_offsets = [];\r\n                move_mag = 0;\r\n                drag_started = false;\r\n                let is_touch_event = !!e.touches;\r\n                e.is_touch_event = is_touch_event;\r\n                pos_start = [e.pageX, e.pageY];\r\n                if (is_touch_event) {\r\n                    body.on({\r\n                        touchend: te,\r\n                        touchmove: tm\r\n                    });\r\n                } else {\r\n                    body.on({\r\n                        mouseup: mu,\r\n                        mousemove: mm\r\n                    });\r\n                }\r\n                e.ctrl = ctrl;\r\n                ctrl.raise('press-start', e);\r\n                timeout_hold = setTimeout(() => {\r\n                    if (move_mag <= hold_movement_threshold) {\r\n                        ctrl.raise('press-hold', e);\r\n                    }\r\n                }, ms_short);\r\n            }\r\n            const setup = () => {\r\n                //console.log('press-events setup (inner)');\r\n                ctrl.on({\r\n                    'touchstart': ts,\r\n                    'mousedown': md\r\n                });\r\n                handling_is_setup = true;\r\n            }\r\n            const unsetup = () => {\r\n                //console.log('press-events unsetup');\r\n                //console.log('--------------------');\r\n                ctrl.off({\r\n                    'touchstart': ts,\r\n                    'mousedown': md\r\n                });\r\n                handling_is_setup = false;\r\n            }\r\n            const outer_setup = () => {\r\n                //console.log('press-events outer_setup');\r\n\r\n                // Seems a bit strange - having to listen here for the adding of an event listener.\r\n                //   What if the event listener is added before this mixin is added?\r\n\r\n                ctrl.event_events = true;\r\n\r\n                const relying_on_recognising_adding_of_event_listeners = () => {\r\n                    ctrl.on('add-event-listener', e => {\r\n                        const {name} = e;\r\n                        if (map_press_event_names[name]) {\r\n                            if (!handling_is_setup) {\r\n                                setup();\r\n                            }\r\n                        }\r\n                    });\r\n                    ctrl.on('remove-event-listener', e => {\r\n                        const {name} = e;\r\n                        if (map_press_event_names[name]) {\r\n                            console.log('ctrl remove-event-listener', name);\r\n                            const bnec = ctrl.bound_named_event_counts;\r\n                            console.log('bound_named_event_counts bnec', bnec);\r\n                            console.log('name', name);\r\n                            let count_bound_press_events = 0;\r\n                            each(bnec, (count, event_name) => {\r\n                                if (map_press_event_names[event_name]) count_bound_press_events += count;\r\n                            })\r\n                            if (count_bound_press_events === 0) {\r\n                                unsetup();\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n\r\n                const just_do_it = () => {\r\n                    if (!handling_is_setup) {\r\n                        setup();\r\n                    }\r\n                }\r\n                just_do_it();\r\n\r\n\r\n                \r\n\r\n\r\n            }\r\n            outer_setup();\r\n        });\r\n\r\n\r\n        \r\n    }\r\n\r\n    // emit 'press-outside' when press ends outside the control\r\n    if (typeof window !== 'undefined' && ctrl.dom && ctrl.dom.el) {\r\n        ctrl.on('press-start', e_ps => {\r\n            const outsideHandler = e_pe => {\r\n                if (!ctrl.dom.el.contains(e_pe.target)) {\r\n                    ctrl.raise('press-outside', e_pe);\r\n                }\r\n                window.removeEventListener('mouseup', outsideHandler);\r\n                window.removeEventListener('touchend', outsideHandler);\r\n            };\r\n            window.addEventListener('mouseup', outsideHandler);\r\n            window.addEventListener('touchend', outsideHandler);\r\n        });\r\n    }\r\n    \r\n}\r\nmodule.exports = press_events;", "/*\r\n    For detecting press events outside of a control.\r\n    Listens to the body, detects if the control is or is an ancestor of what was pressed.\r\n\r\n    Adds press-outside capability.\r\n    Probably only worth checking for it if there are any event listeners for it.\r\n\r\n\r\n    So, can we listen for listeners being added anywhere?\r\n      Could be a new feature of Evented_Class?\r\n    //  self events to do with add_event_listener? listener-added?\r\n    //   would add more flexibility for higher levels to provide higher performance / more fine-grained control.\r\n\r\n*/\r\nconst press_events = require('./press-events');\r\n\r\nconst press_outside = (ctrl, options = {}) => {\r\n    let once = options.one || options.once || false;\r\n    console.log('press_outside');\r\n\r\n    ctrl.__mx = ctrl.__mx || {};\r\n\r\n    if (!ctrl.__mx || !ctrl.__mx.press_events) {\r\n        press_events(ctrl);\r\n    }\r\n    ctrl.__mx.press_outside = true;\r\n\r\n    const body = ctrl.context.body();\r\n    if (!body.__mx || !body.__mx.press_events) {\r\n        press_events(body);\r\n    }\r\n    ctrl.event_events = true;\r\n\r\n    const body_press = e => {\r\n        console.log('press_outside body press e', e);\r\n        //const {ctrl} = e;\r\n        //const press_ctrl = e.ctrl;\r\n\r\n        const {ctrl_target} = e;\r\n        /*\r\n            // is the 'search' amongst the ancestors?\r\n\t        'ancestor'(search) {\r\n        */\r\n        //const is_ancestor = ctrl.ancestor(ctrl_target);\r\n        //const match = ctrl_target === ctrl || is_ancestor;\r\n            \r\n        // No, need to check if the ctrl is an ancestor of the target.\r\n        //console.log('');\r\n        //console.log('ctrl_target', ctrl_target);\r\n        //console.log('ctrl', ctrl);\r\n        const match = ctrl_target === ctrl || ctrl_target.ancestor(ctrl);\r\n        //console.log('match', match);\r\n\r\n        if (!match) {\r\n            // was pressed outside.\r\n            ctrl.raise('press-outside', e);\r\n        }\r\n\r\n        // is the target an ancestor of the ctrl in question?\r\n\r\n        // target_ctrl???\r\n        //  The event should have the corresponding control to the target element.\r\n\r\n        // could look up that target control?\r\n        //  .target_ctrl or .ctrl_target would make a lot of sense.\r\n\r\n        // the target_ctrl would be a useful thing to have incorporated into the event - whether press ovent, click event, or other.\r\n\r\n        // ctrl_target being more standard (Hungarian prefix style).\r\n    }\r\n\r\n    const setup_body_press = () => {\r\n        //console.log('press_outside setup_body_press');\r\n        body.on('press-end', body_press);\r\n    }\r\n    const remove_body_press = () => {\r\n        //console.log('remove_body_press');\r\n        //console.trace();\r\n        body.off('press-end', body_press);\r\n        // Then that should switch off a bunch of things.\r\n    }\r\n\r\n    // or 'on' event???\r\n    //console.log('pre on add-event-listener');\r\n    ctrl.on('add-event-listener', e => {\r\n        //console.log('press_outside ctrl add-event-listener', e);\r\n        // if it's the press-outside event...\r\n        const {name} = e;\r\n        if (name === 'press-outside') {\r\n            //console.log('added press-outside event');\r\n            // Need to now listen for it in the document body.\r\n            //body_press();\r\n            setup_body_press();\r\n        }\r\n    });\r\n\r\n    // remove events listener not working???\r\n    //  not for dom events?\r\n    ctrl.on('remove-event-listener', e => {\r\n        //console.log('press_outside ctrl remove-event-listener', e);\r\n        //console.trace();\r\n\r\n        const {name} = e;\r\n        if (name === 'press-outside') {\r\n            remove_body_press();\r\n        }\r\n        // remove the body press event listener.\r\n    });\r\n\r\n}\r\n\r\nmodule.exports = press_outside;", "/*\r\n    For detecting press events outside of a control.\r\n    Listens to the body, detects if the control is or is an ancestor of what was pressed.\r\n\r\n    Adds press-outside capability.\r\n    Probably only worth checking for it if there are any event listeners for it.\r\n\r\n\r\n    So, can we listen for listeners being added anywhere?\r\n      Could be a new feature of Evented_Class?\r\n    //  self events to do with add_event_listener? listener-added?\r\n    //   would add more flexibility for higher levels to provide higher performance / more fine-grained control.\r\n\r\n*/\r\n\r\nconst {\r\n    field,\r\n    prop\r\n} = require('obext');\r\n\r\nconst press_events = require('./press-events');\r\n\r\n// a state / states mixin???\r\n\r\nconst pressed_state = (ctrl, options = {}) => {\r\n    //let once = options.one || options.once || false;\r\n    //console.log('press_outside');\r\n    //console.log('running pressed-state mixin');\r\n\r\n    ctrl.__mx = ctrl.__mx || {};\r\n\r\n    if (!ctrl.__mx || !ctrl.__mx.press_events) {\r\n        press_events(ctrl);\r\n    }\r\n    ctrl.__mx.pressed_state = true;\r\n\r\n    const setup_isomorphic = () => {\r\n        const old_silent = ctrl.view.data.model.mixins.silent;\r\n        ctrl.view.data.model.mixins.silent = true;\r\n        ctrl.view.data.model.mixins.push({\r\n            name: 'pressed-state'\r\n        });\r\n        ctrl.view.data.model.mixins.silent = old_silent;\r\n        //field(ctrl, 'dragable');\r\n    }\r\n    setup_isomorphic();\r\n\r\n    // begin and end presses.\r\n    //   have a 'pressed' state in the control as well.\r\n    //     Want to get the specifics working well on a low level.\r\n    //       Then make them easier to use on a high level.\r\n\r\n    // define 'state' field for pressed-state\r\n    field(ctrl.view.data.model, 'state');\r\n\r\n    // handle press-start and press-end events\r\n    ctrl.on('press-start', () => { ctrl.view.data.model.state = 'pressed'; });\r\n    ctrl.on('press-end',   () => { ctrl.view.data.model.state = 'not-pressed'; });\r\n\r\n    // toggle 'pressed' CSS class based on view state changes\r\n    ctrl.view.data.model.on('change', e => {\r\n        const { name, value } = e;\r\n        if (name === 'state') {\r\n            if (value === 'pressed') ctrl.add_class('pressed');\r\n            else                        ctrl.remove_class('pressed');\r\n        }\r\n    });\r\n\r\n\r\n    //const body = ctrl.context.body();\r\n    //if (!body.__mx || !body.__mx.press_events) {\r\n    //    press_events(body);\r\n    //}\r\n    //ctrl.event_events = true;\r\n\r\n    \r\n\r\n}\r\n\r\nmodule.exports = pressed_state;", "// More directory features here?\r\n//  Be able to mix in multiple at once?\r\n\r\n\r\n\r\nconst mx = {\r\n    coverable: require('./coverable'),\r\n    date: require('./typed_data/date'),\r\n    display: require('./display'),\r\n    display_modes: require('./display-modes'),\r\n    fast_touch_click: require('./fast-touch-click'),\r\n    model_data_view_compositional_representation: require('./model_data_view_compositional_representation'),\r\n    popup: require('./popup'),\r\n    resizable: require('./resizable'),\r\n    selectable: require('./selectable'),\r\n    selected_deletable: require('./selected-deletable'),\r\n    selected_resizable: require('./selected-resizable'),\r\n    selection_box_host: require('./selection-box-host'),\r\n    dragable: require('./dragable'),\r\n    drag_like_events: require('./drag_like_events'),\r\n    press_events: require('./press-events'),\r\n    press_outside: require('./press-outside'),\r\n    pressed_state: require('./pressed-state')\r\n}\r\n\r\nmodule.exports = mx;", "const jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof,\r\n    is_defined = jsgui.is_defined;\r\n\r\nconst {is_array, is_arr_of_strs} = jsgui;\r\n\r\nvar Control = jsgui.Control;\r\nconst {\r\n    field,\r\n    prop\r\n} = require('obext');\r\n\r\n// Seems worth using mixins, improving them to cover a variety of features that will be used in many controls.\r\n\r\n// Menu items being selectable individually.\r\n//   So when one gets selected, the control has its state changed to closed.\r\n\r\n// Also, consider state transitions in the state system.\r\n//   Could take a 1/2s or something to change between open and closed.\r\n\r\n// Pressed view state mixin?\r\n//   view ui data model or something like that.\r\n\r\n\r\n\r\n\r\n\r\nconst {press_events, pressed_state, selectable} = require('../../../../../control_mixins/mx');\r\n\r\n\r\nclass Dropdown_Menu extends Control {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'dropdown_menu';\r\n        super(spec);\r\n        this.add_class('dropdown-menu');\r\n\r\n        field(this.view.data.model, 'state');\r\n        field(this.view.data.model, 'options');\r\n\r\n        this.view.data.model.on('change', e_change => {\r\n            //console.log('this.view.data.model.on change e_change', e_change);\r\n            const {name, value} = e_change;\r\n\r\n            if (name === 'state') {\r\n                if (value === 'open') {\r\n                    this.remove_class('closed');\r\n                    this.add_class('open');\r\n                } else if (value === 'closed') {\r\n                    this.remove_class('open');\r\n                    this.add_class('closed');\r\n                }\r\n            } else {\r\n                //console.log('this.view.data.model.on change e_change', e_change);\r\n            }\r\n\r\n            // and on changing the options...\r\n            //   do some specific composition I suppose?\r\n\r\n        });\r\n\r\n        this.view.data.model.state = 'closed';\r\n\r\n        if (spec.options) {\r\n            this.view.data.model.options = spec.options;\r\n        }\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            //this.compose_color_palette_grid();\r\n            this.compose_dropdown_menu();\r\n        }\r\n\r\n        /*\r\n        this.on('resize', (e_resize) => {\r\n            if (this.grid) {\r\n                var _2_padding = 12;\r\n                var new_grid_size = v_subtract(e_resize.value, [_2_padding, _2_padding]);\r\n                this.grid.size = new_grid_size;\r\n            }\r\n        });\r\n        */\r\n\r\n        // View states of inner composed controls?\r\n\r\n    }\r\n    \r\n    compose_dropdown_menu() {\r\n\r\n        const {context} = this;\r\n\r\n        // Popup can be modal or not.\r\n\r\n        // Have the initial / closed state item.\r\n        //   Show the current value, have the dropdown icon.\r\n\r\n        // Selected item, null item / no item selected.\r\n\r\n        const ctrl_closed_top = new Control({ context });\r\n        ctrl_closed_top.add_class('closed-top');\r\n\r\n\r\n        const ctrl_closed_top_item_itself = new Control({ context });\r\n        ctrl_closed_top_item_itself.add_class('item-itself');\r\n        ctrl_closed_top.add(ctrl_closed_top_item_itself);\r\n\r\n\r\n        // Can we make the system transfer state changes to do with 'pressed'?\r\n        const ctrl_dropdown_icon = new Control({ context });\r\n        ctrl_dropdown_icon.add_class('dropdown-icon');\r\n        ctrl_dropdown_icon.add('\u25BC');\r\n        ctrl_closed_top.add(ctrl_dropdown_icon);\r\n\r\n        this.add(ctrl_closed_top);\r\n\r\n        const ctrl_open_items = new Control({ context });\r\n        ctrl_open_items.add_class('open-items');\r\n        this.add(ctrl_open_items);\r\n\r\n        \r\n        const dm_options = this.view.data.model.options;\r\n        //console.log('Select_Options compose dm_options:', dm_options);\r\n        if (is_array(dm_options)) {\r\n            if (is_arr_of_strs(dm_options)) {\r\n                //console.log('dm_options is an array of strings');\r\n                each(dm_options, str_option => {\r\n                    const ctrl_option = new Control({\r\n                        context\r\n                    });\r\n                    ctrl_option.add_class('item');\r\n                    //ctrl_option.dom.attributes.value = str_option;\r\n                    ctrl_option.add(str_option);\r\n                    ctrl_open_items.add(ctrl_option);\r\n\r\n                    // Can we make these selectable here?\r\n                    //   So it would need to persist to the client, be automatically set up on the client.\r\n\r\n                    // Auto setting up mixins on client-side activation.\r\n\r\n                    //   Could see about further server to client persistnce of properties / features.\r\n                    //     Auto client-side mixin activation would help a lot when expressing various features in the\r\n                    //     composition (server and client-side) code.\r\n\r\n                    // Setting up selection scopes?\r\n                    //   Mixin initialisation being sent as data-jsgui properties of some sort?#\r\n                    //     data-jsgui-mixins property...\r\n                    //       would be able to bring accross JSON properties for client-side use.\r\n                    //         also would need to work properly with references to the various controls.\r\n\r\n\r\n                    // Selectable children - where they are all within the selection scope of this control.\r\n\r\n                    \r\n\r\n                    \r\n\r\n\r\n                })\r\n            }\r\n        }\r\n\r\n\r\n\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n\t\tthis._ctrl_fields.ctrl_dropdown_icon = ctrl_dropdown_icon;\r\n\r\n\r\n    }\r\n\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {ctrl_dropdown_icon} = this;\r\n            //console.log('activating Dropdown_Menu this.ctrl_dropdown_icon', this.ctrl_dropdown_icon);\r\n\r\n            // Want to listen for clicks on the dropdown icon.\r\n            //  Will change the state of the dropdown menu.\r\n\r\n            pressed_state(ctrl_dropdown_icon);\r\n\r\n            // Though could have that control bound to the open/closed view state.\r\n            \r\n            ctrl_dropdown_icon.on('click', e_click => {\r\n                //console.log('ctrl_dropdown_icon e_click', e_click);\r\n                //console.log('this.view.data.model.state', this.view.data.model.state);\r\n\r\n                if (this.view.data.model.state === 'closed') {\r\n                    this.view.data.model.state = 'open';\r\n                } else {\r\n                    this.view.data.model.state = 'closed';\r\n                }\r\n\r\n            });\r\n\r\n            // Want hover and press states for that button too.\r\n            //   May want to implement / use mixins.\r\n\r\n\r\n            \r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nDropdown_Menu.css = `\r\n.dropdown-menu {\r\n    height: 64px;\r\n    width: 384px;\r\n    background-color: #FFFFFF;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n    padding: 2px;\r\n}\r\n\r\n.dropdown-menu .closed-top {\r\n    height: 56px;\r\n    width: 376px;\r\n    background-color: #EEEEEE;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n    padding: 2px;\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n.dropdown-menu .closed-top .item-itself {\r\n    height: 53px;\r\n    width: 320px;\r\n    background-color: #FFFFFF;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n}\r\n\r\n.dropdown-menu .closed-top .dropdown-icon {\r\n    height: 53px;\r\n    width: 53px;\r\n    background-color: #FFFFFF;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n    margin-left: 2px;\r\n    font-size: 53px;\r\n    line-height: 53px;\r\n    color: #888888;\r\n}\r\n\r\n.dropdown-menu .closed-top .dropdown-icon.pressed {\r\n    background-color: #F0F0F0;\r\n}\r\n\r\n.dropdown-menu .open-items {\r\n    width: 376px;\r\n    height: 414px;\r\n    background-color: #EEEEEE;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n    padding: 2px;\r\n}\r\n\r\n.dropdown-menu.closed .open-items {\r\n    display: none;\r\n}\r\n\r\n.dropdown-menu .open-items .item {\r\n    width: 373px;\r\n    height: 64px;\r\n    background-color: #FFFFFF;\r\n    border-radius: 4px;\r\n    border: 2px solid #CCCCCC;\r\n    text-indent: 12px;\r\n    font-size: 52px;\r\n    line-height: 56px;\r\n}\r\n\r\n.dropdown-menu .open-items .item:not(:first-child) {\r\n    margin-top: 2px;\r\n}\r\n\r\n\r\n\r\n`\r\n\r\nif (require.main === module) {\r\n    //console.log('pal_crayola.length', pal_crayola.length);\r\n\r\n\r\n    // Could make a new doc / context etc without the server.\r\n\r\n    const ddm = new Dropdown_Menu();\r\n    console.log(ddm.all_html_render());\r\n\r\n} else {\r\n}\r\nmodule.exports = Dropdown_Menu;", "const jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nconst {Control, Control_Data, Control_View, Data_Object, Data_Model, Data_Value} = jsgui;\r\nconst {prop, field} = require('obext');\r\n\r\n// Late 2023 - not so much code.\r\n//   Do want to make use of view.data.model syntax.\r\n//     Separate to for example view.data.ui.options.model\r\n//   Be really explicit with what it's about, but allow for shortened syntax when it's clear(er) what it's doing.\r\n\r\n// May see about making this a Data_Model_View_Model_Control (later), but this is quite concise right now without the comments and\r\n//   empty lines.\r\n\r\n// Will also make a new version of Text_Input.\r\n//   Want some kind of specification of what data it models / represents.\r\n//   Maybe just say String somewhere.\r\n// ctrl.data.type = String perhaps.\r\n//  data_type: String possibly.\r\n\r\n\r\n// Then some means to sync this data with the value in the DOM.\r\n\r\n// view.ll.model???\r\n\r\n\r\n//   Maybe just make it the view model for the moment???\r\n//   Does seem worth being able to have (at least) 2 levels of view.data.model\r\n\r\n\r\n\r\n\r\n// And Text_Item too...\r\n//   Seems a bit like Text_Input but possibly more flexible.\r\n\r\n\r\n\r\n\r\n// Need to do more basic work on Data_Value of data_type String\r\n//   and then could make some easy system / API for specifying maxLength. It could be implemented using a more complex\r\n//   constraint though.\r\n\r\n\r\n// data_value.constraint(s)\r\n\r\n// data_value.constraints.add(new Constraint())\r\n// data_value constraints being separate to the data type.\r\n\r\n\r\n// Definitely has a View_Model.\r\n// Possibly has a separate Data_Model.\r\n\r\n// The syncing code is not actually all that complex on this level.\r\n//   May make some functions to get it working with much less code, but later on once patterns are clear.\r\n\r\n\r\nclass Text_Input extends Control {\r\n    constructor(spec) {\r\n\r\n\r\n        spec.__type_name = spec.__type_name || 'text_input';\r\n        spec.class = 'text-input';\r\n\r\n\r\n        super(spec);\r\n        const {context} = this;\r\n\r\n        if (spec.placeholder) this.placeholder = spec.placeholder;\r\n        if (!spec.el) {\r\n            //this.compose_text_input();\r\n        }\r\n\r\n\r\n        // Likely to need improved client-side data coherence.\r\n        //   Worth approaching it step-by-step.\r\n\r\n\r\n\r\n        // But actually want to set up syncing between the view model and the dom element value.\r\n\r\n        //console.log('this.view.data', this.view.data);\r\n\r\n\r\n        //console.log('this.view.data.model', this.view.data.model);\r\n\r\n\r\n        // not so sure about .ui.ll.data.model.\r\n\r\n        // a ui ll dm could make sense.\r\n        //console.log('this.view.ll.data.model', this.view.ll.data.model);\r\n\r\n        //console.log('this.view.ll.data.model', this.view.ll.data.model);\r\n\r\n        // 3 models, multi-sync.... - Maybe that could be added in somehow.\r\n        //   Maybe need 3 models only in some cases.\r\n        //   Maybe need 0 in some cases?\r\n        //   For the moment, see what can be done with the 2 models system, making it standard in some ways, better supported.\r\n\r\n        // Maybe the view model of the parent control gets synced with the data model of the subcontrol.\r\n        //   \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        const view_data_model_change_handler = e => {\r\n            const {name, value, old} = e;\r\n\r\n            //console.log('Text_Input view data model change e:', e);\r\n\r\n            //console.log('Text_Input view_data_model_change_handler [old, value]', [old, value]);\r\n\r\n            if (name === 'value') {\r\n                //console.log('Text_Input pre set dom attributes value to:', value);\r\n                //console.log('tof(value)', tof(value));\r\n\r\n\r\n                //this.dom.attributes.value = value;\r\n\r\n                //console.log('!!this.dom.el', this.dom.el);\r\n\r\n                if (this.dom.el) {\r\n                    //this.dom.el.setAttribute('value', value + '');\r\n                    this.dom.el.value = value + '';\r\n                }\r\n\r\n\r\n                //this.view.ll.data.model.value = value;\r\n\r\n                this.data.model.value = value;\r\n\r\n                // and update the view.ui.ll.data.model....\r\n\r\n            }\r\n\r\n        };\r\n\r\n        //console.log('this.view.data', this.view.data);\r\n        this.view.data.model.on('change', view_data_model_change_handler);\r\n\r\n        this.view.data.on('change', e => {\r\n            const {name, value, old} = e;\r\n            if (name === 'model') {\r\n                if (old instanceof Data_Model) {\r\n                    old.off('change', view_data_model_change_handler);\r\n                }\r\n                value.on('change', view_data_model_change_handler);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        /*\r\n\r\n        const view_ui_ll_data_model_change_handler = e => {\r\n            const {name, value, old} = e;\r\n\r\n            //console.log('Text_Input view data model change e:', e);\r\n\r\n            //console.log('Text_Input view_data_model_change_handler [old, value]', [old, value]);\r\n\r\n            if (name === 'value') {\r\n                //this.dom.attributes.value = value;\r\n                this.dom.attributes.value = value;\r\n                this.view.data.model.value = value;\r\n                \r\n\r\n                // and update the view.ui.ll.data.model....\r\n\r\n\r\n\r\n            }\r\n        }\r\n\r\n        this.view.ui.ll.data.model.on('change', view_ui_ll_data_model_change_handler);\r\n        this.view.ui.ll.data.on('change', e => {\r\n            const {name, value, old} = e;\r\n            if (name === 'model') {\r\n                if (old instanceof Data_Model) {\r\n                    old.off('change', view_ui_ll_data_model_change_handler);\r\n                }\r\n                value.on('change', view_ui_ll_data_model_change_handler);\r\n            }\r\n        });\r\n        */\r\n\r\n        /*\r\n        const view_ll_data_model_change_handler = e => {\r\n            const {name, value, old} = e;\r\n\r\n            //console.log('Text_Input view data model change e:', e);\r\n\r\n            //console.log('Text_Input view_data_model_change_handler [old, value]', [old, value]);\r\n\r\n            if (name === 'value') {\r\n                //this.dom.attributes.value = value;\r\n\r\n                // can it accept that new value???\r\n\r\n                //console.log('view_ll_data_model_change_handler [old, value]', [old, value]);\r\n\r\n                const change_attempt = this.view.data.model.attempt_set_value(value);\r\n                \r\n\r\n                console.log('change_attempt', change_attempt);\r\n\r\n                if (change_attempt.success === true) {\r\n                    //this.view.data.model.value = value;\r\n                    this.dom.attributes.value = value;\r\n\r\n\r\n\r\n                } else {\r\n\r\n\r\n                    //this.view.ll.data.model.value = old;\r\n                    //  not sure this has been set to a value of the right type (str or int).\r\n\r\n                    //this.dom.attributes.value = old;\r\n\r\n                    // or directly set the dom el???\r\n                    //this.dom.el.value = old;\r\n\r\n\r\n\r\n\r\n\r\n                    // Set it back to the old value....\r\n\r\n\r\n\r\n                    // undo it....\r\n\r\n                    //console.trace();\r\n                    console.log('need to change back to the old value');\r\n                    console.log('[name, value, old]', [name, value, old]);\r\n                    throw 'NYI';\r\n                }\r\n\r\n\r\n                \r\n\r\n                \r\n                \r\n\r\n                // and update the view.ui.ll.data.model....\r\n\r\n\r\n\r\n            }\r\n        }\r\n\r\n        this.view.ll.data.model.on('change', view_ll_data_model_change_handler);\r\n        this.view.ll.data.on('change', e => {\r\n            const {name, value, old} = e;\r\n            console.log('this.view.ll.data change e:', e);\r\n            if (name === 'model') {\r\n                if (old instanceof Data_Model) {\r\n                    old.off('change', view_ll_data_model_change_handler);\r\n                }\r\n                value.on('change', view_ll_data_model_change_handler);\r\n            }\r\n        });\r\n        */\r\n\r\n\r\n\r\n        const data_model_change_handler = e => {\r\n            const {name, value, old} = e;\r\n            //console.log('Text_Input data_model_change_handler e:', e);\r\n            if (name === 'value') {\r\n                //this.dom.attributes.value = value;\r\n                this.view.data.model.value = value;\r\n            }\r\n\r\n        };\r\n\r\n        this.data.model.on('change', data_model_change_handler);\r\n\r\n        // Maybe have this already automatically from the mixin.\r\n\r\n        const setup_handle_data_model_itself_changing = () => {\r\n            this.data.on('change', e => {\r\n                const {name, value, old} = e;\r\n                //console.log('Text_Input .data change e:', e);\r\n                if (name === 'model') {\r\n\r\n\r\n\r\n                    if (old instanceof Data_Model) {\r\n                        old.off('change', data_model_change_handler);\r\n                    }\r\n\r\n                    if (value instanceof Data_Model) {\r\n                        value.on('change', data_model_change_handler);\r\n                    }\r\n\r\n                    \r\n                }\r\n            })\r\n        }\r\n        setup_handle_data_model_itself_changing();\r\n\r\n        //console.log('Text_Input constructor this.data.model.value', this.data.model.value);\r\n\r\n        if (this.data.model.value !== undefined) {\r\n            this.view.data.model.value = this.data.model.value;\r\n        }\r\n\r\n        if (spec.value) {\r\n            // Sets the .data.model.value, which in turn sets the .view.data.model.value, which in turn sets the dom.attributes,\r\n            //   which then sets it in the live element if active on the client, or in the rendering.\r\n\r\n            // .value will be a shortcut.\r\n\r\n\r\n\r\n            //this.value = spec.value;\r\n\r\n            this.data.model.value = spec.value; // more explicit here.\r\n\r\n\r\n\r\n            // Will need to also work with the view ui ll data model.\r\n            //   Maybe only have an optional view data model or stack of them.\r\n\r\n\r\n        }\r\n\r\n        this.dom.tagName = 'input';\r\n        this.dom.attributes.type = 'text';\r\n        //this.dom.attributes.value = this.value;\r\n\r\n        //console.log('Text_Input end of constructor this.view.ui.ll.data.model:', this.view.ui.ll.data.model);\r\n        //console.log('Text_Input end of constructor this.view.data.model:', this.view.data.model);\r\n        //console.log('this.view.ll.data.model.value', this.view.ll.data.model.value);\r\n\r\n    }\r\n\r\n\r\n    get value() {\r\n\r\n        return this.data.model.value;\r\n    }\r\n    set value(v) {\r\n\r\n\r\n        this.data.model.value = v;\r\n    }\r\n\r\n    /*\r\n    compose_text_input() {\r\n\r\n        // More like the DOM settings rather than composition.\r\n\r\n        \r\n\r\n        // And it's placeholder text\r\n        //   That's not part of the data model.\r\n        //   Maybe it's the presentation data model? Presentation model?\r\n\r\n\r\n\r\n        // ui.data.model perhaps....\r\n        // ui.model perhaps???\r\n        //   want some kind of consistency to calling things data models.\r\n\r\n\r\n        //   And would define types there.\r\n        \r\n\r\n\r\n        // ui is the presentation basically.\r\n\r\n\r\n\r\n\r\n\r\n        if (this.placeholder) this.dom.attributes.placeholder = this.placeholder;\r\n\r\n\r\n    }\r\n    */\r\n\r\n    // A ll getter for the string value???\r\n\r\n    // ll_value???\r\n    // ll_value_type???\r\n\r\n\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {dom} = this;\r\n\r\n\r\n\r\n\r\n            // Maybe set the view.ui.ll.data.model.value instead....\r\n\r\n\r\n\r\n            // sync_dom_changes_to_view_data_model....???\r\n\r\n            // Later will have some lower level code to set these things up better.\r\n\r\n            //console.log('dom.el.value', dom.el.value);\r\n\r\n            //console.log('this.view.data.model', this.view.data.model);\r\n            //console.log('this.view.data.model.value', this.view.data.model.value);\r\n\r\n            this.view.data.model.value = dom.el.value;\r\n\r\n            //console.log('this.view.data.model.value', this.view.data.model.value);\r\n\r\n\r\n            const activate_sync_dom_to_view_ui_ll_data_model = () => {\r\n                const dm = this.view.ui.ll.data.model;\r\n\r\n                this.add_dom_event_listener('change', e => {\r\n                    dm.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keypress', e_keypress => {\r\n                    dm.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keyup', e_keyup => {\r\n                    dm.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keydown', e_keydown => {\r\n                    dm.value = dom.el.value;\r\n                });\r\n            }\r\n            //activate_sync_dom_to_view_ui_ll_data_model();\r\n\r\n            const handle_change_event = e => {\r\n\r\n                //console.log('Text_Input DOM handle_change_event');\r\n\r\n                //console.log('dom.el.value', dom.el.value);\r\n                this.view.data.model.value = dom.el.value;\r\n            }\r\n\r\n            const activate_sync_dom_to_view_ll_data_model = () => {\r\n                //console.log('activate_sync_dom_to_view_ll_data_model');\r\n                //const dm = this.view.ll.data.model;\r\n\r\n                this.add_dom_event_listener('change', e => {\r\n                    handle_change_event(e);\r\n                });\r\n                this.add_dom_event_listener('keypress', e => {\r\n                    handle_change_event(e);\r\n                });\r\n                this.add_dom_event_listener('keyup', e => {\r\n                    handle_change_event(e);\r\n                });\r\n                this.add_dom_event_listener('keydown', e => {\r\n                    handle_change_event(e);\r\n                });\r\n            }\r\n            activate_sync_dom_to_view_ll_data_model();\r\n        }\r\n    }\r\n}\r\nmodule.exports = Text_Input;\r\n", "\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// The basic controls should not do too much on top of normal HTML, but make it easier to do a few things\r\n//  there.\r\n\r\nconst textNode = require('../../../../../html-core/text-node');\r\n// more work on fields? or use obext fields for now?\r\nvar fields = [\r\n    ['value', String, '']\r\n\r\n];\r\n\r\n// Maybe not much need for this?\r\n\r\n// A div containing a text node.\r\n//   Possibly enable better control over inner text / html of both spans and divs.\r\n\r\n// Being able to use .view.data.model.value to hold the text, as well as .data.model.value.\r\n//   and then also just .value shortcutting to .data.model.value.\r\n\r\n\r\n\r\n\r\n\r\nclass Text_Item extends Control {\r\n    // is an Input element.\r\n    //  type of either text or password.\r\n    // could possibly specify some of the starting field values in this part.\r\n\r\n    constructor(spec) {\r\n        //this._super(spec, fields);\r\n        super(spec, fields);\r\n        this.__type_name = 'text_item';\r\n        this.add_class('item');\r\n\r\n        // composition function instead...\r\n\r\n        this.add(new textNode({\r\n            text: this.value,\r\n            context: this.context\r\n        }))\r\n    }\r\n}\r\nmodule.exports = Text_Item;\r\n", "const jsgui = require('../../../../../html-core/html-core');\r\nconst {\r\n    Control,\r\n    parse_mount,\r\n    parse,\r\n    field\r\n} = jsgui;\r\n\r\n// Nice to make this flexible - make use of resources, svg, jsgui3-gfx....\r\n//   Would be better to have this make use of other (lower level) functionality and to provide a nice API here.\r\n\r\n// Would be nice to have low and medium level image features available to various controls, will be easy to put icons where they need to be\r\n//   though this Icon control should make it easier in some ways.\r\n\r\n\r\nclass Indicator extends Control {\r\n\r\n\r\n\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'indicator';\r\n        //let size = spec.size = spec.size || [64, 64];\r\n        super(spec);\r\n        const {\r\n            context\r\n        } = this;\r\n        this.add_class('indicator');\r\n        \r\n        if (!spec.el) {\r\n            //compose();\r\n        }\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            \r\n        }\r\n    }\r\n}\r\nmodule.exports = Indicator;", "\r\n\r\nconst Indicator = require('./Indicator');\r\n\r\n// Could link to a property or even a .status property by default.\r\n//   listen for on change status of a Data_Model or control.\r\n\r\n// \r\n\r\n// 'View Data Model' sounds like a data model that ius used to describe the view, possibly in terms of other data models.\r\n\r\n\r\n\r\n// This is a good one to work on for view model abstraction. It's both simple and could be made complex.\r\n//   On or off, or some more complex status.\r\n\r\n// So there could be multiple view models. Create multiple view model specs, or have a system where multiple can\r\n//   be handled within a single spec.\r\n\r\n\r\nclass Status_Indicator extends Indicator {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        // on status change?\r\n\r\n        // bind some status words with css classes even.\r\n        //     \r\n\r\n        this.on('change', e => {\r\n            const { name, value } = e;\r\n            //if (name === 'status') {\r\n            //    this.update_status(value);\r\n            //}\r\n            console.log('status indicator change', name, value);\r\n        });\r\n        this.data.on('change', e => {\r\n            const { name, value } = e;\r\n            //if (name === 'status') {\r\n            //    this.update_status(value);\r\n            //}\r\n            console.log('status indicator .data change', name, value);\r\n        });\r\n        this.data.model.on('change', e => {\r\n            const { name, value } = e;\r\n            //if (name === 'status') {\r\n            //    this.update_status(value);\r\n            //}\r\n            console.log('status indicator .data.model change', name, value);\r\n        });\r\n    }\r\n\r\n    // bind this to a data value?\r\n    //   simple function, could deal with lower level stuff where necessary.\r\n\r\n    \r\n}\r\n\r\n// listen for status changes in something its linked to or its own data model.\r\n\r\nStatus_Indicator.css = `\r\n.indicator {\r\n    display: inline-block;\r\n    width: 1em;\r\n    height: 1em;\r\n    border-radius: 50%;\r\n    background-color: var(--status-indicator-color, gray);\r\n}       \r\n.indicator.on {\r\n    background-color: green;\r\n}       \r\n.indicator.off {\r\n    background-color: red;\r\n}\r\n.indicator.yes {\r\n    background-color: blue;\r\n}\r\n.indicator.no {\r\n    background-color: orange;\r\n}   \r\n.indicator.unknown {\r\n    background-color: gray;\r\n}   \r\n`;\r\n\r\nmodule.exports = Status_Indicator;\r\n\r\n// then yes or no statuses. or on and off?\r\n\r\n", "const Status_Indicator = require('./Status_Indicator');\r\n\r\nconst Control_Validation = require('../../../../../html-core/Control_Validation');\r\n\r\n// Control_Validation.\r\n\r\n// Control View Validation???\r\n//   etc can use in a few different ways.\r\n\r\n\r\n// Seems like piece-by-piece implementation of client-side data model recoherence will be the way.\r\n//   Seems like the controls would need to be constructed without the correct data_models, and then they get changed later on.\r\n\r\n// Perhaps though, the Data_Model could be set up completely independant of controls (to start with at least).\r\n//   Though having it so that all the logic is within client-side controls could make sense.\r\n//   It does for now at least, but consider other ways.\r\n//     Recoherence (and recoherence testing?) may be the best way forward for now, and work on making it as simple as possible\r\n//     on a high level.\r\n\r\n// Possibly need more low/mid level code to coordinate validations.\r\n//   Specifically how one data model gets validated against another data model.\r\n\r\n// Make the status indicator get the status after it gets activated?\r\n//   Before it gets activated?\r\n\r\n// Reloading / reconstructing / recohering a data_model on the client-side....\r\n//   Need to carefully consider the steps.\r\n//   Probably best to implement on high-level for the moment, move to lower level when the principles are clearer.\r\n\r\n\r\n\r\n// this.validate.by perhaps???\r\n// this.validation.data.model does make sense.\r\n//   At least when it comes to a validation status indicator.\r\n//   Though having more of the work done by Validation_Status would make sense.\r\n\r\n// Do need to be a bit clearer about what will validate what.\r\n\r\n// Maybe see about using some concise pieces of code....\r\n\r\n// Or looking at validation statuses thoroughly on different levels.\r\n\r\n\r\n\r\n\r\nclass Validation_Status_Indicator extends Status_Indicator {\r\n\r\n    // Likely will need some client-side recoherence with whatever model(s).\r\n\r\n    // vsi.data.model.value being the status value itself?\r\n    // vsi.data.model.validation.state perhaps?????\r\n\r\n    //   \r\n\r\n    constructor(spec = {}) {\r\n        spec.__type_name = spec.__type_name || 'validation_status_indicator';\r\n        super(spec);\r\n        this.add_class('validation-status')\r\n\r\n        const {context} = this;\r\n\r\n        // .validation.data.model ....\r\n\r\n        //  Should look at lower level coherence systems so that the data_model gets transmitted best to the client.\r\n        // does the spec have a validation data model???\r\n\r\n        // Is it connected to the data to validate?\r\n\r\n        // Some kinds of 'statuses' model / list?\r\n        //   \r\n\r\n        // .validation.status.valid = true / false\r\n        // or .data.model.validation.state ????\r\n\r\n        // Data_Model_Validation_State\r\n\r\n\r\n\r\n        const create_control_validation_but_maybe_we_dont_need_it = () => {\r\n\r\n            const o_validation = {context};\r\n\r\n            if (spec.validation) {\r\n                if (spec.validation.data) {\r\n                    if (spec.validation.data.model) {\r\n                        o_validation.data = {\r\n                            model: spec.validation.data.model\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // \r\n\r\n\r\n\r\n\r\n            this.validation = new Control_Validation(o_validation);\r\n            this.validation.state.on('change', e => {\r\n                const {name, old, value} = e;\r\n\r\n                //console.log('Validation_Status_Indicator validation.state change e:', e);\r\n\r\n                if (name === 'valid') {\r\n                    // update the appearance (class)\r\n\r\n                    if (value === true) {\r\n                        this.remove_class('is-not-valid');\r\n                        this.add_class('is-valid');\r\n                    } else if (value === false) {\r\n                        this.remove_class('is-valid');\r\n                        this.add_class('is-not-valid');\r\n                    }\r\n                }\r\n            })\r\n\r\n        }\r\n\r\n        // \r\n        this.data.on('change', e => {\r\n\r\n            console.log('V_S_I change e:', e);\r\n\r\n            const {name, old, value} = e;\r\n            if (name === 'model') {\r\n                // May need to move handlers.\r\n                //   The validation status change handler.\r\n\r\n\r\n                console.log('vsi data model change e', e);\r\n\r\n            }\r\n        })\r\n\r\n        this.data.model.validation.state.on('change', e => {\r\n            console.log('Validation_Status_Indicator .data.model.validation.state change e:', e);\r\n        })\r\n\r\n\r\n        // this.data.model.validation.status.on('change' 'valid')\r\n\r\n\r\n        // this.validation.on('change' valid)....\r\n\r\n\r\n        // A Validation State is an important thing to have as well.\r\n        //   It is worth putting a load of logic into the names and purposes of classes.\r\n\r\n        // this.validation.state.on('change'....)\r\n\r\n    }\r\n\r\n    activate() {\r\n\r\n        // Definitely would be better to put some kinds of validation / data model recoherence in the lower level code that\r\n        //   gets run automatically.\r\n\r\n        // Want both the controls and the usage of them to have simple code.\r\n        //   Will need to focus on implementing particularly mid-level code to get all these things working smoothly.\r\n\r\n        // Looking again at ctrl and ctrl-enh may help with recohering the data on the client-side.\r\n\r\n        // Also want to get into a view.ui.presentation data model....\r\n        //   Maybe also see about coherance / reconstruction of that.\r\n\r\n        // It seems very worth focusing for the moment on the mid-level code that will get everything working more smoothly.\r\n        //   Plus Data_Value where needed.\r\n        //   Maybe see about refactoring it.\r\n\r\n\r\n        // Context seems like the best place to keep some data model coherence.\r\n        //   \r\n\r\n        // Recoherence of data_model(s) within the Page_Context?\r\n\r\n\r\n\r\n        // Any kind of recoherence that would help here???\r\n\r\n\r\n        const log_some_things = () => {\r\n            console.log('Validation_Status_Indicator activate');\r\n\r\n            console.log('this.validation', this.validation);\r\n\r\n            console.log('this.validation.state', this.validation.state);\r\n\r\n            console.log('this.validation.data.model', this.validation.data.model);\r\n\r\n            console.log('this.data.model', this.data.model);\r\n\r\n            console.log('this.data.model.value', this.data.model.value);\r\n        }\r\n\r\n        \r\n\r\n\r\n    }\r\n\r\n    // And activation????\r\n    //   Would nice to have less needing to be done in activate functions.\r\n\r\n\r\n\r\n}\r\n\r\nValidation_Status_Indicator.css = `\r\n    .validation-status.indicator {\r\n        width: 24px;\r\n        height: 24px;\r\n        box-sizing: border-box;\r\n        -moz-box-sizing: border-box;\r\n        -webkit-box-sizing: border-box;\r\n        border: 1px solid #333333;\r\n        border-radius: 3px;\r\n    }\r\n    .validation-status.indicator.is-valid {\r\n        background-color: '#66DD66'\r\n    }\r\n    .validation-status.indicator.is-not-valid {\r\n        background-color: '#DD6666'\r\n    }\r\n`\r\n\r\nmodule.exports = Validation_Status_Indicator;", "// Maybe just change to Field control\r\n// Then Field_Group control would avoid confusion with an HTML form.\r\n\r\n// This will be more about text or string editor in the future.\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nconst Text_Input = require('../0-native-compositional/Text_Input');\r\nconst Text_Item = require('./text-item');\r\n/*\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\ttof = jsgui.tof;\r\n\t*/\r\nconst {Control, Control_Data, Control_View, Data_Object, Data_Value, Data_Model} = jsgui;\r\n\r\nconst {field} = require('lang-tools');\r\n\r\nconst Data_Model_View_Model_Control = require('../../../../../html-core/Data_Model_View_Model_Control');\r\n\r\n\r\nconst Validation_Status_Indicator = require('./Validation_Status_Indicator');\r\nconst { model_data_view_compositional_representation } = require('../../../../../control_mixins/mx');\r\n\r\n\r\n// fields could have default values too.\r\n\r\n// May well be worth improving and extending this.\r\n//   Put code to set up specific features in their own functions.\r\n//     May later want to optimise (make more concise) the code here using more patterns.\r\n\r\n\r\n// Late 2023 - Currently works, but could do with extra options, finesse, and making the code more compact and idiomatic,\r\n//   making use of (new) lower level features to support it.\r\n\r\n\r\n\r\n// \r\n\r\n// Will set the fields up (slightly?) differently in the future?\r\n//   Or passing it along as 2nd param could be OK???\r\n\r\n\r\n// Maybe an is_editable mixin???\r\n//   Or have that integrated with the various view and model systems.\r\n//     so if there is an 'editable' ui property, its value will have some kind of synced mapping to other parts of the system.\r\n\r\n// Simplify things from a lower level too.\r\n\r\n\r\n\r\nconst fields = [\r\n\t['text', String],\r\n\t['name', String],\r\n\t//['value', String],\r\n\t['type', String],\r\n\t['editable', Boolean, true],\r\n\t['show_text', Boolean, true]\r\n];\r\n\r\n// Could use validation status and validation status indicator.\r\n\r\n// Could see if updates to the Data_Model (from the View_Model) validate correctly.\r\n//   See if the View_Model (.data.model) validates properly.\r\n//     Assigning validation rules to the view.data.model too....\r\n\r\n\r\n\r\n\r\n// Could maybe use a status indicator mixin???\r\n\r\n// Or the status indicator only has a view.model ???\r\n\r\n\r\n\r\n//  status_indicator.data.model = ....\r\n\r\n\r\n\r\n// Text_Field\r\n\r\n\r\n// Value has got to be dynamic!!!!\r\n\r\n// When activated, respond to the property changes...\r\n//   Or even not only when activated.\r\n\r\n\r\n// Proper dom / view / model referencing and clarity seems important.\r\n\r\n// ctrl.model.on(change)???\r\n\r\n\r\n// Could seem the most explicit MVC or CVM type pattern.\r\n// ctrl.view.model.on()\r\n\r\n\r\n// .label.text perhaps....\r\n\r\n\r\n\r\n// extends Data_Model_View_Model_Control perhaps.\r\n\r\n// Making effective ll functionality to support this would help a lot.\r\n\r\n// For the moment should focus on implementing the interface here???\r\n//   No, separate the concerns now, so that can be general purpose.\r\n\r\n\r\n// Maybe should use a Data_Value by default.\r\n\r\n// Perhaps Data_Value could have a .name property as well.\r\n//   The name of the value. Synonymous with .key I suppose.\r\n\r\n// Could display the data_value name (perhaps???)\r\n\r\n// Maybe bound to the name and the value?\r\n\r\n// Data_Model.clone() could help.\r\n//   So set the view.data.model = data.model.clone()\r\n\r\n// See about some work on the .view.ui.model here.\r\n\r\n//   Being able to specify it nicely will help.\r\n\r\n//   More view.ui.options or similar....\r\n//     .ui.options makes sense....\r\n//     \r\n\r\n\r\n\r\n\r\n\r\n// Could also make Text_Input extend Data_Model_View_Model_Control.\r\n\r\n\r\n// No, should be made from a normal control but which has the model_data_view_compositional_representation mixin in use.\r\n\r\n// \r\n\r\n\r\n\r\n// Seems worth making a new version which uses the new (high-level? mid-level?) API that sets up and makes use of data and view models etc.\r\n//   Need some sort of DOM data binding too.\r\n\r\n// defining how a view.data.model syncs with the dom.el.value or something.\r\n\r\n// Mid-level code to get all of it working concisely on a high level.\r\n\r\n// view.ui.inner.compositional.model for example.\r\n//   maybe most controls won't support it???\r\n//   the Window Control should support it, some others too....\r\n\r\n\r\n// This does seem essential when representing some data.\r\n//   Let's also have a validation indicator in an example.\r\n\r\n\r\n// Need very clear and idiomatic data model / value sync and validation code and APIs.\r\n//   A view.data.model.validation.state\r\n//\r\n\r\n// \r\n\r\n// this.validation.status change etc....\r\n// The validation between the view and the data model.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Text_Field extends Control {\r\n\t// fields... text, value, type?\r\n\t//  type could specify some kind of validation, or also 'password'.\r\n\r\n\t//  and can have other fields possibly.\r\n\tconstructor(spec) {\r\n\r\n\t\tsuper(spec, fields);\r\n\t\t//super(spec);\r\n\t\tthis.editable = true; // for now.\r\n\r\n\t\tthis.__type_name = 'text_field';\r\n\t\tthis.add_class('text-field');\r\n\r\n\t\t//if (spec.type) this.type = spec.type;\r\n\t\t// could be 'password' for example...???\r\n\r\n\r\n\t\tif (spec.placeholder) this.placeholder = spec.placeholder;\r\n\r\n\t\t// Binding 'value' to the model data???\r\n\r\n\r\n\t\tconst {context} = this;\r\n\r\n\t\tconst data_model_change_handler = e => {\r\n            console.log('Text_Field data_model_change_handler e', e);\r\n\r\n\t\t\t// Should change it in the view model....???\r\n\r\n\t\t\tconst {name, old, value} = e;\r\n\t\t\tif (name === 'value') {\r\n\r\n\t\t\t\tthis.view.data.model.value = value;\r\n\t\t\t}\r\n\r\n        };\r\n\r\n        this.data.model.on('change', data_model_change_handler);\r\n\r\n        this.data.on('change', e => {\r\n            const {name, value, old} = e;\r\n\t\t\tconsole.log('Text_Field data change e:', e);\r\n            if (name === 'model') {\r\n                if (old instanceof Data_Model) {\r\n                    old.off('change', data_model_change_handler);\r\n                }\r\n                value.on('change', data_model_change_handler);\r\n            }\r\n        });\r\n\r\n\r\n\r\n\t\tconst view_data_model_change_handler = e => {\r\n            //console.log('Text_Field view_data_model_change_handler e', e);\r\n\r\n\t\t\t// Should change it in the view model....???\r\n\r\n\t\t\tconst {name, old, value} = e;\r\n\t\t\tif (name === 'value') {\r\n\t\t\t\tthis.data.model.value = value;\r\n\r\n\t\t\t\t// Needs to update the UI!!!!\r\n\r\n\t\t\t\t// The equivalent being the data model of the internal text_input\r\n\r\n\t\t\t\t//console.log('!!this.text_input', !!this.text_input);\r\n\r\n\t\t\t\tif (this.text_input) {\r\n\t\t\t\t\tthis.text_input.data.model.value = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n        };\r\n\r\n        this.view.data.model.on('change', view_data_model_change_handler);\r\n\r\n        this.view.data.on('change', e => {\r\n            const {name, value, old} = e;\r\n            if (name === 'model') {\r\n                if (old instanceof Data_Model) {\r\n                    old.off('change', view_data_model_change_handler);\r\n                }\r\n                value.on('change', view_data_model_change_handler);\r\n            }\r\n        });\r\n\r\n\t\tconst old_setup_data_and_view = () => {\r\n\r\n\t\t\tthis.data = new Control_Data({context});\r\n\r\n\t\t\t// even see about putting that data_model in the spec when reconstructing the controls?\r\n\t\t\t//   does seem like a better (but increasing complexity) answer for it on a lower level.\r\n\r\n\t\t\t// This could be within Data_Model_View_Model_Control.\r\n\t\t\t//   Probably should be.\r\n\t\t\t//     See about some lower level improvements to assigning / specifying fields.\r\n\t\t\t//       Will be using the field function that's new to lang-mini - though the function had been used in \r\n\t\t\t//       obext for quite a while. The field function is proving useful and versitile, moreso for the moment\r\n\t\t\t//       than the slightly similar in purpose prop function also in obext.\r\n\t\t\t//     \r\n\r\n\r\n\r\n\r\n\t\t\tif (spec.data && spec.data.model) {\r\n\t\t\t\tthis.data.model = spec.data.model;\r\n\t\t\t} else {\r\n\t\t\t\t// The Control_Data will have its own model object.\r\n\r\n\t\t\t\tthis.data.model = new Data_Value({context});\r\n\t\t\t\t//field(this.data.model, 'value');\r\n\t\t\t}\r\n\r\n\t\t\tthis.view = new Control_View({context})\r\n\t\t\tif (spec.view && spec.view.data.model) {\r\n\t\t\t\t// set the view model????\r\n\t\t\t\tthis.view.data.model = spec.view.data.model;\r\n\t\t\t} else {\r\n\r\n\r\n\t\t\t\tthis.view.data.model = new Data_Value({context});\r\n\t\t\t\t//field(this.view.data.model, 'value');\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// Then on data value change - see about changing it in the data model....\r\n\r\n\r\n\t\t\t// Better to make a new setup_models_change_handlers ???\r\n\t\t\t//\r\n\r\n\r\n\t\t\t//this.setup_models_change_handlers();\r\n\r\n\t\t\t// Or this is fine in the constructor because it does not have to do with internal controls???\r\n\t\t\t//   Or at least does not need to listen to their DOM events???\r\n\t\t\t//     Will be worth trying patterns that get this to work easily, as well as provide a nice / simple API\r\n\t\t\t//       when used.\r\n\r\n\t\t\t// Does seem OK here....\r\n\r\n\t\t\t//this.assign_data_model_value_change_handler();\r\n\r\n\t\t\t\r\n\r\n\t\t\t\r\n\r\n\t\t\t// And the view model changing --- would be nice to know if the change has been initiated by the DOM???\r\n\t\t\t//   Or the comparison will prevent feedback, and be simpler??\r\n\r\n\r\n\t\t\tthis.view.data.model.on('change', e => {\r\n\t\t\t\tconst {name, value, old} = e;\r\n\r\n\t\t\t\t//console.log('text_field view model change', e);\r\n\r\n\t\t\t\tif (name === 'value') {\r\n\r\n\t\t\t\t\t// Maybe want a more versitile equals function. Or even relying on tostring coersion with ==?\r\n\r\n\t\t\t\t\tif (value !== old) {\r\n\t\t\t\t\t\t// change it in the view model...\r\n\r\n\t\t\t\t\t\t// Though check if the data model can change to that?\r\n\t\t\t\t\t\t//   can_change_data_model\r\n\t\t\t\t\t\tthis.data.model.value = value;\r\n\r\n\t\t\t\t\t\t// Kind of activated???\r\n\t\t\t\t\t\t//   Does seem fine within the constructor though.\r\n\t\t\t\t\t\t//     May try this kind of code more.\r\n\r\n\t\t\t\t\t\tthis.text_input.data.model.value = value;\r\n\t\t\t\t\t\t//if (this.dom.el) {\r\n\t\t\t\t\t\t\t//this.dom.el.value = value;\r\n\t\t\t\t\t\t//}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// And possibly? update it in the DOM (.value property of the html element) here.\r\n\r\n\r\n\r\n\t\t\t\t//\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t\t// old_setup_data_and_view();\r\n\t\t\r\n\r\n\t\tif (!spec.el) {\r\n\t\t\tthis.compose_text_field();\r\n\r\n\t\t\t// Not so sure this should be needed....\r\n\t\t\t//this.setup_child_controls_listeners();\r\n\t\t\t// And better to call an \r\n\r\n\t\t}\r\n\r\n\t\tif (spec.value !== undefined) {\r\n\t\t\tthis.data.model.value = spec.value;\r\n\t\t}\r\n\r\n\t\t\r\n\t}\r\n\r\n\tsetup_inner_control_events() {\r\n\t\tconst {text_input} = this;\r\n\r\n\r\n\t\t//this.view.data.model = this.text_input.data.model;\r\n\r\n\t\t//this.text_input.data.model = this.view.data.model;\r\n\r\n\t\t// And validation states???\r\n\r\n\t\tthis.view.data.model.on('change', e => {\r\n\t\t\tconst {name, old, value} = e;\r\n\t\t\tif (name === 'value') {\r\n\t\t\t\ttext_input.data.model.value = value;\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\ttext_input.data.model.on('change', e => {\r\n\t\t\tconst {name, old, value} = e;\r\n\t\t\tif (name === 'value') {\r\n\t\t\t\tthis.view.data.model.value = value;\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {dom, text_input} = this;\r\n\r\n\t\t\t//this.setup_child_controls_listeners();\r\n\t\t\tthis.setup_inner_control_events();\r\n\r\n\r\n\r\n\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\tcompose_text_field() {\r\n\t\t\r\n\t\t// Could set the view.ui.compositional.model.\r\n\t\t//   Though may want 'name' values too, as strings???\r\n\t\t//    And it would set them all up as this._ctrl_fields too.\r\n\t\t//      Or only some of them???\r\n\t\t//      Seems worth setting all the named ones up as ctrl fields.\r\n\r\n\t\tconst old_composition_code = () => {\r\n\r\n\t\t\tvar left = new jsgui.div({\r\n\t\t\t\t'context': this.context\r\n\t\t\t});\r\n\t\t\tleft.add_class('left');\r\n\r\n\t\t\tvar right = new jsgui.div({\r\n\t\t\t\t'context': this.context\r\n\t\t\t});\r\n\t\t\tright.add_class('right');\r\n\t\t\t// adding should set the context properly.\r\n\r\n\t\t\tthis.add(left);\r\n\t\t\tthis.add(right);\r\n\r\n\t\t\tvar clearall = new jsgui.div({\r\n\t\t\t\t'context': this.context\r\n\t\t\t});\r\n\t\t\tclearall.add_class('clearall');\r\n\t\t\tthis.add(clearall);\r\n\r\n\t\t\tif (this.show_text) {\r\n\t\t\t\tvar label = new jsgui.label({\r\n\t\t\t\t\t'context': this.context\r\n\t\t\t\t});\r\n\t\t\t\t//var text = this.get('text');\r\n\t\t\t\t//console.log('this.text ' + this.text);\r\n\t\t\t\t//console.log('tof text ' + tof(text));\r\n\t\t\t\tlabel.add(this.text);\r\n\t\t\t\tleft.add(label);\r\n\t\t\t}\r\n\r\n\t\t\tconst _ctrl_fields = this._ctrl_fields = this._ctrl_fields || {};\r\n\r\n\t\t\t// Needs to work differently.\r\n\t\t\t//  Define two modes, it will swap between modes based on editable property and changes to it.\r\n\t\t\tif (this.editable) {\r\n\r\n\t\t\t\tlet o_spec = {\r\n\t\t\t\t\t'context': this.context,\r\n\t\t\t\t\t'value': this.value\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.placeholder) o_spec.placeholder = this.placeholder;\r\n\r\n\t\t\t\tvar text_input = new Text_Input(o_spec);\r\n\t\t\t\tvar tiid = text_input._id();\r\n\r\n\t\t\t\t// da(ctrl, str attr name, attr value)\r\n\t\t\t\t// da([arr of ctrl dom attr changes])\r\n\r\n\t\t\t\ttext_input.dom.attributes.id = tiid;\r\n\t\t\t\ttext_input.dom.attributes.name = this.name;\r\n\t\t\t\tlabel.dom.attributes.for = tiid;\r\n\r\n\t\t\t\t// and the type... it could be a password.\r\n\t\t\t\t//  that's a DOM attribute.\r\n\t\t\t\ttext_input.dom.attributes.type = this.type;\r\n\t\t\t\tright.add(text_input);\r\n\r\n\t\t\t\t_ctrl_fields.text_input = text_input;\r\n\t\t\t\tthis.text_input = this.text_input = text_input;\r\n\t\t\t} else {\r\n\t\t\t\t// Text_Item.\r\n\t\t\t\tvar text_item = new Text_Item({\r\n\t\t\t\t\t'context': this.context,\r\n\t\t\t\t\t'value': this.value\r\n\t\t\t\t});\r\n\t\t\t\tright.add(text_item);\r\n\r\n\t\t\t\t_ctrl_fields.text_item = text_item;\r\n\t\t\t\tthis.text_item = text_item;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// For now, have both the text label and the text input.\r\n\r\n\t\tconst using_compositional_model = () => {\r\n\r\n\t\t\t//console.log('using_compositional_model');\r\n\r\n\t\t\tthis.view.ui.compositional.model = [\r\n\r\n\t\t\t\t// (string, function || constructor) handling needed for the composition system.\r\n\t\t\t\t// (string, function || constructor, object)\r\n\r\n\t\t\t\t['left_part', Control, {class: 'left', comp: [['label', jsgui.label]]}],\r\n\t\t\t\t['right_part', Control, {class: 'right', comp: [['text_input', Text_Input, {'value': this.value}]]}]\r\n\r\n\t\t\t];\r\n\r\n\t\t\t// But then need to localise the inner named items too.\r\n\r\n\t\t\t// see about (auto) extracting names and references from the composition once it's been made according to that model.\r\n\r\n\t\t\tconst label = this._ctrl_fields.left_part.content._arr[0];\r\n\t\t\tconst text_input = this._ctrl_fields.right_part.content._arr[0];\r\n\r\n\t\t\t//text_input.data.model = this.view.data.model;\r\n\r\n\t\t\t//console.log('!!label', !!label);\r\n\t\t\t//console.log('!!text_input', !!text_input);\r\n\r\n\t\t\t//console.log('this.text', this.text);\r\n\r\n\t\t\tif (this.text) {\r\n\t\t\t\t//label.text = this.text;\r\n\t\t\t\tlabel.add(this.text);\r\n\t\t\t}\r\n\r\n\t\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\t\tthis._ctrl_fields.label = label;\r\n\t\t\tthis._ctrl_fields.text_input = text_input;\r\n\r\n\t\t\tthis.label = label;\r\n\t\t\tthis.text_input = text_input;\r\n\t\t}\r\n\r\n\t\tusing_compositional_model();\r\n\t\t// text_input\r\n\t}\r\n\r\n}\r\nmodule.exports = Text_Field;", "\r\n/*\r\n\r\nif (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\ndefine([\"../../jsgui-html\", \"./text-field\"],\r\nfunction(jsgui, Text_Field) {\r\n*/\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar Text_Field = require('../1-compositional/Text_Field');\r\nvar Button = require('./button');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// Another type of control? - composite or basic-composite?\r\n//  That would be an unenhanced Login control. Made up of basic controls, will render and\r\n//   be useful on very limited platforms.\r\n\r\n// Since this is now an advanced control...\r\n\r\n/*\r\n 'fields': {\r\n 'action': String\r\n },\r\n */\r\n\r\nclass File_Upload extends Control {\r\n\r\n    // Maybe should put this into a form, so that it does a form post.\r\n    //  That could possibly be disabled.\r\n\r\n    constructor(spec) {\r\n        super(spec);\r\n        var make = this.make;\r\n\r\n        // 0 icon / mini mode\r\n        // 1 compact mode\r\n        // 2 normal mode\r\n        // 3 large mode\r\n\r\n        var autosubmit = spec.autosubmit || false;\r\n\r\n        var mode = 'medium';\r\n        if (spec.mode) mode = spec.mode;\r\n        if (mode == 'icon' || mode == 'mini' || mode == 'compact') autosubmit = true;\r\n\r\n        //var url_path = spec.url_path;\r\n        // but we want that property to go to the client and be activated there too.\r\n        // will use ctrl fields too.\r\n        //this.add_class('file-upload ' + mode);\r\n        this.__type_name = 'file_upload';\r\n        // and use a form control, set it's dom attributes.\r\n        //  will use relative login url.\r\n\r\n        // We can get the cookies from the context.\r\n        var req = this.context.req;\r\n        //var headers = req.headers;\r\n        //console.log('headers ' + stringify(headers));\r\n        var frm = new jsgui.form({\r\n            'context': this.context\r\n        })\r\n        // action, method\r\n        // Could have a default action, or the action could be a field of this.\r\n        //  Then when it arrives on the server, need to handle its post request\r\n        //  Could possibly respond with a long polled / stream that says how much of it has uploaded. Could keep writing the percentage, possibly estimated\r\n        //  time remaining, speed.\r\n\r\n        //var action;\r\n        /*\r\n        if (spec.action) {\r\n            this.action = spec.action;\r\n\r\n        } else {\r\n            this.action = '/upload/';\r\n        }\r\n        */\r\n\r\n        this.action = spec.action || '/upload/';\r\n        //this.set('action', action);\r\n\r\n        //var action = this.get('action') || '/upload/';\r\n        //if (action.value) action = action.value();\r\n\r\n        //frm.set('dom.attributes.action', action);\r\n        var da = this.dom.attrs;\r\n        da.action = this.action;\r\n        da.method = 'POST';\r\n        da.enctype = 'multipart/form-data';\r\n\r\n        //frm.set('dom.attributes.action', '/login');\r\n        //frm.set('dom.attributes.method', 'POST');\r\n        //frm.set('dom.attributes.enctype', 'multipart/form-data');\r\n\r\n        this.add(frm);\r\n\r\n        var input_file = new jsgui.input({\r\n            //'type': 'file',\r\n            'context': this.context\r\n\r\n        });\r\n        input_file.set('dom.attributes.type', 'file');\r\n        input_file.set('dom.attributes.name', 'file');\r\n\r\n        frm.add(input_file);\r\n\r\n        if (mode === 'normal' || mode === 'large') {\r\n            var btn = new Button({\r\n                'context': this.context\r\n\r\n            })\r\n            var bda = btn.dom.attrs;\r\n            bda.type = 'submit';\r\n            bda.value = 'submit';\r\n            bda.class = 'upload';\r\n\r\n            //btn.set('dom.attributes.type', 'submit');\r\n            //btn.set('dom.attributes.value', 'submit');\r\n            //btn.set('dom.attributes.class', 'upload');\r\n            btn.add('Upload');\r\n            frm.add(btn);\r\n        }\r\n\r\n        var ctrl_fields = {\r\n            'input_file': input_file._id(),\r\n            'form': frm._id()\r\n        }\r\n\r\n        /*\r\n        this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n\r\n        // and the fields...\r\n        this.set('dom.attributes.data-jsgui-fields', stringify({\r\n            'autosubmit': autosubmit,\r\n            'mode': mode\r\n        }).replace(/\"/g, \"'\"));\r\n        */\r\n\r\n        //throw 'stop';\r\n    }\r\n    'activate'() {\r\n        super.activate();\r\n        console.log('activate File_Upload');\r\n        var mode = this.mode;\r\n        // .val\r\n        //  could get a control, but if it's a non-control Data_Object it would get its value.\r\n        var autosubmit = this.autosubmit;\r\n        var input_file = this.input_file;\r\n        var form = this.form;\r\n\r\n        //console.log('autosubmit', autosubmit);\r\n        //console.log('form', form);\r\n\r\n        if (autosubmit) {\r\n            //console.log('autosubmit', autosubmit);\r\n            //console.log('input_file', input_file);\r\n            input_file.add_event_listener('change', function (e_change) {\r\n                console.log('e_change', e_change);\r\n                form.dom.el.submit();\r\n            })\r\n        }\r\n    }\r\n}\r\nmodule.exports = File_Upload;\r\n", "/**\r\n * Form_Field - A composite control that combines label, input, and validation indicator\r\n * \r\n * Features:\r\n * - Label with required indicator\r\n * - Input control (Text_Input, Checkbox, Dropdown_List, etc.)\r\n * - Validation status indicator\r\n * - Error message display\r\n * - Flexible input type support\r\n */\r\n\r\nconst Control = require('../../../../html-core/control');\r\nconst Text_Input = require('../../0-core/0-basic/0-native-compositional/Text_Input');\r\nconst Validation_Status_Indicator = require('../../0-core/0-basic/1-compositional/Validation_Status_Indicator');\r\n\r\nclass Form_Field extends Control {\r\n    constructor(options = {}) {\r\n        super(options);\r\n        \r\n        const { context } = options;\r\n        \r\n        // Configuration\r\n        this.config = {\r\n            label: options.label || '',\r\n            name: options.name || '',\r\n            type: options.type || 'text', // text, email, password, checkbox, select, textarea\r\n            placeholder: options.placeholder || '',\r\n            required: options.required || false,\r\n            input_control: options.input_control || null, // Custom input control\r\n            validator: options.validator || null\r\n        };\r\n        \r\n        this.add_class('form-field');\r\n        \r\n        // Label container\r\n        if (this.config.label) {\r\n            this.label_container = new Control({ context, tag_name: 'div' });\r\n            this.label_container.add_class('form-field-label-container');\r\n            \r\n            this.label = new Control({ context, tag_name: 'label' });\r\n            this.label.add_class('form-field-label');\r\n            this.label.add(this.config.label);\r\n            \r\n            if (this.config.required) {\r\n                this.required_indicator = new Control({ context, tag_name: 'span' });\r\n                this.required_indicator.add_class('required-indicator');\r\n                this.required_indicator.add(' *');\r\n                this.label.add(this.required_indicator);\r\n            }\r\n            \r\n            this.label_container.add(this.label);\r\n            this.add(this.label_container);\r\n        }\r\n        \r\n        // Input container\r\n        this.input_container = new Control({ context, tag_name: 'div' });\r\n        this.input_container.add_class('form-field-input-container');\r\n        \r\n        // Create or use provided input control\r\n        if (this.config.input_control) {\r\n            this.input = this.config.input_control;\r\n        } else {\r\n            this.input = this._create_input_control(context);\r\n        }\r\n        \r\n        this.input_container.add(this.input);\r\n        \r\n        // Validation indicator\r\n        this.validation_indicator = new Validation_Status_Indicator({ context });\r\n        this.validation_indicator.add_class('form-field-validation');\r\n        this.input_container.add(this.validation_indicator);\r\n        \r\n        this.add(this.input_container);\r\n        \r\n        // Error message\r\n        this.error_message = new Control({ context, tag_name: 'div' });\r\n        this.error_message.add_class('form-field-error');\r\n        this.add(this.error_message);\r\n    }\r\n    \r\n    _create_input_control(context) {\r\n        const { type, placeholder, name } = this.config;\r\n        \r\n        switch (type) {\r\n            case 'text':\r\n            case 'email':\r\n            case 'password':\r\n            case 'number':\r\n            case 'url':\r\n            case 'tel':\r\n                const input = new Text_Input({ context });\r\n                input.dom.attributes.type = type;\r\n                input.dom.attributes.name = name;\r\n                if (placeholder) input.dom.attributes.placeholder = placeholder;\r\n                return input;\r\n                \r\n            case 'textarea':\r\n                const textarea = new Control({ context, tag_name: 'textarea' });\r\n                textarea.dom.attributes.name = name;\r\n                if (placeholder) textarea.dom.attributes.placeholder = placeholder;\r\n                textarea.add_class('form-textarea');\r\n                return textarea;\r\n                \r\n            case 'checkbox':\r\n                const checkbox = new Control({ context, tag_name: 'input' });\r\n                checkbox.dom.attributes.type = 'checkbox';\r\n                checkbox.dom.attributes.name = name;\r\n                checkbox.add_class('form-checkbox');\r\n                return checkbox;\r\n                \r\n            case 'select':\r\n                const select = new Control({ context, tag_name: 'select' });\r\n                select.dom.attributes.name = name;\r\n                select.add_class('form-select');\r\n                return select;\r\n                \r\n            default:\r\n                return new Text_Input({ context });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set the field value\r\n     */\r\n    set_value(value) {\r\n        const { type } = this.config;\r\n        \r\n        if (type === 'checkbox') {\r\n            this.input.dom.el.checked = !!value;\r\n        } else if (type === 'select') {\r\n            this.input.dom.el.value = value;\r\n        } else {\r\n            this.input.dom.el.value = value || '';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get the field value\r\n     */\r\n    get_value() {\r\n        const { type } = this.config;\r\n        \r\n        if (type === 'checkbox') {\r\n            return this.input.dom.el.checked;\r\n        } else {\r\n            return this.input.dom.el.value;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set validation state\r\n     */\r\n    set_validation(is_valid, error_message = '') {\r\n        if (is_valid) {\r\n            this.validation_indicator.set_status('valid');\r\n            this.error_message.content.clear();\r\n            this.remove_class('has-error');\r\n        } else {\r\n            this.validation_indicator.set_status('invalid');\r\n            this.error_message.content.clear();\r\n            this.error_message.add(error_message);\r\n            this.add_class('has-error');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clear validation state\r\n     */\r\n    clear_validation() {\r\n        this.validation_indicator.set_status('neutral');\r\n        this.error_message.content.clear();\r\n        this.remove_class('has-error');\r\n    }\r\n    \r\n    /**\r\n     * Enable/disable the field\r\n     */\r\n    set_enabled(enabled) {\r\n        this.input.dom.el.disabled = !enabled;\r\n        if (enabled) {\r\n            this.remove_class('disabled');\r\n        } else {\r\n            this.add_class('disabled');\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Form_Field;\r\n", "// object viewer\r\n\r\n/*\r\n if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n // html-enh depending on Context_Menu?\r\n\r\n\r\n\r\n define([\"../../jsgui-html\", \"./menu-node\"],\r\n function(jsgui, Menu_Node) {\r\n\r\n */\r\n\r\n// 2022 - Good candidate for deprecation - use Menu with display mode options.\r\n//   Can choose various things to do with appearance using .view\r\n\r\nvar jsgui = require('../../../../html-core/html-core');\r\nvar Menu_Node = require('../../0-core/0-basic/1-compositional/menu-node');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\nvar group = jsgui.group;\r\n\r\nclass Horizontal_Menu extends Control {\r\n\r\n\t// could have a title field.\r\n\t//'fields': {\r\n\t//\t'title': String\r\n\t//},\r\n\r\n\t// maybe add before make would be better. add will probably be used more.\r\n\tconstructor(spec, add, make) {\r\n\t\tsuper(spec);\r\n\t\tthis.__type_name = 'horizontal_menu';\r\n\t\tthis.dom.attrs.class = 'horizontal menu';\r\n\t\tif (!spec.abstract && !spec.el) {\r\n\t\t\tvar obj = spec.value;\r\n\t\t\t//var that = this;\r\n\t\t\tvar tobj = tof(obj);\r\n\t\t\tif (tobj == 'object') {\r\n\t\t\t\teach(obj, (v, key) => {\r\n\t\t\t\t\tvar menu_node = make(Menu_Node({\r\n\t\t\t\t\t\t'text': key,\r\n\t\t\t\t\t\t'value': v,\r\n\t\t\t\t\t\t'menu': this\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tthis.add(menu_node);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t'activate'() {\r\n\t\t// May need to register Flexiboard in some way on the client.\r\n\r\n\t\tif (!this.__active) {\r\n\t\t\tsuper.activate();\r\n\r\n\t\t\t//console.log('activate Horizontal_Menu');\r\n\t\t\t// While it is open, clicking outside of the menu should close it.\r\n\t\t\t// Something for opening the menu.\r\n\t\t\t//  Need to respond to a click on a (root) node.\r\n\t\t\t// Want a quick way to get all controls of a certain type inside.\r\n\t\t\t//  eg this.find(':horizontal_menu')\r\n\t\t\t//  this.children(':horizontal_menu')\r\n\t\t\t// this.matches_selector(':horizontal_menu');\r\n\t\t\t// Needs to have various states\r\n\t\t\t//  Different parts of it can be open, closed.\r\n\r\n\t\t\t// On click, want to see if any of the nodes are open.\r\n\t\t\t//  I think being able to do some kind of selector / query that gets a group of controls would be very helpful here.\r\n\r\n\t\t\t// this.children(':menu_node[open]')\r\n\t\t\t//  Some kind of notation like that to find any open menu nodes.\r\n\t\t\t// The menu items should have 'state' properties\r\n\t\t\tvar last_clicked;\r\n\t\t\tthis.content.each((v, i) => {\r\n\t\t\t\tv.on('click', e_click => {\r\n\t\t\t\t\t//console.log('menu item clicked');\r\n\r\n\t\t\t\t\t// if it is already open?\r\n\t\t\t\t\tvar v_state = v.state;\r\n\t\t\t\t\t//console.log('v_state', v_state);\r\n\r\n\t\t\t\t\t// Don't open if we are reclicking on the same menu item?\r\n\t\t\t\t\t//if (last_clicked !== v) {\r\n\t\t\t\t\tv.open();\r\n\t\t\t\t\t// And mousedown anywhere (else) to close.\r\n\t\t\t\t\t//console.log('pre setup one mousedown anywhere');\r\n\t\t\t\t\t// mousedown anywhere else?\r\n\r\n\t\t\t\t\tv.one_mousedown_anywhere(function (e_mousedown) {\r\n\t\t\t\t\t\t//console.log('e_mousedown.within_this ' + e_mousedown.within_this);\r\n\t\t\t\t\t\tif (!e_mousedown.within_this) {\r\n\t\t\t\t\t\t\tv.close();\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//}\r\n\r\n\t\t\t\t\t//last_clicked = v;\r\n\r\n\t\t\t\t})\r\n\r\n\t\t\t\tv.on('mouseup', function (e_mouseup) {\r\n\t\t\t\t\t//setTimeout(function() {\r\n\t\t\t\t\t//\tlast_clicked = null;\r\n\t\t\t\t\t//}, 0);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\t//  could find controls with classes and tag names using css queries.\r\n\t\t//\r\n\t}\r\n\t'close_all'() {\r\n\t\tconsole.log('menu close_all');\r\n\t\t// need to do this recursively I think.\r\n\t\t//  could call this recursively on all nodes.\r\n\t\tthis.content.each((v, i) => {\r\n\t\t\t//console.log('i', i);\r\n\t\t\t//console.log('v', v);\r\n\t\t\tv.close_all();\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports = Horizontal_Menu;\r\n", "const jsgui = require('./../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\n\r\n\r\n// A 'Platform' Control.\r\n//  Any other word?\r\n//  Platform control makes sense as it's the platform that jsgui3 is providing.\r\n//  Basic controls are the ones that are simple / simpler abstractions over HTML elements with customization.\r\n\r\n// Basic controls\r\n// Platform controls\r\n\r\n// \r\n\r\n\r\n\r\nvar fields = [\r\n    ['value', Object]\r\n];\r\nclass Data_Item extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n    // single field?\r\n    //  and can have other fields possibly.\r\n\r\n\r\n    // this.__type_name = 'text_item';\r\n    constructor(spec) {\r\n        super(spec, fields);\r\n        this.__type_name = 'data_item';\r\n        this.add_class('data-item');\r\n        let context = this.context;\r\n\r\n        //console.log('this.value', this.value);\r\n\r\n        this.add(new jsgui.textNode({\r\n            text: this.value + '',\r\n            context: this.context\r\n        }));\r\n\r\n        // Contains data items\r\n        /*\r\n        if (spec.item || spec.value) {\r\n            let item = this.item = spec.item || spec.value;\r\n\r\n\r\n\r\n        }\r\n        */\r\n\r\n\r\n\r\n        //ctrl_title_bar.set('dom.attributes.class', 'titlebar');\r\n        //this.add(span);\r\n    }\r\n};\r\nmodule.exports = Data_Item;", "const jsgui = require('./../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\nvar Data_Item = require('./data-item');\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\n/*\r\nvar fields = [\r\n    ['text', String]\r\n];\r\n*/\r\n\r\n/*\r\n    May be unnecessary with a more flexible core.\r\n*/\r\n\r\nclass Data_Row extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n    // single field?\r\n    //  and can have other fields possibly.\r\n    constructor(spec) {\r\n        super(spec);\r\n        this.add_class('data-row');\r\n        let context = this.context;\r\n\r\n        // Contains data items\r\n\r\n        let items = this.items = [];\r\n\r\n        // Or use the inner collection of controls?\r\n\r\n        if (spec.items) {\r\n            each(spec.items, item => {\r\n                //console.log('item', item);\r\n                items.push(this.add(new Data_Item({\r\n                    'context': context,\r\n                    'value': item\r\n                })));\r\n            })\r\n        }\r\n\r\n        //ctrl_title_bar.set('dom.attributes.class', 'titlebar');\r\n        //this.add(span);\r\n    }\r\n};\r\nmodule.exports = Data_Row;", "const jsgui = require('../../../../../html-core/html-core');\r\n//const stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nconst {Control, Control_Data, Control_View, Data_Object} = jsgui;\r\nconst {field} = require('obext');\r\n\r\n// 2023 - Initial support for the data.model and view.model system. Compact code, but want to make it more compact and idiomatic.\r\n\r\n// So it's view.data.model for the moment.\r\n//   There could be other view models too, such as view.ui.model ????\r\n//     As in the scroll position?\r\n//     view.ui.data.model even ???\r\n//      for the moment, use more nested and longwinded syntax.\r\n//      Will allow more future flexibility, and clarity when describing / writing the app(s).\r\n\r\n// Incorporate more options / settings into these.\r\n//   Like for a Window control, view.ui.data.model could help.\r\n//     Meaning data such as it's position, height, width.\r\n//       Could then use similar mechanisms for persisting and sharing that data, when needed.\r\n\r\n// A more complex underlying system for representing data representations would help.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Date_Picker extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'date_picker';\r\n        super(spec);\r\n        this.add_class('date-picker');\r\n        this.dom.tagName = 'input';\r\n        this.dom.attributes.type = 'date';\r\n        const {context} = this;\r\n        if (!spec.el) {\r\n            this.compose_date_picker();\r\n        }\r\n\r\n        // Could be part of a mixin???\r\n        //   Not quite yet though...\r\n\r\n        // May want the 'draggable' mixin to work on the level of ctrl.view.ui.options.data.model.draggable = true??\r\n        //   A ui options model could be useful.\r\n        //   or just view.ui.model rather than view.data.model. ctrl.view.options ....???\r\n\r\n        // Do make them deeply nested so that they can be for very specific things.\r\n\r\n        // Maybe work on integrating .view.ui.data.model into classes at a lower level, for controlling some presentation things,\r\n        //   such as ctrl.view.ui.data.model.background....\r\n\r\n        // And could make (common / general purpose) shortcuts to them.\r\n        //   Could make it clearer about how to write code (functions) to deal with the changes and syncronisation.\r\n\r\n\r\n\r\n        const construct_synchronised_data_and_view_models = () => {\r\n            this.data = new Control_Data({context})\r\n            if (spec.data && spec.data.model) {\r\n                this.data.model = spec.data.model;\r\n            } else {\r\n                this.data.model = new Data_Object({context});\r\n                field(this.data.model, 'value');\r\n            }\r\n            this.view = new Control_View({context})\r\n            if (spec.view && spec.view.data.model) {\r\n                this.view.data.model = spec.view.data.model;\r\n            } else {\r\n                this.view.data.model = new Data_Object({context});\r\n                field(this.view.data.model, 'value');\r\n            }\r\n            this.data.model.on('change', e => {\r\n                const {name, value, old} = e;\r\n                if (name === 'value') {\r\n                    if (value !== old) {\r\n                        this.view.data.model.value = value;\r\n                    }\r\n                }\r\n            });\r\n            this.view.data.model.on('change', e => {\r\n                const {name, value, old} = e;\r\n                if (name === 'value') {\r\n                    if (value !== old) {\r\n                        this.data.model.value = value;\r\n                        if (this.dom.el) {\r\n                            this.dom.el.value = value;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        construct_synchronised_data_and_view_models();\r\n        this.assign_data_model_value_change_handler();\r\n    }\r\n    assign_data_model_value_change_handler() {\r\n        if (this.data && this.data.model) {\r\n            this.data.model.on('change', e => {\r\n                const {name, value, old} = e;\r\n                if (name === 'value') {\r\n                    if (value !== old) {\r\n                        this.view.data.model.value = value;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\t}\r\n    compose_date_picker() {\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {dom} = this;\r\n            const activate_view_model_to_dom_model_sync = () => {\r\n                this.add_dom_event_listener('change', e => {\r\n                    this.view.data.model.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keypress', e_keypress => {\r\n                    this.view.data.model.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keyup', e_keyup => {\r\n                    this.view.data.model.value = dom.el.value;\r\n                });\r\n                this.add_dom_event_listener('keydown', e_keydown => {\r\n                    this.view.data.model.value = dom.el.value;\r\n                });\r\n            }\r\n            activate_view_model_to_dom_model_sync();\r\n        }\r\n    }\r\n}\r\nmodule.exports = Date_Picker;", "/*\r\n    Basically an 'select' element with options, rendering would be swappable though.\r\n\r\n\r\n*/\r\n\r\n// A Select_Options control could help more first....\r\n//   And could progressively enhance that too.\r\n//   So falling back on the non-enhanced control by default will help, it brings the app further towards\r\n//     not requiring client-side JS.\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nconst each = jsgui.each;\r\nconst tof = jsgui.tof;\r\nconst Control = jsgui.Control;\r\n//const Tree_Node = require('./tree-node');\r\n\r\n// Then use a swap to change the controls when it's in place.\r\n\r\n/*\r\n    <select> <option value=\"American\">American flamingo</option> <option value=\"Andean\">Andean flamingo</option> <option value=\"Chilean\">Chilean flamingo</option> <option value=\"Greater\">Greater flamingo</option> <option value=\"James's\">James's flamingo</option> <option value=\"Lesser\">Lesser flamingo</option> </select>\r\n\r\n    Read more: https://html.com/tags/select/#ixzz5NXFlnCLS\r\n*/\r\n\r\n// Different states - open, closed\r\n\r\n\r\n// This will do more than just wrap the HTML control(s)\r\n//  Maybe work on the combo-box control.\r\n\r\n// Likely could be enhanced a lot, removed, or replaced.\r\n//  Does minimal wrapping of html options list (it seems).\r\n//  Could do with popup iplementation.\r\n\r\n\r\n// Maybe could make good use of the mx_display_modes.\r\n\r\n\r\n// Could render as a select / options box by default.\r\n//   Though could use progressive enhancement to replace it.\r\n//     Could even do some CSS hack(s) to make open/closed state not require client-side JS.\r\n\r\n// Basically select option control.\r\n//   Maybe retire this for the moment.\r\n//     Or make it with a dropdown mixin and a list.\r\n\r\n\r\n// Worth making the control that encapsulates the bare HTML input option select.\r\n//   The 'select' and 'option' elements system.\r\n\r\n// Just make jsgui.select perhaps????\r\n//   Some enhancement around that?\r\n\r\n// Select_Options ?????\r\n\r\n// Select_Options_Dropdown_List perhaps???\r\n\r\n// Then an Options_List could do more progressive enhancement.\r\n//   See about making better idioms for 'progressively enhanced' versions.\r\n//     So have the basic control there, have code for it, that code would support client-side things, but it gets swapped for\r\n//       a more advanced control???\r\n\r\n// Want to be able to easily express both the basic HTML, as well as the enchanced versions.\r\n\r\n\r\n// Grid does seem like it needs more work when it comes to separating the data and the presentation.\r\n//   Want it to be powerful and flexible in this regard.\r\n\r\n// Perhaps this could use a select options and replace it upon activation using JS?\r\n\r\n\r\n\r\n//  Different types of controls / control modes.\r\n//    HTML Native, JSGUI Composed.\r\n//    So a dropdown menu could use the HTML select element, or could be composed of other controls.\r\n//    Maybe just 'native' and 'composed'.\r\n//      Or 'complex'? 'built'?\r\n\r\n// Native controls could still have other native controls within them - like options in a select.\r\n\r\n// And controls operating in either native or composed mode?\r\n//   Not right now.\r\n\r\n\r\n\r\n// Make this into a compositional type control?\r\n// Dropdown_Menu for now?\r\n\r\n\r\nclass Dropdown_List extends Control {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        console.trace();\r\n        throw 'Deprtecating this control for the moment. Try Select_Options or Dropdown_Menu instead.';\r\n\r\n        // and the options...\r\n        //  an array of options.\r\n        this.options = spec.options;\r\n        // Compose functions look like they would be helpful again.\r\n\r\n        // if it was called through activation?\r\n\r\n        if (!spec.skip_compose) this.compose();\r\n    }\r\n    compose() {\r\n        const context = this.context;\r\n\r\n        // Make this more versitile, while also supporting a very intuitive high-level API.\r\n        //   Such as being able to provide it options from a model or part of one to select from.\r\n        \r\n\r\n\r\n\r\n        each(this.options, option => {\r\n            // Option could just be a string, a number or [number, string]\r\n\r\n            let t = tof(option);\r\n            let ctrl_option = new jsgui.option({\r\n                context\r\n            });\r\n            if (t === 'string') {\r\n                ctrl_option.dom.attributes.value = option;\r\n                ctrl_option.add(new jsgui.textNode('option'));\r\n            }\r\n\r\n        });\r\n    }\r\n}\r\n\r\nmodule.exports = Dropdown_List;", "/**\r\n * Created by James on 04/08/2014.\r\n */\r\n\r\n\r\nvar jsgui = require('./../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, def = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\n// Titled_Panel would be useful.\r\n//  Would extend the panel, and also show it's name or title.\r\n\r\n// Want to keep panel simple. Could have Titled_Panel, maybe Resizable_Panel.\r\n//  If we want a panel with a lot of functionality, it would be the Flexi_Panel.\r\n\r\n// Panel_Grid possibly...\r\n//  Can load panels etc...\r\n\r\n// May make Showcase version.\r\n//  Or SuperPanel?\r\n//  Or ActivePanel?\r\n//   SmartPanel\r\n\r\n// A panel with something like 4 panels inside it...\r\n//  Should be a way of doing application layout.\r\n\r\n// Or just use a normal panel with a bunch of mixins?\r\n\r\n\r\n// Panel could have a text label as part of it (by default, easy to set, easy to move, easy to delete or not use)\r\n//   Though may want to get into making it really easy to add new controls in specific ways, such as binding it to the edge\r\n//     (and also probably reducing the size of the panel itself so that label (or div / span element) fits)\r\n\r\n\r\n\r\n\r\nclass Panel extends Control {\r\n    // panel name?\r\n\r\n    // could have a title field.\r\n    //'fields': {\r\n    //    'name': String\r\n    //}\r\n    // maybe add before make would be better. add will probably be used more.\r\n    constructor(spec, add, make) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'panel';\r\n        super(spec);\r\n        //this.__type_name = 'panel';\r\n        //this.add_class('panel');\r\n        this.add_class('panel');\r\n\r\n        if (def(spec.name)) {\r\n            this.name = spec.name;\r\n        }\r\n\r\n\r\n\r\n        // With name as a field, that field should get sent to the client...\r\n        if (!spec.abstract && !spec.el) {\r\n            var l = 0;\r\n            //var ctrl_fields = {\r\n            //}\r\n\r\n            let n = this.name;\r\n            if (def(n)) {\r\n                let f = this._fields = this._fields || {};\r\n                f.name = n;\r\n            }\r\n\r\n\r\n            //var name = this.name;\r\n            //if (is_defined(name)) {\r\n                //this._fields = this._fields || {};\r\n                //this._fields['name'] = name;\r\n            //    this.name = name;\r\n            //}\r\n        }\r\n    }\r\n    //'resizable': function() {\r\n    //},\r\n\r\n    /*\r\n    'activate'() {\r\n        // May need to register Flexiboard in some way on the client.\r\n\r\n        if (!this.__active) {\r\n            super.activate();\r\n            this.content.on('change', e => {\r\n                console.log('e', e);\r\n                console.log('this', this);\r\n            })\r\n        }\r\n        \r\n    }\r\n    */\r\n}\r\nmodule.exports = Panel;\r\n", "var jsgui = require('./../../../../html-core/html-core');\r\n\r\nconst {stringify, each, tof, def, Control} = jsgui;\r\n\r\nvar fields = [\r\n    ['text', String]\r\n];\r\n\r\n\r\n// describe available actions for the control's view model.\r\nconst view_model_spec = {\r\n    name: 'title_bar',\r\n    version: '0.0.1',\r\n    type: 'control',\r\n    fields: {\r\n        number_of_lines: 1\r\n    },\r\n    actions: ['close', 'minimize', 'maximize', 'restore']\r\n\r\n}\r\n\r\nclass Title_Bar extends Control {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'title_bar';\r\n\r\n        super(spec, fields);\r\n\r\n        if (!spec.el) {\r\n            this.add_class('title-bar title bar');\r\n            var span = new jsgui.span({\r\n                'context': this.context,\r\n                'text': this.text\r\n            })\r\n            this.add(span);\r\n        }\r\n        \r\n    }\r\n};\r\nmodule.exports = Title_Bar;", "/*\r\nif (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\ndefine([\"../../jsgui-html-enh\"],\r\n function(jsgui) {\r\n*/\r\n\r\n// Should have a toggle button group to allow selection / activation of individual buttons.\r\n//  Will have an event for when the button selection changes.\r\n//  Perhaps this could be done with a selection group, like a radio group.\r\n// For the moment, I think a Toggle_Button_Group is the right way to go.\r\n\r\n// Maybe we really want a 'select_button'.\r\n//  Don't want clicking it again to unselect it.\r\n//  Perhaps we just want to say a button is 'selectable'.\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n\r\n//var stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\n//var Control = jsgui.Control;\r\n\r\nconst {stringify, each, tof, def, Control} = jsgui;\r\n// Can the button contain an image?\r\n//  Would be useful for a start/stop button.\r\n//  Toggle button toggling between two images.\r\n\r\n// Nice of obext did a bit in terms of object.grammar.\r\n//  Defining the grammar of objects and functions seems very useful.\r\n//   In some cases, it could be used to make more concise and declarative code.\r\n\r\n// Look at using mixin state management and display modes.\r\n//   Have the code in the controls more declarative and concise.\r\n\r\n\r\nconst { prop, field } = require('obext');\r\n\r\nclass Toggle_Button extends Control {\r\n\r\n    constructor(spec, add, make) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'toggle_button';\r\n        super(spec);\r\n        this.add_class('toggle-button');\r\n        field(this, 'states', spec.states || '');\r\n        field(this, 'state', spec.state || '');\r\n        if (!spec.abstract && !spec.el) {\r\n            const _compose = () => {\r\n                var span_state = this.span_state = new jsgui.span({ 'context': this.context, text: this.state });\r\n                this.add(span_state);\r\n            }\r\n            const compose = () => jsgui.parse_mount(`<span name='span_state'>${this.state}</span>`, this, jsgui.controls);\r\n            compose();\r\n        }\r\n        this.on('change', e_change => {\r\n            //console.log('Toggle_Button change', e_change);\r\n            if (this.span_state) this.span_state.text = e_change.value;\r\n        });\r\n        if (typeof document === 'undefined') {\r\n            //this.dom.attributes['data-jsgui-fields'] = stringify(active_fields).replace(/\"/g, \"'\");\r\n            this.dom.attributes['data-jsgui-ctrl-fields'] = stringify({\r\n                'span_state': this.span_state._id()\r\n            }).replace(/\"/g, \"'\");\r\n            //this.set('dom.attributes.data-jsgui-fields', stringify(active_fields).replace(/\"/g, \"'\"));\r\n        }\r\n    }\r\n\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            this.on('click', e_click => {\r\n                var state = this.state;\r\n                var states = this.states;\r\n                var i_current_state;\r\n                if (tof(states) === 'array') {\r\n                    each(states, (i_state, i) => {\r\n                        if (i_state === state) {\r\n                            i_current_state = i;\r\n                        }\r\n                    })\r\n                    var i_next_state = i_current_state + 1;\r\n                    if (i_next_state === states.length) i_next_state = 0;\r\n                    var str_next_state = states[i_next_state];\r\n                    this.raise('toggle', {\r\n                        'state': str_next_state\r\n                    });\r\n                    this.state = str_next_state;\r\n                } else {\r\n                    throw 'stop'\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\nmodule.exports = Toggle_Button;", "\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar Toggle_Button = require('./toggle-button');\r\n//if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n//define([\"../../jsgui-html\", \"./toggle-button\"],\r\n//function(jsgui, Toggle_Button) {\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\nclass Plus_Minus_Toggle_Button extends Toggle_Button {\r\n\r\n    //  and can have other fields possibly.\r\n\r\n    constructor(spec, add, make) {\r\n\r\n        // Set it so it only has two states\r\n        //  '+' and '-'\r\n        spec.__type_name = 'plus_minus_toggle_button';\r\n        spec.states = ['+', '-'];\r\n        spec.state = spec.state || '-';\r\n\r\n        //console.log('spec.context', spec.context);\r\n\r\n        super(spec);\r\n        let state = this.state = spec.state;\r\n\r\n    }\r\n};\r\n//return Plus_Minus_Toggle_Button;\r\n\r\n//return jsgui;\r\n\r\n\r\n//});\r\n\r\nmodule.exports = Plus_Minus_Toggle_Button;\r\n", "// Vertical_Expander\r\n\r\n// Some of these controls won't be needed.\r\n//   It will definitely help to make simple and complex examples demonstrating them.\r\n\r\n\r\n//if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\nvar jsgui = require('./../../../../html-core/html-core');\r\n\r\n//var stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\nconst {prop, field} = require('obext');\r\n\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\nclass Vertical_Expander extends Control {\r\n\t// fields... text, value, type?\r\n\t//  type could specify some kind of validation, or also 'password'.\r\n\r\n\t// single field?\r\n\t//'fields': [\r\n\t//\t['text', String]\r\n\t//],\r\n\t//  and can have other fields possibly.\r\n\r\n\tconstructor(spec) {\r\n\t\tspec.__type_name = 'vertical_expander';\r\n\t\tsuper(spec);\r\n\r\n\t\tthis.add_class('vertical expander');\r\n\t\t//\r\n\r\n\t\t// starts either open or closed.\r\n\r\n\t\t// Would have two possible states - open and closed.\r\n\t\t//  Would move between the two.\r\n\r\n\t\t//var state = spec.state || 'open'\r\n\r\n\t\tfield(this, 'state');\r\n\t\tfield(this, 'states');\r\n\r\n\t\t//this.set('states', ['open', 'closed']);\r\n\r\n\t\tthis.state = spec.state;\r\n\t\tthis.states = spec.states;\r\n\r\n\r\n\t\t//let state = spec.state;\r\n\t\t//if (state === 'expanded') state = 'open';\r\n\t\t//if (state === 'contracted') state = 'closed';\r\n\r\n\t\t//this.set('state', state || 'open');\r\n\r\n\t\t//var span = new jsgui.span({\r\n\t\t//\t'context': this.context\r\n\t\t//})\r\n\t\t//span.add(this.get('text').value());\r\n\t\t//ctrl_title_bar.set('dom.attributes.class', 'titlebar');\r\n\t\t//this.add(span);\r\n\r\n\t}\r\n\t\r\n\t'activate'() {\r\n\t\t//console.log('Vertical Expander activate');\r\n        super.activate();\r\n\r\n\t\t// I think that animation should be handled by Contol, just getting called here.\r\n\t\t//  Will use css transitions where applicable.\r\n\t\t// Listen to the state being changed.\r\n\t\t// Then update the UI based on that\r\n\t\t//var that = this;\r\n\t\tvar orig_height;\r\n\r\n\t\tvar el = this.dom.el;\r\n\r\n\t\tif (el) {\r\n\t\t\tel.style.transition = 'height 0.125s linear';\r\n\t\t\tvar ui_close = () => {\r\n\t\t\t\tvar h = el.childNodes[0].offsetHeight;\r\n\t\t\t\t//console.log('h', h);\r\n\t\t\t\torig_height = h;\r\n\t\t\t\tel.style.height = orig_height + 'px';\r\n\t\t\t\t\r\n\t\t\t\t// transition: width 3s linear;\r\n\t\t\t\t//el.style.transition = 'height 0.08s linear';\r\n\t\t\t\t\r\n\t\t\t\t//el.style['webkit-transition-property'] = 'height';\r\n\t\t\t\t//el.style['webkit-transition-duration'] = '1s';\r\n\t\t\t\t//el.style['webkit-transition-timing-function'] = 'linear';\r\n\t\t\t\t//el.style['transition-delay'] = '2s';\r\n\t\t\t\t// And to listen to the animation ending as well.\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t//console.log('should hide overflow');\r\n\t\t\t\t\t//\r\n\t\t\t\t\tel.style.overflow = 'hidden';\r\n\t\t\t\t\tel.style.height = '0px';\r\n\t\t\t\t}, 0);\r\n\t\t\t\t// Better control over styles will help.\r\n\t\t\t\t//  Need the inline css layer.\r\n\t\t\t\t//  Then have the JSGUI style layer on top of that.\r\n\t\t\t}\r\n\r\n\t\t\tvar ui_open = () => {\r\n\r\n\t\t\t\tvar fnTransitionEnd = function(e_end) {\r\n\t\t\t\t\t//console.log('e_end', e_end);\r\n\t\t\t\t\t//console.log('fnTransitionEnd');\r\n\t\t\t\t\t//el.style.overflow = 'visible';\r\n\t\t\t\t\tel.removeEventListener('transitionend', fnTransitionEnd)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tel.addEventListener('transitionend', fnTransitionEnd, false);\r\n\r\n\t\t\t\t// when the transition has completed, make the overflow visible.\r\n\t\t\t\t//el.style.overflow = 'visible';\r\n\t\t\t\tel.style.height = orig_height + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tthis.on('change', e_change => {\r\n\t\t\t\tvar val = e_change.value;\r\n\r\n\t\t\t\tif (val == 'closed') {\r\n\t\t\t\t\tui_close();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (val == 'open') {\r\n\t\t\t\t\tui_open();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole.log('WARNING: vertical_expander expected el to activate');\r\n\t\t\tconsole.trace();\r\n\t\t}\r\n\r\n\t\t/*\r\n\r\n\t\tvar state = this.get('state');\r\n\t\tstate.on('change', function(e_change) {\r\n\t\t\tconsole.log('Vertical_Expander state change', e_change);\r\n\r\n\t\t\t// Change it in the UI at this point.\r\n\t\t\tvar val = e_change.value;\r\n\r\n\t\t\tif (val == 'closed') {\r\n\t\t\t\tui_close();\r\n\t\t\t}\r\n\r\n\t\t\tif (val == 'open') {\r\n\t\t\t\tui_open();\r\n\t\t\t}\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\t// Going to be setting the height based on measured height of self / contents\r\n\t\t//  May use css transitions. Possibly 'transit' function.\r\n\t\t// May make animate function take similar syntax to jQuery but use CSS transitions where appropriate.\r\n\r\n\t\t// Have the UI respond to changes in the state variable.\r\n\t}\r\n\t'toggle'() {\r\n\t\t// Will change the state.\r\n\t\t//console.log('vertical-expander toggle');\r\n\t\t//var state = this.state;\r\n\t\t//var v_state = state.value();\r\n\t\t//console.log('state', state);\r\n\r\n\t\t//console.log('tof state', tof(state));\r\n\r\n\t\tif (this.state == 'open') {\r\n\t\t\t//this.set('state', 'closed');\r\n\t\t\t//state.set('closed');\r\n\t\t\tthis.state = 'closed';\r\n\t\t}\r\n\t\tif (this.state == 'closed') {\r\n\t\t\t//this.set('state', 'open');\r\n\t\t\tthis.state = 'open';\r\n\t\t}\r\n\t}\r\n\t'open'() {\r\n\t\t//this.state.set('open');\r\n\t\tthis.state = 'open';\r\n\t}\r\n\t'close'() {\r\n\t\t//this.state.set('closed');\r\n\t\tthis.state = 'closed';\r\n\t}\r\n\t// Open, close, expand, contract\r\n\t//  Could have a state variable as well.\r\n\t//  Will listen to changes in that state variable.\r\n\r\n}\r\nmodule.exports = Vertical_Expander;\r\n", "var jsgui = require('./../../../../html-core/html-core');\r\nvar Plus_Minus_Toggle_Button = require('./../../0-core/0-basic/1-compositional/plus-minus-toggle-button');\r\nvar Vertical_Expander = require('./../6-layout/vertical-expander');\r\n\r\nconst mx_selectable = require('./../../../../control_mixins/selectable');\r\nconst {\r\n\tprop,\r\n\tfield\r\n} = require('obext');\r\n\r\nconst {\r\n\tstringify,\r\n\teach,\r\n\ttof,\r\n\tdef,\r\n\tControl\r\n} = jsgui;\r\n\r\n/*\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\ttof = jsgui.tof,\r\n\tdef = jsgui.def;\r\nvar Control = jsgui.Control;\r\n*/\r\n\r\nvar fields = [\r\n\t//['text', String]\r\n\t['toggle_button', Control],\r\n\t['inner_control', Control],\r\n\t['expander', Control]\r\n];\r\n\r\nclass Tree_Node extends Control {\r\n\tconstructor(spec) {\r\n\t\t// Wont fields have been set?\r\n\t\tspec = spec || {};\r\n\t\t//console.log('1) spec', spec);\r\n\t\tspec.__type_name = spec.__type_name || 'tree_node';\r\n\t\t//spec.expandable = spec.expandable || true;\r\n\t\tif (!def(spec.expandable)) spec.expandable = true;\r\n\t\tsuper(spec);\r\n\t\tmx_selectable(this);\r\n\r\n\t\tfield(this, 'depth');\r\n\t\tfield(this, 'state', 'open');\r\n\t\tthis.expandable = spec.expandable;\r\n\t\tif (def(spec.depth)) this.depth = spec.depth;\r\n\t\tif (spec) {\r\n\t\t\tvar spec_state = spec.state,\r\n\t\t\t\tstate;\r\n\t\t\t//this.depth = spec.depth || 0;\r\n\t\t\t//console.log('spec_state', spec_state);\r\n\t\t\tif (spec_state === 'open' || spec_state === 'closed') {\r\n\t\t\t\tthis.state = spec_state;\r\n\t\t\t} else {\r\n\t\t\t\t//this.state = 'closed';\r\n\t\t\t\t//throw 'spec.state expects \"expanded\" or \"contracted\".';\r\n\t\t\t}\r\n\t\t\tif (spec.text) {\r\n\t\t\t\t//this.set('text', spec.text);\r\n\t\t\t\tthis.text = spec.text;\r\n\t\t\t} else {\r\n\t\t\t\tif (spec.name) {\r\n\t\t\t\t\t//this.set('text', spec.text);\r\n\t\t\t\t\tthis.text = spec.name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//state = this.set('state', 'expanded');\r\n\t\t\tthis.state = 'open';\r\n\t\t}\r\n\r\n\t\tif (spec.img_src) {\r\n\t\t\t//this.set('img_src', spec.img_src);\r\n\t\t\t//var img_src = this.img_src;\r\n\t\t\t//console.log('img_src', img_src);\r\n\t\t\t//console.log('this._', this._);\r\n\t\t\t//throw '1) stop;'\r\n\t\t}\r\n\t\tif (typeof spec.el === 'undefined') {\r\n\t\t\t//console.log('4) spec', spec);\r\n\t\t\t//console.log('5) spec2', spec2);\r\n\t\t\t//console.log('typeof spec2', typeof spec2);\r\n\t\t\t//console.log('**** spec.img_src', spec.img_src);\r\n\t\t\tthis.compose_tree_node(spec);\r\n\t\t\t// Tree node name, or text.\r\n\t\t\t//  Could give it a name\r\n\t\t}\r\n\t\t//this.selectable = true;\r\n\t\t//}\r\n\r\n\t\t// need to listen to content change...\r\n\t\t//  how many tree nodes are in the content.\r\n\r\n\t\t// inner_control content change\r\n\r\n\t\tif (this.inner_control) {\r\n\t\t\tthis.inner_control.content.on('change', e_change => {\r\n\t\t\t\t//console.log('tree inner_control content change', e_change);\r\n\r\n\t\t\t\tlet coll = e_change.target;\r\n\t\t\t\t// then does the collection contain at least one Tree_Node?\r\n\r\n\t\t\t\t// can we do has by type?\r\n\t\t\t\t//  has an instance of a function constructor.\r\n\t\t\t\tlet has_tree_node = false;\r\n\t\t\t\teach(coll, (v, i, stop) => {\r\n\t\t\t\t\tif (v instanceof Tree_Node) {\r\n\t\t\t\t\t\thas_tree_node = true;\r\n\t\t\t\t\t\tstop();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (has_tree_node) {\r\n\t\t\t\t\tthis.toggle_button.show();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.toggle_button.hide();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t'compose_tree_node'(spec) {\r\n\t\t//console.log('!!this.context', !!this.context);\r\n\t\t//throw 'stop';\r\n\t\t//let my = p => p.context = this.context;\r\n\t\tlet my = (p) => {\r\n\t\t\tp.context = this.context;\r\n\t\t\treturn p;\r\n\t\t}\r\n\t\tconst add = item => this.add(item);\r\n\t\tconst make = item => this.make(item);\r\n\t\t// Old way of doing things...\r\n\t\t//  allowed classes to be involked without new, meaning they were in a passive mode and held params describing them.\r\n\t\tvar top_line = add(new Control(my({\r\n\t\t\t'class': 'top-line'\r\n\t\t})));\r\n\t\tlet rest_of_top_line;\r\n\r\n\t\t// Could try with parse_mount. Maybe it's not the best for loops\r\n\r\n\t\tif (def(this.depth)) {\r\n\t\t\t// add that many depth blocks\r\n\t\t\t//console.log('this.depth', this.depth);\r\n\t\t\tfor (let c = 0; c < this.depth; c++) {\r\n\t\t\t\tlet depth_block = new Control(my({\r\n\t\t\t\t\t'class': 'depth-block'\r\n\t\t\t\t}))\r\n\t\t\t\ttop_line.add(depth_block);\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\trest_of_top_line = new Control(my({\r\n\t\t\t'class': 'rest-of'\r\n\t\t}));\r\n\t\ttop_line.add(rest_of_top_line);\r\n\t\t*/\r\n\t\t//var plus_minus = make(new Plus_Minus_Toggle_Button({}));\r\n\t\t//top_line.add(plus_minus);\r\n\t\tlet plus_minus, inner_control;\r\n\t\tlet spec3 = {};\r\n\t\tif (this.state === 'closed') {\r\n\t\t\tspec3.state = '+';\r\n\t\t}\r\n\r\n\t\t// only if there are other nodes within this node?\r\n\r\n\t\ttop_line.add(plus_minus = new Plus_Minus_Toggle_Button(my(spec3)));\r\n\t\tthis.toggle_button = plus_minus;\r\n\t\tplus_minus.hide();\r\n\r\n\t\t// Whenever the collection of nodes changes, if there are 0 nodes, then hide this plus minus button.\r\n\r\n\t\tvar main_box = top_line.add(new Control(my({\r\n\t\t\t'class': 'main-box'\r\n\t\t})));\r\n\r\n\t\t//plus_minus.hide();\r\n\t\t//var img_src = ;\r\n\r\n\t\tif (this.img_src) {\r\n\t\t\trest_of_top_line.add(new jsgui.img(my({\r\n\t\t\t\t'dom': {\r\n\t\t\t\t\t'attributes': {\r\n\t\t\t\t\t\t'src': this.img_src\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\t\t}\r\n\t\t//var img = make(new jsgui.img({}));\r\n\t\t//img.dom.attributes.src = img_src;\r\n\t\t// Also add the text to the top line.\r\n\t\t//var span = make(new jsgui.span({}));\r\n\t\t//var text = this.text;\r\n\t\t//console.log('this.text', this.text);\r\n\t\t//span.add(text);\r\n\t\t// inner_box\r\n\t\tmain_box.add(new jsgui.span(my({\r\n\t\t\ttext: this.text,\r\n\t\t\t'class': 'text'\r\n\t\t})));\r\n\r\n\t\t/*\r\n\t\tvar clearall = add(new Control(my({\r\n\t\t\t'class': 'clearall'\r\n\t\t})));\r\n\t\t*/\r\n\t\t// expandable by default.\r\n\t\t//  Some won't be.\r\n\r\n\t\tlet expander;\r\n\t\t//console.log('this.expandable', this.expandable);\r\n\t\tif (this.expandable) {\r\n\t\t\texpander = add(new Vertical_Expander(my({\r\n\t\t\t\t//state: this.state\r\n\t\t\t})));\r\n\t\t\t//var inner_control = make(new Control({ 'class': 'inner' }));\r\n\t\t\texpander.add(inner_control = new Control(my({\r\n\t\t\t\t'class': 'inner'\r\n\t\t\t})));\r\n\r\n\t\t\t/*\r\n\t\t\tvar inner_control_content = inner_control.content;\r\n\t\t\tinner_control_content.on('change', e_change => {\r\n\t\t\t\t//console.log('Tree_Node inner_control_content change', e_change);\r\n\t\t\t\t//throw 'stop';\r\n\t\t\t\tvar l = inner_control_content.length();\r\n\t\t\t\tconsole.log('inner_control_content', l);\r\n\t\t\t\tif (l > 0) {\r\n\t\t\t\t\t// so could / should be hidden bydefault anyway.\r\n\t\t\t\t\tplus_minus.show();\r\n\t\t\t\t}\r\n\t\t\t\t//throw 'stop';\r\n\t\t\t});\r\n\t\t\t*/\r\n\t\t\t\r\n\t\t\t//console.log('pre set inner_control');\r\n\t\t\tthis.inner_control = inner_control;\r\n\t\t\t//console.log('post set inner_control');\r\n\t\t\tthis.expander = expander;\r\n\r\n\t\t\tif (spec.nodes) {\r\n\t\t\t\tfor (let node of spec.nodes) {\r\n\t\t\t\t\tnode.context = this.context;\r\n\t\t\t\t\tnode.depth = this.depth + 1;\r\n\t\t\t\t\tlet tn = new Tree_Node(node);\r\n\t\t\t\t\tthis.inner_control.add(tn);\r\n\t\t\t\t}\r\n\t\t\t\texpander.state = this.state = 'open';\r\n\t\t\t} else {\r\n\t\t\t\texpander.state = this.state = 'closed';\r\n\t\t\t\t//plus_minus.hide();\r\n\t\t\t\t//expander.close();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//console.log('should hide plus_minus');\r\n\t\t\tplus_minus.hide();\r\n\t\t}\r\n\r\n\t\tvar ctrl_fields = this._ctrl_fields = Object.assign(this._ctrl_fields || {}, {\r\n\t\t\t'toggle_button': plus_minus\r\n\t\t});\r\n\t\tif (expander) {\r\n\t\t\tctrl_fields.inner_control = inner_control;\r\n\t\t\tctrl_fields.expander = expander;\r\n\t\t}\r\n\t\tthis.add_class('tree-node');\r\n\t\t// only active on the server.\r\n\t\t//  on the client, we don't need those extra references?\r\n\t\tthis.active();\r\n\t}\r\n\r\n\t// adding a node - need to set up its depth?\r\n\r\n\r\n\t// I think a pre-render function would be useful.\r\n\t//  Something that sets data-jsgui DOM attributes.\r\n\r\n\t// Seems we need a separate 'register' stage, where controls, with their DOM els get registered with the central jsgui system.\r\n\r\n\t// whenever something is added to the DOM, the nodes need to be registered.\r\n\t//  within the page context\r\n\r\n\t// Want automatic activation of any control that gets added.\r\n\t//  Added to an active control.\r\n\r\n\t// __is_active\r\n\r\n\r\n\t'activate'(el) {\r\n\t\tif (!this.__active) {\r\n\t\t\tsuper.activate(el);\r\n\r\n\t\t\t// Maybe shouldn't need this.\r\n\t\t\tthis.rec_desc_ensure_ctrl_el_refs();\r\n\t\t\t//this.selectable();\r\n\r\n\t\t\t//console.log('activate Tree_Node');\r\n\t\t\t// ctrl-fields not working?\r\n\t\t\t// Need to listen to the toggle event of the plus minus toggle button\r\n\r\n\t\t\t// This will be done through the ctrl~_fields system.\r\n\t\t\t//  Would like an easier way of setting that up.\r\n\t\t\tvar toggle_button = this.toggle_button;\r\n\t\t\t//console.log('toggle_button', toggle_button);\r\n\r\n\t\t\tvar inner_control = this.inner_control;\r\n\t\t\tvar expander = this.expander;\r\n\t\t\t//console.log('inner_control', inner_control);\r\n\r\n\t\t\t//console.log('expander', expander);\r\n\t\t\t//console.log('toggle_button', toggle_button);\r\n\r\n\t\t\tif (expander) {\r\n\t\t\t\tif (toggle_button) {\r\n\t\t\t\t\ttoggle_button.on('toggle', e_toggle => {\r\n\t\t\t\t\t\t// set the expander state depending on the value.\r\n\t\t\t\t\t\t// '-' state means open at that time.\r\n\t\t\t\t\t\tlet state = e_toggle.state;\r\n\t\t\t\t\t\tif (state === '-') {\r\n\t\t\t\t\t\t\texpander.open();\r\n\t\t\t\t\t\t\tthis.raise('expand');\r\n\t\t\t\t\t\t\tthis.raise('open');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t//console.log('expander', expander);\r\n\t\t\t\t\t\t\t//console.log('expander.close', expander.close);\r\n\t\t\t\t\t\t\t//console.log('Object.keys(expander)', Object.keys(expander));\r\n\t\t\t\t\t\t\texpander.close();\r\n\t\t\t\t\t\t\tthis.raise('contract');\r\n\t\t\t\t\t\t\tthis.raise('close');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\t//console.log('toggle_button.__active', toggle_button.__active);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\nmodule.exports = Tree_Node;", "// A box that contains a tree.\r\n//  While a tree can be put in a normal Control, will have some more functions / tools / controls for dealing with a tree, such as collapse_all etc.\r\nvar jsgui = require('./../../../../html-core/html-core');\r\n/*\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n*/\r\nconst {stringify, each, tof, def, Control} = jsgui;\r\n\r\n// Registration of controls within jsgui.\r\n//  where it adds it to the map of controls.\r\n\r\n// jsgui.controls is now the / a map of controls.\r\n\r\n// Again, a 'platform' control.\r\n//  Ways to merge in different controls / control sets?\r\n//   That will come. It needs to be convenient.\r\n\r\n// Could download the bare minimum.\r\n//  Bare minimum / core controls.\r\n\r\n// Could separate out the core controls ie document, div, span, svg, many others.\r\n//  Pay them more attention. Could have plugins.\r\n//   Styling shortcuts.\r\n// Really advanced and flexible core that deals mostly with single controls, but sets the groundwork for 'platform' controls.\r\n\r\n// Platform controls - separate from the core controls.\r\n//  eos-live-www just seems to need to show some very basic controls ie have control over some span contents.\r\n//   it has its own controls. then module-view as well.\r\n//    so does not need much in terms of jsgui controls at all at this stage.\r\n\r\n\r\n\r\n\r\n\r\n//  Then download a control set all at once in another file.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst Panel = require('./../6-layout/panel');\r\nconst Title_Bar = require('./../6-layout/title-bar');\r\nconst Tree_Node = require('./tree-node');\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\nconst {prop, field} = require('obext');\r\n//var fields = [\r\n//    ['text', String]\r\n//];\r\n// Could do with a File_Tree that can integrate with an FS_Resource\r\n// text alias being title?\r\nclass Tree extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n    // single field?\r\n    //  and can have other fields possibly.\r\n    constructor(spec, add, make) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'tree';\r\n        super(spec);\r\n        this.add_class('tree');\r\n        //this.__type_name = 'tree';\r\n        // Add the title bar and the main container space.\r\n        /*\r\n        this.title_bar = new Title_Bar({\r\n        });\r\n        */\r\n        //if (spec.title) this.title = spec.title;\r\n\r\n        field(this, 'title');\r\n        this.title = spec.title;\r\n\r\n        //add(Title_Bar({\r\n        //    'text': 'tree'\r\n        //}));\r\n\r\n        // don't do this composition on the client.\r\n        //  don't do it when connecting to an existing DOM.\r\n\r\n        if (!spec.el) {\r\n        //if (!window) {\r\n            this.compose_tree(spec);\r\n        }\r\n\r\n        // one way data binding.\r\n        // this.bind('title', this.title_bar.text);\r\n        // bind(this, 'title', this.title_bar.text)\r\n\r\n        this.on('change', e_change => {\r\n            if (e_change.name === 'title') {\r\n                this.title_bar.text = e_change.value;\r\n            };\r\n        }) \r\n    }\r\n    compose_tree(spec) {\r\n        //console.log('this.title', this.title);\r\n\r\n        // Can try the new parse_mount with controls.\r\n\r\n\r\n\r\n\r\n        if (this.title !== undefined) {\r\n            this.add(this.title_bar = new Title_Bar({\r\n                context: this.context,\r\n                text: this.title\r\n            }));\r\n        }\r\n        this.add(this.main = new Panel({\r\n            context: this.context\r\n        }));\r\n        //var ctrl_fields = ;\r\n        if (spec.nodes) {\r\n            for (let node of spec.nodes) {\r\n                node.context = this.context;\r\n                node.depth = 0;\r\n                let tn = new Tree_Node(node);\r\n                this.main.add(tn);\r\n            }\r\n        }\r\n        this._ctrl_fields = Object.assign(this._ctrl_fields || {}, {\r\n            //'title_bar': this.title_bar,\r\n            'main': this.main\r\n        });\r\n        if (this.title_bar) {\r\n            this._ctrl_fields.title_bar = this.title_bar;\r\n        }\r\n        //this.dom.attributes['data-jsgui-ctrl-fields'] = stringify(ctrl_fields).replace(/\"/g, \"'\");\r\n    }\r\n    clear() {\r\n        //console.log('this.main', this.main);\r\n        this.main.clear();\r\n    }\r\n    activate() {\r\n        super.activate();\r\n        this.selection_scope = this.context.new_selection_scope();\r\n    }\r\n};\r\nmodule.exports = Tree;", "const jsgui = require('./../../../../html-core/html-core');\r\nconst Tree = require('./../../1-standard/5-ui/tree');\r\n\r\n// This may need to be connected with a resource.\r\n//  Specified with an API.\r\n//   Possibly move to a 'data' or 'connected' dir.\r\n//    or resource? As in it will need access to a resource to work.\r\n//   That resource will be available on the client-side.\r\n\r\n// Possibly some controls will only work in a connected mode.\r\n\r\n\r\n\r\nclass File_Tree extends Tree {\r\n    constructor(spec) {\r\n\r\n        spec.__type_name = 'file_tree';\r\n\r\n        // Could be a directory too?\r\n        /*\r\n        if (spec.file) {\r\n            let file = spec.file;\r\n            let filename = file.name;\r\n            spec.text = file.name;\r\n            \r\n        }\r\n        */\r\n\r\n        // FS_Resource is an obvious data source.\r\n\r\n        //spec.expandable = false;\r\n\r\n        super(spec);\r\n        this.add_class('file tree file-tree');\r\n\r\n        const context = this.context;\r\n\r\n        // Make the published resources available?\r\n\r\n\r\n\r\n        let fs_resource = spec.fs || spec.fs_resource;\r\n        if (fs_resource) {\r\n            this.fs_resource = fs_resource;\r\n        } else {\r\n            let resources = context.resources;\r\n\r\n            // The website resource.\r\n            //  That's critical to many servers.\r\n            //  Don't want to assume it's the only / main resource in all configs though.\r\n\r\n            // Or a control's context should be set to the webserver.\r\n            //  That makes more sense.\r\n            //   The webserver (resource) can be encapsulated in a more general server.\r\n\r\n            // The FS resource will / may only be published within the website resource\r\n            //  Can have the website resource provide some access code.\r\n\r\n\r\n\r\n            console.log('File_Tree context resources', resources);\r\n            console.log('File_Tree context.resource_pool', context.resource_pool);\r\n            console.log('Object.keys(context)', Object.keys(context));\r\n\r\n            // Maybe should assume the website context in some cases, rather than the server context.\r\n            //  Want easier way of accessing the web page context.\r\n\r\n            // .page_context ?\r\n            //   get that from the context?\r\n            \r\n            // \r\n\r\n            // find the 'fs' resource within the context.\r\n\r\n            // Want to get the website resource.\r\n            //  Maybe do some more work on collections too. Indexing, storing, retrieving, using the tree kvs feature.\r\n\r\n\r\n            // context.resource_pool.resources\r\n\r\n            // Publishing should add a resource to the pool.\r\n            //  It does now, to the website pool.\r\n\r\n            // then get the fs resource from the local pool.\r\n            //  Should work on both the client and the server.\r\n\r\n\r\n\r\n\r\n            //throw 'stop';\r\n\r\n        }\r\n\r\n        // can we get it from the page_context resources?\r\n\r\n\r\n\r\n        // Need to respond to events from the fs_resource.\r\n        //  Client-side, it should automatically wire up requests to the resource.\r\n\r\n\r\n        // Camera could be a camera object that can provide data.\r\n        //  On the client should go through a data service.\r\n        //this.camera = spec.camera;\r\n\r\n        //console.log('File_Tree_Node spec', spec);\r\n\r\n        if (!spec.el) {\r\n            //let tn;\r\n            this.compose_file_tree();\r\n        }\r\n    }\r\n    compose_file_tree() {\r\n        // Show it at its root.\r\n        //  Async composition?\r\n\r\n        // Seems like async composition is necessary.\r\n\r\n        // Could even do parse-mount?\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n    activate() {\r\n        // Client-side, we need to connect to the resource.\r\n        //  Initialise a new Data_Resource?\r\n        //   Or the Data_Resource would have been initialised?\r\n\r\n        // Being able to get a list of available resources would be useful.\r\n        //  context.resources\r\n        //   think that's the client-side resource pool?\r\n\r\n        // Need to get access to an equivalent resource on the client-side with the same JS API.\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = File_Tree;", "const jsgui = require('./../../../../html-core/html-core');\r\nconst Tree_Node = require('./tree-node');\r\n\r\n//const mx_selection_box_host = require('../control_mixins/selection-box-host');\r\n\r\nclass File_Tree_Node extends Tree_Node {\r\n    constructor(spec) {\r\n        /*\r\n        if (spec.camera) {\r\n            spec.text = spec.camera.name;\r\n        }\r\n        */\r\n        // Could be a directory too?\r\n        if (spec.file) {\r\n            let file = spec.file;\r\n            let filename = file.name;\r\n            spec.text = file.name;\r\n            \r\n        }\r\n        spec.__type_name = 'file_tree_node';\r\n        spec.expandable = false;\r\n\r\n        super(spec);\r\n        this.add_class('file');\r\n        \r\n        \r\n        // Camera could be a camera object that can provide data.\r\n        //  On the client should go through a data service.\r\n        //this.camera = spec.camera;\r\n\r\n        //console.log('File_Tree_Node spec', spec);\r\n\r\n        if (!spec.el) {\r\n            //let tn;\r\n            /*\r\n            this.add(tn = new Tree_Node({\r\n                context: this.context,\r\n                text: 'Info'\r\n            }));\r\n            tn.active();\r\n            //console.log('tn.dom.el', tn.dom.el);\r\n            //tn.activate(tn.dom.el);\r\n            let tn_videos;\r\n            this.add(tn_videos = new Tree_Node({\r\n                context: this.context,\r\n                text: 'Videos',\r\n                state: 'contracted'\r\n            }));\r\n            tn_videos.on('expand', e_expand => {\r\n                // if there are 0 nodes then add them...\r\n                (async () => {\r\n                    console.log('e_expand', e_expand);\r\n                    console.log('this.context.cameras', this.context.cameras);\r\n                    console.log('Object.keys(this.context.cameras)', Object.keys(this.context.cameras));\r\n                    let url_files = spec.camera.name + '/files.json';\r\n                    console.log('url_files', url_files);\r\n                    let corner_files = await this.context.cameras.get(url_files);\r\n                    console.log('corner_files', corner_files);\r\n                })();\r\n            });\r\n            // then all the videos for the camera\r\n            console.log('this.camera', this.camera);\r\n            // can get data back through the camera data service.\r\n            // asyncronously load the camera videos data.\r\n            tn.active();\r\n            */\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = File_Tree_Node;", "const jsgui = require('../../../../../html-core/html-core');\r\nconst {\r\n    Control,\r\n    parse_mount,\r\n    parse,\r\n    field\r\n} = jsgui;\r\n\r\n// Nice to make this flexible - make use of resources, svg, jsgui3-gfx....\r\n//   Would be better to have this make use of other (lower level) functionality and to provide a nice API here.\r\n\r\n// Would be nice to have low and medium level image features available to various controls, will be easy to put icons where they need to be\r\n//   though this Icon control should make it easier in some ways.\r\n\r\n\r\nclass Icon extends Control {\r\n\r\n\r\n\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'icon';\r\n        let size = spec.size = spec.size || [64, 64];\r\n        super(spec);\r\n        const {\r\n            context\r\n        } = this;\r\n        this.add_class('icon');\r\n        field(this, 'key', spec.icon_key || spec.key);\r\n        const compose = () => {\r\n            const {\r\n                key\r\n            } = this;\r\n            const imgurl = '/img/icons/' + key;\r\n            const img = new jsgui.img({\r\n                context: context,\r\n                size: [64, 64]\r\n            });\r\n            img.dom.attributes.src = imgurl;\r\n            this.add(img);\r\n            this._ctrl_fields = this._ctrl_fields || {};\r\n            this._ctrl_fields.img = img;\r\n        }\r\n        if (!spec.el) {\r\n            compose();\r\n        }\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {\r\n                img\r\n            } = this;\r\n            this.on('change', ({\r\n                name,\r\n                value\r\n            }) => {\r\n                if (name === 'key') {\r\n                    const imgurl = '/img/icons/' + value;\r\n                    img.dom.attributes.src = imgurl;\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\nmodule.exports = Icon;", "const jsgui = require('../../../../../html-core/html-core');\r\nconst {Control, controls, tf, are_equal, each} = jsgui;\r\nconst {span} = controls;\r\nconst {prop, field} = require('obext');\r\n\r\n// Use some mixins here...\r\n//  Expandable\r\n//  Inner space?\r\n\r\nconst Icon = require('../0-native-compositional/icon');\r\n\r\n// May move the left_right creator function elsewhere.\r\n// Control and multi-control creation functions.\r\n\r\n// cfn seems like the right abbreviation.\r\n\r\n\r\n// Always needs the context?\r\n//  Hard to create controls without it.\r\n//  context always as first property.\r\n\r\nconst c_left_right = (context, l_content, r_content) => {\r\n    // Will retutn an array of 2 ctrls.\r\n\r\n    const left = new Control({\r\n        context: context,\r\n        class: 'left'\r\n    })\r\n    left.add(l_content);\r\n    const right = new Control({\r\n        context: context,\r\n        class: 'right'\r\n    })\r\n    right.add(r_content);\r\n    const res = [left, right];\r\n    return res;\r\n}\r\n\r\n\r\n// Integrated css / sass would be quite useful.\r\n//  Can get the CSS generated from jsgui controls.\r\n\r\n// Will be able to put css together from the (prototypes? classes ie constructors?) within jsgui.controls.\r\n\r\n// item.css\r\n// item.sass\r\n\r\n\r\n// Would definitely be easier / neater (and like React) to define the CSS within the Control js file.\r\n// Post browserify, pre babel...\r\n//  That would be a decent time to remove these statements.\r\n\r\n// What mode is it being displayed in?\r\n\r\n// display_mode property could be useful.\r\n\r\n// Item should just be a div for the moment.\r\n//   May be useful naming, more significant in terms of what it is application and logic wise, abstracts from HTML.\r\n\r\n\r\n// Very vague.\r\n\r\nclass Item extends Control {\r\n\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'item';\r\n        super(spec);\r\n        this.add_class('item');\r\n\r\n        // item can be given in the spec.\r\n        //  then look at that object.\r\n\r\n        /*\r\n\r\n        const item = this.item = spec.item;\r\n        const {context} = this;\r\n        const compose = () => {\r\n            const tfitem = tf(item);\r\n            //console.log('tfitem', tfitem);\r\n\r\n            if (tfitem === 'o') {\r\n                // see what keys there are...\r\n                //  use mfp?\r\n\r\n                const item_keys = Object.keys(item).sort();\r\n                //console.log('item_keys', item_keys);\r\n\r\n                // icon and text?\r\n\r\n                // Would be split into 2 parts.\r\n                //  Icon, then the rest (text).\r\n\r\n                if (item_keys.length === 2) {\r\n                    if (are_equal(item_keys, ['icon', 'text'])) {\r\n                        //console.log('item with icon and text');\r\n                        \r\n                        // then compose it this way.\r\n                        //  probably want a left part and a right part.\r\n\r\n                        //  a function to generate them?\r\n                        // control / controls generator functions...\r\n\r\n                        // Then a div / span with the text.\r\n                        //  Div and p? p?\r\n\r\n                        const main_content = new span({\r\n                            context: context\r\n                        });\r\n                        main_content.add(item.text);\r\n\r\n                        const lr = c_left_right(context, new Icon({\r\n                            context: context,\r\n                            key: item.icon,\r\n                            size: [64, 64]\r\n                        }), main_content);\r\n\r\n                        console.log('lr');\r\n\r\n                        // adding an array of content... should work!\r\n                        //  TODO: Try it later.\r\n                        each(lr, ctrl => {\r\n                            this.add(ctrl);\r\n                        })\r\n\r\n                        // Multi-control creation functions\r\n                        //  Saves encapsulating within a single control.\r\n\r\n\r\n                        //left_right(new icon, div with text);\r\n                        // would create two controls that cover left and right.\r\n                        //  may be a useful way of creating and wrapping content.\r\n\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (!spec.el) {\r\n            compose();\r\n        }\r\n        */\r\n    }\r\n}\r\n\r\n// CSS as JSON...?\r\n// Could have css as css text.\r\n\r\n// Compiling all the CSS together would make a lot of sense.\r\n//  Rather than using basic.css so much. Styling is too separate and hard to find in there.\r\n\r\n// The css resource can provide this.\r\n//  Could even be inline within the main HTML file - may be better performance?\r\n\r\n// overriding specific CSS properties?\r\n//  maybe requires some kind of decent (simple?) model of css and its properties. would deal with a lot of strings.\r\n//   use the same way that React builds the CSS?\r\n\r\n// https://github.com/streamich/nano-css\r\n\r\n// Maybe it can just join all the CSS together...\r\n//  And in the right order, it could work quite well.\r\n\r\n// It could just put together all of the css strings that get defined.\r\n//  Even include it at the end of basic css?\r\n//   or put it in controls.css\r\n//    That would make sense. All css for all controls compiled into that.\r\n\r\n// Item.sass|scss = ...\r\n\r\n\r\n// Definitely seems like including CSS in the controls will get the whole thing to work better.\r\n//  What about sending / not sending those defs to the client?\r\n//   Some way to remove them in Babel / Browserify / Webpack?\r\n\r\n// Would like them in the files, but not in the versions compiled and sent to the client.\r\n//  A Babel transformer could recompile these files to remove the CSS definitions.\r\n//   The CSS would be sent to the client as normal CSS anyway.\r\n\r\n// Could create a copy of the whole directory structure pre-babel with the code removed?\r\n//  Maybe look more into babel / typescript code removal options.\r\n//  Or could remove all of this post-babel...\r\n//   Would be able to find those pieces of code.\r\n//   Closure compiler?\r\n//    Gets much smaller js size than Uglify it seems.\r\n\r\n// Removing the Class.css assignment statements from compiled js wouldnt be so hard I think.\r\n//  But adds more complexity in the process. Makes programming it easier and less complex though.\r\n\r\n\r\n// Making it so the CSS only applies within the object itsel - just use class names properly.\r\n\r\n// putting it into controls.css makes sense.\r\n// Could check all statements against the statements we have extracted to compile the CSS.\r\n\r\n// Lets try this CSS file for the moment.\r\n//  Seems like an easy way to set up the css that applies to the classes specified in the controls.\r\n\r\n/*\r\nItem.css = `\r\n.item .icon {\r\n    width: 64px;\r\n    height: 64px;\r\n}\r\n`; // Semicolon seems necessary. `;\r\n*/\r\n\r\n\r\nmodule.exports = Item;", "/*\r\n if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n define([\"../../jsgui-html\", \"./item\"],\r\n function(jsgui, Item) {\r\n */\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n//var Item = require('./old/item');\r\n\r\nconst Item = require('./item');\r\n\r\n\r\n// Maybe integrate obext into lang-tools? Or some of it into lang-mini (eventually).\r\n\r\nconst {each} = jsgui;\r\n\r\nconst {prop} = require('lang-tools');\r\n\r\nvar Control = jsgui.Control;\r\nvar Collection = jsgui.Collection;\r\n\r\n// Could be folded. Could show all items.\r\n//  Could show just a view of a range of items in the list.\r\n\r\n// will have a context menu by default\r\n\r\n// Swaps will be useful here.\r\n\r\nconst mx_selectable = require('../../../../../control_mixins/selectable');\r\n\r\n// could use a mixin for active-data\r\n//  it would call an add function.\r\n\r\n// or raise an event called 'next'.\r\n//  .listen(obs)\r\n//  .observe(obs)\r\n\r\n// Do more programming for UI components observing observables.\r\n\r\n// SSR will still produce nice looking lists even when not activated. Unlike Date_Picker when it comes to progressive enhancement?\r\n//   Or even with a full Date_Picker when there is no client-side JS, it could fully render the proper Date_Picker on the server,\r\n//     and then send it back to the client having processed a click.\r\n//   So it could run like old-fashioned websites did with no client-side JS, still have a fancy/specifically styled UI date picker.\r\n//     Could have some system where there are various attributes in the querystring or request body so that the server knows params from the client\r\n//       Like ASP.NET was, slightly.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// This needs to be flexible.\r\n//  May be useful to have a .subscribe or .observe function to listen to an observable.\r\n//   Then create items out of the data that gets produced.\r\n//   Would need to focus on client-side observables.\r\n// Want to be able to give it an array or observable, or object, it renders it.\r\n//  But needs to work with resources and objects that interact with server data.\r\n\r\n// May be worth being able to use this in a Radio_Button_Group....\r\n//   Different possible internal implementations of controls such as List.\r\n//   By default will use the HTML ul, could use ol\r\n\r\n\r\n// Likely to want different ways that lists can be rendered.\r\n\r\n// Needs to be able to respond to the list changing from outside of the Control.\r\n// Could be a list of controls. Possibly using the List class will help make some things clearer, like a list of items on a menu.\r\n\r\n// \r\n\r\n\r\n\r\n\r\nclass List extends Control {\r\n\r\n    // Items collection as a field?\r\n    //  This would have control content items.\r\n    //  It would / may also have a Collection of items.\r\n    //  It would get given its items as JSON / a JS object / array, and then would create the content Controls.\r\n\r\n    // Want it to be easy to create a list, give it the data or the data source.\r\n\r\n    /*\r\n     'fields': [\r\n     //['text', String]\r\n     ['toggle_button', Control],\r\n     ['inner_control', Control],\r\n     ['expander', Control]\r\n     ],\r\n     */\r\n\r\n    constructor(spec, add, make) {\r\n        // Wont fields have been set?\r\n        //console.log('init list');\r\n        super(spec);\r\n        var that = this;\r\n        // Can take an image\r\n        // Can take some text.\r\n        //  That's all I'll have in the tree node for now.\r\n        this.__type_name = 'list';\r\n        //this.dom.attributes.class', 'list');\r\n\r\n        // 'ordered' property. Want it to have change events raised.\r\n        //   probably using 'prop'\r\n\r\n        prop(this, 'ordered', spec.ordered || false);\r\n\r\n\r\n        if (this.ordered) {\r\n            this.dom.tagName = 'ol';\r\n        } else {\r\n            this.dom.tagName = 'ul';\r\n        }\r\n\r\n        \r\n        this.add_class('list');\r\n\r\n        // Should render as a ul.\r\n        //   Could have some code that puts a 'li' around anything added that is not a 'li' (dom.tagName === 'li').\r\n\r\n\r\n        // a Collection of items.\r\n        // Collection not needing a Context?\r\n        //  Having all Data_Objects and Collections require a context seems too much.\r\n        //  Context seems important in the case of Controls.\r\n\r\n        //this.items = new Collection();\r\n\r\n        //this.set('items', coll_items);\r\n        //console.log('spec.items', spec.items);\r\n        //throw 'stop';\r\n\r\n        // Could have items property and listen for item change events.\r\n        //   Preferably that will work server-side too, adding and removing controls as necessary, and then on the client\r\n        //     side those updates will then be updated in the DOM.\r\n\r\n\r\n\r\n        prop(this, 'items', spec.items);\r\n        /*\r\n\r\n        if (spec.items) {\r\n            // is the type a Collection? An Array?\r\n\r\n            //this.items.set(spec.items);\r\n            this.items = spec.items;\r\n        } else {\r\n            this.items = new Collection();\r\n        }\r\n        */\r\n\r\n        // The list spec could also take info about how to display the items.\r\n\r\n        // And create a new item control for each item.\r\n        //  I think an 'item' control could be quite useful. Shows some data.\r\n        //   Won't be too big, but will be flexible in what it can do.\r\n\r\n        // Will take some JSON, and render it using sensible defaults.\r\n        //  Eg name first and in bold.\r\n        //  Maybe key\r\n        //\r\n\r\n        // A general purpose item control will be quite useful.\r\n        //  Item will be fairly general purpose, and much of the purpose of using it is to show intent rather than because of\r\n        //  an 'item' doing particular things. It just is. It will be like a control, except it's generally used for rendering some particular data.\r\n        // Want the Item and the List to be convenient UI components. They need to make it simple to represent some data.\r\n        //  Items and Lists could potentially use templates to quickly render data.\r\n\r\n        // Any need to send the list as a jsgui field?\r\n        // listen for changes to the list. represent those changes in the UI controls. Then these get automatically changed in the DOM by other code.\r\n        // This is where a Collection could help a lot.\r\n        /*\r\n\r\n        this.items.on('change', (evt_change) => {\r\n            //console.log('evt_change', evt_change);\r\n            if (evt_change.type === 'insert') {\r\n                var ctrl_item = new Item({\r\n                    'context': this.context,\r\n                    'value': evt_change.item\r\n                });\r\n\r\n                this.add(ctrl_item);\r\n            }\r\n        });\r\n        */\r\n        // A system to share objects sent to the client by reference.\r\n        //  Could tag an object to send to the client, assign it an id, and then only need to send it once.\r\n        // A system of objects-to-client\r\n        if (!spec.el) {\r\n            //let ss = this.context.new_selection_scope(this);\r\n            //console.log('ss', ss);\r\n            this.compose_list();\r\n        }\r\n        // the selection scope could just be a number on the server.\r\n    }\r\n\r\n    'compose_list' () {\r\n\r\n\r\n        each(this.items, (item, index) => {\r\n            //console.log('item', item);\r\n\r\n\r\n            // Make it a List_Item....?\r\n\r\n\r\n            // Make it a 'li'.\r\n            //  Maybe want more flexibility?\r\n            //    Or take existing item specs, and add the context.\r\n\r\n            // Being able to make controls without specifying the context will help.\r\n            //   Have the context get set as soon as they are added inside another control which has a context.\r\n            //     Can not rely on the IDs of the controls before they have a context.\r\n            //       Maybe could / would need to tighten up some other code so it does not assume or need a context at some points.\r\n            \r\n\r\n\r\n            // Maybe a list-item control will be best.\r\n            //   And could be very basic HTML.\r\n            // May want a simple and quick to write way of specifying the inner controls.\r\n            //   Could make it work specifically on controls that only have one inner section.\r\n\r\n            \r\n\r\n\r\n\r\n\r\n            var ctrl_item = new Item({\r\n                'context': this.context,\r\n                'value': item\r\n            });\r\n\r\n            ctrl_item._fields = ctrl_item._fields || {};\r\n            ctrl_item._fields.index = index;\r\n            \r\n            //console.log('ctrl_item.selectable', ctrl_item.selectable);\r\n            mx_selectable(ctrl_item);\r\n            ctrl_item.selectable = true;\r\n\r\n            this.add(ctrl_item);\r\n        });\r\n    }\r\n\r\n    'activate' () {\r\n        //console.log('');\r\n        //console.log('activate list');\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            each(this.$('item'), item => {\r\n                item.selectable = true;\r\n            })\r\n            let ss = this.find_selection_scope();\r\n            if (ss && ss.on) {\r\n                //console.log('ss', ss);\r\n\r\n                ss.on('change', e_change => {\r\n                    //console.log('1) list ss e_change', e_change);\r\n\r\n                    let item = e_change.value;\r\n                    //console.log('item', item);\r\n\r\n                    this.selected_index = item.index;\r\n\r\n                    this.raise('change', {\r\n                        'name': 'selection',\r\n                        'value': item.index\r\n                    })\r\n                })\r\n            }\r\n        }\r\n\r\n        // Could use delegated click events.\r\n        //  Would save having to wire up each item.\r\n\r\n        // The items themselves could be selectable.\r\n\r\n\r\n        // put the context menu in place.\r\n        //throw 'stop';\r\n\r\n        // Not all lists need context menus.\r\n\r\n        /*\r\n\r\n        this.context_menu({\r\n            'Delete': function() {\r\n                console.log('context_menu Delete');\r\n\r\n                // need to actually delete it if possible?\r\n\r\n            },\r\n            'Edit': function() {\r\n                console.log('context_menu Edit');\r\n                // need to actually delete it if possible?\r\n            }\r\n        });\r\n        */\r\n\r\n        // Need to listen for new items being added.\r\n        //  (Changes being made)\r\n\r\n\r\n\r\n    }\r\n}\r\nmodule.exports = List;", "/*\r\n    May wind up as superclass of Combo_Box\r\n    Maybe will have a massive amount of options and modes.\r\n\r\n    For the moment, want this to handle a relatively small array of items.\r\n*/\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n\r\n//function(jsgui, Plus_Minus_Toggle_Button, Vertical_Expander) {\r\n\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\nconst def = jsgui.is_defined;\r\n\r\n\r\nconst Item_View = require('./item');\r\nconst List = require('./list');\r\n\r\nconst mx_popup = require('../../../../../control_mixins/popup');\r\n\r\n// Post construct compose and activate\r\n//  Want to be able to run same code on client and server.\r\n//  Want code to respond to list changes\r\n\r\n// Definitely want a post compose and activate function.\r\n//  Maybe would need to call it from the constructor.\r\n\r\n// .setup?\r\n//  .finalize?\r\n//  .finish\r\n\r\n// Respond to control changes...\r\n//  Don't just want this on activation, as they are not DOM events, though many would originate there.\r\n\r\n// May be like a list.\r\n\r\n// 2022 - May be unnecessary. Could make better use of mixins such as list and selectable.\r\n\r\n// Does seem worth making some relatively simple examples - though may need jsgui server?\r\n//   Or do more about client-side activation more like jQuery is done...?\r\n\r\n\r\n\r\nclass Item_Selector extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'item_selector';\r\n        super(spec);\r\n        this.add_class('item-selector');\r\n        // selected_index\r\n        // Could have Object assignproperies done here\r\n        //  use local variables as true private variables.\r\n        if (spec.items) {\r\n            this.items = spec.items\r\n        } else {\r\n            this.items = [];\r\n        }\r\n        if (spec.loop) this.loop = spec.loop;\r\n        //console.log('spec.item_index', spec.item_index);\r\n        if (def(spec.item_index)) {\r\n            this.item_index = spec.item_index;\r\n        } else {\r\n            // Don't want to overwrite the item_index if we have set it up already.\r\n            //  May need this pattern more.\r\n            //  Maybe write more setting code.\r\n\r\n            // this.copy_from(spec);\r\n            if (!def(this.item_index)) {\r\n                this.item_index = 0;\r\n            }\r\n        }\r\n        // A loop option.\r\n        if (!spec.el) {\r\n            this.compose_item_selector();\r\n            this.finish_item_selector();\r\n        }\r\n\r\n\r\n    }\r\n    finish_item_selector() {\r\n        this.item_list.on('change', e_change => {\r\n            //console.log('item_list e_change', e_change);\r\n            if (e_change.name === 'selection') {\r\n                let selected_index = e_change.value;\r\n                this.item_index = selected_index;\r\n                this.current_item_view.item = this.items[selected_index];\r\n\r\n                this.raise('change', {\r\n                    'name': 'value',\r\n                    'value': this.items[selected_index],\r\n                    'index': selected_index\r\n                });\r\n\r\n                this.value = this.items[selected_index];\r\n\r\n\r\n\r\n                setTimeout(() => {\r\n                    this.item_list.hide();\r\n                }, 120);\r\n            }\r\n        });\r\n    }\r\n    compose_item_selector() {\r\n        // In combo mode normally.\r\n        // current_item\r\n        // item_list\r\n\r\n        let current_item_view = this.current_item_view = new Item_View({\r\n            context: this.context,\r\n            item: this.items[this.item_index]\r\n        });\r\n        this.add(current_item_view);\r\n\r\n        //console.log('compose_item_selector this.items', this.items);\r\n\r\n        let item_list = this.item_list = new List({\r\n            context: this.context,\r\n            items: this.items\r\n        });\r\n        item_list.hide();\r\n        item_list.add_class('item-selector'); // So styling works right in the popup layer.\r\n        mx_popup(item_list);\r\n\r\n        this.add(item_list);\r\n\r\n        // Render all of the items in a list.\r\n        //  Grid of some kind depending on if horizontal or vertical\r\n        //  \r\n\r\n        // Items hidden in a list, the rest of the items in the list hidden?\r\n        //  Specific copy of the item that gets shown, also be able to show item list.\r\n\r\n        // Just show it in a list anyway.\r\n\r\n        // Go for both single item with neighbours on tiles.\r\n        //  Also all items rendered in a list / sequence.\r\n\r\n        // Item_List with direction: horizontal would work well.\r\n\r\n        // Item_View\r\n        //  And Tile_Slide processed item view.\r\n\r\n        // Want a very simple Item_View that renders the string item as a span, in an item view control marked with classes in the DOM.\r\n        //  Want Item_View with no expand/contract.\r\n        // Depending on the type of items...?\r\n        this._fields = this._fields || {};\r\n        this._fields.item_index = this.item_index;\r\n        this._fields.items = this.items;\r\n        if (this.loop) this._fields.loop = this.loop;\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n        this._ctrl_fields.current_item_view = current_item_view;\r\n        this._ctrl_fields.item_list = item_list;\r\n    }\r\n    previous(raise_event = true) {\r\n        //console.log('this.item_index', this.item_index);\r\n        let o_change;\r\n        if (this.item_index > 0) {\r\n            this.item_index--;\r\n            this.current_item_view.item = this.items[this.item_index];\r\n            if (raise_event) {\r\n                o_change = {\r\n                    value: this.items[this.item_index],\r\n                    index: this.item_index,\r\n                    size: -1\r\n                }\r\n            }\r\n        } else {\r\n            if (this.loop) {\r\n                this.item_index = this.items.length - 1;\r\n                this.current_item_view.item = this.items[this.item_index];\r\n                if (raise_event) {\r\n                    this.raise('loop', -1);\r\n                    o_change = {\r\n                        value: this.items[this.item_index],\r\n                        loop: -1,\r\n                        index: this.item_index,\r\n                        size: -1\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n        if (o_change) {\r\n            if (this.item_index === 0) {\r\n                o_change.first = true;\r\n            }\r\n            if (this.item_index === this.items.length - 1) {\r\n                o_change.last = true;\r\n            }\r\n            this.raise('change', o_change);\r\n        }\r\n    }\r\n    next(raise_event = true) {\r\n        //console.log('this.item_index', this.item_index);\r\n        let old_index = this.item_index;\r\n        let old = this.items[this.item_index];\r\n        let o_change;\r\n        if (this.item_index < this.items.length - 1) {\r\n            this.item_index++;\r\n            this.current_item_view.item = this.items[this.item_index];\r\n            if (raise_event) {\r\n                o_change = {\r\n                    value: this.items[this.item_index],\r\n                    index: this.item_index,\r\n                    size: 1\r\n                };\r\n            }\r\n        } else {\r\n            if (this.loop) {\r\n                this.item_index = 0;\r\n                this.current_item_view.item = this.items[this.item_index];\r\n                if (raise_event) {\r\n                    this.raise('loop', 1);\r\n                    o_change = {\r\n                        value: this.items[this.item_index],\r\n                        loop: 1,\r\n                        index: this.item_index,\r\n                        size: 1\r\n                    };\r\n                    //if (this.item_index === this.items.length - 1) {\r\n                    //    o_change.first = true;\r\n                    //}\r\n                }\r\n            }\r\n        }\r\n        if (o_change) {\r\n            if (this.item_index === 0) {\r\n                o_change.first = true;\r\n            }\r\n            if (this.item_index === this.items.length - 1) {\r\n                o_change.last = true;\r\n            }\r\n            this.raise('change', o_change);\r\n        }\r\n        //console.log('this.items', this.items);\r\n        // Then the item view needs to respond to the item change.\r\n    }\r\n    activate() {\r\n        let ctrl = this;\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            let item_list = this.item_list;\r\n            mx_popup(item_list);\r\n            // touchstart - bring up the list\r\n\r\n            let has_moved_away = false;\r\n            let t = false;\r\n\r\n            /*\r\n            this.item_list.on('change', e_change => {\r\n                console.log('item_list e_change', e_change);\r\n            })\r\n            */\r\n\r\n            this.on('touchstart', ets => {\r\n                //console.log('ets', ets);\r\n                // Then cancel the event.\r\n                t = true;\r\n\r\n                item_list.popup();\r\n\r\n                //console.log('Object.keys(ets)', Object.keys(ets));\r\n                // Returning false from such a DOM event should cancel the event propagation.\r\n\r\n                ets.preventDefault();\r\n                //return false;\r\n            })\r\n            this.on('touchend', ete => {\r\n                //console.log('ete', ete);\r\n\r\n                if (!has_moved_away) {\r\n                    //this.raise('click', ete);\r\n                }\r\n                has_moved_away = false;\r\n                item_list.hide();\r\n            })\r\n            this.on('touchmove', etm => {\r\n                has_moved_away = true;\r\n                //console.log('etm', etm);\r\n            });\r\n            this.on('click', ec => {\r\n                //item_list.show();\r\n\r\n                if (!t) {\r\n                    let replace = item_list.popup();\r\n                    // Event propagation has stopped? :(\r\n\r\n                    // then click elsewhere...\r\n\r\n                    // best done with body event (delegation)\r\n\r\n                    let body = this.context.map_controls['body_0'];\r\n\r\n                    let body_click_handler = (e_click) => {\r\n                        //console.log('e_click', e_click);\r\n\r\n                        let target_ctrl = this.context.map_controls[e_click.target.getAttribute('data-jsgui-id')];\r\n                        //console.log('target_ctrl', target_ctrl);\r\n\r\n                        //let anc = item_list.ancestor(e_click.ctrl);\r\n                        let anc = target_ctrl.ancestor(item_list);\r\n                        //console.log('anc', anc);\r\n\r\n                        if (anc) {\r\n                            // Select that item.\r\n\r\n\r\n                        } else {\r\n                            body.off('click', body_click_handler);\r\n                            replace();\r\n                        }\r\n                    }\r\n                    setTimeout(() => {\r\n                        body.on('click', body_click_handler);\r\n                    }, 0);\r\n                }\r\n            });\r\n            this.finish_item_selector();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Item_Selector;", "const jsgui = require('../../../../html-core/html-core');\r\nconst Control = jsgui.Control;\r\nconst def = jsgui.is_defined;\r\nconst Arrow_Button = require('../../0-core/1-advanced/vector/arrow-button');\r\n\r\n\r\nconst Item_Selector = require('../../0-core/0-basic/1-compositional/item-selector');\r\n// Maybe give Item_Selector a more specific name, or involk it in terms of more explicit behaviours?\r\n\r\n/*\r\n\r\n    Encapsulates an array with a range of possible values.\r\n    // Maybe a number of years.\r\n\r\n    // Basically just chooses an index within the array, and can get a value for the item in the array too.\r\n\r\n    // Could be used for picking a year, or months within a year.\r\n\r\n    // Events responding to the UI events and changes there.\r\n    //  Does its internal processing, raises external event when event occurs.\r\n\r\n    // Tile_Slide_Panel could be useful here, and with Month_View\r\n    //  With Month_View, would have entire month views rendered already for previous and next months.\r\n\r\n    // Possibility of Tile_Slide_Panel being something that would hack into another control?\r\n\r\n    // Want it so that a control can be wrapped automatically in a Title_Slide_Panel, so adjacent controls also get constructed.\r\n\r\n    // Still want the Month_View to be fairly simple.\r\n    //  Month_View is a place where its worth implementing Tile_Slide or Tile_Slide_Panel.\r\n\r\n    // This will be good for choosing months and years.\r\n\r\n    // Will be able to operate with tile sliding too.\r\n    //  Tile sliding on mobile especially.\r\n\r\n\r\n    // Could use Tile_Slider with next and previous.\r\n\r\n\r\n    // Could tile slide towards a control that shows the month name\r\n\r\n\r\n    // Having a very nice month selector with arrows\r\n    // Then also a very nice year selector\r\n    \r\n    //  These could be micro Controls.\r\n    //   Worth making into a Control, a grouping of controls.\r\n\r\n\r\n\r\n    //   such as a year picker\r\n    //    all it does is allow picking of a year in a user friendly way. Won't be very obvious, but will be a component of Date_Picker.\r\n    // ./micro-date\r\n\r\n\r\n    Arrow\r\n    [Box with value] - Something like a Select box\r\n    // \r\n\r\n    Item_Selector\r\n     // Can deal with previous and next\r\n     //  Directional sliding\r\n     //  Choose the direction\r\n     //   Are all items rendered to begin with?\r\n     //    Less than 100 then this would work nicely.\r\n     //   Optional delayed_item_rendering\r\n     //    Those in view\r\n     //     Those that may be brought into the view soon.\r\n     //   Could have a buffer of active / live controls.\r\n\r\n     // Possibly Item_Selector could be enabled to set up Tile_Slider based on internal controls, and functional involkation of them\r\n\r\n    Arrow\r\n\r\n\r\n*/\r\n\r\n// Item_Selector interface?\r\n//  By passing on Item_Selector \r\n\r\n// An item picker?\r\n//  Abstract away the left and right arrows somehow?\r\n\r\n// Indexed_Item_Picker?\r\n\r\n\r\n\r\nclass Left_Right_Arrows_Selector extends Control {\r\n    constructor (spec) {\r\n\r\n        //console.log('');\r\n        //console.log('Left_Right_Arrows_Selector spec', spec);\r\n\r\n        spec.__type_name = spec.__type_name || 'left_right_arrows_selector';\r\n        super(spec);\r\n        this.add_class('left-right');\r\n        this.add_class('arrows-selector');\r\n\r\n        if (spec.items) {\r\n            this.items = spec.items;\r\n        }\r\n        if (def(spec.item_index)) {\r\n            this.item_index = spec.item_index;\r\n        }\r\n        if (def(spec.loop)) {\r\n            this.loop = spec.loop;\r\n        }\r\n        if (!spec.el) {\r\n            this.compose_lras();\r\n        }\r\n    }\r\n    compose_lras() {\r\n\r\n        // left, item, right\r\n        let context = this.context;\r\n        let left_arrow = new Arrow_Button({\r\n            context: context,\r\n            direction: 'left'\r\n        });\r\n\r\n        let is_spec = {\r\n            context: context\r\n        }\r\n        if (this.items) is_spec.items = this.items; \r\n        if (this.item_index) is_spec.item_index = this.item_index;\r\n        if (this.loop) is_spec.loop = this.loop; \r\n\r\n        // Should be able to parse these from an HTML-like document.\r\n\r\n        let item_selector = new Item_Selector(is_spec);\r\n\r\n        let right_arrow = new Arrow_Button({\r\n            context: context,\r\n            direction: 'right'\r\n        });\r\n\r\n        this.add(left_arrow);\r\n        this.add(item_selector);\r\n        this.add(right_arrow);\r\n\r\n        this._fields = this._fields || {};\r\n        if (this.items) this._fields.items = this.items;\r\n        if (def(this.item_index)) this._fields.item_index = this.item_index;\r\n        if (def(this.loop)) this._fields.loop = this.loop;\r\n\r\n        this._ctrl_fields = {\r\n            left_arrow: left_arrow,\r\n            item_selector: item_selector,\r\n            right_arrow: right_arrow\r\n        }\r\n    }\r\n\r\n    previous(raise_event = true) {\r\n        this.item_selector.previous(raise_event);\r\n\r\n    }\r\n    next(raise_event = true) {\r\n        this.item_selector.next(raise_event);\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            // Automatically disable arrow if we reach the first while not in loop mode.\r\n\r\n            //console.log('Activate Left_Right_Arrows_Selector');\r\n            let {left_arrow, item_selector, right_arrow} = this;\r\n\r\n\r\n            // on({subcontrol names, event names})\r\n            //  a different mechanism for 'on'?\r\n\r\n\r\n            left_arrow.on('click', e_click => {\r\n                //console.log('left_arrow e_click',e_click);\r\n                this.previous();\r\n            });\r\n            item_selector.on('change', e_change => {\r\n                //console.log('item_selector e_change', e_change);\r\n\r\n                if (!this.loop) {\r\n                    if (e_change.first) {\r\n                        left_arrow.disabled = true;\r\n                    } else {\r\n                        left_arrow.disabled = false;\r\n                    }\r\n                    if (e_change.last) {\r\n                        right_arrow.disabled = true;\r\n                    } else {\r\n                        right_arrow.disabled = false;\r\n                    }\r\n                }\r\n                this.raise('change', e_change);\r\n            });\r\n            right_arrow.on('click', e_click => {\r\n                //console.log('right_arrow e_click',e_click);\r\n                this.next();\r\n            });\r\n\r\n            if (this.loop) {\r\n                item_selector.on('loop', loop_direction => {\r\n                    //console.log('loop_direction', loop_direction);\r\n                    this.raise('loop', loop_direction);\r\n                })\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n// Needs to select from an array of items.\r\n//  Can loop (optional)\r\n\r\n// Internally can use a tile_slide\r\n\r\n\r\nmodule.exports = Left_Right_Arrows_Selector;\r\n\r\n", "// Copyright James Vickers 2016, james@metabench.com\r\n\r\nvar jsgui = require('../../../../html-core/html-core');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, extend = jsgui.extend;\r\nvar Control = jsgui.Control;\r\nvar Collection = jsgui.Collection;\r\n\r\n\r\n// Could have the range as a field.\r\n//  A 2d range may be a useful type for this.\r\n\r\n\r\n// Making various things into fields that get sent to the client?\r\n\r\n/*\r\n 'fields': {\r\n //'num_days': Number\r\n 'range': Array,\r\n 'vert_margin': Number,\r\n 'left_margin': Number,\r\n 'right_margin': Number,\r\n 'axis_thickness': Number,\r\n 'x_major_notch_spacing': Number,\r\n 'y_major_notch_spacing': Number,\r\n 'x_minor_notch_spacing': Number,\r\n 'y_minor_notch_spacing': Number,\r\n 'suppress_0_axes_labels': Boolean,\r\n\r\n // For internal use\r\n 'x_origin': Number,\r\n 'y_origin': Number\r\n },\r\n */\r\n\r\nclass Line_Chart extends Control {\r\n\r\n    constructor(spec) {\r\n        super(spec);\r\n        this.__type_name = 'line_chart';\r\n\r\n        // Specify num_days\r\n\r\n        // Will have y axis down the left.\r\n        // Will have x axis down the middle\r\n        if (!spec.abstract && !spec.el) {\r\n\r\n            this.add_class('line-chart no-select');\r\n\r\n            var vert_margin = 10;\r\n            var left_margin = 80;\r\n            var right_margin = 24;\r\n            var axis_thickness = 2;\r\n\r\n            var x_major_notch_spacing = spec.x_major_notch_spacing || spec.major_notch_spacing || 50;\r\n            var y_major_notch_spacing = spec.y_major_notch_spacing || spec.major_notch_spacing || 50;\r\n\r\n            var x_minor_notch_spacing = spec.x_minor_notch_spacing || spec.major_minor_spacing || 10;\r\n            var y_minor_notch_spacing = spec.y_minor_notch_spacing || spec.major_minor_spacing || 10;\r\n\r\n            var suppress_0_axes_labels = true;\r\n\r\n            this.set({\r\n                'vert_margin': vert_margin,\r\n                'left_margin': left_margin,\r\n                'right_margin': right_margin,\r\n                'axis_thickness': axis_thickness,\r\n                'x_major_notch_spacing': x_major_notch_spacing,\r\n                'y_major_notch_spacing': y_major_notch_spacing,\r\n                'x_minor_notch_spacing': x_minor_notch_spacing,\r\n                'y_minor_notch_spacing': y_minor_notch_spacing,\r\n                'suppress_0_axes_labels': suppress_0_axes_labels\r\n            });\r\n            this.add_full_axes();\r\n        }\r\n\r\n        // When it's rendered on the server, we don't know quite how much space the chart will need.\r\n        //  Still, server side rendering and client side activation fits the general pattern.\r\n\r\n\r\n\r\n\r\n        // number of units on x axis\r\n        // x min y min\r\n\r\n        // range could be given as [[0, 0,], [20, 20]];\r\n        //  could assume origin [0, 0] if it's not given.\r\n\r\n        var num_days = this.get('num_days');\r\n\r\n        if (typeof window == 'undefined') {\r\n            // For sending the fields to the client.\r\n\r\n            extend(this._fields = this._fields || {}, {\r\n                'vert_margin': vert_margin,\r\n                'left_margin': left_margin,\r\n                'right_margin': right_margin,\r\n                'axis_thickness': axis_thickness,\r\n                'x_major_notch_spacing': x_major_notch_spacing,\r\n                'y_major_notch_spacing': y_major_notch_spacing,\r\n                'x_minor_notch_spacing': x_minor_notch_spacing,\r\n                'y_minor_notch_spacing': y_minor_notch_spacing,\r\n                'suppress_0_axes_labels': suppress_0_axes_labels,\r\n                'range': this.get('range').value(),\r\n                'x_origin': this.get('x_origin').value(),\r\n                'y_origin': this.get('y_origin').value()\r\n            });\r\n        }\r\n    }\r\n\r\n    'add_full_axes'() {\r\n\r\n        var vert_margin = this.get('vert_margin');\r\n        var left_margin = this.get('left_margin');\r\n        var right_margin = this.get('right_margin');\r\n        var axis_thickness = this.get('axis_thickness');\r\n        var x_major_notch_spacing = this.get('x_major_notch_spacing');\r\n        var y_major_notch_spacing = this.get('y_major_notch_spacing');\r\n        var x_minor_notch_spacing = this.get('x_minor_notch_spacing');\r\n        var y_minor_notch_spacing = this.get('y_minor_notch_spacing');\r\n        var suppress_0_axes_labels = this.get('suppress_0_axes_labels');\r\n\r\n\r\n\r\n\r\n        var size = this.get('size').value();\r\n        //console.log('size', size);\r\n\r\n\r\n        var w = size[0][0];\r\n        var h = size[1][0];\r\n\r\n        var range = this.get('range').value();\r\n\r\n        console.log('range', range);\r\n\r\n        var y_axis_x, x_axis_y;\r\n\r\n        var x_min = range[0][0], y_min = range[0][1], x_max = range[1][0], y_max = range[1][1];\r\n\r\n        // Want to show the Y axis at the origin if possible.\r\n\r\n        // Is the x point 0 within the grid? if so, show the y axis at that position.\r\n\r\n        var x_range = x_max - x_min, y_range = y_max - y_min;\r\n        //console.log('x_min', x_min);\r\n        //console.log('x_max', x_max);\r\n\r\n\r\n        var y_axis_is_at_origin = x_min <= 0 && x_max >= 0;\r\n        var x_axis_is_at_origin = y_min <= 0 && y_max >= 0;\r\n\r\n        // Position of chart_left, position of chart_right\r\n\r\n        var x_axis_left = left_margin;\r\n        var x_axis_right = w - right_margin;\r\n        var y_axis_top = vert_margin;\r\n        var y_axis_bottom = h - vert_margin;\r\n\r\n        var x_chart_distance = x_axis_right - x_axis_left;\r\n        var y_chart_distance = y_axis_bottom - y_axis_top;\r\n\r\n        var x_axis_length = w - left_margin - right_margin;\r\n        var y_axis_length = h - (2 * vert_margin);\r\n\r\n        var x_scale = x_range / x_axis_length;\r\n        var y_scale = y_range / y_axis_length;\r\n\r\n        // would be good to have the origin position.\r\n\r\n        var x_origin, y_origin;\r\n\r\n\r\n        var values_from_pixel_location = function(px_loc) {\r\n            var vect_from_origin = [px_loc[0] - x_origin, px_loc[1] - y_origin];\r\n            //console.log('vect_from_origin', vect_from_origin);\r\n            // and then the values, obtained by scaling.\r\n\r\n            var res = [Math.round(vect_from_origin[0] * x_scale), Math.round(vect_from_origin[1] * y_scale * -1)];\r\n            return res;\r\n\r\n\r\n        };\r\n\r\n        var pixel_location_from_values = function(values) {\r\n            var res = [Math.round(origin[0] + values[0] * 1 / x_scale), Math.round(origin[1] + values[1] * -1 / y_scale)];\r\n            return res;\r\n        };\r\n\r\n        var x_location_from_value = function(x_value) {\r\n            return Math.round(x_origin + x_value * 1 / x_scale)\r\n        };\r\n        var y_location_from_value = function(y_value) {\r\n            return Math.round(y_origin + y_value * -1 / y_scale)\r\n        };\r\n\r\n        //console.log('tof range', tof(range));\r\n        //console.log('range', range);\r\n\r\n        var svg = new Control({\r\n            'context': this.context,\r\n            'tag_name': 'svg'\r\n        });\r\n\r\n        svg.set('dom.attributes', {\r\n            'width': w,\r\n            'height': h,\r\n            'viewPort': '0 0 ' + w + ' ' + h,\r\n            'version': '1.1',\r\n            'xmlns': 'http://www.w3.org/2000/svg'\r\n        });\r\n\r\n        this.add(svg);\r\n        this.set('svg', svg);\r\n\r\n        if (y_axis_is_at_origin) {\r\n            // Proportion to the right of the origin, proportion to the left of the origin.\r\n\r\n            //x_range - x_min;\r\n            //onsole.log('x_range + x_min', x_range + x_min);\r\n\r\n            var prop_through = (-1 * x_min) / x_range;\r\n            var distance_through = x_chart_distance * prop_through;\r\n\r\n            //console.log('pos', prop_through);\r\n\r\n            x_origin = x_axis_left + distance_through;\r\n\r\n\r\n            y_axis_x = x_origin;\r\n\r\n        } else {\r\n            // Draw it on the left\r\n            throw 'stop';\r\n        }\r\n\r\n        if (x_axis_is_at_origin) {\r\n            // Proportion to the right of the origin, proportion to the left of the origin.\r\n\r\n            //x_range - x_min;\r\n            //onsole.log('x_range + x_min', x_range + x_min);\r\n\r\n            var prop_through = (-1 * y_min) / y_range;\r\n            //console.log('prop_through', prop_through);\r\n            var distance_through = y_chart_distance * prop_through;\r\n            //console.log('distance_through', distance_through);\r\n\r\n\r\n\r\n            //console.log('pos', prop_through);\r\n\r\n            y_origin = y_axis_bottom - distance_through;\r\n            x_axis_y = y_origin;\r\n\r\n        } else {\r\n            // Draw it on the left\r\n            throw 'stop';\r\n        }\r\n\r\n        this.x_origin = x_origin;\r\n        this.y_origin = y_origin;\r\n\r\n        // Not necessarily going from the origin.\r\n        //  Also want to have server-side rendering, client-side activation.\r\n\r\n        //var origin = [left_margin - 1, (h - axis_thickness) / 2];\r\n\r\n        //console.log('y_axis_x', y_axis_x);\r\n\r\n        var y_axis_top = vert_margin;\r\n        var y_axis_bottom = h - vert_margin;\r\n\r\n        var add_y_axis_line = function() {\r\n\r\n            var y_axis = new Control({\r\n                'context': this.context,\r\n                'tag_name': 'line'\r\n            });\r\n\r\n            y_axis.set('dom.attributes', {\r\n                'width': 10,\r\n                'height': h,\r\n                'x1': y_axis_x,\r\n                'y1': y_axis_top,\r\n                'x2': y_axis_x,\r\n                'y2': y_axis_bottom,\r\n                'stroke': '#000000',\r\n                'stroke-width': 2\r\n            });\r\n\r\n            svg.add(y_axis);\r\n        };\r\n\r\n        var add_x_axis_line = function() {\r\n            var x_axis = new Control({\r\n                'context': this.context,\r\n                'tag_name': 'line'\r\n            });\r\n\r\n            x_axis.set('dom.attributes', {\r\n                'width': 10,\r\n                'height': h,\r\n                'x1': x_axis_left,\r\n                'y1': x_axis_y,\r\n                'x2': x_axis_right,\r\n                'y2': x_axis_y,\r\n                'stroke': '#000000',\r\n                'stroke-width': 2\r\n            });\r\n\r\n            svg.add(x_axis);\r\n        };\r\n\r\n        var add_x_notch_group = function(spacing, height) {\r\n            //console.log('x_min', x_min);\r\n            //console.log('spacing', spacing);\r\n            var num_notches_left_of_origin = Math.floor((x_min * -1) / spacing);\r\n            var num_notches_right_of_origin = Math.floor(x_max / spacing);\r\n            var first_notch_x_value = num_notches_left_of_origin * spacing * -1;\r\n            // then we repeat through the range...\r\n            var notch_x_value = first_notch_x_value;\r\n            // Need functions to convert between logical grid and screen coords.\r\n            while (notch_x_value <= x_max) {\r\n\r\n                // then need to get the x pixel value using a function\r\n\r\n                var x_notch = new Control({\r\n                    'context': this.context,\r\n                    'tag_name': 'line'\r\n                });\r\n\r\n                var x_location = x_location_from_value(notch_x_value);\r\n\r\n                // calculate the notch x position.\r\n\r\n                x_notch.set('dom.attributes', {\r\n                    'width': 2,\r\n                    'height': height,\r\n                    'x1': x_location,\r\n                    'y1': y_origin,\r\n                    'x2': x_location,\r\n                    'y2': y_origin + height,\r\n                    'stroke': '#AAAAAA',\r\n                    'stroke-width': 2\r\n                    //'xmlns': 'http://www.w3.org/2000/svg',\r\n                    //'version': '1.1'\r\n                });\r\n\r\n                svg.add(x_notch);\r\n\r\n                notch_x_value += spacing;\r\n            }\r\n        }\r\n\r\n        var add_x_label_group = function(spacing) {\r\n            var num_notches_left_of_origin = Math.floor((x_min * -1) / spacing);\r\n            var num_notches_right_of_origin = Math.floor(x_max / spacing);\r\n            var first_notch_x_value = num_notches_left_of_origin * spacing * -1;\r\n            // then we repeat through the range...\r\n            var notch_x_value = first_notch_x_value;\r\n            // Need functions to convert between logical grid and screen coords.\r\n\r\n            while (notch_x_value <= x_max) {\r\n\r\n                // then need to get the x pixel value using a function\r\n\r\n                if (!(suppress_0_axes_labels && notch_x_value === 0)) {\r\n                    var x_location = x_location_from_value(notch_x_value);\r\n                    var x_notch_label = new Control({\r\n                        'context': this.context,\r\n                        'tag_name': 'text'\r\n                    });\r\n                    x_notch_label.set('dom.attributes', {\r\n                        'x': x_location - 4,\r\n                        'y': y_origin + 28,\r\n                        'font-family': 'Verdana',\r\n                        'font-size': 14\r\n                    });\r\n                    x_notch_label.add(notch_x_value + '');\r\n                    svg.add(x_notch_label);\r\n                }\r\n                notch_x_value += spacing;\r\n            }\r\n        }\r\n        var add_y_label_group = function(spacing) {\r\n            var num_notches_below_origin = Math.floor((y_min * -1) / spacing);\r\n            var num_notches_above_origin = Math.floor(y_max / spacing);\r\n\r\n            var first_notch_y_value = num_notches_below_origin * spacing * -1;\r\n\r\n            // then we repeat through the range...\r\n\r\n            var notch_y_value = first_notch_y_value;\r\n\r\n            // Need functions to convert between logical grid and screen coords.\r\n\r\n            while (notch_y_value <= y_max) {\r\n\r\n                // then need to get the x pixel value using a function\r\n\r\n                if (!(suppress_0_axes_labels && notch_y_value === 0)) {\r\n\r\n                    var y_notch = new Control({\r\n                        'context': this.context,\r\n                        'tag_name': 'line'\r\n                    });\r\n\r\n                    var y_location = y_location_from_value(notch_y_value);\r\n\r\n                    var y_notch_label = new Control({\r\n                        'context': this.context,\r\n                        'tag_name': 'text'\r\n                    });\r\n\r\n                    y_notch_label.set('dom.attributes', {\r\n                        'x': x_origin - 48,\r\n                        'y': y_location + 6,\r\n                        'font-family': 'Verdana',\r\n                        'font-size': 14\r\n                    });\r\n                    y_notch_label.add(notch_y_value + '');\r\n\r\n                    svg.add(y_notch_label);\r\n                }\r\n                notch_y_value += spacing;\r\n            }\r\n        }\r\n\r\n        var add_y_notch_group = function(spacing, length) {\r\n            //console.log('x_min', x_min);\r\n            //console.log('spacing', spacing);\r\n            var num_notches_below_origin = Math.floor((y_min * -1) / spacing);\r\n\r\n\r\n            var num_notches_above_origin = Math.floor(y_max / spacing);\r\n\r\n            var first_notch_y_value = num_notches_below_origin * spacing * -1;\r\n\r\n            // then we repeat through the range...\r\n\r\n            var notch_y_value = first_notch_y_value;\r\n\r\n            // Need functions to convert between logical grid and screen coords.\r\n\r\n            while (notch_y_value <= y_max) {\r\n\r\n                // then need to get the x pixel value using a function\r\n\r\n                var y_notch = new Control({\r\n                    'context': this.context,\r\n                    'tag_name': 'line'\r\n                });\r\n\r\n                var y_location = y_location_from_value(notch_y_value);\r\n\r\n                y_notch.set('dom.attributes', {\r\n                    'width': length,\r\n                    'height': 2,\r\n                    'x1': x_origin - length,\r\n                    'y1': y_location,\r\n                    'x2': x_origin,\r\n                    'y2': y_location,\r\n                    'stroke': '#AAAAAA',\r\n                    'stroke-width': 2\r\n                    //'xmlns': 'http://www.w3.org/2000/svg',\r\n                    //'version': '1.1'\r\n                });\r\n\r\n                svg.add(y_notch);\r\n\r\n                notch_y_value += spacing;\r\n            }\r\n        }\r\n\r\n\r\n        var add_x_axis_major_notches = function() {\r\n            // x_major_notch_spacing\r\n\r\n            // paint notches from origin (if origin is shown)\r\n\r\n            // Or paint them from one side, in sync with the origin.\r\n\r\n            // Painting both ways from origin makes sense logically.\r\n            //  Partial adding / painting would work.\r\n\r\n            // Really is best to work out the range of values, that will go through the origin if necessary.\r\n\r\n            //var num_notches_left_of_origin = Math.floor((x_min * -1) / x_major_notch_spacing);\r\n            add_x_notch_group(x_major_notch_spacing, 20);\r\n\r\n        }\r\n\r\n        var add_x_axis_minor_notches = function() {\r\n            // x_major_notch_spacing\r\n\r\n            // paint notches from origin (if origin is shown)\r\n\r\n            // Or paint them from one side, in sync with the origin.\r\n\r\n            // Painting both ways from origin makes sense logically.\r\n            //  Partial adding / painting would work.\r\n\r\n            // Really is best to work out the range of values, that will go through the origin if necessary.\r\n\r\n            //var num_notches_left_of_origin = Math.floor((x_min * -1) / x_major_notch_spacing);\r\n            //console.log('x_minor_notch_spacing', x_minor_notch_spacing);\r\n            add_x_notch_group(x_minor_notch_spacing, 10);\r\n\r\n        }\r\n\r\n        var add_origin_label = function() {\r\n            var origin_label = new Control({\r\n                'context': this.context,\r\n                'tag_name': 'text'\r\n            });\r\n\r\n            origin_label.set('dom.attributes', {\r\n                'x': x_origin - 14,\r\n                'y': y_origin + 14,\r\n                'font-family': 'Verdana',\r\n                'font-size': 14//,\r\n                //'xmlns': 'http://www.w3.org/2000/svg',\r\n                //'version': '1.1'\r\n            });\r\n\r\n            origin_label.add('0');\r\n\r\n            svg.add(origin_label);\r\n        }\r\n\r\n        var add_y_axis_major_notches = function() {\r\n            add_y_notch_group(y_major_notch_spacing, 20);\r\n        }\r\n\r\n        var add_y_axis_minor_notches = function() {\r\n            console.log('x_minor_notch_spacing', y_minor_notch_spacing);\r\n            add_y_notch_group(y_minor_notch_spacing, 10);\r\n\r\n        }\r\n\r\n        var add_major_x_axis_labels = function() {\r\n            add_x_label_group(x_major_notch_spacing);\r\n        }\r\n        var add_major_y_axis_labels = function() {\r\n            add_y_label_group(y_major_notch_spacing);\r\n        }\r\n\r\n        var add_major_axes_labels = function() {\r\n            add_major_x_axis_labels();\r\n            add_major_y_axis_labels();\r\n        }\r\n\r\n        add_x_axis_minor_notches();\r\n        add_x_axis_major_notches();\r\n\r\n        add_y_axis_minor_notches();\r\n        add_y_axis_major_notches();\r\n\r\n        add_x_axis_line();\r\n        add_y_axis_line();\r\n\r\n        add_major_axes_labels();\r\n        add_origin_label();\r\n    }\r\n\r\n    'render_axes'() {\r\n\r\n    }\r\n\r\n    'values_from_pixel_location'(px_loc) {\r\n        var el = this.dom.el;\r\n        var w = el.clientWidth;\r\n        var h = el.clientHeight;\r\n        var x_origin = this.x_origin;\r\n        var y_origin = this.y_origin;\r\n        var vert_margin = this.vert_margin;\r\n        var left_margin = this.left_margin;\r\n        var right_margin = this.right_margin;\r\n        var x_axis_length = w - left_margin - right_margin;\r\n        var y_axis_length = h - (2 * vert_margin);\r\n        var range = this.range;\r\n        var x_min = range[0][0], y_min = range[0][1], x_max = range[1][0], y_max = range[1][1];\r\n        var x_range = x_max - x_min, y_range = y_max - y_min;\r\n        var x_scale = x_range / x_axis_length;\r\n        var y_scale = y_range / y_axis_length;\r\n        var vect_from_origin = [px_loc[0] - x_origin, px_loc[1] - y_origin];\r\n        //console.log('vect_from_origin', vect_from_origin);\r\n        // and then the values, obtained by scaling.\r\n\r\n        var res = [Math.round(vect_from_origin[0] * x_scale), Math.round(vect_from_origin[1] * y_scale * -1)];\r\n        return res;\r\n    }\r\n    'pixel_location_from_values'(values) {\r\n        var el = this.dom.el;\r\n        var w, h;\r\n        if (el) {\r\n            w = el.clientWidth;\r\n            h = el.clientHeight;\r\n        } else {\r\n            var size = this.size();\r\n            //console.log('size', size);\r\n            //throw 'stop';\r\n            w = size._[0][0];\r\n            h = size._[1][0];\r\n        }\r\n        // and if we don't have the element?\r\n\r\n\r\n        var x_origin = this.x_origin;\r\n        var y_origin = this.y_origin;\r\n        var vert_margin = this.vert_margin;\r\n        var left_margin = this.left_margin;\r\n        var right_margin = this.right_margin;\r\n        var x_axis_length = w - left_margin - right_margin;\r\n        var y_axis_length = h - (2 * vert_margin);\r\n        var range = this.range;\r\n\r\n        //console.log('vert_margin', vert_margin);\r\n        //console.log('y_axis_length', y_axis_length);\r\n\r\n        var x_min = range[0][0], y_min = range[0][1], x_max = range[1][0], y_max = range[1][1];\r\n        var x_range = x_max - x_min, y_range = y_max - y_min;\r\n        var x_scale = x_range / x_axis_length;\r\n        var y_scale = y_range / y_axis_length;\r\n\r\n        //console.log('values', values);\r\n        //console.log('y_scale', y_scale);\r\n        //console.log('y_origin', y_origin);\r\n        //console.log('values', values);\r\n\r\n        var res = [Math.round(x_origin + values[0] * 1 / x_scale), Math.round(y_origin + values[1] * -1 / y_scale)];\r\n        return res;\r\n    }\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            var that = this;\r\n            //console.log('this', this);\r\n            //throw 'stop';\r\n            //var retrieved_el = this.dom.el;\r\n            //console.log('!!retrieved_el', !!retrieved_el);\r\n            //console.log('retrieved_el', retrieved_el);\r\n            var el = this.dom.el;\r\n            //throw 'stop';\r\n            // But want a better way to get the size.\r\n            //  Want a standard, encapsulated way.\r\n\r\n            var w = el.clientWidth;\r\n            var h = el.clientHeight;\r\n            var size = [w, h];\r\n\r\n            // Size could have been sent as a property?\r\n            //  Or it loads it from the inline style.\r\n\r\n            var vert_margin = this.vert_margin;\r\n            var left_margin = this.left_margin;\r\n            var right_margin = this.right_margin;\r\n            var axis_thickness = this.axis_thickness;\r\n            var x_major_notch_spacing = this.x_major_notch_spacing;\r\n            var y_major_notch_spacing = this.y_major_notch_spacing;\r\n            var x_minor_notch_spacing = this.x_minor_notch_spacing;\r\n            var y_minor_notch_spacing = this.y_minor_notch_spacing;\r\n            var suppress_0_axes_labels = this.suppress_0_axes_labels;\r\n\r\n\r\n\r\n            var x_origin = this.x_origin;\r\n            var y_origin = this.y_origin;\r\n\r\n            var range = this.range;\r\n            var x_min = range[0][0], y_min = range[0][1], x_max = range[1][0], y_max = range[1][1];\r\n\r\n            var y_axis_is_at_origin = x_min <= 0 && x_max >= 0;\r\n            var x_axis_is_at_origin = y_min <= 0 && y_max >= 0;\r\n\r\n            // Position of chart_left, position of chart_right\r\n\r\n            var x_axis_left = left_margin;\r\n            var x_axis_right = w - right_margin;\r\n            var y_axis_top = vert_margin;\r\n            var y_axis_bottom = h - vert_margin;\r\n\r\n            //var x_chart_distance = x_axis_right - x_axis_left;\r\n            //var y_chart_distance = y_axis_bottom - y_axis_top;\r\n\r\n            var x_axis_length = w - left_margin - right_margin;\r\n            var y_axis_length = h - (2 * vert_margin);\r\n\r\n            // Want to show the Y axis at the origin if possible.\r\n\r\n            // Is the x point 0 within the grid? if so, show the y axis at that position.\r\n\r\n            var x_range = x_max - x_min, y_range = y_max - y_min;\r\n            var x_scale = x_range / x_axis_length;\r\n            var y_scale = y_range / y_axis_length;\r\n\r\n\r\n            var log_values = function() {\r\n                console.log('x_range', x_range);\r\n                console.log('y_range', y_range);\r\n                console.log('x_scale', x_scale);\r\n                console.log('y_scale', y_scale);\r\n\r\n                console.log('left_margin', left_margin);\r\n                console.log('right_margin', right_margin);\r\n                console.log('range', range);\r\n                console.log('tof range', tof(range));\r\n            }\r\n\r\n            // They items got are Data_Values.\r\n            var context = this.context;\r\n\r\n            var values_from_pixel_location = function(px_loc) {\r\n                var vect_from_origin = [px_loc[0] - x_origin, px_loc[1] - y_origin];\r\n                //console.log('vect_from_origin', vect_from_origin);\r\n                // and then the values, obtained by scaling.\r\n\r\n                var res = [Math.round(vect_from_origin[0] * x_scale), Math.round(vect_from_origin[1] * y_scale * -1)];\r\n                return res;\r\n\r\n\r\n            };\r\n\r\n            var pixel_location_from_values = function(values) {\r\n                var res = [Math.round(origin[0] + values[0] * 1 / x_scale), Math.round(origin[1] + values[1] * -1 / y_scale)];\r\n                return res;\r\n            };\r\n\r\n            var x_location_from_value = function(x_value) {\r\n                return Math.round(x_origin + x_value * 1 / x_scale)\r\n            };\r\n            var y_location_from_value = function(y_value) {\r\n                return Math.round(y_origin + y_value * -1 / y_scale)\r\n            };\r\n\r\n\r\n            // Want a mousemove that shows where the bounds will be placed\r\n            //  Will show highlight of bound or bound point the mouse is over.\r\n\r\n            var findPos = function(obj) {\r\n                var curleft = curtop = 0;\r\n                if (obj.offsetParent) {\r\n                    do {\r\n                        curleft += obj.offsetLeft;\r\n                        curtop += obj.offsetTop;\r\n                    }  while (obj = obj.offsetParent);\r\n                }\r\n                return [curleft, curtop];\r\n            }\r\n            // Need a way of getting the event to the app with the chart positions.\r\n\r\n            // 22/11/2015 - Was considering adding event interceptors to jsgui.\r\n            //  Will not do that, as we can change the event object here, then other event handlers can access new properties.\r\n\r\n            this.add_event_listener('mousemove', function(e_mousemove) {\r\n                //console.log('e_mousemove', e_mousemove);\r\n                // See the logical points it corresponds to.\r\n                var pos = findPos(el);\r\n                //var pos = bcr[0];\r\n                var click_x, click_y;\r\n                if (e_mousemove.pageX || e_mousemove.pageY) {\r\n                    click_x = e_mousemove.pageX;\r\n                    click_y = e_mousemove.pageY;\r\n                }\r\n                var click_pos = [click_x, click_y];\r\n                var pos_within_this = jsgui.v_subtract(click_pos, pos);\r\n                //console.log('pos_within_this', pos_within_this);\r\n                var values = values_from_pixel_location(pos_within_this);\r\n                //console.log('values', values);\r\n                e_mousemove.chart_position = values;\r\n                //return false\r\n            });\r\n            this.add_event_listener('click', function(e_click) {\r\n                var pos = findPos(el);\r\n                //var pos = bcr[0];\r\n                var click_x, click_y;\r\n                if (e_click.pageX || e_click.pageY) {\r\n                    click_x = e_click.pageX;\r\n                    click_y = e_click.pageY;\r\n                }\r\n                var click_pos = [click_x, click_y];\r\n                var pos_within_this = jsgui.v_subtract(click_pos, pos);\r\n                var values = values_from_pixel_location(pos_within_this);\r\n                e_click.chart_position = values;\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Line_Chart;\r\n", "/*\r\n if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n define([\"../../jsgui-html\", \"./text-field\"],\r\n function(jsgui, Text_Field) {\r\n */\r\n\r\nvar jsgui = require('./../../../../html-core/html-core'), Text_Field = require('../0-basic/1-compositional/Text_Field');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// Another type of control? - composite or basic-composite?\r\n//  That would be an unenhanced Login control. Made up of basic controls, will render and\r\n//   be useful on very limited platforms.\r\n\r\n// Since this is now an advanced control...\r\n\r\n// relatively advanced.\r\n//  maybe a 'platform' or 'web-platform' control.\r\n//  jsgui3-html-controls-web-platform.\r\n//   dont like it, too long.\r\n\r\n\r\n\r\n\r\nclass Login extends Control {\r\n\r\n\t// Maybe should put this into a form, so that it does a form post.\r\n\t//  That could possibly be disabled.\r\n\r\n\r\n\tconstructor(spec) {\r\n\t\tsuper(spec);\r\n\t\tvar make = this.make;\r\n\t\t//this.add_class('login-control');\r\n\t\tthis.add_class('login-control');\r\n\r\n\t\t// and use a form control, set it's dom attributes.\r\n\t\t//  will use relative login url.\r\n\r\n\t\t// We can get the cookies from the context.\r\n\r\n\t\tvar req = this.context.req;\r\n\r\n\t\tconsole.log('--- Within Login Control ---');\r\n\r\n\t\tvar headers = req.headers;\r\n\t\tconsole.log('headers ' + stringify(headers));\r\n\r\n\t\t// If logged in, show a welcome message and logout button rather than the form.\r\n\t\t//  However, the application should have authenticated at an earlier stage.\r\n\t\t//   Perhaps it would also come up with the permissions for that user, but there could be many specific permissions\r\n\t\t//    for different objects.\r\n\r\n\r\n\r\n\t\t//console.log('this.context ' + stringify(this.context));\r\n\t\tvar auth = this.context.auth;\r\n\t\tconsole.log('auth ' + stringify(auth));\r\n\r\n\t\tif (auth && auth.verified) {\r\n\t\t\tvar div_logged_in = new jsgui.div({\r\n\t\t\t\t'context': this.context\r\n\t\t\t});\r\n\t\t\t//div_logged_in.add('Logged in as ' + )\r\n\r\n\t\t\tvar span_logged_in = new jsgui.span({\r\n\t\t\t\t'context': this.context\r\n\t\t\t})\r\n\r\n\t\t\tspan_logged_in.add('Logged in as: ' + auth.username);\r\n\r\n\t\t\tdiv_logged_in.add(span_logged_in);\r\n\r\n\t\t\t// And a button to log out.\r\n\t\t\t//  This will carry out an action, like the login, but without a form.\r\n\t\t\tvar frm = new jsgui.form({\r\n\t\t\t\t'context': this.context\r\n\t\t\t})\r\n\t\t\t// action, method\r\n\r\n\r\n\t\t\tfrm.dom.attrs.set({\r\n\t\t\t\t'action': '/logout/?returnurl=%2F',\r\n\t\t\t\t'method': 'POST'\r\n\t\t\t});\r\n\t\t\t//frm.set('dom.attributes.action', '/logout/?returnurl=%2F');\r\n\t\t\t//frm.set('dom.attributes.method', 'POST');\r\n\r\n\t\t\tdiv_logged_in.add(frm);\r\n\r\n\t\t\tvar btn = new jsgui.button({\r\n\t\t\t\t'context': this.context\r\n\r\n\t\t\t})\r\n\t\t\tbtn.dom.attrs.set({\r\n\t\t\t\t'type': 'submit',\r\n\t\t\t\t'value': 'submit',\r\n\t\t\t\t'class': 'logout'\r\n\t\t\t});\r\n\r\n\t\t\tbtn.add('Logout');\r\n\t\t\tfrm.add(btn);\r\n\r\n\t\t\tthis.add(div_logged_in);\r\n\r\n\t\t} else {\r\n\t\t\tvar frm = new jsgui.form({\r\n\t\t\t\t'context': this.context\r\n\t\t\t})\r\n\t\t\t// action, method\r\n\r\n\t\t\t//frm.set('dom.attributes.action', '/login/?returnurl=%2F');\r\n\t\t\t//frm.set('dom.attributes.action', '/login');\r\n\t\t\t//frm.set('dom.attributes.method', 'POST');\r\n\r\n\t\t\tfrm.dom.attrs.set({\r\n\t\t\t\t'action': '/logout/?returnurl=%2F',\r\n\t\t\t\t'method': 'POST'\r\n\t\t\t});\r\n\r\n\t\t\tthis.add(frm);\r\n\t\t\t// and composed of two text fields...\r\n\r\n\t\t\tvar tf_username = new Text_Field({\r\n\t\t\t\t'text': 'Username',\r\n\t\t\t\t'name': 'username',\r\n\t\t\t\t'value': '',\r\n\t\t\t\t'type': 'text',\r\n\t\t\t\t'context': this.context\r\n\r\n\t\t\t})\r\n\r\n\t\t\tfrm.add(tf_username);\r\n\r\n\t\t\t// This is a factory function that calls the constructor,\r\n\t\t\t//  with this context as the context.\r\n\t\t\t//make(Text_Field({}));\r\n\r\n\t\t\tvar tf_password = new Text_Field({\r\n\t\t\t\t// a name field as well?\r\n\t\t\t\t//  a name for the form\r\n\r\n\t\t\t\t'text': 'Password',\r\n\t\t\t\t'name': 'password',\r\n\t\t\t\t'value': '',\r\n\t\t\t\t'type': 'password',\r\n\t\t\t\t'context': this.context\r\n\r\n\t\t\t})\r\n\r\n\t\t\tfrm.add(tf_password);\r\n\r\n\t\t\t// <BUTTON name=\"submit\" value=\"submit\" type=\"submit\">\r\n\t\t\tvar btn = new jsgui.button({\r\n\t\t\t\t'context': this.context\r\n\r\n\t\t\t})\r\n\t\t\tbtn.dom.attrs.set({\r\n\t\t\t\t'type': 'submit',\r\n\t\t\t\t'value': 'submit',\r\n\t\t\t\t'class': 'login'\r\n\t\t\t});\r\n\r\n\t\t\tbtn.add('Login');\r\n\r\n\t\t\tfrm.add(btn);\r\n\t\t}\r\n\t\t//throw 'stop';\r\n\t}\r\n}\r\n\r\nmodule.exports = Login;\r\n", "var jsgui = require('./../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, def = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\nclass Modal extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'modal';\r\n        super(spec);\r\n        this.add_class('modal');\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Modal;", "// This is a Control Transformer\r\n//  A function\r\n\r\n// Could work well as a mixin too.\r\n\r\nvar jsgui = require('./../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\nconst fnl = require('fnl');\r\nconst prom_or_cb = fnl.prom_or_cb;\r\n\r\nclass Tile_Slider extends Control {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = 'tile_slider';\r\n        super(spec);\r\n\r\n        // Could use a larger grid9 control, but with its central piece positioned in view.\r\n\r\n        // Only concerned with central (normally full in view), left, above, right, below.\r\n\r\n        // Has 5 controls.\r\n        //  \r\n\r\n        if (!spec.el) {\r\n            this.compose_tile_slider();\r\n        }\r\n\r\n    }\r\n    compose_tile_slider() {\r\n\r\n        // May need to know / measure the size of the central div.\r\n        //  Nice if we already have the info\r\n\r\n\r\n        // And the sizes of these containers.\r\n\r\n        // Good candidate for parse_mount.\r\n        //  Along with date editors / pickers / viewers / calendars.\r\n        //  Could treat it as building up a composition string.\r\n\r\n\r\n        const context = this.context;\r\n        let above = new Control({\r\n            'contect': context\r\n        });\r\n        above.add_class('above');\r\n        this.add(above);\r\n        let left = new Control({\r\n            'contect': context\r\n        });\r\n        left.add_class('left');\r\n        this.add(left);\r\n\r\n        let right = new Control({\r\n            'contect': context\r\n        });\r\n        right.add_class('right');\r\n        this.add(right);\r\n        let below = new Control({\r\n            'contect': context\r\n        });\r\n        below.add_class('below');\r\n        this.add(below);\r\n\r\n\r\n        let central = new Control({\r\n            'contect': context\r\n        });\r\n        central.add_class('central');\r\n        this.add(central);\r\n        // Central last, other are positioned absolutely (from beginning).\r\n\r\n\r\n        this.above = above;\r\n        this.left = left;\r\n        this.central = central;\r\n        this.right = right;\r\n        this.below = below;\r\n\r\n        // .cf or cf function?\r\n        //  or use parse_mount / pm for this?\r\n\r\n        this._ctrl_fields = {\r\n            'above': above,\r\n            'left': left,\r\n            'central': central,\r\n            'right': right,\r\n            'below': below\r\n        }\r\n\r\n        this._fields = {\r\n            'size': this.size\r\n        }\r\n    }\r\n\r\n    // Need repositioning after sliding.\r\n\r\n    // So the central slide is now the current one.\r\n    //  Could be worth keeping these cached?\r\n    //  For the moment, just want 1 further in each direction.\r\n\r\n    // Just the sliding.\r\n\r\n    // previous, next\r\n\r\n    // previous_major\r\n    // next_major\r\n    //  used for changing years\r\n\r\n    // previous_year = previous_major\r\n\r\n    // prev2\r\n\r\n    // Transitions of the non-framed version would be cool.\r\n\r\n\r\n    // move_previous\r\n\r\n    // does the slide to the left / right\r\n    //  rearrange / arrange things so that the next operation is ready.\r\n\r\n\r\n\r\n    slide_to_left() {\r\n        // This exposes the element to the right.\r\n        //console.log('slide_to_left');\r\n        //console.log('this.size', this.size);\r\n\r\n        //console.log('this.central.dom.attributes', this.central.dom.attributes);\r\n\r\n        return prom_or_cb((resolve, reject) => {\r\n            let ms = 333;\r\n            let s = ms / 1000;\r\n\r\n            this.central.dom.attributes.style.transition = 'transform ' + s + 's';\r\n            this.central.dom.attributes.style.transform = 'translate(' + -1 * this.size[0] + 'px, 0px)';\r\n\r\n            this.right.dom.attributes.style.transition = 'transform ' + s + 's';\r\n            this.right.dom.attributes.style.transform = 'translate(' + -1 * this.size[0] + 'px, 0px)';\r\n\r\n            this.right.one('transitionend', e_end => {\r\n                //console.log('e_end', e_end);\r\n                resolve();\r\n            });\r\n        }, callback);\r\n\r\n\r\n        /*\r\n\r\n        setTimeout(() => {\r\n            console.log('transition (should be) done');\r\n        }, ms);\r\n\r\n        */\r\n\r\n        // do it on the el?\r\n\r\n        //transitionend\r\n        \r\n\r\n        /*\r\n\r\n        var fnTransitionEnd = (e_end) => {\r\n            console.log('fnTransitionEnd');\r\n            //el.style.overflow = 'visible';\r\n            this.right.dom.el.removeEventListener('transitionend', fnTransitionEnd)\r\n        }\r\n\r\n        this.right.dom.el.addEventListener('transitionend', fnTransitionEnd, false);\r\n        */\r\n\r\n\r\n\r\n    }\r\n    slide_to_right(callback) {\r\n\r\n        return prom_or_cb((resolve, reject) => {\r\n            this.central.dom.attributes.style.transition = 'transform 0.33s';\r\n            this.central.dom.attributes.style.transform = 'translate(' + this.size[0] + 'px, 0px)';\r\n\r\n            this.left.dom.attributes.style.transition = 'transform 0.33s';\r\n            this.left.dom.attributes.style.transform = 'translate(' + this.size[0] + 'px, 0px)';\r\n\r\n            this.left.one('transitionend', e_end => {\r\n                //console.log('e_end', e_end);\r\n                resolve();\r\n            });\r\n        }, callback);\r\n        // This exposes the element to the right.\r\n        //console.log('slide_to_left');\r\n        //console.log('this.size', this.size);\r\n\r\n        //console.log('this.central.dom.attributes', this.central.dom.attributes);\r\n\r\n\r\n\r\n        // do it on the el?\r\n\r\n    }\r\n\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            setTimeout(async () => {\r\n                await this.slide_to_right();\r\n                console.log('awaited slide to right');\r\n            }, 2000);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nconst Tile_Slide = function (Ctrl, fn_prev_spec, fn_next_spec, adjacencies = {\r\n    left: -1,\r\n    right: 1\r\n}) {\r\n\r\n    // map of where the prev and next go.\r\n\r\n\r\n\r\n    // Return a new control that extends Tile_Slider and contains necessary instances of the original control.\r\n    // Create both normal instances of the control, and controls with different specs that represent a different position on a larger grid.\r\n\r\n    // Tile slide is quite important to a smooth mobile user interface\r\n    //  It also will look fairly good in a desktop browser.\r\n    // Currently this will work in just 2 or 4 directions.\r\n    //  2 would be easiest, fine for a month or day selector.\r\n\r\n\r\n    class Tile_Sliding_Ctrl extends Tile_Slider {\r\n        constructor(spec) {\r\n\r\n            let slider_spec = {\r\n                context: spec.context,\r\n                size: spec.size\r\n            }\r\n            super(slider_spec);\r\n\r\n            if (spec.size) {\r\n                slider_spec.size = spec.size;\r\n                this.size = spec.size;\r\n                //console.log('spec.size', spec.size);\r\n            }\r\n\r\n            /*\r\n            if (spec.size) {\r\n                this.central.size = spec.size;\r\n                this.dom.attributes.style.overflow = 'hidden';\r\n                this.dom.attributes.style.position = 'absolute';\r\n                \r\n            }\r\n            */\r\n            //if (spec.size) {\r\n            //slider_spec.size = spec.size;\r\n            //}\r\n\r\n\r\n            //console.log('spec', spec);\r\n            //console.log('spec.size', spec.size);\r\n            //this.size = spec.size;\r\n            // \r\n\r\n            this.spec = spec;\r\n\r\n            //console.log('prev_spec', prev_spec);\r\n            //console.log('spec', spec);\r\n\r\n\r\n            if (!spec.el) {\r\n                this.compose_tile_sliding_ctrl();\r\n            }\r\n\r\n            if (spec.size) {\r\n                //this.central.size = spec.size;\r\n\r\n\r\n            }\r\n\r\n            // then make versions with modified specs and put them adjacent.\r\n\r\n            // Moving to the right will mean swiping to the left.\r\n\r\n\r\n\r\n\r\n        }\r\n        compose_tile_sliding_ctrl() {\r\n            let prev_spec = fn_prev_spec(this.spec);\r\n            let next_spec = fn_next_spec(this.spec);\r\n\r\n            //console.log('this.spec.size', this.spec.size);\r\n\r\n            if (this.spec.size) {\r\n                this.central.size = this.spec.size;\r\n\r\n                // .das? .s? .st?\r\n                //  ds? da.s?\r\n            \r\n                // .s accesses style directly.\r\n                //   maybe that would be a (little) layer about dom styling.\r\n\r\n                this.dom.attributes.style.overflow = 'hidden';\r\n                this.dom.attributes.style.position = 'relative';\r\n\r\n                this.left.dom.attributes.style.position = 'absolute';\r\n                this.left.dom.attributes.style.left = -1 * this.spec.size[0] + 'px';\r\n                this.right.dom.attributes.style.position = 'absolute';\r\n                this.right.dom.attributes.style.left = this.spec.size[0] + 'px';\r\n\r\n                this.left.size = this.spec.size;\r\n                this.right.size = this.spec.size;\r\n            }\r\n\r\n            if (adjacencies.left === -1) {\r\n                // make a previous version to put left of it.\r\n                //let left_ctrl_prev_spec = fn_prev_spec()\r\n                let left_ctrl_prev = new Ctrl(prev_spec);\r\n                this.left.add(left_ctrl_prev);\r\n                //if (prev_spec.size) {\r\n\r\n                //}\r\n            }\r\n\r\n            let ctrl = new Ctrl(this.spec);\r\n            this.central.add(ctrl);\r\n\r\n            if (adjacencies.right === 1) {\r\n                // make a previous version to put left of it.\r\n                //let left_ctrl_prev_spec = fn_prev_spec()\r\n\r\n                let left_ctrl_prev = new Ctrl(next_spec);\r\n                this.right.add(left_ctrl_prev);\r\n                if (next_spec.size) {\r\n\r\n                }\r\n            }\r\n\r\n\r\n        }\r\n    }\r\n\r\n    return Tile_Sliding_Ctrl;\r\n}\r\n\r\n//Tile_Slider\r\n\r\nTile_Slider.wrap = Tile_Slide;\r\n\r\nmodule.exports = Tile_Slider;", "const jsgui = require('../../../../../html-core/html-core');\r\nconst clone = jsgui.clone;\r\nconst each = jsgui.each, is_defined = jsgui.is_defined;\r\nconst Grid = require('./grid');\r\nconst Tile_Slider = require('../../../1-standard/6-layout/tile-slide');\r\nlet days = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];\r\nlet bgc_disabled = '#DDDDDD';\r\nlet bgc_enabled = 'inherit';\r\nconst mx_date = require(`../../../../../control_mixins/typed_data/date`);\r\nclass Month_View extends Grid {\r\n    constructor(spec) {\r\n        spec.grid_size = [7,7]; spec.size = spec.size || [360,200]; spec.__type_name = 'month_view';\r\n        super(spec); mx_date(this, spec);\r\n        if (!spec.el) { this.compose_month_view(); }\r\n        this.context.new_selection_scope(this);\r\n    }\r\n    activate() {\r\n        super.activate();\r\n        let cells = this.$('grid_cell');\r\n        each(cells, cell => {\r\n            //cell.selectable = true;\r\n            cell.on('change', e_change => {\r\n                if(e_change.name==='selected' && e_change.value && is_defined(cell.value)) { this.day = cell.value; }\r\n            });\r\n        });\r\n    }\r\n    compose_month_view() {\r\n        this.refresh_month_view(); this.add_class('month-view');\r\n        let days_row = this._arr_rows[0]; \r\n        days_row.add_class('days'); days_row.add_class('header');\r\n        // Insert day name abbreviations using cell.span.add():\r\n        each(days_row.content._arr, (cell, i) => { if(cell.span) { cell.span.add(days[i]); } });\r\n        let cell_pos = [0,1], ctrl_row = this._arr_rows[cell_pos[1]];\r\n        let advance_cell = () => {\r\n            if(cell_pos[0] === ctrl_row.content._arr.length - 1) {\r\n                if(cell_pos[1] < this._arr_rows.length - 1) { cell_pos[0] = 0; cell_pos[1]++; ctrl_row = this._arr_rows[cell_pos[1]]; }\r\n                else return false;\r\n            } else { cell_pos[0]++; }\r\n            return true;\r\n        };\r\n        let d = new Date(this.year, this.month, 1);\r\n        let got_day = d.getDay() - 1; if(got_day < 0) got_day = 6;\r\n        while(cell_pos[0] < got_day) {\r\n            let cell = ctrl_row.content._arr[cell_pos[0]++];\r\n            cell.selectable = false; cell.select_unique = true; cell.background.color = bgc_disabled;\r\n        }\r\n        let did_advance = true;\r\n        while(did_advance) {\r\n            let cell = ctrl_row.content._arr[cell_pos[0]];\r\n            cell.selectable = true; cell.select_unique = true; cell.value = d.getDate();\r\n            cell._fields = cell._fields || {}; cell._fields.value = cell.value;\r\n            d.setDate(d.getDate() + 1);\r\n            did_advance = advance_cell() && d.getDate() !== 1;\r\n        }\r\n        while(cell_pos[0] <= 6) {\r\n            let cell = ctrl_row.content._arr[cell_pos[0]++];\r\n            cell.selectable = false; cell.select_unique = true; cell.background.color = bgc_disabled;\r\n        }\r\n        if(cell_pos[1] < 6) {\r\n            cell_pos = [0, 6]; ctrl_row = this._arr_rows[cell_pos[1]];\r\n            while(cell_pos[0] <= 6) {\r\n                let cell = ctrl_row.content._arr[cell_pos[0]++];\r\n                cell.selectable = false; cell.select_unique = true; cell.background.color = bgc_disabled;\r\n            }\r\n        }\r\n    }\r\n    refresh_month_view() {\r\n        let d = new Date(this.year, this.month, 1), m = d.getMonth();\r\n        let got_day = d.getDay() - 1; if(got_day < 0) got_day = 6;\r\n        let day = this.day;\r\n        this.each_cell((cell, cell_pos) => {\r\n            let [x, y] = cell_pos;\r\n            if(y > 0) {\r\n                if(y === 1) {\r\n                    if(x < got_day) {\r\n                        cell.background.color = bgc_disabled; cell.selectable = false;\r\n                        if(cell.deselect) cell.deselect(); cell.value = null;\r\n                        cell.iterate_this_and_subcontrols(ctrl => { if(ctrl.dom.tagName === 'span') ctrl.text = ''; });\r\n                    } else {\r\n                        cell.background.color = bgc_enabled; cell.selectable = true;\r\n                        cell.span.add(d.getDate() + ''); d.setDate(d.getDate() + 1);\r\n                    }\r\n                } else {\r\n                    let dm = d.getMonth();\r\n                    if(dm === m) {\r\n                        cell.background.color = bgc_enabled; cell.selectable = true;\r\n                        cell.span.add(d.getDate() + ''); d.setDate(d.getDate() + 1);\r\n                    } else {\r\n                        cell.background.color = bgc_disabled; cell.selectable = false;\r\n                        if(cell.deselect) cell.deselect(); cell.value = null;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\nMonth_View.Tiled = Tile_Slider.wrap(Month_View, spec => {\r\n    spec = clone(spec);\r\n    if(!is_defined(spec.month)) {\r\n        let now = new Date();\r\n        spec.month = now.getMonth(); spec.year = now.getFullYear();\r\n    }\r\n    spec.month = spec.month - 1; if(spec.month < 0) { spec.month = 11; spec.year = spec.year - 1; }\r\n    return spec;\r\n}, spec => {\r\n    spec = clone(spec);\r\n    if(!is_defined(spec.month)) {\r\n        let now = new Date();\r\n        spec.month = now.getMonth(); spec.year = now.getFullYear();\r\n    }\r\n    spec.month = spec.month + 1; if(spec.month > 11) { spec.month = 0; spec.year = spec.year + 1; }\r\n    return spec;\r\n});\r\nmodule.exports = Month_View;", "/**\r\n * Created by James on 04/08/2014.\r\n */\r\n\r\n/*\r\n\r\n if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n\r\n // Also want to make an MDI window system (Multiple Document Interface)\r\n\r\n define([\"../../jsgui-html\", \"./horizontal-menu\"],\r\n function(jsgui, Horizontal_Menu) {\r\n */\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\nvar group = jsgui.group;\r\n\r\n// And the tab buttons act as radio buttons.\r\n//  Having a JSGUI radio button replacement would be nice.\r\n//   Could choose whether to render as a radio button and progressively enhance on the client...\r\n//    Client-side enhancement of semantic HTML.\r\n\r\n//   Or render as it appears on the client?\r\n//    Being able to handle both would be nicest.\r\n//    Possibly radio buttons could have good styling on modern clients anyway?\r\n//    May want them to look very different to normal radio buttons though, eg using them for tabs.\r\n\r\n\r\n// RadioButtonGroup could be a useful Control as well.\r\n//  May provide an easier interface that abstracts away from having to directly make some of the controls.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar fields = {\r\n    'name': String,\r\n    'text': String,\r\n    'value': String,\r\n    'checked': Boolean\r\n};\r\n\r\nclass Radio_Button extends Control {\r\n    // panel name?\r\n\r\n    // could have a title field.\r\n\r\n    // Items field could be an array.\r\n\r\n    // maybe add before make would be better. add will probably be used more.\r\n    constructor(spec, add, make) {\r\n\r\n\r\n        super(spec);\r\n\r\n        // Will have set up some fields.\r\n        //  However, will not be directly using a Field_Collection.\r\n        //   Though perhaps that would help with keeping the ordering of the fields.\r\n        //   Currently we are just treating ._ as holding all fields.\r\n        //    Though not everything in there need be considered a field or set up as one.\r\n\r\n\r\n\r\n\r\n        this.__type_name = 'radio_button';\r\n\r\n        this.add_class('radio-button');\r\n        var context = this.context;\r\n        //var that = this;\r\n\r\n        // A different way of raising change events?\r\n        //  .on('change') often translates to the dom el's onchange.\r\n\r\n        // Want a way to refer to the event for the Control itself, not adding a DOM listener.\r\n        //  (..., false) seems OK.\r\n\r\n\r\n\r\n        if (spec.group_name) this.group_name = spec.group_name;\r\n        if (spec.text) this.text = spec.text;\r\n        if (spec.label) this.text = spec.label;\r\n\r\n        //console.log('spec.el', spec.el);\r\n\r\n        // No, make this contain an input element and a label element\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n\r\n            var name = this.group_name;\r\n\r\n            // Will need to render its ID in the DOM.\r\n\r\n            var html_radio = new Control({\r\n                context\r\n            });\r\n            {\r\n                const {dom} = html_radio;\r\n                dom.tagName = 'input';\r\n                const {attributes} = dom;\r\n                attributes.type = 'radio';\r\n\r\n                attributes.name = name;\r\n\r\n\r\n                attributes.id = html_radio._id();\r\n\r\n            }\r\n            /*\r\n            html_radio.set('dom.tagName', 'input');\r\n            html_radio.set('dom.attributes.type', 'radio');\r\n            html_radio.set('dom.attributes.name', name);\r\n            html_radio.set('dom.attributes.id', html_radio._id());\r\n            */\r\n\r\n\r\n\r\n\r\n            var html_label = new Control({\r\n                'context': context\r\n            });\r\n\r\n            //html_label.set('dom.tagName', 'label');\r\n            html_label.dom.tagName = 'label';\r\n            //console.log('that._', that._);\r\n\r\n            var text_value = this.text + '';\r\n\r\n            //console.log('spec.text', spec.text);\r\n\r\n            // Value should have been set during the initialization.\r\n\r\n\r\n            //console.log('text_value', text_value);\r\n            //console.log('tof text_value', tof(text_value));\r\n            //console.log('that._.text', that._.text);\r\n            //console.log('tof(that._.text)', tof(that._.text));\r\n            //console.log('tof(that._.text._)', tof(that._.text._));\r\n\r\n            // So it seems as though the text field has not been assigned.\r\n            //  It should have been, as its specified as a field.\r\n\r\n            // However, there is a Data_Value for the text field, but it has not been set.\r\n\r\n            // The field should have been set during initialization.\r\n\r\n\r\n\r\n            //throw 'stop';\r\n\r\n            if (is_defined(text_value)) {\r\n                html_label.add(text_value);\r\n            }\r\n\r\n            // The text is a field.\r\n            //  Should be automatically assigned from the spec.\r\n\r\n\r\n            // Needs to have a context for the text that gets added.\r\n            //  Text is not an element in of itself, so will not need a context.\r\n\r\n\r\n\r\n            //html_label.set('dom.attributes.for', html_radio._id());\r\n            html_label.dom.attributes.for = html_radio._id();\r\n\r\n            this.add(html_radio);\r\n            this.add(html_label);\r\n            \r\n            //this.set('radio', html_radio);\r\n            //this.set('label', html_label);\r\n            //html_radio.set('dom.attributes.type', 'radio');\r\n\r\n\r\n            /*\r\n            this.set('dom.attributes.data-jsgui-fields', stringify({\r\n                'value': this.get('value')\r\n            }).replace(/\"/g, \"[DBL_QT]\").replace(/'/g, \"[SNG_QT]\"));\r\n\r\n            */\r\n\r\n            // Look at the items.\r\n\r\n\r\n\r\n\r\n            /*\r\n             var ctrl_fields = {\r\n             'ctrl_relative': div_relative._id(),\r\n             'title_bar': title_bar._id()\r\n             }\r\n\r\n\r\n             this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n             */\r\n\r\n\r\n        }\r\n\r\n    }\r\n    //'resizable': function() {\r\n    //},\r\n    'activate'() {\r\n        // May need to register Flexiboard in some way on the client.\r\n\r\n\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            var radio = this.radio;\r\n            //var el_radio = radio.dom.el;//???\r\n            var label = this.label;\r\n            //var that = this;\r\n\r\n            //var el = this.dom.el;\r\n            //\r\n\r\n            // No, refer specifically to the radio button element's control.\r\n\r\n            // Changes upon becoming checked?\r\n\r\n            /*\r\n            radio.on('change', e_change => {\r\n                //console.log('el_radio.checked', el_radio.checked);\r\n\r\n                //if (el_radio.checked) {\r\n                    this.raise('change', {\r\n                        name: 'checked',\r\n                        value: el_radio.checked\r\n                    });\r\n                //}\r\n            });\r\n            */\r\n\r\n            // Need to listen for DOM change events. That will chage the value.\r\n            //  The checked value true or false.\r\n\r\n\r\n\r\n        }\r\n\r\n\r\n\r\n        //\r\n\r\n    }\r\n};\r\n\r\nmodule.exports = Radio_Button;\r\n/*\r\n return Panel;\r\n }\r\n );\r\n */\r\n", "/**\r\n * Created by James on 04/08/2014.\r\n */\r\n\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\nvar group = jsgui.group;\r\nvar Radio_Button = require('../0-native-compositional/radio-button');\r\n// And the tab buttons act as radio buttons.\r\n//  Having a JSGUI radio button replacement would be nice.\r\n//   Could choose whether to render as a radio button and progressively enhance on the client...\r\n//    Client-side enhancement of semantic HTML.\r\n\r\n//   Or render as it appears on the client?\r\n//    Being able to handle both would be nicest.\r\n//    Possibly radio buttons could have good styling on modern clients anyway?\r\n//    May want them to look very different to normal radio buttons though, eg using them for tabs.\r\n\r\n// RadioButtonGroup could be a useful Control as well.\r\n//  May provide an easier interface that abstracts away from having to directly make some of the controls.\r\n\r\n// And have a selected and selected value API.\r\n//   Make the API common with other things, interoperable nicely.\r\n\r\nclass Radio_Button_Group extends Control {\r\n    // panel name?\r\n\r\n    // Should not need to give a group name...\r\n\r\n    //'fields': {\r\n    //    'items': Array\r\n    //},\r\n\r\n    // maybe add before make would be better. add will probably be used more.\r\n    constructor(spec, add, make) {\r\n        super(spec);\r\n\r\n        this.__type_name = 'radio_button_group';\r\n\r\n        this.add_class('radio-button-group');\r\n\r\n        //console.log('spec.el', spec.el);\r\n\r\n        var context = this.context;\r\n        //var that = this;\r\n\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            var id = this._id();\r\n\r\n            //\r\n            var items = this.get('items').value();\r\n            //console.log('items', items);\r\n            //throw 'stop';\r\n\r\n            each(items, (v, i) => {\r\n\r\n                // jsgui advanced Radio Buttons will also be able to have a text label next to them.\r\n                //  May render itself as an item inside a div, with the value next to it.\r\n                //  Would be interesting to have a control that is 0 depth container...\r\n                //   Like a div, but does not exist.\r\n\r\n                // So a control could have contents, but could have no DOM node of its own.\r\n                //  Or it has got more than one top level DOM node?\r\n                // Do not want to have to put everything inside a DIV.\r\n                //  An HTML radio button with its label next to it looks just like the kind of thing that could work as a 2 element control.\r\n                //   Make it have an array of elements as its .el?\r\n                //    or .els?\r\n                //  Seems like it would add more complexity to the branching.\r\n                //   Brings up more edge cases, makes rules more complex.\r\n\r\n                // Could get on with this and override the rendering mechanism?\r\n                //  Or have an option not to render the control itself?\r\n\r\n                // .content_only property?\r\n                //  Does not render the control itself, only its content.\r\n                //   Then the content can include the HTML radio button control itself.\r\n\r\n                // But then sending the control that has not HTML element to the client?\r\n                //  Details of that control could be included in the next level down that does get shown.\r\n\r\n                // Should put them in a Div for the moment, the find a way to remove that DIV from the markup.\r\n                //  Avoid more hacks + complexity for now. Just get the tabs etc working smoothly.\r\n\r\n\r\n\r\n                var radio_button = new Radio_Button({\r\n                    'context': context,\r\n                    'name': id,\r\n                    'text': v,\r\n                    'value': v\r\n                });\r\n\r\n                this.add(radio_button);\r\n            });\r\n\r\n\r\n\r\n            /*\r\n             var ctrl_fields = {\r\n             'ctrl_relative': div_relative._id(),\r\n             'title_bar': title_bar._id()\r\n             }\r\n\r\n\r\n             this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n             */\r\n\r\n\r\n        }\r\n\r\n    }\r\n    //'resizable': function() {\r\n    //},\r\n    'activate'() {\r\n        //console.log('1) Activate radio_button_group');\r\n        if (!this.__active) {\r\n            var that = this;\r\n            super.activate();\r\n\r\n            var ctrl_checked;\r\n            //console.log('2) Activate radio_button_group');\r\n            this.content.each(function(ctrl, i) {\r\n\r\n                ctrl.on('change', false, function(e_change) {\r\n                    //console.log('rbg e_change', e_change);\r\n\r\n                    ctrl_checked = ctrl;\r\n\r\n                    that.raise('change', {\r\n                        'checked': ctrl_checked\r\n                    })\r\n                })\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Radio_Button_Group;", "const jsgui = require('./../../../../html-core/html-core');\r\nconst Control = jsgui.Control;\r\nconst mx_selectable = require('./../../../../control_mixins/selectable');\r\nconst { each, is_array, tof } = jsgui;\r\nconst Panel = require('./panel');\r\nconst List = require('../../0-core/0-basic/1-compositional/list');\r\nconst Radio_Button_Group = require('../../0-core/0-basic/1-compositional/radio-button-group');\r\nconst Radio_Button = require('../../0-core/0-basic/0-native-compositional/radio-button');\r\n\r\nclass Tab extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'tab';\r\n        super(spec);\r\n        let _group_name;\r\n        Object.defineProperty(this, 'group_name', {\r\n            get() { return _group_name; },\r\n            set(value) {\r\n                let old = _group_name;\r\n                _group_name = value;\r\n                this.raise('change', { 'name': 'group_name', 'old': old, 'value': value });\r\n            }\r\n        });\r\n        _group_name = spec.group_name;\r\n\r\n        let _name;\r\n        Object.defineProperty(this, 'name', {\r\n            get() { return _name; },\r\n            set(value) {\r\n                let old = _name;\r\n                _name = value;\r\n                this.raise('change', { 'name': 'name', 'old': old, 'value': value });\r\n            }\r\n        });\r\n        _name = spec.name;\r\n\r\n        this.add_class('tab');\r\n        mx_selectable(this);\r\n        this.selectable = true;\r\n        if (!spec.el) { this.construct_tab(); }\r\n    }\r\n    construct_tab() {\r\n        const { context } = this;\r\n        const radio_button = new Radio_Button({\r\n            context,\r\n            group_name: this.group_name,\r\n            text: this.name\r\n        });\r\n        this.add(radio_button);\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n        this._ctrl_fields.radio_button = radio_button;\r\n        (this._fields = this._fields || {}).name = this.name;\r\n    }\r\n}\r\nTab.css = `\r\n.tab { }\r\n`;\r\n\r\nclass Tab_Group extends List {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'tab_group';\r\n        super(spec);\r\n        this.add_class('tab-group');\r\n        this.tab_names = spec.tab_names || spec.tabs;\r\n        if (!spec.el) { this.compose_tab_group(); }\r\n    }\r\n    compose_tab_group() {\r\n        each(this.tab_names, tab_name => {\r\n            this.add(new Tab({\r\n                context: this.context,\r\n                name: tab_name,\r\n                group_name: this.__id\r\n            }));\r\n        });\r\n    }\r\n}\r\nTab_Group.css = `\r\n.tab-group {\r\n    display: flex;\r\n    column-gap: 6px;\r\n}\r\n`;\r\n\r\nclass Tabbed_Panel extends Panel {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'tabbed_panel';\r\n        super(spec);\r\n        this.add_class('tab-container');\r\n        this.tabs = spec.tabs;\r\n        if (!spec.el) { this.compose_tabbed_panel(spec.tabs); }\r\n    }\r\n    compose_tabbed_panel(tabs_def) {\r\n        const { context } = this;\r\n        this.tab_pages = [];\r\n\r\n        const add_tab = (name, group_name) => {\r\n            var html_radio = new Control({ context });\r\n            {\r\n                const { dom } = html_radio;\r\n                dom.tagName = 'input';\r\n                const { attributes } = dom;\r\n                attributes.type = 'radio';\r\n                attributes.name = group_name;\r\n            }\r\n            html_radio.add_class('tab-input');\r\n            this.add(html_radio);\r\n            html_radio.dom.attributes.id = html_radio.__id;\r\n\r\n            const label = new jsgui.controls.label({ context });\r\n            label.dom.attributes.for = html_radio.dom.attributes.id;\r\n            label.add_class('tab-label');\r\n            label.add(name);\r\n            this.add(label);\r\n\r\n            const tab_page = new Control({ context });\r\n            tab_page.add_class('tab-page');\r\n            this.tab_pages.push(tab_page);\r\n            this.add(tab_page);\r\n            return tab_page;\r\n        };\r\n\r\n        let i_tab = 0;\r\n        each(this.tabs, tab => {\r\n            const group_name = this._id();\r\n            const t = tof(tab);\r\n            if (t === 'string') {\r\n                add_tab(tab, group_name);\r\n                i_tab++;\r\n            } else {\r\n\r\n                if (t === 'array') {\r\n\r\n                    const tab_label_text = tab[0];\r\n                    const tab_content = tab[1];\r\n                    const tab_page = add_tab(tab_label_text, group_name);\r\n                    tab_page.add(tab_content);\r\n\r\n                } else {\r\n                    console.log('tab', tab);\r\n                    console.log('t', t);\r\n                    throw 'NYI';\r\n                }\r\n                \r\n                \r\n\r\n            }\r\n        });\r\n\r\n        const ctrl_break = new Control({ context });\r\n        ctrl_break.add_class('break');\r\n        this.add(ctrl_break);\r\n\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            this.__active = true;\r\n            const tab_pages = [];\r\n            each(this.content._arr, ctrl => {\r\n                if (ctrl.has_class('tab-page')) { tab_pages.push(ctrl); }\r\n            });\r\n            this.tab_pages = tab_pages;\r\n            console.log('tab_pages.length', tab_pages.length);\r\n        }\r\n    }\r\n}\r\nTabbed_Panel.css = `\r\n.tab-container {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    flex-direction: row; /* Change to 'row' for top or bottom tabs */\r\n    width: 300px; /* Adjust width as needed */\r\n    position: relative;\r\n    height: 300px;\r\n}\r\n.break {\r\n    flex-basis: 100%;\r\n    height: 0;\r\n}\r\n.tab-input {\r\n    display: none;\r\n}\r\n.tab-label {\r\n    height: 22px;\r\n    background-color: #ccc;\r\n    padding: 4px;\r\n    margin: 2px;\r\n    cursor: pointer;\r\n}\r\n.tab-input:checked + .tab-label {\r\n    background-color: #DDFFDD;\r\n}\r\n.tab-input:checked + .tab-label + .tab-page {\r\n    display: block;\r\n}\r\n.tab-page {\r\n    display: none;\r\n    \r\n\r\n\r\n    /*\r\n    order: 100;\r\n    left: 4px;\r\n    right: 4px;\r\n    top: 32px;\r\n    */\r\n\r\n\r\n    /* height: calc(100% - 32px); */\r\n\r\n    height: 300px;\r\n    width: 300px;\r\n    background-color: #FFFFFF;\r\n    border: 1px solid #CCCCCC;\r\n}\r\n`;\r\nmodule.exports = Tabbed_Panel;", "/**\r\n * Created by James on 03/08/2014.\r\n */\r\n\r\n\r\n\r\n/*\r\n    2022 - May change this to use mixins and other more composable ways of doing it.\r\n        Want to start with a Control and then add functionality to it, not changing it to a separate class / subclass where possible.\r\n\r\n    eg FlexiSize...?\r\n        Could use flexbox css as well.\r\n        Where inner content takes the size that is available internally (control can be set to a variety of sizes)\r\n        Where it can be displayed / edited at different sizes.\r\n        Would specify different layouts for different sizes available.\r\n            Can certainly use CSS for this as well - showing hiding and maybe even transforming.\r\n\r\n        MultiSizable...?\r\n            Eg a component with one piece of text and an icon. Click it to edit it and the popup takes a lot more space.\r\n            View_And_Edit_Mode possibly?\r\n\r\n        Different types of modes can apply to the same Control.\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n// Also want to make an MDI window system (Multiple Document Interface)\r\ndefine([\"../../jsgui-html\", \"./panel\"],\r\n    function(jsgui, Panel) {\r\n*/\r\n\r\n// An app layout / full app layout\r\n\r\nvar jsgui = require('./../../../../../html-core/html-core');\r\nvar Panel = require('../panel');\r\nvar Tabbed_Panel = require('../tabbed-panel');\r\n\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof,\r\n    is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\nvar group = jsgui.group;\r\n\r\n// Extensions of inner frames within inner frames...\r\n//  The relative frame container, which has an inner frame. Then if something extends that, it would be good for that\r\n//  to have an inner_control of its own and seamlessly expose that one while using the one above that.\r\n\r\n// Relate the inner_control more to that level of the control heirachy.\r\n//\tThen make it so that they are navigable in sequence.\r\n//  Not for the moment though.\r\n//  I'll just have the Window control contain a relative div.\r\n\r\n//var Relative_Frame = Control.\r\n\r\n/*\r\n    Nav and layout like VS code\r\n    A new layout system that more specifically includes the tabs would work better.\r\n    Multiple documents / viewers are available through tabs like in vs code.\r\n\r\n    Definitely want to do more with dynamic / parsed user controls.\r\n\r\n    leftmost - menu\r\n    topmost - menu, title bar\r\n    left vertical menu - tool group select\r\n    left panel - navigation\r\n    main panel - tabs at top. shows content in main view.\r\n\r\n*/\r\n\r\n/*\r\n 'fields': {\r\n 'layout_mode': String\r\n },\r\n */\r\n\r\n/*\r\n Layout_Inner_Swap may be a better way of handling multiple layouts\r\n Would work on a different level\r\n\r\n*/\r\n\r\nvar fields = {\r\n    'layout_mode': String\r\n};\r\n\r\n// Making this handle tabs in its main area would make it more flexible in a nice way.\r\n\r\n// VSC influenced layout... Nav_View?\r\n//  VSC_Layout?\r\n//   IDE layout?\r\n//  IDE_Layout?\r\n//  VSC_Like?\r\n//   Seems best for now.\r\n\r\n// This may be a very worthwhile place to use composition parsing and building.\r\n//  parse_mount\r\n//   that seems like a good way to include content.\r\n//   Want to get that right before writing more UI composition code.\r\n\r\n// Features ._features feature\r\n\r\n// Like Multi layout mode\r\n//  Define a few panels.\r\n\r\n// Could base VSC_Layout on this.\r\n//  \r\n\r\n// But want to use parse_mount on some HTML-like code.\r\n//  Getting parse_mount etc working fully would be a better focus right now.\r\n\r\n// Maybe make this into a mixin so that controls can have their own different layout modes.\r\n//   Or give this a more specific name within a layout library of some sort.\r\n\r\n\r\n\r\n\r\nclass Multi_Layout_Mode extends Control {\r\n\r\n    // could have a title field.\r\n    //'fields': {\r\n    //\t'title': String\r\n    //},\r\n\r\n    // maybe add before make would be better. add will probably be used more.\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'multi_layout_mode';\r\n        super(spec);\r\n\r\n        // Don't register controls on the server?\r\n        this.layout_mode = spec.layout_mode;\r\n        // May be having probs with make\r\n        var make = this.context.make;\r\n        var context = this.context;\r\n        //this.__type_name = 'multi_layout_mode';\r\n        //this.add_class('multi-layout-mode');\r\n        this.add_class('multi-layout-mode');\r\n        if (!spec.el) {\r\n            this.compose_mlm();\r\n        }\r\n\r\n        this._features = this._features || []; // an array is cool but map is better for testing for specific ones.\r\n\r\n        // map of features may be better for quick checking?\r\n\r\n\r\n\r\n        //each(['app', 'title', 'navigation', 'main', 'misc'], this._features.push);\r\n\r\n        // other features could be\r\n        //  editor, viewer, versitile???, responsive-size\r\n        //   try a few where it would help for feature checking.\r\n        //    also would be useful when they are in a library if the features are described as standard.\r\n        //  basic?, layout?, flexi-layout?\r\n        //   once these mean something more we can include them in ._features.\r\n        \r\n\r\n\r\n\r\n    }\r\n    'compose_mlm'() {\r\n        var layout_mode = this.layout_mode;\r\n        let context = this.context;\r\n\r\n        if (layout_mode) {\r\n            this.add_class(layout_mode);\r\n        }\r\n\r\n        //console.log('layout_mode', layout_mode);\r\n        //console.log('tof layout_mode', tof(layout_mode));\r\n        //  And the main content in the fluid area...\r\n        //   That could be a useful default of fluid-fixed.\r\n\r\n        var panel_title = new Panel({\r\n            'context': context,\r\n            'name': 'title',\r\n            'class': 'title'\r\n        })\r\n        //panel_title.add_class('title');\r\n        var panel_navigation = new Panel({\r\n            'context': context,\r\n            'name': 'navigation',\r\n            'class': 'navigation'\r\n        });\r\n        // Make it so the navigation (on the left panel) can be changed to specific tools\r\n\r\n        // A tools panel would be quite useful\r\n        //  Could just be tools selection.\r\n\r\n        // Tool_Select\r\n        //  Not sure we need this right now.\r\n\r\n        //panel_navigation.add_class('navigation');\r\n\r\n        // are we using tabs?\r\n        //  .using_tabs\r\n        //  .tabs exists\r\n\r\n        // tabs allows swapping between different items that are being viewed.\r\n\r\n        var panel_main = new Panel({\r\n            'context': context,\r\n            'name': 'main',\r\n            'class': 'main'\r\n        })\r\n\r\n        // Make it so that the main panel can use tabs.\r\n        //  Tabbed main panel looks more useful.\r\n\r\n        // panel.tabs?\r\n        //  or use tabbed-panel\r\n        //  could have a tabs mixin?\r\n        //   tabs opens up a variety of internal controls.\r\n\r\n        // Tabbed panel looks like it could be useful here.\r\n\r\n        //panel_main.add_class('main');\r\n        var panel_misc = new Panel({\r\n            'context': context,\r\n            'name': 'misc',\r\n            'class': 'misc'\r\n        })\r\n        //panel_misc.add_class('misc');\r\n        if (layout_mode == 'fluid-fixed') {\r\n            // make the html like in\r\n            //  http://www.dynamicdrive.com/style/layouts/item/css-liquid-layout-22-fluid-fixed/\r\n\r\n            // top\r\n            // left_wrapper\r\n            //  left\r\n            // right\r\n            // bottom\r\n            /*\r\n            var panel_top = new Panel({\r\n                'context': context,\r\n                'name': 'top'\r\n            })\r\n            panel_top.add_class('top');\r\n            */\r\n\r\n            var panel_top = new Panel({\r\n                'context': context,\r\n                'name': 'top'\r\n            })\r\n            panel_top.add_class('top');\r\n            var panel_left_wrapper = new Panel({\r\n                'context': context,\r\n                'name': 'left-wrapper'\r\n            })\r\n            panel_left_wrapper.add_class('left-wrapper');\r\n            var panel_left = new Panel({\r\n                'context': context,\r\n                'name': 'left'\r\n            })\r\n            panel_left.add_class('left');\r\n            var panel_right = new Panel({\r\n                'context': context,\r\n                'name': 'right'\r\n            })\r\n            panel_right.add_class('right');\r\n            var panel_bottom = new Panel({\r\n                'context': context,\r\n                'name': 'bottom'\r\n            })\r\n            panel_bottom.add_class('bottom');\r\n            // will expose, top, left, right, bottom\r\n            this.add(panel_top);\r\n            this.add(panel_left_wrapper);\r\n            panel_left_wrapper.add(panel_left);\r\n            this.add(panel_right);\r\n            this.add(panel_bottom);\r\n            panel_top.add(panel_title);\r\n            panel_bottom.add(panel_navigation);\r\n            panel_left.add(panel_main);\r\n            panel_right.add(panel_misc);\r\n            // layout_mode\r\n        } else if (layout_mode === 'tools-at-top') {\r\n            this.add(panel_title);\r\n            this.add(panel_navigation);\r\n\r\n            var main_column = new Control({\r\n                'context': context,\r\n                'class': 'main-column'\r\n            })\r\n            this.add(main_column);\r\n\r\n            main_column.add(panel_misc);\r\n            main_column.add(panel_main);\r\n        } else {\r\n            this.add(panel_title);\r\n            this.add(panel_navigation);\r\n            this.add(panel_main);\r\n            this.add(panel_misc);\r\n        } \r\n\r\n        this.title = panel_title;\r\n        this.nav = this.navigation = panel_navigation;\r\n        this.main = panel_main;\r\n        this.misc = panel_misc;\r\n\r\n        this._ctrl_fields = this._ctrl_fields || {};\r\n\r\n        //console.log('pre add ctrl fields');\r\n        \r\n        Object.assign(this._ctrl_fields, {\r\n            'title': panel_title,\r\n            'nav': panel_navigation,\r\n            'main': panel_main,\r\n            'misc': panel_misc\r\n        });\r\n    }\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n        }\r\n        // May need to register Flexiboard in some way on the client.\r\n        \r\n    }\r\n\r\n\r\n    //,\r\n    // Takes on the menu of the maximized window (for the moment).\r\n    //  Could have its own menu possibly\r\n    //'menu': function(menu_spec) {\r\n\r\n\r\n    //}\r\n}\r\nmodule.exports = Multi_Layout_Mode;", "/**\r\n * Property_Editor - A panel for editing properties of selected items\r\n * \r\n * Features:\r\n * - Dynamic property fields based on item type\r\n * - Label, placeholder, required, validation editing\r\n * - Real-time updates\r\n * - Type-specific editors\r\n */\r\n\r\nconst Panel = require('../6-layout/panel');\r\nconst Control = require('../../../../html-core/control');\r\nconst Text_Input = require('../../0-core/0-basic/0-native-compositional/Text_Input');\r\nconst Checkbox = require('../../0-core/0-basic/0-native-compositional/checkbox');\r\n\r\nclass Property_Editor extends Panel {\r\n    constructor(options = {}) {\r\n        super(options);\r\n        \r\n        this.add_class('property-editor');\r\n        \r\n        const { context } = this;\r\n        \r\n        // Header\r\n        this.header = new Control({ context, tag_name: 'div' });\r\n        this.header.add_class('property-editor-header');\r\n        this.header_title = new Control({ context, tag_name: 'h3' });\r\n        this.header_title.add('Properties');\r\n        this.header.add(this.header_title);\r\n        this.add(this.header);\r\n        \r\n        // Properties container\r\n        this.properties_container = new Control({ context, tag_name: 'div' });\r\n        this.properties_container.add_class('property-editor-properties');\r\n        this.add(this.properties_container);\r\n        \r\n        // No selection message\r\n        this.no_selection_message = new Control({ context, tag_name: 'div' });\r\n        this.no_selection_message.add_class('property-editor-no-selection');\r\n        this.no_selection_message.add('Select a field to edit its properties');\r\n        this.properties_container.add(this.no_selection_message);\r\n        \r\n        this.current_item = null;\r\n        this.property_fields = {};\r\n    }\r\n    \r\n    /**\r\n     * Load properties for an item\r\n     */\r\n    load_item(item, on_change) {\r\n        this.current_item = item;\r\n        this.on_change = on_change;\r\n        this.property_fields = {};\r\n        \r\n        // Clear container\r\n        this.properties_container.content.clear();\r\n        \r\n        if (!item) {\r\n            this.properties_container.add(this.no_selection_message);\r\n            return;\r\n        }\r\n        \r\n        const { context } = this;\r\n        const properties = item.properties || {};\r\n        \r\n        // Field Type (read-only)\r\n        this._add_property_group(context, 'Field Type', properties.type || 'text', null, true);\r\n        \r\n        // Label\r\n        this._add_property_group(context, 'Label', properties.label || '', (value) => {\r\n            properties.label = value;\r\n            if (this.on_change) this.on_change();\r\n        });\r\n        \r\n        // Name/ID\r\n        this._add_property_group(context, 'Name/ID', properties.name || '', (value) => {\r\n            properties.name = value;\r\n            if (this.on_change) this.on_change();\r\n        });\r\n        \r\n        // Placeholder (for text inputs)\r\n        if (['text', 'email', 'password', 'number', 'url', 'tel', 'textarea'].includes(properties.type)) {\r\n            this._add_property_group(context, 'Placeholder', properties.placeholder || '', (value) => {\r\n                properties.placeholder = value;\r\n                if (this.on_change) this.on_change();\r\n            });\r\n        }\r\n        \r\n        // Required\r\n        this._add_property_checkbox(context, 'Required', properties.required || false, (checked) => {\r\n            properties.required = checked;\r\n            if (this.on_change) this.on_change();\r\n        });\r\n        \r\n        // Options (for select fields)\r\n        if (properties.type === 'select') {\r\n            this._add_property_group(context, 'Options (comma-separated)', \r\n                (properties.options || []).join(', '), \r\n                (value) => {\r\n                    properties.options = value.split(',').map(s => s.trim()).filter(s => s);\r\n                    if (this.on_change) this.on_change();\r\n                }\r\n            );\r\n        }\r\n        \r\n        // Width\r\n        this._add_property_group(context, 'Width (%)', properties.width || '100', (value) => {\r\n            properties.width = value;\r\n            if (this.on_change) this.on_change();\r\n        });\r\n        \r\n        // Delete button\r\n        const delete_btn = new Control({ context, tag_name: 'button' });\r\n        delete_btn.add_class('property-editor-delete-btn');\r\n        delete_btn.add('Delete Field');\r\n        delete_btn.on('click', () => {\r\n            if (this.on_delete) this.on_delete(item);\r\n        });\r\n        this.properties_container.add(delete_btn);\r\n    }\r\n    \r\n    _add_property_group(context, label, value, on_change, read_only = false) {\r\n        const group = new Control({ context, tag_name: 'div' });\r\n        group.add_class('property-group');\r\n        \r\n        const label_el = new Control({ context, tag_name: 'label' });\r\n        label_el.add_class('property-label');\r\n        label_el.add(label);\r\n        group.add(label_el);\r\n        \r\n        const input = new Text_Input({ context });\r\n        input.add_class('property-input');\r\n        input.dom.el.value = value;\r\n        if (read_only) input.dom.el.disabled = true;\r\n        \r\n        if (on_change && !read_only) {\r\n            input.on('input', () => {\r\n                on_change(input.dom.el.value);\r\n            });\r\n        }\r\n        \r\n        group.add(input);\r\n        this.properties_container.add(group);\r\n        \r\n        this.property_fields[label] = input;\r\n        \r\n        return group;\r\n    }\r\n    \r\n    _add_property_checkbox(context, label, checked, on_change) {\r\n        const group = new Control({ context, tag_name: 'div' });\r\n        group.add_class('property-group');\r\n        group.add_class('property-group-checkbox');\r\n        \r\n        const checkbox = new Checkbox({ context });\r\n        checkbox.add_class('property-checkbox');\r\n        checkbox.dom.el.checked = checked;\r\n        \r\n        if (on_change) {\r\n            checkbox.on('change', () => {\r\n                on_change(checkbox.dom.el.checked);\r\n            });\r\n        }\r\n        \r\n        const label_el = new Control({ context, tag_name: 'label' });\r\n        label_el.add_class('property-label');\r\n        label_el.add(label);\r\n        \r\n        group.add(checkbox);\r\n        group.add(label_el);\r\n        this.properties_container.add(group);\r\n        \r\n        this.property_fields[label] = checkbox;\r\n        \r\n        return group;\r\n    }\r\n    \r\n    /**\r\n     * Set the delete callback\r\n     */\r\n    set_on_delete(callback) {\r\n        this.on_delete = callback;\r\n    }\r\n}\r\n\r\nmodule.exports = Property_Editor;\r\n", "\r\nvar jsgui = require('./../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\n//var Control = jsgui.Control;\r\n\r\nvar Button = require('../0-basic/0-native-compositional/button');\r\nvar Item = require('../0-basic/1-compositional/item');\r\nvar Collection = jsgui.Collection;\r\nvar Data_Value = jsgui.Data_Value;\r\n\r\n// Titled_Panel would be useful.\r\n//  Would extend the panel, and also show it's name or title.\r\n\r\n// Want to keep panel simple. Could have Titled_Panel, maybe Resizable_Panel.\r\n//  If we want a panel with a lot of functionality, it would be the Flexi_Panel.\r\n\r\n\r\n// A 'platform' control.\r\n//  Not basic. Will still have its own file for the moment.\r\n\r\n\r\n// limited states feature.\r\n//  can oble be one of a few.\r\n//  may as well give as an array or list in many cases.\r\n\r\n\r\nclass Popup_Menu_Button extends Button {\r\n    // panel name?\r\n\r\n    // could have a title field.\r\n    //'fields': {\r\n    //    'name': String\r\n    //}\r\n    // maybe add before make would be better. add will probably be used more.\r\n    constructor(spec, add, make) {\r\n        spec.no_compose = true;\r\n        spec['class'] = 'popup-menu-button';\r\n        super(spec);\r\n        this.__type_name = 'popup_menu_button';\r\n        //this.add_class('panel');\r\n        //console.log('pre add class');\r\n        //console.log('1) this.dom.attrs', this.dom.attrs);\r\n        //this.add_class('popup-menu-button');\r\n        //console.log('2) this.dom.attrs', this.dom.attrs);\r\n        // Should set the class in the DOM if its not set already.\r\n\r\n        var context = this.context;\r\n        // that = this;\r\n        // With name as a field, that field should get sent to the client...\r\n\r\n        // Then will have the hidden menu that appears when the popup menu button is clicked.\r\n\r\n        // Has a list/collection of items.\r\n\r\n        // Use Stateful mixin?\r\n\r\n        // Mixins may be a bit tricky in terms of adding both composition and activation stages.\r\n        //  Mixins would need to be loaded in order, and applied with care.\r\n        //  ._mixin_compose\r\n        //  ._mixin_activate\r\n        //  ._arr_mixin_names\r\n\r\n        //  These two would also need to be made as properties of the Control, so that they can be added to by the mixins.\r\n        //  ._active_fields\r\n        //  ._ctrl_fields\r\n\r\n\r\n        \r\n\r\n        var setup_mixins = function () {\r\n            this.mixin(\r\n                ['open_closed', 'closed'],\r\n                ['item_container']\r\n            )\r\n        }\r\n\r\n\r\n        // Update this!\r\n        this.states = ['closed', 'open'];\r\n        this.state = new Data_Value('closed');\r\n        this.i_state = 0;\r\n\r\n        var active_fields = this.active_fields = {};\r\n        active_fields.states = this.states;\r\n        active_fields.state = this.state;\r\n        active_fields.i_state = this.i_state;\r\n\r\n        var compose = () => {\r\n            this.text = spec.text || spec.label || '';\r\n            var root_menu_item = new Item({\r\n                'context': context,\r\n                'item': this.text\r\n            });\r\n            root_menu_item.add_class('popup-menu');\r\n\r\n            this.add(root_menu_item);\r\n            root_menu_item.inner.add_class('popup-menu');\r\n            this.root_menu_item = root_menu_item;\r\n\r\n            // Then the inner part / the part that is hidden within the root node.\r\n            // Show / hide the hidden area based on click or hover.\r\n\r\n            if (spec.items) {\r\n                //console.log('spec.items', spec.items);\r\n                let items = this.items = new Collection(spec.items);\r\n                //console.log('this.items', this.items);\r\n                each(items, item => {\r\n                    //console.log('item', item);\r\n\r\n                    var menu_item = new Item({\r\n                        'context': context,\r\n                        'item': item\r\n                    });\r\n                    menu_item.add_class('popup-menu');\r\n                    root_menu_item.inner.add(menu_item);\r\n\r\n                    // Then add a callback event, if we have that.\r\n                    //  Post-activation I suppose.\r\n\r\n                });\r\n            };\r\n\r\n            var ctrl_fields = {\r\n                'root_menu_item': root_menu_item._id()\r\n            }\r\n\r\n            //this.set('dom.attributes.data-jsgui-ctrl-fields', stringify(ctrl_fields).replace(/\"/g, \"'\"));\r\n            this.dom.attrs['data-jsgui-fields'] = stringify(active_fields).replace(/\"/g, \"'\");\r\n            this.dom.attrs['data-jsgui-ctrl-fields'] = stringify(ctrl_fields).replace(/\"/g, \"'\");\r\n        }\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            // Render the menu itself as a bunch of items / an item tree.\r\n            // Create the top level menu item.\r\n            compose();\r\n        }\r\n\r\n        if (spec.el) {\r\n            // A different type of constructor usage. Most likely client-side / within a web browser.\r\n            // The element could be empty.\r\n            //  If so, we need to carry out the compose stage.\r\n            compose();\r\n            // Needs to reflect changes within itself to the DOM.\r\n            //  Possibly this is where react could come in.\r\n\r\n            // It does not have a rendering phase at the moment when it's not being rendered on the server.\r\n            //  Want small and to-the-point client-side rendering.\r\n\r\n        }\r\n    }\r\n    //'resizable': function() {\r\n    //},\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            // Activating should set the CSS class of the node if necessary.\r\n\r\n            var root_menu_item = this.root_menu_item;\r\n\r\n            //console.log('root_menu_item.inner', root_menu_item.inner);\r\n\r\n            //console.log('Popup_Menu_Button activate');\r\n            // Need references?\r\n            //var that = this;\r\n\r\n            //console.log('this.root_menu_item', this.root_menu_item);\r\n\r\n            // Respond to clicks / selects of the inner menu items.\r\n            // All the descendent items need to have events.\r\n            //  Want to have it so that the event handler can be called directly when that item is clicked.\r\n\r\n            // Want to set up the onclicks in the construction / composition.\r\n\r\n\r\n\r\n            //console.log('root_menu_item', root_menu_item);\r\n\r\n            // And pop out of body too?\r\n            //  Could leave a placeholder / comment in place of where the element used to be.\r\n            //  Then swap them to go back.\r\n\r\n            this.state.on('change', (e_change) => {\r\n                //console.log('Popup_Menu_Button state change', e_change);\r\n\r\n                // Change it in the UI at this point.\r\n                var val = e_change.value;\r\n                //console.log('val', val);\r\n\r\n                //if (val == 'closed') {\r\n                //ui_close();\r\n                //    root_menu_item.close();\r\n                //}\r\n\r\n                //if (val == 'open') {\r\n                //ui_open();\r\n                //    root_menu_item.open();\r\n                //}\r\n\r\n                if (val === 'open') {\r\n                    //ui_open();\r\n                    //root_menu_item.open();\r\n                    root_menu_item.inner.pop_into_body();\r\n\r\n                    // Elsewhere could take account for menu being put into the body?\r\n\r\n                    this.one_mousedown_elsewhere((e_mousedown_elsewhere) => {\r\n                        console.log('e_mousedown_elsewhere', e_mousedown_elsewhere);\r\n                        /*\r\n                        window.requestAnimationFrame(function () {\r\n                            //resolve(func.apply(null, args));\r\n                            that.i_state = 0;\r\n                            that.state.set('closed'); // closed\r\n                        });\r\n                        */\r\n                        setTimeout(function () {\r\n                            //resolve(func.apply(null, args));\r\n                            this.i_state = 0;\r\n                            this.state.set('closed'); // closed\r\n                        }, 300);\r\n                        // close it.\r\n                        //console.log('pre close');\r\n\r\n                    })\r\n                };\r\n\r\n                // The root menu item needs to pup up into the DOM.\r\n\r\n                root_menu_item.state.set(val);\r\n            });\r\n\r\n\r\n            root_menu_item.on('click', (e_click) => {\r\n                //console.log('root_menu_item clicked e_click', e_click);\r\n\r\n                // have a control target?\r\n                // Find out if that control is part of this control directly, not part of any other control?\r\n\r\n                //if (e_click.target === root_menu_item.dom.el) {\r\n                //console.log('that.state', that.state);\r\n                //console.log('that.i_state', that.i_state);\r\n                //console.log('that.states', that.states);\r\n\r\n                //console.log('tof that.state', tof(that.state));\r\n\r\n                var new_i_state = that.i_state + 1;\r\n                if (new_i_state === that.states.length) {\r\n                    new_i_state = 0;\r\n                }\r\n\r\n                this.i_state = new_i_state;\r\n                this.state.set(that.states[new_i_state]);\r\n                //}\r\n\r\n            });\r\n            // When it's disconnected from the DOM, the events from inner controls don't reach above.\r\n\r\n            // Need to go through the internal menu items...\r\n            // prototype.description.\r\n            //  description function to set it up.\r\n            //  .api?\r\n            //   info on the API?\r\n\r\n            // prototype.api?\r\n            //  seems useful info there.\r\n\r\n\r\n\r\n\r\n\r\n            //console.log('root_menu_item.inner.content', root_menu_item.inner.content);\r\n            root_menu_item.inner.content.each((inner_menu_item) => {\r\n                //console.log('inner_menu_item', inner_menu_item);\r\n                inner_menu_item.on('click', (e_click) => {\r\n                    //console.log('root_menu_item clicked e_click', e_click);\r\n\r\n                    // have a control target?\r\n                    // Find out if that control is part of this control directly, not part of any other control?\r\n\r\n                    //if (e_click.target === root_menu_item.dom.el) {\r\n                    //console.log('that.state', that.state);\r\n                    //console.log('that.i_state', that.i_state);\r\n                    //console.log('that.states', that.states);\r\n\r\n                    //console.log('tof that.state', tof(that.state));\r\n\r\n                    root_menu_item.state.set('closed');\r\n                    this.i_state = 0;\r\n                    //}\r\n                });\r\n            })\r\n\r\n            // Listen for the various changes on inner buttons.\r\n            //  Want an easy way to iterate them.\r\n            //console.log('pre iterate_sub_items');\r\n\r\n            // Could attach the events earlier.\r\n            //  Want to try that.\r\n            /*\r\n            root_menu_item.iterate_sub_items((item, str_path) => {\r\n                //console.log('item', item);\r\n                item.on('click', (e_click) => {\r\n\r\n                    console.log('sub item click', e_click);\r\n                    console.log('sub item: ', item);\r\n                })\r\n            });\r\n\r\n            */\r\n        }\r\n    }\r\n}\r\nmodule.exports = Popup_Menu_Button;\r\n", "/**\r\n * Rich_Text_Editor - Simple WYSIWYG HTML editor control\r\n * \r\n * A basic but extensible rich text editor that edits HTML content using contenteditable.\r\n * Provides toolbar with common formatting options and maintains clean HTML output.\r\n * \r\n * Current Features (Phase 1 - MVP):\r\n * - Bold, Italic, Underline formatting\r\n * - Ordered and unordered lists\r\n * - Links with URL prompt\r\n * - Clear formatting\r\n * - HTML output (get_html/set_html methods)\r\n * - Clean paste (strips unwanted formatting)\r\n * - Undo/redo via browser\r\n * \r\n * ARCHITECTURE NOTES:\r\n * ==================\r\n * This is a minimal implementation that uses contenteditable and execCommand.\r\n * While execCommand is deprecated, it's still widely supported and simple to use.\r\n * Future versions should migrate to a more robust approach.\r\n * \r\n * PLANNED EXTENSIONS:\r\n * ===================\r\n * \r\n * Phase 2 - Enhanced Formatting:\r\n * - Headings (H1-H6) with dropdown selector\r\n * - Text alignment (left, center, right, justify)\r\n * - Text color and background color pickers\r\n * - Font family selector (from predefined list)\r\n * - Font size selector\r\n * - Strikethrough, subscript, superscript\r\n * - Block quote\r\n * - Code block with syntax highlighting (integrate Prism.js or similar)\r\n * - Horizontal rule\r\n * \r\n * Phase 3 - Advanced Content:\r\n * - Image insertion:\r\n *   - Upload from file system\r\n *   - Insert from URL\r\n *   - Drag and drop\r\n *   - Resize handles on selected images\r\n *   - Alt text editor\r\n * - Table insertion and editing:\r\n *   - Table wizard (rows/cols picker)\r\n *   - Add/remove rows and columns\r\n *   - Cell merging\r\n *   - Table styling\r\n * - Embedded media:\r\n *   - Video embed (YouTube, Vimeo)\r\n *   - Audio embed\r\n *   - iFrame embeds\r\n * - File attachments (with backend integration)\r\n * \r\n * Phase 4 - Rich Interactions:\r\n * - Mentions system (@username autocomplete)\r\n * - Emoji picker\r\n * - Special characters dialog\r\n * - Find and replace\r\n * - Word count / character count display\r\n * - Markdown support (input markdown, render HTML)\r\n * - Full screen mode toggle\r\n * - Distraction-free writing mode\r\n * \r\n * Phase 5 - Collaboration Features:\r\n * - Real-time collaborative editing (CRDT or OT algorithm)\r\n * - Cursor position indicators for other users\r\n * - Comment/annotation system on text ranges\r\n * - Track changes / revision history\r\n * - Conflict resolution UI\r\n * \r\n * Phase 6 - Accessibility & Standards:\r\n * - ARIA labels on all toolbar buttons\r\n * - Keyboard shortcuts (Ctrl+B, Ctrl+I, etc.)\r\n * - Keyboard shortcut help dialog (Ctrl+/)\r\n * - Screen reader announcements for state changes\r\n * - High contrast mode support\r\n * - Focus trap management when dialogs open\r\n * - Semantic HTML output (use <strong> not <b>, <em> not <i>)\r\n * \r\n * Phase 7 - Advanced Features:\r\n * - Custom toolbar configuration (enable/disable buttons)\r\n * - Plugin system for custom buttons and functionality\r\n * - Template snippets (insert pre-formatted content blocks)\r\n * - Macro recording and playback\r\n * - Export to PDF, Word, Markdown\r\n * - Spell check integration (browser native + custom dictionary)\r\n * - Grammar checking (LanguageTool API or similar)\r\n * - Auto-save with draft recovery\r\n * - Version comparison (diff view between versions)\r\n * \r\n * Phase 8 - Performance & Polish:\r\n * - Lazy load toolbar buttons (render on demand)\r\n * - Virtual scrolling for very long documents\r\n * - Debounced change events (avoid excessive re-renders)\r\n * - Memoized HTML sanitization\r\n * - Web Worker for heavy processing (sanitization, export)\r\n * - Progressive enhancement (fallback to textarea)\r\n * - Mobile-optimized toolbar (bottom sheet on touch devices)\r\n * - Touch gestures (swipe for undo/redo, pinch for zoom)\r\n * \r\n * TECHNICAL DECISIONS:\r\n * ====================\r\n * \r\n * ContentEditable vs Canvas/Custom Rendering:\r\n * - Phase 1 uses contenteditable for simplicity and browser support\r\n * - Future: Consider ProseMirror, Slate, Quill, or TipTap for production use\r\n * - These libraries provide:\r\n *   - Consistent cross-browser behavior\r\n *   - Schema-based content validation\r\n *   - Better undo/redo\r\n *   - Plugin architecture\r\n *   - Better accessibility\r\n * \r\n * HTML Sanitization:\r\n * - Currently uses simple regex and DOM manipulation\r\n * - Future: Integrate DOMPurify for robust XSS protection\r\n * - Whitelist approach (allow only specific tags/attributes)\r\n * - Configurable sanitization rules\r\n * \r\n * State Management:\r\n * - Phase 1: Direct DOM manipulation\r\n * - Future: Model-based approach (content model separate from view)\r\n * - This enables:\r\n *   - Better undo/redo\r\n *   - Real-time collaboration\r\n *   - Offline editing with sync\r\n *   - Multiple views of same content\r\n * \r\n * Data Format:\r\n * - Phase 1: HTML string\r\n * - Future options:\r\n *   - JSON document structure (ProseMirror-style)\r\n *   - Markdown with HTML fallback\r\n *   - Delta format (Quill-style)\r\n *   - Custom AST for maximum control\r\n * \r\n * SECURITY CONSIDERATIONS:\r\n * ========================\r\n * - Always sanitize HTML before setting content\r\n * - Never trust user input (XSS risk)\r\n * - Strip <script>, <iframe>, <object>, <embed> tags\r\n * - Strip event handlers (onclick, onerror, etc.)\r\n * - Whitelist allowed tags and attributes\r\n * - Use CSP headers in production\r\n * - Validate URLs in links (prevent javascript: protocol)\r\n * - Consider using Shadow DOM for isolation\r\n * \r\n * BROWSER COMPATIBILITY:\r\n * ======================\r\n * - Modern browsers (Chrome, Firefox, Safari, Edge)\r\n * - contenteditable support (IE9+)\r\n * - execCommand support (deprecated but functional)\r\n * - Selection API support\r\n * - ClipboardEvent API for paste handling\r\n * - Fallback to plain textarea for old browsers\r\n * \r\n * TESTING STRATEGY:\r\n * =================\r\n * - Unit tests for HTML sanitization\r\n * - Unit tests for format commands\r\n * - E2E tests for toolbar interactions\r\n * - E2E tests for keyboard shortcuts\r\n * - Visual regression tests for rendering\r\n * - Accessibility tests (axe-core, screen reader testing)\r\n * - Performance tests (large document editing)\r\n * - Cross-browser tests (BrowserStack or similar)\r\n * \r\n * MIGRATION PATH (execCommand \u2192 Modern API):\r\n * ==========================================\r\n * Phase 1: Use execCommand (current implementation)\r\n * Phase 2: Wrap execCommand in abstraction layer\r\n * Phase 3: Implement custom command system that:\r\n *   - Maintains selection state manually\r\n *   - Applies formatting via DOM manipulation\r\n *   - Records changes for undo/redo\r\n *   - Works identically to execCommand API\r\n * Phase 4: Migrate to library like ProseMirror or build custom\r\n * \r\n * This allows gradual migration without rewriting from scratch.\r\n */\r\n\r\nconst Control = require('../../../../html-core/control');\r\n\r\nclass Rich_Text_Editor extends Control {\r\n    constructor(options = {}) {\r\n        options.__type_name = options.__type_name || 'rich_text_editor';\r\n        super(options);\r\n        \r\n        const { context } = this;\r\n        \r\n        this.add_class('rich-text-editor');\r\n        \r\n        // Configuration\r\n        this.config = {\r\n            placeholder: options.placeholder || 'Start typing...',\r\n            initial_html: options.initial_html || '',\r\n            min_height: options.min_height || '200px',\r\n            max_height: options.max_height || '500px',\r\n            toolbar_position: options.toolbar_position || 'top', // top, bottom, floating\r\n            on_change: options.on_change || null,\r\n            read_only: options.read_only || false\r\n        };\r\n        \r\n        // Create toolbar\r\n        this._create_toolbar(context);\r\n        \r\n        // Create editable area\r\n        this._create_editor(context);\r\n        \r\n        // Track state (only on client)\r\n        this.is_dirty = false;\r\n        this.last_html = '';\r\n    }\r\n    \r\n    /**\r\n     * Create the formatting toolbar\r\n     */\r\n    _create_toolbar(context) {\r\n        this.toolbar = new Control({ context, tag_name: 'div' });\r\n        this.toolbar.add_class('rte-toolbar');\r\n        \r\n        // Button definitions: [command, icon, title, custom_handler]\r\n        const buttons = [\r\n            ['bold', '<strong>B</strong>', 'Bold (Ctrl+B)'],\r\n            ['italic', '<em>I</em>', 'Italic (Ctrl+I)'],\r\n            ['underline', '<u>U</u>', 'Underline (Ctrl+U)'],\r\n            ['separator'],\r\n            ['insertUnorderedList', '\u2022 List', 'Bullet List'],\r\n            ['insertOrderedList', '1. List', 'Numbered List'],\r\n            ['separator'],\r\n            ['createLink', '\uD83D\uDD17', 'Insert Link', this._handle_create_link.bind(this)],\r\n            ['unlink', '\uD83D\uDD17\u2717', 'Remove Link'],\r\n            ['separator'],\r\n            ['removeFormat', '\u2717', 'Clear Formatting']\r\n        ];\r\n        \r\n        buttons.forEach(btn_def => {\r\n            if (btn_def[0] === 'separator') {\r\n                const sep = new Control({ context, tag_name: 'span' });\r\n                sep.add_class('rte-toolbar-separator');\r\n                this.toolbar.add(sep);\r\n            } else {\r\n                const [command, icon, title, custom_handler] = btn_def;\r\n                const button = new Control({ context, tag_name: 'button' });\r\n                button.add_class('rte-toolbar-button');\r\n                button.dom.attributes.type = 'button';\r\n                button.dom.attributes.title = title;\r\n                button.dom.attributes['data-command'] = command;\r\n                button.dom.innerHTML = icon;\r\n                \r\n                // Store custom handler if provided\r\n                if (custom_handler) {\r\n                    button.custom_handler = custom_handler;\r\n                }\r\n                \r\n                this.toolbar.add(button);\r\n            }\r\n        });\r\n        \r\n        this.add(this.toolbar);\r\n    }\r\n    \r\n    /**\r\n     * Create the contenteditable editor area\r\n     */\r\n    _create_editor(context) {\r\n        this.editor_container = new Control({ context, tag_name: 'div' });\r\n        this.editor_container.add_class('rte-editor-container');\r\n        \r\n        this.editor = new Control({ context, tag_name: 'div' });\r\n        this.editor.add_class('rte-editor');\r\n        this.editor.dom.attributes.contenteditable = 'true';\r\n        this.editor.dom.attributes['data-placeholder'] = this.config.placeholder;\r\n        \r\n        // Set initial content if provided\r\n        if (this.config.initial_html) {\r\n            // Note: In real implementation, sanitize before setting\r\n            this.editor.dom.innerHTML = this.config.initial_html;\r\n        }\r\n        \r\n        // Apply height constraints\r\n        if (this.editor.dom.el) {\r\n            this.editor.dom.el.style.minHeight = this.config.min_height;\r\n            this.editor.dom.el.style.maxHeight = this.config.max_height;\r\n        }\r\n        \r\n        if (this.config.read_only && this.editor.dom.el) {\r\n            this.editor.dom.el.contentEditable = 'false';\r\n        }\r\n        \r\n        this.editor_container.add(this.editor);\r\n        this.add(this.editor_container);\r\n    }\r\n    \r\n    /**\r\n     * Activate - attach event listeners (client-only)\r\n     */\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            \r\n            // Toolbar button clicks\r\n            const toolbar_buttons = this.toolbar.dom.el.querySelectorAll('.rte-toolbar-button');\r\n            toolbar_buttons.forEach(btn => {\r\n                btn.addEventListener('click', (e) => {\r\n                    e.preventDefault();\r\n                    const command = btn.getAttribute('data-command');\r\n                    \r\n                    // Check for custom handler\r\n                    const button_control = Array.from(this.toolbar.content._items).find(\r\n                        item => item.dom && item.dom.el === btn\r\n                    );\r\n                    \r\n                    if (button_control && button_control.custom_handler) {\r\n                        button_control.custom_handler(command);\r\n                    } else {\r\n                        this._execute_command(command);\r\n                    }\r\n                    \r\n                    // Return focus to editor\r\n                    this.editor.dom.el.focus();\r\n                });\r\n            });\r\n            \r\n            // Editor input events\r\n            this.editor.dom.el.addEventListener('input', () => {\r\n                this.is_dirty = true;\r\n                this._handle_change();\r\n            });\r\n            \r\n            // Paste event - clean pasted content\r\n            this.editor.dom.el.addEventListener('paste', (e) => {\r\n                e.preventDefault();\r\n                \r\n                // Get plain text from clipboard\r\n                const text = e.clipboardData.getData('text/plain');\r\n                \r\n                // Insert as plain text (no formatting)\r\n                document.execCommand('insertText', false, text);\r\n                \r\n                // TODO Phase 2: Implement smart paste\r\n                // - Detect if pasting from Word (preserve some formatting)\r\n                // - Detect if pasting HTML (sanitize and preserve structure)\r\n                // - Detect if pasting code (wrap in <code> block)\r\n            });\r\n            \r\n            // Keyboard shortcuts\r\n            this.editor.dom.el.addEventListener('keydown', (e) => {\r\n                if (e.ctrlKey || e.metaKey) {\r\n                    switch(e.key.toLowerCase()) {\r\n                        case 'b':\r\n                            e.preventDefault();\r\n                            this._execute_command('bold');\r\n                            break;\r\n                        case 'i':\r\n                            e.preventDefault();\r\n                            this._execute_command('italic');\r\n                            break;\r\n                        case 'u':\r\n                            e.preventDefault();\r\n                            this._execute_command('underline');\r\n                            break;\r\n                        // TODO Phase 6: Add more shortcuts\r\n                        // Ctrl+K: insert link\r\n                        // Ctrl+Shift+7: ordered list\r\n                        // Ctrl+Shift+8: unordered list\r\n                        // Ctrl+/: show keyboard shortcuts help\r\n                    }\r\n                }\r\n            });\r\n            \r\n            // Update toolbar button states on selection change\r\n            document.addEventListener('selectionchange', () => {\r\n                if (this.editor.dom.el.contains(document.activeElement)) {\r\n                    this._update_toolbar_states();\r\n                }\r\n            });\r\n            \r\n            // Initialize toolbar states\r\n            this._update_toolbar_states();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Execute a formatting command\r\n     */\r\n    _execute_command(command, value = null) {\r\n        // execCommand is deprecated but still widely supported\r\n        // TODO Phase 3: Replace with custom implementation for better control\r\n        document.execCommand(command, false, value);\r\n        this._handle_change();\r\n    }\r\n    \r\n    /**\r\n     * Handle link creation (custom handler)\r\n     */\r\n    _handle_create_link(command) {\r\n        // Check if there's a selection\r\n        const selection = window.getSelection();\r\n        if (selection.rangeCount === 0 || selection.isCollapsed) {\r\n            alert('Please select text to create a link');\r\n            return;\r\n        }\r\n        \r\n        // Prompt for URL\r\n        // TODO Phase 3: Replace with custom modal dialog\r\n        const url = prompt('Enter URL:', 'https://');\r\n        \r\n        if (url && url.trim() !== '' && url !== 'https://') {\r\n            // Validate URL (basic check)\r\n            // TODO Phase 3: More robust URL validation\r\n            if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('mailto:')) {\r\n                alert('URL must start with http://, https://, or mailto:');\r\n                return;\r\n            }\r\n            \r\n            this._execute_command('createLink', url);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update toolbar button active states based on current selection\r\n     */\r\n    _update_toolbar_states() {\r\n        const toolbar_buttons = this.toolbar.dom.el.querySelectorAll('.rte-toolbar-button');\r\n        \r\n        toolbar_buttons.forEach(btn => {\r\n            const command = btn.getAttribute('data-command');\r\n            \r\n            // Check if command is currently active at cursor\r\n            // Note: queryCommandState is also deprecated\r\n            // TODO Phase 3: Replace with custom state detection\r\n            try {\r\n                const is_active = document.queryCommandState(command);\r\n                if (is_active) {\r\n                    btn.classList.add('active');\r\n                } else {\r\n                    btn.classList.remove('active');\r\n                }\r\n            } catch (e) {\r\n                // Some commands don't support queryCommandState\r\n                btn.classList.remove('active');\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle content change\r\n     */\r\n    _handle_change() {\r\n        const current_html = this.get_html();\r\n        \r\n        if (current_html !== this.last_html) {\r\n            this.last_html = current_html;\r\n            \r\n            if (this.config.on_change) {\r\n                this.config.on_change(current_html);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get HTML content from editor\r\n     */\r\n    get_html() {\r\n        if (!this.editor.dom.el) {\r\n            return this.config.initial_html || '';\r\n        }\r\n        \r\n        const html = this.editor.dom.el.innerHTML;\r\n        \r\n        // Basic sanitization\r\n        // TODO Phase 2: Use DOMPurify or similar for robust sanitization\r\n        return this._sanitize_html(html);\r\n    }\r\n    \r\n    /**\r\n     * Set HTML content in editor\r\n     */\r\n    set_html(html) {\r\n        const sanitized = this._sanitize_html(html);\r\n        \r\n        if (this.editor.dom.el) {\r\n            this.editor.dom.el.innerHTML = sanitized;\r\n        }\r\n        \r\n        this.last_html = sanitized;\r\n        this.is_dirty = false;\r\n    }\r\n    \r\n    /**\r\n     * Get plain text content (strips all HTML)\r\n     */\r\n    get_text() {\r\n        if (!this.editor.dom.el) {\r\n            return '';\r\n        }\r\n        return this.editor.dom.el.textContent || '';\r\n    }\r\n    \r\n    /**\r\n     * Basic HTML sanitization\r\n     * Removes dangerous tags and attributes\r\n     * \r\n     * TODO Phase 2: Replace with DOMPurify for production\r\n     * This is a minimal implementation for MVP\r\n     */\r\n    _sanitize_html(html) {\r\n        if (!html) return '';\r\n        \r\n        // Remove script tags and content\r\n        html = html.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '');\r\n        \r\n        // Remove event handlers\r\n        html = html.replace(/\\s*on\\w+\\s*=\\s*[\"'][^\"']*[\"']/gi, '');\r\n        html = html.replace(/\\s*on\\w+\\s*=\\s*[^\\s>]*/gi, '');\r\n        \r\n        // Remove javascript: protocols\r\n        html = html.replace(/href\\s*=\\s*[\"']javascript:[^\"']*[\"']/gi, '');\r\n        \r\n        // Remove dangerous tags (basic approach)\r\n        const dangerous_tags = ['script', 'iframe', 'object', 'embed', 'form', 'input', 'button'];\r\n        dangerous_tags.forEach(tag => {\r\n            const regex = new RegExp(`<${tag}\\\\b[^<]*(?:(?!<\\\\/${tag}>)<[^<]*)*<\\\\/${tag}>`, 'gi');\r\n            html = html.replace(regex, '');\r\n        });\r\n        \r\n        // TODO Phase 2: Whitelist approach\r\n        // Only allow specific tags: p, br, strong, em, u, ul, ol, li, a, h1-h6\r\n        // Only allow specific attributes: href, title, alt, src (for images)\r\n        \r\n        return html;\r\n    }\r\n    \r\n    /**\r\n     * Clear all content\r\n     */\r\n    clear() {\r\n        this.set_html('');\r\n    }\r\n    \r\n    /**\r\n     * Check if editor has content\r\n     */\r\n    is_empty() {\r\n        const text = this.get_text().trim();\r\n        return text.length === 0;\r\n    }\r\n    \r\n    /**\r\n     * Set read-only mode\r\n     */\r\n    set_read_only(read_only) {\r\n        this.config.read_only = read_only;\r\n        if (this.editor.dom.el) {\r\n            this.editor.dom.el.contentEditable = read_only ? 'false' : 'true';\r\n        }\r\n        \r\n        if (read_only) {\r\n            this.toolbar.add_class('disabled');\r\n        } else {\r\n            this.toolbar.remove_class('disabled');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Focus the editor\r\n     */\r\n    focus() {\r\n        if (this.editor.dom.el) {\r\n            this.editor.dom.el.focus();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get character count\r\n     * TODO Phase 4: Add to UI, show live count below editor\r\n     */\r\n    get_character_count() {\r\n        return this.get_text().length;\r\n    }\r\n    \r\n    /**\r\n     * Get word count\r\n     * TODO Phase 4: Add to UI, show alongside character count\r\n     */\r\n    get_word_count() {\r\n        const text = this.get_text().trim();\r\n        if (text.length === 0) return 0;\r\n        return text.split(/\\s+/).length;\r\n    }\r\n}\r\n\r\nmodule.exports = Rich_Text_Editor;\r\n", "/**\r\n * Created by James on 28/02/2016.\r\n */\r\n\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\nvar Button = require('../0-native-compositional/button');\r\n\r\n// Seems a good candidate to be a 'core' control.\r\n//  Possibly code will be promoted / sunk to the core.\r\n\r\n// Scroll_View\r\n//  Being a Control that has both scrollbars optionally\r\n//   Also left for RTL languages?\r\n//   Also possibility of scrollbar on top?\r\n//    Never used that way.\r\n\r\n// __direction being part of Display_Modes options properties?\r\n\r\nclass Scrollbar extends Control {\r\n\r\n    // Though maybe tell it to be an array and it should be an array rather than a collection?\r\n    //  Or a Data_Value that holds an array?\r\n\r\n    //'fields': [\r\n    //    ['text', String],\r\n    //    ['state', String],\r\n    //    ['states', Array]\r\n    //],\r\n    //  and can have other fields possibly.\r\n\r\n    constructor(spec, add, make) {\r\n\r\n        super(spec);\r\n        this.__type_name = 'scrollbar';\r\n\r\n        // Always active?\r\n\r\n        this.active();\r\n        var that = this;\r\n        var context = this.context;\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            this.add_class('scrollbar');\r\n            var btn_negitive = new Button({\r\n                'context': context\r\n            });\r\n            var scroll_area = new Control({\r\n                'context': context\r\n            });\r\n            var dragable_scroller = new Control({\r\n                'context': context\r\n            });\r\n            var btn_positive = new Button({\r\n                'context': context\r\n            });\r\n            this.add(btn_negitive);\r\n            scroll_area.add(dragable_scroller);\r\n            this.add(scroll_area);\r\n            this.add(btn_positive);\r\n        }\r\n\r\n    }\r\n    'activate'() {\r\n\r\n        if (!this.__active) {\r\n            super.activate();\r\n            var that = this;\r\n\r\n        }\r\n    }\r\n}\r\n\r\nclass Horizontal_Scrollbar extends Scrollbar {\r\n    constructor(spec) {\r\n        super(spec);\r\n        this.__direction = 'horizontal';\r\n        \r\n    }\r\n}\r\n\r\nclass Vertical_Scrollbar extends Scrollbar {\r\n    constructor(spec) {\r\n        super(spec);\r\n        this.__direction = 'vertical';\r\n        \r\n    }\r\n}\r\n\r\nScrollbar.H = Scrollbar.Horizontal = Horizontal_Scrollbar;\r\nScrollbar.V = Scrollbar.Vertical = Vertical_Scrollbar;\r\n\r\nmodule.exports = Scrollbar;\r\n", "/**\r\n * Created by James on 29/02/2016.\r\n */\r\n\r\nconst jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\nvar Scrollbar = require('./scrollbar');\r\nvar H_Scrollbar = Scrollbar.H, V_Scrollbar = Scrollbar.V;\r\n\r\n// Scroll_View\r\n//  Being a Control that has both scrollbars optionally\r\n//   Also left for RTL languages?\r\n//   Also possibility of scrollbar on top?\r\n//    Never used that way.\r\n\r\nclass Scroll_View extends Control {\r\n\r\n    // Though maybe tell it to be an array and it should be an array rather than a collection?\r\n    //  Or a Data_Value that holds an array?\r\n\r\n    //'fields': [\r\n    //    ['text', String],\r\n    //    ['state', String],\r\n    //    ['states', Array]\r\n    //],\r\n    //  and can have other fields possibly.\r\n\r\n    constructor(spec, add, make) {\r\n\r\n        super(spec);\r\n        this.__type_name = 'toggle_button';\r\n        this.add_class('scrollbar');\r\n\r\n        // Always active?\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n\r\n            // Compose the different sections.\r\n            //  Grid9 would be a useful abstraction here.\r\n            //  Will not use it right now. Grid_9 currently makes DOM interactions and it would be better if it used the right JSGUI abstractions.\r\n\r\n\r\n            // So, in composition we need to know which scrollbars are showing.\r\n\r\n            // show_h_scrollbar, show_v_scrollbar\r\n\r\n            // Need to have up to three components rendered\r\n            //  2 scrollbars, inner view\r\n\r\n\r\n            // For the moment we will have thw tro scrollbars rendered not optionally.\r\n\r\n            // Need to be aware of the widths of the various scrollbars.\r\n\r\n            var inner_view = new Control({\r\n                'context': this.context\r\n            });\r\n            var h_scrollbar = new H_Scrollbar({\r\n                'context': this.context\r\n            });\r\n            var v_scrollbar = new V_Scrollbar({\r\n                'context': this.context\r\n            });\r\n\r\n            this.add(inner_view);\r\n            this.add(h_scrollbar);\r\n            this.add(v_scrollbar);\r\n            this.active();\r\n        }\r\n        var that = this;\r\n    }\r\n    'activate'() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            var that = this;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Scroll_View;\r\n", "const jsgui = require('./../../../../html-core/html-core');\r\n\r\n// text input?\r\n// search button\r\n//   an icon system would be of great help.\r\n//    references to web resources for icons too.\r\n//    making use of them from local CMS as well. CMS and icons could be integrated well.\r\n\r\nconst {Control} = jsgui;\r\n\r\n//const Button = require('./button');\r\n//const Text_Input = require('./text-input');\r\n\r\n// Worth having a 'text' property.\r\n//  Use oext.\r\n\r\nconst view_model_spec = {\r\n    name: 'search_bar',\r\n    version: '0.0.1',\r\n    type: 'control',\r\n    fields: {\r\n        number_of_lines: 1\r\n    },\r\n    actions: ['search']\r\n}\r\n\r\n// Will support rapid lookups.\r\n//  Results will not be part of this right now though.\r\n\r\n// Worth having a property or field to represent the 'text'.\r\n//  Possibly Data_Value will be of use.\r\n\r\n// or ._ being an evented class that stores properties?\r\n// specific change events for specific properties?\r\n\r\nconst {prop, field} = require('obext');\r\n\r\n// The search bar having toolboxes would make sense.\r\n//  For holding buttons etc.\r\n\r\nclass Search_Bar extends Control {\r\n    constructor(spec) {\r\n        // Capitalise type names?\r\n        spec.__type_name = spec.__type_name || 'search_bar';\r\n        super(spec);\r\n\r\n        // Composed of the button and the text input.\r\n        // Needs to itself raise an event / events from the search button being pressed.\r\n        //  How to do that with parse_mount?\r\n        //   Would get the created items back, and then be able in interact with them.\r\n        this.add_class('search-bar');\r\n        // a prop for the text being enough?\r\n        /*\r\n        prop(this, 'value', (e_change) => {\r\n            console.log('text prop e_change', e_change);\r\n        });\r\n        */\r\n        field(this, 'value');\r\n\r\n        if (!spec.el) {\r\n            //this.compose_block_summary();\r\n\r\n            // Flexibility with buttons?\r\n            //  A toolbox or two?\r\n            //  jsgui toolbox control?\r\n            //   yes would make sense for some guis such as drawing apps, IDEs.\r\n            //   a bit like a menu. \r\n\r\n            const jsguiml = '<Text_Input name=\"input\"></Text_Input><Button name=\"btn\"></Button>';\r\n            //console.log('Search_Bar constructor pre parse_mount Object.keys(jsgui.controls)', Object.keys(jsgui.controls));\r\n\r\n            //console.trace();\r\n            //throw 'stop';\r\n            jsgui.parse_mount(jsguiml, this, jsgui.controls);\r\n        }\r\n    }\r\n\r\n    // onkeypress \r\n\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {input, btn} = this;\r\n\r\n            // will need to listen to the keypress event.\r\n            // worth raising a text change event?\r\n\r\n            /*\r\n            input.on('keypress', e => {\r\n                console.log('input keypress', e);\r\n\r\n                // get the text of the input...\r\n\r\n                const input_text = input.text;\r\n                console.log('input_text', input_text);\r\n                this.text = input_text;\r\n\r\n            });\r\n            */\r\n\r\n            // input on change...\r\n\r\n            //  change event overriding dom?\r\n            //   a little ambiguous?\r\n\r\n            // nice if this happens on keypress / paste / whatever causes it to change.\r\n            //  don't like how change means losing focus.\r\n\r\n            // So text input should raise the 'change' event when its text field / property changes.\r\n\r\n            input.on('change', e_change => {\r\n                //console.log('Search_Bar input change', e_change);\r\n                // should happen when the value changes? Change event gets called because of the field?\r\n                // value property - set the value of the search bar.\r\n\r\n                const {name, value} = e_change;\r\n\r\n                if (name === 'value') {\r\n                    this.value = value;\r\n                }\r\n            });\r\n\r\n        }\r\n        \r\n    }\r\n}\r\n\r\nSearch_Bar.prototype.view_model_spec = view_model_spec;\r\n\r\nmodule.exports = Search_Bar;\r\n", "const jsgui = require('../../../../../html-core/html-core');\r\nconst {Control, Control_Data, Control_View, Data_Object, is_array, is_arr_of_strs, each} = jsgui;\r\nconst {field} = require('obext');\r\nclass Select_Options extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'select_options';\r\n        spec.tag_name = 'select';\r\n        super(spec);\r\n        const {context} = this;\r\n        const construct_synchronised_data_and_view_models = () => {\r\n            this.data = new Control_Data({context})\r\n            if (spec.data && spec.data.model) {\r\n                this.data.model = spec.data.model;\r\n            } else {\r\n                this.data.model = new Data_Object({context});\r\n                field(this.data.model, 'value');\r\n                field(this.data.model, 'options');\r\n            }\r\n            this.view = new Control_View({context})\r\n            if (spec.view && spec.view.data.model) {\r\n                this.view.data.model = spec.view.data.model;\r\n            } else {\r\n                this.view.data.model = new Data_Object({context});\r\n                field(this.view.data.model, 'value');\r\n                field(this.view.data.model, 'options');\r\n            }\r\n            this.data.model.on('change', e => {\r\n                const {name, value, old} = e;\r\n                if (name === 'value') {\r\n                    if (value !== old) {\r\n                        this.view.data.model.value = value;\r\n                    }\r\n                } else if (name === 'options') {\r\n                    if (value !== old) {\r\n                        this.view.data.model.options = value;\r\n                    }\r\n                }\r\n            });\r\n            this.view.data.model.on('change', e => {\r\n                const {name, value, old} = e;\r\n                if (name === 'value') {\r\n                    if (value !== old) {\r\n                        this.data.model.value = value;\r\n                        if (this.dom.el) {\r\n                            this.dom.el.value = value;\r\n                        }\r\n                    }\r\n                } else if (name === 'options') {\r\n                    if (value !== old) {\r\n                        this.data.model.options = value;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        construct_synchronised_data_and_view_models();\r\n        if (spec.options) {\r\n            this.data.model.options = spec.options;\r\n        }\r\n        if (!spec.el) {\r\n            this.compose();\r\n        }\r\n    }\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n            const {dom} = this;\r\n            const activate_view_model_to_dom_model_sync = () => {\r\n                this.add_dom_event_listener('change', e => {\r\n                    console.log('dom.el.value', dom.el.value);\r\n                    this.view.data.model.value = dom.el.value;\r\n                });\r\n            }\r\n            activate_view_model_to_dom_model_sync();\r\n\t\t}\r\n\t}\r\n    compose() {\r\n\r\n        // The options may really be within the view.ui object????\r\n        \r\n\r\n        const {context} = this;\r\n        const dm_options = this.data.model.options;\r\n        //console.log('Select_Options compose dm_options:', dm_options);\r\n        if (is_array(dm_options)) {\r\n            if (is_arr_of_strs(dm_options)) {\r\n                console.log('dm_options is an array of strings');\r\n                each(dm_options, str_option => {\r\n                    const ctrl_option = new jsgui.option({\r\n                        context\r\n                    });\r\n                    ctrl_option.dom.attributes.value = str_option;\r\n                    ctrl_option.add(str_option);\r\n                    this.add(ctrl_option);\r\n                })\r\n            }\r\n        }\r\n    }\r\n}\r\nmodule.exports = Select_Options;", "\r\n//if (typeof define !== 'function') { var define = require('amdefine')(module) }\r\n\r\n//define([\"../../jsgui-html\"],\r\n//function(jsgui, Text_Input) {\r\n\r\nvar fields = [\r\n    ['value', Object],\r\n    ['field', String],\r\n    ['meta_field', String]\r\n];\r\n\r\nvar jsgui = require('./../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// Look into more advanced data binding (to client-side objects).\r\n\r\n\r\nconst view_model_spec = {\r\n    name: 'single_line',\r\n    version: '0.0.1',\r\n    type: 'control',\r\n    fields: {\r\n        number_of_lines: 1\r\n    }\r\n\r\n}\r\n\r\nclass Single_Line extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n\r\n    // single field?\r\n    //  and can have other fields possibly.\r\n\r\n\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        this.add_class('single-line');\r\n        this.__type_name = 'single_line';\r\n\r\n        //if (spec.resource_pool) {\r\n        //\tthis.set('resource_pool', spec.resource_pool);\r\n        //}\r\n\r\n        // we have access to the resource pool through the page context.\r\n        //  that may be disabled in some configurations though.\r\n\r\n        //var pool = this.context.pool;\r\n        //console.log('pool', pool);\r\n\r\n        // then for each resource in the pool, we have a resource control.\r\n        //  controls for the same kind of item could be in different kinds of display modes, such as list and\r\n        //  edit. Don't want to make loads of modules for different things, so having resources display just with their\r\n        //  name in one configuration, and as an editable / interactive full size object in another configuration.\r\n\r\n        //var value = this.get('value');\r\n\t\tvar value = this.value;\r\n        //console.log('Single_Line init value ', value);\r\n\r\n        var display_value;\r\n\r\n        var meta_field = this.get('meta_field');\r\n        //console.log('tof meta_field', tof(meta_field));\r\n        //console.log('meta_field', meta_field);\r\n\r\n        if (meta_field) {\r\n            display_value = value.meta.get(meta_field.value());\r\n        }\r\n\r\n        //console.log('display_value', display_value);\r\n        //console.log('tof display_value', tof(display_value));\r\n\r\n        // and have a span where it shows that value\r\n\r\n        var el = this.dom.el;\r\n        if (!el) {\r\n            var span = new jsgui.span({\r\n                'context': this.context//,\r\n                //'content': display_value\r\n            });\r\n            if (display_value) {\r\n                span.add(display_value);\r\n            }\r\n\r\n\r\n\r\n            this.add(span);\r\n\r\n            this.set('span', span);\r\n        }\r\n\r\n\r\n\r\n\r\n        // Maybe won't get the field directly.\r\n        //  May be getting a meta field.\r\n\r\n    }\r\n    'activate'() {\r\n        super.activate();\r\n\r\n        // Not sure it will have activated / got the subcontrols as content yet...\r\n\r\n\r\n        // also do some scraping.\r\n        //  want to get the value.\r\n        //  as data_value or string?\r\n\r\n        // get the child span control...\r\n        var content = this.content;\r\n        //console.log('Single_Line content', content);\r\n\r\n        // need to read the value from that.\r\n        var span = content.get(0);\r\n        //console.log('span', span);\r\n\r\n\r\n        var val = span.dom.el.innerHTML;\r\n\r\n        //this.set('value', val);\r\n\t\tthis.value = val;\r\n\r\n\t\t/*\r\n\t\t var span = this.content.get(0);\r\n\t\t console.log('span', span);\r\n\r\n\t\t var span_content = span.content;\r\n\t\t console.log('span_content', span_content);\r\n\t\t */\r\n        //var span_content_item = span.content.get(0);\r\n        //console.log('span_content_item', span_content_item);\r\n\r\n    }\r\n\r\n\r\n};\r\nmodule.exports = Single_Line;\r\n", "\r\n// Header, footer\r\n// Left panel\r\n// Right panel\r\n// Main\r\n\r\nvar jsgui = require('../../../../html-core/html-core');\r\n\r\n//const Active_HTML_Document = require('../../../')\r\n// Is a page control. Ie is an HTML document.\r\n\r\nclass Standard_Web_Page extends jsgui.Blank_HTML_Document {\r\n    constructor(spec) {\r\n        super(spec);\r\n\r\n        // Set its title, an h1, one or more paragraphs of text?\r\n\r\n        \r\n    }\r\n}\r\n\r\nmodule.exports = Standard_Web_Page;\r\n", "var jsgui = require('./../../../../html-core/html-core');\r\nvar Toggle_Button = require('../../0-core/0-basic/1-compositional/toggle-button');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\n\r\n// Maybe a bit more niche.\r\n//  Could make an extra controls expansion....\r\n\r\n// Specifying / having a smaller default control set would help.\r\n//  So would a function for declaring controls.\r\n//   May have some more tricks for keeping things in a closure.\r\n\r\n\r\n\r\n\r\nclass Start_Stop_Toggle_Button extends Toggle_Button {\r\n\r\n\t//'fields': [\r\n\t\t//['text', String]\r\n\t//],\r\n\t//  and can have other fields possibly.\r\n\r\n\tconstructor(spec, add, make) {\r\n\t\t// Set it so it only has two states\r\n\t\t//  '+' and '-'\r\n\t\tspec.states = ['start', 'stop'];\r\n\t\tspec.state = spec.state || 'start';\r\n\r\n\t\tsuper(spec);\r\n\t\tthis.__type_name = 'start_stop_toggle_button';\r\n\r\n\t\tthis.add_class('start-stop toggle-button');\r\n\r\n\t\t// set not returning the Data_Value?\r\n\t\t//this.state = spec.state;\r\n\t\t// Want it to have events as well specific to start and stop.\r\n\t\t//  That will make it different to some other toggle buttons.\r\n\t\t// can listen for state change.\r\n\t\t// needs to be client-side event only.\r\n\t\t//  Maybe just on activation.\r\n\r\n\t\t// a 'changes' util function.\r\n\r\n\t\tthis.on('change', (e_change) => {\r\n\t\t\t//console.log('Start_Stop_Toggle_Button e_change', e_change);\r\n\t\t\tconst {name, value} = e_change;\r\n\t\t\tif (name === 'state') {\r\n\t\t\t\t// the state is just what the button says/will say.\r\n\t\t\t\tif (value === 'stop') {\r\n\t\t\t\t\t// start it.\r\n\t\t\t\t\tthis.raise('start');\r\n\t\t\t\t}\r\n\t\t\t\tif (value === 'start') {\r\n\t\t\t\t\t// start it.\r\n\t\t\t\t\tthis.raise('stop');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t'activate'() {\r\n\t\t// Need to check it's not active already.\r\n\t\tif (!this.__active) {\r\n\t\t\tsuper.activate();\r\n\t\t\t//console.log('* activate Start_Stop_Toggle_Button');\r\n\t\t\t//var that = this;\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports = Start_Stop_Toggle_Button;\r\n", "/*\r\n    Interchangable with a span (in many cases), allows editing of a single string.\r\n\r\n    // (no styling)\r\n\r\n\r\n    // Text property / field.\r\n\r\n*/\r\n\r\n// tag name span\r\n// highlight on mouseover.\r\n// edit on click\r\n\r\n// no support for sub-spans.\r\n\r\nconst jsgui = require('./../../../../html-core/html-core');\r\n\r\n// could inherit span control?\r\n\r\nconst {controls, parse, each, are_equal} = jsgui;\r\nconst {Control, Text_Node} = controls;\r\n\r\nconst Button = require('../0-basic/0-native-compositional/button');\r\n\r\nconst {field, prop} = require('obext');\r\nconst press_events = require('./../../../../control_mixins/press-events');\r\n\r\n// Likely to better use layout / popup / display mixins.\r\n//   swap-to-edit? maybe not with this control anyway.\r\n\r\n// Should extend span control?\r\n\r\n// Editable\r\n// Editing\r\n\r\n// Click-to-edit mixin?\r\n\r\n// or make the mixin / plugin-like functionality outside the class for easier movement elsewhere.\r\n\r\n// More functional programming using controls would be useful. Maybe move (back) away from ES6 classes.\r\n\r\n\r\n// And respond to presses, not just clicks.\r\n\r\n// press-events\r\n\r\n// Automatic activation would make a lot of sense when it's put into an active document / active part of the document.\r\n//  Or always...\r\n\r\n// The context could maybe respond to a control being added into the DOM.\r\n\r\n\r\n// a 'frame' mixin piece of functionality would help too.\r\n//  Be able to add controls to the frame of a control...\r\n\r\n// suspended_frame\r\n//  the virtual frame made up by the position of the object in the DOM.\r\n\r\n// Maybe could use 'before' and 'after' css?\r\n\r\n// Really would be best to be able to add items to the virtual frame around the control.\r\n\r\n// suspended_virtual_frame\r\n//  suspended in the body.\r\n\r\n// will be able to position and place (new) controls within that frame.\r\n//  access the controls (as collection?) within the frame?\r\n\r\n// will be useful for positioning popups / adjustment buttons.\r\n//  an abstraction to handle it where it occurrs.\r\n\r\n// Definitely seems useful for the various buttons (popup menu? too) that will show in some cases.\r\n//  Will help with doing this around a span control.\r\n\r\n\r\n// virtual_suspended_frame...\r\n//  won't itself have / be a control to display its stuff.\r\n\r\n// Putting things into a background layer behind everything else?\r\n//  Don't want to cover on top of the frame we actually want.\r\n//  Do want to provide easy access through an abstraction to a space / spaces around a ctrl.\r\n//   Want to provide bindings to it.\r\n\r\n// Want an abstraction that makes it very simple to access and use the space (suspended) around a ctrl.\r\n\r\n// Will want to add a variety of controls / objects to the suspended_frame.\r\n\r\n// or use this right now to get the positions?\r\n//  will want centering of controls around suspended_frame points.\r\n\r\n\r\n\r\n// will create controls.\r\n//  add them to positions in a suspended_frame.\r\n\r\n\r\n// watch_redimension to avoid ambiguity?\r\nconst watch_resize = (ctrl) => {\r\n\r\n    // watch reposition?\r\n    // and moving too.\r\n    // will use request animation frame.\r\n\r\n    // also bcr.\r\n\r\n    // A typed array bcr system would be nicer.\r\n\r\n    let last_size = ctrl.bcr();\r\n\r\n\r\n    const inner = () => {\r\n        requestAnimationFrame(timestamp => {\r\n\r\n\r\n            const current_size = ctrl.bcr();\r\n            const same_size = are_equal(last_size, current_size);\r\n            //console.log('same_size', same_size);\r\n\r\n            if (same_size) {\r\n\r\n            } else {\r\n                ctrl.raise('resize');\r\n                last_size = current_size;\r\n            }\r\n\r\n            inner();\r\n\r\n        })\r\n    }\r\n    inner();\r\n\r\n\r\n}\r\n\r\n// Likely to move this elswhere, ie mixins.\r\n\r\nconst suspended_frame = (ctrl, opts = {\r\n    offset: 0\r\n}) => {\r\n\r\n\r\n    const {context} = ctrl;\r\n    const body = context.body();\r\n    //console.log('body', body);\r\n\r\n    let arr_ctrls = [];\r\n    let arr_ctrls_with_poss = [];\r\n\r\n\r\n    // controls by position map...\r\n    //  only one control in each position?\r\n\r\n    // or make an adjust control position function?\r\n    //  sync control position.\r\n\r\n\r\n\r\n\r\n    const {offset} = opts;\r\n\r\n\r\n\r\n    // Will do resize watching on the ctrl.\r\n    //  Then will accordingly adjust positions.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // Suspended frame for the control...\r\n\r\n    // Want to get a suspended frame object back.\r\n    // Place ctrl.\r\n    //  Place ctrl into the body in a position specified by the frame.\r\n\r\n    // Listen out for the control resizing / moving too...\r\n    //  The suspended frame will have to move.\r\n\r\n    // add to position...\r\n    // be able to get the positions...\r\n    // tl, br etc\r\n\r\n    // The suspended controls will be put into the document body.\r\n    //  Maybe a suspended layer div within the body?\r\n\r\n    // Get the variety of positions...\r\n\r\n    // tl, tm, tr\r\n    // ml, mm, mr\r\n    // bl, mm, br\r\n\r\n    // and then adjustments in pixels to make.\r\n\r\n    // Needs to have its own layout engine using absolute positioning.\r\n\r\n    // Or could relative positioned inline divs be included before and after a span?\r\n    // Jsgui ctrl way doing before and after, not just with CSS...?\r\n\r\n    // For the moment, will make this suspended_frame.\r\n\r\n    // Need to be able to add a ctrl (to a position)\r\n    //  Bind it to that position relative to the ctrl as well.\r\n\r\n    const measure_ctrl = () => {\r\n\r\n        // Measurements in the DOM for the ctrl.\r\n\r\n        // Bounding client rect? Anything faster?\r\n        //  getBoundingClientRect()\r\n        //   its relative to viewport so need to account for scroll position.\r\n\r\n        // bcr function but adjusted for scroll positions?\r\n        //  would be worth planning for the future.\r\n\r\n        const bcr = ctrl.bcr();\r\n        console.log('bcr', bcr);\r\n\r\n\r\n        // Calculate positions where various things can go.\r\n        //  Can't put some controls inside the a span or some other controls.\r\n        //  The virtual suspended frame makes a lot of sense for framing an object with other controls.\r\n        //   Can also style it with a border.\r\n        //    It would be outside of the boundaries of the ctrl.\r\n\r\n        // return the bcr?\r\n\r\n\r\n        return bcr;\r\n\r\n\r\n    }\r\n\r\n    const clear = () => {\r\n        \r\n        each(arr_ctrls, ctrl => {\r\n            ctrl.remove();\r\n        });\r\n        arr_ctrls = [];\r\n        arr_ctrls_with_poss = [];\r\n\r\n    }\r\n\r\n    // Best not to have to remeasure self when getting ctrl position?\r\n\r\n\r\n\r\n    // self-measurement position...\r\n    const get_suspended_ctrl_doc_pos = (suspended_ctrl, pos) => {\r\n\r\n        const m = measure_ctrl();\r\n\r\n\r\n        //console.log('m', m);\r\n\r\n        const [tl, br, size] = m;\r\n\r\n        // And the size of the control to add...\r\n        //  Sizes could do with work on types and grammar.\r\n\r\n        //console.log('[tl, br, size]', [tl, br, size]);\r\n        // get the size of the ctrl_to_add\r\n        //console.log('ctrl_to_add.size', ctrl_to_add.size);\r\n        // work out / have various corner positions...\r\n        //  we basically have them already.\r\n\r\n\r\n        // And the size of the control to add.\r\n        //  That should be centered.\r\n\r\n        // work out offset positions from points.\r\n\r\n        // get the doc position from the pos given.\r\n\r\n        //console.log('pos', pos);\r\n\r\n        // tl = top left.\r\n        //  could have a lookup function for them\r\n\r\n        // take account of the offset too.\r\n        //  could make offset edges / positions objects?\r\n\r\n        const map_pos_fns = {\r\n            'tl': () => [tl[0] - offset, tl[1] - offset],\r\n            'tm': () => [t1[0] + (1/2 * size[0]), t1[1] - offset],\r\n            'tr': () => [br[0] + offset, tl[1] - offset]\r\n        }\r\n\r\n        if (map_pos_fns[pos]) {\r\n\r\n            const retrieved_pos = map_pos_fns[pos]();\r\n            //console.log('retrieved_pos', retrieved_pos);\r\n\r\n            if (retrieved_pos) {\r\n                if (suspended_ctrl.size) {\r\n                    const half_size = [suspended_ctrl.size[0] / 2, suspended_ctrl.size[1] / 2];\r\n                    //console.log('half_size', half_size);\r\n                    // set the control to add to be absolute.\r\n                    const docpos = [retrieved_pos[0] - half_size[0], retrieved_pos[1] - half_size[1]];\r\n                    return docpos;\r\n                } else {\r\n                    return retrieved_pos;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    const add = (ctrl_to_add, pos) => {\r\n        // and poly with the pos with mfp? eventually maybe. grammar and interpretation. at least that part of the system exists and functions somewhat.\r\n\r\n        // Then offsets based on the control to add's size.\r\n\r\n        // Sync / set the control's position...\r\n        /// Some / all of this can be used to sync / reset the pos.\r\n\r\n        const docpos = get_suspended_ctrl_doc_pos(ctrl_to_add, pos);\r\n        console.log('docpos', docpos);\r\n\r\n        ctrl_to_add.style({\r\n            'position': 'absolute',\r\n            'left': docpos[0] + 'px',\r\n            'top': docpos[1] + 'px'\r\n        });\r\n\r\n        // rendering the 'off' property in 'style'?\r\n        //  seems like a problem there.\r\n        //   not so sure why its being set either.\r\n\r\n        //console.log('body', body);\r\n        //console.log('body.__active', body.__active);\r\n        //console.log('pre add to body');\r\n\r\n        body.add(ctrl_to_add);\r\n        arr_ctrls.push(ctrl_to_add);\r\n        arr_ctrls_with_poss.push([ctrl_to_add, pos]);\r\n\r\n\r\n        // Consistent and reliable auto-activate would help a lot.\r\n        ctrl_to_add.activate();\r\n\r\n    }\r\n\r\n    const sync_dimensions = () => {\r\n        // go through all items by layout position...\r\n\r\n        //const docpos = get_suspended_ctrl_doc_pos(ctrl_to_add, pos);\r\n        //console.log('docpos', docpos);\r\n\r\n        // sync the dimensions within the suspended frame.\r\n\r\n        each(arr_ctrls_with_poss, cwp => {\r\n            const [ctrl, pos] = cwp;\r\n            const docpos = get_suspended_ctrl_doc_pos(ctrl, pos);\r\n            //console.log('docpos', docpos);\r\n\r\n            // Not sure why its not setting the style....\r\n\r\n            //console.log('ctrl.__active', ctrl.__active);\r\n\r\n            ctrl.style({\r\n                'left': docpos[0] + 'px',\r\n                'top': docpos[1] + 'px'\r\n            });\r\n\r\n        });\r\n\r\n    }\r\n    watch_resize(ctrl);\r\n\r\n    ctrl.on('resize', e_resize => {\r\n        //console.log('suspended_frame e_resize', e_resize);\r\n        sync_dimensions();\r\n    });\r\n\r\n\r\n    const res = {\r\n        add: add,\r\n        clear: clear\r\n    };\r\n\r\n    return res;\r\n\r\n}\r\n\r\n\r\n\r\n\r\n// Edit mode mixin?\r\n//   Yes, edit mode mixin would definitely make sense.\r\n//   Possibly for many controls. Will focus on editing and editable data for the moment - but not all data will be editable (or edited) at all times.\r\n//     Much of the time data would just be viewed. Not all data could be edited anyway.\r\n\r\n// Make cancel and OK buttons quicker and easier to make....\r\n\r\n\r\n\r\n\r\nconst editable = (ctrl) => {\r\n    field(ctrl, 'editable', true);\r\n    field(ctrl, 'editing', false);\r\n\r\n    const {context} = ctrl;\r\n    // then when the control is clicked, if it's not editing, set it to editing mode.\r\n\r\n    ctrl.on('activate', e => {\r\n        console.log('new mini mixin editable ctrl on activate');\r\n\r\n        let initial_text = ctrl.dom.el.textContent;\r\n\r\n        press_events(ctrl);\r\n\r\n        // suspended_frame\r\n\r\n        // Maybe do this as async, so the parsing works?\r\n        //  Parsing only works with a callback for the moment.\r\n\r\n        // And an offset distance from the ctrl...\r\n        //  Extra spacing around the contorol would stop buttons getting in the way.\r\n\r\n        const sframe = suspended_frame(ctrl, {\r\n            offset: 8\r\n        });\r\n\r\n        // Create the utility buttons that get hidden around the suspended frame.\r\n        //  Or they only get created when needed?\r\n\r\n        // And include buttons in the suspended frame.\r\n\r\n        // Create two button controls.\r\n        //  A parse but dont mount function would be of use too.\r\n        //   Would be easier to define and create a button.\r\n        \r\n        // create a cancel and ok button for the suspended frame.\r\n\r\n        // can use parse, not parse_mount.\r\n\r\n        // size and color\r\n        //  or that's in the CSS?\r\n        //   then would need to measure its size?\r\n        //   put it in as transparent, then measure its size???\r\n\r\n\r\n        // cancel button, cancel logo\r\n        //  put the size in at 16,16?\r\n        //  reading of size properties could be better. Using grammar?\r\n\r\n        // just putting in a fairly simple button here would help.\r\n        //  Not so sure about size property, especially through parse.\r\n\r\n\r\n        //  size property here should be easy enough.\r\n        //  also sizes from themes / size calculation system would help.\r\n\r\n        // parse is now async :(\r\n        //  maybe a sync parse could be made.\r\n        //  parsing doesnt have to be async, technically.\r\n\r\n\r\n        //const btn_cancel = \r\n\r\n        //console.log('btn_cancel', btn_cancel);\r\n\r\n        // add that button to the suspended frame.\r\n\r\n        // parse(`<Button name=\"cancel\" class=\"cancel\" size=\"[16,16]\"></Button>`, context, controls);\r\n\r\n        // Worth creating the button the old-fashioned way for the moment.\r\n\r\n        // and set its size here?\r\n        //  maybe not the most flexible way.\r\n        //console.log('!!Button', !!Button);\r\n\r\n        // Size function not working right?\r\n        //  style function?\r\n\r\n        // Want to easily set up the icons.\r\n        //  Later will support sprites.\r\n        //  For the moment, want to easily serve images.\r\n\r\n        // Or unicode?\r\n\r\n        // &#x2BA8\r\n        //  makes sense for the moment.\r\n\r\n        // \u2B8C\r\n        // \u2713\r\n\r\n        // set the line-height too?\r\n        //  set (inline) style properties too?\r\n\r\n        const btn_cancel = new Button({\r\n            context: context,\r\n            class: 'cancel button',\r\n            size: [24, 24],\r\n            text: '\u2B8C'\r\n        });\r\n        btn_cancel.style({\r\n            'line-height': '18px',\r\n            'color': '#8B0000',\r\n            'font-weight': 'bold'\r\n        });\r\n\r\n        // 8B0000\r\n        //press_events(btn_cancel);\r\n\r\n        const btn_ok = new Button({\r\n            context: context,\r\n            class: 'ok button',\r\n            size: [24, 24],\r\n            text: '\u2713'\r\n        });\r\n        btn_ok.style({\r\n            'line-height': '18px',\r\n            'color': '#228B22',   // forest green\r\n            'font-weight': 'bold'\r\n        });\r\n        //press_events(btn_ok);\r\n\r\n        // ok button too.\r\n\r\n        const cancel_editing = () => {\r\n            console.log('cancel_editing');\r\n\r\n            // clear the suspended controls...\r\n            sframe.clear();\r\n            ctrl.remove_class('editing');\r\n            ctrl.editing = false;\r\n            ctrl.dom.attributes.contenteditable = false;\r\n\r\n            ctrl.dom.el.textContent = initial_text;\r\n\r\n        }\r\n\r\n        const save_editing = () => {\r\n            console.log('save_editing');\r\n\r\n            // get the text content...\r\n\r\n            //  inner html?\r\n            // textContent \r\n\r\n            const new_text = ctrl.dom.el.textContent;\r\n            console.log('new_text', new_text);\r\n\r\n            sframe.clear();\r\n            ctrl.remove_class('editing');\r\n            ctrl.editing = false;\r\n            ctrl.dom.attributes.contenteditable = false;\r\n\r\n            // silent update of the text field?\r\n\r\n            \r\n\r\n\r\n            // raise a change event?\r\n            //  other part of app will listen for change events.\r\n\r\n            // edit-complete event would be nicely specific.\r\n\r\n            ctrl.raise('edit-complete', {\r\n                old: initial_text,\r\n                value: new_text\r\n            });\r\n\r\n        }\r\n\r\n        // these will be hidden when not in editing mode.\r\n        //  or possibly not added to the DOM then?\r\n\r\n        let has_events = false;\r\n\r\n        const start_editing = () => {\r\n            ctrl.editing = true;\r\n            initial_text = ctrl.dom.el.textContent;\r\n            ctrl.add_class('editing');\r\n\r\n            //console.log('btn_cancel', btn_cancel);\r\n            sframe.add(btn_cancel, 'tl');\r\n            sframe.add(btn_ok, 'tr');\r\n\r\n            if (!has_events) {\r\n                btn_cancel.on('click', e => {\r\n                    cancel_editing();\r\n                })\r\n                btn_ok.on('click', e => {\r\n                    save_editing();\r\n                })\r\n                has_events = true;\r\n            }\r\n\r\n            // possible to focus on the point where it was clicked?\r\n            ctrl.dom.attributes.contenteditable = true;\r\n            // request animation frames to detect size changes?\r\n            //  or careful just to trigger resize events with that?\r\n            \r\n            // Possibly the suspended_frame should cover that.\r\n            //  RAF_Size_Monitor?\r\n            //  Resize_Watcher?\r\n            //   Seems like another mixin would help.\r\n            //  Self_Resize_Event?\r\n            //   Listening for size changes with requestanimationframe seems like it would do the job in many cases.\r\n            //    Won't be ideal for very many of them I expect.\r\n\r\n            //resize_watch(ctrl);\r\n            //  The frame will handle this.\r\n\r\n            \r\n\r\n\r\n\r\n\r\n            \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n            // Also need to keep the suspended frame item positions in sync.\r\n\r\n\r\n\r\n\r\n\r\n            // responde to keypresses etc?\r\n            //  or only change the content once the OK button is clicked?\r\n\r\n\r\n\r\n            // make contenteditable.\r\n            \r\n\r\n\r\n\r\n            // Not so sure about the problem here.\r\n            //  Auto-activating when placed in active doc looks like the best way.\r\n\r\n            /*\r\n\r\n            setTimeout(() => {\r\n                btn_cancel.activate();\r\n                btn_ok.activate();\r\n            }, 0);\r\n            */\r\n\r\n            \r\n\r\n\r\n\r\n            // A popup 'done' button.\r\n            // A popup 'cancel' button.\r\n\r\n            // suspended_frame.show();\r\n            //  shows the item within the suspended_frame.\r\n\r\n            // then these button presses...\r\n\r\n            /*\r\n            btn_cancel.on('press-end', e => {\r\n                cancel_editing();\r\n            })\r\n            btn_ok.on('press-end', e => {\r\n                save_editing();\r\n            })\r\n            */\r\n\r\n            \r\n            \r\n\r\n\r\n\r\n\r\n        }\r\n\r\n        \r\n        ctrl.on({\r\n            'press-end': e_press_end => {\r\n                console.log('e_press_end', e_press_end);\r\n\r\n                // if not editing, start editing.\r\n\r\n\r\n                if (!ctrl.editing) {\r\n                    start_editing();\r\n                }\r\n\r\n\r\n\r\n            }\r\n        })\r\n        /*\r\n        ctrl.on('press-end', e_press_end => {\r\n            console.log('e_press_end', e_press_end);\r\n        });\r\n        */\r\n\r\n    });\r\n    \r\n}\r\n\r\n\r\n// Nice to write the functionality as mixins.\r\n//  Makes it easier to move elsewhere, and makes this code clearer and more concise.\r\n\r\n\r\n\r\n\r\n// Looks interesting as a string editor.\r\n//   Could be another view for string editor.\r\n//     \r\n\r\n\r\n\r\n// String_Editor_Span?\r\n\r\n\r\nclass String_Span extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'string_span';\r\n        spec.tag_name = 'span';\r\n        spec.class = 'string';\r\n        super(spec);\r\n        // But be able to read the text from what's inside?\r\n        field(this, 'value', spec.value);\r\n        editable(this);\r\n\r\n        const {context} = this;\r\n\r\n        const compose = () => {\r\n            //console.log('Text_Node', Text_Node);\r\n            let tn = new Text_Node({\r\n                context: context,\r\n                text: spec.value\r\n            })\r\n            this.add(tn);\r\n        }\r\n        if (!spec.el) {\r\n            compose();\r\n        }\r\n\r\n\r\n        // Were we given a value in the spec?\r\n        //  If so, need to add the inner text node.\r\n\r\n\r\n        // New client-side lifecycle idea:\r\n        //  reconstruct stage.\r\n        //  reconstructs the control from the rendered HTML.\r\n        //   populating some values where necessary.\r\n\r\n\r\n        // having a reconstruct function as standard within the ctrl-enh lifecycle could be very useful.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // Need to respond to text change events.\r\n\r\n        // Will sometimes have another text node added within this during construction, rather than using the .value field.\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    // listen for edit-complete to update the .text property.\r\n    //  silent update?\r\n\r\n    activate() {\r\n        if (!this.__active) {\r\n            super.activate();\r\n\r\n            this.on({\r\n                'edit-complete': e => {\r\n                    const {old, value} = e;\r\n                    //console.log('String span edit complete', [old, value]);\r\n                    if (old !== value) {\r\n                        this.value = value;\r\n                    }\r\n                }\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // Popups outside of this?\r\n    //  Will need to position the popup divs within the DOM.\r\n    //  Suspended_Around_Bounding_Rect\r\n    //  Frame\r\n\r\n\r\n\r\n    // Popups around bounding rect (mixin)?\r\n    //  Would be very useful for a variety of things that appear around the frames / borders of controls.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // how / when does this get activated...?\r\n\r\n\r\n\r\n\r\n    // setup for hover....\r\n\r\n    // Click to edit\r\n\r\n    // Editable behaviour\r\n    //  Click to edit.\r\n\r\n\r\n\r\n\r\n    // \r\n}\r\n\r\nmodule.exports = String_Span;", "var jsgui = require('../../../../../html-core/html-core');\r\nvar stringify = jsgui.stringify,\r\n    each = jsgui.each,\r\n    tof = jsgui.tof;\r\nvar Control = jsgui.Control;\r\nconst Date_Picker = jsgui.Date_Picker;\r\n\r\n// Extending, with field values being set?\r\n//  Setting field values in definitions may be a useful thing.\r\n\r\n// Date_Time_Selector\r\n//  Not a calendar itself. Just used to select a Date value. Shows it on a calendar (fairly small).\r\n//  Could use a Calendar control though, with specific config not to show other things.\r\n//   Though could mark dates there too.\r\n\r\n// Date_Picker\r\n//  Maybe that will just have the date option.\r\n\r\n// Starting / default values.\r\n\r\n// From, to.\r\n// .span\r\n\r\n\r\n\r\n\r\n// text alias being title?\r\nclass Timespan_Selector extends Control {\r\n    // fields... text, value, type?\r\n    //  type could specify some kind of validation, or also 'password'.\r\n    // single field?\r\n    //  and can have other fields possibly.\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        spec.__type_name = spec.__type_name || 'timespan_selector';\r\n\r\n        super(spec);\r\n\r\n        if (spec.span) {\r\n            this.span = spec.span;\r\n\r\n        } else {\r\n            //\r\n            this.span = [];\r\n        }\r\n\r\n        if (!spec.skip_compose) {\r\n            this.compose();\r\n        }\r\n\r\n    }\r\n    compose() {\r\n        let context = this.context;\r\n        let date_from = this.span[0] || new Date('2018-06-20T11:00:00');\r\n        let date_to = this.span[0] || new Date('2018-08-20T11:00:00');\r\n        \r\n        let picker_from = new Date_Picker({\r\n            context: this.context,\r\n            date: date_from\r\n            \r\n        });\r\n        this.add(picker_from);\r\n\r\n        let picker_to = new Date_Picker({\r\n            context: this.context,\r\n            date: date_to\r\n            \r\n        });\r\n        this.add(picker_to);\r\n        \r\n    }\r\n};\r\nmodule.exports = Timespan_Selector;", "var jsgui = require('./../../../../html-core/html-core');\r\n//var Horizontal_Menu = require('./horizontal-menu');\r\n\r\nvar stringify = jsgui.stringify, each = jsgui.each, tof = jsgui.tof, is_defined = jsgui.is_defined;\r\nvar Control = jsgui.Control;\r\n\r\nvar Panel = require('./panel');\r\n// Panel with a titlebar inside\r\n\r\nvar Title_Bar = require('./title-bar');\r\nvar fields = {\r\n    'title': String\r\n}\r\n\r\n// Titled could even be some kind of mixin.\r\n\r\n// Tabbed panel seems more useful.\r\n// Tab bar is a radio button group (in disguise)\r\n\r\n// Tabbed_Panel?\r\n//   Tabbed_Multi_Content_Container???\r\n\r\n// The tabbed control would be very helpful for demoing various controls in a single spa / control.\r\n// Could have a window containing a bunch of different demos of different controls.\r\n\r\n\r\n\r\n\r\n\r\nclass Titled_Panel extends Panel {\r\n\r\n    constructor(spec) {\r\n        super(spec);\r\n        this.__type_name = 'titled_panel';\r\n\r\n        // And in composition, we add the title bar.\r\n\r\n        if (!spec.abstract && !spec.el) {\r\n            var title_bar = new Title_Bar({\r\n                'context': this.context,\r\n                'text': this.title\r\n            });\r\n            title_bar.active();\r\n            this.add(title_bar);\r\n\r\n            // Then an inner content control.\r\n            var inner_control = new Control({\r\n                'context': this.context\r\n            });\r\n            inner_control.active();\r\n            this.add(inner_control);\r\n\r\n            // Then want to set the jsgui control fields so that it knows what these are on the client-side too.\r\n            //  Will change this so it's got better syntax.\r\n            //  But for the moment want to use the pattern as it is, and better spot how to cover the cases.\r\n\r\n            //this.set('dom.attributes.data-jsgui-ctrl-fields', stringify({\r\n            //    'title_bar': title_bar._id(),\r\n            //    'inner_control': inner_control._id()\r\n            //}).replace(/\"/g, \"'\"));\r\n\r\n\r\n            // And want to be able to refer to the title_bar as an object.\r\n            // Also, want it so the inside of this control is where things get added, so there may need to be another content div.\r\n            //  Easier to do that than to keep the title always the first element.\r\n\r\n\r\n        }\r\n    }\r\n    'activate'() {\r\n        super.activate();\r\n\r\n        const {title_bar, inner_control} = this;\r\n\r\n        //console.log('title_bar', title_bar);\r\n        //console.log('inner_control', inner_control);\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Titled_Panel;", "/**\r\n * Toolbar - A horizontal container for tool buttons and controls\r\n * \r\n * Features:\r\n * - Horizontal layout with flexible items\r\n * - Separators between groups\r\n * - Icon + text buttons\r\n * - Tooltips\r\n */\r\n\r\nconst Control = require('../../../../html-core/control');\r\nconst Button = require('../../0-core/0-basic/0-native-compositional/button');\r\n\r\nclass Toolbar extends Control {\r\n    constructor(options = {}) {\r\n        super(options);\r\n        \r\n        this.add_class('toolbar');\r\n        \r\n        if (options.orientation === 'vertical') {\r\n            this.add_class('toolbar-vertical');\r\n        } else {\r\n            this.add_class('toolbar-horizontal');\r\n        }\r\n        \r\n        this.items = [];\r\n    }\r\n    \r\n    /**\r\n     * Add a button to the toolbar\r\n     */\r\n    addButton(config) {\r\n        const { context } = this;\r\n        const button = new Button({ context });\r\n        button.add_class('toolbar-button');\r\n        \r\n        if (config.icon) {\r\n            const icon = new Control({ context, tag_name: 'span' });\r\n            icon.add_class('toolbar-button-icon');\r\n            icon.add(config.icon);\r\n            button.add(icon);\r\n        }\r\n        \r\n        if (config.label) {\r\n            const label = new Control({ context, tag_name: 'span' });\r\n            label.add_class('toolbar-button-label');\r\n            label.add(config.label);\r\n            button.add(label);\r\n        }\r\n        \r\n        if (config.tooltip) {\r\n            button.dom.attributes.title = config.tooltip;\r\n        }\r\n        \r\n        if (config.onClick) {\r\n            button.on('click', config.onClick);\r\n        }\r\n        \r\n        this.add(button);\r\n        this.items.push(button);\r\n        \r\n        return button;\r\n    }\r\n    \r\n    /**\r\n     * Add a separator\r\n     */\r\n    addSeparator() {\r\n        const { context } = this;\r\n        const separator = new Control({ context, tag_name: 'div' });\r\n        separator.add_class('toolbar-separator');\r\n        this.add(separator);\r\n        this.items.push(separator);\r\n        return separator;\r\n    }\r\n    \r\n    /**\r\n     * Add a spacer (flexible space)\r\n     */\r\n    addSpacer() {\r\n        const { context } = this;\r\n        const spacer = new Control({ context, tag_name: 'div' });\r\n        spacer.add_class('toolbar-spacer');\r\n        this.add(spacer);\r\n        this.items.push(spacer);\r\n        return spacer;\r\n    }\r\n    \r\n    /**\r\n     * Add any custom control\r\n     */\r\n    addControl(control) {\r\n        control.add_class('toolbar-item');\r\n        this.add(control);\r\n        this.items.push(control);\r\n        return control;\r\n    }\r\n    \r\n    /**\r\n     * Clear all items\r\n     */\r\n    clear() {\r\n        this.content.clear();\r\n        this.items = [];\r\n    }\r\n}\r\n\r\nmodule.exports = Toolbar;\r\n", "const jsgui = require('./../../../../html-core/html-core');\r\nconst {Control} = jsgui;\r\nconst {prop, field} = require('obext');\r\n\r\nclass Toolbox extends Control {\r\n    constructor(spec) {\r\n        spec.__type_name = spec.__type_name || 'toolbox';\r\n        super(spec);\r\n        this.add_class('toolbox');\r\n    }\r\n}\r\n\r\nmodule.exports = Toolbox;", "var jsgui = require('./../../../../html-core/html-core');\r\nvar Horizontal_Menu = require('./../../../organised/1-standard/5-ui/horizontal-menu');\r\nconst Button = require('./../../../organised/0-core/0-basic/0-native-compositional/button');\r\nconst {def, each} = jsgui;\r\nvar Control = jsgui.Control;\r\nvar fields = {\r\n\t'title': String\r\n};\r\nconst {dragable, resizable} = require('../../../../control_mixins/mx');\r\nclass Window extends Control {\r\n\tconstructor(spec, add, make) {\r\n\t\tsuper(spec);\r\n\t\tthis.__type_name = 'window';\r\n\t\tthis.add_class('window');\r\n\t\tconst show_buttons = def(spec.show_buttons) ? spec.show_buttons : true;\r\n\t\tif (!spec.abstract && !spec.el) {\r\n\t\t\tconst {context} = this;\r\n\t\t\tconst div_relative = new Control({\r\n\t\t\t\tcontext\r\n\t\t\t});\r\n\t\t\tdiv_relative.add_class('relative');\r\n\t\t\tconst title_bar = new Control({\r\n\t\t\t\tcontext\r\n\t\t\t});\r\n\t\t\ttitle_bar.add_class('title');\r\n\t\t\ttitle_bar.add_class('bar');\r\n\t\t\tconst title_h2 = new jsgui.controls.h2({\r\n\t\t\t\tcontext\r\n\t\t\t})\r\n\t\t\ttitle_bar.add(title_h2);\r\n\t\t\tif (typeof spec.title === 'string') {\r\n\t\t\t\ttitle_h2.add(spec.title);\r\n\t\t\t}\r\n\t\t\tdiv_relative.add(title_bar);\r\n\t\t\tlet btn_minimize, btn_maximize, btn_close;\r\n\t\t\tif (show_buttons) {\r\n\t\t\t\tconst right_button_group = new Control({\r\n\t\t\t\t\tcontext\r\n\t\t\t\t});\r\n\t\t\t\tright_button_group.add_class('button-group');\r\n\t\t\t\tright_button_group.add_class('right');\r\n\t\t\t\tbtn_minimize = new Button({\r\n\t\t\t\t\tcontext\r\n\t\t\t\t});\r\n\t\t\t\tconst span = (text) => {\r\n\t\t\t\t\tconst res = new jsgui.controls.span({context});\r\n\t\t\t\t\tres.add(text);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}\r\n\t\t\t\tbtn_minimize.add(span('\u2296'));\r\n\t\t\t\tright_button_group.add(btn_minimize);\r\n\t\t\t\tbtn_maximize = new Button({\r\n\t\t\t\t\tcontext\r\n\t\t\t\t});\r\n\t\t\t\tbtn_maximize.add(span('\u2295'))\r\n\t\t\t\tright_button_group.add(btn_maximize);\r\n\t\t\t\tbtn_close = new Button({\r\n\t\t\t\t\tcontext\r\n\t\t\t\t});\r\n\t\t\t\tbtn_close.add(span('\u2297'))\r\n\t\t\t\tright_button_group.add(btn_close);\r\n\t\t\t\ttitle_bar.add(right_button_group);\r\n\t\t\t}\r\n\t\t\tconst ctrl_inner = new Control({\r\n\t\t\t\tcontext\r\n\t\t\t})\r\n\t\t\tctrl_inner.add_class('inner');\r\n\t\t\tdiv_relative.add(ctrl_inner);\r\n\t\t\tthis.add(div_relative);\r\n\t\t\tthis.ctrl_inner = ctrl_inner;\r\n\t\t\tthis.inner = ctrl_inner;\r\n\t\t\tthis.title_bar = title_bar;\r\n\t\t\tthis.ctrl_relative = div_relative;\r\n\t\t\tthis._ctrl_fields = this._ctrl_fields || {};\r\n\t\t\tthis._ctrl_fields.ctrl_inner = ctrl_inner;\r\n\t\t\tthis._ctrl_fields.inner = ctrl_inner;\r\n\t\t\tthis._ctrl_fields.title_bar = title_bar;\r\n\t\t\tthis._ctrl_fields.ctrl_relative = div_relative;\r\n\t\t\tif (show_buttons) {\r\n\t\t\t\tthis._ctrl_fields.btn_minimize = btn_minimize;\r\n\t\t\t\tthis._ctrl_fields.btn_maximize = btn_maximize;\r\n\t\t\t\tthis._ctrl_fields.btn_close = btn_close;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tbring_to_front_z() {\r\n\t\tlet max_z = 0;\r\n\t\teach(this.parent.content, (ctrl) => {\r\n\t\t\tif (ctrl !== this) {\r\n\t\t\t\tconst z = parseInt(ctrl.dom.attributes.style['z-index']);\r\n\t\t\t\tif (!isNaN(z) && z > max_z) max_z = z;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.dom.attributes.style['z-index'] = parseInt(max_z) + 1;\r\n\t}\r\n\tglide_to_pos(pos) {\r\n\t\treturn new Promise((s, j) => {\r\n\t\t\tconst [my_new_left, my_new_top] = pos;\r\n\t\t\tconst x_diff = my_new_left - this.ta[6];\r\n\t\t\tconst y_diff = my_new_top - this.ta[7];\r\n\t\t\tconst ms_total_animation_time = 140;\r\n\t\t\tlet animation_start;\r\n\t\t\tconst start_tx = this.ta[6];\r\n\t\t\tconst start_ty = this.ta[7];\r\n\t\t\tlet i_frame = 0;\r\n\t\t\tconst skip_zeroth_frame = false;\r\n\t\t\tconst process_frame = () => {\r\n\t\t\t\tif (skip_zeroth_frame && i_frame === 0) {\r\n\t\t\t\t\trequestAnimationFrame(timestamp => {\r\n\t\t\t\t\t\ti_frame++;\r\n\t\t\t\t\t\tprocess_frame();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\trequestAnimationFrame(timestamp => {\r\n\t\t\t\t\t\tif (!animation_start) {\r\n\t\t\t\t\t\t\tanimation_start = timestamp;\r\n\t\t\t\t\t\t\tprocess_frame();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst time_since = timestamp - animation_start;\r\n\t\t\t\t\t\t\tif (time_since < ms_total_animation_time) {\r\n\t\t\t\t\t\t\t\tconst proportion_through = time_since / ms_total_animation_time;\r\n\t\t\t\t\t\t\t\tconst proportional_x_diff = x_diff * proportion_through;\r\n\t\t\t\t\t\t\t\tconst proportional_y_diff = y_diff * proportion_through;\r\n\t\t\t\t\t\t\t\tthis.ta[6] = start_tx + proportional_x_diff;\r\n\t\t\t\t\t\t\t\tthis.ta[7] = start_ty + proportional_y_diff;\r\n\t\t\t\t\t\t\t\ti_frame++;\r\n\t\t\t\t\t\t\t\tprocess_frame();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.ta[6] = start_tx + x_diff;\r\n\t\t\t\t\t\t\t\tthis.ta[7] = start_ty + y_diff;\r\n\t\t\t\t\t\t\t\ts();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprocess_frame();\r\n\t\t})\r\n\t}\r\n\tasync minimize() {\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.minimize(this);\r\n\t\t} else {\r\n\t\t\tconst my_bcr = this.bcr();\r\n\t\t\tif (!this.has_class('minimized')) {\r\n\t\t\t\tconst width_to_minimize_to = 280;\r\n\t\t\t\tconst minimized_height = 31;\r\n\t\t\t\tif (this.has_class('maximized')) {\r\n\t\t\t\t\tthis.was_maximized_just_before_minimizing = true;\r\n\t\t\t\t\tthis.pre_minimized_pos = this.pre_maximized_pos;\r\n\t\t\t\t\tthis.pre_minimized_size = this.pre_maximized_size;\r\n\t\t\t\t\tthis.remove_class('maximized');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.was_maximized_just_before_minimizing = false;\r\n\t\t\t\t\tthis.pre_minimized_pos = my_bcr[0];\r\n\t\t\t\t\tthis.pre_minimized_size = my_bcr[2];\r\n\t\t\t\t}\r\n\t\t\t\tthis.dragable = false;\r\n\t\t\t\tconst parent_bcr = this.parent.bcr();\r\n\t\t\t\tconst parent_size = parent_bcr[2];\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.size = [width_to_minimize_to, minimized_height];\r\n\t\t\t\t}, 17)\r\n\t\t\t\tconst determine_pos_to_minimize_to = () => {\r\n\t\t\t\t\tlet minimized_sibling_window_bcrs = [];\r\n\t\t\t\t\teach(this.parent.content, (ctrl) => {\r\n\t\t\t\t\t\tif (ctrl !== this) {\r\n\t\t\t\t\t\t\tif (ctrl.has_class('window') && ctrl.has_class('minimized')) {\r\n\t\t\t\t\t\t\t\tconst ctrl_bcr = ctrl.bcr();\r\n\t\t\t\t\t\t\t\tminimized_sibling_window_bcrs.push(ctrl_bcr);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (minimized_sibling_window_bcrs.length > 0) {\r\n\t\t\t\t\t\tminimized_sibling_window_bcrs.sort((a, b) => {\r\n\t\t\t\t\t\t\tif (a[0][1] === b[0][1]) {\r\n\t\t\t\t\t\t\t\treturn a[1][0] - b[1][0];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn b[0][1] - a[0][1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconst last_bcr = minimized_sibling_window_bcrs.at(-1);\r\n\t\t\t\t\t\tconst last_r = last_bcr[1][0];\r\n\t\t\t\t\t\tconst extra_margin = 2;\r\n\t\t\t\t\t\tif (parent_size[0] >= last_r + width_to_minimize_to + extra_margin) {\r\n\t\t\t\t\t\t\treturn [last_bcr[1][0] + extra_margin, last_bcr[0][1]];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn [0, last_bcr[0][1] - extra_margin - minimized_height];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn [0, parent_size[1] - minimized_height];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst ltpos = [this.dom.attributes.style.left || 0, this.dom.attributes.style.top || 0].map(x => parseInt(x));\r\n\t\t\t\tconst dest_pos = determine_pos_to_minimize_to();\r\n\t\t\t\tdest_pos[0] -= ltpos[0];\r\n\t\t\t\tdest_pos[1] -= ltpos[1];\r\n\t\t\t\tawait this.glide_to_pos(dest_pos);\r\n\t\t\t\tthis.add_class('minimized');\r\n\t\t\t} else {\r\n\t\t\t\tif (this.was_maximized_just_before_minimizing) {\r\n\t\t\t\t\tawait this.maximize();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.size = this.pre_minimized_size;\r\n\t\t\t\t\t}, 17)\r\n\t\t\t\t\tconst ltpos = [this.dom.attributes.style.left || 0, this.dom.attributes.style.top || 0].map(x => parseInt(x));\r\n\t\t\t\t\tconst dest_pos = [this.pre_minimized_pos[0] - ltpos[0], this.pre_minimized_pos[1] - ltpos[1]];\r\n\t\t\t\t\tawait this.glide_to_pos(dest_pos);\r\n\t\t\t\t\tthis.remove_class('minimized');\r\n\t\t\t\t\tthis.dragable = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tasync maximize() {\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.maximize(this);\r\n\t\t} else {\r\n\t\t\tif (this.has_class('maximized')) {\r\n\t\t\t\tthis.remove_class('maximized');\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.size = [this.pre_maximized_size[0] - 2, this.pre_maximized_size[1] - 2];\r\n\t\t\t\t}, 17)\r\n\t\t\t\tthis.dragable = true;\r\n\t\t\t\tconst ltpos = [this.dom.attributes.style.left || 0, this.dom.attributes.style.top || 0].map(x => parseInt(x));\r\n\t\t\t\tconst dest_pos = [this.pre_maximized_pos[0] - ltpos[0], this.pre_maximized_pos[1] - ltpos[1]];\r\n\t\t\t\tawait this.glide_to_pos(dest_pos);\r\n\t\t\t} else {\r\n\t\t\t\tconst my_bcr = this.bcr();\r\n\t\t\t\tconst ltpos = [this.dom.attributes.style.left, this.dom.attributes.style.top].map(x => parseInt(x));\r\n\t\t\t\tif (this.has_class('minimized')) {\r\n\t\t\t\t\tthis.remove_class('minimized');\r\n\t\t\t\t\tthis.pre_maximized_pos = this.pre_minimized_pos;\r\n\t\t\t\t\tthis.pre_maximized_size = this.pre_minimized_size;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.pre_maximized_pos = my_bcr[0];\r\n\t\t\t\t\tthis.pre_maximized_size = my_bcr[2];\r\n\t\t\t\t}\r\n\t\t\t\tthis.add_class('maximized');\r\n\t\t\t\tthis.dragable = false;\r\n\t\t\t\tconst parent_bcr = this.parent.bcr();\r\n\t\t\t\tconst parent_size = parent_bcr[2];\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.size = [parent_size[0] - 4, parent_size[1] - 4];\r\n\t\t\t\t}, 17)\r\n\t\t\t\tconst [tx, ty] = [this.ta[6], this.ta[7]];\r\n\t\t\t\tconst dest_pos = [0 - ltpos[0], 0 - ltpos[1]];\r\n\t\t\t\tawait this.glide_to_pos(dest_pos);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tclose() {\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.close(this);\r\n\t\t} else {\r\n\t\t\tthis.remove();\r\n\t\t}\r\n\t}\r\n\t'activate'() {\r\n\t\tif (!this.__active) {\r\n            super.activate();\r\n\t\t\tconst {title_bar, btn_minimize, btn_maximize, btn_close} = this;\r\n\t\t\tif (btn_close) {\r\n\t\t\t\tbtn_close.on('click', () => {\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t})\r\n\t\t\t\tbtn_close.on('press', () => {\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif (btn_maximize) {\r\n\t\t\t\tbtn_maximize.on('click', () => {\r\n\t\t\t\t\tthis.maximize();\r\n\t\t\t\t})\r\n\t\t\t\tbtn_maximize.on('press', () => {\r\n\t\t\t\t\tthis.maximize();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif (btn_minimize) {\r\n\t\t\t\tbtn_minimize.on('click', () => {\r\n\t\t\t\t\tthis.minimize();\r\n\t\t\t\t})\r\n\t\t\t\tbtn_minimize.on('press', () => {\r\n\t\t\t\t\tthis.minimize();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\ttitle_bar.on('dblclick', () => {\r\n\t\t\t\tthis.maximize();\r\n\t\t\t})\r\n\t\t\tthis.on('mousedown', () => {\r\n\t\t\t\tthis.bring_to_front_z();\r\n\t\t\t});\r\n\t\t\tdragable(this, {\r\n                drag_mode: 'translate',\r\n\t\t\t\thandle: this.title_bar,\r\n\t\t\t\tbounds: this.parent\r\n            });\r\n            this.dragable = true;\r\n\t\t\tresizable(this, {\r\n\t\t\t\tresize_mode: 'br_handle',\r\n\t\t\t\tbounds: [[120, 80], undefined],\r\n\t\t\t\textent_bounds: this.parent\r\n\t\t\t});\r\n\t\t\tsetInterval(() => {\r\n\t\t\t\tif (this.has_class('minimized')) {\r\n\t\t\t\t\tconst extended_bcr = this.bcr().extend('left', 80);\r\n\t\t\t\t\tconst minimized_siblings = this.siblings.filter(x => x.has_class('minimized'));\r\n\t\t\t\t\tconst overlaps = extended_bcr.overlaps(minimized_siblings);\r\n\t\t\t\t\tif (overlaps && overlaps.length > 0) {\r\n\t\t\t\t\t\tconst max_overlap_width = Math.max(...overlaps.map(x => x.w))\r\n\t\t\t\t\t\tif (max_overlap_width <= 78) {\r\n\t\t\t\t\t\t\tconst parent_bcr = this.parent.bcr();\r\n\t\t\t\t\t\t\tconst parent_left = parent_bcr[0][0];\r\n\t\t\t\t\t\t\tconst my_bcr = this.bcr();\r\n\t\t\t\t\t\t\tconst my_left = my_bcr[0][0];\r\n\t\t\t\t\t\t\tconst dist_from_parent_left = my_left - parent_left;\r\n\t\t\t\t\t\t\tif (dist_from_parent_left > 2) {\r\n\t\t\t\t\t\t\t\tthis.ta[6] = this.ta[6] - 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst parent_bcr = this.parent.bcr();\r\n\t\t\t\t\t\tconst parent_left = parent_bcr[0][0];\r\n\t\t\t\t\t\tconst my_bcr = this.bcr();\r\n\t\t\t\t\t\tconst my_left = my_bcr[0][0];\r\n\t\t\t\t\t\tconst dist_from_parent_left = my_left - parent_left;\r\n\t\t\t\t\t\tif (dist_from_parent_left > 2) {\r\n\t\t\t\t\t\t\tif (dist_from_parent_left > 8) {\r\n\t\t\t\t\t\t\t\tthis.ta[6] = this.ta[6] - 8;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.ta[6] = this.ta[6] - dist_from_parent_left;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 18);\r\n\t\t}\r\n\t}\r\n}\r\nWindow.css = `\r\n.relative {\r\n\tposition: relative;\r\n}\r\n.window.no-transitions {\r\n\ttransition: none !important; \r\n}\r\n:root {\r\n\t--rhsqsize: 16px;\r\n}\r\n.resize-handle {\r\n\twidth: var(--rhsqsize);\r\n\theight: var(--rhsqsize);\r\n\tcolor: #CCCCCC;\r\n\topacity: 0.45;\r\n\tposition: absolute;\r\n\tline-height: var(--rhsqsize);\r\n\tfont-size: var(--rhsqsize);\r\n\tuser-select: none;\r\n\ttransition: color 0.14s ease-in-out, opacity 0.14s ease-in-out;\r\n}\r\n.resize-handle:hover {\r\n\tcolor: #EFCF00;\r\n\topacity: 0.5;\r\n}\r\n.resize-handle.resizing {\r\n\tcolor: #FFDF00;\r\n\topacity: 1;\r\n}\r\n.bottom-right.resize-handle {\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tcursor: nwse-resize;\r\n\tz-index: 10000001;\r\n}\r\n.window {\r\n    position: absolute;\r\n    border: 1px solid #CCCCCC;\r\n\tbackground-color: #F4F4F4;\r\n\twidth: 360px;\r\n\theight: 360px;\r\n\tborder-radius: 5px;\r\n\ttransition: width 0.14s linear, height 0.14s linear; \r\n\toverflow: hidden;\r\n\t-webkit-user-select: none;\r\n\tuser-select: none;\r\n}\r\n.window .relative {\r\n\theight: inherit;\r\n\toverflow: hidden;\r\n}\r\n.window.minimized {\r\n\theight: 31px;\r\n}\r\n.window.minimized .bottom-right.resize-handle {\r\n\tdisplay: none;\r\n}\r\n.window.maximized .bottom-right.resize-handle {\r\n\tdisplay: none;\r\n}\r\n.window .title.bar {\r\n    height: 31px;\r\n\tbackground-color: #0D4F8B;\r\n\tbackground-image: linear-gradient(to right, #0D4F8B , #3fb0d9);\r\n    color: #FFFFFF;\r\n    font-size: 12px;\r\n    line-height: 32px;\r\n    text-indent: 4px;\r\n    -webkit-box-shadow: inset 0px -2px 2px -2px rgba(0, 0, 0, 0.75);\r\n    -moz-box-shadow: inset 0px -2px 2px -2px rgba(0, 0, 0, 0.75);\r\n    box-shadow: inset 0px -2px 2px -2px rgba(0, 0, 0, 0.75);\r\n\tborder-radius: 4px;\r\n\t-webkit-user-select: none;\r\n\tuser-select: none;\r\n\toverflow: hidden;\r\n\tcursor: default;\r\n}\r\n.window .title.bar h2 {\r\n\tfont-weight: 400;\r\n\tmargin-left: 42px;\r\n\tfloat: left;\r\n}\r\n.window .title.bar > span {\r\n    vertical-align: middle;\r\n    line-height: 31px;\r\n}\r\n.window .title.bar .button > span {\r\n\ttransform: scale(2);\r\n    display: inline-block;\r\n\tline-height: 13px;\r\n    height: 14px;\r\n}\r\n.window .title.bar .right {\r\n    margin-right: 2px;\r\n    margin-top: 2px;\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n\theight: 29px;\r\n}\r\n.window .title.bar .button {\r\n    width: 26px;\r\n\theight: 26px;\r\n\tline-height: 24px;\r\n\tfont-size: 14px;\r\n}\r\n.window .title.bar .button + .button {\r\n    margin-left: 3px;\r\n}\r\n.window .relative .inner {\r\n\twidth: 100%;\r\n\theight: calc(100% - 31px);\r\n}\r\n`\r\nmodule.exports = Window;\r\n", "\r\n\r\n\r\n\r\nconst controls = {\r\n    Active_HTML_Document: require('./organised/1-standard/5-ui/Active_HTML_Document'),\r\n    Arrow_Button: require('./organised/0-core/1-advanced/vector/arrow-button'),\r\n    //Audio_Player: require('./audio-player'),\r\n    Audio_Volume: require('./organised/1-standard/5-ui/audio-volume'),\r\n    Button: require('./organised/0-core/0-basic/0-native-compositional/button'),\r\n    Cell: require('./organised/0-core/0-basic/1-compositional/Cell'),\r\n    // Maybe more advanced?\r\n    Context_Menu: require('./organised/0-core/0-basic/1-compositional/context-menu'),\r\n    //Control: \r\n    Color_Grid: require('./organised/0-core/0-basic/1-compositional/color-palette'),\r\n    Color_Palette: require('./organised/0-core/0-basic/1-compositional/color-palette'),\r\n    Checkbox: require('./organised/0-core/0-basic/0-native-compositional/checkbox'),\r\n    Combo_Box: require('./organised/0-core/0-basic/1-compositional/combo-box'),\r\n    Dropdown_Menu: require('./organised/0-core/0-basic/1-compositional/Dropdown_Menu'),\r\n    // Not using (data-)connected controls.\r\n    //Data_Grid: require('./connected/data-grid'),\r\n    File_Upload: require('./organised/0-core/0-basic/0-native-compositional/file-upload'),\r\n    Form_Field: require('./organised/1-standard/1-editor/form_field'),\r\n    // maybe 0-basic/0-layout?\r\n    //  A layout control may be / need to be displayed a little differently.\r\n    Grid: require('./organised/0-core/0-basic/1-compositional/grid'),\r\n    Grid_Cell: require('./organised/0-core/0-basic/1-compositional/grid').Cell,\r\n    Horizontal_Menu: require('./organised/1-standard/5-ui/horizontal-menu'),\r\n    Horizontal_Slider: require('./organised/1-standard/5-ui/horizontal-slider'),\r\n    //Data_Item: require('./data-item'),\r\n    Data_Row: require('./organised/1-standard/4-data/data-row'),\r\n    Date_Picker: require('./organised/0-core/0-basic/0-native-compositional/date-picker'),\r\n    Dropdown_List: require('./organised/0-core/0-basic/0-native-compositional/dropdown-list'),\r\n    // Exclude the connected ones for the moment. Moment passed.\r\n    // May not need to actually be 'connected'?\r\n    //  Or other controls may get data connections too.\r\n    File_Tree: require('./organised/1-standard/5-ui/file-tree'),\r\n    File_Tree_Node: require('./organised/1-standard/5-ui/file-tree-node'),\r\n    Icon: require('./organised/0-core/0-basic/0-native-compositional/icon'),\r\n    Item: require('./organised/0-core/0-basic/1-compositional/item'),\r\n    Item_Selector: require('./organised/0-core/0-basic/1-compositional/item-selector'),\r\n    //Item_View: require('./old/item-view'),\r\n    Left_Right_Arrows_Selector: require('./organised/1-standard/2-misc/left-right-arrows-selector'),\r\n    //Vector: require('./vector'),\r\n    Line_Chart: require('./organised/1-standard/5-ui/line-chart'),\r\n    List: require('./organised/0-core/0-basic/1-compositional/list'),\r\n    // could be in forms / standard forms.\r\n    Login: require('./organised/0-core/1-advanced/login'),\r\n    //Media_Scrubber: require('./media-scrubber'),\r\n    Menu_Node: require('./organised/0-core/0-basic/1-compositional/menu-node'),\r\n    Modal: require('./organised/1-standard/6-layout/modal'),\r\n    Month_View: require('./organised/0-core/0-basic/1-compositional/month-view'),\r\n    //Multi_Document_Interface: require('./multi-document-interface'),\r\n    Multi_Layout_Mode: require('./organised/1-standard/6-layout/app/multi-layout-mode'),\r\n    //Object_Editor: require('./editor/object'),\r\n    Panel: require('./organised/1-standard/6-layout/panel'),\r\n    Plus_Minus_Toggle_Button: require('./organised/0-core/0-basic/1-compositional/plus-minus-toggle-button'),\r\n    Property_Editor: require('./organised/1-standard/1-editor/property_editor'),\r\n    // More advanced functionality - may require more work to keep it with the right APIs.\r\n    Popup_Menu_Button: require('./organised/0-core/1-advanced/popup-menu-button'),\r\n    Radio_Button: require('./organised/0-core/0-basic/0-native-compositional/radio-button'),\r\n    Radio_Button_Group: require('./organised/0-core/0-basic/1-compositional/radio-button-group'),\r\n    //Resize_Handle: require('./organised/0-core/0-basic/_resize-handle'),\r\n    Rich_Text_Editor: require('./organised/1-standard/1-editor/Rich_Text_Editor'),\r\n    Scroll_View: require('./organised/0-core/0-basic/1-compositional/scroll-view'),\r\n    Scrollbar: require('./organised/0-core/0-basic/1-compositional/scrollbar'),\r\n    Search_Bar: require('./organised/1-standard/5-ui/search-bar'),\r\n    Select_Options: require('./organised/0-core/0-basic/0-native-compositional/Select_Options'),\r\n    Single_Line: require('./organised/1-standard/6-layout/single-line'),\r\n    Standard_Web_Page: require('./organised/1-standard/3-page/standard-web-page'),\r\n    Start_Stop_Toggle_Button: require('./organised/1-standard/5-ui/start-stop-toggle-button'),\r\n    String_Span: require('./organised/0-core/1-advanced/string-span'),\r\n    Tabbed_Panel: require('./organised/1-standard/6-layout/tabbed-panel'),\r\n    Text_Field: require('./organised/0-core/0-basic/1-compositional/Text_Field'),\r\n    Text_Item: require('./organised/0-core/0-basic/1-compositional/text-item'),\r\n    Text_Input: require('./organised/0-core/0-basic/0-native-compositional/Text_Input'),\r\n    Tile_Slider: require('./organised/1-standard/6-layout/tile-slide'),\r\n    // May be moved to vector?\r\n    Timespan_Selector: require('./organised/0-core/0-basic/1-compositional/timespan-selector'),\r\n    Title_Bar: require('./organised/1-standard/6-layout//title-bar'),\r\n    Titled_Panel: require('./organised/1-standard/6-layout/titled-panel'),\r\n    Toggle_Button: require('./organised/0-core/0-basic/1-compositional/toggle-button'),\r\n    Toolbar: require('./organised/1-standard/5-ui/Toolbar'),\r\n    Toolbox: require('./organised/1-standard/5-ui/toolbox'),\r\n    Tree: require('./organised/1-standard/5-ui/tree'),\r\n    Tree_Node: require('./organised/1-standard/5-ui/tree-node'),\r\n    Vertical_Expander: require('./organised/1-standard/6-layout/vertical-expander'),\r\n    Window: require('./organised/1-standard/6-layout/window'),//,\r\n    //mx: require('../control_mixins/mx')\r\n    Indicator: require('./organised/0-core/0-basic/1-compositional/Indicator'),\r\n    Status_Indicator: require('./organised/0-core/0-basic/1-compositional/Status_Indicator'),\r\n    Validation_Status_Indicator: require('./organised/0-core/0-basic/1-compositional/Validation_Status_Indicator')\r\n}\r\n\r\n// a show_validation_status mixin perhaps???\r\n// though having a place in the control where it can display the validation status would be nice too.\r\n//   The validation status of the view.model\r\n//     view.model.validate perhaps ....?\r\n\r\n// Though having the view model copy the data model, including data type and validation function.\r\n\r\n//   Maybe do more applying validation status to Text_Input too?\r\n//   Maybe make a control that contains both the DMVM Control as well as a validation status indicator.\r\n\r\n// Being able to get a validation status indicator there for a control with as little top level code as possible will help.\r\n\r\n// Could definitely do with improved html / xhtml like control parsing and composition.\r\n//  Done the basics of it, may need to improve it to cover more cases.\r\n//  Can use this to cut down on composition code.\r\n\r\n// compose, render, activate, modify\r\n\r\nmodule.exports = controls;", "const jsgui = require('./html-core/html-core');\r\njsgui.Router = require('./router/router');\r\njsgui.Resource = require('./resource/resource');\r\njsgui.Resource_Pool = require('./resource/pool');\r\njsgui.Resource.Data_KV = require('./resource/data-kv-resource');\r\njsgui.Resource.Data_Transform = require('./resource/data-transform-resource');\r\njsgui.Resource.Compilation = require('./resource/compilation-resource');\r\njsgui.Resource.Compiler = require('./resource/compiler-resource');\r\njsgui.gfx = require('jsgui3-gfx-core');\r\njsgui.Resource.load_compiler = (name, jsfn, options) => {\r\n    throw 'NYI';\r\n}\r\njsgui.controls = jsgui.controls || {};\r\n//jsgui.controls.Active_HTML_Document = jsgui.Active_HTML_Document = require('./controls/organised/1-standard/5-ui/Active_HTML_Document');\r\nObject.assign(jsgui.controls, require('./controls/controls'));\r\nObject.assign(jsgui, jsgui.controls);\r\njsgui.mixins = jsgui.mx = require('./control_mixins/mx');\r\nmodule.exports = jsgui;", "/*\r\n define(['../../web/jsgui-html', './client-resource', './pool'],\r\n\r\n function(jsgui, Resource, Resource_Pool) {\r\n */\r\n\r\n // Got a lot of this code to delete / refresh / make more concise once things are more fully working.\r\n //  Especially regarding parse_mount and controls.\r\n //   Want to shrink down the package size a lot.\r\n\r\n // Once the API is stable, could create a build that uses many local variables.\r\n //  Could make a build process that does that.\r\n //   Would be nice to make a core / small jsgui build that fits in 5KB compressed. 15 would be nice too etc.\r\n //    Much will be possible with abstractions over the patterns.\r\n\r\n\r\nvar jsgui = require('jsgui3-html');\r\n//var Resource = require('./client-resource');\r\nvar Resource_Pool = jsgui.Resource_Pool;\r\n\r\nconst fnl = require('fnl');\r\nconst prom_or_cb = fnl.prom_or_cb;\r\n\r\n// Client_Resource?\r\n//  I think that makes sense, so that we have something specific which has the URL attached.\r\n//   It is able to make HTTP requests to the server resource.\r\n\r\n//const Data_Resource = require('./data-resource');\r\n\r\n/*\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\tarrayify = jsgui.arrayify,\r\n\ttof = jsgui.tof;\r\nvar filter_map_by_regex = jsgui.filter_map_by_regex;\r\nvar Class = jsgui.Class,\r\n\tData_Object = jsgui.Data_Object;\r\nvar fp = jsgui.fp,\r\n\tis_defined = jsgui.is_defined;\r\nvar Collection = jsgui.Collection;\r\n*/\r\n\r\n//var exec = require('child_process').exec;\r\n\r\n// Perhaps this will have HTTP endpoints as well?\r\n//  Maybe we can access it through url/resources/\r\n\r\n// Perhaps a resource publisher, or a few of them could be useful.\r\n//  HTTP_Resource_Publisher?\r\n//  Generally publishes a resource over HTTP.\r\n//   Will have some authorization and authentication properties, hooked up with the proper providers.\r\n\r\n// This may be the place in which remote access to the resources is given.\r\n//  It would make sense.\r\n//  Perhaps it is worth using a resource publisher? Then is that a resource?\r\n//  I think the resource pool may be the sensible point of access.\r\n\r\n\r\n// Possibly all websocket communications for all client-side resources will go through the pool.\r\n//  May need to specify which server in particular we connect to over websocket.\r\n//   However, having front-end back-end servers could work well, that redirect to other servers, thereby providing one endpoint, and balance the load.\r\n\r\n/*\r\nvar fields = {\r\n\t'url': String\r\n};\r\n*/\r\nclass Client_Resource_Pool extends Resource_Pool {\r\n\t//'fields': ,\r\n\tconstructor(spec) {\r\n\t\t//this._super(spec);\r\n\t\tsuper(spec);\r\n\r\n\r\n\t\t// No need to start it in particular?\r\n\t\t//  Sometimes the data resource will operate over websockets\r\n\r\n\t\t//  Sometimes SSE would be better.\r\n\r\n\t\t//let data_resource = new Data_Resource({\r\n\t\t//\t'name': 'Data Resource'\r\n\t\t//});\r\n\t\t//console.log('pre add data_resource', data_resource);\r\n\t\t//this.add(data_resource);\r\n\r\n\r\n\t}\r\n\t'start'(callback) {\r\n\r\n\t\treturn prom_or_cb((resolve, reject) => {\r\n\t\t\t//callback(null, true);\r\n\t\t\tresolve(true);\r\n\t\t}, callback);\r\n\r\n\r\n\t}\r\n\r\n}\r\nmodule.exports = Client_Resource_Pool;", "var jsgui = require('jsgui3-html');\r\nconst {\r\n    Control,\r\n    controls,\r\n    deep_sig,\r\n    each\r\n} = jsgui;\r\nconst {\r\n    Modal\r\n} = controls;\r\nvar Client_Resource_Pool = require('./client-resource-pool');\r\nconst X = 0,\r\n    Y = 1,\r\n    H = 2,\r\n    W = 3,\r\n    R = 4,\r\n    B = 5,\r\n    TX = 6,\r\n    TY = 7;\r\nclass Client_Page_Context extends jsgui.Page_Context {\r\n    constructor(spec) {\r\n        spec = spec || {};\r\n        super(spec);\r\n        const {\r\n            map_controls,\r\n            map_control_iids,\r\n            next_iid\r\n        } = this;\r\n        this.document = spec.document || document;\r\n        this.resource_pool = new Client_Resource_Pool({});\r\n        this.__is_active = true;\r\n        this.map_els = {};\r\n        let ctrl_modal;\r\n\r\n        this.mixins = jsgui.mixins;\r\n\r\n        // Modal and overlay may be better implemented with mixins perhaps.\r\n\r\n        Object.defineProperty(this, 'modal', {\r\n            get() {\r\n                if (ctrl_modal) {\r\n                    return ctrl_modal;\r\n                } else {\r\n                    ctrl_modal = new Modal({\r\n                        context: this,\r\n                        class: 'modal'\r\n                    });\r\n                    const body = this.body();\r\n                    if (body) {\r\n                        body.add(ctrl_modal);\r\n                    }\r\n                    return ctrl_modal;\r\n                }\r\n            },\r\n            enumerable: true\r\n        });\r\n        let ctrl_overlay;\r\n        Object.defineProperty(this, 'overlay', {\r\n            get() {\r\n                if (ctrl_overlay) {\r\n                    return ctrl_overlay;\r\n                } else {\r\n                    ctrl_overlay = new Control({\r\n                        context: this,\r\n                        class: 'overlay'\r\n                    });\r\n                    const body = this.body();\r\n                    if (body) {\r\n                        body.add(ctrl_overlay);\r\n                        ctrl_overlay.activate();\r\n                    }\r\n                    ctrl_overlay.place = (ctrl, location) => {\r\n                        const sloc = deep_sig(location);\r\n                        let placement_abs_pos;\r\n                        if (sloc === '[s,C]') {\r\n                            const [str_description, ctrl_target] = location;\r\n                            const target_bcr = ctrl_target.bcr();\r\n                            const overlay_bcr = ctrl_overlay.bcr();\r\n                            if (str_description === 'below') {\r\n                                placement_abs_pos = [target_bcr[0][0], target_bcr[1][1]];\r\n                                const overlay_size = overlay_bcr[1];\r\n                                const body_size = body.bcr()[1];\r\n                                const height_left_below_placement = body_size[1] - placement_abs_pos[1];\r\n                                ctrl.pos = placement_abs_pos;\r\n                                ctrl.dom.attributes.style.position = 'absolute';\r\n                                ctrl.dom.attributes.style['max-height'] = height_left_below_placement + 'px';\r\n                            } else {\r\n                                console.trace();\r\n                                throw 'NYI';\r\n                            }\r\n                        }\r\n                        ctrl_overlay.add(ctrl);\r\n                    }\r\n                    return ctrl_overlay;\r\n                }\r\n            },\r\n            enumerable: true\r\n        });\r\n        let frame_num = 0;\r\n        let last_timestamp;\r\n        let was_resized = false;\r\n        this.map_controls_being_removed_in_frame = false;\r\n        this.map_controls_being_added_in_frame = false;\r\n        let map_ctrls_in_last_frame = {};\r\n        let map_ctrls_in_this_frame;\r\n        let count_dom_ctrls = 0;\r\n        const num_data_points_per_ctrl = 32;\r\n\r\n        // May want to simplify this in terms of API, make a page or two explaining it, and maybe make it disabled by default\r\n        //.  or used on a lower level only by things that need it.\r\n\r\n        // Could see about making use of this for detecing overlaps of siblings in a rectangle that extends from the left of a control.\r\n\r\n        // This may be better integrated with some code more specific to geometries.\r\n        //.  Could have some kinds of observers that watch the values that represent the geometries of various controls.\r\n\r\n\r\n\r\n        \r\n\r\n        this.on('activate', () => {\r\n            //console.log('activated client page_context.... ***** map_controls', map_controls);\r\n            each(map_controls, (ctrl, jsgui_id) => {\r\n                if (ctrl.dom?.el) {\r\n                    map_ctrls_in_last_frame[jsgui_id] = ctrl;\r\n                    count_dom_ctrls++;\r\n                }\r\n            });\r\n            let ta_last_frame;\r\n            let ta_current_frame_stored;\r\n            let ta_current_frame_for_user;\r\n            let ta_user_frame_changes;\r\n            let map_current_dom_ctrl_iids;\r\n            let map_current_dom_ctrls_by_iid = {};\r\n            const create_controls_number_props_ta = () => {\r\n                const ta_length = num_data_points_per_ctrl * count_dom_ctrls;\r\n                const res = new Float32Array(ta_length);\r\n                const create_map_ctrls_iids = (map_dom_ctrls) => {\r\n                    const keys = Object.keys(map_dom_ctrls);\r\n                    const res = {};\r\n                    each(keys, (jsgui_id, i) => {\r\n                        res[jsgui_id] = i;\r\n                        map_current_dom_ctrls_by_iid[i] = map_dom_ctrls[jsgui_id];\r\n                    })\r\n                    return res;\r\n                }\r\n                map_current_dom_ctrl_iids = create_map_ctrls_iids(map_ctrls_in_last_frame);\r\n                const record_ctrls_info = (map_dom_ctrls, map_dom_ctrl_iids, ta) => {\r\n                    each(map_dom_ctrls, (ctrl, jsgui_id) => {\r\n                        const iid = map_dom_ctrl_iids[jsgui_id];\r\n                        const el = ctrl.dom.el;\r\n                        const bcr = el.getBoundingClientRect();\r\n                        const start_pos = iid * num_data_points_per_ctrl;\r\n                        let wpos = start_pos;\r\n                        ta[wpos++] = bcr.left;\r\n                        ta[wpos++] = bcr.top;\r\n                        ta[wpos++] = bcr.width;\r\n                        ta[wpos++] = bcr.height;\r\n                        ta[wpos++] = bcr.right;\r\n                        ta[wpos++] = bcr.bottom;\r\n\r\n                        // t3dx: ta[6]\r\n                        // t3dy: ta[7]\r\n                        // t3dz: ta[8]\r\n                    });\r\n                }\r\n                record_ctrls_info(map_ctrls_in_last_frame, map_current_dom_ctrl_iids, res);\r\n                return res;\r\n            }\r\n            const assign_ctrls_ta_subarrays = (ta_current_frame_for_user, map_dom_controls, map_iids) => {\r\n                each(map_dom_controls, (ctrl, jsgui_id) => {\r\n                    const ctrl_iid = map_iids[jsgui_id];\r\n                    const pos_start = ctrl_iid * num_data_points_per_ctrl;\r\n                    const pos_end = pos_start + num_data_points_per_ctrl;\r\n                    ctrl.ta = ta_current_frame_for_user.subarray(pos_start, pos_end);\r\n                });\r\n            }\r\n            const frame_process = (timestamp) => {\r\n                frame_num++;\r\n                const find_control_numeric_values_changed = () => {\r\n                    let i_ctrl = 0;\r\n                    let pos = 0;\r\n                    const l = ta_current_frame_for_user.length;\r\n                    let has_change;\r\n                    const ta_controls_which_have_changed_iids = new Int8Array(count_dom_ctrls);\r\n                    ta_controls_which_have_changed_iids.fill(-1);\r\n                    let tacwhci_wpos = 0;\r\n                    while (pos < l) {\r\n                        const change = ta_current_frame_for_user[pos] - ta_current_frame_stored[pos];\r\n                        let ctrl_iid = Math.floor(pos / num_data_points_per_ctrl);\r\n                        if (change !== 0) {\r\n                            has_change = true;\r\n                            ta_controls_which_have_changed_iids[tacwhci_wpos++] = ctrl_iid;\r\n                        }\r\n                        ta_user_frame_changes[pos] = change;\r\n                        pos++;\r\n                    }\r\n                    if (has_change) {\r\n                        let c = 0;\r\n                        let l = ta_user_frame_changes.length;\r\n                        let stop = false;\r\n                        while (!stop && c < l) {\r\n                            const ctrl_iid = ta_controls_which_have_changed_iids[c];\r\n                            if (ctrl_iid === -1) {\r\n                                stop = true;\r\n                            } else {\r\n                                const changed_ctrl = map_current_dom_ctrls_by_iid[ctrl_iid];\r\n                                const ta_ctrl_changes = ta_user_frame_changes.subarray(ctrl_iid * num_data_points_per_ctrl, (ctrl_iid + 1) * num_data_points_per_ctrl);\r\n                                const ctrl_ta = changed_ctrl.ta;\r\n                                let i = 0,\r\n                                    l = ctrl_ta.length;\r\n                                let changed_transform = false;\r\n                                for (i = 0; i < l; i++) {\r\n                                    if (ta_ctrl_changes[i] !== 0) {\r\n                                        const new_val = ctrl_ta[i];\r\n                                        const X = 0,\r\n                                            Y = 1,\r\n                                            H = 2,\r\n                                            W = 3,\r\n                                            R = 4,\r\n                                            B = 5,\r\n                                            TX = 6,\r\n                                            TY = 7;\r\n                                        if (i === 1) {\r\n                                        } else if (i === 2) {\r\n                                        } else if (i === 3) {\r\n                                        } else if (i === 4) {\r\n                                        } else if (i === 5) {\r\n                                        } else if (i === 6 || i === 7) {\r\n                                            if (!changed_transform) {\r\n                                                const tx = ctrl_ta[6];\r\n                                                const ty = ctrl_ta[7];\r\n                                                changed_ctrl.dom.attributes.style.transform = 'translate3d(' + tx + 'px, ' + ty + 'px, 0px)';\r\n                                                changed_transform = true;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                                let w_pos_ctrl = ctrl_iid * num_data_points_per_ctrl;\r\n                                for (let i = 0; i < l; i++) {\r\n                                    ta_current_frame_stored[w_pos_ctrl++] = ctrl_ta[i];\r\n                                }\r\n                            }\r\n                            c++;\r\n                        }\r\n                    }\r\n                }\r\n                if (frame_num > 1) {\r\n                    find_control_numeric_values_changed();\r\n                } else {\r\n                    assign_ctrls_ta_subarrays(ta_current_frame_for_user, map_ctrls_in_last_frame, map_current_dom_ctrl_iids);\r\n                }\r\n                let count_add = 0;\r\n                let count_remove = 0;\r\n                if (frame_num === 1) {} else {\r\n                    map_ctrls_in_this_frame = {};\r\n                }\r\n                if (this.map_controls_being_removed_in_frame) {\r\n                    //console.log('this.map_controls_being_removed_in_frame', this.map_controls_being_removed_in_frame);\r\n                    each(map_ctrls_in_last_frame, (ctrl_in_last_frame, ctrl_id) => {\r\n                        if (!this.map_controls_being_removed_in_frame[ctrl_id]) {\r\n                            map_ctrls_in_this_frame[ctrl_id] = ctrl_in_last_frame;\r\n                        }\r\n                    });\r\n                    count_remove += Object.keys(this.map_controls_being_removed_in_frame).length;\r\n                    this.map_controls_being_removed_in_frame = false;\r\n                } else {\r\n                    map_ctrls_in_this_frame = map_ctrls_in_last_frame;\r\n                }\r\n                if (this.map_controls_being_added_in_frame) {\r\n                    //console.log('this.map_controls_being_added_in_frame', this.map_controls_being_added_in_frame);\r\n                    this.map_controls_being_added_in_frame = false;\r\n                    each(this.map_controls_being_added_in_frame, (ctrl_added, ctrl_id) => {\r\n                        map_ctrls_in_this_frame[ctrl_id] = ctrl_added;\r\n                        count_add++;\r\n                    })\r\n                }\r\n                this.raise('frame', {\r\n                    number: frame_num,\r\n                    timestamp: timestamp,\r\n                    window_was_resized: was_resized,\r\n                    count_ctrls_added: count_add,\r\n                    count_ctrls_removed: count_remove,\r\n                    map_dom_controls: map_ctrls_in_this_frame,\r\n                    count_dom_ctrls: count_dom_ctrls,\r\n                    ta_dom_controls_numeric_values: ta_current_frame_for_user,\r\n                    map_dom_ctrl_iids: map_current_dom_ctrl_iids\r\n                });\r\n                last_timestamp = timestamp;\r\n                window.requestAnimationFrame(frame_process);\r\n                was_resized = false;\r\n                map_ctrls_in_last_frame = map_ctrls_in_this_frame;\r\n            }\r\n            window.requestAnimationFrame(frame_process);\r\n            window.addEventListener('resize', e => {\r\n                was_resized = true;\r\n                this.raise('window-resize', e);\r\n            });\r\n            //console.log('count_dom_ctrls', count_dom_ctrls);\r\n            ta_current_frame_stored = create_controls_number_props_ta();\r\n            //console.log('ta_current_frame_stored.length', ta_current_frame_stored.length);\r\n            ta_current_frame_for_user = new Float32Array(ta_current_frame_stored.length);\r\n            ta_user_frame_changes = new Float32Array(ta_current_frame_stored.length);\r\n            ta_current_frame_for_user.set(ta_current_frame_stored);\r\n        });\r\n\r\n\r\n\r\n        const trial_fns_now_unused = () => {\r\n            const create_dims_from_current_ctrls = this.create_dims_from_current_ctrls = () => {\r\n                const {\r\n                    next_iid\r\n                } = this;\r\n                const ctrl_length = 6;\r\n                const ta_res = new Float32Array(next_iid * ctrl_length);\r\n                let wpos = 0;\r\n                each(map_controls, (ctrl, id) => {\r\n                    const ctrl_iid = ctrl.iid;\r\n                    wpos = ctrl_iid * ctrl_length;\r\n                    if (ctrl.dom && ctrl.dom.el) {\r\n                        const bcr = ctrl.dom.el.getBoundingClientRect();\r\n                        ta_res[wpos++] = bcr.left;\r\n                        ta_res[wpos++] = bcr.top;\r\n                        ta_res[wpos++] = bcr.right;\r\n                        ta_res[wpos++] = bcr.bottom;\r\n                        ta_res[wpos++] = bcr.width;\r\n                        ta_res[wpos++] = bcr.height;\r\n                    }\r\n                });\r\n                return ta_res;\r\n            }\r\n        }\r\n    }\r\n    'get_ctrl_el' (ctrl) {\r\n        return this.map_els[ctrl._id()];\r\n    }\r\n    'register_el' (el) {\r\n        let jsgui_id = el.getAttribute('data-jsgui-id');\r\n        if (jsgui_id) {\r\n            this.map_els[jsgui_id] = el;\r\n        }\r\n    }\r\n    'body' () {\r\n        var doc = this.document;\r\n        var bod = doc.body;\r\n        if (!this._body) {\r\n            var existing_jsgui_id = bod.getAttribute('data-jsgui-id');\r\n            if (!existing_jsgui_id) {\r\n                var ctrl_body = new jsgui.body({\r\n                    'el': document.body,\r\n                    'context': this\r\n                });\r\n                ctrl_body.dom.el.setAttribute('jsgui-id', ctrl_body._id());\r\n                this.register_control(ctrl_body);\r\n                this._body = ctrl_body;\r\n            } else {\r\n                if (this.map_controls[existing_jsgui_id]) {\r\n                    this._body = this.map_controls[existing_jsgui_id];\r\n                }\r\n            }\r\n        } else {\r\n        }\r\n        return this._body;\r\n    }\r\n}\r\nClient_Page_Context.css = `\r\nbody .modal {\r\n    position: absolute;\r\n    left: 0px;\r\n    top: 0px;\r\n}\r\nbody .overlay {\r\n    position: absolute;\r\n    left: 0px;\r\n    top: 0px;\r\n}\r\n`;\r\nmodule.exports = Client_Page_Context;", "/**\r\n * Created by James on 09/10/2016.\r\n */\r\n\r\n// But is this part of the html client, or it uses the html client.\r\n\r\n// The client has page context.\r\n//  Page context has the resource pool.\r\n\r\n// So, client-resource will need html-enh I think, but not the client system.\r\n\r\n\r\n/*\r\n define(['../../web/jsgui-html-enh', './resource'],\r\n function(jsgui, Resource) {\r\n */\r\n\r\n\r\n/*\r\n\t2018, need to implement / redo some of resources.\r\n\twill make them a bit simpler where poss\r\n\thave resource publisher middleware on the server\r\n\r\n*/\r\n\r\n// 2022 - considering putting compilation features into the client.\r\n//  Would need to load in / provide the actual compilation functions.\r\n//   jsgui3-server would load them in for server-side use automatically (a few compilers at least).\r\n//    want to redo the way that jsgui3-server runs its compilers.\r\n//    will be more structured, and less code used in the JavaScript resource.\r\n\r\n// Compilers will be integrated at a relatively low level.\r\n//  Having compilers work on the client should be OK.\r\n//  Even compiling compilers in Rust.\r\n\r\n\r\n\r\n\r\n// The resource may be a compiler or data transformer.\r\n//  Seems like it's worth doing more on a ll to support that functionality.\r\n\r\n// Loading these from Rust / C++ to WASM is part of the issue with compilers.\r\n//  Need server-side compilation for some of it to happen.\r\n\r\n// Looks as though variety of compilers only work on the FS.\r\n//  Maybe would need to be adapted to operate in mem / only as function.\r\n\r\n// Could use an /out directory.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar jsgui = require('jsgui3-html');\r\n\r\n// Could make a separate Data_Resource\r\n//  That Data_Resource would have the API that DR in jsgui3 now has.\r\n//   Will use self-logging and observable / observable-like functionality for monitoring it within the app\r\n//   Will have a fairly general and specified get / set pattern\r\n//    Things will work in a generally restful way.\r\n//    Could look into graphql\r\n//     Maybe would need to be graphql resource.\r\n\r\n\r\n\r\n\r\nvar Resource = jsgui.Resource;\r\n\r\nconst fnl = require('fnl');\r\nconst prom_or_cb = fnl.prom_or_cb;\r\n\r\nvar stringify = jsgui.stringify,\r\n\teach = jsgui.each,\r\n\tarrayify = jsgui.arrayify,\r\n\ttof = jsgui.tof;\r\n\r\n\r\nconst get_a_sig = jsgui.get_a_sig;\r\n\r\nvar filter_map_by_regex = jsgui.filter_map_by_regex;\r\nvar Class = jsgui.Class,\r\n\tData_Object = jsgui.Data_Object,\r\n\tEnhanced_Data_Object = jsgui.Enhanced_Data_Object;\r\nvar fp = jsgui.fp,\r\n\tis_defined = jsgui.is_defined;\r\nvar Collection = jsgui.Collection;\r\n\r\n// Extends AutoStart_Resource?\r\n\r\n// May need to change around a fair few references to make it workable.\r\n// May need some more complicated logic to change it to the path for service.\r\n\r\n// There can be a client app that's specifically for a resource.\r\n//  That's a special case.\r\n// Other client side apps will access multiple resources.\r\n//  They can do this through a Resource_Pool.\r\n//  There could be client-side resources that make use of information sharing between these client and server side resources.\r\n\r\n// This client resource could reference a remote resource.\r\n\r\n// Will have client-remote-reference resource\r\n//  maybe just client-remote\r\n//  will work in a similar way to remote or node-remote in terms of API, but internally it will do HTTP calls differently.\r\n//  Possibly could just use jsgui though, have it expose the same API for node and the client.\r\n\r\n// This one is still fairly abstract.\r\n//  It will be the client-remote-link resource which will have the functionality.\r\n//  client-remote-link will connect with websockets to get events\r\n//  it will do get with http.\r\n\r\n\r\n// A resource control will recieve events from the client resource.\r\n//  It may also ensure it has been set up.\r\n\r\n// Also a Resource_Client file that sets up a resource connection with a particular resource?\r\n//  Maybe don't set up such abstract resource linking for the moment?\r\n\r\n// With the Resource-Client architure, we could define the back-end in terms of a Resource, and not need to write various pieces of boilerplate for them\r\n//  to communicate with each other.\r\n\r\n// Resource_Client may be a necessary JS file.\r\n//  Would be JavaScript that runs on a page that's for when it's the client for a single resource?\r\n\r\n// With the clock resource, would want it to have a resource control.\r\n//  That control could possibly speak to the resource directly.\r\n//  It could possibly speak to a client-side resource / aggregator that then speaks to the server resource.\r\n\r\n// Serving a page with a component that connects back to the resource...\r\n//  I think a lot of the activity will be in the user control,\r\n//  however, it may be that the user control will just be making use of the client-side resources or client-side resource pool.\r\n\r\nvar ends_with = function (str, suffix) {\r\n\treturn str.indexOf(suffix, str.length - suffix.length) !== -1;\r\n}\r\n\r\n// Should code in a way that allows for a (local) data transformation resource.\r\n\r\n// resource location:\r\n//  server (remote, needs HTTP requests)\r\n//  local\r\n//   within the app, available through js\r\n//   available through a port / ports.\r\n\r\n// The resource could be available as a local function.\r\n\r\n// server\r\n// local-fn\r\n\r\n// Client_Resource_Referencing_Server\r\n// Client_Resource_Referencing_Local\r\n\r\n// Need to enable usage of client-side data transformation resources.\r\n// As well as allow for their use and integration more generally into the jsgui3 system.\r\n\r\n// Client_Resource_Referencing_Server_JSON\r\n// Client_Resource__Server_JSON\r\n// Client_Resource__Client_Transform_Function\r\n//  Some functions to transform bmp <> jpeg could be in this category.\r\n\r\n\r\n// Should not use / need Data_Object.\r\n//  Though could improve and document Data_Object.\r\n\r\n// May be better using observable pattern?\r\n\r\n// A data transformation resource system for filling out HTML templates.\r\n// Could introduce RSX at this point too.\r\n\r\n// It maybe won't be at a URL.\r\n//  Just needs to be available within client-side JS.\r\n\r\n// HTTP_Resource or HTTP_Client_Resource\r\n\r\n\r\n\r\nclass Client_Resource extends Resource {\r\n\t//'fields': {\r\n\t//\t'url': String\r\n\t//},\r\n\t// Subscribe?\r\n\r\n\t// Should likely work more like an observable.\r\n\t//  At least it extends evented_class\r\n\r\n\tconstructor(spec = {}) {\r\n\t\t//this._super(spec);\r\n\t\t//spec = spec || {};\r\n\t\tsuper(spec);\r\n\t\tif (spec.meta) {\r\n\t\t\tvar meta = spec.meta;\r\n\t\t\t//console.log('1) meta.url', meta.url);\r\n\t\t\tif (meta.url) this.meta.set('url', meta.url);\r\n\t\t\tif (meta.type_levels) this.meta.set('type_levels', meta.type_levels);\r\n\t\t\t//console.log('meta.name ' + meta.name);\r\n\t\t}\r\n\r\n\t\t// The data resource won't hold the data itself.\r\n\t\t//  (usually)\r\n\t\t//  It will download the data unless it's cached.\r\n\r\n\t\t// Will connect to the more customised server data resource.\r\n\t\t//  This is the interface between the client's data and the server.\r\n\r\n\t\tthis.data = new Data_Object();\r\n\t\t// Not necessarily?\r\n\r\n\t\t//var that = this;\r\n\t\t// both in one parameter here?\r\n\t\t// Why not listen to the resource's data directly?\r\n\t\t//  Should not be a problem when doing it on the client?\r\n\r\n\t\tthis.data.on('change', (property_name, property_value) => {\r\n\t\t\t//console.log('');\r\n\t\t\t//console.log('resource data change property_name', property_name);\r\n\t\t\t//console.log('property_value', property_value);\r\n\t\t\tthis.trigger('change', property_name, property_value);\r\n\t\t});\r\n\t}\r\n\r\n\t// Set as well?\r\n\r\n\t'get' (path, callback) {\r\n\t\treturn prom_or_cb((resolve, reject) => {\r\n\t\t\t//console.log('path', path);\r\n\r\n\t\t\tlet ends_dot_json = ends_with(path, '.json');\r\n\t\t\t//console.log('ends_dot_json', ends_dot_json);\r\n\t\t\tlet json_url;\r\n\t\t\tif (!ends_dot_json) {\r\n\t\t\t\tjson_url = path + '.json';\r\n\t\t\t} else {\r\n\t\t\t\tjson_url = path;\r\n\t\t\t}\r\n\t\t\t//console.log('this (Resource)', this);\r\n\t\t\tjson_url = 'resources/' + this.name + '/' + json_url;\r\n\t\t\t//json_url = ''\r\n\t\t\t//console.log('json_url', json_url);\r\n\t\t\tjsgui.http(json_url, function (err, res) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\t//callback(err);\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(res);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, callback);\r\n\t}\r\n\r\n\tget status() {\r\n\t\treturn (async () => {\r\n\t\t\tlet res = await jsgui.http('/resources/' + this.name + '/status.json');\r\n\t\t\treturn res;\r\n\t\t})();\r\n\t}\r\n\t// We don't notify it this way.\r\n\t//  Thinking of making a serparate Resource that uses websockets or sockjs. Should continue to have the normal non-sock client-side resource as well.\r\n\t///  Will not make its own HTTP connections.\r\n\r\n\t// Not that clear how this type of resource will receive these change notifications.\r\n\t//  Seems less likely that we will need this function here.\r\n\t//  06/06/2015 - about to make the socks resource connection for the client, it's going to allow for real-time updates, while using generally RESTful addressing.\r\n\r\n\t'notify_change_from_server' (property_name, property_value) {\r\n\t\t// needs to do some kind of silent set.\r\n\t\t//console.log('client resource notify_change_from_server');\r\n\t\tvar data = this.data;\r\n\t\tthis.data._[property_name] = property_value;\r\n\r\n\t\tthis.data.trigger('change', property_name, property_value);\r\n\t\t// Or the resource listens to data changes, triggers change on itself when the data changes.\r\n\t\t// Or change on the resource itself I think.\r\n\t}\r\n}\r\n\r\nmodule.exports = Client_Resource;", "// Making it a global variable.\r\nconst jsgui = require('jsgui3-html');\r\n\r\njsgui.Resource_Pool = require('./client-resource-pool');\r\njsgui.Client_Page_Context = require('./page-context');\r\n//console.log('jsgui.Client_Page_Context', jsgui.Client_Page_Context);\r\n//jsgui.Selection_Scope = require('./selection-scope');\r\n// And then can automatically activate?\r\n//\r\n\r\njsgui.Client_Resource = require('./resource');\r\nconst fnl = require('fnl');\r\nconst prom_or_cb = fnl.prom_or_cb;\r\n\r\nconst {each, tf} = jsgui;\r\n\r\n// Should move some / all html that is client-side to here.\r\n\r\n// Leave the line below\r\n/* -- REQUIREMENTS -- */\r\n// Leave the line above\r\n\r\nif (typeof window !== 'undefined') {\r\n    // Maybe use the vhl dl function? Or similar observable?\r\n\r\n    // need to use https really\r\n\r\n    // timeout...\r\n    let context;\r\n\r\n    jsgui.http = (url, callback) => {\r\n        return prom_or_cb((resolve, reject) => {\r\n            let timeout = 2500;\r\n            //if (jsgui.timeout) timeout = jsgui.timeout;\r\n            //console.log('timeout', timeout);\r\n            var oReq = new XMLHttpRequest();\r\n            oReq.timeout = timeout;\r\n            oReq.onreadystatechange = function () {\r\n                //console.log('this.readyState', this.readyState);\r\n                //console.log('this.status', this.status);\r\n                if (this.readyState === 4) {\r\n                    //console.log('this.status', this.status);\r\n                    if (this.status === 200) {\r\n                        var o = JSON.parse(this.responseText);\r\n                        //myFunction(myArr);\r\n                        resolve(o);\r\n                    } else {\r\n                        reject(this.status);\r\n                    }\r\n                }\r\n            };\r\n            oReq.open(\"GET\", url, true);\r\n            oReq.send();\r\n        }, callback);\r\n    }\r\n\r\n    jsgui.http_post = (url, value, callback) => {\r\n        return prom_or_cb((resolve, reject) => {\r\n\r\n            var oReq = new XMLHttpRequest();\r\n            oReq.onreadystatechange = function () {\r\n                if (this.readyState === 4) {\r\n                    //console.log('this.status', this.status);\r\n                    if (this.status === 200) {\r\n                        var o = JSON.parse(this.responseText);\r\n                        //myFunction(myArr);\r\n                        resolve(o);\r\n                    } else {\r\n                        //console.log('this.status', this.status);\r\n                        reject({\r\n                            status: this.status,\r\n                            responseText: this.responseText\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n            \r\n            oReq.open(\"POST\", url, true);\r\n            // set any headers here, such as content-type\r\n\r\n            //let s_value;\r\n            // always send a buffer?\r\n            \r\n            let o_to_send;\r\n            let tval = tf(value)\r\n\r\n            //console.log('***** tval', tval);\r\n            //console.log('value', value);\r\n            //console.log('value.length', value.length);\r\n\r\n            if (tval === 's') {\r\n                // text string\r\n                o_to_send = value;\r\n            } else if (tval === 'B') {\r\n                o_to_send = value;\r\n            } else if (tval === 'a' || tval === 'o') {\r\n                const json = JSON.stringify(value);\r\n                o_to_send = json;\r\n                oReq.setRequestHeader('content-type', 'application/json');\r\n            }\r\n\r\n            //console.log('o_to_send', o_to_send);\r\n            //console.trace();\r\n\r\n            oReq.send(o_to_send);\r\n        }, callback);\r\n    }\r\n\r\n    jsgui.http_delete = (url, callback) => {\r\n        return prom_or_cb((resolve, reject) => {\r\n            var oReq = new XMLHttpRequest();\r\n            oReq.onreadystatechange = function () {\r\n                if (this.readyState === 4) {\r\n                    //console.log('this.status', this.status);\r\n                    if (this.status === 200) {\r\n                        var o = JSON.parse(this.responseText);\r\n                        //myFunction(myArr);\r\n                        resolve(o);\r\n                    } else {\r\n                        reject(this.status);\r\n                    }\r\n                }\r\n            };\r\n            oReq.open(\"DELETE\", url, true);\r\n            oReq.send();\r\n        }, callback);\r\n    }\r\n\r\n    \r\n    jsgui.update_standard_Controls = page_context => {\r\n        each(jsgui.controls, (Control_Subclass, name) => {\r\n            page_context.update_Controls(name, Control_Subclass);\r\n        });\r\n    }\r\n    // Can this be given the context as well?\r\n    //  Could set up the data adapter functions that way too.\r\n\r\n\r\n\r\n    let context_data;\r\n\r\n\r\n    jsgui.register_server_resources = (o_server_resources) => {\r\n        //console.log('jsgui.register_server_resources o_server_resources', o_server_resources);\r\n\r\n        //console.log('!!!!! this log should appear');\r\n        //console.trace();\r\n\r\n        // Setting up the Data_Resource makes sense.\r\n\r\n        // Creating automatic function calls that communicate with the server.\r\n        //  So it's very easy to call from the app in a normal way. Will be v. simple to use. More concise code too.\r\n\r\n        // Do we have access to the context?\r\n        //  The resource registration call is in a separate block of js code. Need to be careful.\r\n\r\n        //console.log('** Object.keys(jsgui)', Object.keys(jsgui));\r\n\r\n        jsgui.def_server_resources = o_server_resources;\r\n        // then will consult this upon activation, when the context is available.\r\n    }\r\n\r\n    jsgui.register_context_data = o_context_data => {\r\n        context_data = o_context_data;\r\n    }\r\n\r\n\r\n    \r\n\r\n    //console.log('Client-side app ready for activation');\r\n    //console.log('next line');\r\n\r\n    // Standard controls update\r\n    // Standard controls import?\r\n\r\n    // jsgui.update_page_context_default_controls()\r\n\r\n    // Maybe activation within the client js would be most reliable and normal.\r\n\r\n    // Automatic creation of page_context is best\r\n    \r\n    // Or generate the context, then activate.\r\n    //  Or activation itself ensures and returns the page context.\r\n\r\n    // Better id page_context is created here.\r\n\r\n    let activate = () => {\r\n        //console.log('client.js activate');\r\n        const {def_server_resources} = jsgui;\r\n        //console.log('def_server_resources', def_server_resources);\r\n        page_context = new jsgui.Client_Page_Context({\r\n            'document': document\r\n        });\r\n        context = page_context;\r\n        jsgui.context = page_context;\r\n\r\n        if (context_data) {\r\n            Object.assign(page_context, context_data);\r\n\r\n            // So would be able to read mime types from the context, if they are provided.\r\n            //  Other useful pieces of data too.\r\n        }\r\n\r\n        jsgui.update_standard_Controls(page_context);\r\n\r\n        \r\n        /*\r\n        jsgui.raise('pre-activate', {\r\n            context: context\r\n        });\r\n        */\r\n        \r\n        jsgui.pre_activate(page_context);\r\n\r\n        jsgui.activate(page_context);\r\n\r\n        \r\n\r\n        // Could set up the data_resource function calls here.\r\n        //  Seems like a sensible place to do it, but maybe call a function that is elsewhere.\r\n        //   These function calls will need to talk to the server.\r\n\r\n        // context resources data resource.\r\n        //  will create the function call here.\r\n\r\n        //console.log('Object.keys(context)', Object.keys(context));\r\n        //console.log('Object.keys(context.resource_pool)', Object.keys(context.resource_pool));\r\n        //console.log('Object.keys(context.resource_pool.resources)', Object.keys(context.resource_pool.resources));\r\n\r\n        const arr_resources = context.resource_pool.resources._arr;\r\n        const data_resource = arr_resources[0];\r\n\r\n        //console.log('data_resource', data_resource);\r\n\r\n        const activate_server_resource_fn = (obj_def) => {\r\n            //console.log('obj_def', obj_def);\r\n\r\n            const {name, type} = obj_def;\r\n            if (type === 'function') {\r\n                const fn_remote_call = async (single_param) => {\r\n                    // do jsgui put.\r\n                    // Fn call should be done with put.\r\n                    //const json_single_param = JSON.stringify(single_param);\r\n                    // Then do jsgui post.\r\n                    //jsgui.http_post = (url, value, callback) => {\r\n                    //  optional callback\r\n\r\n                    const res_dl = await jsgui.http_post('/' + name, single_param);\r\n                    console.log('res_dl', res_dl);\r\n                    return res_dl;\r\n                }\r\n                //return fn_remote_call;\r\n\r\n                data_resource[name] = fn_remote_call;\r\n            }\r\n            // Create a function that does the remote call.\r\n        }\r\n\r\n        const activate_server_resource_fns = () => {\r\n            // will use http post for these function calls.\r\n            each(def_server_resources, (server_resource_def, name) => {\r\n                //console.log('name', name);\r\n                //console.log('server_resource_def', server_resource_def);\r\n\r\n                // activte server resource function.\r\n\r\n                // with no schema defined.\r\n\r\n                // with schema / grammar, may set up mfp / ofp / whatever for calling this function.\r\n                activate_server_resource_fn(server_resource_def);\r\n            })\r\n        }\r\n\r\n        activate_server_resource_fns();\r\n        // jsgui.def_server_resources\r\n\r\n        jsgui.raise('activate', {\r\n            context: context\r\n        });\r\n        page_context.raise('activate', {\r\n            context: context\r\n        });\r\n\r\n        // Set up a variety of UI controls here.\r\n        // May be worth looking at some registry of controls.\r\n    }\r\n    // Multiple onload items being added.\r\n    //  Seems like the \r\n\r\n    window.addEventListener('load', () => {\r\n        console.log('client.js window onload');\r\n        activate();\r\n    });\r\n\r\n}\r\n\r\nmodule.exports = jsgui;", "\"use strict\";\n\nconst jsgui = require(\"jsgui3-html\");\n\nfunction registerControlType(typeName, ControlClass, { jsguiInstance = jsgui } = {}) {\n  if (!typeName || !ControlClass || !jsguiInstance) {\n    return ControlClass;\n  }\n  const normalized = String(typeName).trim();\n  if (!normalized) {\n    return ControlClass;\n  }\n  const key = normalized.toLowerCase();\n  const proto = ControlClass.prototype || ControlClass.__proto__;\n  if (proto && !proto.__type_name) {\n    proto.__type_name = key;\n  }\n\n  jsguiInstance.controls = jsguiInstance.controls || {};\n  jsguiInstance.controls[key] = ControlClass;\n\n  // Ensure client contexts see the constructor when parsing existing markup.\n  if (!jsguiInstance.map_Controls) {\n    jsguiInstance.map_Controls = {};\n  }\n  jsguiInstance.map_Controls[key] = ControlClass;\n\n  if (!jsguiInstance[key]) {\n    jsguiInstance[key] = ControlClass;\n  }\n  return ControlClass;\n}\n\nmodule.exports = {\n  registerControlType\n};\n", "'use strict';\n\n/**\n * TwoColumnLayoutFactory - Shared factory for 2-column navigation + detail layouts\n * \n * Creates reusable controls for dashboards with:\n * - Left sidebar with navigation items\n * - Right content area with detail view\n * - Compact, industrial styling\n * \n * Event Flow (using jsgui3 native events - .on() / .raise()):\n * - NavItem raises 'select' \u2192 Sidebar subscribes and re-raises 'nav-select'\n * - Sidebar raises 'nav-select' \u2192 TwoColumnLayout subscribes and re-raises 'view-change'\n * - Parent dashboard subscribes to layout's 'view-change' to handle navigation\n * \n * Pattern: Factory function receives jsgui instance, returns controls + buildStyles\n * \n * @example\n * const { TwoColumnLayout, Sidebar, ContentArea, NavItem, buildStyles } = \n *   createTwoColumnLayoutControls(jsgui);\n * \n * const layout = new TwoColumnLayout({ context });\n * layout.sidebar.addNavItem({ id: 'dashboard', label: 'Dashboard', icon: '\uD83D\uDCCA' });\n * \n * // Subscribe to view changes using jsgui3 events\n * layout.on('view-change', (data) => {\n *   console.log('View changed to:', data.id);\n * });\n * \n * const html = layout.all_html_render();\n * \n * @module TwoColumnLayoutFactory\n */\n\n/**\n * Create two-column layout controls for the given jsgui instance\n * @param {Object} jsgui - jsgui3-html instance\n * @returns {{ TwoColumnLayout, Sidebar, ContentArea, NavItem, DetailHeader, buildStyles }}\n */\nfunction createTwoColumnLayoutControls(jsgui) {\n  const { Control } = jsgui;\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // NavItem - Single navigation item in sidebar\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * NavItem control - represents a single navigation item in the sidebar\n   * \n   * Events:\n   * - 'select': Raised when the item is clicked, with { id, label } data\n   * \n   * @class NavItem\n   * @extends Control\n   */\n  class NavItem extends Control {\n    constructor(spec = {}) {\n      super({ ...spec, tagName: 'div', __type_name: 'nav_item' });\n      \n      this.itemId = spec.id || 'item';\n      this.label = spec.label || 'Item';\n      this.icon = spec.icon || '\uD83D\uDCC4';\n      this.badge = spec.badge || null;\n      this.selected = spec.selected || false;\n      \n      this.add_class('nav-item');\n      this.dom.attributes['data-nav-id'] = this.itemId;\n      \n      if (this.selected) {\n        this.add_class('nav-item--selected');\n      }\n      \n      if (!spec.el) this.compose();\n    }\n    \n    compose() {\n      const ctx = this.context;\n      \n      // Icon\n      const iconEl = new Control({ context: ctx, tagName: 'span' });\n      iconEl.add_class('nav-item__icon');\n      iconEl.add(this.icon);\n      this.add(iconEl);\n      \n      // Label\n      const labelEl = new Control({ context: ctx, tagName: 'span' });\n      labelEl.add_class('nav-item__label');\n      labelEl.add(this.label);\n      this.add(labelEl);\n      \n      // Optional badge\n      if (this.badge !== null) {\n        const badgeEl = new Control({ context: ctx, tagName: 'span' });\n        badgeEl.add_class('nav-item__badge');\n        badgeEl.add(String(this.badge));\n        this.add(badgeEl);\n      }\n    }\n    \n    /**\n     * Activate the control - binds DOM click to jsgui3 event\n     */\n    activate() {\n      if (this.__active) return;\n      super.activate();\n      \n      // Bind DOM click to raise jsgui3 'select' event\n      if (this.dom.el) {\n        this.dom.el.addEventListener('click', () => {\n          // Use jsgui3's native event system\n          this.raise('select', { id: this.itemId, label: this.label });\n        });\n      }\n    }\n    \n    /**\n     * Update visual selection state\n     * @param {boolean} selected - Whether item is selected\n     */\n    setSelected(selected) {\n      this.selected = selected;\n      if (this.dom.el) {\n        this.dom.el.classList.toggle('nav-item--selected', selected);\n      }\n    }\n  }\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Sidebar - Left navigation panel\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * Sidebar control - contains navigation items and handles selection\n   * \n   * Events:\n   * - 'nav-select': Raised when a nav item is selected, with { id, label } data\n   * \n   * @class Sidebar\n   * @extends Control\n   */\n  class Sidebar extends Control {\n    constructor(spec = {}) {\n      super({ ...spec, tagName: 'aside', __type_name: 'sidebar' });\n      \n      this.title = spec.title || 'Navigation';\n      this.titleIcon = spec.titleIcon || '\u2630';\n      this.items = spec.items || [];\n      this.selectedId = spec.selectedId || null;\n      \n      this._headerEl = null;\n      this._navList = null;\n      this._navItems = new Map();\n      \n      this.add_class('layout-sidebar');\n      \n      if (!spec.el) this.compose();\n    }\n    \n    compose() {\n      const ctx = this.context;\n      \n      // Header\n      this._headerEl = new Control({ context: ctx, tagName: 'div' });\n      this._headerEl.add_class('sidebar-header');\n      \n      const headerIcon = new Control({ context: ctx, tagName: 'span' });\n      headerIcon.add_class('sidebar-header__icon');\n      headerIcon.add(this.titleIcon);\n      this._headerEl.add(headerIcon);\n      \n      const headerTitle = new Control({ context: ctx, tagName: 'span' });\n      headerTitle.add_class('sidebar-header__title');\n      headerTitle.add(this.title);\n      this._headerEl.add(headerTitle);\n      \n      this.add(this._headerEl);\n      \n      // Nav list\n      this._navList = new Control({ context: ctx, tagName: 'nav' });\n      this._navList.add_class('sidebar-nav');\n      \n      for (const item of this.items) {\n        this.addNavItem(item);\n      }\n      \n      this.add(this._navList);\n    }\n    \n    /**\n     * Add a navigation item to the sidebar\n     * @param {Object} spec - NavItem configuration\n     * @returns {NavItem} The created nav item\n     */\n    addNavItem(spec) {\n      const ctx = this.context;\n      const navItem = new NavItem({\n        context: ctx,\n        ...spec,\n        selected: spec.id === this.selectedId\n      });\n      \n      // Subscribe to child's 'select' event and re-raise as 'nav-select'\n      // This is the jsgui3-idiomatic pattern for event propagation\n      navItem.on('select', (data) => {\n        this.setSelected(data.id);\n        this.raise('nav-select', data);\n      });\n      \n      this._navItems.set(spec.id, navItem);\n      this._navList.add(navItem);\n      return navItem;\n    }\n    \n    /**\n     * Set the selected navigation item\n     * @param {string} itemId - ID of the item to select\n     */\n    setSelected(itemId) {\n      this.selectedId = itemId;\n      for (const [id, item] of this._navItems) {\n        item.setSelected(id === itemId);\n      }\n    }\n    \n    /**\n     * Activate the sidebar and its children\n     * No additional event binding needed - events are wired in addNavItem\n     */\n    activate() {\n      if (this.__active) return;\n      super.activate();\n      // Child NavItems are activated via super.activate() which walks the tree\n    }\n  }\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // DetailHeader - Header for the content area\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * DetailHeader control - displays title and subtitle for content area\n   * @class DetailHeader\n   * @extends Control\n   */\n  class DetailHeader extends Control {\n    constructor(spec = {}) {\n      super({ ...spec, tagName: 'header', __type_name: 'detail_header' });\n      \n      this.title = spec.title || 'Details';\n      this.titleIcon = spec.titleIcon || '\uD83D\uDCCB';\n      this.subtitle = spec.subtitle || null;\n      \n      this.add_class('detail-header');\n      \n      if (!spec.el) this.compose();\n    }\n    \n    compose() {\n      const ctx = this.context;\n      \n      // Title row\n      const titleRow = new Control({ context: ctx, tagName: 'div' });\n      titleRow.add_class('detail-header__title-row');\n      \n      const icon = new Control({ context: ctx, tagName: 'span' });\n      icon.add_class('detail-header__icon');\n      icon.add(this.titleIcon);\n      titleRow.add(icon);\n      \n      const title = new Control({ context: ctx, tagName: 'h2' });\n      title.add_class('detail-header__title');\n      title.add(this.title);\n      titleRow.add(title);\n      \n      this.add(titleRow);\n      \n      // Subtitle\n      if (this.subtitle) {\n        const subtitle = new Control({ context: ctx, tagName: 'p' });\n        subtitle.add_class('detail-header__subtitle');\n        subtitle.add(this.subtitle);\n        this.add(subtitle);\n      }\n    }\n    \n    /**\n     * Update the header title (for dynamic updates)\n     * @param {string} title - New title text\n     * @param {string} [icon] - Optional new icon\n     */\n    setTitle(title, icon = null) {\n      this.title = title;\n      if (icon) this.titleIcon = icon;\n      // Re-render would happen via full page update in server-rendered apps\n    }\n  }\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // ContentArea - Right detail panel\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * ContentArea control - the main content panel with optional header\n   * @class ContentArea\n   * @extends Control\n   */\n  class ContentArea extends Control {\n    constructor(spec = {}) {\n      super({ ...spec, tagName: 'main', __type_name: 'content_area' });\n      \n      this.title = spec.title || 'Details';\n      this.titleIcon = spec.titleIcon || '\uD83D\uDCCB';\n      this.subtitle = spec.subtitle || null;\n      this.showHeader = spec.showHeader !== false;\n      \n      this._header = null;\n      this._body = null;\n      \n      this.add_class('layout-content');\n      \n      if (!spec.el) this.compose();\n    }\n    \n    compose() {\n      const ctx = this.context;\n      \n      // Optional header\n      if (this.showHeader) {\n        this._header = new DetailHeader({\n          context: ctx,\n          title: this.title,\n          titleIcon: this.titleIcon,\n          subtitle: this.subtitle\n        });\n        this.add(this._header);\n      }\n      \n      // Body container for content\n      this._body = new Control({ context: ctx, tagName: 'div' });\n      this._body.add_class('content-body');\n      this.add(this._body);\n    }\n    \n    /**\n     * Add content to the body area\n     * @param {Control|string} content - Control or string to add\n     */\n    addContent(content) {\n      if (this._body) {\n        this._body.add(content);\n      } else {\n        this.add(content);\n      }\n    }\n    \n    /**\n     * Get the body control for direct manipulation\n     * @returns {Control} The body control\n     */\n    getBody() {\n      return this._body;\n    }\n  }\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // TwoColumnLayout - Root container combining sidebar + content\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * TwoColumnLayout control - combines sidebar and content area\n   * \n   * Events:\n   * - 'view-change': Raised when navigation selection changes, with { id, label } data\n   * \n   * @class TwoColumnLayout\n   * @extends Control\n   */\n  class TwoColumnLayout extends Control {\n    constructor(spec = {}) {\n      super({ ...spec, tagName: 'div', __type_name: 'two_column_layout' });\n      \n      this.sidebarTitle = spec.sidebarTitle || 'Navigation';\n      this.sidebarIcon = spec.sidebarIcon || '\u2630';\n      this.sidebarWidth = spec.sidebarWidth || 280;\n      this.navItems = spec.navItems || [];\n      this.selectedId = spec.selectedId || null;\n      \n      this.contentTitle = spec.contentTitle || 'Details';\n      this.contentIcon = spec.contentIcon || '\uD83D\uDCCB';\n      this.contentSubtitle = spec.contentSubtitle || null;\n      \n      this.sidebar = null;\n      this.contentArea = null;  // IMPORTANT: Don't use 'content' - it shadows base class Collection!\n      \n      this.add_class('two-column-layout');\n      this.dom.attributes['data-jsgui-control'] = 'two_column_layout';\n      \n      if (!spec.el) this.compose();\n    }\n    \n    compose() {\n      const ctx = this.context;\n      \n      // Sidebar\n      this.sidebar = new Sidebar({\n        context: ctx,\n        title: this.sidebarTitle,\n        titleIcon: this.sidebarIcon,\n        items: this.navItems,\n        selectedId: this.selectedId\n      });\n      \n      // Subscribe to sidebar's nav-select and re-raise as view-change\n      this.sidebar.on('nav-select', (data) => {\n        this.raise('view-change', data);\n      });\n      \n      this.add(this.sidebar);\n      \n      // Content area\n      this.contentArea = new ContentArea({\n        context: ctx,\n        title: this.contentTitle,\n        titleIcon: this.contentIcon,\n        subtitle: this.contentSubtitle\n      });\n      this.add(this.contentArea);\n    }\n    \n    /**\n     * Add navigation item to sidebar\n     * @param {Object} spec - NavItem configuration\n     * @returns {NavItem} The created nav item\n     */\n    addNavItem(spec) {\n      return this.sidebar.addNavItem(spec);\n    }\n    \n    /**\n     * Add content to detail area\n     * @param {Control} ctrl - Control to add\n     */\n    addContent(ctrl) {\n      this.contentArea.addContent(ctrl);\n    }\n    \n    /**\n     * Set selected navigation item\n     * @param {string} itemId - ID of item to select\n     */\n    setSelected(itemId) {\n      this.sidebar.setSelected(itemId);\n    }\n    \n    /**\n     * Activate the layout\n     * Event wiring is done in compose() - no additional work needed here\n     */\n    activate() {\n      if (this.__active) return;\n      super.activate();\n      // Event subscriptions are already wired in compose()\n    }\n  }\n\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // CSS Builder\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  /**\n   * Build CSS for two-column layout\n   * @param {Object} options - Style options\n   * @param {number} options.sidebarWidth - Sidebar width in px (default: 280)\n   * @param {string} options.theme - 'dark' or 'light' (default: 'dark')\n   * @returns {string} CSS string\n   */\n  function buildStyles(options = {}) {\n    const sidebarWidth = options.sidebarWidth || 280;\n    const theme = options.theme || 'dark';\n    \n    // Theme colors\n    const colors = theme === 'dark' ? {\n      bg: 'rgba(10, 13, 20, 0.99)',\n      bgSidebar: 'rgba(15, 18, 25, 0.98)',\n      bgContent: 'rgba(20, 24, 32, 0.95)',\n      border: 'rgba(201, 162, 39, 0.15)',\n      borderHover: 'rgba(201, 162, 39, 0.35)',\n      text: 'rgba(255, 255, 255, 0.9)',\n      textMuted: 'rgba(255, 255, 255, 0.6)',\n      accent: '#c9a227',\n      accentDim: 'rgba(201, 162, 39, 0.25)',\n      itemHover: 'rgba(201, 162, 39, 0.1)',\n      itemSelected: 'rgba(201, 162, 39, 0.2)'\n    } : {\n      bg: '#f5f5f5',\n      bgSidebar: '#ffffff',\n      bgContent: '#fafafa',\n      border: 'rgba(0, 0, 0, 0.1)',\n      borderHover: 'rgba(0, 0, 0, 0.2)',\n      text: 'rgba(0, 0, 0, 0.87)',\n      textMuted: 'rgba(0, 0, 0, 0.54)',\n      accent: '#1976d2',\n      accentDim: 'rgba(25, 118, 210, 0.15)',\n      itemHover: 'rgba(0, 0, 0, 0.04)',\n      itemSelected: 'rgba(25, 118, 210, 0.12)'\n    };\n\n    return `\n/* \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n   Two Column Layout - Shared Styles\n   \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 */\n\n.two-column-layout {\n  display: flex;\n  min-height: 100vh;\n  background: ${colors.bg};\n  color: ${colors.text};\n  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;\n}\n\n/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n   Sidebar\n   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */\n\n.layout-sidebar {\n  width: ${sidebarWidth}px;\n  min-width: ${sidebarWidth}px;\n  background: ${colors.bgSidebar};\n  border-right: 1px solid ${colors.border};\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.sidebar-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 16px 20px;\n  border-bottom: 1px solid ${colors.border};\n  background: linear-gradient(135deg, ${colors.accentDim} 0%, transparent 100%);\n}\n\n.sidebar-header__icon {\n  font-size: 20px;\n  opacity: 0.8;\n}\n\n.sidebar-header__title {\n  font-size: 15px;\n  font-weight: 600;\n  letter-spacing: 0.02em;\n  text-transform: uppercase;\n  color: ${colors.accent};\n}\n\n.sidebar-nav {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px 0;\n}\n\n/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n   Nav Item\n   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */\n\n.nav-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 20px;\n  cursor: pointer;\n  transition: background 0.15s ease, border-color 0.15s ease;\n  border-left: 3px solid transparent;\n  user-select: none;\n}\n\n.nav-item:hover {\n  background: ${colors.itemHover};\n  border-left-color: ${colors.borderHover};\n}\n\n.nav-item--selected {\n  background: ${colors.itemSelected};\n  border-left-color: ${colors.accent};\n}\n\n.nav-item--selected .nav-item__label {\n  color: ${colors.accent};\n  font-weight: 600;\n}\n\n.nav-item__icon {\n  font-size: 18px;\n  width: 24px;\n  text-align: center;\n  opacity: 0.85;\n}\n\n.nav-item__label {\n  flex: 1;\n  font-size: 14px;\n  color: ${colors.text};\n}\n\n.nav-item__badge {\n  font-size: 11px;\n  padding: 2px 8px;\n  border-radius: 10px;\n  background: ${colors.accentDim};\n  color: ${colors.accent};\n  font-weight: 600;\n}\n\n/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n   Content Area\n   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */\n\n.layout-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: ${colors.bgContent};\n  overflow: hidden;\n}\n\n.detail-header {\n  padding: 20px 24px;\n  border-bottom: 1px solid ${colors.border};\n  background: linear-gradient(180deg, ${colors.accentDim} 0%, transparent 100%);\n}\n\n.detail-header__title-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.detail-header__icon {\n  font-size: 24px;\n  opacity: 0.9;\n}\n\n.detail-header__title {\n  font-size: 20px;\n  font-weight: 600;\n  margin: 0;\n  color: ${colors.text};\n}\n\n.detail-header__subtitle {\n  margin: 6px 0 0 36px;\n  font-size: 13px;\n  color: ${colors.textMuted};\n}\n\n.content-body {\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px 24px;\n}\n\n/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n   Responsive\n   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */\n\n@media (max-width: 768px) {\n  .two-column-layout {\n    flex-direction: column;\n  }\n  \n  .layout-sidebar {\n    width: 100%;\n    min-width: 100%;\n    max-height: 200px;\n    border-right: none;\n    border-bottom: 1px solid ${colors.border};\n  }\n  \n  .sidebar-nav {\n    display: flex;\n    flex-wrap: wrap;\n    padding: 8px;\n  }\n  \n  .nav-item {\n    padding: 8px 12px;\n    border-left: none;\n    border-bottom: 2px solid transparent;\n    flex: 0 0 auto;\n  }\n  \n  .nav-item--selected {\n    border-bottom-color: ${colors.accent};\n  }\n}\n`;\n  }\n\n  return {\n    TwoColumnLayout,\n    Sidebar,\n    ContentArea,\n    DetailHeader,\n    NavItem,\n    buildStyles\n  };\n}\n\nmodule.exports = { createTwoColumnLayoutControls };\n", "'use strict';\n\n/**\n * controlFactory.js - Reusable jsgui3 control creation helpers\n * \n * Provides DRY factory functions for common UI patterns:\n * - el() - Simple element creation\n * - createSection() - Section with emoji header\n * - createStatItem() - Value/label stat pairs\n * - createActionButton() - Styled action buttons\n * - formatNumber() / formatLabel() - Text formatting\n * \n * @example\n *   const { el, createSection, formatLabel } = require('./helpers/controlFactory')(jsgui);\n *   \n *   const section = createSection(ctx, '\uD83D\uDCCA', 'Statistics', 'stats-section');\n *   section.add(el(ctx, 'p', 'Some content', 'content-class'));\n */\n\n/**\n * Create the factory bound to a jsgui instance\n * @param {Object} jsgui - The jsgui3 instance\n * @returns {Object} Factory functions\n */\nfunction createControlFactory(jsgui) {\n  if (!jsgui) {\n    throw new Error('jsgui instance is required');\n  }\n  \n  const { Control } = jsgui;\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Text Formatting Utilities\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  /**\n   * Format a number with locale-aware thousands separators\n   * @param {number|string} value - Value to format\n   * @returns {string} Formatted string\n   */\n  function formatNumber(value) {\n    if (typeof value === 'number') return value.toLocaleString();\n    return String(value);\n  }\n  \n  /**\n   * Convert snake_case or camelCase key to Title Case label\n   * @param {string} key - Key to format\n   * @returns {string} Formatted label\n   */\n  function formatLabel(key) {\n    return key\n      .replace(/([A-Z])/g, ' $1')\n      .replace(/_/g, ' ')\n      .trim()\n      .replace(/\\b\\w/g, c => c.toUpperCase());\n  }\n  \n  /**\n   * Format bytes to human-readable size\n   * @param {number} bytes - Byte count\n   * @returns {string} Formatted size (e.g., \"2.5 MB\")\n   */\n  function formatBytes(bytes) {\n    if (!Number.isFinite(bytes) || bytes <= 0) return '0 B';\n    const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    const exp = Math.min(units.length - 1, Math.floor(Math.log(bytes) / Math.log(1024)));\n    const value = bytes / (1024 ** exp);\n    const fixed = value >= 100 ? value.toFixed(0) : value >= 10 ? value.toFixed(1) : value.toFixed(2);\n    return `${fixed} ${units[exp]}`;\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Element Creation Helpers\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  /**\n   * Create a simple text element\n   * @param {Object} context - jsgui context\n   * @param {string} tagName - HTML tag\n   * @param {string} [text] - Text content\n   * @param {string} [className] - CSS class\n   * @returns {Control}\n   */\n  function el(context, tagName, text, className) {\n    const ctrl = new Control({ context, tagName });\n    if (className) ctrl.add_class(className);\n    if (text) ctrl.add(text);\n    return ctrl;\n  }\n  \n  /**\n   * Create a div with optional class and content\n   * @param {Object} context - jsgui context\n   * @param {string} [className] - CSS class\n   * @param {string} [text] - Text content\n   * @returns {Control}\n   */\n  function div(context, className, text) {\n    return el(context, 'div', text, className);\n  }\n  \n  /**\n   * Create a span with optional class and content\n   * @param {Object} context - jsgui context\n   * @param {string} [className] - CSS class\n   * @param {string} [text] - Text content\n   * @returns {Control}\n   */\n  function span(context, className, text) {\n    return el(context, 'span', text, className);\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Composite Control Helpers\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  /**\n   * Create a section with emoji header\n   * @param {Object} context - jsgui context\n   * @param {string} emoji - Section emoji\n   * @param {string} title - Section title\n   * @param {string} [className] - Section CSS class\n   * @returns {Control}\n   */\n  function createSection(context, emoji, title, className) {\n    const section = new Control({ context, tagName: 'section' });\n    section.add_class(className || 'dashboard-section');\n    section.add(el(context, 'h2', `${emoji} ${title}`));\n    return section;\n  }\n  \n  /**\n   * Create a stat item (value + label pair)\n   * @param {Object} context - jsgui context\n   * @param {string} label - Stat label\n   * @param {string|number} value - Stat value\n   * @param {string} [className] - Container class\n   * @returns {Control}\n   */\n  function createStatItem(context, label, value, className = 'stat-item') {\n    const item = new Control({ context, tagName: 'div' });\n    item.add_class(className);\n    item.add(el(context, 'span', formatNumber(value), 'stat-value'));\n    item.add(el(context, 'span', label, 'stat-label'));\n    return item;\n  }\n  \n  /**\n   * Create an action button\n   * @param {Object} context - jsgui context\n   * @param {string} emoji - Button emoji\n   * @param {string} label - Button text\n   * @param {string} action - data-action attribute value\n   * @param {string} variant - 'primary', 'secondary', or 'danger'\n   * @param {boolean} [disabled] - Whether button is disabled\n   * @returns {Control}\n   */\n  function createActionButton(context, emoji, label, action, variant, disabled = false) {\n    const btn = new Control({ context, tagName: 'button' });\n    btn.add_class('action-btn');\n    btn.add_class(`btn-${variant}`);\n    btn.dom.attributes['data-action'] = action;\n    if (disabled) btn.dom.attributes.disabled = 'true';\n    btn.add(`${emoji} ${label}`);\n    return btn;\n  }\n  \n  /**\n   * Create a grid container\n   * @param {Object} context - jsgui context\n   * @param {string} [className] - Grid CSS class\n   * @returns {Control}\n   */\n  function createGrid(context, className = 'grid') {\n    return div(context, className);\n  }\n  \n  /**\n   * Create a badge element\n   * @param {Object} context - jsgui context\n   * @param {string} text - Badge text\n   * @param {string} [variant] - Badge variant (e.g., 'success', 'warning', 'error')\n   * @returns {Control}\n   */\n  function createBadge(context, text, variant) {\n    const badge = span(context, 'badge', text);\n    if (variant) badge.add_class(`badge-${variant}`);\n    return badge;\n  }\n  \n  // Return the factory API\n  return {\n    // Formatters\n    formatNumber,\n    formatLabel,\n    formatBytes,\n    \n    // Element creators\n    el,\n    div,\n    span,\n    \n    // Composite helpers\n    createSection,\n    createStatItem,\n    createActionButton,\n    createGrid,\n    createBadge\n  };\n}\n\nmodule.exports = createControlFactory;\n", "'use strict';\n\n/**\n * GeoImportDashboard - Live dashboard for geographic data import operations\n * \n * Two-column layout with navigation on left, detail view on right.\n * Shows real-time progress of gazetteer imports from GeoNames, OSM, Wikidata.\n * Uses jsgui3 Data_Object for reactive updates via on('change').\n * \n * Navigation sections:\n * - \uD83D\uDDC4\uFE0F Database - Database selector\n * - \uD83D\uDCCB Pipeline - Import stages stepper\n * - \uD83D\uDCE6 Sources - Data source cards (GeoNames, Wikidata, OSM)\n * - \uD83D\uDCC8 Coverage - Before/after statistics\n * - \uD83D\uDCDD Log - Live import log\n * \n * @example Server-side rendering:\n *   const { GeoImportDashboard } = require('./controls/GeoImportDashboard');\n *   const dashboard = new GeoImportDashboard({ context });\n *   const html = dashboard.all_html_render();\n * \n * @example Client-side activation with live updates:\n *   dashboard.activate();\n *   // Updates flow through WebSocket or polling\n */\n\nconst jsgui = require('jsgui3-html');\nconst { Control, controls } = jsgui;\nconst createControlFactory = require('./helpers/controlFactory');\nconst { createTwoColumnLayoutControls } = require('./layouts/TwoColumnLayoutFactory');\n\n// Initialize factories with jsgui instance\nconst {\n  el, createSection, createStatItem, createActionButton,\n  formatNumber, formatLabel\n} = createControlFactory(jsgui);\n\nconst { TwoColumnLayout, Sidebar, ContentArea, NavItem, DetailHeader } = createTwoColumnLayoutControls(jsgui);\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Label Constants\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Status display labels with emoji */\nconst STATUS_LABELS = {\n  'idle': '\u23F8\uFE0F Idle',\n  'ready': '\u2705 Ready',\n  'running': '\uD83D\uDD04 Running',\n  'completed': '\u2705 Complete',\n  'error': '\u274C Error',\n  'pending': '\u23F3 Pending',\n  'missing': '\u26A0\uFE0F Missing',\n  'coming-soon': '\uD83D\uDEA7 Coming Soon'\n};\n\n/** Phase display labels with emoji */\nconst PHASE_LABELS = {\n  'idle': '\u23F8\uFE0F Waiting to start',\n  'downloading': '\uD83D\uDCE5 Downloading files...',\n  'parsing': '\uD83D\uDCD1 Parsing data...',\n  'importing': '\uD83D\uDCBE Importing to database...',\n  'indexing': '\uD83D\uDD0D Building indexes...',\n  'validating': '\u2705 Validating data...',\n  'completed': '\uD83C\uDF89 Import complete!',\n  'error': '\u274C Error occurred'\n};\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Source Card Control - Shows individual data source status\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nclass SourceCard extends Control {\n  constructor(spec = {}) {\n    super({ ...spec, tagName: 'div', __type_name: 'source_card' });\n    \n    this.source = spec.source || {\n      id: 'unknown',\n      name: 'Unknown Source',\n      emoji: '\u2753',\n      status: 'idle',\n      description: ''\n    };\n    \n    this.add_class('geo-source-card');\n    this.add_class(`source-${this.source.id}`);\n    this.add_class(`status-${this.source.status}`);\n    \n    // Add coming-soon class if applicable\n    if (this.source.comingSoon) {\n      this.add_class('coming-soon');\n    }\n    \n    if (!spec.el) this.compose();\n  }\n  \n  compose() {\n    const { name, emoji, status, description, stats, lastRun, comingSoon, plannedFeatures, available } = this.source;\n    const ctx = this.context;\n    \n    // Header row: emoji + name + status badge\n    const header = el(ctx, 'div', null, 'source-header');\n    header.add(el(ctx, 'span', emoji, 'source-emoji'));\n    header.add(el(ctx, 'span', name, 'source-name'));\n    \n    // Status badge - special handling for coming-soon\n    if (comingSoon) {\n      const badge = el(ctx, 'span', '\uD83D\uDEA7 Coming Soon', 'status-badge');\n      badge.add_class('status-coming-soon');\n      header.add(badge);\n    } else {\n      const badge = el(ctx, 'span', STATUS_LABELS[status] || status, 'status-badge');\n      badge.add_class(`status-${status}`);\n      header.add(badge);\n    }\n    this.add(header);\n    \n    // Description\n    if (description) {\n      this.add(el(ctx, 'p', description, 'source-description'));\n    }\n    \n    // Planned features list for coming-soon sources\n    if (comingSoon && plannedFeatures && plannedFeatures.length > 0) {\n      const featuresList = el(ctx, 'div', null, 'planned-features');\n      featuresList.add(el(ctx, 'span', '\uD83D\uDCCB Planned:', 'features-label'));\n      const featuresText = plannedFeatures.map(f => `\u2022 ${f}`).join('  ');\n      featuresList.add(el(ctx, 'span', featuresText, 'features-list'));\n      this.add(featuresList);\n    }\n    \n    // Stats grid - show placeholder for coming-soon\n    if (stats) {\n      const grid = el(ctx, 'div', null, 'stats-grid');\n      if (comingSoon) {\n        grid.add_class('stats-disabled');\n      }\n      for (const [key, value] of Object.entries(stats)) {\n        grid.add(createStatItem(ctx, formatLabel(key), value));\n      }\n      this.add(grid);\n    }\n    \n    // Last run or availability message\n    if (lastRun) {\n      this.add(el(ctx, 'div', `Last run: ${lastRun}`, 'last-run'));\n    } else if (comingSoon) {\n      this.add(el(ctx, 'div', '\u23F3 Backend integration in development', 'availability-note'));\n    } else if (available) {\n      this.add(el(ctx, 'div', '\u2705 Ready to import', 'availability-note ready'));\n    }\n  }\n}\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Progress Ring Control - Circular SVG progress indicator\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nclass ProgressRing extends Control {\n  constructor(spec = {}) {\n    // Extract custom properties to avoid jsgui3's built-in size setter collision\n    const { progress = 0, size = 120, strokeWidth = 8, color = '#4CAF50', ...restSpec } = spec;\n    \n    super({ ...restSpec, tagName: 'div', __type_name: 'progress_ring' });\n    \n    this._progress = progress;\n    this._ringSize = size;\n    this._strokeWidth = strokeWidth;\n    this._color = color;\n    \n    this.add_class('progress-ring-container');\n    this.dom.attributes['data-progress'] = String(progress);\n    this.dom.attributes['data-ring-size'] = String(size);\n    \n    if (!spec.el) this.compose();\n  }\n  \n  compose() {\n    const { _ringSize: size, _strokeWidth: sw, _progress: progress, _color: color } = this;\n    const ctx = this.context;\n    \n    const radius = (size - sw) / 2;\n    const circumference = 2 * Math.PI * radius;\n    const offset = circumference - (progress / 100) * circumference;\n    const center = size / 2;\n    \n    // SVG element\n    const svg = new Control({ context: ctx, tagName: 'svg' });\n    svg.add_class('progress-ring');\n    svg.dom.attributes = {\n      width: size, height: size,\n      viewBox: `0 0 ${size} ${size}`\n    };\n    \n    // Background circle\n    const bgCircle = new Control({ context: ctx, tagName: 'circle' });\n    bgCircle.dom.attributes = {\n      cx: center, cy: center, r: radius,\n      fill: 'none', stroke: '#e0e0e0', 'stroke-width': sw\n    };\n    svg.add(bgCircle);\n    \n    // Progress arc\n    const arc = new Control({ context: ctx, tagName: 'circle' });\n    arc.add_class('progress-ring-circle');\n    arc.dom.attributes = {\n      cx: center, cy: center, r: radius,\n      fill: 'none', stroke: color, 'stroke-width': sw,\n      'stroke-linecap': 'round',\n      'stroke-dasharray': circumference,\n      'stroke-dashoffset': offset,\n      transform: `rotate(-90 ${center} ${center})`\n    };\n    svg.add(arc);\n    \n    this.add(svg);\n    this.add(el(ctx, 'div', `${Math.round(progress)}%`, 'progress-ring-text'));\n  }\n}\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Stages Stepper Control - Visual pipeline progress indicator\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Import stage definitions with emoji and description */\nconst IMPORT_STAGES = [\n  { id: 'idle', label: 'Ready', emoji: '\u23F8\uFE0F', description: 'Waiting to start' },\n  { id: 'validating', label: 'Validating', emoji: '\uD83D\uDD0D', description: 'Checking source files' },\n  { id: 'counting', label: 'Counting', emoji: '\uD83D\uDCCA', description: 'Counting records' },\n  { id: 'preparing', label: 'Preparing', emoji: '\u2699\uFE0F', description: 'Setting up database' },\n  { id: 'importing', label: 'Importing', emoji: '\uD83D\uDCBE', description: 'Importing records' },\n  { id: 'indexing', label: 'Indexing', emoji: '\uD83D\uDDC2\uFE0F', description: 'Building indexes' },\n  { id: 'verifying', label: 'Verifying', emoji: '\u2705', description: 'Validating coverage' },\n  { id: 'complete', label: 'Complete', emoji: '\uD83C\uDF89', description: 'Import finished' }\n];\n\n/** Maps status to stage index for highlighting */\nconst STAGE_INDEX = IMPORT_STAGES.reduce((acc, stage, i) => {\n  acc[stage.id] = i;\n  return acc;\n}, {});\n\nclass StagesStepper extends Control {\n  constructor(spec = {}) {\n    super({ ...spec, tagName: 'div', __type_name: 'stages_stepper' });\n    \n    this.currentStage = spec.currentStage || 'idle';\n    this.stages = spec.stages || IMPORT_STAGES;\n    this._stageElements = {};\n    \n    this.add_class('stages-stepper');\n    this.dom.attributes['data-current-stage'] = this.currentStage;\n    \n    if (!spec.el) this.compose();\n  }\n  \n  compose() {\n    const ctx = this.context;\n    const currentIndex = STAGE_INDEX[this.currentStage] ?? 0;\n    \n    for (let i = 0; i < this.stages.length; i++) {\n      const stage = this.stages[i];\n      const stageEl = el(ctx, 'div', null, 'stage-item');\n      stageEl.dom.attributes['data-stage-id'] = stage.id;\n      \n      // Determine state: completed, current, or pending\n      if (i < currentIndex) {\n        stageEl.add_class('stage-completed');\n      } else if (i === currentIndex) {\n        stageEl.add_class('stage-current');\n      } else {\n        stageEl.add_class('stage-pending');\n      }\n      \n      // Stage marker (circle with emoji or checkmark)\n      const marker = el(ctx, 'div', null, 'stage-marker');\n      if (i < currentIndex) {\n        marker.add('\u2713');\n      } else {\n        marker.add(stage.emoji);\n      }\n      stageEl.add(marker);\n      \n      // Stage label\n      const label = el(ctx, 'div', stage.label, 'stage-label');\n      stageEl.add(label);\n      \n      // Connector line (except for last stage)\n      if (i < this.stages.length - 1) {\n        const connector = el(ctx, 'div', null, 'stage-connector');\n        if (i < currentIndex) {\n          connector.add_class('connector-completed');\n        }\n        stageEl.add(connector);\n      }\n      \n      this._stageElements[stage.id] = stageEl;\n      this.add(stageEl);\n    }\n  }\n  \n  /**\n   * Update current stage (client-side)\n   * @param {string} stageId - Stage ID to set as current\n   */\n  setStage(stageId) {\n    this.currentStage = stageId;\n    this.dom.attributes['data-current-stage'] = stageId;\n    // DOM update handled by client-side script\n  }\n}\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Live Log Control - Scrolling log viewer\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nclass LiveLog extends Control {\n  constructor(spec = {}) {\n    super({ ...spec, tagName: 'div', __type_name: 'live_log' });\n    \n    this.entries = spec.entries || [];\n    this.maxEntries = spec.maxEntries || 100;\n    this._logBody = null;\n    \n    this.add_class('live-log');\n    \n    if (!spec.el) this.compose();\n  }\n  \n  compose() {\n    const ctx = this.context;\n    \n    this.add(el(ctx, 'div', '\uD83D\uDCCB Import Log', 'log-header'));\n    \n    this._logBody = el(ctx, 'div', null, 'log-body');\n    this._logBody.dom.attributes['data-log-container'] = 'true';\n    \n    for (const entry of this.entries.slice(-this.maxEntries)) {\n      this._logBody.add(this._createLogEntry(entry));\n    }\n    this.add(this._logBody);\n  }\n  \n  _createLogEntry(entry) {\n    const ctx = this.context;\n    const row = el(ctx, 'div', null, 'log-entry');\n    row.add_class(`log-${entry.level || 'info'}`);\n    row.add(el(ctx, 'span', entry.time || new Date().toLocaleTimeString(), 'log-timestamp'));\n    row.add(el(ctx, 'span', entry.message, 'log-message'));\n    return row;\n  }\n  \n  addEntry(entry) {\n    this.entries.push(entry);\n    if (this.entries.length > this.maxEntries) this.entries.shift();\n  }\n}\n\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Main Dashboard Control\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Default data sources */\nconst DEFAULT_SOURCES = {\n  geonames: {\n    id: 'geonames',\n    name: 'GeoNames',\n    emoji: '\uD83C\uDF0D',\n    status: 'ready',\n    description: 'cities15000.txt: ~25,000 cities with population >15K',\n    stats: { expected_cities: 25000, expected_names: 150000 },\n    available: true\n  },\n  wikidata: {\n    id: 'wikidata',\n    name: 'Wikidata',\n    emoji: '\uD83D\uDCDA',\n    status: 'coming-soon',\n    description: 'SPARQL queries for Wikidata IDs, population updates, and multilingual names',\n    stats: { linked_entities: '\u2014' },\n    available: false,\n    comingSoon: true,\n    plannedFeatures: ['Entity linking', 'Population sync', 'Multilingual labels']\n  },\n  osm: {\n    id: 'osm',\n    name: 'OpenStreetMap',\n    emoji: '\uD83D\uDDFA\uFE0F',\n    status: 'coming-soon',\n    description: 'Administrative boundaries and spatial containment queries',\n    stats: { boundaries: '\u2014' },\n    available: false,\n    comingSoon: true,\n    plannedFeatures: ['Admin boundaries', 'Spatial queries', 'PostGIS integration']\n  }\n};\n\n/** Default log entries */\nconst DEFAULT_LOGS = [\n  { time: '10:30:00', level: 'info', message: 'Import dashboard initialized' },\n  { time: '10:30:01', level: 'info', message: 'Checking GeoNames file availability...' },\n  { time: '10:30:02', level: 'success', message: 'cities15000.txt found (2.9 MB)' },\n  { time: '10:30:03', level: 'info', message: 'Ready to import 24,687 cities' }\n];\n\n/** Navigation sections for the dashboard */\nconst NAV_SECTIONS = [\n  { id: 'database', label: 'Database', icon: '\uD83D\uDDC4\uFE0F' },\n  { id: 'pipeline', label: 'Pipeline', icon: '\uD83D\uDCCB' },\n  { id: 'sources', label: 'Data Sources', icon: '\uD83D\uDCE6' },\n  { id: 'coverage', label: 'Coverage', icon: '\uD83D\uDCC8' },\n  { id: 'log', label: 'Import Log', icon: '\uD83D\uDCDD' }\n];\n\nclass GeoImportDashboard extends Control {\n  constructor(spec = {}) {\n    super({ ...spec, tagName: 'div', __type_name: 'geo_import_dashboard' });\n    \n    this.add_class('geo-import-dashboard');\n    this.dom.attributes['data-jsgui-control'] = 'geo_import_dashboard';\n    \n    // Active view\n    this.activeView = spec.activeView || 'pipeline';\n    \n    // Layout controls\n    this._layout = null;\n    this._sidebar = null;\n    this._contentArea = null;\n    \n    // Child control references\n    this._progressRing = null;\n    this._stagesStepper = null;\n    this._sourceCards = {};\n    this._liveLog = null;\n    \n    // Database selector (passed from server)\n    this._dbSelector = spec.dbSelector || null;\n    \n    // State with sensible defaults\n    this.importState = {\n      phase: 'idle',\n      currentSource: null,\n      progress: { current: 0, total: 0 },\n      sources: DEFAULT_SOURCES,\n      logs: [],\n      totals: {\n        places_before: 508,\n        places_after: 0,\n        names_before: 14855,\n        names_after: 0\n      },\n      ...spec.importState\n    };\n    \n    if (!spec.el) this.compose();\n  }\n  \n  setImportState(state) {\n    this.importState = { ...this.importState, ...state };\n  }\n  \n  setDbSelector(dbSelector) {\n    this._dbSelector = dbSelector;\n  }\n  \n  compose() {\n    const ctx = this.context;\n    \n    // Create two-column layout\n    this._layout = new TwoColumnLayout({\n      context: ctx,\n      sidebarTitle: 'Gazetteer Import',\n      sidebarIcon: '\uD83C\uDF10',\n      sidebarWidth: 240,\n      navItems: NAV_SECTIONS.map(s => ({\n        ...s,\n        selected: s.id === this.activeView\n      })),\n      selectedId: this.activeView,\n      contentTitle: this._getViewTitle(this.activeView),\n      contentIcon: this._getViewIcon(this.activeView),\n      contentSubtitle: this._getViewSubtitle(this.activeView)\n    });\n    \n    // Store references\n    this._sidebar = this._layout.sidebar;\n    this._contentArea = this._layout.contentArea;\n    \n    // Add content based on active view\n    this._composeActiveView();\n    \n    // Add actions at bottom of sidebar\n    this._composeActions();\n    \n    this.add(this._layout);\n  }\n  \n  _getViewTitle(viewId) {\n    const titles = {\n      database: 'Database Selection',\n      pipeline: 'Import Pipeline',\n      sources: 'Data Sources',\n      coverage: 'Coverage Statistics',\n      log: 'Import Log'\n    };\n    return titles[viewId] || 'Details';\n  }\n  \n  _getViewIcon(viewId) {\n    const item = NAV_SECTIONS.find(s => s.id === viewId);\n    return item ? item.icon : '\uD83D\uDCCB';\n  }\n  \n  _getViewSubtitle(viewId) {\n    const subtitles = {\n      database: 'Select and configure target database',\n      pipeline: 'Track import stage progress',\n      sources: 'Configure and monitor data sources',\n      coverage: 'Before and after import statistics',\n      log: 'Real-time import activity log'\n    };\n    return subtitles[viewId] || null;\n  }\n  \n  _composeActiveView() {\n    const contentBody = this._contentArea.getBody();\n    \n    switch (this.activeView) {\n      case 'database':\n        this._composeDatabaseView(contentBody);\n        break;\n      case 'pipeline':\n        this._composePipelineView(contentBody);\n        break;\n      case 'sources':\n        this._composeSourcesView(contentBody);\n        break;\n      case 'coverage':\n        this._composeCoverageView(contentBody);\n        break;\n      case 'log':\n        this._composeLogView(contentBody);\n        break;\n      default:\n        this._composePipelineView(contentBody);\n    }\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // View Composers\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  _composeDatabaseView(container) {\n    const ctx = this.context;\n    \n    // If we have a database selector from server, add it\n    if (this._dbSelector) {\n      container.add(this._dbSelector);\n    } else {\n      // Placeholder\n      const placeholder = el(ctx, 'div', null, 'db-placeholder');\n      placeholder.add(el(ctx, 'p', '\uD83D\uDDC4\uFE0F Database selector will appear here'));\n      placeholder.add(el(ctx, 'p', 'Current path: data/gazetteer.db', 'db-path'));\n      container.add(placeholder);\n    }\n    \n    // Database stats summary\n    const stats = el(ctx, 'div', null, 'db-stats-compact');\n    stats.add(createStatItem(ctx, 'Places', this.importState.totals.places_before || 0));\n    stats.add(createStatItem(ctx, 'Names', this.importState.totals.names_before || 0));\n    container.add(stats);\n  }\n  \n  _composePipelineView(container) {\n    const ctx = this.context;\n    const { current, total } = this.importState.progress;\n    const percent = total > 0 ? (current / total) * 100 : 0;\n    \n    // Stages stepper\n    this._stagesStepper = new StagesStepper({\n      context: ctx,\n      currentStage: this.importState.phase || 'idle',\n      stages: IMPORT_STAGES\n    });\n    container.add(this._stagesStepper);\n    \n    // Progress section\n    const progressContainer = el(ctx, 'div', null, 'progress-compact');\n    \n    // Progress ring (smaller for compact view)\n    this._progressRing = new ProgressRing({\n      context: ctx,\n      progress: percent,\n      size: 100,\n      strokeWidth: 8,\n      color: this._getProgressColor(percent)\n    });\n    progressContainer.add(this._progressRing);\n    \n    // Stats\n    const stats = el(ctx, 'div', null, 'progress-stats-compact');\n    stats.add(el(ctx, 'div', `${formatNumber(current)} / ${formatNumber(total)} records`, 'progress-count'));\n    stats.add(el(ctx, 'div', PHASE_LABELS[this.importState.phase] || this.importState.phase, 'progress-phase'));\n    progressContainer.add(stats);\n    \n    container.add(progressContainer);\n  }\n  \n  _composeSourcesView(container) {\n    const ctx = this.context;\n    \n    // Source cards in compact grid\n    const grid = el(ctx, 'div', null, 'sources-grid-compact');\n    for (const source of Object.values(this.importState.sources)) {\n      const card = new SourceCard({ context: ctx, source });\n      this._sourceCards[source.id] = card;\n      grid.add(card);\n    }\n    container.add(grid);\n  }\n  \n  _composeCoverageView(container) {\n    const ctx = this.context;\n    const { totals } = this.importState;\n    \n    const grid = el(ctx, 'div', null, 'coverage-grid-compact');\n    \n    // Before column\n    grid.add(this._createCoverageColumn('Before', {\n      places: totals.places_before,\n      names: totals.names_before,\n      ukCities: 5,\n      usCities: 10\n    }, 'before'));\n    \n    // Arrow\n    grid.add(el(ctx, 'div', '\u27A1\uFE0F', 'coverage-arrow'));\n    \n    // After column\n    grid.add(this._createCoverageColumn('After', {\n      places: totals.places_after || '~25,000',\n      names: totals.names_after || '~150,000',\n      ukCities: '500+',\n      usCities: '3,000+'\n    }, 'after'));\n    \n    container.add(grid);\n  }\n  \n  _composeLogView(container) {\n    const ctx = this.context;\n    \n    this._liveLog = new LiveLog({\n      context: ctx,\n      entries: this.importState.logs.length > 0 ? this.importState.logs : DEFAULT_LOGS,\n      maxEntries: 200\n    });\n    container.add(this._liveLog);\n  }\n  \n  _composeActions() {\n    const ctx = this.context;\n    \n    // Actions panel at bottom of sidebar\n    const actionsPanel = el(ctx, 'div', null, 'sidebar-actions');\n    \n    actionsPanel.add(createActionButton(ctx, '\uD83D\uDE80', 'Start', 'start-import', 'primary'));\n    actionsPanel.add(createActionButton(ctx, '\u23F8\uFE0F', 'Pause', 'pause-import', 'secondary', true));\n    actionsPanel.add(createActionButton(ctx, '\uD83D\uDED1', 'Cancel', 'cancel-import', 'danger', true));\n    \n    this._sidebar.add(actionsPanel);\n  }\n  \n  _createCoverageColumn(label, stats, type) {\n    const ctx = this.context;\n    const col = el(ctx, 'div', null, 'coverage-column');\n    col.add_class(`coverage-${type}`);\n    col.add(el(ctx, 'h3', label));\n    \n    for (const [key, value] of Object.entries(stats)) {\n      const item = el(ctx, 'div', null, 'coverage-item');\n      item.add(el(ctx, 'span', formatNumber(value), 'coverage-value'));\n      item.add(el(ctx, 'span', formatLabel(key), 'coverage-label'));\n      col.add(item);\n    }\n    return col;\n  }\n  \n  _getProgressColor(percent) {\n    if (percent < 25) return '#c9a227'; // Gold\n    if (percent < 50) return '#daa520';\n    if (percent < 75) return '#b8860b';\n    return '#c9a227';\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Client-Side Activation\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  activate() {\n    if (this.__active) return;\n    super.activate();\n    this._bindActionButtons();\n    this._bindNavigation();\n  }\n  \n  /**\n   * Bind navigation events using jsgui3 event system\n   * \n   * Event flow:\n   * 1. NavItem.activate() binds DOM click \u2192 raises 'select' event\n   * 2. Sidebar.addNavItem() subscribes to NavItem's 'select' \u2192 re-raises as 'nav-select'\n   * 3. TwoColumnLayout.compose() subscribes to Sidebar's 'nav-select' \u2192 re-raises as 'view-change'\n   * 4. Dashboard.activate() subscribes to TwoColumnLayout's 'view-change' \u2192 handles navigation\n   */\n  _bindNavigation() {\n    if (!this._layout) return;\n    \n    // Subscribe to the layout's 'view-change' event using jsgui3 native event system\n    this._layout.on('view-change', (data) => {\n      console.log('[GeoImportDashboard] view-change event received:', data);\n      this._handleViewChange(data.id);\n    });\n  }\n  \n  _handleViewChange(viewId) {\n    console.log('[GeoImportDashboard] Switching to view:', viewId);\n    // Navigate via URL change (server handles view rendering)\n    window.location.search = `?view=${viewId}`;\n  }\n  \n  /**\n   * Bind action buttons using jsgui3 delegation pattern\n   * Uses this.on() where possible, falls back to querySelector for specific data-action elements\n   */\n  _bindActionButtons() {\n    if (!this.dom.el) return;\n    \n    // Use delegated event handling for action buttons\n    this.on('click', (e) => {\n      const actionBtn = e.target.closest('[data-action]');\n      if (!actionBtn) return;\n      \n      const action = actionBtn.getAttribute('data-action');\n      switch (action) {\n        case 'start-import':\n          this._handleStartImport();\n          break;\n        case 'pause-import':\n          this._handlePauseImport();\n          break;\n        case 'cancel-import':\n          this._handleCancelImport();\n          break;\n      }\n    });\n  }\n  \n  _handleStartImport() {\n    console.log('[GeoImportDashboard] Starting import...');\n  }\n  \n  _handlePauseImport() {\n    console.log('[GeoImportDashboard] Pausing import...');\n  }\n  \n  _handleCancelImport() {\n    console.log('[GeoImportDashboard] Cancelling import...');\n  }\n}\n\n// Register controls\ncontrols.GeoImportDashboard = GeoImportDashboard;\ncontrols.SourceCard = SourceCard;\ncontrols.ProgressRing = ProgressRing;\ncontrols.LiveLog = LiveLog;\ncontrols.StagesStepper = StagesStepper;\n\nmodule.exports = { \n  GeoImportDashboard, \n  SourceCard, \n  ProgressRing, \n  LiveLog,\n  StagesStepper\n};\n", "// Import jsgui3-client and register controls using the standard controlRegistry pattern\nconst jsgui = require('jsgui3-client');\nconst { registerControlType } = require('../../controls/controlRegistry');\n\n// Import TwoColumnLayout controls and register them with jsgui\nconst { createTwoColumnLayoutControls } = require('../../controls/layouts/TwoColumnLayoutFactory');\nconst layoutControls = createTwoColumnLayoutControls(jsgui);\n\n// Import dashboard controls for client-side activation\nconst { \n  GeoImportDashboard, \n  SourceCard, \n  ProgressRing, \n  LiveLog,\n  StagesStepper\n} = require('../../controls/GeoImportDashboard');\n\n// Build a list of controls to register\nconst LAYOUT_CONTROLS = [\n  { type: 'nav_item', control: layoutControls.NavItem },\n  { type: 'sidebar', control: layoutControls.Sidebar },\n  { type: 'content_area', control: layoutControls.ContentArea },\n  { type: 'two_column_layout', control: layoutControls.TwoColumnLayout },\n  { type: 'detail_header', control: layoutControls.DetailHeader }\n];\n\n// Dashboard-specific controls\nconst DASHBOARD_CONTROLS = [\n  { type: 'geo_import_dashboard', control: GeoImportDashboard },\n  { type: 'source_card', control: SourceCard },\n  { type: 'progress_ring', control: ProgressRing },\n  { type: 'live_log', control: LiveLog },\n  { type: 'stages_stepper', control: StagesStepper }\n];\n\n// Register all controls on the jsgui module itself\n[...LAYOUT_CONTROLS, ...DASHBOARD_CONTROLS].forEach(({ type, control }) => {\n  registerControlType(type, control, { jsguiInstance: jsgui });\n});\n\n// Debug: log what's registered\nconsole.log('[GeoImport] jsgui.controls keys:', Object.keys(jsgui.controls || {}));\nconsole.log('[GeoImport] jsgui.map_Controls keys:', Object.keys(jsgui.map_Controls || {}));\n\n/**\n * Inject registered controls into a jsgui context.\n * This is called during pre_activate and activate to ensure the context\n * has access to our custom control constructors.\n */\nfunction injectControlsIntoContext(context) {\n  if (!context) return;\n  console.log('[GeoImport] Injecting controls into context');\n  const map = context.map_Controls || (context.map_Controls = {});\n  \n  // Copy from jsgui.map_Controls\n  if (jsgui.map_Controls) {\n    Object.keys(jsgui.map_Controls).forEach(key => {\n      if (!map[key]) {\n        map[key] = jsgui.map_Controls[key];\n      }\n    });\n  }\n  \n  // Ensure all our controls (layout + dashboard) are in the context\n  [...LAYOUT_CONTROLS, ...DASHBOARD_CONTROLS].forEach(({ type, control }) => {\n    const key = type.toLowerCase();\n    if (!map[key]) {\n      map[key] = control;\n    }\n  });\n  \n  console.log('[GeoImport] context.map_Controls keys after injection:', Object.keys(map));\n}\n\n// Hook into jsgui's pre_activate to inject controls\nconst originalPreActivate = jsgui.pre_activate;\nif (typeof originalPreActivate === 'function') {\n  jsgui.pre_activate = function wrappedPreActivate(context, ...args) {\n    injectControlsIntoContext(context);\n    return originalPreActivate.call(this, context, ...args);\n  };\n}\n\n// Hook into jsgui's activate to inject controls\nconst originalActivate = jsgui.activate;\nif (typeof originalActivate === 'function') {\n  jsgui.activate = function wrappedActivate(context, ...args) {\n    injectControlsIntoContext(context);\n    return originalActivate.call(this, context, ...args);\n  };\n}\n\n// Hook into Client_Page_Context constructor\nconst ClientPageContext = jsgui.Client_Page_Context;\nif (typeof ClientPageContext === 'function') {\n  class GeoImportClientPageContext extends ClientPageContext {\n    constructor(...args) {\n      super(...args);\n      injectControlsIntoContext(this);\n    }\n  }\n  jsgui.Client_Page_Context = GeoImportClientPageContext;\n}\n\nconsole.log('[GeoImport] Layout controls registered:', LAYOUT_CONTROLS.map(c => c.type).join(', '));\n\n(function() {\n  'use strict';\n  \n  // DOM references\n  const dashboard = document.querySelector('.geo-import-dashboard');\n  const progressRing = document.querySelector('.progress-ring-circle');\n  const progressText = document.querySelector('.progress-ring-text');\n  const progressStat = document.querySelector('.progress-stat');\n  const progressPhase = document.querySelector('.progress-phase');\n  const logBody = document.querySelector('.log-body');\n  const startBtn = document.querySelector('[data-action=\"start-import\"]');\n  const pauseBtn = document.querySelector('[data-action=\"pause-import\"]');\n  const cancelBtn = document.querySelector('[data-action=\"cancel-import\"]');\n  \n  // Connection status indicator\n  const statusEl = document.createElement('div');\n  statusEl.className = 'connection-status disconnected';\n  statusEl.textContent = '\u26A1 Connecting...';\n  document.body.appendChild(statusEl);\n  \n  // State\n  let currentState = null;\n  let eventSource = null;\n  \n  // Metrics tracking\n  let metricsHistory = [];\n  let stageTimes = {};\n  let lastProgressUpdate = Date.now();\n  let recordsPerSecond = 0;\n  \n  // Toast container\n  const toastContainer = document.createElement('div');\n  toastContainer.className = 'toast-container';\n  document.body.appendChild(toastContainer);\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // SSE Connection\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  function connectSSE() {\n    eventSource = new EventSource('/api/geo-import/events');\n    \n    eventSource.onopen = () => {\n      statusEl.className = 'connection-status connected';\n      statusEl.textContent = '\uD83D\uDFE2 Connected';\n      console.log('[GeoImport] SSE connected');\n    };\n    \n    eventSource.onerror = (err) => {\n      statusEl.className = 'connection-status disconnected';\n      statusEl.textContent = '\uD83D\uDD34 Disconnected';\n      console.error('[GeoImport] SSE error:', err);\n      \n      // Reconnect after delay\n      setTimeout(connectSSE, 3000);\n    };\n    \n    // Initial state\n    eventSource.addEventListener('init', (e) => {\n      const data = JSON.parse(e.data);\n      currentState = data.state;\n      updateUI(currentState);\n      console.log('[GeoImport] Initial state:', currentState);\n    });\n    \n    // Progress updates\n    eventSource.addEventListener('progress', (e) => {\n      const data = JSON.parse(e.data);\n      currentState = data.state;\n      updateProgress(currentState);\n    });\n    \n    // Stage changes\n    eventSource.addEventListener('stage-change', (e) => {\n      const data = JSON.parse(e.data);\n      currentState = data.state;\n      updateUI(currentState);\n    });\n    \n    // Log entries\n    eventSource.addEventListener('log', (e) => {\n      const data = JSON.parse(e.data);\n      appendLog(data.entry);\n    });\n    \n    // State changes\n    eventSource.addEventListener('state-change', (e) => {\n      const data = JSON.parse(e.data);\n      currentState = data.state;\n      updateUI(currentState);\n    });\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // UI Updates\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  function updateUI(state) {\n    updateProgress(state);\n    updateStagesStepper(state);\n    updateButtons(state);\n    updateSourceCards(state);\n  }\n  \n  function updateStagesStepper(state) {\n    const stepper = document.querySelector('.stages-stepper');\n    if (!stepper) return;\n    \n    const currentStageId = state.status || state.stage?.id || 'idle';\n    const prevStageId = stepper.getAttribute('data-current-stage');\n    stepper.setAttribute('data-current-stage', currentStageId);\n    \n    // Track stage timing\n    const now = Date.now();\n    if (currentStageId !== prevStageId) {\n      // Stage changed - record duration of previous stage\n      if (prevStageId && stageTimes[prevStageId]?.start) {\n        stageTimes[prevStageId].end = now;\n        stageTimes[prevStageId].duration = now - stageTimes[prevStageId].start;\n      }\n      // Start timing new stage\n      stageTimes[currentStageId] = { start: now };\n      \n      // Show toast notification for stage change\n      if (currentStageId !== 'idle') {\n        showToast(getStageEmoji(currentStageId) + ' ' + getStageLabel(currentStageId), 'info');\n      }\n      if (currentStageId === 'complete') {\n        showToast('\uD83C\uDF89 Import completed successfully!', 'success');\n        playCompletionSound();\n      }\n    }\n    \n    const stages = stepper.querySelectorAll('.stage-item');\n    const stageIds = ['idle', 'validating', 'counting', 'preparing', 'importing', 'indexing', 'verifying', 'complete'];\n    const currentIndex = stageIds.indexOf(currentStageId);\n    \n    stages.forEach((stageEl, index) => {\n      const stageId = stageIds[index];\n      stageEl.classList.remove('stage-completed', 'stage-current', 'stage-pending');\n      \n      const connector = stageEl.querySelector('.stage-connector');\n      if (connector) {\n        connector.classList.remove('connector-completed');\n      }\n      \n      if (index < currentIndex) {\n        stageEl.classList.add('stage-completed');\n        if (connector) connector.classList.add('connector-completed');\n        \n        // Add duration badge for completed stages\n        addStageDuration(stageEl, stageId);\n      } else if (index === currentIndex) {\n        stageEl.classList.add('stage-current');\n        // Show live duration for current stage\n        updateLiveStageDuration(stageEl, stageId);\n      } else {\n        stageEl.classList.add('stage-pending');\n      }\n    });\n  }\n  \n  function addStageDuration(stageEl, stageId) {\n    let durationEl = stageEl.querySelector('.stage-duration');\n    if (!durationEl) {\n      durationEl = document.createElement('div');\n      durationEl.className = 'stage-duration';\n      stageEl.appendChild(durationEl);\n    }\n    \n    const timing = stageTimes[stageId];\n    if (timing?.duration) {\n      durationEl.textContent = formatDuration(Math.floor(timing.duration / 1000));\n    }\n  }\n  \n  function updateLiveStageDuration(stageEl, stageId) {\n    let durationEl = stageEl.querySelector('.stage-duration');\n    if (!durationEl) {\n      durationEl = document.createElement('div');\n      durationEl.className = 'stage-duration';\n      stageEl.appendChild(durationEl);\n    }\n    \n    const timing = stageTimes[stageId];\n    if (timing?.start) {\n      const elapsed = Math.floor((Date.now() - timing.start) / 1000);\n      durationEl.textContent = formatDuration(elapsed) + '...';\n    }\n  }\n  \n  function getStageEmoji(stageId) {\n    const emojis = {\n      'idle': '\u23F8\uFE0F', 'validating': '\uD83D\uDD0D', 'counting': '\uD83D\uDCCA', 'preparing': '\u2699\uFE0F',\n      'importing': '\uD83D\uDCBE', 'indexing': '\uD83D\uDDC2\uFE0F', 'verifying': '\u2705', 'complete': '\uD83C\uDF89'\n    };\n    return emojis[stageId] || '\u2022';\n  }\n  \n  function getStageLabel(stageId) {\n    const labels = {\n      'idle': 'Ready', 'validating': 'Validating files...', 'counting': 'Counting records...',\n      'preparing': 'Preparing database...', 'importing': 'Importing records...',\n      'indexing': 'Building indexes...', 'verifying': 'Verifying data...', 'complete': 'Complete'\n    };\n    return labels[stageId] || stageId;\n  }\n  \n  function updateProgress(state) {\n    const { progress, stage } = state;\n    const percent = progress.percent || 0;\n    const now = Date.now();\n    \n    // Calculate speed (records per second)\n    if (progress.current > 0) {\n      const timeDiff = (now - lastProgressUpdate) / 1000;\n      if (timeDiff > 0 && metricsHistory.length > 0) {\n        const lastProgress = metricsHistory[metricsHistory.length - 1];\n        const recordsDiff = progress.current - lastProgress.current;\n        if (recordsDiff > 0) {\n          recordsPerSecond = Math.round(recordsDiff / timeDiff);\n        }\n      }\n      metricsHistory.push({ current: progress.current, time: now });\n      // Keep only last 10 entries\n      if (metricsHistory.length > 10) metricsHistory.shift();\n      lastProgressUpdate = now;\n    }\n    \n    // Calculate ETA\n    const remaining = (progress.total || 0) - (progress.current || 0);\n    const etaSeconds = recordsPerSecond > 0 ? Math.ceil(remaining / recordsPerSecond) : 0;\n    const etaFormatted = formatDuration(etaSeconds);\n    \n    // Update ring\n    if (progressRing) {\n      const radius = progressRing.r.baseVal.value;\n      const circumference = 2 * Math.PI * radius;\n      const offset = circumference - (percent / 100) * circumference;\n      progressRing.style.strokeDashoffset = offset;\n    }\n    \n    // Update text\n    if (progressText) {\n      progressText.textContent = percent + '%';\n    }\n    \n    // Update stats with animation\n    if (progressStat) {\n      progressStat.innerHTML = \n        '<span class=\"stat-value counting\">' + formatNumber(progress.current) + '</span> / ' +\n        '<span class=\"stat-total\">' + formatNumber(progress.total) + '</span> records';\n    }\n    \n    // Update phase\n    if (progressPhase && stage) {\n      progressPhase.textContent = stage.emoji + ' ' + stage.description;\n    }\n    \n    // Update metrics (ETA & Speed)\n    updateMetrics(etaFormatted, recordsPerSecond, state.elapsed);\n  }\n  \n  function updateMetrics(eta, speed, elapsed) {\n    let metricsEl = document.querySelector('.progress-metrics');\n    if (!metricsEl) {\n      // Create metrics section if it doesn't exist\n      metricsEl = document.createElement('div');\n      metricsEl.className = 'progress-metrics';\n      metricsEl.innerHTML = \n        '<div class=\"metric-item\">' +\n          '<span class=\"metric-value speed\" data-metric=\"speed\">0</span>' +\n          '<span class=\"metric-label\">Records/sec</span>' +\n        '</div>' +\n        '<div class=\"metric-item\">' +\n          '<span class=\"metric-value eta\" data-metric=\"eta\">--:--</span>' +\n          '<span class=\"metric-label\">ETA</span>' +\n        '</div>' +\n        '<div class=\"metric-item\">' +\n          '<span class=\"metric-value\" data-metric=\"elapsed\">00:00</span>' +\n          '<span class=\"metric-label\">Elapsed</span>' +\n        '</div>';\n      const progressStats = document.querySelector('.progress-stats');\n      if (progressStats) progressStats.appendChild(metricsEl);\n    }\n    \n    const speedEl = metricsEl.querySelector('[data-metric=\"speed\"]');\n    const etaEl = metricsEl.querySelector('[data-metric=\"eta\"]');\n    const elapsedEl = metricsEl.querySelector('[data-metric=\"elapsed\"]');\n    \n    if (speedEl) speedEl.textContent = formatNumber(speed);\n    if (etaEl) etaEl.textContent = eta || '--:--';\n    if (elapsedEl) elapsedEl.textContent = formatDuration(Math.floor((elapsed || 0) / 1000));\n  }\n  \n  function formatDuration(totalSeconds) {\n    if (!totalSeconds || totalSeconds < 0) return '--:--';\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    if (hours > 0) {\n      return hours + ':' + String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');\n    }\n    return String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');\n  }\n  \n  function updateButtons(state) {\n    const { status } = state;\n    const isRunning = ['validating', 'counting', 'preparing', 'importing', 'indexing', 'verifying'].includes(status);\n    const isPaused = status === 'paused';\n    \n    if (startBtn) {\n      startBtn.disabled = isRunning || isPaused;\n      startBtn.textContent = isRunning ? '\uD83D\uDD04 Running...' : '\uD83D\uDE80 Start Import';\n    }\n    \n    if (pauseBtn) {\n      pauseBtn.disabled = !isRunning && !isPaused;\n      pauseBtn.textContent = isPaused ? '\u25B6\uFE0F Resume' : '\u23F8\uFE0F Pause';\n    }\n    \n    if (cancelBtn) {\n      cancelBtn.disabled = !isRunning && !isPaused;\n    }\n  }\n  \n  function updateSourceCards(state) {\n    // Update GeoNames card\n    const geonamesCard = document.querySelector('.source-geonames');\n    if (geonamesCard && state.sources.geonames) {\n      const badge = geonamesCard.querySelector('.status-badge');\n      if (badge) {\n        const status = state.sources.geonames.status;\n        badge.className = 'status-badge status-' + status;\n        badge.textContent = getStatusLabel(status);\n      }\n      \n      // Update stats\n      const statsGrid = geonamesCard.querySelector('.stats-grid');\n      if (statsGrid && state.stats) {\n        const statItems = statsGrid.querySelectorAll('.stat-item');\n        if (statItems[1]) {\n          statItems[1].querySelector('.stat-value').textContent = formatNumber(state.stats.processed);\n        }\n        if (statItems[2]) {\n          statItems[2].querySelector('.stat-value').textContent = formatNumber(state.stats.inserted);\n        }\n      }\n    }\n  }\n  \n  function appendLog(entry) {\n    if (!logBody) return;\n    \n    const row = document.createElement('div');\n    row.className = 'log-entry log-' + (entry.level || 'info');\n    \n    const timestamp = document.createElement('span');\n    timestamp.className = 'log-timestamp';\n    timestamp.textContent = entry.time;\n    row.appendChild(timestamp);\n    \n    const message = document.createElement('span');\n    message.className = 'log-message';\n    message.textContent = entry.message;\n    row.appendChild(message);\n    \n    logBody.appendChild(row);\n    logBody.scrollTop = logBody.scrollHeight;\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Button Handlers\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  function handleStart() {\n    // First do a preflight check\n    fetch('/api/geo-import/preflight')\n      .then(r => r.json())\n      .then(preflight => {\n        if (!preflight.ready) {\n          // Show download instructions\n          showMissingFileAlert(preflight);\n          return;\n        }\n        \n        // File exists, start the import\n        return fetch('/api/geo-import/start', { method: 'POST' })\n          .then(r => r.json())\n          .then(data => {\n            if (data.error) {\n              if (data.instructions) {\n                showMissingFileAlert(data);\n              } else {\n                addLogEntry({ time: new Date().toLocaleTimeString(), level: 'error', message: data.error });\n              }\n            } else {\n              console.log('[GeoImport] Start:', data);\n            }\n          });\n      })\n      .catch(err => {\n        console.error('[GeoImport] Start error:', err);\n        addLogEntry({ time: new Date().toLocaleTimeString(), level: 'error', message: 'Failed to start import: ' + err.message });\n      });\n  }\n  \n  function showMissingFileAlert(info) {\n    const instructions = info.instructions || [\n      '1. Download cities15000.zip from ' + info.downloadUrl,\n      '2. Extract cities15000.txt to data/geonames/',\n      '3. Click \"Start Import\" again'\n    ];\n    \n    // Add to log\n    addLogEntry({ time: new Date().toLocaleTimeString(), level: 'warning', message: '\u26A0\uFE0F GeoNames data file not found' });\n    instructions.forEach(step => {\n      addLogEntry({ time: new Date().toLocaleTimeString(), level: 'info', message: step });\n    });\n    \n    // Show alert with download link\n    const alertMsg = 'GeoNames data file not found!\\\\n\\\\n' + \n      instructions.join('\\\\n') + '\\\\n\\\\n' +\n      'Download URL: ' + info.downloadUrl;\n    \n    if (confirm(alertMsg + '\\\\n\\\\nOpen download page?')) {\n      window.open(info.downloadUrl, '_blank');\n    }\n  }\n  \n  function handlePause() {\n    const isPaused = currentState?.status === 'paused';\n    const endpoint = isPaused ? '/api/geo-import/resume' : '/api/geo-import/pause';\n    \n    fetch(endpoint, { method: 'POST' })\n      .then(r => r.json())\n      .then(data => console.log('[GeoImport] Pause/Resume:', data))\n      .catch(err => console.error('[GeoImport] Pause/Resume error:', err));\n  }\n  \n  function handleCancel() {\n    if (confirm('Cancel the import?')) {\n      fetch('/api/geo-import/cancel', { method: 'POST' })\n        .then(r => r.json())\n        .then(data => console.log('[GeoImport] Cancel:', data))\n        .catch(err => console.error('[GeoImport] Cancel error:', err));\n    }\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Utilities\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  function formatNumber(n) {\n    return typeof n === 'number' ? n.toLocaleString() : (n || '0');\n  }\n  \n  function getStatusLabel(status) {\n    const labels = {\n      'idle': '\u23F8\uFE0F Idle',\n      'ready': '\u2705 Ready',\n      'running': '\uD83D\uDD04 Running',\n      'validating': '\uD83D\uDD0D Validating',\n      'importing': '\uD83D\uDCBE Importing',\n      'complete': '\u2705 Complete',\n      'error': '\u274C Error',\n      'pending': '\u23F3 Pending'\n    };\n    return labels[status] || status;\n  }\n  \n  function showToast(message, type = 'info') {\n    const toast = document.createElement('div');\n    toast.className = 'toast ' + type;\n    toast.textContent = message;\n    toastContainer.appendChild(toast);\n    \n    // Auto-remove after 4 seconds\n    setTimeout(() => {\n      toast.style.opacity = '0';\n      toast.style.transform = 'translateX(100px)';\n      setTimeout(() => toast.remove(), 300);\n    }, 4000);\n  }\n  \n  function playCompletionSound() {\n    // Use Web Audio API for a simple completion chime\n    try {\n      const ctx = new (window.AudioContext || window.webkitAudioContext)();\n      const oscillator = ctx.createOscillator();\n      const gainNode = ctx.createGain();\n      \n      oscillator.connect(gainNode);\n      gainNode.connect(ctx.destination);\n      \n      oscillator.frequency.value = 523.25; // C5\n      oscillator.type = 'sine';\n      gainNode.gain.setValueAtTime(0.3, ctx.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\n      \n      oscillator.start(ctx.currentTime);\n      oscillator.stop(ctx.currentTime + 0.5);\n      \n      // Second note (E5) for a pleasant chime\n      setTimeout(() => {\n        const osc2 = ctx.createOscillator();\n        const gain2 = ctx.createGain();\n        osc2.connect(gain2);\n        gain2.connect(ctx.destination);\n        osc2.frequency.value = 659.25; // E5\n        osc2.type = 'sine';\n        gain2.gain.setValueAtTime(0.3, ctx.currentTime);\n        gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\n        osc2.start(ctx.currentTime);\n        osc2.stop(ctx.currentTime + 0.5);\n      }, 150);\n    } catch (e) {\n      // Audio not supported, fail silently\n      console.log('[GeoImport] Audio notification not available');\n    }\n  }\n  \n  function addLogEntry(entry) {\n    appendLog(entry);\n  }\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Initialize\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  // Bind buttons\n  if (startBtn) startBtn.addEventListener('click', handleStart);\n  if (pauseBtn) pauseBtn.addEventListener('click', handlePause);\n  if (cancelBtn) cancelBtn.addEventListener('click', handleCancel);\n  \n  // Connect SSE\n  connectSSE();\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Database Selector Handlers\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \n  const dbSelector = document.querySelector('[data-jsgui-control=\"database_selector\"]') \n    || document.querySelector('.database-selector')\n    || document.querySelector('.db-selector-window');\n  const dbContextMenu = dbSelector?.querySelector('[data-context-menu=\"database\"]');\n  let bodyControl = null;\n  let bodyContextMenuHandlersBound = false;\n  let activeContextTarget = null;\n  \n  function ensureBodyControl() {\n    if (bodyControl) return bodyControl;\n    try {\n      if (jsgui && typeof jsgui.Client_Page_Context === 'function') {\n        const ctx = new jsgui.Client_Page_Context({ document });\n        bodyControl = typeof ctx.body === 'function' ? ctx.body() : null;\n      }\n    } catch (err) {\n      console.warn('[GeoImport] Failed to init jsgui body control', err);\n    }\n    return bodyControl;\n  }\n  \n  function showDbContextMenu(x, y, targetPath) {\n    if (!dbContextMenu) return;\n    \n    activeContextTarget = targetPath;\n    dbContextMenu.style.display = 'block';\n    dbContextMenu.style.left = x + 'px';\n    dbContextMenu.style.top = y + 'px';\n    dbContextMenu.setAttribute('data-target-path', targetPath || '');\n    \n    requestAnimationFrame(() => adjustDbContextMenuPosition(x, y));\n  }\n  \n  function hideDbContextMenu() {\n    if (!dbContextMenu) return;\n    dbContextMenu.style.display = 'none';\n    dbContextMenu.removeAttribute('data-target-path');\n    activeContextTarget = null;\n  }\n  \n  function adjustDbContextMenuPosition(x, y) {\n    if (!dbContextMenu) return;\n    const rect = dbContextMenu.getBoundingClientRect();\n    let left = x;\n    let top = y;\n    \n    if (rect.right > window.innerWidth) {\n      left = x - rect.width;\n    }\n    if (rect.bottom > window.innerHeight) {\n      top = y - rect.height;\n    }\n    \n    dbContextMenu.style.left = Math.max(8, left) + 'px';\n    dbContextMenu.style.top = Math.max(8, top) + 'px';\n  }\n  \n  function handleDbContextAction(action, targetPath) {\n    if (action === 'open-in-explorer') {\n      fetch('/api/geo-import/open-in-explorer', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ path: targetPath })\n      }).catch(err => {\n        console.error('Failed to open in explorer:', err);\n      });\n    }\n    \n    dbSelector?.dispatchEvent(new CustomEvent('db-context-action', {\n      bubbles: true,\n      detail: { action, targetPath }\n    }));\n  }\n  \n  function bindContextMenuHandlers() {\n    if (!dbSelector || !dbContextMenu) return;\n    \n    if (!bodyContextMenuHandlersBound) {\n      const body = ensureBodyControl();\n      const outsideHandler = (e) => {\n        if (dbContextMenu.style.display === 'block' && !dbContextMenu.contains(e.target)) {\n          hideDbContextMenu();\n        }\n      };\n      const escapeHandler = (e) => {\n        if (e.key === 'Escape') {\n          hideDbContextMenu();\n        }\n      };\n      \n      if (body && typeof body.on === 'function') {\n        body.on('click', outsideHandler);\n        body.on('keydown', escapeHandler);\n      } else {\n        document.addEventListener('click', outsideHandler);\n        document.addEventListener('keydown', escapeHandler);\n      }\n      bodyContextMenuHandlersBound = true;\n    }\n    \n    dbSelector.addEventListener('contextmenu', (e) => {\n      const item = e.target.closest('.db-item');\n      if (!item) return;\n      const dbPath = item.getAttribute('data-db-path');\n      if (!dbPath || dbPath === '__new__') return;\n      \n      e.preventDefault();\n      showDbContextMenu(e.clientX, e.clientY, dbPath);\n    });\n    \n    dbContextMenu.addEventListener('click', (e) => {\n      const item = e.target.closest('.db-context-menu-item');\n      if (!item) return;\n      const action = item.getAttribute('data-action');\n      const targetPath = activeContextTarget || dbContextMenu.getAttribute('data-target-path');\n      if (action && targetPath) {\n        handleDbContextAction(action, targetPath);\n      }\n      hideDbContextMenu();\n    });\n  }\n  \n  function initDatabaseSelector() {\n    if (!dbSelector) return;\n    \n    // Handle database item clicks\n    dbSelector.addEventListener('click', function(e) {\n      const item = e.target.closest('.db-item');\n      if (item) {\n        const dbPath = item.getAttribute('data-db-path');\n        if (dbPath === '__new__') {\n          toggleNewDbInput(true);\n        } else {\n          selectDatabase(dbPath);\n        }\n        return;\n      }\n      \n      // Handle action buttons\n      const action = e.target.getAttribute('data-action');\n      if (action === 'select-default') {\n        selectDefaultDatabase();\n      } else if (action === 'refresh-list') {\n        refreshDatabaseList();\n      } else if (action === 'create-new-db') {\n        createNewDatabase();\n      }\n    });\n    \n    // Handle Enter key in new db input\n    const newDbInput = dbSelector.querySelector('[data-input=\"new-db-name\"]');\n    if (newDbInput) {\n      newDbInput.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter') {\n          createNewDatabase();\n        }\n      });\n    }\n    \n    bindContextMenuHandlers();\n  }\n  \n  function selectDatabase(dbPath) {\n    showToast('Switching to ' + dbPath.split('/').pop() + '...', 'info');\n    \n    fetch('/api/databases/switch', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ path: dbPath })\n    })\n    .then(r => r.json())\n    .then(data => {\n      if (data.error) {\n        showToast('Error: ' + data.error, 'error');\n        return;\n      }\n      \n      showToast('Switched to ' + data.path.split(/[\\\\\\\\\\\\/]/).pop(), 'success');\n      \n      // Update UI\n      updateSelectedDatabase(dbPath, data.stats);\n      \n      // Reload page to get fresh state\n      setTimeout(() => location.reload(), 500);\n    })\n    .catch(err => {\n      showToast('Failed to switch: ' + err.message, 'error');\n    });\n  }\n  \n  function selectDefaultDatabase() {\n    // Find default in the list\n    const defaultItem = dbSelector.querySelector('.db-item.default');\n    if (defaultItem) {\n      const dbPath = defaultItem.getAttribute('data-db-path');\n      selectDatabase(dbPath);\n    }\n  }\n  \n  function refreshDatabaseList() {\n    showToast('Refreshing database list...', 'info');\n    \n    fetch('/api/databases')\n      .then(r => r.json())\n      .then(data => {\n        updateDatabaseList(data.databases, data.current);\n        showToast('Found ' + data.databases.length + ' databases', 'success');\n      })\n      .catch(err => {\n        showToast('Failed to refresh: ' + err.message, 'error');\n      });\n  }\n  \n  function createNewDatabase() {\n    const input = dbSelector.querySelector('[data-input=\"new-db-name\"]');\n    if (!input) return;\n    \n    const name = input.value.trim();\n    if (!name) {\n      showToast('Please enter a database name', 'warning');\n      input.focus();\n      return;\n    }\n    \n    showToast('Creating ' + name + '...', 'info');\n    \n    fetch('/api/databases/create', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name: name })\n    })\n    .then(r => r.json())\n    .then(data => {\n      if (data.error) {\n        showToast('Error: ' + data.error, 'error');\n        return;\n      }\n      \n      showToast('Created ' + data.name, 'success');\n      input.value = '';\n      toggleNewDbInput(false);\n      \n      // Refresh and select new database\n      refreshDatabaseList();\n      setTimeout(() => selectDatabase(data.path), 500);\n    })\n    .catch(err => {\n      showToast('Failed to create: ' + err.message, 'error');\n    });\n  }\n  \n  function toggleNewDbInput(visible) {\n    const inputGroup = dbSelector.querySelector('.db-new-input-group');\n    const newItem = dbSelector.querySelector('.db-item.new-db');\n    \n    if (inputGroup) {\n      inputGroup.setAttribute('data-visible', visible ? 'true' : 'false');\n    }\n    if (newItem) {\n      newItem.classList.toggle('selected', visible);\n    }\n    \n    if (visible) {\n      const input = inputGroup?.querySelector('input');\n      if (input) input.focus();\n    }\n  }\n  \n  function updateSelectedDatabase(dbPath, stats) {\n    // Update selected state in list\n    dbSelector.querySelectorAll('.db-item').forEach(item => {\n      const isSelected = item.getAttribute('data-db-path') === dbPath;\n      item.classList.toggle('selected', isSelected);\n      const check = item.querySelector('.db-check');\n      if (check) check.textContent = isSelected ? '\u2713' : '';\n    });\n    \n    // Update info panel\n    const infoPanel = dbSelector.querySelector('[data-panel=\"selected-info\"]');\n    if (infoPanel && stats) {\n      infoPanel.innerHTML = \n        '<div class=\"info-title\">\uD83D\uDCCA ' + dbPath.split(/[\\\\\\\\\\\\/]/).pop() + '</div>' +\n        '<div class=\"info-stats-grid\">' +\n          '<div class=\"info-stat\"><span class=\"stat-emoji\">\uD83D\uDCCD</span><span class=\"stat-value\">' + formatNumber(stats.places) + '</span><span class=\"stat-label\">Places</span></div>' +\n          '<div class=\"info-stat\"><span class=\"stat-emoji\">\uD83C\uDFF7\uFE0F</span><span class=\"stat-value\">' + formatNumber(stats.names) + '</span><span class=\"stat-label\">Names</span></div>' +\n          '<div class=\"info-stat\"><span class=\"stat-emoji\">\uD83D\uDCBE</span><span class=\"stat-value\">' + formatFileSize(stats.size) + '</span><span class=\"stat-label\">Size</span></div>' +\n        '</div>' +\n        '<div class=\"info-path\"><span class=\"path-label\">Path: </span><code class=\"path-value\">' + dbPath + '</code></div>';\n    }\n    \n    // Update coverage section totals\n    const coverageBefore = document.querySelector('.coverage-before');\n    if (coverageBefore && stats) {\n      const placesBefore = coverageBefore.querySelector('.coverage-item:first-child .coverage-value');\n      const namesBefore = coverageBefore.querySelector('.coverage-item:nth-child(2) .coverage-value');\n      if (placesBefore) placesBefore.textContent = formatNumber(stats.places);\n      if (namesBefore) namesBefore.textContent = formatNumber(stats.names);\n    }\n  }\n  \n  function updateDatabaseList(databases, currentPath) {\n    const list = dbSelector.querySelector('[data-list=\"databases\"]');\n    if (!list) return;\n    \n    // Clear existing items (except empty state)\n    list.querySelectorAll('.db-item').forEach(item => item.remove());\n    \n    // Add new items\n    databases.forEach(db => {\n      const item = document.createElement('div');\n      item.className = 'db-item' + (db.path === currentPath ? ' selected' : '') + (db.isDefault ? ' default' : '');\n      item.setAttribute('data-db-path', db.path);\n      \n      item.innerHTML = \n        '<span class=\"db-icon\">\uD83D\uDDC4\uFE0F</span>' +\n        '<div class=\"db-info\">' +\n          '<div class=\"db-name-row\">' +\n            '<span class=\"db-name\">' + db.name + '</span>' +\n            (db.isDefault ? '<span class=\"db-badge default-badge\">\u2B50 Default</span>' : '') +\n          '</div>' +\n          '<div class=\"db-stats-row\">' +\n            '<span class=\"db-stat\">\uD83D\uDCCD ' + formatNumber(db.places) + ' places</span>' +\n            '<span class=\"db-stat\">\uD83C\uDFF7\uFE0F ' + formatNumber(db.names) + ' names</span>' +\n            '<span class=\"db-stat\">\uD83D\uDCBE ' + formatFileSize(db.size) + '</span>' +\n          '</div>' +\n        '</div>' +\n        '<span class=\"db-check\">' + (db.path === currentPath ? '\u2713' : '') + '</span>';\n      \n      list.appendChild(item);\n    });\n  }\n  \n  function formatFileSize(bytes) {\n    if (!bytes) return '0 B';\n    const units = ['B', 'KB', 'MB', 'GB'];\n    let i = 0;\n    while (bytes >= 1024 && i < units.length - 1) {\n      bytes /= 1024;\n      i++;\n    }\n    return bytes.toFixed(i > 0 ? 1 : 0) + ' ' + units[i];\n  }\n  \n  // Initialize database selector\n  initDatabaseSelector();\n  \n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Navigation Handling\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // NOTE: Navigation clicks are now handled by jsgui3 controls (NavItem)\n  // via the 'nav-select' CustomEvent system in GeoImportDashboard.activate()\n  // \n  // This keeps initialization minimal - just ensures visual state is correct\n  // The actual click handling and URL navigation is done by the control framework\n  \n  function initNavigation() {\n    const currentView = new URLSearchParams(window.location.search).get('view') || 'database';\n    \n    // Set initial visual state for nav items (defensive - server should set this)\n    const navItems = document.querySelectorAll('.nav-item');\n    navItems.forEach(item => {\n      const navId = item.getAttribute('data-nav-id');\n      if (navId === currentView) {\n        item.classList.add('nav-item--selected');\n      }\n    });\n  }\n  \n  initNavigation();\n  \n  console.log('[GeoImport] Dashboard initialized');\n})();\n"],
  "mappings": "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,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACX;AAAA,QACA;AAAA,UACI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",
  "names": ["stream", "context", "res", "c", "l", "obj", "t1", "tf", "value", "item", "get_a_sig", "arr", "vals", "key", "a", "callback", "that", "prop_name", "process", "delay", "res2", "v_subtract", "offset", "target", "item_params", "options", "p", "test_evented_class", "test_data", "value", "name", "res", "target", "res", "item", "that", "value", "res", "c", "l", "item", "key", "value", "callback", "res", "prefix", "jsgui", "Data_Value", "res", "obj", "that", "res", "jsgui", "Data_Value", "get_a_sig", "obj", "res", "value", "callback", "item", "that", "input_processors", "jsgui", "key", "callback", "value", "Data_Value", "get_a_sig", "value", "Data_Object", "res", "callback", "item", "key", "obj", "c", "l", "require_Data_Object", "local_js_value", "value", "jsgui", "context", "jsgui", "context", "jsgui", "context", "value", "l", "res", "c", "local_js_value", "item", "jsgui", "local_js_value", "value", "l", "my_e", "c", "num_properties", "data_type", "require_Data_Value", "jsgui", "Data_Value", "that", "context", "value", "res", "item", "require_Data_Value", "callback", "key", "value", "callback", "res", "c", "l", "value", "res", "require_Collection", "jsgui", "res", "c", "l", "v_subtract", "offset", "that", "value", "res2", "item", "i", "a", "i2", "Data_Value", "c", "l", "value", "item", "fn_res", "value", "tf", "item", "l", "c", "arg", "res", "get_a_sig", "tf", "error", "l", "opts", "fn_inner", "res", "log", "ms_complete", "c", "process", "callback", "prom", "obj", "item", "input_ofns", "ofns", "num_stages", "l2", "arr_stages", "t1", "i_stage", "sig", "value", "content_length", "require_lang_mini", "stream", "context", "res", "c", "l", "obj", "t1", "tf", "value", "item", "get_a_sig", "arr", "vals", "key", "a", "callback", "that", "prop_name", "process", "delay", "res2", "v_subtract", "offset", "target", "item_params", "options", "p", "test_evented_class", "test_data", "require_lib_lang_mini", "value", "name", "res", "get_a_sig", "tf", "item", "ia", "obj", "states", "prop_name", "def", "item_params", "options", "value", "l", "c", "jsgui", "get_a_sig", "value", "res", "key", "height", "item", "context", "c", "l", "ctrl", "callback", "dom", "parent", "selector", "test_svg", "Control", "error", "require_lang_mini", "stream", "context", "res", "c", "l", "obj", "t1", "tf", "value", "item", "get_a_sig", "arr", "vals", "key", "a", "callback", "that", "prop_name", "process", "delay", "res2", "v_subtract", "offset", "target", "item_params", "options", "p", "test_evented_class", "test_data", "require_lib_lang_mini", "value", "name", "res", "value", "res", "res", "l", "c", "i", "callback", "item", "ta", "value", "ta_source", "bounds", "ta", "height", "bypp", "bypr", "byi_from_cs_pos", "height", "bypp", "bypr", "ta_source", "height", "bypp", "bypr", "res", "callback", "callback", "height", "bypp", "bypr", "ta_source", "byi_read_below", "byi_read_right", "byi_read_below_right", "fpx_area_recip", "opt_ta_dest", "c", "right_shift_32bit_with_carry", "xor_typed_arrays", "res", "ta_source", "height", "ta", "each_1_index", "value", "count_1s", "get_ta_bits_that_differ_from_previous_as_1s", "obj", "ta", "x", "y", "res", "right_shift_32bit_with_carry", "xor_typed_arrays", "each_1_index", "count_1s", "get_ta_bits_that_differ_from_previous_as_1s", "ta_math", "get_a_sig", "tf", "ta_math", "ta", "value", "pos_bounds", "bounds", "l", "c", "callback", "bypp", "res", "get_a_sig", "tf", "ta_math", "l", "get_a_sig", "tf", "ta_math", "ta", "l", "height", "w", "value", "right_shift_32bit_with_carry", "xor_typed_arrays", "each_1_index", "count_1s", "get_ta_bits_that_differ_from_previous_as_1s", "obj", "l", "offset", "c", "res", "c_touching_image_border", "value", "height", "get_ta_bits_that_differ_from_previous_as_1s", "right_shift_32bit_with_carry", "xor_typed_arrays", "each_1_index", "count_1s", "c", "height", "pb_source", "test_can_do_bit_realigned_64_bit", "bypp", "ta", "l", "res", "get_a_sig", "tf", "ta_math", "Pixel_Buffer_Core_Reference_Implementations", "ta", "callback", "bypp", "res", "color", "bounds", "c", "l", "get_a_sig", "tf", "ta_math", "Pixel_Buffer_Core_Reference_Implementations", "bounds", "l", "c", "res", "callback", "ta", "bypp", "color", "height", "get_a_sig", "tf", "l", "c", "callback", "res", "height", "ta", "pb_source", "offset", "polygon_size", "res", "bypp", "l", "c", "size", "y", "x", "width", "callback", "px", "xspan", "idx", "get_ta_bits_that_differ_from_previous_as_1s", "each_1_index", "pb_source", "value", "ta_source", "ta", "res", "cb", "t1", "bounds", "c", "bypp", "l", "prev_y", "y", "height", "Data_Value", "value", "Data_Value", "Data_Value", "context", "Data_Value", "Data_Value", "context", "context", "Data_Value", "Data_Value", "value", "Data_Value", "value", "ctrl", "context", "Data_Value", "ctrl", "context", "value", "jsgui", "get_a_sig", "v_subtract", "ctrl", "callback", "c", "l", "item", "Control", "context", "t1", "value", "el", "key", "Data_Value", "value", "key", "callback", "c", "value", "obj", "context", "callback", "Control", "jsgui", "Control", "ctrl", "jsgui", "get_a_sig", "res", "ctrl", "name", "Constructor", "c", "l", "error", "callback", "value", "item", "key", "context", "callback", "error", "dom", "res", "tag", "item", "ctrl", "value", "l", "jsgui", "get_a_sig", "Control", "item", "callback", "c", "l", "recursive_dom_iterate_depth", "context", "res", "ctrl", "value", "key", "value", "obj", "location", "key", "value", "res", "c", "context", "jsgui", "res", "callback", "context", "jsgui", "get_a_sig", "item", "key", "obj", "res", "callback", "jsgui", "get_a_sig", "callback", "jsgui", "get_a_sig", "callback", "value", "jsgui", "get_a_sig", "callback", "value", "jsgui", "jsgui", "Control", "jsgui", "Control", "value", "ctrl", "bounds", "initial_bounds_bcr", "initial_bcr_offset_from_bounds", "pos_mm", "value", "start_action", "jsgui", "Control", "v_subtract", "context", "prop", "value", "jsgui", "Control", "v_subtract", "ctrl", "value", "old_selectable", "ss", "jsgui", "Control", "jsgui", "Control", "that", "jsgui", "Control", "obj", "key", "jsgui", "Control", "value", "jsgui", "Control", "v_subtract", "value", "c", "item", "pal_crayola", "jsgui", "v_subtract", "Control", "pal_crayola", "obj", "jsgui", "Control", "context", "jsgui", "Control", "jsgui", "Control", "ctrl", "ctrl", "value", "value", "ctrl", "ctrl", "ctrl", "jsgui", "Control", "context", "ctrl", "ctrl", "pos_mm", "value", "start_action", "Control", "ctrl", "bounds", "offset", "ctrl", "ctrl", "value", "ctrl", "value", "jsgui", "Control", "l", "ctrl", "selection_box", "ctrl", "ctrl", "ctrl", "value", "jsgui", "Control", "value", "context", "jsgui", "Control", "Data_Value", "context", "value", "jsgui", "Control", "jsgui", "Control", "context", "value", "context", "value", "jsgui", "Control", "Data_Value", "context", "value", "jsgui", "Control", "Control", "context", "value", "jsgui", "Control", "obj", "key", "jsgui", "Control", "context", "jsgui", "Control", "context", "item", "jsgui", "Control", "context", "value", "jsgui", "Control", "context", "jsgui", "Control", "l", "jsgui", "Control", "jsgui", "Control", "jsgui", "Control", "jsgui", "Control", "jsgui", "Control", "item", "c", "jsgui", "Control", "jsgui", "context", "jsgui", "jsgui", "Control", "context", "key", "value", "jsgui", "Control", "tf", "jsgui", "Control", "that", "item", "jsgui", "Control", "ctrl", "jsgui", "Control", "context", "jsgui", "Control", "res", "height", "that", "context", "obj", "jsgui", "Control", "jsgui", "Control", "jsgui", "Control", "context", "callback", "ctrl", "jsgui", "ctrl", "jsgui", "Control", "context", "jsgui", "Control", "context", "that", "ctrl", "jsgui", "Control", "value", "context", "ctrl", "jsgui", "Control", "context", "Control", "context", "item", "value", "callback", "jsgui", "Data_Value", "context", "item", "Control", "context", "item", "value", "jsgui", "Control", "that", "context", "jsgui", "Control", "that", "jsgui", "Control", "value", "jsgui", "Control", "context", "value", "jsgui", "Control", "value", "jsgui", "jsgui", "Control", "value", "jsgui", "Control", "ctrl", "context", "offset", "res", "e", "value", "jsgui", "Control", "context", "jsgui", "Control", "Control", "context", "jsgui", "Control", "jsgui", "Control", "context", "res", "ctrl", "jsgui", "jsgui", "callback", "require_page_context", "jsgui", "Control", "ctrl", "location", "res", "ta", "ta_current_frame_for_user", "l", "c", "X", "Y", "H", "W", "R", "B", "TX", "TY", "i", "next_iid", "require_resource", "jsgui", "get_a_sig", "callback", "res", "jsgui", "tf", "context", "callback", "value", "page_context", "jsgui", "registerControlType", "key", "createTwoColumnLayoutControls", "jsgui", "Control", "item", "ctrl", "jsgui", "Control", "value", "key", "c", "context", "ctrl", "item", "jsgui", "Control", "createTwoColumnLayoutControls", "SourceCard", "key", "value", "ProgressRing", "offset", "StagesStepper", "LiveLog", "GeoImportDashboard", "item", "context", "key", "c", "offset", "item"]
}
