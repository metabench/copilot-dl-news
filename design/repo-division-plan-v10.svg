<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2400 1600">
  <title>Repository Division v10 - High Density WLILO Architecture</title>
  <defs>
    <!-- WLILO PALETTE -->
    <!-- Leather Background -->
    <linearGradient id="leatherBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#faf9f7"/><stop offset="100%" stop-color="#ebe8e2"/>
    </linearGradient>
    
    <!-- Obsidian Panel Gradient -->
    <linearGradient id="obsidianGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#2d2d2d"/><stop offset="100%" stop-color="#1a1a1a"/>
    </linearGradient>
    
    <!-- Gold Gradient -->
    <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#c9a962"/><stop offset="50%" stop-color="#e8d5a3"/><stop offset="100%" stop-color="#c9a962"/>
    </linearGradient>

    <!-- Filters & Textures -->
    <filter id="softShadow">
      <feDropShadow dx="0" dy="8" stdDeviation="6" flood-color="#000" flood-opacity="0.25"/>
    </filter>
    
    <pattern id="leatherTexture" width="100" height="100" patternUnits="userSpaceOnUse">
       <rect width="100" height="100" fill="url(#leatherBg)"/>
       <path d="M10 10h1v1h-1zM60 40h1v1h-1zM30 80h1v1h-1z" fill="#000" opacity="0.03"/>
    </pattern>

    <marker id="goldArrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L0,8 L8,4z" fill="#c9a962"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="2400" height="1600" fill="url(#leatherTexture)"/>

  <!-- GRID / STAGE MARKERS -->
  <g opacity="0.4">
      <line x1="800" y1="100" x2="800" y2="1500" stroke="#c9a962" stroke-dasharray="4,4"/>
      <line x1="1600" y1="100" x2="1600" y2="1500" stroke="#c9a962" stroke-dasharray="4,4"/>
  </g>
  
  <text x="400" y="60" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="24" fill="#2d2d2d" letter-spacing="4" font-weight="300">STAGE 1: INGESTION</text>
  <text x="1200" y="60" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="24" fill="#2d2d2d" letter-spacing="4" font-weight="300">STAGE 2: ANALYSIS</text>
  <text x="2000" y="60" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="24" fill="#2d2d2d" letter-spacing="4" font-weight="300">STAGE 3: INTELLIGENCE</text>

  <!-- =============================================
       STAGE 1: INGESTION
       ============================================= -->

  <!-- NEWS-CRAWLER-CORE -->
  <g transform="translate(60, 120)" filter="url(#softShadow)">
    <rect width="680" height="400" rx="8" fill="url(#obsidianGrad)" stroke="#c9a962" stroke-width="2"/>
    <rect width="680" height="40" rx="8" fill="#000" opacity="0.4"/> <!-- Header Darken -->
    
    <text x="20" y="28" fill="#e8d5a3" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="18">news-crawler-core</text>
    <text x="660" y="28" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">npm: @news/core</text>

    <!-- Internals -->
    <g transform="translate(25, 70)">
        <text x="0" y="0" fill="#e8d5a3" font-weight="bold" font-family="Segoe UI" font-size="14">ORCHESTRATION ENGINE</text>
        <line x1="0" y1="8" x2="300" y2="8" stroke="#c9a962" stroke-width="1"/>
        
        <g transform="translate(0, 30)" font-family="Consolas" font-size="11" fill="#ccc">
            <text y="0">class Crawler {</text>
            <text y="15" x="15">queue: PriorityQueue&lt;CrawlTarget&gt;</text>
            <text y="30" x="15">workers: WorkerPool(Puppeteer | Cheerio)</text>
            <text y="45" x="15">rateLimiter: HostThrottler</text>
            <text y="60" x="15">robots: RobotsTxtCompliance</text>
            <text y="75">}</text>
        </g>
        
        <g transform="translate(350, 30)" font-family="Consolas" font-size="11" fill="#ccc">
            <text y="0" fill="#e8d5a3">EVENTS (EventEmitter)</text>
            <text y="20">emit('job:started', { url })</text>
            <text y="35">emit('job:complete', { art_id })</text>
            <text y="50">emit('resource:exhausted')</text>
            
            <text y="80" fill="#4ade80">INPUTS</text>
            <text y="100">CrawlPlan (from Intelligence)</text>
            <text y="115">ManualOverride (from API)</text>
        </g>
    </g>

    <!-- Maroon API Attached -->
    <g transform="translate(560, 240)">
        <rect width="120" height="140" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
        <text x="60" y="20" fill="#fff" text-anchor="middle" font-family="Segoe UI" font-size="10" font-weight="bold">CORE API</text>
        <line x1="10" y1="30" x2="110" y2="30" stroke="#900c3f"/>
        <g transform="translate(10, 50)" font-family="Consolas" font-size="9" fill="#fbcfe8">
            <text y="0">POST /control/start</text>
            <text y="15">POST /control/pause</text>
            <text y="30">GET /status/workers</text>
            <text y="45">WS /live-feed</text>
        </g>
    </g>
  </g>

  <!-- NEWS-CRAWLER-DB -->
  <g transform="translate(60, 580)" filter="url(#softShadow)">
    <rect width="680" height="420" rx="8" fill="url(#obsidianGrad)" stroke="#22c55e" stroke-width="2"/>
    <rect width="680" height="40" rx="8" fill="#000" opacity="0.4"/>
    
    <text x="20" y="28" fill="#4ade80" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="18">news-crawler-db</text>
    <text x="660" y="28" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">sqlite3: news.db</text>
    
    <g transform="translate(25, 70)">
        <text x="0" y="0" fill="#4ade80" font-weight="bold" font-family="Segoe UI" font-size="14">OPERATIONAL PERSISTENCE</text>
        <line x1="0" y1="8" x2="300" y2="8" stroke="#22c55e" stroke-width="1"/>
        
        <g transform="translate(0, 30)" font-family="Consolas" font-size="11" fill="#ccc">
            <text y="0" font-weight="bold" fill="#fff">TABLES (8GB+)</text>
            <text y="20">articles (id, url_id, title, text_blob)</text>
            <text y="35">urls (id, domain, path, hash, next_fetch)</text>
            <text y="50">fetches (id, url_id, status, duration)</text>
            <text y="65">links (src, dst, anchor_text)</text>
        </g>

        <g transform="translate(350, 0)">
            <text x="0" y="0" fill="#4ade80" font-weight="bold" font-family="Segoe UI" font-size="14">DATA ADAPTERS</text>
            <line x1="0" y1="8" x2="200" y2="8" stroke="#22c55e" stroke-width="1"/>
             <g transform="translate(0, 30)" font-family="Consolas" font-size="11" fill="#ccc">
                <text y="0">ArticleAdapter.upsert()</text>
                <text y="15">UrlAdapter.popNextConfigured()</text>
                <text y="30">LinkGraph.insertBatch()</text>
            </g>
        </g>
    </g>

    <!-- Maroon API Attached -->
    <g transform="translate(560, 260)">
        <rect width="120" height="140" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
        <text x="60" y="20" fill="#fff" text-anchor="middle" font-family="Segoe UI" font-size="10" font-weight="bold">DATA API</text>
        <line x1="10" y1="30" x2="110" y2="30" stroke="#900c3f"/>
        <g transform="translate(10, 50)" font-family="Consolas" font-size="9" fill="#fbcfe8">
            <text y="0">GET /articles/:id</text>
            <text y="15">GET /query/sql</text>
            <text y="30">GET /stats/counts</text>
        </g>
    </g>
  </g>

  <!-- NEWS-GAZETTEER (SEPARATED) -->
  <g transform="translate(60, 1060)" filter="url(#softShadow)">
    <rect width="680" height="380" rx="8" fill="url(#obsidianGrad)" stroke="#f59e0b" stroke-width="2"/>
    <rect width="680" height="40" rx="8" fill="#000" opacity="0.4"/>
    
    <text x="20" y="28" fill="#fbbf24" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="18">news-gazetteer</text>
    <text x="660" y="28" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">sqlite3: gazetteer.db</text>
    
    <g transform="translate(25, 70)">
        <text x="0" y="0" fill="#fbbf24" font-weight="bold" font-family="Segoe UI" font-size="14">REFERENCE GEOSPATIAL DATA</text>
        <line x1="0" y1="8" x2="300" y2="8" stroke="#f59e0b" stroke-width="1"/>
        
        <text x="0" y="30" font-family="Consolas" font-size="11" fill="#aaa">
            Separated from news.db for portability &amp; reuse.
        </text>

        <g transform="translate(0, 60)" font-family="Consolas" font-size="11" fill="#ccc">
            <text y="0" font-weight="bold" fill="#fff">SCHEMA</text>
            <text y="20">places (geoname_id, name, lat, lon)</text>
            <text y="35">hierarchy (parent, child, type)</text>
            <text y="50">alternates (id, lang, name)</text>
        </g>

        <g transform="translate(350, 60)" font-family="Consolas" font-size="11" fill="#ccc">
            <text y="0" font-weight="bold" fill="#fff">LOGIC</text>
            <text y="20">GeoResolver.find(str)</text>
            <text y="35">SpatialIndex.query(box)</text>
        </g>
    </g>
    
    <!-- Maroon API Attached -->
    <g transform="translate(560, 220)">
        <rect width="120" height="140" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
        <text x="60" y="20" fill="#fff" text-anchor="middle" font-family="Segoe UI" font-size="10" font-weight="bold">GEO API</text>
        <line x1="10" y1="30" x2="110" y2="30" stroke="#900c3f"/>
        <g transform="translate(10, 50)" font-family="Consolas" font-size="9" fill="#fbcfe8">
            <text y="0">GET /place/:id</text>
            <text y="15">POST /geo/tag</text>
            <text y="30">GET /geo/neighbors</text>
        </g>
    </g>
  </g>

  <!-- =============================================
       STAGE 2: ANALYSIS
       ============================================= -->

  <!-- NEWS-DB-ANALYSIS (Mid-Layer Bridge) -->
  <g transform="translate(860, 120)" filter="url(#softShadow)">
    <rect width="600" height="960" rx="8" fill="url(#obsidianGrad)" stroke="#ef4444" stroke-width="2"/>
    <rect width="600" height="40" rx="8" fill="#000" opacity="0.4"/>
    
    <text x="20" y="28" fill="#fca5a5" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="18">news-db-analysis</text>
    <text x="580" y="28" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">SERVICE LAYER</text>

    <!-- CONTENT -->
    <g transform="translate(30, 80)">
         <!-- Box 1 -->
         <g>
            <rect width="540" height="140" fill="#222" stroke="#444" rx="4"/>
            <text x="20" y="30" fill="#fca5a5" font-family="Segoe UI" font-weight="bold">ANALYSIS ORCHESTRATOR</text>
            <text x="20" y="60" fill="#ccc" font-family="Consolas" font-size="11">- Polls news-crawler-db for unanalyzed articles</text>
            <text x="20" y="75" fill="#ccc" font-family="Consolas" font-size="11">- Batches jobs for processing</text>
            <text x="20" y="90" fill="#ccc" font-family="Consolas" font-size="11">- Writes results back to `article_analysis`</text>
         </g>

         <!-- Box 2 -->
         <g transform="translate(0, 180)">
            <rect width="540" height="180" fill="#222" stroke="#444" rx="4"/>
            <text x="20" y="30" fill="#fca5a5" font-family="Segoe UI" font-weight="bold">TOPIC &amp; TREND DETECTION</text>
            <text x="20" y="60" fill="#ccc" font-family="Consolas" font-size="11">Detects surging keywords across time windows.</text>
            
            <g transform="translate(20, 80)" font-family="Consolas" font-size="11" fill="#888">
              <text y="0">class TrendService {</text>
              <text y="15" x="15">detect(window: 4h): Trend[]</text>
              <text y="30" x="15">correlate(trend_id, place_id)</text>
              <text y="45">}</text>
            </g>
         </g>

         <!-- Pure Lib Inclusion Inner Box -->
         <g transform="translate(20, 600)">
            <rect width="500" height="200" fill="#111" stroke="#a855f7" stroke-dasharray="5,5" rx="8"/>
            <text x="250" y="30" text-anchor="middle" fill="#d8b4fe" font-family="Segoe UI" font-size="12" font-weight="bold">USES: news-db-pure-analysis</text>
            
            <g transform="translate(30, 60)" font-family="Consolas" font-size="11" fill="#d8b4fe">
                <text y="0">import { TextRank } from '@news/pure'</text>
                <text y="20">import { SimHash } from '@news/pure'</text>
                <text y="40">import { Sentiment } from '@news/pure'</text>
                
                <text y="80" fill="#888">// Stateless algorithms applied here</text>
            </g>
         </g>
    </g>
    
    <!-- Maroon API Attached -->
    <g transform="translate(460, 400)">
        <rect width="120" height="140" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
        <text x="60" y="20" fill="#fff" text-anchor="middle" font-family="Segoe UI" font-size="10" font-weight="bold">ANALYSIS API</text>
        <line x1="10" y1="30" x2="110" y2="30" stroke="#900c3f"/>
        <g transform="translate(10, 50)" font-family="Consolas" font-size="9" fill="#fbcfe8">
            <text y="0">GET /trends/now</text>
            <text y="15">POST /batch/run</text>
            <text y="30">GET /report/daily</text>
        </g>
    </g>
  </g>
  
  <!-- NEWS-DB-PURE-ANALYSIS (Library below) -->
  <g transform="translate(860, 1120)" filter="url(#softShadow)">
    <rect width="600" height="320" rx="8" fill="#2d2d2d" stroke="#a855f7" stroke-width="2"/>
     <text x="20" y="30" fill="#d8b4fe" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="16">news-db-pure-analysis</text>
     <text x="580" y="30" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">PURE LIBRARY</text>
     
     <g transform="translate(30, 60)">
        <g font-family="Consolas" font-size="11" fill="#e9d5ff">
            <text y="0">src/clustering/ (SimHash, K-Means)</text>
            <text y="20">src/summarization/ (TextRank, Centroid)</text>
            <text y="40">src/classification/ (DecisionTrees, NaiveBayes)</text>
            <text y="60">src/sentiment/ (Lexicon, VADER-port)</text>
        </g>
        <line x1="0" y1="80" x2="540" y2="80" stroke="#a855f7" stroke-width="1" stroke-dasharray="2,2"/>
        <text x="0" y="100" fill="#aaa" font-family="Segoe UI" font-size="12" font-style="italic">
            Zero dependencies. No DB access. Just Math &amp; Logic.
        </text>
     </g>
  </g>

  <!-- =============================================
       STAGE 3: INTELLIGENCE
       ============================================= -->

  <!-- NEWS-INTELLIGENCE -->
  <g transform="translate(1600, 120)" filter="url(#softShadow)">
    <rect width="700" height="700" rx="8" fill="url(#obsidianGrad)" stroke="#6366f1" stroke-width="2"/>
    <rect width="700" height="40" rx="8" fill="#000" opacity="0.4"/>
    
    <text x="20" y="28" fill="#a5b4fc" font-family="Segoe UI, sans-serif" font-weight="bold" font-size="18">news-intelligence</text>
    <text x="680" y="28" fill="#888" font-family="Consolas, monospace" font-size="12" text-anchor="end">STRATEGY &amp; INSIGHT</text>

    <g transform="translate(30, 80)">
        <!-- KNOWLEDGE GRAPH -->
        <g>
            <text x="0" y="0" fill="#a5b4fc" font-weight="bold" font-family="Segoe UI">KNOWLEDGE GRAPH BUILDER</text>
            <rect y="15" width="640" height="80" fill="#6366f1" opacity="0.1" rx="4"/>
            <text x="10" y="40" fill="#ddd" font-family="Consolas" font-size="11">Constructs entity relationships from analyzed articles.</text>
            <text x="10" y="55" fill="#ddd" font-family="Consolas" font-size="11">GraphDB Node: { Person, Org, Location, Event }</text>
            <text x="10" y="70" fill="#ddd" font-family="Consolas" font-size="11">Eg: "Elon Musk" --[bought]--> "Twitter"</text>
        </g>

        <!-- STRATEGIC PLANNING -->
        <g transform="translate(0, 140)">
            <text x="0" y="0" fill="#a5b4fc" font-weight="bold" font-family="Segoe UI">CRAWL PLANNER (Loop Closure)</text>
            <rect y="15" width="640" height="120" fill="#6366f1" opacity="0.1" rx="4"/>
            <text x="10" y="40" fill="#ddd" font-family="Consolas" font-size="11">Analyzes 'Coverage Gaps' via Falconer Logic.</text>
            <text x="10" y="55" fill="#ddd" font-family="Consolas" font-size="11">Generates Target Lists for Crawler Core.</text>
            
            <text x="10" y="80" fill="#c9a962" font-weight="bold" font-size="11">GOAL: "Find more info on [LowConfidenceEntity]"</text>
        </g>
    </g>

    <!-- Maroon API Attached -->
    <g transform="translate(560, 500)">
        <rect width="120" height="140" rx="4" fill="#581845" stroke="#900C3F" stroke-width="2"/>
        <text x="60" y="20" fill="#fff" text-anchor="middle" font-family="Segoe UI" font-size="10" font-weight="bold">INTEL API</text>
        <line x1="10" y1="30" x2="110" y2="30" stroke="#900c3f"/>
        <g transform="translate(10, 50)" font-family="Consolas" font-size="9" fill="#fbcfe8">
            <text y="0">GET /graph/query</text>
            <text y="15">POST /goals/set</text>
            <text y="30">GET /gaps</text>
        </g>
    </g>
  </g>

  <!-- UI & VISUALIZATION -->
  <g transform="translate(1600, 860)" filter="url(#softShadow)">
     <!-- Panel -->
     <rect width="700" height="580" rx="8" fill="#fff" stroke="#ccc" stroke-width="1"/>
     <rect width="700" height="40" rx="8" fill="#f3f4f6"/>
     <text x="20" y="28" fill="#374151" font-family="Segoe UI" font-weight="bold" font-size="18">UI / Visualization Layer</text>

     <!-- UI Mocks -->
     <g transform="translate(50, 70)">
        <!-- Mock 1 -->
        <g>
            <rect width="280" height="180" fill="#fff" stroke="#e5e7eb" rx="4"/>
            <rect x="10" y="10" width="260" height="20" fill="#e5e7eb"/>
            <rect x="10" y="40" width="80" height="100" fill="#f3f4f6"/>
            <rect x="100" y="40" width="170" height="100" fill="#f9fafb"/>
            <text x="140" y="90" fill="#9ca3af" font-size="10">Admin Dashboard</text>
        </g>
        <!-- Mock 2 -->
        <g transform="translate(320, 0)">
            <rect width="280" height="180" fill="#fff" stroke="#e5e7eb" rx="4"/>
            <circle cx="140" cy="90" r="40" fill="#fde68a" opacity="0.5"/>
            <circle cx="140" cy="90" r="20" fill="#fcd34d"/>
            <text x="140" y="150" fill="#9ca3af" font-size="10" text-anchor="middle">Geo-Density Map</text>
        </g>
        
        <!-- Mock 3 -->
        <g transform="translate(0, 220)">
            <rect width="600" height="240" fill="#1f2937" rx="4"/>
            <text x="20" y="30" fill="#e5e7eb" font-family="Consolas" font-size="12">> System Status: ONLINE</text>
            <text x="20" y="50" fill="#9ca3af" font-family="Consolas" font-size="12">> Crawl Rate: 45 p/s</text>
            <text x="20" y="70" fill="#10b981" font-family="Consolas" font-size="12">> Intelligence: OPTIMAL</text>
            
            <!-- Graph Vis -->
            <circle cx="400" cy="120" r="10" fill="#6366f1"/>
            <circle cx="450" cy="80" r="8" fill="#6366f1"/>
            <circle cx="500" cy="150" r="12" fill="#6366f1"/>
            <line x1="400" y1="120" x2="450" y2="80" stroke="#4b5563"/>
            <line x1="400" y1="120" x2="500" y2="150" stroke="#4b5563"/>
        </g>
     </g>
  </g>

  <!-- =============================================
       ARROWS & CONNECTORS
       ============================================= -->
       
  <!-- 1. Crawler Core -> DB (Write) -->
  <path d="M 400,520 L 400,570" stroke="#c9a962" stroke-width="4" marker-end="url(#goldArrow)"/>
  
  <!-- 2. DB -> Analysis (Poll/Read) -->
  <path d="M 740,790 L 860,790" stroke="#ef4444" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#goldArrow)"/>
  <text x="780" y="780" fill="#ef4444" font-weight="bold" font-size="12">POLL UNANALYZED</text>
  
  <!-- 3. Analysis -> Intelligence (Forward) -->
  <path d="M 1460,450 L 1600,450" stroke="#6366f1" stroke-width="4" marker-end="url(#goldArrow)"/>
  <text x="1480" y="440" fill="#6366f1" font-weight="bold" font-size="12">STRUCTURED DATA</text>

  <!-- 4. Intelligence -> Crawler Core (FEEDBACK LOOP - THE BIG ONE) -->
  <path d="M 1950,120 C 1950,-50 400,-50 400,110" fill="none" stroke="#c9a962" stroke-width="4" stroke-dasharray="12,6" marker-end="url(#goldArrow)"/>
  
  <rect x="850" y="-30" width="700" height="40" rx="20" fill="#fff" stroke="#c9a962" stroke-width="2"/>
  <text x="1200" y="-5" text-anchor="middle" font-family="Segoe UI" font-weight="bold" fill="#c9a962" letter-spacing="2">INTELLIGENT FEEDBACK LOOP (PLANNING)</text>

  <!-- Gazetteer Link -->
  <path d="M 400,1000 L 400,1050" stroke="#fbbf24" stroke-width="2" stroke-dasharray="4,4" marker-end="url(#goldArrow)"/>
  <text x="410" y="1030" fill="#fbbf24" font-size="11">Reference</text>

</svg>
