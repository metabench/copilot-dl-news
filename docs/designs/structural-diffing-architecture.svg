<svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Industrial Obsidian Background -->
    <linearGradient id="obsidianGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#1a1a1a"/>
      <stop offset="50%" stop-color="#2d2d2d"/>
      <stop offset="100%" stop-color="#151515"/>
    </linearGradient>

    <!-- Drop Shadow for Panels -->
    <filter id="panelShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>

    <!-- Gold Accent Gradient -->
    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#bf953f"/>
      <stop offset="50%" stop-color="#fcf6ba"/>
      <stop offset="100%" stop-color="#b38728"/>
    </linearGradient>

    <!-- Arrowhead -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#d4af37"/>
    </marker>

    <!-- Subtle Grid Pattern -->
    <pattern id="gridPattern" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#333" stroke-width="0.5" opacity="0.3"/>
    </pattern>
  </defs>

  <!-- Background -->
  <rect width="1200" height="800" fill="url(#obsidianGradient)"/>
  <rect width="1200" height="800" fill="url(#gridPattern)" opacity="0.15"/>

  <!-- Title Bar -->
  <rect x="50" y="40" width="1100" height="60" rx="4" fill="#111" stroke="#d4af37" stroke-width="2"/>
  <text x="600" y="82" font-family="Segoe UI, Helvetica, sans-serif" font-size="28" font-weight="300" fill="#fff" text-anchor="middle" letter-spacing="2">STRUCTURAL DIFFING &amp; TEMPLATE MASKING</text>

  <!-- ========================================================================================== -->
  <!-- PANEL 1: INPUT SAMPLING -->
  <!-- ========================================================================================== -->
  <g transform="translate(50, 150)">
    <!-- Panel Background with Leather Texture -->
    <rect width="300" height="550" rx="8" fill="#f8f8f8" filter="url(#panelShadow)" />
    
    <!-- Stitching Effect -->
    <rect x="10" y="10" width="280" height="530" rx="4" fill="none" stroke="#d0d0d0" stroke-width="1" stroke-dasharray="4 4" />
    
    <text x="150" y="40" font-family="Segoe UI" font-size="18" font-weight="bold" fill="#333" text-anchor="middle">PHASE 1: SAMPLING</text>
    <line x1="30" y1="55" x2="270" y2="55" stroke="#ddd" stroke-width="1" />

    <!-- Content -->
    <text x="150" y="90" font-family="Segoe UI" font-size="14" fill="#555" text-anchor="middle">Input: Pages with same Hash</text>
    
    <!-- Stack of Pages -->
    <g transform="translate(75, 120)">
      <rect x="0" y="0" width="150" height="200" rx="2" fill="#fff" stroke="#999" stroke-width="1"/>
      <rect x="10" y="10" width="130" height="20" fill="#eee"/>
      <rect x="10" y="40" width="130" height="100" fill="#e0e0e0"/>
      <rect x="10" y="150" width="130" height="40" fill="#333"/>
      <text x="-15" y="100" font-family="Segoe UI" font-size="11" fill="#888" text-anchor="middle">A</text>
    </g>
    <g transform="translate(85, 130)">
      <rect x="0" y="0" width="150" height="200" rx="2" fill="#fff" stroke="#999" stroke-width="1"/>
      <rect x="10" y="10" width="130" height="20" fill="#eee"/>
      <rect x="10" y="40" width="130" height="100" fill="#d0d0d0"/>
      <rect x="10" y="150" width="130" height="40" fill="#333"/>
      <text x="-15" y="100" font-family="Segoe UI" font-size="11" fill="#888" text-anchor="middle">B</text>
    </g>
    <g transform="translate(95, 140)">
      <rect x="0" y="0" width="150" height="200" rx="2" fill="#fff" stroke="#333" stroke-width="2"/>
      <rect x="10" y="10" width="130" height="20" fill="#eee"/>
      <rect x="10" y="40" width="130" height="100" fill="#c0c0c0"/>
      <rect x="10" y="150" width="130" height="40" fill="#333"/>
      <text x="75" y="100" font-family="monospace" font-size="12" fill="#000" text-anchor="middle">Page C</text>
      <text x="-15" y="100" font-family="Segoe UI" font-size="11" fill="#333" font-weight="bold" text-anchor="middle">C</text>
    </g>

    <text x="150" y="380" font-family="Segoe UI" font-size="14" fill="#444" text-anchor="middle">
      <tspan x="150" dy="0">Select K=5 samples</tspan>
      <tspan x="150" dy="20">sharing Layout Signature</tspan>
    </text>

    <rect x="50" y="420" width="200" height="40" rx="20" fill="#222" />
    <text x="150" y="445" font-family="Segoe UI" font-size="14" fill="#fff" text-anchor="middle">SkeletonHash Match</text>
  </g>

  <!-- Connector Arrow -->
  <path d="M 350 425 L 400 425" stroke="#d4af37" stroke-width="4" marker-end="url(#arrowhead)"/>

  <!-- ========================================================================================== -->
  <!-- PANEL 2: PARALLEL TRAVERSAL -->
  <!-- ========================================================================================== -->
  <g transform="translate(400, 150)">
    <rect width="400" height="550" rx="8" fill="#f8f8f8" filter="url(#panelShadow)" />
    <rect x="10" y="10" width="380" height="530" rx="4" fill="none" stroke="#d0d0d0" stroke-width="1" stroke-dasharray="4 4" />
    
    <text x="200" y="40" font-family="Segoe UI" font-size="18" font-weight="bold" fill="#333" text-anchor="middle">PHASE 2: PARALLEL TRAVERSAL</text>
    <line x1="30" y1="55" x2="370" y2="55" stroke="#ddd" stroke-width="1" />

    <!-- Tree Visualization -->
    <g transform="translate(50, 100)">
      <!-- Root -->
      <circle cx="150" cy="0" r="15" fill="#333" />
      <text x="150" y="-25" font-family="monospace" font-size="12" fill="#333" text-anchor="middle">ROOT</text>

      <!-- Level 1 -->
      <line x1="150" y1="15" x2="50" y2="80" stroke="#999" stroke-width="2" />
      <line x1="150" y1="15" x2="150" y2="80" stroke="#999" stroke-width="2" />
      <line x1="150" y1="15" x2="250" y2="80" stroke="#999" stroke-width="2" />

      <!-- Nodes L1 -->
      <circle cx="50" cy="80" r="20" fill="#ddd" stroke="#333" stroke-width="2"/>
      <text x="50" y="84" font-family="monospace" font-size="10" text-anchor="middle" fill="#333">NAV</text>
      
      <circle cx="150" cy="80" r="20" fill="#fff" stroke="#d4af37" stroke-width="3"/>
      <text x="150" y="84" font-family="monospace" font-size="10" text-anchor="middle" fill="#b38728">MAIN</text>

      <circle cx="250" cy="80" r="20" fill="#ddd" stroke="#333" stroke-width="2"/>
      <text x="250" y="84" font-family="monospace" font-size="10" text-anchor="middle" fill="#333">FOOT</text>

      <!-- Level 2 (Under Main) -->
      <line x1="150" y1="100" x2="100" y2="160" stroke="#d4af37" stroke-width="2" stroke-dasharray="4 2" />
      <line x1="150" y1="100" x2="200" y2="160" stroke="#d4af37" stroke-width="2" stroke-dasharray="4 2" />

      <circle cx="100" cy="160" r="18" fill="#fff" stroke="#d4af37" stroke-width="3"/>
      <text x="100" y="164" font-family="monospace" font-size="10" text-anchor="middle" fill="#b38728">H1</text>

      <circle cx="200" cy="160" r="18" fill="#fff" stroke="#d4af37" stroke-width="3"/>
      <text x="200" y="164" font-family="monospace" font-size="10" text-anchor="middle" fill="#b38728">DIV</text>

      <!-- Annotations -->
      <text x="50" y="120" font-family="Segoe UI" font-size="12" fill="#666" text-anchor="middle">Identical</text>
      <text x="250" y="120" font-family="Segoe UI" font-size="12" fill="#666" text-anchor="middle">Identical</text>
      <text x="150" y="220" font-family="Segoe UI" font-size="12" fill="#b38728" font-weight="bold" text-anchor="middle">Varies across samples</text>
    </g>

    <!-- Logic Box -->
    <rect x="40" y="350" width="320" height="120" rx="4" fill="#222" />
    <text x="60" y="380" font-family="monospace" font-size="12" fill="#0f0">if (node[A] == node[B])</text>
    <text x="80" y="400" font-family="monospace" font-size="12" fill="#ccc">-> Mark STATIC (Mask)</text>
    <text x="60" y="420" font-family="monospace" font-size="12" fill="#f00">else</text>
    <text x="80" y="440" font-family="monospace" font-size="12" fill="#d4af37">-> Mark DYNAMIC (Keep)</text>
  </g>

  <!-- Connector Arrow -->
  <path d="M 800 425 L 850 425" stroke="#d4af37" stroke-width="4" marker-end="url(#arrowhead)"/>

  <!-- ========================================================================================== -->
  <!-- PANEL 3: MASK GENERATION -->
  <!-- ========================================================================================== -->
  <g transform="translate(850, 150)">
    <rect width="300" height="550" rx="8" fill="#f8f8f8" filter="url(#panelShadow)" />
    <rect x="10" y="10" width="280" height="530" rx="4" fill="none" stroke="#d0d0d0" stroke-width="1" stroke-dasharray="4 4" />
    
    <text x="150" y="40" font-family="Segoe UI" font-size="18" font-weight="bold" fill="#333" text-anchor="middle">PHASE 3: THE MASK</text>
    <line x1="30" y1="55" x2="270" y2="55" stroke="#ddd" stroke-width="1" />

    <!-- JSON Output -->
    <rect x="30" y="100" width="240" height="200" rx="4" fill="#fff" stroke="#ccc" />
    <text x="40" y="125" font-family="monospace" font-size="12" fill="#333">{</text>
    <text x="50" y="145" font-family="monospace" font-size="12" fill="#333">"hash": "a1b2c3d4",</text>
    <text x="50" y="165" font-family="monospace" font-size="12" fill="#333">"dynamic_paths": [</text>
    <text x="70" y="185" font-family="monospace" font-size="12" fill="#d4af37">"0.1",   // Main</text>
    <text x="70" y="205" font-family="monospace" font-size="12" fill="#d4af37">"0.1.0", // H1</text>
    <text x="70" y="225" font-family="monospace" font-size="12" fill="#d4af37">"0.1.1"  // Div</text>
    <text x="50" y="245" font-family="monospace" font-size="12" fill="#333">],</text>
    <text x="50" y="265" font-family="monospace" font-size="12" fill="#333">"sample_size": 5</text>
    <text x="40" y="285" font-family="monospace" font-size="12" fill="#333">}</text>

    <!-- Result Visual -->
    <g transform="translate(75, 340)">
      <text x="75" y="-10" font-family="Segoe UI" font-size="14" fill="#555" text-anchor="middle">Resulting View</text>
      <rect x="0" y="0" width="150" height="180" rx="2" fill="#fff" stroke="#333" />
      
      <!-- Masked Areas -->
      <rect x="10" y="10" width="130" height="20" fill="#eee" opacity="0.3" /> <!-- Nav (Faded) -->
      <line x1="10" y1="10" x2="140" y2="30" stroke="#ccc" stroke-width="1" />
      <line x1="140" y1="10" x2="10" y2="30" stroke="#ccc" stroke-width="1" />
      
      <!-- Content Area -->
      <rect x="10" y="40" width="130" height="100" fill="#fffbf0" stroke="#d4af37" stroke-width="3"/>
      <text x="75" y="85" font-family="Segoe UI" font-size="16" font-weight="bold" fill="#333" text-anchor="middle">CONTENT</text>
      <text x="75" y="105" font-family="Segoe UI" font-size="11" fill="#b38728" text-anchor="middle">âœ“ EXTRACTED</text>

      <!-- Footer Masked -->
      <rect x="10" y="150" width="130" height="20" fill="#333" opacity="0.3" />
      <line x1="10" y1="150" x2="140" y2="170" stroke="#ccc" stroke-width="1" />
      <line x1="140" y1="150" x2="10" y2="170" stroke="#ccc" stroke-width="1" />
    </g>
  </g>

  <!-- Database Layer -->
  <g transform="translate(0, 720)">
    <rect width="1200" height="80" fill="#111" />
    <line x1="0" y1="0" x2="1200" y2="0" stroke="#d4af37" stroke-width="2"/>
    
    <text x="200" y="45" font-family="monospace" font-size="16" fill="#888">DB: layout_signatures</text>
    <text x="600" y="45" font-family="monospace" font-size="16" fill="#d4af37">DB: layout_masks</text>
    <text x="1000" y="45" font-family="monospace" font-size="16" fill="#888">DB: content_storage</text>
  </g>

</svg>
