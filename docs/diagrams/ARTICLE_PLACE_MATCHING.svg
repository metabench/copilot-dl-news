<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 690">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-opacity="0.12"/>
    </filter>
    <filter id="shadow-sm" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <path d="M 0 0 L 10 3.5 L 0 7 L 2 3.5 Z" fill="#64748b"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <path d="M 0 0 L 10 3.5 L 0 7 L 2 3.5 Z" fill="#22c55e"/>
    </marker>
    <linearGradient id="article" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#3b82f6"/>
    </linearGradient>
    <linearGradient id="match" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#8b5cf6"/>
    </linearGradient>
    <linearGradient id="gaz" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#4ade80"/><stop offset="100%" stop-color="#22c55e"/>
    </linearGradient>
    <linearGradient id="conf" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#fb923c"/><stop offset="100%" stop-color="#f97316"/>
    </linearGradient>
    <linearGradient id="rel" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f87171"/><stop offset="100%" stop-color="#ef4444"/>
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="1100" height="730" fill="#f8fafc"/>
  
  <!-- Header -->
  <rect width="1100" height="75" fill="#0f172a"/>
  <text x="550" y="35" font-family="Inter, system-ui, sans-serif" font-size="24" font-weight="700" text-anchor="middle" fill="#ffffff">Article-Place Matching Pipeline</text>
  <text x="550" y="58" font-family="Inter, system-ui, sans-serif" font-size="13" text-anchor="middle" fill="#94a3b8">Rule-Based Confidence Scoring for Geographic Entity Extraction</text>
  
  <!-- Input: Article -->
  <g filter="url(#shadow)">
    <rect x="40" y="100" width="200" height="145" rx="12" fill="url(#article)"/>
    <text x="140" y="130" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="700" text-anchor="middle" fill="#ffffff">Article Content</text>
    <rect x="55" y="145" width="170" height="85" rx="6" fill="#ffffff"/>
    <text x="140" y="163" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" text-anchor="middle" fill="#1e40af">California Wildfires</text>
    <text x="140" y="180" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#475569">"Fires spread across California</text>
    <text x="140" y="193" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#475569">as Los Angeles residents flee.</text>
    <text x="140" y="206" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#475569">San Francisco air quality..."</text>
    <text x="140" y="219" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#94a3b8" font-style="italic">Governor addressed...</text>
  </g>
  
  <!-- Arrow to Rules -->
  <line x1="240" y1="172" x2="280" y2="172" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="260" y="162" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#94a3b8">extract</text>
  
  <!-- Rule Levels Section -->
  <rect x="290" y="100" width="310" height="330" rx="12" fill="#ffffff" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <text x="445" y="128" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="700" text-anchor="middle" fill="#0f172a" letter-spacing="0.5">MATCHING RULE LEVELS</text>
  
  <!-- Level 0 -->
  <rect x="310" y="145" width="270" height="40" rx="6" fill="#f1f5f9" stroke="#cbd5e1"/>
  <text x="328" y="165" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" fill="#64748b">Level 0:</text>
  <text x="390" y="165" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">no_rules_applied</text>
  <text x="328" y="180" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#94a3b8">Default for unprocessed content</text>
  
  <!-- Level 1 -->
  <rect x="310" y="195" width="270" height="45" rx="6" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="1.5"/>
  <text x="328" y="217" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" fill="#16a34a">Level 1:</text>
  <text x="390" y="217" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#15803d">basic_string_match</text>
  <text x="328" y="233" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#22c55e">Exact/case-insensitive string matching</text>
  
  <!-- Level 2 -->
  <rect x="310" y="250" width="270" height="45" rx="6" fill="#fff7ed" stroke="#fed7aa" stroke-width="1.5"/>
  <text x="328" y="272" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" fill="#ea580c">Level 2:</text>
  <text x="390" y="272" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#c2410c">context_aware</text>
  <text x="328" y="288" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#f97316">Position, frequency, headline priority</text>
  
  <!-- Level 3 -->
  <rect x="310" y="305" width="270" height="45" rx="6" fill="#fef2f2" stroke="#fecaca" stroke-width="1.5"/>
  <text x="328" y="327" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" fill="#dc2626">Level 3:</text>
  <text x="390" y="327" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#b91c1c">entity_disambiguation</text>
  <text x="328" y="343" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#f87171">Distinguishes places from people/companies</text>
  
  <!-- Level 4 -->
  <rect x="310" y="360" width="270" height="45" rx="6" fill="#faf5ff" stroke="#e9d5ff" stroke-width="1.5"/>
  <text x="328" y="382" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" fill="#7c3aed">Level 4:</text>
  <text x="390" y="382" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#6d28d9">nlp_enhanced</text>
  <text x="328" y="398" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#a855f7">WinkNLP for English text analysis</text>
  
  <!-- Arrow to Gazetteer -->
  <line x1="445" y1="430" x2="445" y2="470" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="460" y="455" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#94a3b8">query</text>
  
  <!-- Gazetteer Lookup -->
  <g filter="url(#shadow-sm)">
    <rect x="340" y="480" width="210" height="80" rx="10" fill="url(#gaz)"/>
    <text x="445" y="508" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="700" text-anchor="middle" fill="#ffffff">Gazetteer API</text>
    <text x="445" y="528" font-family="Inter, system-ui, sans-serif" font-size="10" text-anchor="middle" fill="#dcfce7">places, place_names tables</text>
    <text x="445" y="545" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#bbf7d0">/api/gazetteer/resolve</text>
  </g>
  
  <!-- Arrow from Gazetteer -->
  <line x1="550" y1="520" x2="610" y2="520" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="580" y="510" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#22c55e">candidates</text>
  
  <!-- Confidence Scoring -->
  <g filter="url(#shadow)">
    <rect x="620" y="100" width="200" height="200" rx="12" fill="url(#conf)"/>
    <text x="720" y="130" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="700" text-anchor="middle" fill="#ffffff">Confidence Scoring</text>
    <rect x="635" y="145" width="170" height="140" rx="6" fill="#ffffff"/>
    <text x="720" y="168" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" text-anchor="middle" fill="#c2410c">Score Factors:</text>
    <text x="648" y="188" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• Base: 0.5 for any match</text>
    <text x="648" y="204" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• Frequency: +0.1 per mention</text>
    <text x="648" y="220" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• Position: earlier = higher</text>
    <text x="648" y="236" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• Headline: +0.2 bonus</text>
    <text x="720" y="258" font-family="Inter, system-ui, sans-serif" font-size="9" font-weight="600" text-anchor="middle" fill="#c2410c">Thresholds:</text>
    <text x="720" y="274" font-family="Inter, system-ui, sans-serif" font-size="8" text-anchor="middle" fill="#78716c">high≥0.8 • med≥0.6 • low≥0.4</text>
  </g>
  
  <!-- Arrow to Relations -->
  <line x1="720" y1="300" x2="720" y2="330" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Relation Types -->
  <g filter="url(#shadow)">
    <rect x="620" y="340" width="200" height="150" rx="12" fill="url(#rel)"/>
    <text x="720" y="368" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="700" text-anchor="middle" fill="#ffffff">Relation Types</text>
    <rect x="635" y="382" width="170" height="95" rx="6" fill="#ffffff"/>
    <text x="648" y="402" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• <tspan font-weight="600">primary</tspan>: Main subject</text>
    <text x="648" y="418" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• <tspan font-weight="600">secondary</tspan>: Important mention</text>
    <text x="648" y="434" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• <tspan font-weight="600">mentioned</tspan>: Brief reference</text>
    <text x="648" y="450" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• <tspan font-weight="600">affected</tspan>: Impacted area</text>
    <text x="648" y="466" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">• <tspan font-weight="600">origin</tspan>: Source of events</text>
  </g>
  
  <!-- Output: Relations Table -->
  <rect x="860" y="100" width="210" height="390" rx="12" fill="#ffffff" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <text x="965" y="128" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="700" text-anchor="middle" fill="#0f172a">article_place_relations</text>
  
  <!-- Arrow to output -->
  <line x1="820" y1="280" x2="860" y2="280" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Example records -->
  <rect x="875" y="145" width="180" height="75" rx="6" fill="#f8fafc" stroke="#e2e8f0"/>
  <text x="965" y="163" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" text-anchor="middle" fill="#1e40af">California (primary)</text>
  <text x="885" y="180" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">confidence: 0.92</text>
  <text x="885" y="195" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">rule_level: 2</text>
  <text x="885" y="210" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">evidence: {headline, 5×}</text>
  <rect x="1015" y="165" width="35" height="16" rx="4" fill="#22c55e"/>
  <text x="1032" y="177" font-family="Inter, system-ui, sans-serif" font-size="8" font-weight="600" text-anchor="middle" fill="#ffffff">HIGH</text>
  
  <rect x="875" y="230" width="180" height="75" rx="6" fill="#f8fafc" stroke="#e2e8f0"/>
  <text x="965" y="248" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" text-anchor="middle" fill="#1e40af">Los Angeles (secondary)</text>
  <text x="885" y="265" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">confidence: 0.78</text>
  <text x="885" y="280" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">rule_level: 2</text>
  <text x="885" y="295" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">evidence: {body, 2×}</text>
  <rect x="1015" y="250" width="35" height="16" rx="4" fill="#f59e0b"/>
  <text x="1032" y="262" font-family="Inter, system-ui, sans-serif" font-size="8" font-weight="600" text-anchor="middle" fill="#ffffff">MED</text>
  
  <rect x="875" y="315" width="180" height="75" rx="6" fill="#f8fafc" stroke="#e2e8f0"/>
  <text x="965" y="333" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" text-anchor="middle" fill="#1e40af">San Francisco (mentioned)</text>
  <text x="885" y="350" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">confidence: 0.55</text>
  <text x="885" y="365" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">rule_level: 1</text>
  <text x="885" y="380" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#475569">evidence: {body, 1×}</text>
  <rect x="1015" y="335" width="35" height="16" rx="4" fill="#f97316"/>
  <text x="1032" y="347" font-family="Inter, system-ui, sans-serif" font-size="8" font-weight="600" text-anchor="middle" fill="#ffffff">MED</text>
  
  <rect x="875" y="400" width="180" height="50" rx="6" fill="#fef2f2" stroke="#fecaca"/>
  <text x="965" y="420" font-family="Inter, system-ui, sans-serif" font-size="10" font-style="italic" text-anchor="middle" fill="#94a3b8">Paris Hilton → Paris</text>
  <text x="965" y="438" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#f87171">confidence: 0.18 (rejected)</text>
  
  <text x="965" y="472" font-family="Inter, system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#64748b">Stored in SQLite</text>
  <text x="965" y="486" font-family="Inter, system-ui, sans-serif" font-size="8" text-anchor="middle" fill="#94a3b8">with evidence JSON</text>
  
  <!-- Evidence Panel -->
  <rect x="40" y="580" width="560" height="95" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1" filter="url(#shadow-sm)"/>
  <text x="60" y="605" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="700" fill="#0f172a">Evidence Storage (JSON)</text>
  <rect x="55" y="618" width="530" height="45" rx="4" fill="#f8fafc" stroke="#e2e8f0"/>
  <text x="70" y="636" font-family="monospace" font-size="9" fill="#475569">{"rule": "context_aware", "matches": ["California", "California's"],</text>
  <text x="70" y="652" font-family="monospace" font-size="9" fill="#475569"> "context": "HEADLINE: California Wildfires...", "freq": 5}</text>
  
  <!-- Legend -->
  <rect x="620" y="580" width="450" height="95" rx="12" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1" filter="url(#shadow)"/>
  <text x="640" y="608" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="700" fill="#0f172a">Pipeline Summary</text>
  
  <text x="640" y="635" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#475569">
    <tspan font-weight="600">1. Extract</tspan>: Title + body
  </text>
  <text x="780" y="635" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#475569">
    <tspan font-weight="600">2. Match</tspan>: Apply rule level
  </text>
  <text x="640" y="655" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#475569">
    <tspan font-weight="600">3. Score</tspan>: Calculate confidence
  </text>
  <text x="810" y="655" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#475569">
    <tspan font-weight="600">4. Classify</tspan>: Assign relation
  </text>
  
  <text x="845" y="670" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#94a3b8">
    <tspan font-weight="600">5. Store</tspan>: Persist with evidence
  </text>
</svg>