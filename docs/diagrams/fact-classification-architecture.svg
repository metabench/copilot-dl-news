<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900" width="1400" height="900">
  <title>Fact-Based Classification System Architecture</title>

  <defs>
    <linearGradient id="goldGrad" x1="0" x2="1">
      <stop offset="0" stop-color="#c9a227" stop-opacity="1"/>
      <stop offset="1" stop-color="#8b7500" stop-opacity="1"/>
    </linearGradient>

    <linearGradient id="panelGrad" x1="0" x2="0" y1="0" y2="1">
      <stop offset="0" stop-color="#141824" stop-opacity="1"/>
      <stop offset="1" stop-color="#10131a" stop-opacity="1"/>
    </linearGradient>

    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#f0f4f8" />
    </marker>

    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="#000" flood-opacity="0.5" />
    </filter>

    <style>
      .bg { fill: #0a0d14; }
      .card { fill: url(#panelGrad); stroke: rgba(201,162,39,0.16); stroke-width: 1; rx: 10; ry: 10; }
      .title { font-family: Georgia, serif; fill: #c9a227; font-size: 20px; font-weight: 700; }
      .label { font-family: Inter, Arial, sans-serif; fill: #f0f4f8; font-size: 14px; }
      .muted { fill: #94a3b8; font-size: 12px; }
      .example { fill: #f0f4f8; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
      .accent { fill: url(#goldGrad); }
      .arrow { stroke: #f0f4f8; stroke-width: 1.6; fill: none; marker-end: url(#arrow); }
      .db { fill: #10131a; stroke: rgba(201,162,39,0.18); stroke-width: 1; }
      .legend-box { fill: rgba(255,255,255,0.02); stroke: rgba(255,255,255,0.04); }
      .legend-text { font-family: Inter, Arial, sans-serif; font-size: 11px; fill: #f0f4f8; }
      .tiny-muted { font-family: Inter, Arial, sans-serif; font-size: 10px; fill: #94a3b8; }
      .panel-heading { font-family: Inter, Arial, sans-serif; font-size: 13px; fill: #c9a227; font-weight: 700; }
    </style>
  </defs>

  <!-- Background -->
  <rect width="1400" height="900" class="bg" />

  <!-- Title -->
  <g transform="translate(48,28)">
    <text x="0" y="6" class="title">Fact-Based Classification System</text>
    <text x="0" y="30" class="muted">Objective: Extract boolean facts (store &amp; classify)</text>
  </g>

  <!-- INPUTS -->
  <g transform="translate(48,120)">
    <rect x="0" y="0" width="220" height="130" rx="10" ry="10" class="card"/>
    <text x="16" y="26" class="panel-heading">Inputs</text>
    <text x="16" y="52" class="label">• URL String (primary)</text>
    <text x="16" y="74" class="label">• HTML Document (secondary)</text>
    <text x="16" y="96" class="label">• HTTP Response (secondary)</text>
    <text x="16" y="118" class="tiny-muted">Notes: URL facts are cheapest — run first</text>
  </g>

  <!-- FACT EXTRACTORS -->
  <g transform="translate(320,40)">
    <rect x="0" y="0" width="360" height="360" rx="12" ry="12" class="card" />
    <text x="12" y="26" class="panel-heading">Fact Extraction</text>

    <!-- Categories -->
    <g transform="translate(18,44)">
      <!-- URL (emphasized) -->
      <rect x="0" y="0" width="300" height="48" rx="8" ry="8" fill="#141d2a" stroke="#c9a227" stroke-width="1.2" />
      <text x="12" y="28" class="label">url (cheapest)</text>
      <circle cx="268" cy="20" r="6" fill="#10b981" />
      <text x="12" y="42" class="tiny-muted">Example: <tspan class="example">url.hasDateSegment</tspan>, <tspan class="example">url.hasNewsKeyword</tspan></text>

      <!-- Document -->
      <rect x="0" y="72" width="300" height="40" rx="8" ry="8" fill="#141824" />
      <circle cx="268" cy="84" r="6" fill="#3b82f6" />
      <text x="12" y="96" class="label">document</text>
      <text x="12" y="110" class="tiny-muted">Example: document.hasArticleTag</text>

      <!-- Schema -->
      <rect x="0" y="124" width="300" height="40" rx="8" ry="8" fill="#141824" />
      <circle cx="268" cy="136" r="6" fill="#94a3b8" />
      <text x="12" y="148" class="label">schema</text>
      <text x="12" y="178" class="tiny-muted">Example: schema.hasArticleType</text>

      <!-- Meta -->
      <rect x="0" y="176" width="300" height="40" rx="8" ry="8" fill="#141824" />
      <circle cx="268" cy="188" r="6" fill="#c9a227" />
      <text x="12" y="200" class="label">meta</text>
      <text x="12" y="214" class="tiny-muted">Example: meta.hasOgType</text>

      <!-- Response -->
      <rect x="0" y="228" width="300" height="40" rx="8" ry="8" fill="#141824" />
      <circle cx="268" cy="240" r="6" fill="#8b5cf6" />
      <text x="12" y="252" class="label">response</text>
      <text x="12" y="266" class="tiny-muted">Example: response.isHtml</text>

      <!-- Page -->
      <rect x="0" y="280" width="300" height="40" rx="8" ry="8" fill="#141824" />
      <circle cx="268" cy="292" r="6" fill="#ef4444" />
      <text x="12" y="304" class="label">page</text>
      <text x="12" y="318" class="tiny-muted">Example: page.hasMainContent</text>
    </g>

    <!-- FactRegistry in this area -->
    <g transform="translate(120,160)">
      <rect x="0" y="0" width="180" height="140" rx="10" ry="10" class="card" />
      <text x="12" y="26" class="panel-heading">FactRegistry</text>
      <text x="12" y="52" class="label">• Indexes facts by name &amp; category</text>
      <text x="12" y="78" class="label">• getRunnableFacts(availableData)</text>
      <text x="12" y="102" class="label">• register(fact.getMetadata())</text>
      <text x="12" y="124" class="tiny-muted">Singleton: discovers and registers builtin facts</text>
    </g>
  </g>

  <!-- Small Fact JSON sample -->
  <g transform="translate(460,380)">
    <rect x="0" y="0" width="280" height="160" rx="8" ry="8" class="card" />
    <text x="12" y="24" class="panel-heading">Fact Result (sample)</text>
    <text x="12" y="48" class="example">{</text>
    <text x="24" y="66" class="example">"name": "url.hasDateSegment",</text>
    <text x="24" y="84" class="example">"value": true,</text>
    <text x="24" y="102" class="example">"evidence": { "pattern": "/2024/01/15/" },</text>
    <text x="24" y="120" class="example">"extractedAt": "2025-12-02T12:34:56Z",</text>
    <text x="12" y="140" class="example">"version": 1</text>
    <text x="12" y="156" class="example">}</text>
  </g>

  <!-- Arrows from Inputs to Fact Extractors/Registry -->
  <g stroke="#f0f4f8" stroke-width="1.4" fill="none">
    <path d="M268 160 L320 160" class="arrow" marker-end="url(#arrow)" />
    <path d="M268 200 L320 200" class="arrow" marker-end="url(#arrow)" />
    <path d="M268 240 L320 240" class="arrow" marker-end="url(#arrow)" />
  </g>

  <!-- DB Storage -->
  <g transform="translate(760,140)">
    <!-- A stylized cylinder for DB -->
    <path d="M0,20 a80,20 0 0,0 160,0 v160 a80,20 0 0,0 -160,0 z" transform="translate(0,0)" class="db" />
    <rect x="0" y="20" width="160" height="160" class="db" />
    <rect x="0" y="20" width="160" height="20" fill="#111418" stroke="rgba(255,255,255,0.04)"/>
    <text x="12" y="40" class="panel-heading">Fact Storage</text>
    <text x="12" y="62" class="label">Table: url_facts</text>
    <text x="12" y="82" class="muted">Columns: url_id, fact_name, value</text>

    <!-- sample row -->
    <rect x="10" y="100" width="140" height="24" rx="4" ry="4" fill="#101823" stroke="rgba(255,255,255,0.02)" />
    <text x="18" y="116" class="example">url.hasDateSegment → TRUE</text>
    <rect x="10" y="130" width="140" height="24" rx="4" ry="4" fill="#0d151b" stroke="rgba(255,255,255,0.02)" />
    <text x="18" y="146" class="example">url.hasNewsKeyword → TRUE</text>
  </g>

  <!-- Arrows from Extractors/Registry to Storage -->
  <g stroke="#f0f4f8" stroke-width="1.4" fill="none">
    <path d="M560 200 C640 200, 700 200, 760 200" class="arrow" marker-end="url(#arrow)" />
    <text x="600" y="220" class="tiny-muted">compute &amp; store</text>
  </g>

  <!-- Classification Engine -->
  <g transform="translate(1060,140)">
    <rect x="0" y="0" width="240" height="220" rx="12" ry="12" class="card"/>
    <text x="14" y="26" class="panel-heading">Classification Engine</text>
    <text x="14" y="54" class="label">Rules engine queries facts</text>
    <text x="14" y="68" class="tiny-muted">Example rule evaluation:</text>

    <!-- Example rule box -->
    <rect x="14" y="70" width="210" height="90" rx="8" ry="8" fill="#11151a" stroke="rgba(255,255,255,0.04)" />
    <text x="24" y="92" class="example" font-size="11">
      <tspan x="24" dy="0">IF url.hasDateSegment (TRUE) AND url.hasNewsKeyword (TRUE)</tspan>
      <tspan x="24" dy="18">AND NOT url.isHomepage (FALSE) → result = TRUE → "article"</tspan>
    </text>

    <g transform="translate(14,144)">
      <text x="6" y="18" class="label">Outputs:</text>
      <text x="26" y="36" class="muted">• article</text>
      <text x="26" y="54" class="muted">• listing</text>
      <text x="26" y="72" class="muted">• homepage</text>
      <text x="26" y="90" class="muted">• unknown</text>
    </g>
  </g>

  <!-- Arrow from DB to Classification -->
  <g stroke="#f0f4f8" stroke-width="1.4" fill="none">
    <path d="M840 240 C940 240, 1000 240, 1060 240 L1060 240" class="arrow" marker-end="url(#arrow)" />
    <text x="765" y="300" class="tiny-muted">query for relevant facts</text>
    <path d="M840 240 L1060 240" class="arrow" marker-end="url(#arrow)" />
  </g>

  <!-- Arrow from Classification back to system or results -->
  <g stroke="#f0f4f8" stroke-width="1.4" fill="none">
    <path d="M1120 180 L1240 180" class="arrow" marker-end="url(#arrow)" />
  </g>

  <!-- Output panel -->
  <g transform="translate(1240,120)">
    <rect x="0" y="0" width="120" height="100" rx="10" ry="10" class="card" />
    <text x="12" y="26" class="panel-heading">Outputs</text>
    <text x="12" y="52" class="label">article</text>
    <text x="12" y="72" class="label">listing</text>
    <text x="12" y="92" class="label">homepage</text>
  </g>

  <!-- Legend -->
  <g transform="translate(48,560)">
    <rect x="0" y="0" width="420" height="160" rx="6" ry="6" class="legend-box" />
    <text x="12" y="22" class="panel-heading">Legend</text>
    <text x="12" y="46" class="legend-text">• <tspan fill="#c9a227">Gold</tspan> — Primary headings / emphasis</text>
    <text x="12" y="72" class="legend-text">• <tspan fill="#94a3b8">Muted</tspan> — Secondary labels</text>
    <text x="12" y="98" class="legend-text">• <tspan fill="#10b981">Green</tspan> — Success / active</text>
    <text x="12" y="124" class="legend-text">• <tspan fill="#3b82f6">Blue</tspan> — Document/Response</text>
    <text x="12" y="150" class="legend-text">• <tspan fill="#ef4444">Red</tspan> — High cost (e.g., page)</text>
  </g>

  <!-- small note about boolean facts -->
  <g transform="translate(48,700)">
    <text x="0" y="0" class="tiny-muted">Key idea: Facts are NEUTRAL boolean observations (TRUE/FALSE). Classification rules combine facts with logical operators to produce the classification.</text>
  </g>

</svg>
