<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 380">
  <g id="pipeline">
    <!-- Panel Header -->
    <rect x="0" y="0" width="400" height="45" fill="#3a3a3a" rx="8"/>
    <text x="200" y="28" text-anchor="middle" font-size="14" font-weight="600" fill="#f0ede8" letter-spacing="1">FULL PIPELINE</text>
    
    <!-- Step 1 -->
    <g transform="translate(15, 55)">
      <rect x="0" y="0" width="370" height="45" fill="#3b82f6" rx="6"/>
      <text x="30" y="18" font-size="10" font-weight="600" fill="white">STEP 1: SIGNATURE EXTRACTION</text>
      <text x="30" y="32" font-size="9" fill="white" opacity="0.8">SkeletonHash(html) → L1 hash (16B) + L2 hash (16B)</text>
      <circle cx="15" cy="22" r="8" fill="white" opacity="0.2"/>
      <text x="15" y="26" text-anchor="middle" font-size="10" font-weight="700" fill="white">1</text>
    </g>
    
    <!-- Arrow -->
    <path d="M 200 105 L 200 120" stroke="#c9a962" stroke-width="2" fill="none"/>
    <polygon points="196,118 200,126 204,118" fill="#c9a962"/>
    
    <!-- Step 2 -->
    <g transform="translate(15, 130)">
      <rect x="0" y="0" width="370" height="45" fill="#8b5cf6" rx="6"/>
      <text x="30" y="18" font-size="10" font-weight="600" fill="white">STEP 2: EXACT LOOKUP</text>
      <text x="30" y="32" font-size="9" fill="white" opacity="0.8">SELECT * FROM layout_signatures WHERE hash = L1</text>
      <circle cx="15" cy="22" r="8" fill="white" opacity="0.2"/>
      <text x="15" y="26" text-anchor="middle" font-size="10" font-weight="700" fill="white">2</text>
    </g>
    
    <!-- Branch Arrow -->
    <path d="M 120 175 L 120 195 L 80 195 L 80 215" stroke="#10b981" stroke-width="2" fill="none"/>
    <path d="M 280 175 L 280 195 L 320 195 L 320 215" stroke="#fbbf24" stroke-width="2" fill="none"/>
    
    <!-- Step 3a: Found -->
    <g transform="translate(15, 215)">
      <rect x="0" y="0" width="160" height="55" fill="#10b981" rx="6"/>
      <text x="10" y="18" font-size="9" font-weight="600" fill="white">✓ FOUND</text>
      <text x="10" y="34" font-size="8" fill="white" opacity="0.9">Increment seen_count</text>
      <text x="10" y="48" font-size="8" fill="white" opacity="0.9">Return cluster_id</text>
    </g>
    
    <!-- Step 3b: Not Found -->
    <g transform="translate(195, 215)">
      <rect x="0" y="0" width="190" height="55" fill="#fbbf24" rx="6"/>
      <text x="10" y="18" font-size="9" font-weight="600" fill="#1a1a1a">✗ NOT FOUND</text>
      <text x="10" y="34" font-size="8" fill="#1a1a1a" opacity="0.9">Compute MinHash signature</text>
      <text x="10" y="48" font-size="8" fill="#1a1a1a" opacity="0.9">→ Step 4</text>
    </g>
    
    <!-- Arrow to Step 4 -->
    <path d="M 290 275 L 290 295" stroke="#c9a962" stroke-width="2" fill="none"/>
    <polygon points="286,293 290,301 294,293" fill="#c9a962"/>
    
    <!-- Step 4 -->
    <g transform="translate(15, 300)">
      <rect x="0" y="0" width="370" height="65" fill="#ef4444" rx="6"/>
      <text x="30" y="18" font-size="10" font-weight="600" fill="white">STEP 4: LEADER CLUSTERING</text>
      <text x="30" y="34" font-size="9" fill="white" opacity="0.9">Compare MinHash to cluster centroids (O(K))</text>
      <text x="30" y="48" font-size="9" fill="white" opacity="0.9">If distance &lt; T: assign | Else: create new cluster</text>
      <circle cx="15" cy="22" r="8" fill="white" opacity="0.2"/>
      <text x="15" y="26" text-anchor="middle" font-size="10" font-weight="700" fill="white">4</text>
    </g>
  </g>
</svg>
