<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800" style="background: #f5f5f5">
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="24" font-weight="600" fill="#333">Self-Healing Service Workflow</text>
  <text x="700" y="62" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="12" fill="#666">Automatic Error Recovery: Diagnosis → Remediation → Reporting</text>
  
  <!-- TRIGGER -->
  <rect x="50" y="100" width="160" height="70" fill="#ffcccc" stroke="#cc0000" stroke-width="2" rx="5"/>
  <text x="130" y="130" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">Crawler Error</text>
  <text x="130" y="150" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#666">Timeout, 429, 403, etc.</text>
  
  <!-- Arrow to Service -->
  <path d="M 210 135 L 270 135" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- SELF HEALING SERVICE -->
  <rect x="270" y="90" width="200" height="90" fill="#d4e5f7" stroke="#333" stroke-width="2" rx="5"/>
  <text x="370" y="120" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">SelfHealingService</text>
  <text x="370" y="140" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#555">Main orchestration</text>
  <text x="370" y="160" text-anchor="middle" font-family="Segoe UI Mono, monospace" font-size="8" fill="#888">src/core/crawler/healing/</text>
  
  <!-- Arrow to Diagnosis -->
  <path d="M 470 135 L 530 135" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- PHASE 1: DIAGNOSIS -->
  <rect x="530" y="90" width="340" height="300" fill="#fff4d4" stroke="#cc9900" stroke-width="2" rx="8"/>
  <text x="700" y="115" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">Phase 1: Diagnosis</text>
  <text x="700" y="132" text-anchor="middle" font-family="Segoe UI Mono, monospace" font-size="9" fill="#666">DiagnosticEngine.js</text>
  
  <!-- Failure Types -->
  <text x="550" y="160" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" fill="#666">Failure Types:</text>
  
  <rect x="550" y="170" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="620" y="192" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">RATE_LIMITED</text>
  
  <rect x="710" y="170" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="780" y="192" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">BLOCKED</text>
  
  <rect x="550" y="215" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="620" y="237" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">TIMEOUT</text>
  
  <rect x="710" y="215" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="780" y="237" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">PROXY_FAILURE</text>
  
  <rect x="550" y="260" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="620" y="282" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">NETWORK_ERROR</text>
  
  <rect x="710" y="260" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="780" y="282" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">CONTENT_MISMATCH</text>
  
  <rect x="550" y="305" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="620" y="327" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">CAPTCHA</text>
  
  <rect x="710" y="305" width="140" height="35" fill="#fff" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="780" y="327" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">UNKNOWN</text>
  
  <!-- Diagnostic output -->
  <rect x="550" y="350" width="300" height="30" fill="#ffe0b2" stroke="#cc9900" stroke-width="1" rx="3"/>
  <text x="700" y="370" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">diagnosis: { failureType, severity, context }</text>
  
  <!-- Arrow to Remediation -->
  <path d="M 870 240 L 920 240" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- PHASE 2: REMEDIATION -->
  <rect x="920" y="90" width="420" height="300" fill="#d4f0d4" stroke="#2d6a2d" stroke-width="2" rx="8"/>
  <text x="1130" y="115" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">Phase 2: Remediation</text>
  <text x="1130" y="132" text-anchor="middle" font-family="Segoe UI Mono, monospace" font-size="9" fill="#666">RemediationStrategies.js</text>
  
  <!-- Strategies -->
  <text x="940" y="160" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" fill="#2d6a2d">Remediation Strategies:</text>
  
  <rect x="940" y="170" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1030" y="190" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Rate Limit Backoff</text>
  <text x="1030" y="205" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Exponential delay</text>
  
  <rect x="1140" y="170" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1230" y="190" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Proxy Rotation</text>
  <text x="1230" y="205" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Switch to fresh proxy</text>
  
  <rect x="940" y="225" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1030" y="245" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Puppeteer Fallback</text>
  <text x="1030" y="260" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Switch to headless browser</text>
  
  <rect x="1140" y="225" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1230" y="245" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Domain Cooldown</text>
  <text x="1230" y="260" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Pause domain requests</text>
  
  <rect x="940" y="280" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1030" y="300" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Header Adjustment</text>
  <text x="1030" y="315" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Modify request headers</text>
  
  <rect x="1140" y="280" width="180" height="45" fill="#fff" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1230" y="300" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">Skip &amp; Log</text>
  <text x="1230" y="315" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Unrecoverable → skip URL</text>
  
  <!-- Remediation output -->
  <rect x="940" y="340" width="380" height="40" fill="#c8e6c8" stroke="#2d6a2d" stroke-width="1" rx="3"/>
  <text x="1130" y="358" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">remediation: { retry, delayMs, strategy, context }</text>
  <text x="1130" y="373" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Returns whether to retry and how</text>
  
  <!-- PHASE 3: REPORTING -->
  <rect x="50" y="450" width="440" height="170" fill="#e8e8f8" stroke="#5555cc" stroke-width="2" rx="8"/>
  <text x="270" y="475" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">Phase 3: Reporting</text>
  <text x="270" y="492" text-anchor="middle" font-family="Segoe UI Mono, monospace" font-size="9" fill="#666">HealingReport.js</text>
  
  <rect x="70" y="510" width="180" height="40" fill="#fff" stroke="#5555cc" stroke-width="1" rx="3"/>
  <text x="160" y="535" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Log healing attempt</text>
  
  <rect x="270" y="510" width="200" height="40" fill="#fff" stroke="#5555cc" stroke-width="1" rx="3"/>
  <text x="370" y="535" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Track failure patterns</text>
  
  <rect x="70" y="560" width="180" height="40" fill="#fff" stroke="#5555cc" stroke-width="1" rx="3"/>
  <text x="160" y="585" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Update domain health</text>
  
  <rect x="270" y="560" width="200" height="40" fill="#fff" stroke="#5555cc" stroke-width="1" rx="3"/>
  <text x="370" y="585" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" fill="#333">Emit events for telemetry</text>
  
  <!-- Arrow from remediation to reporting -->
  <path d="M 1130 390 L 1130 420 L 270 420 L 270 450" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- EXTERNAL SERVICES -->
  <rect x="530" y="450" width="340" height="170" fill="#f0e8f0" stroke="#884488" stroke-width="2" rx="8"/>
  <text x="700" y="475" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">External Service Integration</text>
  
  <rect x="550" y="500" width="140" height="45" fill="#fff" stroke="#884488" stroke-width="1" rx="3"/>
  <text x="620" y="520" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">ProxyManager</text>
  <text x="620" y="535" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Proxy pool rotation</text>
  
  <rect x="710" y="500" width="140" height="45" fill="#fff" stroke="#884488" stroke-width="1" rx="3"/>
  <text x="780" y="520" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">RateLimitTracker</text>
  <text x="780" y="535" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Per-domain rate limits</text>
  
  <rect x="550" y="560" width="140" height="45" fill="#fff" stroke="#884488" stroke-width="1" rx="3"/>
  <text x="620" y="580" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">PuppeteerDomainMgr</text>
  <text x="620" y="595" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Headless browser pool</text>
  
  <rect x="710" y="560" width="140" height="45" fill="#fff" stroke="#884488" stroke-width="1" rx="3"/>
  <text x="780" y="580" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="500" fill="#333">DomainHealthTracker</text>
  <text x="780" y="595" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">Domain status tracking</text>
  
  <!-- OUTCOME -->
  <rect x="920" y="450" width="420" height="170" fill="#e3e3e3" stroke="#333" stroke-width="2" rx="8"/>
  <text x="1130" y="475" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" fill="#333">Outcome</text>
  
  <!-- Outcome Decision -->
  <polygon points="1040,520 1090,490 1140,520 1090,550" fill="#fff4d4" stroke="#333" stroke-width="2"/>
  <text x="1090" y="525" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" fill="#333">Retry?</text>
  
  <!-- Yes path -->
  <path d="M 1140 520 L 1200 520" stroke="#2d6a2d" stroke-width="2" fill="none"/>
  <text x="1165" y="512" font-family="Segoe UI, sans-serif" font-size="9" fill="#2d6a2d">Yes</text>
  <rect x="1200" y="495" width="120" height="50" fill="#d4f0d4" stroke="#2d6a2d" stroke-width="2" rx="5"/>
  <text x="1260" y="518" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" fill="#333">Retry Request</text>
  <text x="1260" y="535" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="8" fill="#666">After delayMs</text>
  
  <!-- No path -->
  <path d="M 1090 550 L 1090 580" stroke="#cc0000" stroke-width="2" fill="none"/>
  <text x="1100" y="565" font-family="Segoe UI, sans-serif" font-size="9" fill="#cc0000">No</text>
  <rect x="1020" y="580" width="140" height="35" fill="#ffcccc" stroke="#cc0000" stroke-width="2" rx="5"/>
  <text x="1090" y="603" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" fill="#333">Skip URL / Abort</text>
  
  <!-- Module Legend -->
  <rect x="50" y="660" width="1290" height="100" fill="#fafafa" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="700" y="685" text-anchor="middle" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" fill="#333">Key Module Paths</text>
  
  <text x="100" y="715" font-family="Segoe UI Mono, monospace" font-size="10" fill="#555">Healing:  src/core/crawler/healing/ (SelfHealingService.js, DiagnosticEngine.js, RemediationStrategies.js, HealingReport.js)</text>
  <text x="100" y="735" font-family="Segoe UI Mono, monospace" font-size="10" fill="#884488">Services: ProxyManager, RateLimitTracker, PuppeteerDomainManager, DomainHealthTracker</text>
  <text x="100" y="755" font-family="Segoe UI Mono, monospace" font-size="10" fill="#666">Events:   healing:attempt, healing:success, healing:failure, healing:skip</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333"/>
    </marker>
  </defs>
</svg>