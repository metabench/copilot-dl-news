<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900" width="1400" height="900">
	<title>UI Progress from Server Observables — Plan</title>
	<desc>Plan for observable-driven crawl telemetry over SSE into jsgui3 UI controls (ProgressBar).</desc>

	<defs>
		<linearGradient id="obsidianGrad" x1="0%" y1="0%" x2="0%" y2="100%">
			<stop offset="0%" style="stop-color:#0d1320"/>
			<stop offset="100%" style="stop-color:#0a0f1a"/>
		</linearGradient>

		<linearGradient id="cardGrad" x1="0%" y1="0%" x2="0%" y2="100%">
			<stop offset="0%" style="stop-color:#1e232c"/>
			<stop offset="100%" style="stop-color:#14181f"/>
		</linearGradient>

		<linearGradient id="cardGradDeep" x1="0%" y1="0%" x2="0%" y2="100%">
			<stop offset="0%" style="stop-color:#141b26"/>
			<stop offset="100%" style="stop-color:#0f1520"/>
		</linearGradient>

		<filter id="softShadow" x="-10%" y="-10%" width="120%" height="125%">
			<feDropShadow dx="2" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.55"/>
		</filter>

		<marker id="arrowSlate" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
			<path d="M0,0 L0,6 L9,3 z" fill="#94a3b8"/>
		</marker>

		<marker id="arrowGold" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
			<path d="M0,0 L0,6 L9,3 z" fill="#c9a227"/>
		</marker>

		<pattern id="grid" width="44" height="44" patternUnits="userSpaceOnUse">
			<path d="M 44 0 L 0 0 0 44" fill="none" stroke="#c9a227" stroke-width="0.35" opacity="0.07"/>
		</pattern>

		<style>
			.title { font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif; font-size: 30px; font-weight: 800; fill: #e2e8f0; letter-spacing: -0.5px; }
			.subtitle { font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif; font-size: 13px; fill: #94a3b8; }
			.section { font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif; font-size: 14px; font-weight: 750; fill: #c9a227; letter-spacing: 1.3px; text-transform: uppercase; }
			.card-title { font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif; font-size: 15px; font-weight: 750; fill: #e2e8f0; }
			.text { font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif; font-size: 12px; fill: #a9b7c8; }
			.code { font-family: ui-monospace, "JetBrains Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 11px; fill: #94a3b8; }

			.header { fill: url(#cardGrad); stroke: #2d3548; stroke-width: 1; }
			.card { fill: url(#cardGrad); stroke: #2d3548; stroke-width: 1; }
			.card-deep { fill: url(#cardGradDeep); stroke: #2d3548; stroke-width: 1; }
			.card-gold { fill: url(#cardGradDeep); stroke: #c9a227; stroke-width: 1.8; }

			.flow { stroke: #94a3b8; stroke-width: 1.7; opacity: 0.85; fill: none; marker-end: url(#arrowSlate); }
			.flow-gold { stroke: #c9a227; stroke-width: 2; opacity: 0.95; fill: none; marker-end: url(#arrowGold); }
		</style>
	</defs>

	<!-- Background -->
	<rect width="1400" height="900" fill="url(#obsidianGrad)"/>
	<rect width="1400" height="900" fill="url(#grid)"/>

	<!-- Header (no rivets; avoids strict collision noise) -->
	<g filter="url(#softShadow)">
		<rect x="30" y="20" width="1340" height="78" rx="10" class="header"/>
		<text x="60" y="54" class="title">UI Progress from Server Observables — Plan</text>
		<text x="60" y="78" class="subtitle">Envelope + SSE + adapter contract proven in labs; next is production hardening</text>
	</g>

	<!-- Flow -->
	<text x="30" y="148" class="section">Flow</text>
	<text x="30" y="172" class="code">contract: { type: "crawl:telemetry", data, timestampMs }</text>

	<!-- Row 1 cards -->
	<g filter="url(#softShadow)">
		<rect x="30" y="200" width="210" height="140" rx="12" class="card-deep"/>
		<text x="46" y="230" class="card-title">Crawler / Observable</text>
		<text x="46" y="256" class="text">Emits crawl:* events</text>
		<text x="46" y="282" class="code">crawl:started</text>
		<text x="46" y="300" class="code">crawl:progress</text>
		<text x="46" y="318" class="code">crawl:stopped</text>

		<rect x="270" y="200" width="240" height="140" rx="12" class="card"/>
		<text x="286" y="230" class="card-title">CrawlTelemetryBridge</text>
		<text x="286" y="256" class="text">Normalize + batch</text>
		<text x="286" y="276" class="text">State + history</text>
		<text x="286" y="296" class="text">Fanout subscribers</text>

		<rect x="540" y="200" width="250" height="140" rx="12" class="card-gold"/>
		<text x="556" y="230" class="card-title">TelemetryIntegration</text>
		<text x="556" y="256" class="text">SSE endpoint</text>
		<text x="556" y="282" class="code">GET /telemetry (prod)</text>
		<text x="556" y="302" class="text">Wrap in stable envelope</text>

		<rect x="820" y="200" width="230" height="140" rx="12" class="card"/>
		<text x="836" y="230" class="card-title">Browser EventSource</text>
		<text x="836" y="256" class="text">Receives SSE</text>
		<text x="836" y="276" class="text">Parses JSON</text>
		<text x="836" y="296" class="text">Calls adapter</text>

		<rect x="1080" y="200" width="290" height="140" rx="12" class="card"/>
		<text x="1096" y="230" class="card-title">createCrawlDisplayAdapter</text>
		<text x="1096" y="256" class="text">handleEvent(crawl:*)</text>
		<text x="1096" y="276" class="text">onProgress(0..1)</text>
		<text x="1096" y="296" class="text">onPhase / onStatus / onError</text>
	</g>

	<!-- Row 1 arrows (kept in whitespace gaps; no overlap with card rects) -->
	<path class="flow" d="M246 270 H264"/>
	<path class="flow" d="M516 270 H534"/>
	<path class="flow-gold" d="M796 270 H814"/>
	<path class="flow" d="M1056 270 H1074"/>

	<!-- UI -->
	<text x="30" y="416" class="section">UI</text>
	<text x="30" y="440" class="code">rule: indeterminate until first progress is known</text>

	<g filter="url(#softShadow)">
		<rect x="820" y="470" width="260" height="120" rx="12" class="card-deep"/>
		<text x="836" y="500" class="card-title">ProgressBarControl</text>
		<text x="836" y="526" class="text">indeterminate ↔ determinate</text>
		<text x="836" y="552" class="code">setValue(0.2)</text>

		<rect x="1110" y="470" width="260" height="120" rx="12" class="card-deep"/>
		<text x="1126" y="500" class="card-title">MVVM binding</text>
		<text x="1126" y="526" class="text">adapter callbacks → UI</text>
		<text x="1126" y="552" class="code">onProgress(p)</text>
	</g>

	<path class="flow" d="M1230 346 V460"/>
	<path class="flow" d="M1086 530 H1104"/>

	<!-- Checkpoints -->
	<text x="30" y="660" class="section">Checkpoints</text>

	<g filter="url(#softShadow)">
		<rect x="30" y="690" width="420" height="160" rx="12" class="card"/>
		<text x="46" y="720" class="card-title">Proof: Lab 027</text>
		<text x="46" y="746" class="text">Express SSE + jsgui3 page</text>
		<text x="46" y="772" class="code">E2E: SSE → adapter → ProgressBar</text>

		<rect x="490" y="690" width="420" height="160" rx="12" class="card-gold"/>
		<text x="506" y="720" class="card-title">Proof: Lab 028</text>
		<text x="506" y="746" class="text">SSE hosted on jsgui3-server</text>
		<text x="506" y="772" class="code">router.set_route("/events", …)</text>

		<rect x="950" y="690" width="420" height="160" rx="12" class="card"/>
		<text x="966" y="720" class="card-title">Next</text>
		<text x="966" y="746" class="text">Adopt envelope + adapter in prod</text>
		<text x="966" y="768" class="text">Add SSE helper (replay buffer)</text>
		<text x="966" y="790" class="text">Reduce activation warning noise</text>
	</g>
</svg>