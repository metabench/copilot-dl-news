[
  {
    "file": "src/ui/render-url-table.js",
    "startLine": 1,
    "endLine": 67,
    "replacement": "\"use strict\";\r\n\r\nconst fs = require(\"fs\");\r\nconst path = require(\"path\");\r\nconst jsgui = require(\"jsgui3-html\");\r\n\r\nconst { openNewsDb } = require(\"../db/dbAccess\");\r\nconst { findProjectRoot } = require(\"../utils/project-root\");\r\nconst { selectInitialUrls, countUrls } = require(\"../db/sqlite/v1/queries/ui/urlListingNormalized\");\r\nconst {\r\n  UrlListingTableControl,\r\n  buildColumns,\r\n  buildDisplayRows,\r\n  buildIndexCell,\r\n  formatDateTime\r\n} = require(\"./controls/UrlListingTable\");\r\nconst { PagerButtonControl } = require(\"./controls/PagerButton\");\r\nconst { SparklineControl } = require(\"./controls\");\r\nconst { UrlFilterToggleControl } = require(\"./controls/UrlFilterToggle\");\r\nconst { buildHomeCards } = require(\"./homeCards\");\r\nconst { createHomeCardLoaders } = require(\"./homeCardData\");\r\n\r\nconst StringControl = jsgui.String_Control;\r\n\r\nconst DOMAIN_WINDOW_SIZE = 4000;\r\nconst DOMAIN_LIMIT = 40;\r\nconst HOME_CARD_CRAWL_LIMIT = 12;\r\nconst HOME_CARD_ERROR_LIMIT = 50;\r\n\r\nfunction parseArgs(argv) {\r\n  const args = {};\r\n  const normalized = Array.isArray(argv) ? argv.slice() : [];\r\n  for (let i = 0; i < normalized.length; i += 1) {\r\n    const token = normalized[i];\r\n    if (!token) continue;\r\n    switch (token) {\r\n      case \"--db\":\r\n      case \"-d\":\r\n        args.db = normalized[++i];\r\n        break;\r\n      case \"--limit\":\r\n      case \"-l\":\r\n        args.limit = Number(normalized[++i]);\r\n        break;\r\n      case \"--output\":\r\n      case \"-o\":\r\n        args.output = normalized[++i];\r\n        break;\r\n      case \"--title\":\r\n        args.title = normalized[++i];\r\n        break;\r\n      default:\r\n        if (token.startsWith(\"--\")) {\r\n          const [key, value] = token.split(\"=\");\r\n          if (key === \"--db\" && value) args.db = value;\r\n          if (key === \"--limit\" && value) args.limit = Number(value);\r\n          if (key === \"--output\" && value) args.output = value;\r\n          if (key === \"--title\" && value) args.title = value;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  return args;\r\n}\r\n\r\nfunction resolveDbPath(cliPath) {\r\n  const projectRoot = findProjectRoot(__dirname);\r\n  if (cliPath) {\r\n    return path.isAbsolute(cliPath) ? cliPath : path.resolve(process.cwd(), cliPath);\r\n  }\r\n  return path.join(projectRoot, \"data\", \"news.db\");\r\n}\r\n\r\nfunction buildUrlTotals(dbHandle) {\r\n  if (!dbHandle) return null;\r\n  try {\r\n    const totalRows = countUrls(dbHandle);\r\n    return {\r\n      source: \"live\",\r\n      totalRows,\r\n      cache: null\r\n    };\r\n  } catch (_) {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction buildCliHomeCards(dbHandle, totals) {\r\n  if (!dbHandle) {\r\n    return buildHomeCards({ totals });\r\n  }\r\n  try {\r\n    const loaders = createHomeCardLoaders({\r\n      db: dbHandle,\r\n      domainWindowSize: DOMAIN_WINDOW_SIZE,\r\n      domainLimit: DOMAIN_LIMIT,\r\n      crawlLimit: HOME_CARD_CRAWL_LIMIT,\r\n      errorLimit: HOME_CARD_ERROR_LIMIT\r\n    });\r\n    return buildHomeCards({ totals, loaders });\r\n  } catch (_) {\r\n    return buildHomeCards({ totals });\r\n  }\r\n}\r\n"
  },
  {
    "file": "src/ui/render-url-table.js",
    "startLine": 706,
    "endLine": 742,
    "replacement": "async function main() {\r\n  const args = parseArgs(process.argv.slice(2));\r\n  const dbPath = resolveDbPath(args.db);\r\n  const limit = Number.isFinite(args.limit) && args.limit > 0 ? Math.min(args.limit, 5000) : 1000;\r\n  const title = args.title || \"Crawler URL Snapshot\";\r\n  const db = openNewsDb(dbPath);\r\n  let rawRows = [];\r\n  let totals = null;\r\n  let homeCards = [];\r\n  try {\r\n    rawRows = selectInitialUrls(db.db, { limit });\r\n    totals = buildUrlTotals(db.db);\r\n    homeCards = buildCliHomeCards(db.db, totals);\r\n  } finally {\r\n    try {\r\n      db.close();\r\n    } catch (_) {}\r\n  }\r\n\r\n  const columns = buildColumns();\r\n  const rows = buildDisplayRows(rawRows);\r\n  const projectRoot = findProjectRoot(__dirname);\r\n  const relativeDb = path.relative(projectRoot, dbPath) || path.basename(dbPath);\r\n  const meta = {\r\n    rowCount: rows.length,\r\n    limit,\r\n    dbLabel: relativeDb,\r\n    generatedAt: formatDateTime(new Date(), true),\r\n    subtitle: `First ${rows.length} URLs from ${relativeDb}`\r\n  };\r\n\r\n  const html = renderHtml({ columns, rows, meta, title }, { homeCards });\r\n\r\n  if (args.output) {\r\n    const target = path.isAbsolute(args.output) ? args.output : path.resolve(process.cwd(), args.output);\r\n    fs.writeFileSync(target, html, \"utf8\");\r\n    console.error(`Saved HTML table to ${target}`);\r\n  } else {\r\n    process.stdout.write(html);\r\n  }\r\n}\r\n"
  }
]