"\"use strict\";\r\n\r\nconst fs = require(\"fs\");\r\nconst path = require(\"path\");\r\nconst jsgui = require(\"jsgui3-html\");\r\n\r\nconst { openNewsDb } = require(\"../db/dbAccess\");\r\nconst { findProjectRoot } = require(\"../utils/project-root\");\r\nconst { selectInitialUrls, countUrls } = require(\"../db/sqlite/v1/queries/ui/urlListingNormalized\");\r\nconst {\r\n  UrlListingTableControl,\r\n  buildColumns,\r\n  buildDisplayRows,\r\n  buildIndexCell,\r\n  formatDateTime\r\n} = require(\"./controls/UrlListingTable\");\r\nconst { PagerButtonControl } = require(\"./controls/PagerButton\");\r\nconst { SparklineControl } = require(\"./controls\");\r\nconst { UrlFilterToggleControl } = require(\"./controls/UrlFilterToggle\");\r\nconst { buildHomeCards } = require(\"./homeCards\");\r\nconst { createHomeCardLoaders } = require(\"./homeCardData\");\r\n\r\nconst StringControl = jsgui.String_Control;\r\n\r\nconst DOMAIN_WINDOW_SIZE = 4000;\r\nconst DOMAIN_LIMIT = 40;\r\nconst HOME_CARD_CRAWL_LIMIT = 12;\r\nconst HOME_CARD_ERROR_LIMIT = 50;\r\n\r\nfunction parseArgs(argv) {\r\n  const args = {};\r\n  const normalized = Array.isArray(argv) ? argv.slice() : [];\r\n  for (let i = 0; i < normalized.length; i += 1) {\r\n    const token = normalized[i];\r\n    if (!token) continue;\r\n    switch (token) {\r\n      case \"--db\":\r\n      case \"-d\":\r\n        args.db = normalized[++i];\r\n        break;\r\n      case \"--limit\":\r\n      case \"-l\":\r\n        args.limit = Number(normalized[++i]);\r\n        break;\r\n      case \"--output\":\r\n      case \"-o\":\r\n        args.output = normalized[++i];\r\n        break;\r\n      case \"--title\":\r\n        args.title = normalized[++i];\r\n        break;\r\n      default:\r\n        if (token.startsWith(\"--\")) {\r\n          const [key, value] = token.split(\"=\");\r\n          if (key === \"--db\" && value) args.db = value;\r\n          if (key === \"--limit\" && value) args.limit = Number(value);\r\n          if (key === \"--output\" && value) args.output = value;\r\n          if (key === \"--title\" && value) args.title = value;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  return args;\r\n}\r\n\r\nfunction resolveDbPath(cliPath) {\r\n  const projectRoot = findProjectRoot(__dirname);\r\n  if (cliPath) {\r\n    return path.isAbsolute(cliPath) ? cliPath : path.resolve(process.cwd(), cliPath);\r\n  }\r\n  return path.join(projectRoot, \"data\", \"news.db\");\r\n}\r\n\r\nfunction buildUrlTotals(dbHandle) {\r\n  if (!dbHandle) return null;\r\n  try {\r\n    const totalRows = countUrls(dbHandle);\r\n    return {\r\n      source: \"live\",\r\n      totalRows,\r\n      cache: null\r\n    };\r\n  } catch (_) {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction buildCliHomeCards(dbHandle, totals) {\r\n  if (!dbHandle) {\r\n    return buildHomeCards({ totals });\r\n  }\r\n  try {\r\n    const loaders = createHomeCardLoaders({\r\n      db: dbHandle,\r\n      domainWindowSize: DOMAIN_WINDOW_SIZE,\r\n      domainLimit: DOMAIN_LIMIT,\r\n      crawlLimit: HOME_CARD_CRAWL_LIMIT,\r\n      errorLimit: HOME_CARD_ERROR_LIMIT\r\n    });\r\n    return buildHomeCards({ totals, loaders });\r\n  } catch (_) {\r\n    return buildHomeCards({ totals });\r\n  }\r\n}\r\n"