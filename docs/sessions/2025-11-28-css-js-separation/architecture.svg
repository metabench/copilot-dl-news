<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <!-- Gradients -->
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0d1117"/>
      <stop offset="100%" style="stop-color:#161b22"/>
    </linearGradient>
    <linearGradient id="sourceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#238636"/>
      <stop offset="100%" style="stop-color:#1a5e2a"/>
    </linearGradient>
    <linearGradient id="buildGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#58a6ff"/>
      <stop offset="100%" style="stop-color:#1f6feb"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f0883e"/>
      <stop offset="100%" style="stop-color:#bd561d"/>
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b949e"/>
      <stop offset="100%" style="stop-color:#6e7681"/>
    </linearGradient>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#58a6ff"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f0883e"/>
    </marker>
    
    <!-- Drop shadow -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="3" flood-opacity="0.4"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="100%" height="100%" fill="url(#bgGrad)"/>
  
  <!-- Title -->
  <text x="600" y="45" text-anchor="middle" fill="#e6edf3" font-size="28" font-weight="bold">
    CSS/JS Separation Architecture
  </text>
  <text x="600" y="70" text-anchor="middle" fill="#8b949e" font-size="14">
    Build-time extraction using esbuild + AST-based CSS separator
  </text>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PHASE 1: Source Files (Left) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <text x="140" y="110" text-anchor="middle" fill="#238636" font-size="16" font-weight="bold">
    ğŸ“ SOURCE FILES
  </text>
  
  <!-- Control with embedded CSS -->
  <g transform="translate(30, 130)" filter="url(#shadow)">
    <rect width="220" height="180" rx="8" fill="#161b22" stroke="#238636" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#sourceGrad)"/>
    <rect y="30" width="220" height="0" fill="url(#sourceGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      DatabaseSelector.js
    </text>
    <text x="15" y="55" fill="#8b949e" font-size="10">class DatabaseSelector {</text>
    <text x="25" y="70" fill="#7ee787" font-size="10">  compose() { ... }</text>
    <text x="15" y="85" fill="#8b949e" font-size="10">}</text>
    <text x="15" y="105" fill="#ff7b72" font-size="10" font-weight="bold">
      DatabaseSelector.css = `
    </text>
    <text x="25" y="120" fill="#a5d6ff" font-size="10">  .db-selector { ... }</text>
    <text x="25" y="135" fill="#a5d6ff" font-size="10">  .db-item { ... }</text>
    <text x="15" y="150" fill="#ff7b72" font-size="10" font-weight="bold">`;</text>
    <text x="110" y="170" text-anchor="middle" fill="#6e7681" font-size="9" font-style="italic">
      Embedded CSS in static property
    </text>
  </g>
  
  <!-- Server with embedded styles -->
  <g transform="translate(30, 330)" filter="url(#shadow)">
    <rect width="220" height="150" rx="8" fill="#161b22" stroke="#238636" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#sourceGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      geoImportServer.js
    </text>
    <text x="15" y="55" fill="#ff7b72" font-size="10" font-weight="bold">function getStyles() {</text>
    <text x="25" y="70" fill="#a5d6ff" font-size="10">  return `</text>
    <text x="35" y="85" fill="#a5d6ff" font-size="10">:root { --bg: #0d1117 }</text>
    <text x="35" y="100" fill="#a5d6ff" font-size="10">.dashboard { ... }</text>
    <text x="25" y="115" fill="#a5d6ff" font-size="10">  `;</text>
    <text x="15" y="130" fill="#ff7b72" font-size="10">}</text>
    <text x="110" y="145" text-anchor="middle" fill="#6e7681" font-size="9" font-style="italic">
      Inline CSS in server file
    </text>
  </g>
  
  <!-- Client script inline -->
  <g transform="translate(30, 500)" filter="url(#shadow)">
    <rect width="220" height="130" rx="8" fill="#161b22" stroke="#238636" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#sourceGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      Inline Client JS
    </text>
    <text x="15" y="55" fill="#ff7b72" font-size="10" font-weight="bold">function getClientScript() {</text>
    <text x="25" y="70" fill="#a5d6ff" font-size="10">  return `</text>
    <text x="35" y="85" fill="#7ee787" font-size="10">function initUI() {...}</text>
    <text x="35" y="100" fill="#7ee787" font-size="10">eventSource.on(...)</text>
    <text x="25" y="115" fill="#a5d6ff" font-size="10">  `;</text>
  </g>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PHASE 2: Build Process (Center) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <text x="540" y="110" text-anchor="middle" fill="#58a6ff" font-size="16" font-weight="bold">
    âš™ï¸ BUILD PROCESS
  </text>
  
  <!-- esbuild box -->
  <g transform="translate(410, 130)" filter="url(#shadow)">
    <rect width="260" height="100" rx="8" fill="#161b22" stroke="#58a6ff" stroke-width="2"/>
    <rect width="260" height="30" rx="8" fill="url(#buildGrad)"/>
    <text x="130" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ“¦ esbuild Bundle
    </text>
    <text x="20" y="55" fill="#7ee787" font-size="11">â€¢ Entry: src/ui/client/index.js</text>
    <text x="20" y="75" fill="#7ee787" font-size="11">â€¢ Bundle all controls</text>
    <text x="20" y="95" fill="#7ee787" font-size="11">â€¢ platform: browser, format: iife</text>
  </g>
  
  <!-- CSS Extractor box -->
  <g transform="translate(410, 250)" filter="url(#shadow)">
    <rect width="260" height="160" rx="8" fill="#161b22" stroke="#58a6ff" stroke-width="2"/>
    <rect width="260" height="30" rx="8" fill="url(#buildGrad)"/>
    <text x="130" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ”¬ CSS Extractor (AST)
    </text>
    <text x="20" y="55" fill="#f0883e" font-size="11" font-weight="bold">Pattern Detection:</text>
    <text x="30" y="75" fill="#a5d6ff" font-size="10">ClassName.css = `...`</text>
    <text x="30" y="90" fill="#a5d6ff" font-size="10">ClassName.getStyles()</text>
    <text x="20" y="115" fill="#f0883e" font-size="11" font-weight="bold">Process:</text>
    <text x="30" y="132" fill="#7ee787" font-size="10">1. Parse JS â†’ AST (esbuild)</text>
    <text x="30" y="147" fill="#7ee787" font-size="10">2. Find .css assignments</text>
    <text x="30" y="162" fill="#7ee787" font-size="10">3. Extract â†’ CSS file</text>
    <text x="30" y="177" fill="#7ee787" font-size="10">4. Remove from JS</text>
  </g>
  
  <!-- File watcher -->
  <g transform="translate(410, 430)" filter="url(#shadow)">
    <rect width="260" height="80" rx="8" fill="#161b22" stroke="#58a6ff" stroke-width="2"/>
    <rect width="260" height="30" rx="8" fill="url(#buildGrad)"/>
    <text x="130" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ‘ï¸ Watch Mode (Dev)
    </text>
    <text x="20" y="55" fill="#7ee787" font-size="11">â€¢ Incremental rebuilds</text>
    <text x="20" y="75" fill="#7ee787" font-size="11">â€¢ Hash-based cache invalidation</text>
  </g>
  
  <!-- Separate CSS files box -->
  <g transform="translate(410, 530)" filter="url(#shadow)">
    <rect width="260" height="100" rx="8" fill="#161b22" stroke="#58a6ff" stroke-width="2"/>
    <rect width="260" height="30" rx="8" fill="url(#buildGrad)"/>
    <text x="130" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ“„ External CSS Files
    </text>
    <text x="20" y="55" fill="#a5d6ff" font-size="11">DatabaseSelector.css</text>
    <text x="20" y="72" fill="#a5d6ff" font-size="11">geoImport.css</text>
    <text x="20" y="89" fill="#8b949e" font-size="10" font-style="italic">
      Stored alongside controls in src/
    </text>
  </g>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PHASE 3: Output Files (Right Top) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <text x="920" y="110" text-anchor="middle" fill="#f0883e" font-size="16" font-weight="bold">
    ğŸ“¤ OUTPUT FILES
  </text>
  
  <!-- Built CSS -->
  <g transform="translate(790, 130)" filter="url(#shadow)">
    <rect width="220" height="90" rx="8" fill="#161b22" stroke="#f0883e" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#outputGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ¨ controls.css
    </text>
    <text x="15" y="55" fill="#7ee787" font-size="11">â€¢ All control CSS combined</text>
    <text x="15" y="75" fill="#7ee787" font-size="11">â€¢ Minified in production</text>
  </g>
  
  <!-- Built JS -->
  <g transform="translate(790, 240)" filter="url(#shadow)">
    <rect width="220" height="90" rx="8" fill="#161b22" stroke="#f0883e" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#outputGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸ“œ ui-client.js
    </text>
    <text x="15" y="55" fill="#7ee787" font-size="11">â€¢ All client JS bundled</text>
    <text x="15" y="75" fill="#7ee787" font-size="11">â€¢ CSS removed (extracted)</text>
  </g>
  
  <!-- Server styles file -->
  <g transform="translate(790, 350)" filter="url(#shadow)">
    <rect width="220" height="90" rx="8" fill="#161b22" stroke="#f0883e" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#outputGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      ğŸŒ dashboard.css
    </text>
    <text x="15" y="55" fill="#7ee787" font-size="11">â€¢ Server-specific styles</text>
    <text x="15" y="75" fill="#7ee787" font-size="11">â€¢ Loaded from disk at runtime</text>
  </g>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PHASE 4: Express Server (Right Bottom) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <text x="920" y="480" text-anchor="middle" fill="#8b949e" font-size="16" font-weight="bold">
    ğŸ–¥ï¸ EXPRESS SERVER
  </text>
  
  <!-- Server serving files -->
  <g transform="translate(790, 500)" filter="url(#shadow)">
    <rect width="220" height="150" rx="8" fill="#161b22" stroke="#8b949e" stroke-width="2"/>
    <rect width="220" height="30" rx="8" fill="url(#serverGrad)"/>
    <text x="110" y="21" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
      Static File Serving
    </text>
    <text x="15" y="55" fill="#58a6ff" font-size="11">/assets/controls.css</text>
    <text x="15" y="72" fill="#58a6ff" font-size="11">/assets/ui-client.js</text>
    <text x="15" y="89" fill="#58a6ff" font-size="11">/css/dashboard.css</text>
    <text x="15" y="115" fill="#8b949e" font-size="10">HTML &lt;link&gt; and &lt;script&gt;</text>
    <text x="15" y="130" fill="#8b949e" font-size="10">tags reference these files</text>
  </g>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- Arrows showing data flow -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <!-- Source â†’ Build -->
  <path d="M 250 220 Q 330 220 400 175" fill="none" stroke="#58a6ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 250 405 Q 350 370 400 320" fill="none" stroke="#58a6ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 250 565 Q 350 530 400 480" fill="none" stroke="#58a6ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Build â†’ Output -->
  <path d="M 670 175 L 780 175" fill="none" stroke="#f0883e" stroke-width="2" marker-end="url(#arrowOrange)"/>
  <path d="M 670 280 L 780 280" fill="none" stroke="#f0883e" stroke-width="2" marker-end="url(#arrowOrange)"/>
  <path d="M 670 580 L 780 395" fill="none" stroke="#f0883e" stroke-width="2" marker-end="url(#arrowOrange)"/>
  
  <!-- Output â†’ Server -->
  <path d="M 900 220 L 900 230 Q 900 240 900 250" fill="none" stroke="#8b949e" stroke-width="2" stroke-dasharray="5,3"/>
  <path d="M 900 330 L 900 340 Q 900 350 900 360" fill="none" stroke="#8b949e" stroke-width="2" stroke-dasharray="5,3"/>
  <path d="M 900 440 L 900 490" fill="none" stroke="#8b949e" stroke-width="2" stroke-dasharray="5,3"/>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- Legend -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  
  <g transform="translate(30, 680)">
    <rect width="1140" height="110" rx="8" fill="#21262d" stroke="#30363d" stroke-width="1"/>
    <text x="570" y="25" text-anchor="middle" fill="#e6edf3" font-size="14" font-weight="bold">
      Migration Strategy
    </text>
    
    <!-- Phase boxes -->
    <g transform="translate(30, 40)">
      <rect width="250" height="55" rx="6" fill="#238636" fill-opacity="0.2" stroke="#238636"/>
      <text x="125" y="20" text-anchor="middle" fill="#7ee787" font-size="11" font-weight="bold">Phase 1: Extract</text>
      <text x="125" y="38" text-anchor="middle" fill="#8b949e" font-size="10">Move CSS to .css files</text>
      <text x="125" y="50" text-anchor="middle" fill="#8b949e" font-size="10">alongside controls</text>
    </g>
    
    <g transform="translate(300, 40)">
      <rect width="250" height="55" rx="6" fill="#58a6ff" fill-opacity="0.2" stroke="#58a6ff"/>
      <text x="125" y="20" text-anchor="middle" fill="#58a6ff" font-size="11" font-weight="bold">Phase 2: Build</text>
      <text x="125" y="38" text-anchor="middle" fill="#8b949e" font-size="10">Create CSS extraction</text>
      <text x="125" y="50" text-anchor="middle" fill="#8b949e" font-size="10">build script with esbuild</text>
    </g>
    
    <g transform="translate(570, 40)">
      <rect width="250" height="55" rx="6" fill="#f0883e" fill-opacity="0.2" stroke="#f0883e"/>
      <text x="125" y="20" text-anchor="middle" fill="#f0883e" font-size="11" font-weight="bold">Phase 3: Serve</text>
      <text x="125" y="38" text-anchor="middle" fill="#8b949e" font-size="10">Update servers to use</text>
      <text x="125" y="50" text-anchor="middle" fill="#8b949e" font-size="10">external CSS/JS files</text>
    </g>
    
    <g transform="translate(840, 40)">
      <rect width="250" height="55" rx="6" fill="#8b949e" fill-opacity="0.2" stroke="#8b949e"/>
      <text x="125" y="20" text-anchor="middle" fill="#8b949e" font-size="11" font-weight="bold">Phase 4: Clean</text>
      <text x="125" y="38" text-anchor="middle" fill="#8b949e" font-size="10">Remove inline CSS/JS</text>
      <text x="125" y="50" text-anchor="middle" fill="#8b949e" font-size="10">from server files</text>
    </g>
  </g>
  
  <!-- Inspired by badge -->
  <text x="600" y="830" text-anchor="middle" fill="#6e7681" font-size="11">
    Inspired by jsgui3-server CSS extraction pattern â€¢ Using esbuild for fast builds
  </text>
  <text x="600" y="850" text-anchor="middle" fill="#6e7681" font-size="10">
    AST-based extraction finds ClassName.css = `...` and ClassName.getStyles() patterns
  </text>
  
</svg>
