<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Crawler UI</title>
    <link rel="stylesheet" href="/crawler.css?v=20251014-complete-overhaul" />
  <script type="module" src="/assets/global-nav.js"></script>
  </head>
  <body>
    <a class="skip-link" href="#crawl-controls">Skip to crawl controls</a>
    <main class="crawler-layout crawler-layout--compact">
      <header class="compact-header">
        <h1 class="compact-header__title">Crawler</h1>
        <nav class="compact-header__nav">
          <div data-global-nav data-active="crawler" data-variant="bar"></div>
        </nav>
      </header>

      <!-- Left Sidebar: Controls -->
      <div class="controls-sidebar">
        <!-- Crawl Controls -->
        <section id="crawl-controls" class="panel controls-card controls-card--compact" aria-labelledby="crawl-controls-heading">
          <header class="controls-card__header">
            <h2 id="crawl-controls-heading" class="section-title">Quick Start</h2>
            <button id="themeBtn" class="button button--ghost button--sm" type="button" title="Toggle dark mode">üåô</button>
          </header>

          <div class="control-grid control-grid--primary">
            <div class="control-field control-field--wide" id="startUrlField">
              <label for="startUrl">Website</label>
              <input id="startUrl" value="https://www.theguardian.com" size="30" />
            </div>
            <div class="control-field control-field--wide control-field--hidden" id="gazetteerNote">
              <div class="info-message">
                <strong>Gazetteer Mode:</strong> Uses predefined URLs.
              </div>
            </div>
            <div class="control-field">
              <label for="crawlType">Mode</label>
              <select id="crawlType">
                <option value="">Loading‚Ä¶</option>
              </select>
            </div>
            <div class="control-field" id="depthField">
              <label for="depth">Depth</label>
              <input id="depth" type="number" value="2" min="1" max="5" />
            </div>
            <div class="control-field">
              <label for="maxPages">Pages</label>
              <input id="maxPages" type="number" placeholder="‚àû" />
            </div>
            <div class="control-field">
              <label for="concurrency">Threads</label>
              <input id="concurrency" type="number" value="1" min="1" max="10" />
            </div>
          </div>

          <details class="controls-advanced" id="controlsAdvanced">
            <summary>Advanced</summary>
            <div class="control-grid control-grid--advanced">
              <div class="control-field">
                <label for="requestTimeoutMs">Timeout (ms)</label>
                <input id="requestTimeoutMs" type="number" placeholder="10000" />
              </div>
              <div class="control-field">
                <label for="refetchIfOlderThan">Refetch</label>
                <input id="refetchIfOlderThan" type="text" placeholder="6h" />
              </div>
              <div class="control-checkboxes">
                <label class="control-checkbox">
                  <input id="slowMode" type="checkbox" />
                  <span>Slow mode</span>
                </label>
                <label class="control-checkbox">
                  <input id="useSitemap" type="checkbox" />
                  <span>Use sitemap</span>
                </label>
              </div>
            </div>
          </details>

          <div class="control-actions">
            <div class="control-buttons">
              <button id="startBtn" data-testid="start-crawl-button" class="button button--primary" type="button">‚ñ∂Ô∏è Start</button>
              <button id="stopBtn" class="button" type="button">‚èπÔ∏è Stop</button>
              <button id="pauseBtn" class="button" type="button">‚è∏Ô∏è Pause</button>
              <button id="resumeBtn" class="button" type="button" disabled>‚ñ∂Ô∏è Resume</button>
            </div>
          </div>
        </section>

        <!-- Status Box -->
        <section class="panel">
          <h3>Status</h3>
          <div class="summary-meta">
            <span id="stageBadge" class="badge badge-neutral">Idle</span>
            <span id="crawlTypeBadge" class="badge badge-neutral">‚Äî</span>
            <span id="pausedBadge" class="badge badge-ok is-hidden">Running</span>
          </div>
          <div id="healthStrip" class="health-strip" style="margin-top: 0.5rem;">
            <span id="badgeConn" class="badge badge-warn">SSE: connecting‚Ä¶</span>
            <span id="badgeDb" class="muted">db: ‚Ä¶</span>
          </div>
        </section>

        <!-- Features Panel -->
        <section id="featuresPanel" class="panel is-hidden">
          <h3>üß† Intelligent Features</h3>
          <div id="featuresDisplay" class="features-display">
            <span class="feature-badge">Loading...</span>
          </div>
        </section>

        <!-- Metrics Box -->
        <section class="panel">
          <h3>Metrics</h3>
          <div class="metrics-compact">
            <div class="metric-compact">
              <span class="metric-compact__label">Visited</span>
              <span id="metricVisited" class="metric-compact__value">0</span>
            </div>
            <div class="metric-compact">
              <span class="metric-compact__label">Saved</span>
              <span id="metricSaved" class="metric-compact__value">0</span>
            </div>
            <div class="metric-compact">
              <span class="metric-compact__label">Queue</span>
              <span id="metricQueue" class="metric-compact__value">0</span>
            </div>
            <div class="metric-compact">
              <span class="metric-compact__label">Downloaded</span>
              <span id="metricDownloaded" class="metric-compact__value">0</span>
            </div>
            <div class="metric-compact">
              <span class="metric-compact__label">Found</span>
              <span id="metricFound" class="metric-compact__value">0</span>
            </div>
            <div class="metric-compact">
              <span class="metric-compact__label">Errors</span>
              <span id="metricErrors" class="metric-compact__value">0</span>
            </div>
          </div>
        </section>

        <!-- Background Tasks Widget -->
        <section id="backgroundTasksWidget" class="panel is-hidden" data-has-tasks="0">
          <div class="summary-head">
            <h3>Background Tasks</h3>
            <a href="/background-tasks" class="button button--ghost button--sm">‚Üí</a>
          </div>
          <div id="activeTasksList" class="active-tasks-list"></div>
        </section>
      </div>

      <!-- Right Side: Main View -->
      <div class="main-view">
        
        <!-- Stage Flow Indicator -->
        <section id="stageFlow" class="panel is-hidden">
          <div class="stage-flow">
            <div class="stage-item" data-stage="planning">
              <div>üìã Planning</div>
            </div>
            <div class="stage-item" data-stage="discovery">
              <div>üîç Discovery</div>
            </div>
            <div class="stage-item" data-stage="crawling">
              <div>üï∑Ô∏è Crawling</div>
            </div>
            <div class="stage-item" data-stage="completion">
              <div>‚úÖ Complete</div>
            </div>
          </div>
        </section>

        <!-- Active Jobs -->
        <section id="jobsSection" class="panel">
          <div class="panel-head">
            <h3>Active Crawl</h3>
            <label class="toggle-control">
              <input type="checkbox" id="showLogs" />
              <span>Logs</span>
            </label>
          </div>
          <div id="jobsList" class="muted text-sm">No active crawls</div>
          
          <div id="crawlProgressSection" class="crawl-progress-section is-hidden" data-active="0">
            <div id="crawlProgressContainer" class="crawl-progress-container"></div>
          </div>
        </section>

        <!-- Planner Info (Intelligent Crawls Only) -->
        <section id="plannerInfo" class="panel is-hidden">
          <h3>üß† Planner Status</h3>
          <div class="pipeline-grid">
            <article class="pipeline-card" data-pipeline-stage="planner">
              <header class="pipeline-card__head">
                <span id="pipelinePlannerStatus" class="badge badge-neutral">Idle</span>
                <span id="pipelinePlannerSummary" class="pipeline-card__summary muted">Waiting...</span>
              </header>
              <dl class="pipeline-card__meta">
                <div>
                  <dt>Stage</dt>
                  <dd id="pipelinePlannerStage" class="muted">‚Äî</dd>
                </div>
                <div>
                  <dt>Goals</dt>
                  <dd id="pipelinePlannerGoals" class="muted">‚Äî</dd>
                </div>
              </dl>
            </article>
          </div>
          <div id="pipelineDiagram" class="pipeline-diagram muted"></div>
        </section>

        <!-- Intelligent Insights Panel (Intelligent Crawls Only) -->
        <section id="insightsPanel" class="panel is-hidden" data-has-data="0">
          <div class="summary-head">
            <h3>üí° Intelligent Insights</h3>
          </div>
          <div class="insight-grid">
            <div class="insight-item">
              <span class="insight-label">Coverage</span>
              <span id="insightCoverage" class="insight-value">‚Äî</span>
              <span id="insightCoverageDetail" class="insight-detail muted"></span>
            </div>
            <div class="insight-item">
              <span class="insight-label">Seeded Hubs</span>
              <span id="insightHubs" class="insight-value">‚Äî</span>
              <span id="insightHubsDetail" class="insight-detail muted"></span>
            </div>
            <div class="insight-item">
              <span class="insight-label">Problems</span>
              <span id="insightProblems" class="insight-value">0</span>
              <span id="insightProblemsDetail" class="insight-detail muted"></span>
            </div>
            <div class="insight-item">
              <span class="insight-label">Queue Mix</span>
              <span id="insightQueueMix" class="insight-value">‚Äî</span>
              <span id="insightQueueMixDetail" class="insight-detail muted"></span>
            </div>
          </div>
        </section>

        <!-- Pattern Insights (Intelligent Crawls Only) -->
        <section id="patternInsightsPanel" class="panel pattern-insights is-hidden" data-has-data="0">
          <div class="summary-head">
            <h3>üîç Pattern Discovery</h3>
          </div>
          <div class="pattern-summary-grid">
            <div class="pattern-summary-card">
              <span class="pattern-summary-label">Events</span>
              <span id="patternInsightsTotal" class="pattern-summary-value">0</span>
            </div>
            <div class="pattern-summary-card">
              <span class="pattern-summary-label">Sections</span>
              <span id="patternInsightsSections" class="pattern-summary-value">0</span>
            </div>
            <div class="pattern-summary-card">
              <span class="pattern-summary-label">Hints</span>
              <span id="patternInsightsHints" class="pattern-summary-value">0</span>
            </div>
            <div class="pattern-summary-card pattern-summary-card--wide">
              <span class="pattern-summary-label">Last Event</span>
              <span id="patternInsightsLastSummary" class="pattern-summary-value pattern-summary-value--small">None</span>
            </div>
          </div>
          <div class="pattern-log">
            <div class="pattern-log__head">
              <h4>Recent Events</h4>
            </div>
            <div id="patternInsightsLog" class="pattern-log__list timeline-list muted">No pattern events yet.</div>
          </div>
        </section>

        <!-- Structure Discovery (Structure Crawls Only) -->
        <section id="structurePanel" class="panel is-hidden" data-has-data="0" aria-live="polite">
        <div class="summary-head">
          <h3>Structure Discovery</h3>
          <span id="structureHint" class="muted text-xs">Maps navigation without downloading articles.</span>
      </div>
        <div class="structure-grid">
          <div class="structure-card">
            <span class="structure-label">Nav pages</span>
            <span id="structureNavPages" class="structure-value">0</span>
          </div>
          <div class="structure-card">
            <span class="structure-label">Articles skipped</span>
            <span id="structureArticlesSkipped" class="structure-value">0</span>
        </div>
        <div class="structure-card structure-card--wide">
          <span class="structure-label">Top sections</span>
          <ul id="structureTopSections" class="structure-list">
            <li class="structure-list__empty">No sections discovered yet.</li>
          </ul>
        </div>
      </div>
      <p id="structureUpdated" class="structure-updated muted text-xs">Awaiting crawl activity‚Ä¶</p>
    </section>
      <section id="insightsPanel" class="panel panel--two-thirds is-hidden" data-has-data="0">
        <div class="summary-head">
          <h3>Intelligent Insights</h3>
          <span id="insightsHint" class="muted text-xs">Appears when planner is active.</span>
      </div>
      <div class="insight-grid">
        <div class="insight-item">
          <span class="insight-label">Coverage achieved</span>
          <span id="insightCoverage" class="insight-value">‚Äî</span>
          <span id="insightCoverageDetail" class="insight-detail muted"></span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Seeded hubs</span>
          <span id="insightHubs" class="insight-value">‚Äî</span>
          <span id="insightHubsDetail" class="insight-detail muted"></span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Unresolved problems</span>
          <span id="insightProblems" class="insight-value">0</span>
          <span id="insightProblemsDetail" class="insight-detail muted"></span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Planner goals</span>
          <span id="insightGoals" class="insight-value">‚Äî</span>
          <span id="insightGoalsDetail" class="insight-detail muted"></span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Queue mix</span>
          <span id="insightQueueMix" class="insight-value">‚Äî</span>
          <span id="insightQueueMixDetail" class="insight-detail muted"></span>
        </div>
      </div>
      <div class="insight-extras">
        <div class="insight-extra">
          <h4>Highlights</h4>
          <ul id="insightHighlightsList" class="insight-highlights"></ul>
        </div>
          <div class="insight-extra">
            <h4>Queue heatmap</h4>
            <div id="insightQueueHeatmap" class="insight-heatmap muted">Not available yet.</div>
        </div>
      </div>
    </section>
      <section id="patternInsightsPanel" class="panel pattern-insights panel--full-width is-hidden" data-has-data="0">
        <div class="summary-head">
          <h3>Pattern Insights</h3>
          <span id="patternInsightsHint" class="muted text-xs">Pattern discovery from intelligent planner.</span>
      </div>
        <div class="pattern-summary-grid">
          <div class="pattern-summary-card">
            <span class="pattern-summary-label">Events</span>
            <span id="patternInsightsTotal" class="pattern-summary-value">0</span>
          </div>
          <div class="pattern-summary-card">
            <span class="pattern-summary-label">Sections</span>
            <span id="patternInsightsSections" class="pattern-summary-value">0</span>
          </div>
          <div class="pattern-summary-card">
            <span class="pattern-summary-label">Hints</span>
            <span id="patternInsightsHints" class="pattern-summary-value">0</span>
        </div>
          <div class="pattern-summary-card pattern-summary-card--wide">
            <span class="pattern-summary-label">Last event</span>
            <span id="patternInsightsLastSummary" class="pattern-summary-value pattern-summary-value--small">None yet.</span>
          <span id="patternInsightsLastStage" class="pattern-summary-detail muted">‚Äî</span>
          <span class="pattern-summary-detail muted">Updated <span id="patternInsightsLastUpdated">‚Äî</span></span>
        </div>
      </div>
      <div class="pattern-insights-grid">
        <div class="pattern-insights-column">
          <h4>Top sections</h4>
          <ul id="patternInsightsTopSections" class="pattern-insights-list"></ul>
        </div>
        <div class="pattern-insights-column">
          <h4>Article hints</h4>
          <ul id="patternInsightsTopHints" class="pattern-insights-list"></ul>
        </div>
          <div class="pattern-insights-column">
            <h4>Sources</h4>
            <ul id="patternInsightsSources" class="pattern-insights-list"></ul>
        </div>
      </div>
      <div class="pattern-log">
        <div class="pattern-log__head">
          <h4>Pattern event log</h4>
        </div>
        <div id="patternInsightsLog" class="pattern-log__list timeline-list muted">No pattern events yet.</div>
      </div>
    </section>
      <section id="pipelinePanel" class="panel pipeline-panel panel--full-width is-hidden">
        <div class="summary-head">
          <h3>Pipeline</h3>
          <span id="pipelineUpdated" class="muted text-xs">Waiting for planner‚Ä¶</span>
      </div>
      <div id="pipelineDiagram" class="pipeline-diagram muted"></div>
      <div class="pipeline-grid">
          <article class="pipeline-card" data-pipeline-stage="analysis">
            <header class="pipeline-card__head">
              <span id="pipelineAnalysisStatus" class="badge badge-neutral">Idle</span>
              <span id="pipelineAnalysisSummary" class="pipeline-card__summary muted">No runs yet.</span>
            </header>
            <dl class="pipeline-card__meta">
              <div>
                <dt>Signals</dt>
                <dd id="pipelineAnalysisSignals" class="muted">None</dd>
            </div>
            <div>
              <dt>Last run</dt>
              <dd id="pipelineAnalysisLastRun" class="muted">‚Äî</dd>
            </div>
            <div>
              <dt>Detail</dt>
              <dd id="pipelineAnalysisLink" class="muted">‚Äî</dd>
            </div>
          </dl>
            <footer id="pipelineAnalysisHistorySection" class="pipeline-card__history">
            </div>
            <ul id="pipelineAnalysisHistory" class="pipeline-history-list"></ul>
          </footer>
        </article>
          <article class="pipeline-card" data-pipeline-stage="planner">
            <header class="pipeline-card__head">
              <span id="pipelinePlannerStatus" class="badge badge-neutral">Idle</span>
              <span id="pipelinePlannerSummary" class="pipeline-card__summary muted">Activates on crawl start.</span>
          </header>
          <dl class="pipeline-card__meta">
            <div>
              <dt>Stage</dt>
              <dd id="pipelinePlannerStage" class="muted">‚Äî</dd>
            </div>
            <div>
              <dt>Goals</dt>
              <dd id="pipelinePlannerGoals" class="muted">‚Äî</dd>
            </div>
          </dl>
        </article>
          <article class="pipeline-card" data-pipeline-stage="execution">
            <header class="pipeline-card__head">
              <span id="pipelineExecutionStatus" class="badge badge-neutral">Idle</span>
              <span id="pipelineExecutionSummary" class="pipeline-card__summary muted">Awaiting crawl.</span>
          </header>
          <dl class="pipeline-card__meta">
            <div>
              <dt>Jobs</dt>
              <dd id="pipelineExecutionJobs" class="muted">0</dd>
            </div>
            <div>
              <dt>Queue</dt>
              <dd id="pipelineExecutionQueue" class="muted">‚Äî</dd>
            </div>
            <div>
              <dt>Coverage</dt>
              <dd id="pipelineExecutionCoverage" class="muted">‚Äî</dd>
            </div>
          </dl>
        </article>
      </div>
      <div id="insightAnalysisHighlights" class="analysis-highlights"></div>
    </section>

      <section id="resumeSection" class="panel panel--compact panel--half-width resume-panel" data-has-data="0">
        <div class="panel-head resume-panel__head">
          <h3>Resume Crawls</h3>
          <div class="resume-panel__actions">
            <button id="clearQueuesBtn" class="button button--danger resume-panel__btn" type="button" title="Clear all incomplete crawls">Clear Crawls</button>
            <button id="resumeRefreshBtn" class="button button--ghost resume-panel__btn" type="button">Refresh</button>
            <button id="resumeAllBtn" class="button button--secondary resume-panel__btn" type="button" disabled>Resume All</button>
          </div>
        </div>
        <p id="resumeSummary" class="resume-panel__summary muted text-sm">Checking‚Ä¶</p>
        <div id="resumeStatus" class="resume-panel__status" aria-live="polite"></div>
        <ul id="resumeList" class="resume-list" aria-live="polite">
          <li class="resume-item resume-item--empty">Loading‚Ä¶</li>
      </ul>
    </section>

    <section id="progressSection" class="panel panel--stack panel--two-thirds">
      <div class="panel-head">
        <h3>
          Progress
          <span id="eta" class="muted text-sm"></span>
        </h3>
      </div>
      <div id="progress" class="progress-line">visited: 0, downloaded: 0, found: 0, saved: 0</div>
      <div id="inflight" class="progress-line progress-line--column">
        <span>current downloads: 0</span>
        <ul id="inflightList" class="progress-list"></ul>
      </div>
        <div id="cacheInfo" class="progress-line">cached hits: 0</div>
        <div id="metrics" class="metrics-bar">
          <strong>Performance:</strong>
        <span id="m_reqps" class="metric-spark">
          <span id="m_reqps_label">req/s: 0</span>
          <svg id="reqps_spark" width="200" height="36" viewBox="0 0 200 36" preserveAspectRatio="none">
            <title id="reqps_title">req/s sparkline</title>
            <polyline id="reqps_poly" class="spark-ok" fill="none" stroke-width="1" points="" />
          </svg>
        </span>
          <span id="m_dlps" class="metric-spark">
            <span id="m_dlps_label">dl/s: 0 ¬∑ MB/s: 0</span>
          <svg id="dlps_spark" width="200" height="36" viewBox="0 0 200 36" preserveAspectRatio="none">
            <title id="dlps_title">dl/s sparkline</title>
            <polyline id="dlps_poly" class="spark-ok" fill="none" stroke-width="1" points="" />
          </svg>
        </span>
        <span id="m_errpm" class="metric-pill">err/min: 0</span>
        <span id="m_qsize" class="metric-spark">
          <span>queue: 0</span>
          <svg id="q_spark" width="200" height="36" viewBox="0 0 200 36" preserveAspectRatio="none">
            <title id="q_title">queue sparkline</title>
            <polyline id="q_poly" class="spark-ok" fill="none" stroke-width="1" points="" />
          </svg>
        </span>
  <span id="m_domrpm" class="metric-pill muted is-hidden">domain rpm: n/a</span>
  <span id="m_domlim" class="metric-pill muted is-hidden">limit: n/a</span>
  <span id="m_dombk" class="metric-pill muted is-hidden">backoff: -</span>
  <span id="m_domrl" class="metric-pill bad is-hidden u-bold">RATE LIMITED</span>
        <span id="m_errs" class="metric-pill">errors: 0</span>
        <span id="cacheGauge" class="metric-pill muted">cache: 1m 0% ¬∑ 5m 0%</span>
      </div>
    </section>

      <!-- Events & Logs -->
      <section id="eventsSection" class="panel panel--expando panel--full-width">
        <details id="secErrors" open>
          <summary><strong>Recent Errors</strong></summary>
        <div id="errorsPanel" class="expando-body text-sm">
          <div id="errorsList" class="muted">Loading‚Ä¶</div>
          </div>
        </details>
        <details id="secProblems">
          <summary><strong>Problems</strong></summary>
        <div id="problemsPanel" class="expando-body text-sm">
          <div id="problemsList" class="muted">None</div>
          </div>
        </details>
        <details id="secMilestones">
          <summary><strong>Milestones</strong></summary>
          <div id="milestonesList" class="timeline-list muted">No milestones yet.</div>
        </details>
        <details id="secTelemetry">
          <summary><strong>Crawl Telemetry</strong></summary>
          <div id="crawlTelemetryContainer" class="telemetry-container"></div>
      </details>
      <details id="secTelemetry" open>
        <summary><strong>Crawl Telemetry</strong></summary>
        <div id="crawlTelemetryContainer" class="telemetry-container">
          <!-- TelemetryDisplay will be rendered here -->
        </div>
      </details>
      <details id="secDomains" open>
        <summary><strong>Recent Domains</strong></summary>
        <div id="domains" class="meta text-sm">Loading‚Ä¶</div>
      </details>
      <details id="secLogs" open>
        <summary><strong>Logs</strong></summary>
        <div class="logs-body">
          <div id="logsToolbar" class="logs-toolbar">
            <span>font:</span>
            <button id="logsFontMinus" type="button" class="button button--ghost button--xs" title="Smaller">A-</button>
            <button id="logsFontPlus" type="button" class="button button--ghost button--xs" title="Larger">A+</button>
            <span id="logsFontVal" class="muted"></span>
          </div>
          <pre id="logs"></pre>
          <div id="logsResizer" class="resizer-h" title="Drag to resize logs"></div>
            </div>
          </details>
        </details>
      </section>

      <section id="healthPanel" class="panel panel--compact panel--third">
        <div class="panel-head">
          <h3>Status</h3>
        </div>
        <div id="healthStrip" class="health-strip">
          <span id="badgeRobots" class="muted">robots: ‚Ä¶</span>
          <span id="badgeSitemap" class="muted">sitemap: 0 / 0</span>
          <span id="badgeDb" class="muted">db: ‚Ä¶</span>
          <span id="badgeDisk" class="muted">disk: ‚Ä¶</span>
          <span id="badgeConn" class="badge badge-warn">SSE: connecting‚Ä¶</span>
        </div>
        <div class="panel-footer-link">
          <a href="/urls">View saved URLs</a>
        </div>
      </section>

      <section id="planner" class="panel panel--expando panel--full-width is-hidden">
        <details id="secPlanner">
          <summary><strong>Planner Timeline</strong></summary>
          <div id="plannerStagesList" class="timeline-list muted">Appears when intelligent crawls run.</div>
        </details>
      </section>
    </main>
    <script type="module" src="/assets/index.js?v=20251009-2245"></script>
  </body>
</html>